```html
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Most Useful Site in the World</title>
<meta name="description" content="The Most Useful Site in the World" />

<style>
  :root{
    /* Core theme variables (will be updated by the theme engine) */
    --accent:#2dd4ff;
    --accent-contrast:#071018;
    --muted:#e6faff;
    --text:#e6faff;

    --bg-1:#0f1720;
    --bg-2:#1b2630;

    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.08);
    --panel: rgba(20,20,20,0.9);
    --panel-strong: rgba(10,10,10,0.95);

    --card-grad-1: rgba(255,255,255,0.04);
    --card-grad-2: rgba(255,255,255,0.07);

    --border: rgba(255,255,255,0.10);
    --shadow: 0 14px 40px rgba(0,0,0,0.6);

    --card-min: 300px;
  }

  /* Page background and base */
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(135deg,var(--bg-1),var(--bg-2));
    background-size:400% 400%;
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  body::before{
    content:"";
    position:fixed;inset:0;pointer-events:none;z-index:0;
    background:url("/logo.png") no-repeat center;background-size:min(50vw,520px);
    opacity:0.06;filter:blur(0.6px);mix-blend-mode:screen;animation:gradientShift 24s ease infinite;
  }

  header{padding:28px 20px 10px;text-align:center;position:relative;z-index:2}
  header h1{margin:0;font-size:1.8rem;color:var(--accent);letter-spacing:0.2px}

  /* Bottom-left controls (icon buttons) */
  .control-btn{
    position:fixed;bottom:18px;z-index:10000;width:48px;height:48px;border-radius:12px;
    background:var(--glass-strong);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
    cursor:pointer;backdrop-filter:blur(8px);box-shadow:0 6px 20px rgba(0,0,0,0.45);transition:transform .22s,background .22s;
    color:var(--accent);line-height:1;border-radius:10px;
  }
  .control-btn:hover{transform:scale(1.08)}
  #toolboxToggle{left:18px}
  #readerToggle{left:78px}
  #paletteToggle{left:138px}

  /* Panels */
  .toolbox-panel,.palette-panel{
    position:fixed;bottom:74px;z-index:9998;background:var(--panel);border:1px solid var(--border);border-radius:14px;
    padding:14px;box-shadow:var(--shadow);backdrop-filter:blur(12px);transition:transform .22s ease,opacity .22s ease;
    transform:translateY(8px) scale(.98);opacity:0;pointer-events:none;
  }
  .toolbox-panel{left:18px;min-width:300px;max-width:60vw;max-height:65vh;overflow-y:auto}
  .palette-panel{left:138px;width:260px}
  .toolbox-panel.open,.palette-panel.open{transform:translateY(0) scale(1);opacity:1;pointer-events:auto}

  /* Search/controls */
  .search-bar{max-width:920px;margin:14px auto 16px;display:flex;background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.02));border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,0.04)}
  .search-bar input{flex:1;border:none;background:transparent;color:var(--text);font-size:1rem;outline:none}
  .controls{text-align:center;margin-bottom:20px}
  .controls button{margin:0 6px;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;transition:all .22s ease}
  .controls button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,0.35)}

  /* Grid and cards */
  .dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(var(--card-min),1fr));gap:20px;padding:20px;align-items:start}
  .card{
    position:relative;background:linear-gradient(135deg,var(--card-grad-1),var(--card-grad-2));
    border:1px solid var(--border);border-radius:12px;padding:16px;backdrop-filter:blur(8px);
    opacity:0;transform:translateY(40px) scale(0.98);
    transition:opacity .6s cubic-bezier(.2,.9,.2,1),transform .6s cubic-bezier(.2,.9,.2,1),box-shadow .22s;
    box-shadow:0 6px 18px rgba(0,0,0,0.35);
    overflow:hidden;
  }
  .card.visible{opacity:1;transform:none}
  .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .card-header h3{margin:0;color:var(--accent);font-size:1.05rem}
  .card .content{contain:layout paint}

  .status{text-align:center;color:rgba(230,250,255,0.85);margin:6px 0 8px;font-size:.95rem}

  /* Casino dealing animation (subtle) */
  .card.deal{animation:casinoDeal .7s cubic-bezier(.25,.8,.25,1)}
  @keyframes casinoDeal{
    0%{opacity:0;transform:translateY(40px) rotate(-6deg) scale(.95)}
    50%{opacity:.6;transform:translateY(-8px) rotate(3deg) scale(1.02)}
    100%{opacity:1;transform:translateY(0) rotate(0) scale(1)}
  }

  /* Palette styles */
  .palette-title{color:var(--accent);font-weight:600;margin-bottom:8px}
  .palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
  .palette-color{width:34px;height:34px;border-radius:10px;cursor:pointer;border:2px solid var(--border);transition:border .18s}
  .palette-color.active{border-color:#fff;box-shadow:0 0 12px rgba(255,255,255,0.28)}

  /* Reader Mode */
  body.reader-mode {font-size: 1.18rem;line-height: 1.6;}
  body.reader-mode .dashboard {grid-template-columns: 1fr !important;}
  body.reader-mode .card {font-size: 1.05rem;padding: 20px;}
  body.reader-mode input,body.reader-mode select,body.reader-mode textarea,body.reader-mode button {font-size: 1.05rem;padding: 10px;}
</style>
</head>

<body>
  <!-- Bottom-left icon buttons (SVG icons) -->
  <button id="toolboxToggle" class="control-btn" aria-label="Toolbox" title="Toolbox">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
      <rect x="3" y="4" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.4" />
      <path d="M7 8h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
      <path d="M7 12h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
    </svg>
  </button>

  <button id="readerToggle" class="control-btn" aria-label="Reader Mode" title="Reader Mode">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
      <path d="M3 12a3 3 0 0 1 6 0v1a3 3 0 0 0 6 0v-1a3 3 0 0 1 6 0" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M6 12v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
      <path d="M18 12v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
    </svg>
  </button>

  <button id="paletteToggle" class="control-btn" aria-label="Theme" title="Theme">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
      <path d="M12 3a9 9 0 1 0 9 9c0-1.1-.9-2-2-2-.9 0-1.6.6-1.9 1.4A3.5 3.5 0 0 1 14 11c-1.9 0-3.5 1.6-3.5 3.5S12.1 18 14 18c.6 0 1.2-.2 1.7-.5.5-.3 1.1-.5 1.8-.5 1.7 0 3 1.3 3 3 0 1.1-.9 2-2 2A9 9 0 0 0 12 3z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="9" cy="9" r="1" fill="currentColor"/>
      <circle cx="7" cy="14" r="1" fill="currentColor"/>
      <circle cx="14" cy="7" r="1" fill="currentColor"/>
    </svg>
  </button>

  <!-- Palette panel -->
  <div class="palette-panel" id="palettePanel" aria-label="Theme palette">
    <div class="palette-title">Accent color</div>
    <div class="palette-grid">
      <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff" title="Sky"></div>
      <div class="palette-color" data-accent="#ff4d4d" style="background:#ff4d4d" title="Coral"></div>
      <div class="palette-color" data-accent="#4dff88" style="background:#4dff88" title="Mint"></div>
      <div class="palette-color" data-accent="#ffd84d" style="background:#ffd84d" title="Sun"></div>
      <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd" title="Violet"></div>
      <div class="palette-color" data-accent="#ff006e" style="background:#ff006e" title="Magenta"></div>
      <div class="palette-color" data-accent="#00d4ff" style="background:#00d4ff" title="Aqua"></div>
      <div class="palette-color" data-accent="#ff9500" style="background:#ff9500" title="Orange"></div>
      <div class="palette-color" data-accent="#32d74b" style="background:#32d74b" title="Green"></div>
      <div class="palette-color" data-accent="#ff5e3a" style="background:#ff5e3a" title="Tangerine"></div>
    </div>
  </div>

  <!-- Toolbox panel -->
  <div class="toolbox-panel" id="toolboxPanel" role="navigation">
    <h3 style="color:var(--accent);margin:0 0 10px;">Toolbox</h3>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:0.9rem">
      <span>Card width</span>
      <input type="range" id="toolboxWidth" min="220" max="420" value="300" step="10" style="flex:1">
      <span id="toolboxWidthValue">300px</span>
    </div>
    <div id="toolboxList" class="dashboard" style="grid-template-columns:repeat(auto-fill,minmax(300px,1fr));"></div>
  </div>

  <header><h1>The Most Useful Site in the World</h1></header>

  <main role="main">
    <div class="search-bar">
      <input id="searchInput" type="text" placeholder="Search cards..." aria-label="Search cards" />
    </div>

    <div class="controls">
      <button id="sortAlphaBtn" aria-label="Sort cards alphabetically">Sort A→Z</button>
      <button id="sortRandomBtn" aria-label="Shuffle cards randomly">Random</button>
      <button id="shuffleDealBtn" aria-label="Re-deal cards">Re‑deal</button>
    </div>

    <div class="status" id="status">Loading cards...</div>
    <div id="gridContainer" class="dashboard"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <!-- Theme engine: applies full UI revamp from chosen accent and persists it -->
  <script>
  (function(){
    const ACCENT_KEY = 'site_accent_v1';
    const paletteEls = document.querySelectorAll('.palette-color');

    function hexToRgb(hex){
      hex = hex.replace('#','');
      if(hex.length===3) hex = hex.split('').map(c=>c+c).join('');
      const n = parseInt(hex,16);
      return {r:(n>>16)&255, g:(n>>8)&255, b:n&255};
    }
    function rgbToHex(r,g,b){
      return '#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
    }
    function luminance(r,g,b){
      const srgb = [r,g,b].map(v=>{
        v /= 255;
        return v <= 0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055,2.4);
      });
      return 0.2126*srgb[0] + 0.7152*srgb[1] + 0.0722*srgb[2];
    }
    function contrastRatio(hexA, hexB){
      const a = hexToRgb(hexA), b = hexToRgb(hexB);
      const L1 = luminance(a.r,a.g,a.b), L2 = luminance(b.r,b.g,b.b);
      const bright = Math.max(L1,L2), dark = Math.min(L1,L2);
      return (bright + 0.05) / (dark + 0.05);
    }

    function clamp(v){ return Math.max(0, Math.min(255, Math.round(v))); }

    function deriveTheme(accentHex){
      const a = hexToRgb(accentHex);
      // subtle background stops derived from accent (darkened)
      const bg1 = rgbToHex(clamp(a.r*0.06), clamp(a.g*0.06), clamp(a.b*0.08));
      const bg2 = rgbToHex(clamp(a.r*0.10), clamp(a.g*0.12), clamp(a.b*0.16));
      // glass tints
      const glass = `rgba(${a.r},${a.g},${a.b},0.06)`;
      const glassStrong = `rgba(${a.r},${a.g},${a.b},0.10)`;
      // card gradients
      const cardGrad1 = `rgba(${Math.min(255,a.r+18)},${Math.min(255,a.g+18)},${Math.min(255,a.b+18)},0.04)`;
      const cardGrad2 = `rgba(${Math.min(255,a.r+36)},${Math.min(255,a.g+36)},${Math.min(255,a.b+36)},0.07)`;
      // panel tint
      const panel = `rgba(${Math.max(0,Math.round(a.r*0.06))},${Math.max(0,Math.round(a.g*0.06))},${Math.max(0,Math.round(a.b*0.06))},0.92)`;
      // muted/text: choose white or near-white if accent is dark on dark bg
      const whiteContrast = contrastRatio('#ffffff', accentHex);
      const muted = whiteContrast > 3.2 ? '#ffffff' : '#e6faff';
      const accentContrast = (luminance(a.r,a.g,a.b) > 0.5) ? '#071018' : '#ffffff';
      return {bg1,bg2,glass,glassStrong,cardGrad1,cardGrad2,panel,muted,accentContrast};
    }

    function applyTheme(accentHex){
      const root = document.documentElement;
      root.style.setProperty('--accent', accentHex);
      const d = deriveTheme(accentHex);
      root.style.setProperty('--accent-contrast', d.accentContrast);
      root.style.setProperty('--bg-1', d.bg1);
      root.style.setProperty('--bg-2', d.bg2);
      root.style.setProperty('--glass', d.glass);
      root.style.setProperty('--glass-strong', d.glassStrong);
      root.style.setProperty('--card-grad-1', d.cardGrad1);
      root.style.setProperty('--card-grad-2', d.cardGrad2);
      root.style.setProperty('--panel', d.panel);
      root.style.setProperty('--muted', d.muted);
      root.style.setProperty('--text', d.muted);
      // update body background for immediate effect
      document.body.style.background = `linear-gradient(135deg, ${d.bg1}, ${d.bg2})`;
      localStorage.setItem(ACCENT_KEY, accentHex);
    }

    paletteEls.forEach(el=>{
      el.addEventListener('click', ()=>{
        paletteEls.forEach(x=>x.classList.remove('active'));
        el.classList.add('active');
        const accent = el.dataset.accent;
        applyTheme(accent);
      });
    });

    const saved = localStorage.getItem(ACCENT_KEY);
    if(saved){
      const el = document.querySelector(`.palette-color[data-accent="${saved}"]`);
      if(el){ el.classList.add('active'); applyTheme(saved); }
      else applyTheme(saved);
    } else {
      const defaultAccent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#2dd4ff';
      applyTheme(defaultAccent);
    }
  })();
  </script>

  <!-- Main app logic: loading cards, search, toolbox, animations -->
  <script>
    const DEFAULT_REPO='mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH='main';

    function parseOwnerRepo(str){const p=str.split('/');return {owner:p[0],repo:p[1]};}
    async function fetchRepoTree(owner,repo,branch){
      const url=`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
      const r=await fetch(url); if(!r.ok) throw new Error('GitHub API error: '+r.status); return r.json();
    }
    async function getCardFiles(owner,repo,branch){
      const data=await fetchRepoTree(owner,repo,branch);
      return (data.tree||[]).filter(i=>i.path.startsWith('cards/') && i.path.endsWith('.html')).map(i=>i.path.replace(/^cards\//,''));
    }

    function createCardElement(file,{pinned=false}={}){
      const name=file.replace('.html','');
      const card=document.createElement('div');
      card.className='card';
      card.dataset.name=name;
      card.dataset.file=file;

      const header=document.createElement('div'); header.className='card-header';
      const title=document.createElement('h3'); title.textContent=name;
      const btnWrap=document.createElement('div'); btnWrap.style.display='flex'; btnWrap.style.gap='6px';

      const addBtn=document.createElement('button'); addBtn.className='add-to-toolbox'; addBtn.title='Add to toolbox'; addBtn.textContent='➕';
      addBtn.addEventListener('click',e=>{e.stopPropagation(); addToToolbox(file);});
      btnWrap.appendChild(addBtn);

      if(pinned){
        const remBtn=document.createElement('button'); remBtn.className='remove-from-toolbox'; remBtn.title='Remove from toolbox'; remBtn.textContent='➖';
        remBtn.addEventListener('click',e=>{e.stopPropagation(); removeFromToolbox(file);});
        btnWrap.appendChild(remBtn);
      }

      header.appendChild(title); header.appendChild(btnWrap); card.appendChild(header);

      const content=document.createElement('div'); content.className='content'; content.textContent='Loading…'; card.appendChild(content);

      // Lazy load content + deal animation
      const io=new IntersectionObserver(entries=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            card.classList.add('deal');
            setTimeout(()=>card.classList.add('visible'), 60);
            loadCardContentInto(card,file).catch(()=>{content.textContent='Preview unavailable.';});
            io.unobserve(card);
          }
        });
      },{threshold:0.12});
      io.observe(card);

      return card;
    }

    async function loadCardContentInto(card,file){
      if(card.dataset.loaded==='true') return;
      const url=`cards/${file}`; const r=await fetch(url);
      if(!r.ok){card.querySelector('.content').textContent='Failed to load'; return;}
      const html=await r.text();
      const sanitized=html.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,'');
      card.querySelector('.content').innerHTML=sanitized;
      card.dataset.loaded='true';
    }

    let currentFiles=[];
    async function loadDashboard(){
      const {owner,repo}=parseOwnerRepo(DEFAULT_REPO);
      try{
        const files=await getCardFiles(owner,repo,DEFAULT_BRANCH);
        if(!files.length){document.getElementById('status').textContent='No cards found.';return;}
        files.sort((a,b)=>a.localeCompare(b,undefined,{sensitivity:'base',numeric:true}));
        currentFiles=files.slice();
        const grid=document.getElementById('gridContainer'); grid.innerHTML='';
        files.forEach(f=>grid.appendChild(createCardElement(f)));
        document.getElementById('status').textContent=`Loaded ${files.length} cards.`;
        applySearchFilter(document.getElementById('searchInput').value);
      }catch(err){
        document.getElementById('status').textContent='Error loading cards.';
      }
    }

    // Search (debounced)
    let currentQuery=''; let searchTimer=null;
    function applySearchFilter(q){
      currentQuery=(q||'').trim().toLowerCase();
      let visibleCount=0;
      document.querySelectorAll('#gridContainer .card').forEach(card=>{
        const name=(card.dataset.name||'').toLowerCase();
        const text=(card.textContent||'').toLowerCase();
        const show=!currentQuery||name.includes(currentQuery)||text.includes(currentQuery);
        card.style.display=show?'':'none';
        if(show) visibleCount++;
      });
      document.getElementById('status').textContent =
        visibleCount?`Showing ${visibleCount} of ${currentFiles.length} cards${currentQuery?' (filtered)':''}.`
        :'No cards match your search.';
    }
    document.getElementById('searchInput').addEventListener('input',e=>{
      clearTimeout(searchTimer); const val=e.target.value;
      searchTimer=setTimeout(()=>applySearchFilter(val),180);
    });

    // Sorting and re-deal
    document.getElementById('sortAlphaBtn').addEventListener('click',()=>{
      const grid=document.getElementById('gridContainer'); const nodes=[...grid.children];
      nodes.sort((a,b)=>a.dataset.name.localeCompare(b.dataset.name,undefined,{sensitivity:'base',numeric:true}));
      nodes.forEach(n=>grid.appendChild(n)); reDeal();
      document.getElementById('status').textContent='Sorted alphabetically.';
    });
    document.getElementById('sortRandomBtn').addEventListener('click',()=>{
      const grid=document.getElementById('gridContainer'); const nodes=[...grid.children];
      for(let i=nodes.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[nodes[i],nodes[j]]=[nodes[j],nodes[i]];}
      nodes.forEach(n=>grid.appendChild(n)); reDeal();
      document.getElementById('status').textContent='Shuffled cards.';
    });
    document.getElementById('shuffleDealBtn').addEventListener('click', reDeal);
    function reDeal(){
      const cards=[...document.querySelectorAll('#gridContainer .card')];
      cards.forEach(c=>{c.classList.remove('visible','deal');});
      cards.forEach((c,i)=>{setTimeout(()=>{c.classList.add('deal'); setTimeout(()=>c.classList.add('visible'),70);}, i*50);});
    }

    // Toolbox store
    const TOOLBOX_KEY='toolbox_items_v1';
    function loadToolboxStore(){try{return JSON.parse(localStorage.getItem(TOOLBOX_KEY)||'[]');}catch(e){return[];}}
    function saveToolboxStore(items){localStorage.setItem(TOOLBOX_KEY,JSON.stringify(items));}
    let toolboxItems=loadToolboxStore();

    function renderToolboxPanel(){
      const list=document.getElementById('toolboxList'); list.innerHTML='';
      if(!toolboxItems.length){list.innerHTML='<div class="toolbox-empty">No items yet. Add tools by pressing ➕ on any card.</div>'; return;}
      toolboxItems.forEach(file=>{const card=createCardElement(file,{pinned:true}); list.appendChild(card);});
    }
    function addToToolbox(file){if(toolboxItems.includes(file)){openToolbox();return;}
      toolboxItems.unshift(file); if(toolboxItems.length>80) toolboxItems.length=80;
      saveToolboxStore(toolboxItems); renderToolboxPanel(); openToolbox();
    }
    function removeFromToolbox(file){
      const idx=toolboxItems.indexOf(file);
      if(idx>=0){toolboxItems.splice(idx,1); saveToolboxStore(toolboxItems); renderToolboxPanel();}
    }

    // Panel toggles
    function openToolbox(){document.getElementById('toolboxPanel').classList.add('open');}
    function toggleToolbox(){document.getElementById('toolboxPanel').classList.toggle('open');}
    document.getElementById('toolboxToggle').addEventListener('click',toggleToolbox);

    function togglePalette(){document.getElementById('palettePanel').classList.toggle('open');}
    document.getElementById('paletteToggle').addEventListener('click',togglePalette);

    // Reader Mode toggle
    document.getElementById('readerToggle').addEventListener('click', ()=>{
      document.body.classList.toggle('reader-mode');
      if(document.body.classList.contains('reader-mode')){localStorage.setItem('readerMode','on');}
      else{localStorage.removeItem('readerMode');}
    });
    if(localStorage.getItem('readerMode')==='on'){document.body.classList.add('reader-mode');}

    // Palette persistence (handled by theme engine) - keep active class in sync
    const savedAccent = localStorage.getItem('site_accent_v1');
    if(savedAccent){
      const el = document.querySelector(`.palette-color[data-accent="${savedAccent}"]`);
      if(el){ document.querySelectorAll('.palette-color').forEach(x=>x.classList.remove('active')); el.classList.add('active'); }
    }

    // Toolbox width slider (affects toolbox grid only)
    const toolboxWidthInput=document.getElementById('toolboxWidth');
    const toolboxWidthValue=document.getElementById('toolboxWidthValue');
    function applyToolboxWidth(px){
      document.getElementById('toolboxList').style.gridTemplateColumns=`repeat(auto-fill,minmax(${px}px,1fr))`;
      toolboxWidthValue.textContent=px+'px';
      localStorage.setItem('toolboxWidth',px);
    }
    toolboxWidthInput.addEventListener('input',e=>applyToolboxWidth(parseInt(e.target.value,10)));
    const savedWidth=localStorage.getItem('toolboxWidth');
    if(savedWidth){toolboxWidthInput.value=savedWidth; applyToolboxWidth(parseInt(savedWidth,10));}

    // Close panels on outside click
    document.addEventListener('click',e=>{
      if(!e.target.closest('.toolbox-panel') && !e.target.closest('#toolboxToggle')){document.getElementById('toolboxPanel').classList.remove('open');}
      if(!e.target.closest('.palette-panel') && !e.target.closest('#paletteToggle')){document.getElementById('palettePanel').classList.remove('open');}
    });

    // Sortable lists
    new Sortable(document.getElementById('gridContainer'),{animation:150});
    new Sortable(document.getElementById('toolboxList'),{animation:150});

    // Init
    renderToolboxPanel();
    loadDashboard();
  </script>
</body>
</html>
```
