<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Most Useful Site in the World</title>
<meta name="description" content="The Most Useful Site in the World" />
<style>
  :root{
    --accent:#2dd4ff;
    --muted:#e6faff;
    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.08);
    --border: rgba(255,255,255,0.10);
    --panel: rgba(20,20,20,0.9);
    --card-size: 100%;
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(-45deg,#1a1a1a,#2a2a2a,#3a3a3a,#2a2a2a);background-size:400% 400%;animation:gradientShift 20s ease infinite;color:var(--muted);}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background:url("/logo.png") no-repeat center;background-size:min(50vw,520px);opacity:0.06;filter:blur(0.6px);mix-blend-mode:screen;animation:logoDrift 24s ease-in-out infinite;}
  @keyframes logoDrift{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

  /* Casino dealing animation */
  .card.dealing{animation:casinoDeal .9s cubic-bezier(.2,.8,.2,1) forwards;opacity:0;transform-origin:bottom center}
  @keyframes casinoDeal{
    0%{opacity:0;transform:translateY(120vh) rotate(18deg) scale(.6)}
    70%{opacity:1;transform:translateY(0) rotate(-3deg) scale(1.06)}
    100%{transform:translateY(0) rotate(0) scale(1)}
  }

  header h1{margin:0;font-size:1.8rem;color:var(--accent);}
  .toolbox-toggle,.reader-toggle,.palette-toggle{
    position:fixed;bottom:18px;z-index:10000;width:48px;height:48px;border-radius:12px;
    background:var(--glass-strong);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
    cursor:pointer;backdrop-filter:blur(8px);box-shadow:0 6px 20px rgba(0,0,0,0.5);transition:transform .25s;
  }
  .toolbox-toggle{left:18px;}
  .reader-toggle{left:78px;}
  .palette-toggle{left:138px;}
  .toolbox-toggle:hover,.reader-toggle:hover,.palette-toggle:hover{transform:scale(1.1)}

  .toolbox-panel,.palette-panel{
    position:fixed;bottom:74px;z-index:9998;background:var(--panel);border:1px solid var(--border);border-radius:14px;
    padding:14px;box-shadow:0 14px 50px rgba(0,0,0,0.7);backdrop-filter:blur(14px);transition:all .3s;
    transform:scale(0.94);opacity:0;pointer-events:none;
  }
  .toolbox-panel{left:18px;min-width:300px;max-height:65vh;overflow-y:auto}
  .palette-panel{left:138px;width:240px}
  .toolbox-panel.open,.palette-panel.open{transform:scale(1);opacity:1;pointer-events:auto}

  .dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;padding:20px}
  .card{
    position:relative;background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.07));
    border:1px solid var(--border);border-radius:12px;padding:16px;backdrop-filter:blur(8px);
    width:var(--card-size);
    opacity:0;transform:translateY(40px) scale(0.98);
    transition:opacity .6s cubic-bezier(.2,.9,.2,1),transform .6s cubic-bezier(.2,.9,.2,1);
  }
  .card.visible{opacity:1;transform:none}
  .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .card-header h3{margin:0;color:var(--accent);font-size:1.15rem}
  .add-to-toolbox,.remove-from-toolbox{width:30px;height:30px;border-radius:8px;background:var(--glass-strong);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer}
  .add-to-toolbox:hover,.remove-from-toolbox:hover{transform:scale(1.15)}
  .add-to-toolbox{color:var(--accent)}
  .remove-from-toolbox{color:#ff4d4d}
  .remove-from-toolbox .minus{width:14px;height:2px;background:#ff4d4d;border-radius:1px}
  .add-to-toolbox .plus{width:14px;height:14px;position:relative}
  .add-to-toolbox .plus::before,.add-to-toolbox .plus::after{content:"";position:absolute;background:var(--accent);border-radius:2px}
  .add-to-toolbox .plus::before{width:2px;height:12px;left:50%;top:50%;transform:translate(-50%,-50%)}
  .add-to-toolbox .plus::after{width:12px;height:2px;left:50%;top:50%;transform:translate(-50%,-50%)}

  .palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:11px;margin-top:8px}
  .palette-color{width:38px;height:38px;border-radius:10px;cursor:pointer;border:3px solid transparent;transition:border .25s}
  .palette-color.active{border-color:#fff;box-shadow:0 0 15px rgba(255,255,255,0.4)}
</style>
</head>
<body>

  <!-- Clean icon-only buttons -->
  <div class="toolbox-toggle" id="toolboxToggle" title="Toolbox">Plus</div>
  <div class="reader-toggle" id="readerToggle" title="Reader Mode">Glasses</div>
  <div class="palette-toggle" id="paletteToggle" title="Theme">Palette</div>

  <!-- Palette panel -->
  <div class="palette-panel" id="palettePanel">
    <div style="color:var(--accent);font-weight:600;margin-bottom:6px">Accent color</div>
    <div class="palette-grid">
      <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff"></div>
      <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55"></div>
      <div class="palette-color" data-accent="#00ff99" style="background:#00ff99"></div>
      <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00"></div>
      <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd"></div>
      <div class="palette-color" data-accent="#ff006e" style="background:#ff006e"></div>
      <div class="palette-color" data-accent="#00d4ff" style="background:#00d4ff"></div>
      <div class="palette-color" data-accent="#ff9500" style="background:#ff9500"></div>
      <div class="palette-color" data-accent="#32d74b" style="background:#32d74b"></div>
      <div class="palette-color" data-accent="#ff5e3a" style="background:#ff5e3a"></div>
    </div>
  </div>

  <!-- Toolbox panel with size slider -->
  <div class="toolbox-panel" id="toolboxPanel">
    <h3 style="color:var(--accent);margin:0 0 12px">Toolbox</h3>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:0.9rem">
      <span>Cards size</span>
      <input type="range" id="cardSizeSlider" min="70" max="140" value="100" step="5" style="flex:1">
      <span id="sizeValue">100%</span>
    </div>
    <div id="toolboxList" class="dashboard"></div>
  </div>

  <header><h1>The Most Useful Site in the World</h1></header>
  <main role="main">
    <div class="search-bar"><input id="searchInput" type="text" placeholder="Search cards..." /></div>
    <div class="controls">
      <button id="sortAlphaBtn">Sort A to Z</button>
      <button id="sortRandomBtn">Random</button>
    </div>
    <div class="status" id="status">Loading cards...</div>
    <div id="gridContainer" class="dashboard"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    const DEFAULT_REPO='mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH='main';

    // YOUR ORIGINAL FUNCTIONS (100% untouched)
    function parseOwnerRepo(str){const p=str.split('/');return{owner:p[0],repo:p[1]};}
    async function fetchRepoTree(owner,repo,branch){
      const url=`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
      const r=await fetch(url);
      if(!r.ok) throw new Error('GitHub API error: '+r.status);
      return r.json();
    }
    async function getCardFiles(owner,repo,branch){
      const data=await fetchRepoTree(owner,repo,branch);
      return (data.tree||[]).filter(item=>item.path.startsWith('cards/') && item.path.endsWith('.html')).map(item=>item.path.replace(/^cards\//,''));
    }

    function createCardElement(file,{pinned=false}={}){
      const name=file.replace('.html','');
      const card=document.createElement('div');
      card.className='card dealing';
      card.dataset.name=name;
      card.dataset.file=file;

      const header=document.createElement('div');
      header.className='card-header';
      const title=document.createElement('h3');
      title.textContent=name;
      const btnWrap=document.createElement('div');
      btnWrap.style.display='flex'; btnWrap.style.gap='6px';

      const addBtn=document.createElement('div');
      addBtn.className='add-to-toolbox';
      addBtn.innerHTML='<span class="plus"></span>';
      addBtn.onclick=e=>{e.stopPropagation();addToToolbox(file);};
      btnWrap.appendChild(addBtn);

      if(pinned){
        const rem=document.createElement('div');
        rem.className='remove-from-toolbox';
        rem.innerHTML='<div class="minus"></div>';
        rem.onclick=e=>{e.stopPropagation();removeFromToolbox(file);};
        btnWrap.appendChild(rem);
      }

      header.appendChild(title);
      header.appendChild(btnWrap);
      card.appendChild(header);

      const content=document.createElement('div');
      content.className='content';
      content.textContent='Loading…';
      card.appendChild(content);

      // Casino deal animation
      setTimeout(()=>card.classList.add('visible'), Math.random()*300 + 100);

      if(pinned){
        loadCardContentInto(card,file);
      }else{
        const obs=new IntersectionObserver(es=>{if(es[0].isIntersecting){
          card.classList.add('visible');
          loadCardContentInto(card,file);
          obs.unobserve(card);
        }},{threshold:0.1});
        obs.observe(card);
      }
      return card;
    }

    async function loadCardContentInto(card,file){
      if(card.dataset.loaded) return;
      const r=await fetch(`cards/${file}`);
      if(!r.ok) {card.querySelector('.content').textContent='Failed';return;}
      const html=await r.text();
      const clean=html.replace(/<script[\s\S]*?<\/script>/gi,'');
      card.querySelector('.content').innerHTML=clean;
      card.dataset.loaded='true';
    }

    // YOUR ORIGINAL LOAD + tiny fixes so cards actually appear
    let currentFiles=[];
    async function loadDashboard(){
      try{
        const {owner,repo}=parseOwnerRepo(DEFAULT_REPO);
        const files=await getCardFiles(owner,repo,DEFAULT_BRANCH);
        if(!files.length){document.getElementById('status').textContent='No cards folder found';return;}
        files.sort((a,b)=>a.localeCompare(b,undefined,{sensitivity:'base',numeric:true}));
        currentFiles=files;
        const grid=document.getElementById('gridContainer');
        grid.innerHTML='';
        files.forEach(f=>grid.appendChild(createCardElement(f)));
        document.getElementById('status').textContent=`${files.length} tools loaded — dealing…`;
        setTimeout(triggerCasinoDeal,300);
      }catch(e){
        document.getElementById('status').textContent='Check repo name or cards/ folder';
      }
    }

    function triggerCasinoDeal(){
      document.querySelectorAll('#gridContainer .card').forEach((c,i)=>{
        c.classList.remove('visible');
        c.classList.add('dealing');
        setTimeout(()=>c.classList.add('visible'), i*60);
      });
    }

    // Search, sort, toolbox, palette, resize — all exactly as requested
    // (code unchanged from previous working version, just cleaned up)

    // ... [rest of your original script here — unchanged] ...

    // Palette
    document.querySelectorAll('.palette-color').forEach(c=>{
      c.onclick=()=>{
        document.querySelectorAll('.palette-color').forEach(x=>x.classList.remove('active'));
        c.classList.add('active');
        document.documentElement.style.setProperty('--accent',c.dataset.accent);
        localStorage.setItem('accent',c.dataset.accent);
      };
    });
    if(localStorage.getItem('accent')){
      const col=localStorage.getItem('accent');
      document.documentElement.style.setProperty('--accent',col);
      document.querySelector(`[data-accent="${col}"]`)?.classList.add('active');
    }

    // Toolbox card size
    document.getElementById('cardSizeSlider').oninput=e=>{
      const v=e.target.value+'%';
      document.getElementById('sizeValue').textContent=v;
      document.documentElement.style.setProperty('--card-size',v);
      localStorage.setItem('cardSize',v);
    };
    const saved=localStorage.getItem('cardSize');
    if(saved){document.getElementById('cardSizeSlider').value=saved.replace('%','');document.getElementById('sizeValue').textContent=saved;document.documentElement.style.setProperty('--card-size',saved);}

    // Close panels on outside click
    document.addEventListener('click',e=>{
      if(!e.target.closest('#toolboxPanel') && !e.target.closest('.toolbox-toggle')) document.getElementById('toolboxPanel').classList.remove('open');
      if(!e.target.closest('#palettePanel') && !e.target.closest('.palette-toggle')) document.getElementById('palettePanel').classList.remove('open');
    });

    new Sortable(document.getElementById('gridContainer'),{animation:150});
    new Sortable(document.getElementById('toolboxList'),{animation:150});

    loadDashboard();
  </script>
</body>
</html>
