<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Most Useful Site in the World</title>
<style>
  :root{
    --accent:#2dd4ff;            /* always starts on original cyan */
    --muted:#e6faff;
    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.09);
    --border: rgba(255,255,255,0.11);
    --panel: rgba(20,20,20,0.92);
    --card-size: 100%;
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(-45deg,#1a1a1a,#2a2a2a,#3a3a3a,#2a2a2a);background-size:400% 400%;animation:g 20s ease infinite;color:var(--muted);}
  @keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background:url("/logo.png") center/ min(50vw,520px) no-repeat;opacity:0.06;filter:blur(0.6px);mix-blend-mode:screen;animation:l 24s ease-in-out infinite;}
  @keyframes l{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

  /* Casino deal — subtle & mythic */
  .card.dealing{animation:deal .88s cubic-bezier(.2,.8,.2,1) forwards;opacity:0;transform-origin:bottom}
  @keyframes deal{
    0%{opacity:0;transform:translateY(130vh) rotate(20deg) scale(0.5)}
    70%{opacity:1;transform:translateY(0) rotate(-2deg) scale(1.04)}
    100%{transform:translateY(0) rotate(0) scale(1)}
  }

  header h1{margin:0;font-size:1.8rem;color:var(--accent);text-align:center;padding:28px 20px 10px}

  /* Bottom-left beautiful picture buttons */
  .fab{
    position:fixed;bottom:18px;width:52px;height:52px;border-radius:14px;background:var(--glass-strong);
    border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;
    backdrop-filter:blur(10px);box-shadow:0 8px 25px rgba(0,0,0,0.5);transition:transform .25s,box-shadow .25s;z-index:10000;
  }
  .fab:hover{transform:scale(1.12);box-shadow:0 12px 35px rgba(0,0,0,0.6)}
  #toolboxToggle{left:18px;}
  #readerToggle{left:82px;}
  #paletteToggle{left:146px;}

  .toolbox-panel,.palette-panel{
    position:fixed;bottom:78px;z-index:9999;background:var(--panel);border:1px solid var(--border);border-radius:16px;
    padding:16px;box-shadow:0 16px 60px rgba(0,0,0,0.7);backdrop-filter:blur(16px);transition:all .3s cubic;
    transform:scale(0.93) translateY(10px);opacity:0;pointer-events:none;
  }
  .toolbox-panel.open,.palette-panel.open{transform:scale(1) translateY(0);opacity:1;pointer-events:auto}
  .toolbox-panel{left:18px;min-width:320px;max-height:68vh;overflow-y:auto}
  .palette-panel{left:146px;width:256px}

  .dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:26px;padding:20px 24px}
  .card{
    background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.08));
    border:1px solid var(--border);border-radius:14px;padding:18px;backdrop-filter:blur(10px);
    width:var(--card-size);opacity:0;transform:translateY(30px);
    transition:opacity .7s ease,transform .7s ease,width .4s,height .4s;
  }
  .card.visible{opacity:1;transform:none}

  .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .card-header h3{margin:0;color:var(--accent);font-size:1.18rem}
  .add-to-toolbox,.remove-from-toolbox{width:32px;height:32px;border-radius:9px;background:var(--glass-strong);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.25s}
  .add-to-toolbox:hover,.remove-from-toolbox:hover{transform:scale(1.18)}
  .add-to-toolbox{color:var(--accent)}
  .remove-from-toolbox{color:#ff4d4d}

  .palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:10px}
  .palette-color{width:40px;height:40px;border-radius:12px;cursor:pointer;border:3px solid transparent;transition:.25s;box-shadow:0 4px 12px rgba(0,0,0,0.4)}
  }
  .palette-color.active{border-color:#fff;box-shadow:0 0 20px rgba(255,255,255,0.5)}
</style>
</head>
<body>

  <!-- Pretty picture buttons -->
  <div class="fab" id="toolboxToggle" title="Toolbox"><span style="font-size:26px">Plus</div>
  <div class="fab" id="readerToggle" title="Reader Mode"><span style="font-size:24px">Glasses</div>
  <div class="fab" id="paletteToggle" title="Change Theme"><span style="font-size:24px">Palette</div>

  <!-- Palette panel — only high-contrast, readable accents -->
  <div class="palette-panel" id="palettePanel">
    <div style="color:var(--accent);font-weight:700;margin-bottom:8px">Theme</div>
    <div class="palette-grid">
      <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff"></div>   <!-- original cyan -->
      <div class="palette-color" data-accent="#00e0ff" style="background:#00e0ff"></div>       <!-- bright cyan
      <div class="palette-color" data-accent="#ff3b8f" style="background:#ff3b8f"></div>       hot pink
      <div class="palette-color" data-accent="#ff9500" style="background:#ff9500"></div>       vivid orange
      <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00"></div>       warm yellow
      <div class="palette-color" data-accent="#32d74b" style="background:#32d74b"></div>       apple green
      <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55"></div>       ferrari red
      <div class="palette-color" data-accent="#a0ff4d" style="background:#a0ff4d"></div>       lime
      <div class="palette-color" data-accent="#ff6bcb" style="background:#ff6bcb"></div>       barbie pink
      <div class="palette-color" data-accent="#00f2ff" style="background:#00f2ff"></div>       electric blue
    </div>
  </div>

  <!-- Toolbox with size slider -->
  <div class="toolbox-panel" id="toolboxPanel">
    <h3 style="color:var(--accent);margin:0 0 14px">Toolbox</h3>
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:14px;font-size:0.94rem">
      <span>Cards size</span>
      <input type="range" id="cardSizeSlider" min="70" max="140" value="100" step="5" style="flex:1">
      <span id="sizeValue">100%</span>
    </div>
    <div id="toolboxList" class="dashboard" style="gap:20px"></div>
  </div>

  <header><h1>The Most Useful Site in the World</h1></header>
  <main>
    <div class="search-bar" style="max-width:840px;margin:14px auto 16px;display:flex;background:var(--glass);border-radius:14px;padding:14px 18px;border:1px solid var(--border)">
      <input id="searchInput" type="text" placeholder="Search all tools…" style="flex:1;background:none;border:none;outline:none;color:var(--muted);font-size:1rem"/>
    </div>
    <div style="text-align:center;margin-bottom:20px">
      <button id="sortAlphaBtn" style="margin:0 8px;padding:10px 16px;border-radius:12px;background:transparent;border:1px solid var(--border);color:var(--muted);cursor:pointer">A to Z</button>
      <button id="sortRandomBtn" style="margin:0 8px;padding:10px 16px;border-radius:12px;background:transparent;border:1px solid var(--border);color:var(--muted);cursor:pointer">Random</button>
    </div>
    <div id="status" style="text-align:center;color:rgba(230,250,255,0.7);margin:10px 0 20px">Loading cards…</div>
    <div id="gridContainer" class="dashboard"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    const DEFAULT_REPO='mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH='main';
    let currentFiles=[];

    async function fetchRepoTree(o,r,b){
      const res=await fetch(`https://api.github.com/repos/${o}/${r}/git/trees/${b}?recursive=1`);
      if(!res.ok) throw '';
      return (await res.json()).tree;
    }
    async function getCardFiles(){
      const tree=await fetchRepoTree(...DEFAULT_REPO.split('/'),DEFAULT_BRANCH);
      return tree.filter(i=>i.path.startsWith('cards/')&&i.path.endsWith('.html')).map(i=>i.path.slice(6));
    }

    function createCardElement(file,{pinned=false}={}){
      const name=file.slice(0,-5);
      const card=document.createElement('div');
      card.className='card dealing';
      card.dataset.name=name;
      card.dataset.file=file;

      card.innerHTML=`
        <div class="card-header">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3>${name.replace(/-/g,' ')}</h3>
            <div style="display:flex;gap:8px">
              <div class="add-to-toolbox" onclick="addToToolbox('${file}')"><span class="plus"></span></div>
              ${pinned ? `<div class="remove-from-toolbox" onclick="removeFromToolbox('${file}')"><div class="minus"></div></div>` : ''}
            </div>
          </div>
          <div class="content">Loading…</div>
        </div>`;

      setTimeout(()=>card.classList.add('visible'), Math.random()*280 + 80);
      if(!pinned){
        new IntersectionObserver((e)=>{if(e[0].isIntersecting){load(card,file);o.unobserve(card)}},{threshold:0.1}).observe(card);
      }else load(card,file);
      return card;
    }

    async function load(card,file){
      if(card.dataset.loaded) return;
      const r=await fetch('cards/'+file);
      if(!r.ok){card.querySelector('.content').textContent='Not found';return;}
      let html=await r.text();
      html=html.replace(/<script[\s\S]*?<\/script>/gi,'');
      card.querySelector('.content').innerHTML=html;
      card.dataset.loaded='true';
    }

    async function loadDashboard(){
      try{
        const files=await getCardFiles();
        currentFiles=files.sort((a,b)=>a.localeCompare(b));
        const grid=document.getElementById('gridContainer');
        grid.innerHTML='';
        currentFiles.forEach(f=>grid.appendChild(createCardElement(f)));
        document.getElementById('status').textContent=`${files.length} tools ready — dealing the deck…`;
      }catch{ document.getElementById('status').textContent='Check repo URL or cards/ folder'; }
    }

    // Toolbox
    const TK='toolbox_v1';
    let toolbox=JSON.parse(localStorage.getItem(TK)||'[]');
    function save(){localStorage.setItem(TK,JSON.stringify(toolbox))}
    function addToToolbox(f){if(!toolbox.includes(f))toolbox.unshift(f);if(toolbox.length>80)toolbox.pop();save();renderToolbox();}
    function removeFromToolbox(f){toolbox=toolbox.filter(x=>x!==f);save();renderToolbox();}
    function renderToolbox(){
      const list=document.getElementById('toolboxList');
      list.innerHTML='';
      toolbox.forEach(f=>list.appendChild(createCardElement(f,{pinned:true})));
    }

    // Palette — only high-readability colours + starts on original
    document.querySelectorAll('.palette-color').forEach(c=>{
      c.onclick=()=>{
        document.querySelectorAll('.palette-color').forEach(x=>x.classList.remove('active'));
        c.classList.add('active');
        document.documentElement.style.setProperty('--accent',c.dataset.accent);
        localStorage.setItem('accent',c.dataset.accent);
      };
    });
    const savedAccent=localStorage.getItem('accent');
    if(savedAccent){
      document.documentElement.style.setProperty('--accent',savedAccent);
      document.querySelector(`[data-accent="${savedAccent}"]`)?.classList.add('active');
    } // otherwise stays #2dd4ff

    // Card size slider (toolbox only)
    document.getElementById('cardSizeSlider').oninput=e=>{
      const v=e.target.value+'%';
      document.getElementById('sizeValue').textContent=v;
      document.documentElement.style.setProperty('--card-size',v);
      localStorage.setItem('cardSize',v);
    };
    const sz=localStorage.getItem('cardSize');
    if(sz){document.getElementById('cardSizeSlider').value=sz.slice(0,-1);document.getElementById('sizeValue').textContent=sz;document.documentElement.style.setProperty('--card-size',sz);}

    // Panel toggles
    document.getElementById('toolboxToggle').onclick()=>document.getElementById('toolboxPanel').classList.toggle('open');
    document.getElementById('paletteToggle').onclick()=>document.getElementById('palettePanel').classList.toggle('open');
    document.getElementById('readerToggle').onclick()=>{document.body.classList.toggle('reader-mode');localStorage.setItem('reader',document.body.classList.contains('reader-mode')?'1':'')};
    if(localStorage.getItem('reader')==='1') document.body.classList.add('reader-mode');

    // Close on outside click
    document.addEventListener('click',e=>{
      if(!e.target.closest('#toolboxPanel')&&!e.target.closest('#toolboxToggle')) document.getElementById('toolboxPanel').classList.remove('open');
      if(!e.target.closest('#palettePanel')&&!e.target.closest('#paletteToggle')) document.getElementById('palettePanel').classList.remove('open');
    });

    new Sortable(document.getElementById('gridContainer'),{animation:160});
    new Sortable(document.getElementById('toolboxList'),{animation:160});

    renderToolbox();
    loadDashboard();
  </script>
</body>
</html>
