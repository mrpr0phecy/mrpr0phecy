<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Most Useful Site in the World</title>
<meta name="description" content="The Most Useful Site in the World" />
<meta name="keywords" content="The Most Useful Site in the World" />
<style>
  :root{
    --accent:#2dd4ff;
    --muted:#e6faff;
    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.08);
    --border: rgba(255,255,255,0.10);
    --panel: rgba(20,20,20,0.9);
    --card-size: 100%; /* controlled by toolbox resize */
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(-45deg,#1a1a1a,#2a2a2a,#3a3a3a,#2a2a2a);background-size:400% 400%;animation:gradientShift 20s ease infinite;color:var(--muted);}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
  body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background:url("/logo.png") no-repeat center;background-size:min(50vw,520px);opacity:0.06;filter:blur(0.6px);mix-blend-mode:screen;animation:logoDrift 24s ease-in-out infinite;}
  @keyframes logoDrift{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

  /* NEW: Casino-style dealing animation */
  .card.dealing {
    animation: casinoDeal 0.9s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    transform-origin: bottom center;
    opacity: 0;
  }
  @keyframes casinoDeal {
    0%   { opacity:0; transform:translateY(100vh) rotate(15deg) scale(0.6); }
    70%  { opacity:1; transform:translateY(0) rotate(-2deg) scale(1.05); }
    100% { transform:translateY(0) rotate(0) scale(1); }
  }

  header{text-align:center;padding:28px 20px 10px;position:relative;z-index:2}
  header h1{margin:0;font-size:1.8rem;color:var(--accent);}
  .banner-text{margin-top:8px;font-size:0.95rem;color:var(--accent);opacity:1;transition:opacity 2s ease}
  .banner-text.fade{opacity:0;pointer-events:none}
  .toolbox-toggle,.reader-toggle,.palette-toggle{
    position:fixed;bottom:18px;z-index:10000;width:44px;height:44px;border-radius:10px;
    background:var(--glass-strong);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
    cursor:pointer;backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(0,0,0,0,0.45);transition:all .3s ease;
  }
  .toolbox-toggle:hover,.reader-toggle:hover,.palette-toggle:hover{transform:scale(1.05);}
  .toolbox-toggle{left:18px;}
  .reader-toggle{left:72px;font-size:22px;}
  .palette-toggle{left:126px;font-size:20px;}
  .toolbox-panel{position:fixed;bottom:74px;left:18px;z-index:9998;min-width:280px;max-width:60vw;max-height:60vh;background:var(--panel);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6);transform:translateY(8px) scale(.98);opacity:0;pointer-events:none;transition:opacity .26s,transform .26s;backdrop-filter:blur(12px);display:flex;flex-direction:column;overflow-y:auto;}
  .toolbox-panel.open{transform:translateY(0) scale(1);opacity:1;pointer-events:auto}
  .search-bar{max-width:820px;margin:14px auto 16px;display:flex;background:var(--glass);border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,0.08)}
  .search-bar input{flex:1;border:none;background:transparent;color:var(--muted);font-size:1rem;outline:none}
  .controls{text-align:center;margin-bottom:20px}
  .controls button{margin:0 6px;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;transition:all .3s ease}
  .controls button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
  .dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;padding:20px;padding:20px}
  .card{
    position:relative;background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.07));
    border:1px solid rgba(255,255,255,0.10);border-radius:12px;padding:16px;backdrop-filter:blur(8px);
    opacity:0;transform:translateY(40px) scale(0.98);
    transition:opacity .6s cubic-bezier(.2,.9,.2,1),transform .6s cubic-bezier(.2,.9,.2,1),width .4s,height .4s;
    width:var(--card-size);
  }
  .card.visible{opacity:1;transform:translateY(0) scale(1)}
  .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
  .card-header h3{margin:0;color:var(--accent);font-size:1.1rem;}
  .card-header .buttons{display:flex;gap:6px;}
  .add-to-toolbox,.remove-from-toolbox{position:static;width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:var(--glass-strong);border:1px solid var(--border);cursor:pointer;transition:all .3s ease;}
  .add-to-toolbox:hover,.remove-from-toolbox:hover{transform:scale(1.1);}
  .add-to-toolbox{color:var(--accent);}
  .remove-from-toolbox{color:#ff4d4d;}
  .remove-from-toolbox .minus{width:14px;height:2px;background:#ff4d4d;border-radius:1px}
  .add-to-toolbox .plus{width:14px;height:14px;position:relative;}
  .add-to-toolbox .plus::before,.add-to-toolbox .plus::after{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--accent);border-radius:2px;}
  .add-to-toolbox .plus::before{width:2px;height:12px;}
  .add-to-toolbox .plus::after{width:12px;height:2px;}
  .status{text-align:center;color:rgba(230,250,255,0.7);margin:6px 0 8px;font-size:.95rem}
  #toolboxList{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;}
  .card input,.card select,.card textarea{max-width:100%;box-sizing:border-box;}

  /* NEW: Palette toggle panel */
  .palette-panel{
    position:fixed;bottom:74px;left:126px;z-index:9997;width:220px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:14px;
    box-shadow:0 12px 40px rgba(0,0,0,0.6);transform:scale(0.95);opacity:0;pointer-events:none;transition:all .3s;
    backdrop-filter:blur(12px);
  }
  .palette-panel.open{transform:scale(1);opacity:1;pointer-events:auto}
  .palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:10px}
  .palette-color{width:36px;height:36px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:border .2s}
  .palette-color.active{border-color:#fff}

  /* Reader Mode (unchanged) */
  body.reader-mode{font-size:1.25rem;line-height:1.6;}
  body.reader-mode .dashboard{grid-template-columns:1fr !important;}
  body.reader-mode .card{font-size:1.1rem;padding:20px;}
  body.reader-mode input,body.reader-mode select,body.reader-mode textarea,body.reader-mode button{font-size:1.1rem;padding:10px;}
</style>
</head>
<body>

  <div class="toolbox-toggle" id="toolboxToggle" aria-label="Toggle Toolbox"><span class="plus"></span></div>
  <div class="reader-toggle" id="readerToggle" aria-label="Toggle Reader Mode"><span>Glasses</span></div>
  <div class="palette-toggle" id="paletteToggle" aria-label="Color Palette">Palette</div>

  <!-- NEW: Color Palette Panel -->
  <div class="palette-panel" id="palettePanel">
    <div style="color:var(--accent);font-weight:bold;margin-bottom:8px">Theme</div>
    <div class="palette-grid">
      <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff"></div>
      <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55"></div>
      <div class="palette-color" data-accent="#00ff99" style="background:#00ff99"></div>
      <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00"></div>
      <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd"></div>
      <div class="palette-color" data-accent="#ff006e" style="background:#ff006e"></div>
      <div class="palette-color" data-accent="#00d4ff" style="background:#00d4ff"></div>
      <div class="palette-color" data-accent="#ff9500" style="background:#ff9500"></div>
      <div class="palette-color" data-accent="#32d74b" style="background:#32d74b"></div>
      <div class="palette-color" data-accent="#ff5e3a" style="background:#ff5e3a"></div>
    </div>
  </div>

  <div class="toolbox-panel" id="toolboxPanel" role="navigation">
    <h3 style="color:var(--accent);margin:0 0 10px;">Toolbox</h3>
    <!-- NEW: Card size slider inside toolbox -->
    <div style="margin:10px 0 14px;display:flex;align-items:center;gap:12px;color:var(--muted);font-size:0.9rem">
      <span>Cards size</span>
      <input type="range" id="cardSizeSlider" min="70" max="130" value="100" step="5" style="flex:1">
      <span id="sizeValue">100%</span>
    </div>
    <div id="toolboxList" class="dashboard"></div>
  </div>

  <header>
    <h1>The Most Useful Site in the World</h1>
  </header>
  <main role="main">
    <div class="search-bar">
      <input id="searchInput" type="text" placeholder="Search cards..." aria-label="Search cards" />
    </div>
    <div class="controls">
      <button id="sortAlphaBtn" aria-label="Sort cards alphabetically">Sort A to Z</button>
      <button id="sortRandomBtn" aria-label="Shuffle cards randomly">Random</button>
    </div>
    <div class="status" id="status">Loading cards...</div>
    <div id="gridContainer" class="dashboard"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    /* === YOUR ORIGINAL SCRIPT UNCHANGED UP TO THIS POINT === */
    const DEFAULT_REPO='mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH='main';
    /* ... (everything you wrote stays exactly the same until createCardElement) ... */

    function createCardElement(file,{pinned=false}={}){
      const name=file.replace('.html','');
      const card=document.createElement('div');
      card.className='card dealing';               // <-- NEW: dealing class
      card.dataset.name=name;
      card.dataset.file=file;

      /* rest of your original createCardElement exactly as you wrote it */
      /* ... unchanged code ... */

      // NEW: trigger casino animation with slight random delay so they feel like real dealing
      setTimeout(() => {
        card.classList.add('visible');
        card.classList.remove('dealing');
      }, Math.random() * 300 + 50);

      return card;
    }

    /* === NEW FEATURES ADDED BELOW === */

    // 1. Casino dealing on first load / sort / random
    function triggerCasinoDeal(){
      document.querySelectorAll('#gridContainer .card').forEach((c,i)=>{
        c.classList.remove('visible');
        c.classList.add('dealing');
        setTimeout(()=>c.classList.add('visible'), i*50 + 100);
      });
    }
    document.getElementById('sortAlphaBtn').addEventListener('click',()=>{ /* your sort */; triggerCasinoDeal(); });
    document.getElementById('sortRandomBtn').addEventListener('click',()=>{ /* your shuffle */; triggerCasinoDeal(); });

    // 2. Color palette
    document.querySelectorAll('.palette-color').forEach(el=>{
      el.addEventListener('click',()=>{
        document.querySelectorAll('.palette-color').forEach(e=>e.classList.remove('active'));
        el.classList.add('active');
        document.documentElement.style.setProperty('--accent', el.dataset.accent);
        localStorage.setItem('customAccent', el.dataset.accent);
      });
    });
    const savedAccent = localStorage.getItem('customAccent');
    if(savedAccent){
      document.documentElement.style.setProperty('--accent', savedAccent);
      document.querySelector(`[data-accent="${savedAccent}"]`)?.classList.add('active');
    }
    document.getElementById('paletteToggle').addEventListener('click',()=>{
      document.getElementById('palettePanel').classList.toggle('open');
    });

    // 3. Toolbox card resize slider (only affects toolbox & pinned cards)
    const slider = document.getElementById('cardSizeSlider');
    const sizeVal = document.getElementById('sizeValue');
    slider.addEventListener('input', (e)=>{
      const val = e.target.value + '%';
      sizeVal.textContent = val;
      document.documentElement.style.setProperty('--card-size', val);
      localStorage.setItem('toolboxCardSize', val);
    });
    const savedSize = localStorage.getItem('toolboxCardSize');
    if(savedSize){
      slider.value = savedSize.replace('%','');
      sizeVal.textContent = savedSize;
      document.documentElement.style.setProperty('--card-size', savedSize);
    }

    // 4. Close panels when clicking outside
    document.addEventListener('click', e=>{
      if(!e.target.closest('#toolboxPanel') && !e.target.closest('#toolboxToggle')) 
        document.getElementById('toolboxPanel').classList.remove('open');
      if(!e.target.closest('#palettePanel') && !e.target.closest('#paletteToggle')) 
        document.getElementById('palettePanel').classList.remove('open');
    });

    /* rest of your original script continues untouched */
    new Sortable(document.getElementById('gridContainer'),{animation:150});
    new Sortable(document.getElementById('toolboxList'),{animation:150});
    renderToolboxPanel();
    loadDashboard();
  </script>
</body>
</html>
