<h2 id="metabolicage-title" style="margin-top:0;color:var(--accent);">âš¡ Metabolic Age Estimator</h2>

<form aria-describedby="metabolicage-desc">
  <p id="metabolicage-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Estimate your metabolic age based on your Basal Metabolic Rate (BMR) compared to population averages.
    <span style="color:var(--accent);display:block;margin-top:4px;">ğŸ’¡ Lower metabolic age indicates better metabolic health</span>
  </p>

  <!-- Input Grid -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <!-- Weight -->
    <div style="background:rgba(255,255,255,0.02);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);">
      <label for="metabolicage-weight" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
        âš–ï¸ Weight
      </label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input 
          id="metabolicage-weight" 
          type="number" 
          min="20" 
          max="200" 
          step="0.1"
          value="70"
          style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:16px;text-align:center;"
        />
        <div style="color:rgba(230,250,255,0.7);font-weight:500;">kg</div>
      </div>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <button type="button" onclick="maSetWeight(60)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">60kg</button>
        <button type="button" onclick="maSetWeight(70)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">70kg</button>
        <button type="button" onclick="maSetWeight(80)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">80kg</button>
      </div>
    </div>

    <!-- Height -->
    <div style="background:rgba(255,255,255,0.02);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);">
      <label for="metabolicage-height" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
        ğŸ“ Height
      </label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input 
          id="metabolicage-height" 
          type="number" 
          min="100" 
          max="220" 
          step="0.1"
          value="175"
          style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:16px;text-align:center;"
        />
        <div style="color:rgba(230,250,255,0.7);font-weight:500;">cm</div>
      </div>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <button type="button" onclick="maSetHeight(165)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">165cm</button>
        <button type="button" onclick="maSetHeight(175)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">175cm</button>
        <button type="button" onclick="maSetHeight(185)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">185cm</button>
      </div>
    </div>

    <!-- Age -->
    <div style="background:rgba(255,255,255,0.02);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);">
      <label for="metabolicage-age" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
        ğŸ‚ Chronological Age
      </label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input 
          id="metabolicage-age" 
          type="number" 
          min="18" 
          max="100" 
          value="30"
          style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:16px;text-align:center;"
        />
        <div style="color:rgba(230,250,255,0.7);font-weight:500;">years</div>
      </div>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <button type="button" onclick="maSetAge(25)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">25</button>
        <button type="button" onclick="maSetAge(35)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">35</button>
        <button type="button" onclick="maSetAge(45)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">45</button>
      </div>
    </div>

    <!-- Gender -->
    <div style="background:rgba(255,255,255,0.02);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);">
      <label for="metabolicage-gender" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
        ğŸ‘¤ Gender
      </label>
      <select 
        id="metabolicage-gender" 
        style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;cursor:pointer;"
      >
        <option value="male" selected>ğŸ‘¨ Male</option>
        <option value="female">ğŸ‘© Female</option>
      </select>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <button type="button" onclick="maSetGender('male')" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;flex:1;">Male</button>
        <button type="button" onclick="maSetGender('female')" style="padding:4px 8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;flex:1;">Female</button>
      </div>
    </div>
  </div>

  <!-- Activity Level -->
  <div style="background:rgba(255,255,255,0.02);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <label style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
      ğŸƒ Activity Level (for TDEE)
    </label>
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;">
      <button type="button" onclick="maSetActivity(1.2)" class="ma-activity-btn" data-level="1.2" style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;font-size:13px;text-align:center;">
        ğŸ›Œ Sedentary
      </button>
      <button type="button" onclick="maSetActivity(1.375)" class="ma-activity-btn" data-level="1.375" style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;font-size:13px;text-align:center;">
        ğŸš¶ Light
      </button>
      <button type="button" onclick="maSetActivity(1.55)" class="ma-activity-btn active" data-level="1.55" style="padding:10px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-size:13px;text-align:center;">
        ğŸƒ Moderate
      </button>
      <button type="button" onclick="maSetActivity(1.725)" class="ma-activity-btn" data-level="1.725" style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;font-size:13px;text-align:center;">
        ğŸš´ Active
      </button>
      <button type="button" onclick="maSetActivity(1.9)" class="ma-activity-btn" data-level="1.9" style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;font-size:13px;text-align:center;">
        ğŸ‹ï¸ Very Active
      </button>
    </div>
    <input type="hidden" id="metabolicage-activity" value="1.55" />
  </div>

  <!-- Action Buttons -->
  <div style="display:flex;gap:12px;margin-bottom:20px;">
    <button 
      type="button" 
      onclick="maCalculate(this)"
      style="flex:2;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:16px;"
    >
      âš¡ Calculate Metabolic Age
    </button>
    <button 
      type="button" 
      onclick="maReset(this)"
      style="flex:1;padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;"
    >
      ğŸ”„ Reset
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Main Result Card -->
  <div style="background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:12px;border:1px solid rgba(255,255,255,0.08);padding:24px;margin-bottom:20px;text-align:center;">
    <div style="font-size:14px;color:rgba(230,250,255,0.7);margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">
      Metabolic Age Estimate
    </div>
    <div id="metabolicage-res" style="font-size:48px;font-weight:700;color:var(--accent);margin:12px 0;">
      â€“
    </div>
    <div id="metabolicage-compare" style="font-size:16px;color:rgba(230,250,255,0.9);">
      Compared to chronological age: â€“
    </div>
  </div>

  <!-- Detailed Results Grid -->
  <div id="ma-detailed-results" style="display:none;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
      <!-- BMR Card -->
      <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;border:1px solid rgba(45,212,255,0.1);">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <div style="font-size:20px;">ğŸ”¥</div>
          <div style="font-size:14px;color:var(--accent);font-weight:500;">Basal Metabolic Rate</div>
        </div>
        <div id="ma-bmr" style="font-size:24px;font-weight:600;color:#39ff14;margin:8px 0;">â€“ kcal/day</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.6);">Energy burned at rest</div>
      </div>

      <!-- TDEE Card -->
      <div style="background:rgba(255,204,0,0.05);border-radius:10px;padding:16px;border:1px solid rgba(255,204,0,0.1);">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <div style="font-size:20px;">âš¡</div>
          <div style="font-size:14px;color:#ffcc00;font-weight:500;">Total Daily Energy Expenditure</div>
        </div>
        <div id="ma-tdee" style="font-size:24px;font-weight:600;color:#ffcc00;margin:8px 0;">â€“ kcal/day</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.6);">With activity level</div>
      </div>
    </div>

    <!-- Health Insights -->
    <div style="background:rgba(255,255,255,0.02);border-radius:10px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
      <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:16px;">ğŸ“ˆ Health Insights</h3>
      <div id="ma-insights" style="color:rgba(230,250,255,0.9);font-size:14px;line-height:1.6;">
        Enter your information to get personalized insights.
      </div>
    </div>

    <!-- Age Comparison Chart -->
    <div style="background:rgba(255,255,255,0.02);border-radius:10px;padding:20px;border:1px solid rgba(255,255,255,0.05);">
      <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:16px;">ğŸ“Š Age Comparison</h3>
      <div style="display:flex;align-items:center;gap:12px;height:60px;position:relative;">
        <!-- Chronological Age -->
        <div style="flex:1;text-align:center;">
          <div style="color:rgba(230,250,255,0.7);font-size:12px;margin-bottom:4px;">Chronological</div>
          <div id="ma-chrono-bar" style="height:30px;background:linear-gradient(90deg, rgba(45,212,255,0.3), rgba(45,212,255,0.6));border-radius:6px;transition:width 1s ease;width:0%;"></div>
          <div id="ma-chrono-age" style="color:var(--accent);font-weight:600;margin-top:4px;">â€“</div>
        </div>
        
        <!-- Comparison Arrow -->
        <div style="font-size:24px;color:rgba(230,250,255,0.5);">â†’</div>
        
        <!-- Metabolic Age -->
        <div style="flex:1;text-align:center;">
          <div style="color:rgba(230,250,255,0.7);font-size:12px;margin-bottom:4px;">Metabolic</div>
          <div id="ma-metabolic-bar" style="height:30px;background:linear-gradient(90deg, rgba(57,255,20,0.3), rgba(57,255,20,0.6));border-radius:6px;transition:width 1s ease;width:0%;"></div>
          <div id="ma-metabolic-age" style="color:#39ff14;font-weight:600;margin-top:4px;">â€“</div>
        </div>
      </div>
      <div id="ma-comparison-text" style="text-align:center;margin-top:12px;color:rgba(230,250,255,0.7);font-size:14px;font-weight:500;"></div>
    </div>
  </div>
</div>

<!-- Educational Content -->
<details style="margin-top:20px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.05);overflow:hidden;">
  <summary style="padding:16px;color:var(--accent);font-weight:600;font-size:15px;cursor:pointer;list-style:none;">
    ğŸ“š How Metabolic Age is Calculated
  </summary>
  <div style="padding:16px;border-top:1px solid rgba(255,255,255,0.05);color:rgba(230,250,255,0.9);font-size:14px;line-height:1.6;">
    <p style="margin-top:0;">
      <strong>Basal Metabolic Rate (BMR)</strong> is calculated using the <em>Mifflin-St Jeor Equation</em>, the most accurate formula for BMR estimation:
    </p>
    
    <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:12px;margin:12px 0;border-left:4px solid var(--accent);">
      <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">For Men:</div>
      <div style="font-family:monospace;color:#39ff14;">BMR = (10 Ã— weight) + (6.25 Ã— height) âˆ’ (5 Ã— age) + 5</div>
      
      <div style="color:var(--accent);font-weight:600;margin:12px 0 4px;">For Women:</div>
      <div style="font-family:monospace;color:#39ff14;">BMR = (10 Ã— weight) + (6.25 Ã— height) âˆ’ (5 Ã— age) âˆ’ 161</div>
    </div>
    
    <p>
      <strong>Metabolic Age</strong> is estimated by comparing your calculated BMR to average BMR values for different age groups. A higher BMR relative to your chronological age suggests a "younger" metabolic age.
    </p>
    
    <p>
      <strong>What affects metabolic age?</strong>
    </p>
    <ul style="margin:8px 0;padding-left:20px;">
      <li>Muscle mass (more muscle = higher BMR)</li>
      <li>Body composition (lean tissue burns more calories)</li>
      <li>Hormonal factors (thyroid function, etc.)</li>
      <li>Physical activity level</li>
      <li>Genetics and lifestyle factors</li>
    </ul>
    
    <p style="color:var(--accent);margin-bottom:0;">
      <strong>Note:</strong> This is an estimation tool. For precise metabolic testing, consult with a healthcare professional.
    </p>
  </div>
</details>

<script>
/* metabolic-age-estimator.html
   Enhanced metabolic age calculator with BMR, TDEE, and detailed insights
   Scoped with 'ma' prefix
*/

// Reference data: Average BMR by age and gender (kcal/day)
const maReferenceData = {
  male: {
    "20-29": { min: 1650, avg: 1750, max: 1850 },
    "30-39": { min: 1600, avg: 1700, max: 1800 },
    "40-49": { min: 1550, avg: 1650, max: 1750 },
    "50-59": { min: 1500, avg: 1600, max: 1700 },
    "60+": { min: 1400, avg: 1500, max: 1600 }
  },
  female: {
    "20-29": { min: 1350, avg: 1450, max: 1550 },
    "30-39": { min: 1300, avg: 1400, max: 1500 },
    "40-49": { min: 1250, avg: 1350, max: 1450 },
    "50-59": { min: 1200, avg: 1300, max: 1400 },
    "60+": { min: 1150, avg: 1250, max: 1350 }
  }
};

// Helper functions
function maSetWeight(weight) {
  document.getElementById('metabolicage-weight').value = weight;
}

function maSetHeight(height) {
  document.getElementById('metabolicage-height').value = height;
}

function maSetAge(age) {
  document.getElementById('metabolicage-age').value = age;
}

function maSetGender(gender) {
  document.getElementById('metabolicage-gender').value = gender;
  
  // Update button styles
  document.querySelectorAll('button[onclick^="maSetGender"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = '#e6faff';
  });
  
  const activeBtn = document.querySelector(`button[onclick="maSetGender('${gender}')"]`);
  if (activeBtn) {
    activeBtn.style.background = gender === 'male' 
      ? 'rgba(45,212,255,0.1)' 
      : 'rgba(255,45,85,0.1)';
    activeBtn.style.border = gender === 'male'
      ? '1px solid rgba(45,212,255,0.3)'
      : '1px solid rgba(255,45,85,0.3)';
    activeBtn.style.color = gender === 'male' 
      ? 'var(--accent)' 
      : '#ff2d55';
  }
}

function maSetActivity(level) {
  document.getElementById('metabolicage-activity').value = level;
  
  // Update button styles
  document.querySelectorAll('.ma-activity-btn').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = '#e6faff';
  });
  
  const activeBtn = document.querySelector(`.ma-activity-btn[data-level="${level}"]`);
  if (activeBtn) {
    activeBtn.classList.add('active');
    activeBtn.style.background = 'rgba(45,212,255,0.1)';
    activeBtn.style.border = '2px solid rgba(45,212,255,0.4)';
    activeBtn.style.color = 'var(--accent)';
  }
}

// Calculate BMR using Mifflin-St Jeor
function maCalculateBMR(weight, height, age, gender) {
  if (gender === 'male') {
    return (10 * weight) + (6.25 * height) - (5 * age) + 5;
  } else {
    return (10 * weight) + (6.25 * height) - (5 * age) - 161;
  }
}

// Estimate metabolic age based on BMR comparison
function maEstimateMetabolicAge(bmr, chronologicalAge, gender) {
  // Get age group for reference
  let ageGroup;
  if (chronologicalAge < 30) ageGroup = "20-29";
  else if (chronologicalAge < 40) ageGroup = "30-39";
  else if (chronologicalAge < 50) ageGroup = "40-49";
  else if (chronologicalAge < 60) ageGroup = "50-59";
  else ageGroup = "60+";
  
  const ref = maReferenceData[gender][ageGroup];
  
  // Compare BMR to reference
  if (bmr >= ref.max) {
    // BMR higher than max for age group - younger metabolic age
    return Math.max(20, chronologicalAge - Math.floor((bmr - ref.avg) / 50));
  } else if (bmr <= ref.min) {
    // BMR lower than min for age group - older metabolic age
    return Math.min(80, chronologicalAge + Math.floor((ref.avg - bmr) / 50));
  } else {
    // BMR within normal range - close to chronological age
    const ratio = (bmr - ref.min) / (ref.max - ref.min);
    const adjustment = (ratio - 0.5) * 5; // -2.5 to +2.5 years
    return Math.max(20, Math.min(80, Math.round(chronologicalAge + adjustment)));
  }
}

// Get health insights
function maGetInsights(bmr, metabolicAge, chronologicalAge, tdee) {
  const ageDiff = metabolicAge - chronologicalAge;
  const insights = [];
  
  if (ageDiff < -5) {
    insights.push("ğŸ‰ <strong>Excellent metabolic health!</strong> Your metabolism is functioning at a level much younger than your chronological age.");
    insights.push("ğŸ’ª This typically indicates good muscle mass, efficient metabolism, and healthy lifestyle habits.");
  } else if (ageDiff < 0) {
    insights.push("ğŸ‘ <strong>Good metabolic health!</strong> Your metabolism is slightly younger than your chronological age.");
    insights.push("ğŸƒ Maintain your current exercise routine and healthy eating habits.");
  } else if (ageDiff === 0) {
    insights.push("âœ… <strong>Average metabolic health.</strong> Your metabolism matches your chronological age.");
    insights.push("ğŸ“ˆ Consider strength training to increase muscle mass and boost your metabolism.");
  } else if (ageDiff <= 5) {
    insights.push("âš ï¸ <strong>Slightly older metabolic age.</strong> Consider lifestyle improvements.");
    insights.push("ğŸ¥— Focus on strength training 2-3 times per week and balanced nutrition.");
  } else {
    insights.push("ğŸ”´ <strong>Older metabolic age detected.</strong> Consider consulting with a healthcare professional.");
    insights.push("âš¡ Significant improvements can be made through regular exercise, strength training, and dietary changes.");
  }
  
  // Add calorie recommendations
  if (tdee > 0) {
    insights.push(`ğŸ”¥ Your body burns approximately <strong>${Math.round(tdee)} calories daily</strong> with your current activity level.`);
    
    if (ageDiff > 0) {
      insights.push(`ğŸ’¡ To improve metabolic health, aim for a slight calorie deficit (${Math.round(tdee * 0.85)}-${Math.round(tdee * 0.9)} calories/day) with strength training.`);
    }
  }
  
  return insights;
}

// Main calculation function
function maCalculate(btn) {
  // Get input values
  const weight = parseFloat(document.getElementById('metabolicage-weight').value);
  const height = parseFloat(document.getElementById('metabolicage-height').value);
  const age = parseInt(document.getElementById('metabolicage-age').value);
  const gender = document.getElementById('metabolicage-gender').value;
  const activityLevel = parseFloat(document.getElementById('metabolicage-activity').value);
  
  // Validate inputs
  if (!weight || weight < 20 || weight > 200) {
    alert('Please enter a valid weight between 20-200 kg');
    return;
  }
  if (!height || height < 100 || height > 220) {
    alert('Please enter a valid height between 100-220 cm');
    return;
  }
  if (!age || age < 18 || age > 100) {
    alert('Please enter a valid age between 18-100 years');
    return;
  }
  
  // Calculate BMR
  const bmr = maCalculateBMR(weight, height, age, gender);
  
  // Calculate TDEE
  const tdee = bmr * activityLevel;
  
  // Estimate metabolic age
  const metabolicAge = maEstimateMetabolicAge(bmr, age, gender);
  
  // Update main result
  const resultElement = document.getElementById('metabolicage-res');
  resultElement.textContent = `${metabolicAge} years`;
  
  // Color code based on comparison
  const ageDiff = metabolicAge - age;
  if (ageDiff < -3) {
    resultElement.style.color = '#39ff14'; // Green - younger
  } else if (ageDiff > 3) {
    resultElement.style.color = '#ff2d55'; // Red - older
  } else {
    resultElement.style.color = '#ffcc00'; // Yellow - similar
  }
  
  // Update comparison text
  const compareElement = document.getElementById('metabolicage-compare');
  let compareText = '';
  if (ageDiff < 0) {
    compareText = `ğŸ‰ <span style="color:#39ff14;">${Math.abs(ageDiff)} years YOUNGER</span> than your chronological age`;
  } else if (ageDiff > 0) {
    compareText = `ğŸ“ˆ <span style="color:#ff2d55;">${ageDiff} years OLDER</span> than your chronological age`;
  } else {
    compareText = `âš–ï¸ <span style="color:#ffcc00;">Matches</span> your chronological age`;
  }
  compareElement.innerHTML = `Compared to chronological age: ${compareText}`;
  
  // Update detailed results
  document.getElementById('ma-bmr').textContent = `${Math.round(bmr)} kcal/day`;
  document.getElementById('ma-tdee').textContent = `${Math.round(tdee)} kcal/day`;
  
  // Update insights
  const insights = maGetInsights(bmr, metabolicAge, age, tdee);
  document.getElementById('ma-insights').innerHTML = insights.join('<br><br>');
  
  // Update age comparison chart
  const maxAge = Math.max(age, metabolicAge, 60);
  const chronoPercent = (age / maxAge) * 100;
  const metabolicPercent = (metabolicAge / maxAge) * 100;
  
  document.getElementById('ma-chrono-bar').style.width = `${chronoPercent}%`;
  document.getElementById('ma-metabolic-bar').style.width = `${metabolicPercent}%`;
  document.getElementById('ma-chrono-age').textContent = `${age} years`;
  document.getElementById('ma-metabolic-age').textContent = `${metabolicAge} years`;
  
  // Update comparison text
  document.getElementById('ma-comparison-text').innerHTML = compareText;
  
  // Show detailed results
  document.getElementById('ma-detailed-results').style.display = 'block';
  
  // Animate the result
  btn.textContent = 'âœ… Calculated!';
  setTimeout(() => {
    btn.textContent = 'âš¡ Calculate Metabolic Age';
  }, 1500);
  
  // Scroll to results
  document.querySelector('.results').scrollIntoView({ 
    behavior: 'smooth', 
    block: 'start' 
  });
}

// Reset function
function maReset(btn) {
  // Reset inputs to defaults
  document.getElementById('metabolicage-weight').value = 70;
  document.getElementById('metabolicage-height').value = 175;
  document.getElementById('metabolicage-age').value = 30;
  document.getElementById('metabolicage-gender').value = 'male';
  document.getElementById('metabolicage-activity').value = '1.55';
  
  // Reset button styles
  maSetGender('male');
  maSetActivity(1.55);
  
  // Reset results
  document.getElementById('metabolicage-res').textContent = 'â€“';
  document.getElementById('metabolicage-res').style.color = 'var(--accent)';
  document.getElementById('metabolicage-compare').textContent = 'Compared to chronological age: â€“';
  document.getElementById('ma-detailed-results').style.display = 'none';
  
  // Reset chart
  document.getElementById('ma-chrono-bar').style.width = '0%';
  document.getElementById('ma-metabolic-bar').style.width = '0%';
  document.getElementById('ma-chrono-age').textContent = 'â€“';
  document.getElementById('ma-metabolic-age').textContent = 'â€“';
  
  // Visual feedback
  btn.textContent = 'âœ… Reset!';
  setTimeout(() => {
    btn.textContent = 'ğŸ”„ Reset';
  }, 1000);
  
  // Focus on first input
  document.getElementById('metabolicage-weight').focus();
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
  // Set initial button styles
  maSetGender('male');
  maSetActivity(1.55);
  
  // Auto-calculate on Enter in any input
  const inputs = document.querySelectorAll('input[type="number"], select');
  inputs.forEach(input => {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        maCalculate(document.querySelector('button[onclick="maCalculate(this)"]'));
      }
    });
  });
  
  console.log('Metabolic Age Estimator loaded');
});
</script>

<style>
/* Card-specific styles */
#metabolicage-title {
  background: linear-gradient(135deg, var(--accent), #39ff14);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

/* Animations */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.ma-activity-btn.active {
  animation: pulse 2s infinite;
}

#ma-detailed-results {
  animation: slideUp 0.5s ease-out;
}

/* Input focus effects */
input:focus, select:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(45,212,255,0.3);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  
  #metabolicage-res {
    font-size: 36px !important;
  }
  
  .detailed-results-grid {
    grid-template-columns: 1fr !important;
  }
}

/* Print styles */
@media print {
  button, details {
    display: none !important;
  }
  
  #ma-detailed-results {
    display: block !important;
  }
}
</style>
