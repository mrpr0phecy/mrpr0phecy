<h2 id="song-writer-title" style="margin-top:0;color:var(--accent);">ğŸµ Song Writer (General Advice)</h2>

<form aria-describedby="sw-desc">
  <p id="sw-desc" class="small" style="color:var(--muted);margin-bottom:16px;">
    Brainstorm song ideas, lyrics, and structure. 
    <span style="color:#ffcc00;">âš ï¸ Educational only â€” always verify with a teacher or professional resource.</span>
  </p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
    <div>
      <label for="sw-theme" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Theme</label>
      <input id="sw-theme" type="text" placeholder="e.g. Love, Journey, Freedom" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>

    <div>
      <label for="sw-style" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Music Style</label>
      <select id="sw-style" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;">
        <option value="pop" selected>ğŸ¤ Pop</option>
        <option value="rock">ğŸ¸ Rock</option>
        <option value="folk">ğŸŒ¿ Folk</option>
        <option value="jazz">ğŸ· Jazz</option>
        <option value="hiphop">ğŸ¤ Hip-Hop</option>
        <option value="country">ğŸ¤  Country</option>
        <option value="electronic">ğŸ›ï¸ Electronic</option>
        <option value="r&b">ğŸ¶ R&B/Soul</option>
      </select>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
    <div>
      <label for="sw-mood" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Mood</label>
      <select id="sw-mood" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;">
        <option value="happy">ğŸ˜Š Happy/Upbeat</option>
        <option value="sad">ğŸ˜¢ Sad/Melancholy</option>
        <option value="angry">ğŸ˜  Angry/Intense</option>
        <option value="romantic">ğŸ˜ Romantic</option>
        <option value="nostalgic">ğŸ•°ï¸ Nostalgic</option>
        <option value="hopeful">ğŸŒŸ Hopeful</option>
        <option value="mysterious">ğŸ”® Mysterious</option>
      </select>
    </div>

    <div>
      <label for="sw-structure" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Song Structure</label>
      <select id="sw-structure" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;">
        <option value="standard">ğŸ“ Verse-Chorus-Verse-Chorus-Bridge-Chorus</option>
        <option value="simple">ğŸµ Verse-Verse-Chorus-Verse-Chorus</option>
        <option value="ab">ğŸ¼ A-B-A-B (Verse-Chorus-Verse-Chorus)</option>
        <option value="through">ğŸ¤ Through-composed (No repetition)</option>
      </select>
    </div>
  </div>

  <div style="margin-bottom:20px;">
    <div style="color:var(--accent);margin-bottom:8px;font-weight:500;">Options</div>
    <div style="display:flex;gap:16px;flex-wrap:wrap;">
      <label style="display:flex;align-items:center;gap:6px;color:var(--muted);cursor:pointer;">
        <input id="sw-show-facts" type="checkbox" checked style="width:18px;height:18px;" />
        Show songwriting facts
      </label>
      <label style="display:flex;align-items:center;gap:6px;color:var(--muted);cursor:pointer;">
        <input id="sw-save-prefs" type="checkbox" checked style="width:18px;height:18px;" />
        Save my preferences
      </label>
      <label style="display:flex;align-items:center;gap:6px;color:var(--muted);cursor:pointer;">
        <input id="sw-include-tips" type="checkbox" checked style="width:18px;height:18px;" />
        Include writing tips
      </label>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="swGenerate(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ğŸµ Generate Song Idea
    </button>
    <button type="button" onclick="swReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset
    </button>
    <button type="button" onclick="swCopy(this)"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      ğŸ“‹ Copy
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">ğŸ¼ Generated Song Idea</h3>
  <textarea id="sw-output" rows="10" 
            style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:monospace;resize:vertical;"></textarea>

  <div id="sw-facts-container" style="margin-top:16px;display:none;">
    <h4 class="small" style="color:var(--accent);margin-bottom:8px;">ğŸ“š Songwriting Facts</h4>
    <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:12px;border:1px solid rgba(45,212,255,0.1);">
      <ul style="list-style:none;padding:0;margin:0;color:var(--text);line-height:1.5;">
        <li style="margin-bottom:8px;padding-left:20px;position:relative;">
          <span style="position:absolute;left:0;color:var(--accent);">â€¢</span>
          Most pop songs follow a structure: <strong>Verseâ€“Chorusâ€“Verseâ€“Chorusâ€“Bridgeâ€“Chorus</strong>
        </li>
        <li style="margin-bottom:8px;padding-left:20px;position:relative;">
          <span style="position:absolute;left:0;color:var(--accent);">â€¢</span>
          Lyrics should create <strong>emotional connection</strong> through imagery and metaphor
        </li>
        <li style="margin-bottom:8px;padding-left:20px;position:relative;">
          <span style="position:absolute;left:0;color:var(--accent);">â€¢</span>
          The chorus should contain the <strong>main hook</strong> â€“ the most memorable part
        </li>
        <li style="margin-bottom:8px;padding-left:20px;position:relative;">
          <span style="position:absolute;left:0;color:var(--accent);">â€¢</span>
          Bridge sections provide <strong>contrast</strong> and prevent listener fatigue
        </li>
        <li style="padding-left:20px;position:relative;color:#ffcc00;">
          <span style="position:absolute;left:0;">âš ï¸</span>
          <strong>Always verify techniques with a teacher or professional resource</strong>
        </li>
      </ul>
    </div>
  </div>

  <div id="sw-hint" class="small" style="margin-top:12px;color:var(--muted);min-height:20px;"></div>
</div>

<script>
/* song-writer.html
   - Educational song writer tool
   - Scoped with sw- prefix (song-writer)
   - Includes theme colors and localStorage
*/

(function() {
  'use strict';
  
  const card = document.currentScript?.closest('.card') || document;
  
  // Songwriting data
  const swData = {
    themes: {
      love: ["Unrequited love", "First meeting", "Lost love", "Eternal commitment", "Love at a distance"],
      journey: ["Self-discovery", "Physical journey", "Emotional growth", "Overcoming obstacles", "Finding home"],
      freedom: ["Breaking free", "Personal liberation", "Social freedom", "Creative expression", "Escaping constraints"],
      nature: ["Seasons changing", "Ocean waves", "Mountain peaks", "Forest whispers", "Desert solitude"],
      time: ["Moments slipping away", "Nostalgic memories", "Future hopes", "Present awareness", "Circular time"]
    },
    
    structures: {
      standard: "Verseâ€“Chorusâ€“Verseâ€“Chorusâ€“Bridgeâ€“Chorus",
      simple: "Verseâ€“Verseâ€“Chorusâ€“Verseâ€“Chorus",
      ab: "Aâ€“Bâ€“Aâ€“B (Verseâ€“Chorusâ€“Verseâ€“Chorus)",
      through: "Through-composed (No repetition)"
    },
    
    tips: {
      pop: "Focus on catchy hooks and repetitive choruses. Keep lyrics universal.",
      rock: "Use power chords and strong rhythms. Lyrics can be more abstract or political.",
      folk: "Tell a story. Use acoustic instruments and focus on lyrical depth.",
      jazz: "Experiment with complex chords and rhythms. Lyrics can be poetic and abstract.",
      hiphop: "Focus on rhythm and wordplay. Use metaphor and cultural references.",
      country: "Tell relatable stories. Use simple, heartfelt language.",
      electronic: "Focus on mood and atmosphere. Lyrics can be minimal and repetitive.",
      "r&b": "Focus on emotion and vocal delivery. Use smooth, flowing melodies."
    },
    
    moods: {
      happy: ["Major keys", "Upbeat tempo", "Positive imagery", "Celebratory tone"],
      sad: ["Minor keys", "Slower tempo", "Melancholic imagery", "Reflective tone"],
      angry: ["Distorted sounds", "Fast tempo", "Intense imagery", "Confrontational tone"],
      romantic: ["Warm tones", "Moderate tempo", "Intimate imagery", "Loving tone"],
      nostalgic: ["Wistful melodies", "Medium tempo", "Memory-based imagery", "Yearning tone"],
      hopeful: ["Rising melodies", "Medium tempo", "Future-focused imagery", "Optimistic tone"],
      mysterious: ["Minor chords", "Slow tempo", "Ambiguous imagery", "Intriguing tone"]
    }
  };
  
  // Initialize function
  function swInit() {
    // Load saved preferences
    const savedPrefs = localStorage.getItem('sw-preferences');
    if (savedPrefs) {
      try {
        const prefs = JSON.parse(savedPrefs);
        if (prefs.theme) card.querySelector('#sw-theme').value = prefs.theme;
        if (prefs.style) card.querySelector('#sw-style').value = prefs.style;
        if (prefs.mood) card.querySelector('#sw-mood').value = prefs.mood;
        if (prefs.structure) card.querySelector('#sw-structure').value = prefs.structure;
        if (prefs.showFacts !== undefined) card.querySelector('#sw-show-facts').checked = prefs.showFacts;
        if (prefs.includeTips !== undefined) card.querySelector('#sw-include-tips').checked = prefs.includeTips;
      } catch (e) {
        console.log('Could not load saved preferences:', e);
      }
    }
    
    // Generate initial idea
    setTimeout(() => swGenerate(card.querySelector('#sw-theme')), 100);
  }
  
  // Generate song idea
  function swGenerate(btn) {
    try {
      const theme = card.querySelector('#sw-theme').value.trim();
      const style = card.querySelector('#sw-style').value;
      const mood = card.querySelector('#sw-mood').value;
      const structure = card.querySelector('#sw-structure').value;
      const showFacts = card.querySelector('#sw-show-facts').checked;
      const savePrefs = card.querySelector('#sw-save-prefs').checked;
      const includeTips = card.querySelector('#sw-include-tips').checked;
      
      let output = "";
      const hint = card.querySelector('#sw-hint');
      
      if (!theme) {
        output = "ğŸµ Please enter a theme for your song.\n\nExample themes: Love, Journey, Freedom, Nature, Time, Dreams, Friendship, Courage, Change, Hope";
        hint.textContent = "ğŸ’¡ Try entering a theme above and click Generate";
        card.querySelector('#sw-output').value = output;
        card.querySelector('#sw-facts-container').style.display = 'none';
        return;
      }
      
      // Save preferences if enabled
      if (savePrefs) {
        const prefs = {
          theme: theme,
          style: style,
          mood: mood,
          structure: structure,
          showFacts: showFacts,
          includeTips: includeTips,
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem('sw-preferences', JSON.stringify(prefs));
      }
      
      // Generate song idea
      const styleName = card.querySelector('#sw-style option:checked').textContent.replace(/^[^a-zA-Z]+/, '');
      const moodName = card.querySelector('#sw-mood option:checked').textContent.replace(/^[^a-zA-Z]+/, '');
      const structureName = card.querySelector('#sw-structure option:checked').textContent.replace(/^[^a-zA-Z]+/, '');
      
      output = `ğŸµ SONG IDEA\n`;
      output += `â”€`.repeat(40) + `\n\n`;
      output += `ğŸ“Œ Theme: ${theme}\n`;
      output += `ğŸ¸ Style: ${styleName}\n`;
      output += `ğŸ˜Š Mood: ${moodName}\n`;
      output += `ğŸ“ Structure: ${structureName}\n\n`;
      output += `ğŸ“– LYRICS INSPIRATION:\n`;
      
      // Add theme-specific inspiration
      const themeLower = theme.toLowerCase();
      if (themeLower.includes('love')) {
        output += `â€¢ Opening line: "In the silence between heartbeats, I found you"\n`;
        output += `â€¢ Chorus hook: "Your love is the compass that guides me home"\n`;
        output += `â€¢ Bridge idea: Contrast with doubt or separation before resolution\n`;
      } else if (themeLower.includes('journey') || themeLower.includes('travel')) {
        output += `â€¢ Opening line: "The road unfolded like a ribbon in the dawn"\n`;
        output += `â€¢ Chorus hook: "Every mile brings me closer to who I'm meant to be"\n`;
        output += `â€¢ Bridge idea: Moment of doubt or discovery\n`;
      } else if (themeLower.includes('freedom')) {
        output += `â€¢ Opening line: "Chains of expectation fell away like autumn leaves"\n`;
        output += `â€¢ Chorus hook: "Free to breathe, free to be, free to finally see"\n`;
        output += `â€¢ Bridge idea: Remembering what was left behind\n`;
      } else {
        output += `â€¢ Opening line: Try starting with a strong image related to "${theme}"\n`;
        output += `â€¢ Chorus hook: Create a memorable phrase about "${theme}"\n`;
        output += `â€¢ Bridge idea: Introduce contrast or new perspective\n`;
      }
      
      output += `\nğŸ¶ MUSICAL SUGGESTIONS:\n`;
      output += `â€¢ Key: Consider ${mood === 'happy' ? 'major (like C, G, D)' : 'minor (like Am, Em, Dm)'}\n`;
      output += `â€¢ Tempo: ${mood === 'happy' ? '120-140 BPM (upbeat)' : mood === 'sad' ? '60-80 BPM (slow)' : '90-110 BPM (moderate)'}\n`;
      
      if (includeTips && swData.tips[style]) {
        output += `\nğŸ’¡ ${style.toUpperCase()} WRITING TIP:\n`;
        output += `  ${swData.tips[style]}\n`;
      }
      
      output += `\nâš ï¸ IMPORTANT:\n`;
      output += `  This is educational material. Always verify songwriting techniques\n`;
      output += `  with a teacher or professional resource.\n`;
      
      card.querySelector('#sw-output').value = output;
      card.querySelector('#sw-facts-container').style.display = showFacts ? 'block' : 'none';
      hint.textContent = "âœ… Song idea generated!";
      
      // Clear hint after 3 seconds
      setTimeout(() => {
        if (hint.textContent === "âœ… Song idea generated!") {
          hint.textContent = "";
        }
      }, 3000);
      
    } catch (error) {
      console.error('Error generating song idea:', error);
      card.querySelector('#sw-output').value = "Error generating song idea. Please try again.";
      card.querySelector('#sw-hint').textContent = "âŒ Something went wrong";
    }
  }
  
  // Reset function
  function swReset(btn) {
    try {
      card.querySelector('#sw-theme').value = '';
      card.querySelector('#sw-style').value = 'pop';
      card.querySelector('#sw-mood').value = 'happy';
      card.querySelector('#sw-structure').value = 'standard';
      card.querySelector('#sw-show-facts').checked = true;
      card.querySelector('#sw-save-prefs').checked = true;
      card.querySelector('#sw-include-tips').checked = true;
      card.querySelector('#sw-output').value = '';
      card.querySelector('#sw-facts-container').style.display = 'none';
      card.querySelector('#sw-hint').textContent = "âœ… Reset complete";
      
      // Clear saved preferences
      localStorage.removeItem('sw-preferences');
      
      setTimeout(() => {
        if (card.querySelector('#sw-hint').textContent === "âœ… Reset complete") {
          card.querySelector('#sw-hint').textContent = "";
        }
      }, 2000);
      
    } catch (error) {
      console.error('Error resetting:', error);
    }
  }
  
  // Copy function
  function swCopy(btn) {
    try {
      const output = card.querySelector('#sw-output').value;
      if (!output.trim()) {
        card.querySelector('#sw-hint').textContent = "âŒ Nothing to copy";
        setTimeout(() => {
          if (card.querySelector('#sw-hint').textContent === "âŒ Nothing to copy") {
            card.querySelector('#sw-hint').textContent = "";
          }
        }, 2000);
        return;
      }
      
      navigator.clipboard.writeText(output).then(() => {
        card.querySelector('#sw-hint').textContent = "âœ… Copied to clipboard!";
        
        // Visual feedback on copy button
        const copyBtn = btn.tagName === 'BUTTON' ? btn : btn.closest('button');
        if (copyBtn) {
          const originalText = copyBtn.textContent;
          const originalBg = copyBtn.style.background;
          copyBtn.textContent = 'âœ… Copied!';
          copyBtn.style.background = 'rgba(57,255,20,0.2)';
          
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = originalBg;
          }, 1500);
        }
        
        setTimeout(() => {
          if (card.querySelector('#sw-hint').textContent === "âœ… Copied to clipboard!") {
            card.querySelector('#sw-hint').textContent = "";
          }
        }, 3000);
        
      }).catch(err => {
        console.error('Failed to copy:', err);
        card.querySelector('#sw-hint').textContent = "âŒ Failed to copy";
      });
      
    } catch (error) {
      console.error('Error copying:', error);
      card.querySelector('#sw-hint').textContent = "âŒ Error copying";
    }
  }
  
  // Auto-generate when theme changes
  function swSetupEventListeners() {
    const themeInput = card.querySelector('#sw-theme');
    const styleSelect = card.querySelector('#sw-style');
    const moodSelect = card.querySelector('#sw-mood');
    const structureSelect = card.querySelector('#sw-structure');
    
    // Debounce function for input
    let timeoutId;
    function debouncedGenerate() {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => swGenerate(themeInput), 500);
    }
    
    themeInput.addEventListener('input', debouncedGenerate);
    styleSelect.addEventListener('change', () => swGenerate(styleSelect));
    moodSelect.addEventListener('change', () => swGenerate(moodSelect));
    structureSelect.addEventListener('change', () => swGenerate(structureSelect));
    
    // Also generate when checkboxes change
    card.querySelectorAll('#sw-show-facts, #sw-include-tips').forEach(checkbox => {
      checkbox.addEventListener('change', () => swGenerate(checkbox));
    });
  }
  
  // Expose functions globally (scoped with sw- prefix)
  window.swGenerate = swGenerate;
  window.swReset = swReset;
  window.swCopy = swCopy;
  
  // Initialize when ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      swSetupEventListeners();
      swInit();
    });
  } else {
    swSetupEventListeners();
    swInit();
  }
  
})();
</script>

<style>
/* Card-specific styles */
#song-writer-title {
  color: var(--accent);
  margin-top: 0;
}

/* Responsive design */
@media (max-width: 768px) {
  div[style*="grid-template-columns:1fr 1fr"] {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
  
  .actions {
    flex-direction: column !important;
    gap: 8px !important;
  }
  
  .actions button {
    width: 100% !important;
  }
}

@media (max-width: 480px) {
  #sw-output {
    height: 200px !important;
  }
  
  .flex-wrap {
    flex-direction: column !important;
    gap: 12px !important;
  }
}

/* Scrollbar styling for textarea */
#sw-output::-webkit-scrollbar {
  width: 8px;
}

#sw-output::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 4px;
}

#sw-output::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

#sw-output::-webkit-scrollbar-thumb:hover {
  background: rgba(45,212,255,0.8);
}
</style>
