<h2 id="proofreading-checker-title">‚úçÔ∏è Proofreading & Style Checker</h2>

<form aria-describedby="proofreading-checker-desc">
    <p id="proofreading-checker-desc" class="small">
        Advanced text analysis for grammar, style, readability, and clarity.
        <span style="color:var(--accent)">Get detailed suggestions with explanations.</span>
    </p>
    
    <!-- TEXT INPUT -->
    <div style="margin-bottom:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <label for="pr-text" style="color:var(--accent);font-weight:500;">Text to Analyze</label>
            <div id="pr-char-count" style="font-size:12px;color:rgba(230,250,255,0.6);">0 characters</div>
        </div>
        <textarea id="pr-text" rows="10" placeholder="Paste your text here for comprehensive proofreading analysis..."
                  style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;font-family:inherit;"
                  oninput="prUpdateCharCount()"></textarea>
    </div>
    
    <!-- ANALYSIS OPTIONS -->
    <div style="margin-bottom:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">‚öôÔ∏è Analysis Options</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
            <div>
                <label for="pr-check-level" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Check Intensity
                </label>
                <select id="pr-check-level" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
                    <option value="basic">Basic (Grammar & Spelling)</option>
                    <option value="standard" selected>Standard (Grammar & Style)</option>
                    <option value="advanced">Advanced (Full Analysis)</option>
                    <option value="academic">Academic Writing</option>
                    <option value="creative">Creative Writing</option>
                </select>
            </div>
            
            <div>
                <label for="pr-max-sentence" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Max Sentence Length
                </label>
                <input id="pr-max-sentence" type="number" min="10" max="50" step="1" value="25"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            </div>
        </div>
        
        <!-- CHECKBOX OPTIONS -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-check-passive" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Passive Voice</span>
                </label>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-check-readability" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Readability</span>
                </label>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-check-repetition" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Word Repetition</span>
                </label>
            </div>
            
            <div>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-check-adverbs" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Weak Adverbs</span>
                </label>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-check-cliches" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Clich√©s</span>
                </label>
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 0;">
                    <input type="checkbox" id="pr-explain-suggestions" checked style="accent-color:var(--accent);">
                    <span style="color:rgba(230,250,255,0.9);">Explain Suggestions</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- QUICK FIXES -->
    <div style="margin-bottom:20px;">
        <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Fixes:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="prFixSpacing()" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Fix Spacing</button>
            <button type="button" onclick="prCapitalizeSentences()" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">Capitalize</button>
            <button type="button" onclick="prRemoveExtraSpaces()" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">Extra Spaces</button>
            <button type="button" onclick="prFixEllipses()" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">Fix Ellipses</button>
            <button type="button" onclick="prTrimWhitespace()" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">Trim Whitespace</button>
        </div>
    </div>
    
    <!-- ACTIONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="prAnalyzeText()" 
                style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            ‚úçÔ∏è Analyze Text
        </button>
        <button type="button" onclick="prResetForm()"
                style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            Reset
        </button>
        <button type="button" onclick="prApplyAllFixes()" id="pr-apply-all-btn"
                style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;display:none;">
            ‚úÖ Apply All
        </button>
    </div>
</form>

<!-- STATISTICS -->
<div class="results" aria-live="polite" style="margin-top:16px;">
    <div id="pr-statistics" style="display:none;margin-bottom:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìä Text Statistics</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;margin-bottom:20px;">
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Readability</div>
                <div id="pr-readability-score" style="font-size:28px;font-weight:700;color:var(--accent);">‚Äì</div>
            </div>
            
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Grade Level</div>
                <div id="pr-grade-level" style="font-size:28px;font-weight:700;color:#39ff14;">‚Äì</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Sentences</div>
                <div id="pr-sentence-count" style="font-size:28px;font-weight:700;color:#ffa500;">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Words</div>
                <div id="pr-word-count" style="font-size:28px;font-weight:700;color:#9d4edd;">0</div>
            </div>
        </div>
        
        <!-- DETAILED STATS -->
        <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
                <div>
                    <div style="color:rgba(230,250,255,0.8);font-size:13px;margin-bottom:4px;">Avg. Sentence Length</div>
                    <div id="pr-avg-sentence" style="font-size:20px;font-weight:600;color:var(--accent);">‚Äì</div>
                </div>
                <div>
                    <div style="color:rgba(230,250,255,0.8);font-size:13px;margin-bottom:4px;">Avg. Word Length</div>
                    <div id="pr-avg-word" style="font-size:20px;font-weight:600;color:#39ff14;">‚Äì</div>
                </div>
                <div>
                    <div style="color:rgba(230,250,255,0.8);font-size:13px;margin-bottom:4px;">Passive Sentences</div>
                    <div id="pr-passive-count" style="font-size:20px;font-weight:600;color:#ff2d55;">0</div>
                </div>
                <div>
                    <div style="color:rgba(230,250,255,0.8);font-size:13px;margin-bottom:4px;">Reading Time</div>
                    <div id="pr-reading-time" style="font-size:20px;font-weight:600;color:#ffa500;">‚Äì</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SUGGESTIONS -->
    <div id="pr-suggestions-section" style="display:none;margin-top:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 class="small" style="color:var(--accent);margin:0;">üí° Suggestions & Improvements</h3>
            <div style="display:flex;gap:8px;align-items:center;">
                <div id="pr-suggestion-count" style="font-size:12px;color:rgba(230,250,255,0.6);">0 issues found</div>
                <button type="button" onclick="prExportReport()" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Export</button>
            </div>
        </div>
        
        <!-- CATEGORY FILTERS -->
        <div style="margin-bottom:16px;">
            <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Filter by Category:</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="button" onclick="prFilterSuggestions('all')" class="pr-filter-btn active" data-category="all" style="padding:6px 10px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">All</button>
                <button type="button" onclick="prFilterSuggestions('grammar')" class="pr-filter-btn" data-category="grammar" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">Grammar</button>
                <button type="button" onclick="prFilterSuggestions('style')" class="pr-filter-btn" data-category="style" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">Style</button>
                <button type="button" onclick="prFilterSuggestions('readability')" class="pr-filter-btn" data-category="readability" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">Readability</button>
                <button type="button" onclick="prFilterSuggestions('vocabulary')" class="pr-filter-btn" data-category="vocabulary" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">Vocabulary</button>
            </div>
        </div>
        
        <!-- SUGGESTIONS LIST -->
        <div id="pr-suggestions-list" style="max-height:400px;overflow-y:auto;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
            <!-- Suggestions will be added here -->
        </div>
    </div>
</div>

<!-- WRITING TIPS -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(57,255,20,0.05));border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìù Writing Improvement Tips</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
        <div>
            <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">‚úèÔ∏è Grammar & Clarity</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Use active voice for stronger writing</li>
                <li>Avoid long, complex sentences</li>
                <li>Check subject-verb agreement</li>
                <li>Use commas correctly</li>
            </ul>
        </div>
        <div>
            <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">üé® Style & Flow</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Vary sentence structure</li>
                <li>Show, don't tell</li>
                <li>Use strong verbs</li>
                <li>Avoid clich√©s and filler words</li>
            </ul>
        </div>
        <div>
            <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">üìö Readability</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Aim for 8th-10th grade reading level</li>
                <li>Keep paragraphs focused</li>
                <li>Use transition words</li>
                <li>Break up long paragraphs</li>
            </ul>
        </div>
    </div>
</div>

<script>
/* proofreading-checker.html
   - Advanced proofreading and style analysis tool
   - Scoped with pr- prefix
*/

// Global variables
let prCurrentSuggestions = [];
let prStatistics = {};

// Character count update
function prUpdateCharCount() {
    const textarea = document.getElementById('pr-text');
    const charCount = document.getElementById('pr-char-count');
    const count = textarea.value.length;
    charCount.textContent = `${count} character${count !== 1 ? 's' : ''}`;
}

// Quick fix functions
function prFixSpacing() {
    const textarea = document.getElementById('pr-text');
    let text = textarea.value;
    
    // Fix multiple spaces
    text = text.replace(/  +/g, ' ');
    // Fix space before punctuation
    text = text.replace(/\s+([,.!?;:])/g, '$1');
    // Fix space after opening parentheses/brackets
    text = text.replace(/\(\s+/g, '(');
    text = text.replace(/\[\s+/g, '[');
    // Fix space before closing parentheses/brackets
    text = text.replace(/\s+\)/g, ')');
    text = text.replace(/\s+\]/g, ']');
    
    textarea.value = text;
    prUpdateCharCount();
}

function prCapitalizeSentences() {
    const textarea = document.getElementById('pr-text');
    let text = textarea.value;
    
    // Capitalize first letter of each sentence
    text = text.replace(/(^\s*|[.!?]\s+)([a-z])/g, (match, p1, p2) => p1 + p2.toUpperCase());
    
    textarea.value = text;
}

function prRemoveExtraSpaces() {
    const textarea = document.getElementById('pr-text');
    let text = textarea.value;
    
    // Remove trailing spaces
    text = text.replace(/[ \t]+$/gm, '');
    // Remove leading spaces
    text = text.replace(/^[ \t]+/gm, '');
    // Remove multiple newlines
    text = text.replace(/\n\s*\n\s*\n/g, '\n\n');
    
    textarea.value = text;
    prUpdateCharCount();
}

function prFixEllipses() {
    const textarea = document.getElementById('pr-text');
    let text = textarea.value;
    
    // Standardize ellipses
    text = text.replace(/\.{2,}/g, '...');
    text = text.replace(/‚Ä¶/g, '...');
    
    textarea.value = text;
}

function prTrimWhitespace() {
    const textarea = document.getElementById('pr-text');
    textarea.value = textarea.value.trim();
    prUpdateCharCount();
}

// Main analysis function
function prAnalyzeText() {
    const textarea = document.getElementById('pr-text');
    const text = textarea.value.trim();
    
    if (!text) {
        alert('Please enter some text to analyze.');
        return;
    }
    
    // Reset suggestions
    prCurrentSuggestions = [];
    
    // Calculate statistics
    prCalculateStatistics(text);
    
    // Run analysis based on selected options
    prRunTextAnalysis(text);
    
    // Update display
    prUpdateStatisticsDisplay();
    prUpdateSuggestionsDisplay();
    
    // Show sections
    document.getElementById('pr-statistics').style.display = 'block';
    document.getElementById('pr-suggestions-section').style.display = 'block';
    document.getElementById('pr-apply-all-btn').style.display = 'block';
}

// Calculate text statistics
function prCalculateStatistics(text) {
    // Word count
    const words = text.match(/\b[\w']+\b/g) || [];
    const wordCount = words.length;
    
    // Sentence count
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
    const sentenceCount = sentences.length;
    
    // Character count
    const charCount = text.length;
    
    // Average word length
    const avgWordLength = wordCount > 0 ? 
        words.reduce((sum, word) => sum + word.length, 0) / wordCount : 0;
    
    // Average sentence length
    const avgSentenceLength = sentenceCount > 0 ? wordCount / sentenceCount : 0;
    
    // Calculate readability (Flesch-Kincaid Grade Level)
    const syllables = prCountSyllables(text);
    const readability = prCalculateReadability(wordCount, sentenceCount, syllables);
    
    // Calculate reading time (words per minute = 200)
    const readingTime = Math.ceil(wordCount / 200);
    
    // Count passive sentences
    const passiveCount = prCountPassiveSentences(text);
    
    prStatistics = {
        wordCount,
        sentenceCount,
        charCount,
        avgWordLength: avgWordLength.toFixed(1),
        avgSentenceLength: avgSentenceLength.toFixed(1),
        readability: readability.toFixed(1),
        gradeLevel: Math.max(1, Math.min(12, Math.round(readability))),
        readingTime,
        passiveCount,
        syllables
    };
}

// Count syllables in text (approximate)
function prCountSyllables(text) {
    const words = text.toLowerCase().match(/\b[\w']+\b/g) || [];
    let syllableCount = 0;
    
    words.forEach(word => {
        // Simple syllable counting
        word = word.replace(/'s$/, ''); // Remove possessive
        const vowels = word.match(/[aeiouy]+/g);
        if (vowels) {
            syllableCount += vowels.length;
            // Adjust for silent e
            if (word.endsWith('e') && !word.endsWith('le')) {
                syllableCount--;
            }
            // Ensure at least one syllable
            if (syllableCount === 0) syllableCount = 1;
        } else {
            syllableCount += 1;
        }
    });
    
    return syllableCount;
}

// Calculate readability score
function prCalculateReadability(wordCount, sentenceCount, syllableCount) {
    if (wordCount === 0 || sentenceCount === 0) return 0;
    
    // Flesch Reading Ease
    const flesch = 206.835 - 
                   (1.015 * (wordCount / sentenceCount)) - 
                   (84.6 * (syllableCount / wordCount));
    
    // Convert to grade level approximation
    return Math.max(1, Math.min(12, Math.round((100 - flesch) / 10)));
}

// Count passive sentences
function prCountPassiveSentences(text) {
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
    let passiveCount = 0;
    
    const passivePatterns = [
        /\b(am|is|are|was|were|be|been|being)\s+\w+ed\b/i,
        /\b(get|got|gotten)\s+\w+ed\b/i,
        /\b(have|has|had)\s+been\s+\w+ed\b/i
    ];
    
    sentences.forEach(sentence => {
        for (const pattern of passivePatterns) {
            if (pattern.test(sentence)) {
                passiveCount++;
                break;
            }
        }
    });
    
    return passiveCount;
}

// Run comprehensive text analysis
function prRunTextAnalysis(text) {
    const checkPassive = document.getElementById('pr-check-passive').checked;
    const checkReadability = document.getElementById('pr-check-readability').checked;
    const checkRepetition = document.getElementById('pr-check-repetition').checked;
    const checkAdverbs = document.getElementById('pr-check-adverbs').checked;
    const checkCliches = document.getElementById('pr-check-cliches').checked;
    const maxSentenceLength = parseInt(document.getElementById('pr-max-sentence').value) || 25;
    
    // Split into sentences
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
    
    sentences.forEach((sentence, sentenceIndex) => {
        const sentenceStart = text.indexOf(sentence);
        
        // Check sentence length
        const wordCount = sentence.match(/\b[\w']+\b/g)?.length || 0;
        if (wordCount > maxSentenceLength) {
            prCurrentSuggestions.push({
                type: 'readability',
                category: 'readability',
                severity: 'warning',
                message: `Long sentence (${wordCount} words). Consider splitting into shorter sentences.`,
                context: sentence,
                position: sentenceStart,
                length: sentence.length,
                fix: null,
                explanation: 'Sentences over 20-25 words can be hard to read. Try breaking them into two or more sentences.'
            });
        }
        
        // Check for passive voice
        if (checkPassive) {
            const passivePatterns = [
                { pattern: /\b(am|is|are|was|were|be|been|being)\s+\w+ed\b/i, type: 'passive' },
                { pattern: /\b(get|got|gotten)\s+\w+ed\b/i, type: 'passive' },
                { pattern: /\b(have|has|had)\s+been\s+\w+ed\b/i, type: 'passive' }
            ];
            
            passivePatterns.forEach(patternObj => {
                const match = sentence.match(patternObj.pattern);
                if (match) {
                    prCurrentSuggestions.push({
                        type: 'grammar',
                        category: 'grammar',
                        severity: 'suggestion',
                        message: `Possible passive voice: "${match[0]}". Consider using active voice.`,
                        context: sentence,
                        position: sentenceStart + sentence.indexOf(match[0]),
                        length: match[0].length,
                        fix: null,
                        explanation: 'Active voice makes writing more direct and engaging. For example, change "The ball was thrown by John" to "John threw the ball."'
                    });
                }
            });
        }
        
        // Check for weak adverbs
        if (checkAdverbs) {
            const weakAdverbs = ['very', 'really', 'extremely', 'quite', 'rather', 'somewhat', 'fairly'];
            weakAdverbs.forEach(adverb => {
                const regex = new RegExp(`\\b${adverb}\\s+\\w+`, 'gi');
                let match;
                while ((match = regex.exec(sentence)) !== null) {
                    prCurrentSuggestions.push({
                        type: 'style',
                        category: 'style',
                        severity: 'minor',
                        message: `Consider replacing "${adverb}" with a stronger word.`,
                        context: sentence,
                        position: sentenceStart + match.index,
                        length: adverb.length,
                        fix: null,
                        explanation: 'Weak adverbs dilute your writing. Instead of "very happy," try "ecstatic" or "delighted."'
                    });
                }
            });
        }
        
        // Check for clich√©s
        if (checkCliches) {
            const cliches = [
                'think outside the box', 'at the end of the day', 'bite the bullet',
                'cutting edge', 'game changer', 'low hanging fruit', 'paradigm shift',
                'push the envelope', 'synergy', 'win-win situation'
            ];
            
            cliches.forEach(cliche => {
                if (sentence.toLowerCase().includes(cliche)) {
                    prCurrentSuggestions.push({
                        type: 'style',
                        category: 'style',
                        severity: 'suggestion',
                        message: `Clich√© detected: "${cliche}". Consider using original language.`,
                        context: sentence,
                        position: sentenceStart,
                        length: sentence.length,
                        fix: null,
                        explanation: 'Clich√©s can make writing sound unoriginal. Try expressing the idea in your own words.'
                    });
                }
            });
        }
    });
    
    // Check for word repetition
    if (checkRepetition) {
        const words = text.toLowerCase().match(/\b[\w']+\b/g) || [];
        const wordFrequency = {};
        
        words.forEach(word => {
            if (word.length > 3) { // Ignore short words
                wordFrequency[word] = (wordFrequency[word] || 0) + 1;
            }
        });
        
        Object.entries(wordFrequency).forEach(([word, count]) => {
            if (count > 5 && word.length > 3) {
                prCurrentSuggestions.push({
                    type: 'vocabulary',
                    category: 'vocabulary',
                    severity: 'suggestion',
                    message: `"${word}" used ${count} times. Consider using synonyms.`,
                    context: `Word repetition: "${word}"`,
                    position: 0,
                    length: 0,
                    fix: null,
                    explanation: 'Repeating the same word can make writing monotonous. Try using synonyms or rephrasing.'
                });
            }
        });
    }
    
    // Check for readability issues
    if (checkReadability) {
        const gradeLevel = prStatistics.gradeLevel;
        if (gradeLevel > 10) {
            prCurrentSuggestions.push({
                type: 'readability',
                category: 'readability',
                severity: 'warning',
                message: `High reading level (grade ${gradeLevel}). Consider simplifying for broader audience.`,
                context: 'Overall text',
                position: 0,
                length: 0,
                fix: null,
                explanation: 'Text above 10th grade level may be difficult for general audiences. Try using simpler words and shorter sentences.'
            });
        }
    }
    
    // Check for common grammar mistakes
    const grammarPatterns = [
        {
            pattern: /\b(your|you're)\b.*\b(you're|your)\b/gi,
            message: 'Possible your/you\'re confusion',
            explanation: '"Your" is possessive (your book). "You\'re" is contraction of "you are."'
        },
        {
            pattern: /\b(their|they're|there)\b.*\b(their|they're|there)\b/gi,
            message: 'Possible their/they\'re/there confusion',
            explanation: '"Their" is possessive. "They\'re" means "they are." "There" refers to a place.'
        },
        {
            pattern: /\bits\b.*\bit's\b/gi,
            message: 'Possible its/it\'s confusion',
            explanation: '"Its" is possessive (its tail). "It\'s" means "it is."'
        }
    ];
    
    grammarPatterns.forEach(patternObj => {
        const matches = text.match(patternObj.pattern);
        if (matches) {
            matches.forEach(match => {
                const position = text.indexOf(match);
                prCurrentSuggestions.push({
                    type: 'grammar',
                    category: 'grammar',
                    severity: 'error',
                    message: patternObj.message,
                    context: match,
                    position: position,
                    length: match.length,
                    fix: null,
                    explanation: patternObj.explanation
                });
            });
        }
    });
}

// Update statistics display
function prUpdateStatisticsDisplay() {
    document.getElementById('pr-readability-score').textContent = prStatistics.readability;
    document.getElementById('pr-grade-level').textContent = prStatistics.gradeLevel;
    document.getElementById('pr-sentence-count').textContent = prStatistics.sentenceCount;
    document.getElementById('pr-word-count').textContent = prStatistics.wordCount;
    document.getElementById('pr-avg-sentence').textContent = prStatistics.avgSentenceLength;
    document.getElementById('pr-avg-word').textContent = prStatistics.avgWordLength;
    document.getElementById('pr-passive-count').textContent = prStatistics.passiveCount;
    document.getElementById('pr-reading-time').textContent = `${prStatistics.readingTime} minute${prStatistics.readingTime !== 1 ? 's' : ''}`;
}

// Update suggestions display
function prUpdateSuggestionsDisplay() {
    const suggestionsList = document.getElementById('pr-suggestions-list');
    const suggestionCount = document.getElementById('pr-suggestion-count');
    
    suggestionsList.innerHTML = '';
    suggestionCount.textContent = `${prCurrentSuggestions.length} issue${prCurrentSuggestions.length !== 1 ? 's' : ''} found`;
    
    if (prCurrentSuggestions.length === 0) {
        suggestionsList.innerHTML = `
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.6);">
                <div style="font-size:48px;margin-bottom:16px;">‚úÖ</div>
                <h3 style="color:#39ff14;margin-bottom:8px;">Great Writing!</h3>
                <p>No issues detected. Your text looks well-written.</p>
            </div>
        `;
        return;
    }
    
    // Group by category
    const byCategory = {
        all: prCurrentSuggestions,
        grammar: prCurrentSuggestions.filter(s => s.category === 'grammar'),
        style: prCurrentSuggestions.filter(s => s.category === 'style'),
        readability: prCurrentSuggestions.filter(s => s.category === 'readability'),
        vocabulary: prCurrentSuggestions.filter(s => s.category === 'vocabulary')
    };
    
    // Get active filter
    const activeFilter = document.querySelector('.pr-filter-btn.active')?.dataset.category || 'all';
    const filteredSuggestions = byCategory[activeFilter] || [];
    
    if (filteredSuggestions.length === 0) {
        suggestionsList.innerHTML = `
            <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.6);">
                No issues in this category.
            </div>
        `;
        return;
    }
    
    filteredSuggestions.forEach((suggestion, index) => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.style.cssText = `
            padding: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: ${index % 2 === 0 ? 'rgba(0,0,0,0.1)' : 'transparent'};
        `;
        
        // Severity color
        let severityColor = '#ffa500';
        if (suggestion.severity === 'error') severityColor = '#ff2d55';
        if (suggestion.severity === 'minor') severityColor = '#ffcc00';
        if (suggestion.severity === 'suggestion') severityColor = var('--accent');
        if (suggestion.severity === 'warning') severityColor = '#ffa500';
        
        const explain = document.getElementById('pr-explain-suggestions').checked;
        
        div.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 8px;">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: ${severityColor};"></div>
                        <div style="font-weight: 600; color: ${severityColor}; text-transform: uppercase; font-size: 12px;">
                            ${suggestion.severity}
                        </div>
                        <div style="padding: 2px 8px; background: rgba(255,255,255,0.05); border-radius: 4px; font-size: 11px; color: rgba(230,250,255,0.7);">
                            ${suggestion.category}
                        </div>
                    </div>
                    <div style="font-weight: 600; color: rgba(230,250,255,0.9); margin-bottom: 8px;">
                        ${suggestion.message}
                    </div>
                    <div style="font-size: 13px; color: rgba(230,250,255,0.8); font-style: italic; margin-bottom: 8px;">
                        "${suggestion.context.substring(0, 100)}${suggestion.context.length > 100 ? '...' : ''}"
                    </div>
                    ${explain && suggestion.explanation ? `
                        <div style="font-size: 13px; color: rgba(230,250,255,0.7); padding: 8px; background: rgba(0,0,0,0.2); border-radius: 6px; margin-top: 8px;">
                            üí° ${suggestion.explanation}
                        </div>
                    ` : ''}
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button onclick="prNavigateToSuggestion(${suggestion.position})" style="padding: 6px 12px; background: rgba(45,212,255,0.1); border: 1px solid rgba(45,212,255,0.3); border-radius: 6px; color: var(--accent); cursor: pointer; font-size: 12px;">
                        Go to Issue
                    </button>
                    ${suggestion.fix ? `
                        <button onclick="prApplySuggestion(${index})" style="padding: 6px 12px; background: rgba(57,255,20,0.1); border: 1px solid rgba(57,255,20,0.3); border-radius: 6px; color: #39ff14; cursor: pointer; font-size: 12px;">
                            Apply Fix
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
        
        suggestionsList.appendChild(div);
    });
}

// Filter suggestions by category
function prFilterSuggestions(category) {
    // Update active button
    document.querySelectorAll('.pr-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = btn.style.background.replace('0.2', '0.1');
    });
    
    const activeBtn = document.querySelector(`.pr-filter-btn[data-category="${category}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
        activeBtn.style.background = activeBtn.style.background.replace('0.1', '0.2');
    }
    
    // Update display
    prUpdateSuggestionsDisplay();
}

// Navigate to suggestion in text
function prNavigateToSuggestion(position) {
    const textarea = document.getElementById('pr-text');
    textarea.focus();
    textarea.setSelectionRange(position, position);
    textarea.scrollTop = textarea.scrollHeight * (position / textarea.value.length);
}

// Apply individual suggestion
function prApplySuggestion(index) {
    const suggestion = prCurrentSuggestions[index];
    if (!suggestion.fix) return;
    
    const textarea = document.getElementById('pr-text');
    let text = textarea.value;
    
    text = text.substring(0, suggestion.position) + 
           suggestion.fix + 
           text.substring(suggestion.position + suggestion.length);
    
    textarea.value = text;
    prUpdateCharCount();
    prAnalyzeText(); // Re-analyze
}

// Apply all fixes
function prApplyAllFixes() {
    // For now, just apply quick fixes
    prFixSpacing();
    prCapitalizeSentences();
    prRemoveExtraSpaces();
    prFixEllipses();
    prTrimWhitespace();
    
    // Re-analyze
    prAnalyzeText();
    
    // Show success message
    const applyBtn = document.getElementById('pr-apply-all-btn');
    const originalText = applyBtn.textContent;
    applyBtn.textContent = '‚úÖ Applied!';
    setTimeout(() => {
        applyBtn.textContent = originalText;
    }, 2000);
}

// Export report
function prExportReport() {
    const text = document.getElementById('pr-text').value;
    if (!text) return;
    
    let report = `PROOFREADING REPORT\n`;
    report += `Generated: ${new Date().toLocaleString()}\n\n`;
    report += `STATISTICS\n`;
    report += `Readability Score: ${prStatistics.readability}\n`;
    report += `Grade Level: ${prStatistics.gradeLevel}\n`;
    report += `Word Count: ${prStatistics.wordCount}\n`;
    report += `Sentence Count: ${prStatistics.sentenceCount}\n`;
    report += `Average Sentence Length: ${prStatistics.avgSentenceLength} words\n`;
    report += `Passive Sentences: ${prStatistics.passiveCount}\n\n`;
    
    report += `SUGGESTIONS (${prCurrentSuggestions.length} total)\n`;
    prCurrentSuggestions.forEach((s, i) => {
        report += `${i + 1}. [${s.severity.toUpperCase()}] ${s.message}\n`;
        report += `   Context: "${s.context.substring(0, 80)}${s.context.length > 80 ? '...' : ''}"\n`;
        if (s.explanation) report += `   Explanation: ${s.explanation}\n`;
        report += '\n';
    });
    
    report += `ORIGINAL TEXT\n`;
    report += `${text}\n`;
    
    // Create download
    const blob = new Blob([report], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `proofreading-report-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Reset form
function prResetForm() {
    document.getElementById('pr-text').value = '';
    document.getElementById('pr-statistics').style.display = 'none';
    document.getElementById('pr-suggestions-section').style.display = 'none';
    document.getElementById('pr-apply-all-btn').style.display = 'none';
    prUpdateCharCount();
    prCurrentSuggestions = [];
    prStatistics = {};
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Set up filter button styling
        const filterButtons = document.querySelectorAll('.pr-filter-btn');
        filterButtons.forEach(btn => {
            const bgColor = getComputedStyle(btn).backgroundColor;
            btn.style.background = bgColor.replace('0.2', '0.1');
        });
        
        // Set active button to full opacity
        const activeBtn = document.querySelector('.pr-filter-btn.active');
        if (activeBtn) {
            const bgColor = getComputedStyle(activeBtn).backgroundColor;
            activeBtn.style.background = bgColor.replace('0.1', '0.2');
        }
        
        console.log('Proofreading Checker ready');
    });
}
</script>

<style>
@keyframes prPulse {
    0% { opacity: 1; }
    50% { opacity: 0.8; }
    100% { opacity: 1; }
}

#proofreading-checker-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, var(--accent), #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Suggestion item hover effect */
.suggestion-item:hover {
    background: rgba(45,212,255,0.05) !important;
    transition: background 0.2s;
}

/* Scrollbar styling */
#pr-suggestions-list::-webkit-scrollbar {
    width: 6px;
}

#pr-suggestions-list::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 3px;
}

#pr-suggestions-list::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
}

/* Responsive design */
@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    #pr-statistics > div:first-child {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* Quick fix button hover effects */
button[onclick^="prFix"]:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}

/* Filter button active state */
.pr-filter-btn.active {
    border-width: 2px !important;
    border-color: var(--accent) !important;
}
</style>
