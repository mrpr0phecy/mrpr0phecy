<h2 id="equation-solver-title" style="margin-top:0;color:var(--accent);">üìê Equation Solver</h2>

<form aria-describedby="equation-solver-desc">
  <p id="equation-solver-desc" class="small" style="margin-bottom:16px;color:rgba(230,250,255,0.8);">
    Solve algebraic equations step-by-step. Supports linear, quadratic, and cubic equations. 
    <span style="color:var(--accent);font-weight:500;">Try examples below!</span>
  </p>

  <div class="field" style="margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
      <label for="es-equation" style="color:var(--accent);font-weight:500;">Equation</label>
      <button type="button" onclick="esLoadExample('linear')" class="small-btn" style="font-size:12px;padding:3px 8px;">Example: 2x + 5 = 13</button>
    </div>
    <input id="es-equation" type="text" placeholder="e.g. 2x + 5 = 13 or x¬≤ - 4x + 3 = 0" 
           style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;" />
    <div style="display:flex;gap:6px;margin-top:6px;">
      <button type="button" onclick="esLoadExample('linear')" class="small-btn" style="flex:1;font-size:12px;padding:4px;">Linear</button>
      <button type="button" onclick="esLoadExample('quadratic')" class="small-btn" style="flex:1;font-size:12px;padding:4px;">Quadratic</button>
      <button type="button" onclick="esLoadExample('cubic')" class="small-btn" style="flex:1;font-size:12px;padding:4px;">Cubic</button>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
    <div class="field">
      <label for="es-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Equation Type
        <span id="es-detected-type" class="small" style="color:rgba(45,212,255,0.7);font-weight:normal;float:right;">Auto</span>
      </label>
      <select id="es-type" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="auto" selected>Auto-detect</option>
        <option value="linear">Linear (ax + b = c)</option>
        <option value="quadratic">Quadratic (ax¬≤ + bx + c = 0)</option>
        <option value="cubic">Cubic (ax¬≥ + bx¬≤ + cx + d = 0)</option>
      </select>
    </div>

    <div class="field">
      <label for="es-decimal-places" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Decimal Places</label>
      <select id="es-decimal-places" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="2">2 places</option>
        <option value="4" selected>4 places</option>
        <option value="6">6 places</option>
        <option value="8">8 places</option>
      </select>
    </div>
  </div>

  <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;">
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
      <input type="checkbox" id="es-show-steps" checked style="width:18px;height:18px;cursor:pointer;" />
      <span style="color:var(--accent);font-weight:500;">Show step-by-step solution</span>
    </label>
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin-left:auto;">
      <input type="checkbox" id="es-graph" style="width:18px;height:18px;cursor:pointer;" />
      <span style="color:var(--accent);font-weight:500;">Show graph</span>
    </label>
  </div>

  <div class="actions" style="display:flex;gap:10px;">
    <button type="button" onclick="esSolve(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);font-weight:600;cursor:pointer;">
      üîç Solve Equation
    </button>
    <button type="button" onclick="esReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="esCopy(this)"
            style="padding:12px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
      Copy
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:20px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">Solution</h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="es-solution-status" class="small" style="color:rgba(45,212,255,0.8);"></div>
      <div id="es-time" class="small" style="color:rgba(230,250,255,0.6);"></div>
    </div>
  </div>

  <div id="es-output-container" style="min-height:200px;">
    <textarea id="es-output" rows="12" 
              style="width:100%;padding:14px;border-radius:10px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:'Consolas','Monaco','Courier New',monospace;font-size:13px;line-height:1.5;resize:vertical;"></textarea>
    
    <div id="es-graph-container" style="display:none;margin-top:16px;">
      <canvas id="es-graph-canvas" style="width:100%;height:200px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(45,212,255,0.2);"></canvas>
    </div>
  </div>

  <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;">
    <div>
      <span class="small" style="color:rgba(230,250,255,0.7);">Format: </span>
      <button onclick="esFormat('plain')" class="format-btn active">Plain Text</button>
      <button onclick="esFormat('latex')" class="format-btn">LaTeX</button>
      <button onclick="esFormat('mathml')" class="format-btn">MathML</button>
    </div>
    <div id="es-hint" class="small" style="color:#39ff14;"></div>
  </div>
</div>

<script>
/* equation-solver.html - Enhanced version
   - Solves linear, quadratic, and cubic equations
   - Shows step-by-step solutions
   - Includes graphing capability
   - Multiple output formats
*/

let esCurrentFormat = 'plain';

// Equation examples
const esExamples = {
  linear: [
    "2x + 5 = 13",
    "3x - 7 = 8",
    "x/2 = 6",
    "4(x - 3) = 20",
    "2x + 3 = 5x - 7"
  ],
  quadratic: [
    "x¬≤ - 5x + 6 = 0",
    "2x¬≤ + 4x - 6 = 0",
    "x¬≤ - 4 = 0",
    "3x¬≤ - 12x + 9 = 0",
    "x¬≤ + 2x + 5 = 0"
  ],
  cubic: [
    "x¬≥ - 6x¬≤ + 11x - 6 = 0",
    "x¬≥ - 3x¬≤ + 3x - 1 = 0",
    "x¬≥ + 3x¬≤ + 3x + 1 = 0",
    "x¬≥ - x = 0"
  ]
};

function esLoadExample(type) {
  const card = document.currentScript?.closest('.card') || document;
  const examples = esExamples[type];
  if (!examples) return;
  
  const randomExample = examples[Math.floor(Math.random() * examples.length)];
  card.querySelector('#es-equation').value = randomExample;
  
  // Auto-detect type
  esDetectType();
  
  // Update hint
  const hint = card.querySelector('#es-hint');
  hint.textContent = `Loaded ${type} example`;
  hint.style.color = '#39ff14';
  setTimeout(() => {
    if (hint.textContent.includes('Loaded')) hint.textContent = '';
  }, 2000);
}

function esDetectType() {
  const card = document.currentScript?.closest('.card') || document;
  const equation = card.querySelector('#es-equation').value.toLowerCase();
  
  if (equation.includes('¬≥') || equation.includes('^3')) {
    return 'cubic';
  } else if (equation.includes('¬≤') || equation.includes('^2')) {
    return 'quadratic';
  } else if (equation.includes('x')) {
    return 'linear';
  }
  return 'unknown';
}

function esFormat(format) {
  const card = document.currentScript?.closest('.card') || document;
  const buttons = card.querySelectorAll('.format-btn');
  buttons.forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  esCurrentFormat = format;
  // In a real implementation, this would convert the output to the selected format
  const hint = card.querySelector('#es-hint');
  hint.textContent = `Output format: ${format.toUpperCase()}`;
  hint.style.color = '#2dd4ff';
  setTimeout(() => {
    if (hint.textContent.includes('Output format')) hint.textContent = '';
  }, 1500);
}

function esParseEquation(equation) {
  // Clean the equation
  equation = equation
    .replace(/\s+/g, '')
    .replace(/¬≤/g, '^2')
    .replace(/¬≥/g, '^3')
    .toLowerCase();
  
  // Move everything to left side: ax + b = c ‚Üí ax + b - c = 0
  if (equation.includes('=')) {
    const [left, right] = equation.split('=');
    equation = `${left}-(${right})`;
  }
  
  return equation;
}

function esSolveLinear(equation, showSteps, decimals) {
  // Parse ax + b = 0
  const match = equation.match(/([+-]?\d*\.?\d*)x([+-]\d+\.?\d*)?/);
  if (!match) return null;
  
  const a = parseFloat(match[1] || '1') * (match[1] === '-' ? -1 : 1);
  const b = parseFloat(match[2] || '0');
  
  if (a === 0) return b === 0 ? 'Infinite solutions (0 = 0)' : 'No solution';
  
  const x = (-b / a).toFixed(decimals);
  
  let steps = '';
  if (showSteps) {
    steps = `Step 1: Equation: ${a}x ${b >= 0 ? '+' : ''}${b} = 0\n`;
    steps += `Step 2: Move constant to right: ${a}x = ${-b}\n`;
    steps += `Step 3: Divide by ${a}: x = ${-b}/${a}\n`;
    steps += `Step 4: Simplify: x = ${x}`;
  }
  
  return {
    roots: [parseFloat(x)],
    steps: steps,
    solution: `x = ${x}`,
    type: 'linear'
  };
}

function esSolveQuadratic(equation, showSteps, decimals) {
  // Parse ax^2 + bx + c = 0
  const match = equation.match(/([+-]?\d*\.?\d*)x\^2([+-]\d*\.?\d*)x?([+-]\d+\.?\d*)?/);
  if (!match) return null;
  
  const a = parseFloat(match[1] || '1') * (match[1] === '-' ? -1 : 1);
  const b = parseFloat(match[2] || '0');
  const c = parseFloat(match[3] || '0');
  
  const discriminant = b * b - 4 * a * c;
  
  let steps = '';
  let solution = '';
  let roots = [];
  
  if (discriminant > 0) {
    const sqrtDisc = Math.sqrt(discriminant);
    const root1 = ((-b + sqrtDisc) / (2 * a)).toFixed(decimals);
    const root2 = ((-b - sqrtDisc) / (2 * a)).toFixed(decimals);
    
    roots = [parseFloat(root1), parseFloat(root2)];
    solution = `x‚ÇÅ = ${root1}, x‚ÇÇ = ${root2}`;
    
    if (showSteps) {
      steps = `Step 1: Identify coefficients: a = ${a}, b = ${b}, c = ${c}\n`;
      steps += `Step 2: Calculate discriminant: Œî = b¬≤ - 4ac = ${discriminant}\n`;
      steps += `Step 3: Since Œî > 0, two real roots\n`;
      steps += `Step 4: Roots: x = (-b ¬± ‚àöŒî)/(2a)\n`;
      steps += `Step 5: x‚ÇÅ = (${-b} + ‚àö${discriminant})/(2√ó${a}) = ${root1}\n`;
      steps += `Step 6: x‚ÇÇ = (${-b} - ‚àö${discriminant})/(2√ó${a}) = ${root2}`;
    }
  } else if (discriminant === 0) {
    const root = (-b / (2 * a)).toFixed(decimals);
    roots = [parseFloat(root)];
    solution = `x = ${root} (double root)`;
    
    if (showSteps) {
      steps = `Step 1: Identify coefficients: a = ${a}, b = ${b}, c = ${c}\n`;
      steps += `Step 2: Calculate discriminant: Œî = b¬≤ - 4ac = 0\n`;
      steps += `Step 3: Since Œî = 0, one real double root\n`;
      steps += `Step 4: Root: x = -b/(2a) = ${-b}/(2√ó${a}) = ${root}`;
    }
  } else {
    const realPart = (-b / (2 * a)).toFixed(decimals);
    const imagPart = (Math.sqrt(-discriminant) / (2 * a)).toFixed(decimals);
    
    solution = `x‚ÇÅ = ${realPart} + ${imagPart}i, x‚ÇÇ = ${realPart} - ${imagPart}i`;
    
    if (showSteps) {
      steps = `Step 1: Identify coefficients: a = ${a}, b = ${b}, c = ${c}\n`;
      steps += `Step 2: Calculate discriminant: Œî = b¬≤ - 4ac = ${discriminant}\n`;
      steps += `Step 3: Since Œî < 0, two complex roots\n`;
      steps += `Step 4: Real part: -b/(2a) = ${realPart}\n`;
      steps += `Step 5: Imaginary part: ‚àö|Œî|/(2a) = ${imagPart}`;
    }
  }
  
  return {
    roots: roots,
    steps: steps,
    solution: solution,
    discriminant: discriminant,
    type: 'quadratic'
  };
}

function esSolveCubic(equation, showSteps, decimals) {
  // Simplified cubic solver - for demonstration
  // In practice, you'd want to use Cardano's formula
  
  let steps = '';
  let solution = 'Cubic equations require numerical methods.\nTry using Newton-Raphson or graphing.';
  
  if (showSteps) {
    steps = 'Step 1: Cubic equations can have up to 3 real roots\n';
    steps += 'Step 2: Use Cardano\'s formula or numerical methods\n';
    steps += 'Step 3: Try factoring or graphing for approximate solutions';
  }
  
  return {
    roots: [],
    steps: steps,
    solution: solution,
    type: 'cubic'
  };
}

function esDrawGraph(roots, equationType) {
  const canvas = document.getElementById('es-graph-canvas');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  
  // Clear canvas
  ctx.clearRect(0, 0, width, height);
  
  // Draw axes
  ctx.strokeStyle = 'rgba(45,212,255,0.5)';
  ctx.lineWidth = 1;
  
  // X-axis
  ctx.beginPath();
  ctx.moveTo(0, height / 2);
  ctx.lineTo(width, height / 2);
  ctx.stroke();
  
  // Y-axis
  ctx.beginPath();
  ctx.moveTo(width / 2, 0);
  ctx.lineTo(width / 2, height);
  ctx.stroke();
  
  // Draw roots
  ctx.fillStyle = '#39ff14';
  roots.forEach(root => {
    if (typeof root === 'number' && !isNaN(root)) {
      const x = (root * 20) + (width / 2); // Scale factor
      const y = height / 2;
      
      ctx.beginPath();
      ctx.arc(x, y, 6, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#39ff14';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Label
      ctx.fillStyle = 'white';
      ctx.font = '12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(`x=${root.toFixed(2)}`, x, y - 10);
    }
  });
}

function esSolve(btn) {
  const startTime = performance.now();
  const card = btn.closest('.card') || document;
  
  const equation = card.querySelector('#es-equation').value.trim();
  const typeSelect = card.querySelector('#es-type');
  const selectedType = typeSelect.value;
  const showSteps = card.querySelector('#es-show-steps').checked;
  const showGraph = card.querySelector('#es-graph').checked;
  const decimals = parseInt(card.querySelector('#es-decimal-places').value);
  
  // Clear previous outputs
  card.querySelector('#es-output').value = '';
  card.querySelector('#es-hint').textContent = '';
  card.querySelector('#es-solution-status').textContent = '';
  card.querySelector('#es-time').textContent = '';
  
  if (!equation) {
    card.querySelector('#es-hint').textContent = 'Please enter an equation.';
    card.querySelector('#es-hint').style.color = '#ff2d55';
    return;
  }
  
  // Auto-detect type if selected
  let eqType = selectedType === 'auto' ? esDetectType() : selectedType;
  
  // Update detected type display
  const detectedSpan = card.querySelector('#es-detected-type');
  if (detectedSpan) {
    detectedSpan.textContent = eqType.charAt(0).toUpperCase() + eqType.slice(1);
  }
  
  // Parse and solve
  const parsedEquation = esParseEquation(equation);
  let result = null;
  
  try {
    switch (eqType) {
      case 'linear':
        result = esSolveLinear(parsedEquation, showSteps, decimals);
        break;
      case 'quadratic':
        result = esSolveQuadratic(parsedEquation, showSteps, decimals);
        break;
      case 'cubic':
        result = esSolveCubic(parsedEquation, showSteps, decimals);
        break;
      default:
        result = { solution: 'Unable to determine equation type.', steps: '' };
    }
  } catch (error) {
    console.error('Equation solver error:', error);
    result = { solution: 'Error solving equation. Please check format.', steps: '' };
  }
  
  // Display results
  let output = '';
  if (result) {
    output += 'EQUATION: ' + equation + '\n\n';
    output += 'SOLUTION: ' + result.solution + '\n\n';
    
    if (showSteps && result.steps) {
      output += 'STEPS:\n' + result.steps + '\n\n';
    }
    
    if (result.type === 'quadratic' && result.discriminant !== undefined) {
      output += 'DISCRIMINANT: Œî = ' + result.discriminant.toFixed(decimals) + '\n';
      if (result.discriminant > 0) {
        output += 'NATURE: Two distinct real roots\n';
      } else if (result.discriminant === 0) {
        output += 'NATURE: One real double root\n';
      } else {
        output += 'NATURE: Two complex conjugate roots\n';
      }
    }
    
    if (result.roots && result.roots.length > 0) {
      output += '\nNUMERICAL ROOTS:\n';
      result.roots.forEach((root, i) => {
        output += `x${i+1} = ${root.toFixed(decimals)}\n`;
      });
    }
    
    card.querySelector('#es-output').value = output;
    card.querySelector('#es-solution-status').textContent = '‚úÖ Solved';
    card.querySelector('#es-solution-status').style.color = '#39ff14';
    
    // Show graph if requested and has real roots
    const graphContainer = card.querySelector('#es-graph-container');
    if (showGraph && result.roots && result.roots.length > 0) {
      graphContainer.style.display = 'block';
      esDrawGraph(result.roots, result.type);
    } else {
      graphContainer.style.display = 'none';
    }
  }
  
  // Calculate and display execution time
  const endTime = performance.now();
  const timeTaken = (endTime - startTime).toFixed(2);
  card.querySelector('#es-time').textContent = `(${timeTaken}ms)`;
  
  // Update hint
  card.querySelector('#es-hint').textContent = 'Equation solved successfully!';
  card.querySelector('#es-hint').style.color = '#39ff14';
}

function esReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form
  card.querySelector('#es-equation').value = '';
  card.querySelector('#es-type').value = 'auto';
  card.querySelector('#es-decimal-places').value = '4';
  card.querySelector('#es-show-steps').checked = true;
  card.querySelector('#es-graph').checked = false;
  
  // Clear outputs
  card.querySelector('#es-output').value = '';
  card.querySelector('#es-hint').textContent = '';
  card.querySelector('#es-solution-status').textContent = '';
  card.querySelector('#es-time').textContent = '';
  card.querySelector('#es-detected-type').textContent = 'Auto';
  
  // Hide graph
  const graphContainer = card.querySelector('#es-graph-container');
  if (graphContainer) {
    graphContainer.style.display = 'none';
  }
  
  // Focus on equation input
  card.querySelector('#es-equation').focus();
}

function esCopy(btn) {
  const card = btn.closest('.card') || document;
  const output = card.querySelector('#es-output').value;
  
  if (!output.trim()) {
    const hint = card.querySelector('#es-hint');
    hint.textContent = 'Nothing to copy!';
    hint.style.color = '#ff2d55';
    setTimeout(() => {
      if (hint.textContent === 'Nothing to copy!') hint.textContent = '';
    }, 1500);
    return;
  }
  
  navigator.clipboard.writeText(output).then(() => {
    const hint = card.querySelector('#es-hint');
    hint.textContent = '‚úÖ Copied to clipboard!';
    hint.style.color = '#39ff14';
    
    // Visual feedback on button
    const originalText = btn.textContent;
    btn.textContent = '‚úÖ Copied!';
    btn.style.background = 'rgba(57,255,20,0.1)';
    btn.style.borderColor = 'rgba(57,255,20,0.3)';
    
    setTimeout(() => {
      if (hint.textContent === '‚úÖ Copied to clipboard!') {
        hint.textContent = '';
      }
      btn.textContent = originalText;
      btn.style.background = '';
      btn.style.borderColor = '';
    }, 2000);
  }).catch(err => {
    console.error('Copy failed:', err);
    const hint = card.querySelector('#es-hint');
    hint.textContent = '‚ùå Copy failed';
    hint.style.color = '#ff2d55';
  });
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    // Auto-detect type when equation changes
    const card = document.currentScript?.closest('.card') || document;
    const equationInput = card.querySelector('#es-equation');
    
    if (equationInput) {
      equationInput.addEventListener('input', function() {
        const detectedType = esDetectType();
        const detectedSpan = card.querySelector('#es-detected-type');
        if (detectedSpan && detectedType !== 'unknown') {
          detectedSpan.textContent = detectedType.charAt(0).toUpperCase() + detectedType.slice(1);
        }
      });
    }
    
    console.log('Enhanced Equation Solver ready');
  });
} else {
  // Run immediately if already loaded
  const card = document.currentScript?.closest('.card') || document;
  const equationInput = card.querySelector('#es-equation');
  
  if (equationInput) {
    equationInput.addEventListener('input', function() {
      const detectedType = esDetectType();
      const detectedSpan = card.querySelector('#es-detected-type');
      if (detectedSpan && detectedType !== 'unknown') {
        detectedSpan.textContent = detectedType.charAt(0).toUpperCase() + detectedType.slice(1);
      }
    });
  }
}
</script>

<style>
#equation-solver-title {
  color: var(--accent);
  margin-top: 0;
}

.small-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: inherit;
  cursor: pointer;
  transition: all 0.2s;
}

.small-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
}

.format-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: inherit;
  cursor: pointer;
  padding: 4px 10px;
  font-size: 12px;
  margin-left: 6px;
  transition: all 0.2s;
}

.format-btn.active {
  background: rgba(45,212,255,0.2);
  border-color: rgba(45,212,255,0.4);
  color: var(--accent);
}

.format-btn:hover:not(.active) {
  background: rgba(255,255,255,0.1);
}

@media (max-width: 768px) {
  .row {
    grid-template-columns: 1fr !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
}
</style>
