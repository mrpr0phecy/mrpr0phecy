<h2 id="meal-planner-title">Weekly Meal Planner</h2>

<form aria-describedby="meal-planner-desc">
  <p id="meal-planner-desc" class="small">
    Plan your meals for the entire week, track nutrition, generate shopping lists, and save your plans.
    <span style="color:var(--accent)">Perfect for healthy eating, budget planning, and reducing food waste!</span>
  </p>

  <!-- QUICK MEAL IDEAS -->
  <div style="margin-bottom:16px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Meal Ideas:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="mpAddQuickMeal('breakfast')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">üç≥ Breakfast</button>
      <button type="button" onclick="mpAddQuickMeal('lunch')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">ü•™ Lunch</button>
      <button type="button" onclick="mpAddQuickMeal('dinner')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">üçΩÔ∏è Dinner</button>
      <button type="button" onclick="mpAddQuickMeal('vegetarian')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">ü•ó Vegetarian</button>
      <button type="button" onclick="mpAddQuickMeal('quick')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">‚ö° Quick & Easy</button>
    </div>
  </div>

  <!-- MEAL INPUT FORM -->
  <div style="background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(45,212,255,0.15);padding:12px;margin-bottom:16px;">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px;">
      <div>
        <label for="mp-day" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Day
        </label>
        <select id="mp-day" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="monday">Monday</option>
          <option value="tuesday">Tuesday</option>
          <option value="wednesday">Wednesday</option>
          <option value="thursday">Thursday</option>
          <option value="friday">Friday</option>
          <option value="saturday">Saturday</option>
          <option value="sunday">Sunday</option>
        </select>
      </div>
      
      <div>
        <label for="mp-meal-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Meal Type
        </label>
        <select id="mp-meal-type" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="breakfast">Breakfast</option>
          <option value="lunch">Lunch</option>
          <option value="dinner" selected>Dinner</option>
          <option value="snack">Snack</option>
          <option value="dessert">Dessert</option>
        </select>
      </div>
      
      <div>
        <label for="mp-category" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Category
        </label>
        <select id="mp-category" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="vegetarian">Vegetarian</option>
          <option value="vegan">Vegan</option>
          <option value="meat" selected>Meat</option>
          <option value="fish">Fish</option>
          <option value="poultry">Poultry</option>
          <option value="low-carb">Low Carb</option>
          <option value="gluten-free">Gluten Free</option>
        </select>
      </div>
    </div>
    
    <div style="margin-bottom:12px;">
      <label for="mp-meal" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Meal Name & Details
      </label>
      <div style="position:relative;">
        <input id="mp-meal" type="text" placeholder="e.g., Grilled Chicken with Roasted Vegetables" 
               style="width:100%;padding:12px;padding-right:120px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        <div style="position:absolute;right:8px;top:50%;transform:translateY(-50%);display:flex;gap:4px;">
          <button type="button" onclick="mpSetPrepTime('15')" title="15 min prep" style="background:transparent;border:none;color:rgba(230,250,255,0.7);cursor:pointer;font-size:12px;padding:2px 6px;">15m</button>
          <button type="button" onclick="mpSetPrepTime('30')" title="30 min prep" style="background:transparent;border:none;color:rgba(230,250,255,0.7);cursor:pointer;font-size:12px;padding:2px 6px;">30m</button>
          <button type="button" onclick="mpSetPrepTime('60')" title="60 min prep" style="background:transparent;border:none;color:rgba(230,250,255,0.7);cursor:pointer;font-size:12px;padding:2px 6px;">60m</button>
        </div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div>
        <label for="mp-prep-time" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Prep Time (minutes)
        </label>
        <input id="mp-prep-time" type="number" min="0" max="240" placeholder="e.g., 30" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
      
      <div>
        <label for="mp-calories" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Calories (approx)
        </label>
        <input id="mp-calories" type="number" min="0" max="2000" placeholder="e.g., 450" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="mpAddMeal(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      üìù Add to Plan
    </button>
    <button type="button" onclick="mpGenerateShoppingList()"
            style="padding:12px 16px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;">
      üõí Shopping List
    </button>
    <button type="button" onclick="mpReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="mpCopyPlan()"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      Copy
    </button>
  </div>

  <!-- SAVE/LOAD OPTIONS -->
  <div style="margin-top:12px;display:flex;gap:12px;align-items:center;">
    <button type="button" onclick="mpSavePlan()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:13px;">
      üíæ Save Plan
    </button>
    <button type="button" onclick="mpLoadPlan()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:13px;">
      üìÇ Load Plan
    </button>
    <select id="mp-plan-template" style="margin-left:auto;padding:6px 12px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;">
      <option value="">Load Template...</option>
      <option value="vegetarian">Vegetarian Week</option>
      <option value="low-carb">Low Carb Week</option>
      <option value="family">Family Friendly</option>
      <option value="budget">Budget Meals</option>
    </select>
  </div>
</form>

<!-- WEEKLY PLANNER DISPLAY -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">üìÖ Weekly Meal Plan</h3>
    <div id="mp-status" style="color:rgba(230,250,255,0.7);font-size:13px;"></div>
  </div>

  <!-- DAYS GRID -->
  <div id="mp-plan-container" style="display:grid;grid-template-columns:repeat(7, 1fr);gap:8px;margin-bottom:16px;">
    <!-- Days will be populated here -->
  </div>

  <!-- STATISTICS -->
  <div style="margin-bottom:12px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">üìä Weekly Statistics:</div>
    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;font-size:13px;">
      <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
        <div style="color:rgba(230,250,255,0.6);">Total Meals</div>
        <div id="mp-stats-total" style="color:var(--accent);font-weight:600;font-size:16px;">0</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
        <div style="color:rgba(230,250,255,0.6);">Avg Prep Time</div>
        <div id="mp-stats-time" style="color:#ffa500;font-weight:600;font-size:16px;">0m</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
        <div style="color:rgba(230,250,255,0.6);">Avg Calories</div>
        <div id="mp-stats-calories" style="color:#39ff14;font-weight:600;font-size:16px;">0</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
        <div style="color:rgba(230,250,255,0.6);">Categories</div>
        <div id="mp-stats-categories" style="color:rgba(230,250,255,0.9);font-weight:600;font-size:16px;">0</div>
      </div>
    </div>
  </div>

  <!-- SHOPPING LIST -->
  <div id="mp-shopping-container" style="display:none;margin-top:12px;padding:12px;background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(255,165,0,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="color:#ffa500;font-weight:500;font-size:14px;">üõí Generated Shopping List:</div>
      <button type="button" onclick="mpHideShoppingList()" style="background:transparent;border:none;color:rgba(255,165,0,0.7);cursor:pointer;font-size:20px;">√ó</button>
    </div>
    <div id="mp-shopping-list" style="font-size:13px;color:rgba(230,250,255,0.9);line-height:1.5;">
      <!-- Shopping list will appear here -->
    </div>
    <button type="button" onclick="mpCopyShoppingList()" style="margin-top:8px;padding:6px 12px;background:rgba(255,165,0,0.2);border:1px solid rgba(255,165,0,0.4);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">
      Copy Shopping List
    </button>
  </div>

  <!-- HINT AND STATUS -->
  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div id="mp-hint" class="small" style="color:#39ff14;font-size:13px;flex:1;"></div>
    <div id="mp-summary" style="color:rgba(230,250,255,0.7);font-size:13px;"></div>
  </div>
</div>

<script>
/* meal-planner.html
   - Weekly meal planner with nutrition tracking
   - Scoped with mp- prefix (meal planner)
   - Includes shopping list generator and meal templates
*/

// MEAL DATABASE FOR QUICK IDEAS
const mpMealDatabase = {
  breakfast: [
    { name: "Oatmeal with Berries", category: "vegetarian", prep: 10, calories: 300 },
    { name: "Scrambled Eggs & Toast", category: "vegetarian", prep: 15, calories: 350 },
    { name: "Greek Yogurt Parfait", category: "vegetarian", prep: 5, calories: 250 },
    { name: "Avocado Toast", category: "vegan", prep: 10, calories: 320 },
    { name: "Smoothie Bowl", category: "vegan", prep: 15, calories: 280 }
  ],
  lunch: [
    { name: "Chicken Salad Wrap", category: "poultry", prep: 20, calories: 400 },
    { name: "Quinoa Bowl", category: "vegetarian", prep: 25, calories: 380 },
    { name: "Turkey Sandwich", category: "poultry", prep: 15, calories: 350 },
    { name: "Lentil Soup", category: "vegan", prep: 30, calories: 280 },
    { name: "Tuna Salad", category: "fish", prep: 20, calories: 320 }
  ],
  dinner: [
    { name: "Grilled Salmon", category: "fish", prep: 25, calories: 450 },
    { name: "Vegetable Stir Fry", category: "vegetarian", prep: 20, calories: 380 },
    { name: "Chicken Curry", category: "poultry", prep: 35, calories: 420 },
    { name: "Pasta Primavera", category: "vegetarian", prep: 25, calories: 400 },
    { name: "Beef Tacos", category: "meat", prep: 30, calories: 480 }
  ],
  vegetarian: [
    { name: "Vegetable Lasagna", category: "vegetarian", prep: 45, calories: 420 },
    { name: "Chickpea Curry", category: "vegan", prep: 30, calories: 380 },
    { name: "Stuffed Bell Peppers", category: "vegetarian", prep: 40, calories: 350 },
    { name: "Mushroom Risotto", category: "vegetarian", prep: 35, calories: 400 },
    { name: "Black Bean Burgers", category: "vegan", prep: 30, calories: 380 }
  ],
  quick: [
    { name: "Egg Fried Rice", category: "vegetarian", prep: 15, calories: 380 },
    { name: "Quesadillas", category: "vegetarian", prep: 10, calories: 320 },
    { name: "Pasta with Pesto", category: "vegetarian", prep: 15, calories: 400 },
    { name: "Greek Salad", category: "vegetarian", prep: 10, calories: 280 },
    { name: "Tuna Melt", category: "fish", prep: 15, calories: 350 }
  ]
};

// MEAL PLAN DATA STRUCTURE
let mpMealPlan = {
  monday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  tuesday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  wednesday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  thursday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  friday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  saturday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] },
  sunday: { breakfast: [], lunch: [], dinner: [], snack: [], dessert: [] }
};

// SHOPPING LIST INGREDIENTS
const mpIngredientsDatabase = {
  "Chicken": ["chicken breast", "olive oil", "salt", "pepper", "garlic"],
  "Salmon": ["salmon fillet", "lemon", "dill", "butter", "salt"],
  "Pasta": ["pasta", "tomato sauce", "garlic", "basil", "parmesan"],
  "Vegetable Stir Fry": ["mixed vegetables", "soy sauce", "ginger", "garlic", "sesame oil"],
  "Oatmeal": ["oats", "milk", "honey", "berries", "nuts"],
  "Salad": ["lettuce", "tomatoes", "cucumber", "olive oil", "vinegar"],
  "Tacos": ["tortillas", "ground beef", "lettuce", "cheese", "salsa"],
  "Curry": ["coconut milk", "curry powder", "onions", "chicken", "rice"],
  "Soup": ["vegetable broth", "carrots", "celery", "onions", "herbs"]
};

// INITIALIZE PLANNER
function mpInitializePlanner() {
  // Create day columns
  const container = document.getElementById('mp-plan-container');
  const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
  
  days.forEach(day => {
    const dayCol = document.createElement('div');
    dayCol.className = 'mp-day-column';
    dayCol.dataset.day = day;
    dayCol.style.cssText = `
      background: rgba(0,0,0,0.15);
      border-radius: 8px;
      border: 1px solid rgba(45,212,255,0.1);
      padding: 12px;
      min-height: 200px;
    `;
    
    const dayName = day.charAt(0).toUpperCase() + day.slice(1);
    dayCol.innerHTML = `
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;text-align:center;font-size:14px;">
        ${dayName}
      </div>
      <div id="mp-${day}-meals" class="mp-day-meals" style="min-height:160px;">
        <div style="color:rgba(230,250,255,0.4);text-align:center;font-size:12px;padding:20px 0;">
          No meals planned yet
        </div>
      </div>
    `;
    
    container.appendChild(dayCol);
  });
  
  // Load saved plan if exists
  mpLoadSavedPlan();
  
  // Update template selector
  document.getElementById('mp-plan-template').addEventListener('change', function() {
    if (this.value) {
      mpLoadTemplate(this.value);
      this.value = '';
    }
  });
}

// ADD MEAL TO PLAN
function mpAddMeal(btn) {
  const day = document.getElementById('mp-day').value;
  const mealType = document.getElementById('mp-meal-type').value;
  const category = document.getElementById('mp-category').value;
  const mealName = document.getElementById('mp-meal').value.trim();
  const prepTime = parseInt(document.getElementById('mp-prep-time').value) || 0;
  const calories = parseInt(document.getElementById('mp-calories').value) || 0;
  
  if (!mealName) {
    mpShowError('Please enter a meal name');
    return;
  }
  
  // Create meal object
  const meal = {
    id: Date.now(),
    name: mealName,
    type: mealType,
    category: category,
    prepTime: prepTime,
    calories: calories,
    timestamp: new Date().toISOString()
  };
  
  // Add to plan
  mpMealPlan[day][mealType].push(meal);
  
  // Update display
  mpUpdateDayDisplay(day);
  mpUpdateStatistics();
  
  // Reset form
  document.getElementById('mp-meal').value = '';
  document.getElementById('mp-prep-time').value = '';
  document.getElementById('mp-calories').value = '';
  
  // Show success message
  mpShowSuccess(`Added ${mealType} to ${day}: ${mealName}`);
  
  // Save plan
  mpSavePlanToStorage();
}

// UPDATE DAY DISPLAY
function mpUpdateDayDisplay(day) {
  const container = document.getElementById(`mp-${day}-meals`);
  const meals = mpMealPlan[day];
  const hasMeals = Object.values(meals).some(mealArray => mealArray.length > 0);
  
  if (!hasMeals) {
    container.innerHTML = `
      <div style="color:rgba(230,250,255,0.4);text-align:center;font-size:12px;padding:20px 0;">
        No meals planned yet
      </div>
    `;
    return;
  }
  
  let html = '';
  const mealTypes = ['breakfast', 'lunch', 'dinner', 'snack', 'dessert'];
  
  mealTypes.forEach(type => {
    const typeMeals = meals[type];
    if (typeMeals.length > 0) {
      const typeName = type.charAt(0).toUpperCase() + type.slice(1);
      html += `
        <div style="margin-bottom:8px;">
          <div style="color:rgba(230,250,255,0.6);font-size:11px;margin-bottom:4px;">
            ${typeName}:
          </div>
      `;
      
      typeMeals.forEach(meal => {
        html += `
          <div class="mp-meal-item" data-id="${meal.id}" 
               style="background:rgba(255,255,255,0.03);border-radius:6px;padding:6px;margin-bottom:4px;font-size:12px;position:relative;">
            <div style="color:rgba(230,250,255,0.9);margin-bottom:2px;">${meal.name}</div>
            <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(230,250,255,0.5);">
              <span>${meal.prepTime}m</span>
              <span>${meal.calories} cal</span>
              <span style="color:${mpGetCategoryColor(meal.category)};">${meal.category}</span>
            </div>
            <button onclick="mpRemoveMeal('${day}', '${type}', ${meal.id})" 
                    style="position:absolute;top:2px;right:2px;background:transparent;border:none;color:#ff4d4d;cursor:pointer;font-size:14px;padding:2px;line-height:1;">√ó</button>
          </div>
        `;
      });
      
      html += `</div>`;
    }
  });
  
  container.innerHTML = html;
}

// GET CATEGORY COLOR
function mpGetCategoryColor(category) {
  const colors = {
    'vegetarian': '#39ff14',
    'vegan': '#00ff99',
    'meat': '#ff4d4d',
    'fish': '#2dd4ff',
    'poultry': '#ffa500',
    'low-carb': '#9d4edd',
    'gluten-free': '#ffcc00'
  };
  return colors[category] || 'rgba(230,250,255,0.7)';
}

// REMOVE MEAL
function mpRemoveMeal(day, type, mealId) {
  mpMealPlan[day][type] = mpMealPlan[day][type].filter(meal => meal.id !== mealId);
  mpUpdateDayDisplay(day);
  mpUpdateStatistics();
  mpSavePlanToStorage();
  mpShowSuccess('Meal removed from plan');
}

// UPDATE STATISTICS
function mpUpdateStatistics() {
  let totalMeals = 0;
  let totalPrepTime = 0;
  let totalCalories = 0;
  const categories = new Set();
  
  Object.values(mpMealPlan).forEach(day => {
    Object.values(day).forEach(mealArray => {
      mealArray.forEach(meal => {
        totalMeals++;
        totalPrepTime += meal.prepTime;
        totalCalories += meal.calories;
        categories.add(meal.category);
      });
    });
  });
  
  document.getElementById('mp-stats-total').textContent = totalMeals;
  document.getElementById('mp-stats-time').textContent = totalMeals > 0 ? 
    Math.round(totalPrepTime / totalMeals) + 'm' : '0m';
  document.getElementById('mp-stats-calories').textContent = totalMeals > 0 ? 
    Math.round(totalCalories / totalMeals) : '0';
  document.getElementById('mp-stats-categories').textContent = categories.size;
  
  // Update summary
  document.getElementById('mp-summary').textContent = totalMeals > 0 ? 
    `${totalMeals} meals planned this week` : '';
}

// ADD QUICK MEAL
function mpAddQuickMeal(type) {
  const meals = mpMealDatabase[type];
  if (!meals || meals.length === 0) return;
  
  // Get random meal from category
  const randomMeal = meals[Math.floor(Math.random() * meals.length)];
  
  // Set form values
  document.getElementById('mp-meal-type').value = type === 'breakfast' || type === 'lunch' || type === 'dinner' ? type : 'dinner';
  document.getElementById('mp-category').value = randomMeal.category;
  document.getElementById('mp-meal').value = randomMeal.name;
  document.getElementById('mp-prep-time').value = randomMeal.prepTime;
  document.getElementById('mp-calories').value = randomMeal.calories;
  
  // Update hint
  mpShowHint(`Loaded ${type} idea: ${randomMeal.name}`, 'var(--accent)');
}

// SET PREP TIME
function mpSetPrepTime(minutes) {
  document.getElementById('mp-prep-time').value = minutes;
}

// GENERATE SHOPPING LIST
function mpGenerateShoppingList() {
  const allMeals = [];
  Object.values(mpMealPlan).forEach(day => {
    Object.values(day).forEach(mealArray => {
      mealArray.forEach(meal => allMeals.push(meal.name));
    });
  });
  
  if (allMeals.length === 0) {
    mpShowError('No meals planned yet');
    return;
  }
  
  // Collect ingredients
  const ingredients = new Set();
  allMeals.forEach(mealName => {
    // Find ingredients for this meal
    Object.entries(mpIngredientsDatabase).forEach(([meal, mealIngredients]) => {
      if (mealName.toLowerCase().includes(meal.toLowerCase()) || meal.toLowerCase().includes(mealName.toLowerCase())) {
        mealIngredients.forEach(ing => ingredients.add(ing));
      }
    });
  });
  
  // Add common ingredients
  const commonIngredients = ['salt', 'pepper', 'olive oil', 'garlic', 'onions'];
  commonIngredients.forEach(ing => ingredients.add(ing));
  
  // Display shopping list
  const container = document.getElementById('mp-shopping-container');
  const list = document.getElementById('mp-shopping-list');
  
  let html = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">';
  const sortedIngredients = Array.from(ingredients).sort();
  
  sortedIngredients.forEach((ingredient, index) => {
    html += `
      <div style="display:flex;align-items:center;gap:6px;padding:4px;">
        <input type="checkbox" id="shop-${index}" style="cursor:pointer;">
        <label for="shop-${index}" style="cursor:pointer;color:rgba(230,250,255,0.9);">${ingredient}</label>
      </div>
    `;
  });
  
  html += '</div>';
  list.innerHTML = html;
  container.style.display = 'block';
  
  mpShowSuccess('Shopping list generated!');
}

// HIDE SHOPPING LIST
function mpHideShoppingList() {
  document.getElementById('mp-shopping-container').style.display = 'none';
}

// COPY SHOPPING LIST
function mpCopyShoppingList() {
  const list = document.getElementById('mp-shopping-list');
  const items = list.querySelectorAll('label');
  let text = 'Shopping List\n\n';
  
  items.forEach(item => {
    text += `‚òê ${item.textContent}\n`;
  });
  
  navigator.clipboard.writeText(text).then(() => {
    mpShowSuccess('Shopping list copied!');
  }).catch(() => {
    // Fallback
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      mpShowSuccess('Copied!');
    } catch (err) {
      alert('Copy failed. Please select and copy manually.');
    }
    document.body.removeChild(textArea);
  });
}

// LOAD TEMPLATE
function mpLoadTemplate(templateName) {
  mpReset(); // Clear current plan
  
  const templates = {
    'vegetarian': [
      { day: 'monday', type: 'dinner', name: 'Vegetable Lasagna', category: 'vegetarian', prep: 45, calories: 420 },
      { day: 'tuesday', type: 'dinner', name: 'Chickpea Curry', category: 'vegan', prep: 30, calories: 380 },
      { day: 'wednesday', type: 'dinner', name: 'Stuffed Bell Peppers', category: 'vegetarian', prep: 40, calories: 350 },
      { day: 'thursday', type: 'dinner', name: 'Mushroom Risotto', category: 'vegetarian', prep: 35, calories: 400 },
      { day: 'friday', type: 'dinner', name: 'Black Bean Burgers', category: 'vegan', prep: 30, calories: 380 }
    ],
    'low-carb': [
      { day: 'monday', type: 'dinner', name: 'Grilled Chicken Salad', category: 'poultry', prep: 25, calories: 320 },
      { day: 'tuesday', type: 'dinner', name: 'Zucchini Noodles', category: 'vegetarian', prep: 20, calories: 280 },
      { day: 'wednesday', type: 'dinner', name: 'Baked Salmon', category: 'fish', prep: 30, calories: 350 },
      { day: 'thursday', type: 'dinner', name: 'Cauliflower Rice Bowl', category: 'vegetarian', prep: 25, calories: 300 },
      { day: 'friday', type: 'dinner', name: 'Beef Stir Fry', category: 'meat', prep: 25, calories: 380 }
    ],
    'family': [
      { day: 'monday', type
