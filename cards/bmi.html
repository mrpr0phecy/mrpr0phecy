<h2 id="bmi-title" style="margin-top:0;">BMI Calculator</h2>

<form aria-describedby="bmi-desc">
  <p id="bmi-desc" class="small">
    Calculate your Body Mass Index (BMI) and see which category you fall into. BMI is a simple screening tool for weight categories that may lead to health problems.
  </p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="bmi-height">Height</label>
      <div style="display:flex; align-items:center; gap:10px;">
        <input id="bmi-height" type="range" min="100" max="250" step="1" value="175" 
               style="flex:1;"
               oninput="updateHeightValue(this.value)" />
        <input id="bmi-height-input" type="number" min="100" max="250" step="0.1" value="175" 
               style="width:80px;"
               oninput="updateHeightSlider(this.value)" />
        <span style="white-space:nowrap;">cm</span>
      </div>
      <div class="small" style="display:flex; justify-content:space-between; margin-top:4px;">
        <span>100 cm</span>
        <span>175 cm</span>
        <span>250 cm</span>
      </div>
    </div>

    <div class="field">
      <label for="bmi-weight">Weight</label>
      <div style="display:flex; align-items:center; gap:10px;">
        <input id="bmi-weight" type="range" min="30" max="200" step="0.5" value="70" 
               style="flex:1;"
               oninput="updateWeightValue(this.value)" />
        <input id="bmi-weight-input" type="number" min="30" max="200" step="0.1" value="70" 
               style="width:80px;"
               oninput="updateWeightSlider(this.value)" />
        <span style="white-space:nowrap;">kg</span>
      </div>
      <div class="small" style="display:flex; justify-content:space-between; margin-top:4px;">
        <span>30 kg</span>
        <span>70 kg</span>
        <span>200 kg</span>
      </div>
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="bmiCalc(this)">Calculate BMI</button>
    <button type="button" class="secondary" onclick="bmiReset(this)">Reset</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <div style="display:flex; flex-wrap:wrap; gap:12px; margin-bottom:15px;">
    <div class="result" style="flex:1; min-width:120px; text-align:center;">
      <div class="label">BMI Value</div>
      <div class="value" id="bmi-res" style="font-size:2em;">–</div>
      <div class="small" id="bmi-formula">kg/m²</div>
    </div>
    
    <div class="result" style="flex:2; min-width:200px;">
      <div class="label">Category</div>
      <div class="value" id="bmi-category" style="font-size:1.5em; margin-bottom:8px;">–</div>
      <div class="small" id="bmi-range">Range: <span id="bmi-range-value">–</span></div>
      <div id="bmi-recommendation" class="small" style="margin-top:6px;"></div>
    </div>
  </div>

  <!-- BMI Scale Visualization -->
  <div style="margin-top:20px;">
    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
      <span class="small">BMI Scale</span>
      <span class="small">Your position: <span id="bmi-position">–</span></span>
    </div>
    
    <div id="bmi-scale" style="height:30px; background:linear-gradient(to right, #4dabf7, #51cf66, #ffd43b, #fa5252); border-radius:15px; position:relative;">
      <div id="bmi-marker" style="position:absolute; top:-5px; width:8px; height:40px; background:#495057; border-radius:4px; display:none;"></div>
    </div>
    
    <div style="display:flex; justify-content:space-between; margin-top:8px;">
      <div style="text-align:center;">
        <div class="small" style="color:#4dabf7; font-weight:500;">Underweight</div>
        <div class="small">&lt; 18.5</div>
      </div>
      <div style="text-align:center;">
        <div class="small" style="color:#51cf66; font-weight:500;">Normal</div>
        <div class="small">18.5 – 24.9</div>
      </div>
      <div style="text-align:center;">
        <div class="small" style="color:#ffd43b; font-weight:500;">Overweight</div>
        <div class="small">25 – 29.9</div>
      </div>
      <div style="text-align:center;">
        <div class="small" style="color:#fa5252; font-weight:500;">Obese</div>
        <div class="small">≥ 30</div>
      </div>
    </div>
  </div>

  <!-- Health Information -->
  <div id="bmi-health-info" style="display:none; margin-top:20px; padding:12px; background:#f8f9fa; border-radius:6px; border-left:4px solid #4dabf7;">
    <div class="small" style="font-weight:500; margin-bottom:6px;">Health Information</div>
    <div id="health-details" class="small"></div>
  </div>
</div>

<details class="small" style="margin-top:12px;">
  <summary>How BMI Works & Important Notes</summary>
  <div style="padding:8px 0;">
    <p><strong>BMI Formula:</strong> BMI = Weight (kg) ÷ (Height (m)²)</p>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:10px 0;">
      <div style="padding:8px; background:#f8f9fa; border-radius:4px;">
        <strong style="color:#4dabf7;">Categories (WHO):</strong>
        <ul style="margin:6px 0 0 0; padding-left:18px;">
          <li>Underweight: &lt; 18.5</li>
          <li>Normal: 18.5 – 24.9</li>
          <li>Overweight: 25 – 29.9</li>
          <li>Obese Class I: 30 – 34.9</li>
          <li>Obese Class II: 35 – 39.9</li>
          <li>Obese Class III: ≥ 40</li>
        </ul>
      </div>
      
      <div style="padding:8px; background:#f8f9fa; border-radius:4px;">
        <strong style="color:#fa5252;">Limitations:</strong>
        <ul style="margin:6px 0 0 0; padding-left:18px;">
          <li>Doesn't distinguish muscle from fat</li>
          <li>Not suitable for athletes</li>
          <li>Doesn't account for age or sex</li>
          <li>Not accurate for children or elderly</li>
        </ul>
      </div>
    </div>
    
    <p style="color:#fa5252; font-weight:500;">
      BMI is a screening tool, not a diagnostic measure. Consult a healthcare professional for personalized advice.
    </p>
  </div>
</details>

<script>
// Initialize sliders and inputs
document.addEventListener('DOMContentLoaded', function() {
  // Set initial values
  updateHeightValue(175);
  updateWeightValue(70);
  
  // Calculate on initial load
  setTimeout(() => bmiCalc(document.querySelector('button')), 100);
});

// Update height slider and input
function updateHeightValue(value) {
  document.getElementById('bmi-height').value = value;
  document.getElementById('bmi-height-input').value = value;
  
  // Auto-calculate if both values are valid
  autoCalculate();
}

// Update height input from manual entry
function updateHeightSlider(value) {
  let numValue = parseFloat(value);
  if (isNaN(numValue) || numValue < 100) numValue = 100;
  if (numValue > 250) numValue = 250;
  
  updateHeightValue(numValue);
}

// Update weight slider and input
function updateWeightValue(value) {
  document.getElementById('bmi-weight').value = value;
  document.getElementById('bmi-weight-input').value = value;
  
  // Auto-calculate if both values are valid
  autoCalculate();
}

// Update weight input from manual entry
function updateWeightSlider(value) {
  let numValue = parseFloat(value);
  if (isNaN(numValue) || numValue < 30) numValue = 30;
  if (numValue > 200) numValue = 200;
  
  updateWeightValue(numValue);
}

// Auto-calculate when values change
function autoCalculate() {
  const height = parseFloat(document.getElementById('bmi-height').value);
  const weight = parseFloat(document.getElementById('bmi-weight').value);
  
  if (height > 0 && weight > 0) {
    bmiCalc(document.querySelector('button'));
  }
}

// Main BMI calculation function
function bmiCalc(btn) {
  const heightCm = parseFloat(document.getElementById('bmi-height').value) || 0;
  const weightKg = parseFloat(document.getElementById('bmi-weight').value) || 0;

  if (heightCm <= 0 || weightKg <= 0) {
    showError();
    return;
  }

  const heightM = heightCm / 100;
  const bmi = weightKg / (heightM * heightM);
  const bmiRounded = Math.round(bmi * 10) / 10;

  // Determine category and color
  let category = "";
  let categoryColor = "";
  let range = "";
  let recommendation = "";
  let healthInfo = "";
  
  if (bmi < 16) {
    category = "Severely Underweight";
    categoryColor = "#4dabf7";
    range = "< 16";
    recommendation = "Consult a healthcare provider for guidance on healthy weight gain.";
    healthInfo = "Severely underweight individuals may be at risk for nutritional deficiencies, osteoporosis, and weakened immune system.";
  } else if (bmi < 18.5) {
    category = "Underweight";
    categoryColor = "#4dabf7";
    range = "16 – 18.4";
    recommendation = "Consider consulting a nutritionist for healthy weight gain strategies.";
    healthInfo = "Being underweight can lead to nutrient deficiencies, weakened immune function, and osteoporosis.";
  } else if (bmi < 25) {
    category = "Normal Weight";
    categoryColor = "#51cf66";
    range = "18.5 – 24.9";
    recommendation = "Maintain your current weight with a balanced diet and regular exercise.";
    healthInfo = "Congratulations! You're in a healthy weight range. Continue with balanced nutrition and regular physical activity.";
  } else if (bmi < 30) {
    category = "Overweight";
    categoryColor = "#ffd43b";
    range = "25 – 29.9";
    recommendation = "Consider increasing physical activity and adopting a balanced diet.";
    healthInfo = "Overweight individuals have increased risk for hypertension, heart disease, and type 2 diabetes.";
  } else if (bmi < 35) {
    category = "Obese (Class I)";
    categoryColor = "#fa5252";
    range = "30 – 34.9";
    recommendation = "Consult a healthcare provider for personalized weight management advice.";
    healthInfo = "Obesity increases risk of heart disease, stroke, type 2 diabetes, and certain cancers.";
  } else if (bmi < 40) {
    category = "Obese (Class II)";
    categoryColor = "#e03131";
    range = "35 – 39.9";
    recommendation = "Medical supervision recommended for weight management.";
    healthInfo = "Severe obesity significantly increases health risks. Consult with healthcare professionals.";
  } else {
    category = "Obese (Class III)";
    categoryColor = "#c92a2a";
    range = "≥ 40";
    recommendation = "Immediate medical consultation recommended.";
    healthInfo = "Morbid obesity requires medical intervention. Please consult with healthcare professionals.";
  }

  // Update results display
  const bmiRes = document.getElementById('bmi-res');
  bmiRes.textContent = bmiRounded;
  bmiRes.style.color = categoryColor;
  
  const bmiCategory = document.getElementById('bmi-category');
  bmiCategory.textContent = category;
  bmiCategory.style.color = categoryColor;
  
  const bmiRangeValue = document.getElementById('bmi-range-value');
  bmiRangeValue.textContent = range;
  bmiRangeValue.style.color = categoryColor;
  
  const bmiRecommendation = document.getElementById('bmi-recommendation');
  bmiRecommendation.textContent = recommendation;
  bmiRecommendation.style.color = categoryColor;
  
  // Update formula display
  document.getElementById('bmi-formula').textContent = 
    `= ${weightKg} ÷ (${heightM.toFixed(2)}m)² = ${bmiRounded}`;
  
  // Update BMI scale marker
  updateBMIScale(bmi);
  
  // Update position indicator
  const bmiPosition = document.getElementById('bmi-position');
  bmiPosition.textContent = bmiRounded;
  bmiPosition.style.color = categoryColor;
  
  // Show health information
  document.getElementById('health-details').textContent = healthInfo;
  const healthInfoDiv = document.getElementById('bmi-health-info');
  healthInfoDiv.style.display = 'block';
  healthInfoDiv.style.borderLeftColor = categoryColor;
  
  // Add celebration for normal weight
  if (category === "Normal Weight") {
    celebrateNormalBMI();
  }
}

// Update the BMI scale visualization
function updateBMIScale(bmi) {
  const marker = document.getElementById('bmi-marker');
  
  // Calculate position (BMI scale from 15 to 45 for visualization)
  let position = ((bmi - 15) / 30) * 100;
  if (position < 0) position = 0;
  if (position > 100) position = 100;
  
  marker.style.left = `calc(${position}% - 4px)`;
  marker.style.display = 'block';
}

// Show error state
function showError() {
  document.getElementById('bmi-res').textContent = "–";
  document.getElementById('bmi-category').textContent = "Invalid input";
  document.getElementById('bmi-category').style.color = "#fa5252";
  document.getElementById('bmi-range-value').textContent = "–";
  document.getElementById('bmi-recommendation').textContent = "Please enter valid height and weight values.";
  document.getElementById('bmi-recommendation').style.color = "#fa5252";
  document.getElementById('bmi-position').textContent = "–";
  document.getElementById('bmi-marker').style.display = 'none';
  document.getElementById('bmi-health-info').style.display = 'none';
}

// Reset function
function bmiReset(btn) {
  updateHeightValue(175);
  updateWeightValue(70);
  bmiCalc(btn);
}

// Celebration for normal BMI
function celebrateNormalBMI() {
  const resultDiv = document.getElementById('bmi-res');
  
  // Add pulsing animation
  resultDiv.style.animation = 'bmiPulse 1s ease-in-out';
  
  // Create animation if it doesn't exist
  if (!document.getElementById('bmi-animation-style')) {
    const style = document.createElement('style');
    style.id = 'bmi-animation-style';
    style.textContent = `
      @keyframes bmiPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
  }
  
  // Remove animation after it completes
  setTimeout(() => {
    resultDiv.style.animation = '';
  }, 1000);
}
</script>

<style>
/* Additional styling for better integration */
input[type="range"] {
  -webkit-appearance: none;
  height: 6px;
  background: #e9ecef;
  border-radius: 3px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  background: #4dabf7;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: #4dabf7;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

input[type="number"] {
  padding: 6px 8px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  font-size: 0.95em;
}

input[type="number"]:focus {
  border-color: #4dabf7;
  outline: none;
  box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.2);
}

.result .value {
  font-weight: 600;
  margin: 4px 0;
}

.results {
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}

.results .result {
  padding: 12px;
  background: white;
  border-radius: 6px;
  border: 1px solid #dee2e6;
}

#bmi-scale {
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

#bmi-marker {
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  transition: left 0.3s ease;
}

.actions button {
  transition: all 0.2s;
}

.actions button:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
