<h2 id="bmi-title" style="margin-top:0;color:var(--accent);position:relative;">
  ‚öïÔ∏è BMI Calculator
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:var(--accent);font-weight:normal;">
    Health Tool
  </span>
</h2>

<form aria-describedby="bmi-desc">
  <p id="bmi-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Calculate your Body Mass Index (BMI) with accurate WHO classification. BMI is a simple screening tool for weight categories that may lead to health problems.
  </p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <!-- Height Input -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(45,212,255,0.3);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <label for="bmi-height" style="color:var(--accent);font-weight:500;">üìè Height</label>
        <span id="bmi-height-display" style="font-size:0.9rem;color:#39ff14;">175 cm</span>
      </div>
      
      <div style="margin-bottom:12px;">
        <input id="bmi-height" type="range" min="100" max="250" step="1" value="175" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(45,212,255,0.1);outline:none;accent-color:var(--accent);" />
      </div>
      
      <div style="display:flex;align-items:center;gap:12px;">
        <input id="bmi-height-input" type="number" min="100" max="250" step="0.1" value="175" 
               style="flex:1;padding:12px;border-radius:8px;border:2px solid rgba(45,212,255,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:1rem;" />
        <div style="display:flex;gap:8px;">
          <button type="button" onclick="bmiSetHeightUnit('cm')" style="padding:6px 12px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);border-radius:6px;color:var(--accent);cursor:pointer;">cm</button>
          <button type="button" onclick="bmiSetHeightUnit('in')" style="padding:6px 12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">in</button>
        </div>
      </div>
      
      <div class="small" style="display:flex;justify-content:space-between;margin-top:8px;color:rgba(230,250,255,0.7);">
        <span>100 cm</span>
        <span>250 cm</span>
      </div>
    </div>

    <!-- Weight Input -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(57,255,20,0.3);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <label for="bmi-weight" style="color:var(--accent);font-weight:500;">‚öñÔ∏è Weight</label>
        <span id="bmi-weight-display" style="font-size:0.9rem;color:#39ff14;">70 kg</span>
      </div>
      
      <div style="margin-bottom:12px;">
        <input id="bmi-weight" type="range" min="30" max="200" step="0.5" value="70" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(57,255,20,0.1);outline:none;accent-color:#39ff14;" />
      </div>
      
      <div style="display:flex;align-items:center;gap:12px;">
        <input id="bmi-weight-input" type="number" min="30" max="200" step="0.1" value="70" 
               style="flex:1;padding:12px;border-radius:8px;border:2px solid rgba(57,255,20,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:1rem;" />
        <div style="display:flex;gap:8px;">
          <button type="button" onclick="bmiSetWeightUnit('kg')" style="padding:6px 12px;background:rgba(57,255,20,0.2);border:2px solid #39ff14;border-radius:6px;color:#39ff14;cursor:pointer;">kg</button>
          <button type="button" onclick="bmiSetWeightUnit('lb')" style="padding:6px 12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">lb</button>
        </div>
      </div>
      
      <div class="small" style="display:flex;justify-content:space-between;margin-top:8px;color:rgba(230,250,255,0.7);">
        <span>30 kg</span>
        <span>200 kg</span>
      </div>
    </div>
  </div>

  <!-- Age and Gender Inputs -->
  <div style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(255,204,0,0.3);margin-bottom:20px;">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üë§ Additional Factors (Optional)</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
      <div>
        <label for="bmi-age" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-size:0.9rem;">Age</label>
        <input id="bmi-age" type="number" min="18" max="100" placeholder="Optional" 
               style="width:100%;padding:12px;border-radius:8px;border:2px solid rgba(255,204,0,0.3);background:rgba(20,20,20,0.8);color:inherit;" />
      </div>
      <div>
        <div style="margin-bottom:8px;color:rgba(230,250,255,0.9);font-size:0.9rem;">Gender</div>
        <div style="display:flex;gap:8px;">
          <button type="button" onclick="bmiSetGender('male')" style="flex:1;padding:12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">Male</button>
          <button type="button" onclick="bmiSetGender('female')" style="flex:1;padding:12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">Female</button>
          <button type="button" onclick="bmiSetGender('other')" style="flex:1;padding:12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">Other</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="bmiCalculate()" id="bmi-calculate-btn"
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(20,20,20,0.8));border:2px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      üßÆ Calculate BMI
    </button>
    <button type="button" onclick="bmiCalculateIdeal()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:2px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      üéØ Ideal Weight
    </button>
    <button type="button" onclick="bmiReset()" id="bmi-reset-btn"
            style="padding:14px;background:rgba(255,77,77,0.1);border:2px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      üîÑ Reset
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Primary Results -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.07), rgba(20,20,20,0.9));border-radius:12px;padding:20px;border:2px solid rgba(45,212,255,0.2);margin-bottom:16px;box-shadow:0 8px 32px rgba(0,0,0,0.4);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">üìä BMI Results</h3>
      <button onclick="bmiCopyResults()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        üìã Copy
      </button>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(45,212,255,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">‚öïÔ∏è BMI Value</div>
        <div id="bmi-value" style="font-size:2.5rem;font-weight:700;color:var(--accent);">‚Äì</div>
        <div id="bmi-formula" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:8px;">kg/m¬≤</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(57,255,20,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">üìã Category</div>
        <div id="bmi-category" style="font-size:1.4rem;font-weight:600;color:#39ff14;margin-bottom:8px;">‚Äì</div>
        <div id="bmi-range" style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Range: ‚Äì</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(255,204,0,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">üí™ Healthy Range</div>
        <div style="font-size:1.4rem;font-weight:600;color:#ffcc00;">18.5 ‚Äì 24.9</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:8px;">WHO Standard</div>
      </div>
    </div>
    
    <!-- BMI Scale Visualization -->
    <div style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
        <span style="color:var(--accent);font-weight:500;">üìà BMI Scale (WHO Classification)</span>
        <span id="bmi-position-indicator" style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Your position: ‚Äì</span>
      </div>
      
      <div style="height:30px;background:linear-gradient(90deg, #4dabf7, #51cf66, #ffd43b, #fa5252, #e03131, #c92a2a);border-radius:15px;position:relative;border:1px solid rgba(255,255,255,0.1);">
        <div id="bmi-marker" style="position:absolute;top:-8px;width:12px;height:46px;background:#ffffff;border-radius:6px;border:2px solid var(--accent);display:none;box-shadow:0 0 10px rgba(45,212,255,0.5);z-index:10;"></div>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(6,1fr);margin-top:12px;">
        <div style="text-align:center;">
          <div class="small" style="color:#4dabf7;font-weight:500;">Underweight</div>
          <div class="small">&lt; 18.5</div>
        </div>
        <div style="text-align:center;">
          <div class="small" style="color:#51cf66;font-weight:500;">Normal</div>
          <div class="small">18.5 ‚Äì 24.9</div>
        </div>
        <div style="text-align:center;">
          <div class="small" style="color:#ffd43b;font-weight:500;">Overweight</div>
          <div class="small">25 ‚Äì 29.9</div>
        </div>
        <div style="text-align:center;">
          <div class="small" style="color:#fa5252;font-weight:500;">Obese I</div>
          <div class="small">30 ‚Äì 34.9</div>
        </div>
        <div style="text-align:center;">
          <div class="small" style="color:#e03131;font-weight:500;">Obese II</div>
          <div class="small">35 ‚Äì 39.9</div>
        </div>
        <div style="text-align:center;">
          <div class="small" style="color:#c92a2a;font-weight:500;">Obese III</div>
          <div class="small">‚â• 40</div>
        </div>
      </div>
    </div>
    
    <!-- Health Recommendations -->
    <div id="bmi-health-info" style="display:none;margin-top:20px;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(45,212,255,0.2);">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
        <span style="color:var(--accent);font-weight:500;font-size:1.1rem;">üí° Health Information</span>
      </div>
      <div id="health-details" style="color:rgba(230,250,255,0.9);font-size:0.95rem;line-height:1.5;"></div>
      <div id="bmi-recommendation" style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.1);border-radius:6px;border-left:4px solid #39ff14;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üéØ Recommendation:</div>
        <div id="recommendation-text" style="color:rgba(230,250,255,0.9);font-size:0.9rem;">‚Äì</div>
      </div>
    </div>
  </div>

  <!-- Ideal Weight Calculator -->
  <div id="bmi-ideal-weight" style="display:none;background:rgba(20,20,20,0.9);border-radius:12px;padding:20px;border:2px solid rgba(57,255,20,0.3);margin-bottom:16px;">
    <h3 style="color:#39ff14;margin:0 0 16px 0;font-size:1.1rem;">üéØ Ideal Weight Range</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(57,255,20,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">Minimum Healthy</div>
        <div id="ideal-min" style="font-size:1.8rem;font-weight:700;color:#39ff14;">‚Äì</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">BMI 18.5</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(57,255,20,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">Optimal Range</div>
        <div id="ideal-optimal" style="font-size:1.8rem;font-weight:700;color:#ffcc00;">‚Äì</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">BMI 21‚Äì22</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(57,255,20,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">Maximum Healthy</div>
        <div id="ideal-max" style="font-size:1.8rem;font-weight:700;color:#39ff14;">‚Äì</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">BMI 24.9</div>
      </div>
    </div>
    
    <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:6px;border:1px solid rgba(57,255,20,0.2);">
      <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üìä Weight Analysis:</div>
      <div id="ideal-analysis" style="color:rgba(230,250,255,0.9);font-size:0.9rem;">‚Äì</div>
    </div>
  </div>

  <!-- Important Disclaimer -->
  <div style="background:rgba(30,0,0,0.6);border-radius:12px;padding:20px;border:2px solid rgba(255,77,77,0.3);">
    <div style="color:#ff6b6b;font-weight:600;margin-bottom:8px;">‚ö†Ô∏è Medical Disclaimer</div>
    <div style="font-size:0.9rem;color:rgba(255,200,200,0.9);">
      BMI is a screening tool, not a diagnostic measure. It has limitations and doesn't account for:
      <ul style="margin:8px 0 8px 20px;">
        <li>Muscle mass vs. body fat</li>
        <li>Bone density and body frame</li>
        <li>Age, sex, and ethnic differences</li>
        <li>Fat distribution patterns</li>
      </ul>
      <strong>Consult a healthcare professional</strong> for personalized health assessment and advice.
      <div style="margin-top:8px;font-size:0.85rem;color:rgba(255,200,200,0.7);">
        Source: World Health Organization (WHO) BMI Classification
      </div>
    </div>
  </div>
</div>

<script>
/* bmi-calculator.html
   - Fully functional BMI calculator with WHO classification
   - Scoped with bmi- prefix
   - Unit conversion support (cm/in, kg/lb)
*/

// Global configuration
let bmiHeightUnit = 'cm';
let bmiWeightUnit = 'kg';
let bmiGender = null;
let bmiAge = null;

// Initialize the calculator
function bmiInit() {
    // Set up input synchronization
    bmiSyncInputs();
    
    // Auto-calculate when inputs change
    ['#bmi-height-input', '#bmi-weight-input'].forEach(selector => {
        const input = document.querySelector(selector);
        if (input) {
            input.addEventListener('input', () => {
                setTimeout(() => bmiCalculate(), 500);
            });
        }
    });
    
    // Initial calculation
    setTimeout(() => bmiCalculate(), 300);
}

// Synchronize sliders with number inputs
function bmiSyncInputs() {
    // Height sync
    const heightSlider = document.querySelector('#bmi-height');
    const heightInput = document.querySelector('#bmi-height-input');
    const heightDisplay = document.querySelector('#bmi-height-display');
    
    if (heightSlider && heightInput && heightDisplay) {
        heightSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            heightInput.value = value;
            heightDisplay.textContent = value + ' cm';
        });
        
        heightInput.addEventListener('input', function() {
            let value = parseFloat(this.value) || 100;
            value = Math.min(250, Math.max(100, value));
            heightSlider.value = value;
            heightDisplay.textContent = value + ' cm';
        });
    }
    
    // Weight sync
    const weightSlider = document.querySelector('#bmi-weight');
    const weightInput = document.querySelector('#bmi-weight-input');
    const weightDisplay = document.querySelector('#bmi-weight-display');
    
    if (weightSlider && weightInput && weightDisplay) {
        weightSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            weightInput.value = value;
            weightDisplay.textContent = value + ' kg';
        });
        
        weightInput.addEventListener('input', function() {
            let value = parseFloat(this.value) || 30;
            value = Math.min(200, Math.max(30, value));
            weightSlider.value = value;
            weightDisplay.textContent = value + ' kg';
        });
    }
}

// Set height unit
function bmiSetHeightUnit(unit) {
    bmiHeightUnit = unit;
    
    const heightCmBtn = document.querySelector('[onclick="bmiSetHeightUnit(\'cm\')"]');
    const heightInBtn = document.querySelector('[onclick="bmiSetHeightUnit(\'in\')"]');
    const heightInput = document.querySelector('#bmi-height-input');
    const heightSlider = document.querySelector('#bmi-height');
    const heightDisplay = document.querySelector('#bmi-height-display');
    
    if (!heightInput || !heightSlider) return;
    
    let currentValue = parseFloat(heightInput.value) || 175;
    
    if (unit === 'cm') {
        // Convert inches to centimeters
        if (bmiHeightUnit === 'in') {
            currentValue = Math.round(currentValue * 2.54);
        }
        heightSlider.min = 100;
        heightSlider.max = 250;
        heightSlider.step = 1;
        
        // Update buttons
        if (heightCmBtn) {
            heightCmBtn.style.background = 'rgba(45,212,255,0.2)';
            heightCmBtn.style.border = '2px solid var(--accent)';
            heightCmBtn.style.color = 'var(--accent)';
        }
        if (heightInBtn) {
            heightInBtn.style.background = 'rgba(20,20,20,0.8)';
            heightInBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            heightInBtn.style.color = 'inherit';
        }
    } else if (unit === 'in') {
        // Convert centimeters to inches
        if (bmiHeightUnit === 'cm') {
            currentValue = Math.round(currentValue / 2.54);
        }
        heightSlider.min = 40;
        heightSlider.max = 100;
        heightSlider.step = 0.5;
        
        // Update buttons
        if (heightCmBtn) {
            heightCmBtn.style.background = 'rgba(20,20,20,0.8)';
            heightCmBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            heightCmBtn.style.color = 'inherit';
        }
        if (heightInBtn) {
            heightInBtn.style.background = 'rgba(45,212,255,0.2)';
            heightInBtn.style.border = '2px solid var(--accent)';
            heightInBtn.style.color = 'var(--accent)';
        }
    }
    
    // Apply bounds
    currentValue = Math.min(heightSlider.max, Math.max(heightSlider.min, currentValue));
    
    // Update values
    heightInput.value = currentValue;
    heightSlider.value = currentValue;
    heightDisplay.textContent = currentValue + ' ' + unit;
    
    // Auto-calculate
    setTimeout(() => bmiCalculate(), 100);
}

// Set weight unit
function bmiSetWeightUnit(unit) {
    bmiWeightUnit = unit;
    
    const weightKgBtn = document.querySelector('[onclick="bmiSetWeightUnit(\'kg\')"]');
    const weightLbBtn = document.querySelector('[onclick="bmiSetWeightUnit(\'lb\')"]');
    const weightInput = document.querySelector('#bmi-weight-input');
    const weightSlider = document.querySelector('#bmi-weight');
    const weightDisplay = document.querySelector('#bmi-weight-display');
    
    if (!weightInput || !weightSlider) return;
    
    let currentValue = parseFloat(weightInput.value) || 70;
    
    if (unit === 'kg') {
        // Convert pounds to kilograms
        if (bmiWeightUnit === 'lb') {
            currentValue = Math.round((currentValue / 2.20462) * 10) / 10;
        }
        weightSlider.min = 30;
        weightSlider.max = 200;
        weightSlider.step = 0.5;
        
        // Update buttons
        if (weightKgBtn) {
            weightKgBtn.style.background = 'rgba(57,255,20,0.2)';
            weightKgBtn.style.border = '2px solid #39ff14';
            weightKgBtn.style.color = '#39ff14';
        }
        if (weightLbBtn) {
            weightLbBtn.style.background = 'rgba(20,20,20,0.8)';
            weightLbBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            weightLbBtn.style.color = 'inherit';
        }
    } else if (unit === 'lb') {
        // Convert kilograms to pounds
        if (bmiWeightUnit === 'kg') {
            currentValue = Math.round(currentValue * 2.20462 * 10) / 10;
        }
        weightSlider.min = 66;
        weightSlider.max = 440;
        weightSlider.step = 0.5;
        
        // Update buttons
        if (weightKgBtn) {
            weightKgBtn.style.background = 'rgba(20,20,20,0.8)';
            weightKgBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            weightKgBtn.style.color = 'inherit';
        }
        if (weightLbBtn) {
            weightLbBtn.style.background = 'rgba(57,255,20,0.2)';
            weightLbBtn.style.border = '2px solid #39ff14';
            weightLbBtn.style.color = '#39ff14';
        }
    }
    
    // Apply bounds
    currentValue = Math.min(weightSlider.max, Math.max(weightSlider.min, currentValue));
    
    // Update values
    weightInput.value = currentValue;
    weightSlider.value = currentValue;
    weightDisplay.textContent = currentValue + ' ' + unit;
    
    // Auto-calculate
    setTimeout(() => bmiCalculate(), 100);
}

// Set gender
function bmiSetGender(gender) {
    bmiGender = gender;
    
    // Update buttons
    ['male', 'female', 'other'].forEach(g => {
        const btn = document.querySelector(`[onclick="bmiSetGender('${g}')"]`);
        if (btn) {
            if (g === gender) {
                btn.style.background = 'rgba(45,212,255,0.2)';
                btn.style.border = '2px solid var(--accent)';
                btn.style.color = 'var(--accent)';
            } else {
                btn.style.background = 'rgba(20,20,20,0.8)';
                btn.style.border = '2px solid rgba(255,255,255,0.1)';
                btn.style.color = 'inherit';
            }
        }
    });
}

// Main calculation function
function bmiCalculate() {
    const heightInput = document.querySelector('#bmi-height-input');
    const weightInput = document.querySelector('#bmi-weight-input');
    const ageInput = document.querySelector('#bmi-age');
    const calculateBtn = document.querySelector('#bmi-calculate-btn');
    
    if (!heightInput || !weightInput) return;
    
    // Get and convert values
    let heightCm = parseFloat(heightInput.value) || 0;
    let weightKg = parseFloat(weightInput.value) || 0;
    
    // Convert to metric if needed
    if (bmiHeightUnit === 'in') {
        heightCm = heightCm * 2.54; // Convert inches to cm
    }
    
    if (bmiWeightUnit === 'lb') {
        weightKg = weightKg / 2.20462; // Convert pounds to kg
    }
    
    // Get age if provided
    bmiAge = ageInput ? parseFloat(ageInput.value) : null;
    
    // Validate inputs
    if (heightCm <= 0 || weightKg <= 0) {
        bmiShowError('Please enter valid height and weight');
        return;
    }
    
    // Visual feedback
    if (calculateBtn) {
        calculateBtn.innerHTML = '‚è≥ Calculating...';
        calculateBtn.disabled = true;
    }
    
    setTimeout(() => {
        // Calculate BMI
        const heightM = heightCm / 100;
        const bmi = weightKg / (heightM * heightM);
        const bmiRounded = Math.round(bmi * 10) / 10;
        
        // Get BMI category and details
        const category = bmiGetCategory(bmi);
        
        // Display results
        bmiDisplayResults(bmiRounded, category, heightCm, weightKg, heightM);
        
        // Calculate ideal weight
        bmiCalculateIdealWeight(heightM);
        
        // Show health info
        bmiShowHealthInfo(bmi, category);
        
        // Reset button
        if (calculateBtn) {
            calculateBtn.innerHTML = '‚úÖ Calculated';
            setTimeout(() => {
                calculateBtn.innerHTML = 'üßÆ Calculate BMI';
                calculateBtn.disabled = false;
            }, 1000);
        }
    }, 300);
}

// Get BMI category based on WHO classification
function bmiGetCategory(bmi) {
    if (bmi < 16) {
        return {
            name: 'Severely Underweight',
            color: '#4dabf7',
            range: '< 16',
            risk: 'Very high'
        };
    } else if (bmi < 17) {
        return {
            name: 'Moderately Underweight',
            color: '#4dabf7',
            range: '16 ‚Äì 16.9',
            risk: 'High'
        };
    } else if (bmi < 18.5) {
        return {
            name: 'Mildly Underweight',
            color: '#4dabf7',
            range: '17 ‚Äì 18.4',
            risk: 'Moderate'
        };
    } else if (bmi < 25) {
        return {
            name: 'Normal Weight',
            color: '#51cf66',
            range: '18.5 ‚Äì 24.9',
            risk: 'Low'
        };
    } else if (bmi < 30) {
        return {
            name: 'Overweight',
            color: '#ffd43b',
            range: '25 ‚Äì 29.9',
            risk: 'Increased'
        };
    } else if (bmi < 35) {
        return {
            name: 'Obese Class I',
            color: '#fa5252',
            range: '30 ‚Äì 34.9',
            risk: 'High'
        };
    } else if (bmi < 40) {
        return {
            name: 'Obese Class II',
            color: '#e03131',
            range: '35 ‚Äì 39.9',
            risk: 'Very high'
        };
    } else {
        return {
            name: 'Obese Class III',
            color: '#c92a2a',
            range: '‚â• 40',
            risk: 'Extremely high'
        };
    }
}

// Display BMI results
function bmiDisplayResults(bmi, category, heightCm, weightKg, heightM) {
    // Update main results
    const bmiValue = document.querySelector('#bmi-value');
    const bmiFormula = document.querySelector('#bmi-formula');
    const bmiCategory = document.querySelector('#bmi-category');
    const bmiRange = document.querySelector('#bmi-range');
    const positionIndicator = document.querySelector('#bmi-position-indicator');
    
    if (bmiValue) {
        bmiValue.textContent = bmi;
        bmiValue.style.color = category.color;
    }
    
    if (bmiFormula) {
        const formula = `= ${weightKg.toFixed(1)} √∑ (${heightM.toFixed(2)})¬≤ = ${bmi}`;
        bmiFormula.textContent = formula;
    }
    
    if (bmiCategory) {
        bmiCategory.textContent = category.name;
        bmiCategory.style.color = category.color;
    }
    
    if (bmiRange) {
        bmiRange.textContent = `Range: ${category.range} (Risk: ${category.risk})`;
    }
    
    if (positionIndicator) {
        positionIndicator.innerHTML = `Your position: <strong style="color:${category.color}">${bmi}</strong>`;
    }
    
    // Update BMI scale marker
    bmiUpdateScale(bmi);
    
    // Show health info section
    const healthInfo = document.querySelector('#bmi-health-info');
    if (healthInfo) {
        healthInfo.style.display = 'block';
    }
}

// Update BMI scale visualization
function bmiUpdateScale(bmi) {
    const marker = document.querySelector('#bmi-marker');
    if (!marker) return;
    
    // Calculate position (BMI scale from 15 to 45 for visualization)
    let position = ((bmi - 15) / 30) * 100;
    if (position < 0) position = 0;
    if (position > 100) position = 100;
    
    marker.style.left = `calc(${position}% - 6px)`;
    marker.style.display = 'block';
    
    // Add smooth animation
    marker.style.transition = 'left 0.5s ease-in-out';
}

// Show health information
function bmiShowHealthInfo(bmi, category) {
    const healthDetails = document.querySelector('#health-details');
    const recommendationText = document.querySelector('#recommendation-text');
    
    if (!healthDetails || !recommendationText) return;
    
    let healthInfo = '';
    let recommendation = '';
    
    if (bmi < 18.5) {
        healthInfo = `Being underweight can lead to nutritional deficiencies, weakened immune function, and osteoporosis. `;
        if (bmi < 16) {
            healthInfo += `Severely underweight individuals should consult a healthcare provider immediately.`;
            recommendation = `Consult a healthcare professional for guidance on healthy weight gain. Focus on nutrient-dense foods and consider speaking with a dietitian.`;
        } else {
            recommendation = `Gradually increase calorie intake with nutrient-rich foods. Consider strength training to build muscle mass.`;
        }
    } else if (bmi < 25) {
        healthInfo = `Congratulations! You're in the healthy weight range. Maintaining this weight reduces your risk for chronic diseases.`;
        recommendation = `Continue with balanced nutrition and regular physical activity. Aim for at least 150 minutes of moderate exercise per week.`;
    } else if (bmi < 30) {
        healthInfo = `Overweight individuals have increased risk for hypertension, heart disease, type 2 diabetes, and certain cancers.`;
        recommendation = `Aim for gradual weight loss (0.5‚Äì1 kg per week) through balanced diet and increased physical activity.`;
    } else if (bmi < 35) {
        healthInfo = `Obesity (Class I) significantly increases health risks including heart disease, stroke, and sleep apnea.`;
        recommendation = `Medical supervision recommended for weight management. Consider consulting with healthcare professionals for a personalized plan.`;
    } else if (bmi < 40) {
        healthInfo = `Severe obesity (Class II) substantially increases mortality risk and requires medical intervention.`;
        recommendation = `Immediate medical consultation recommended. Comprehensive weight management program under medical supervision is advised.`;
    } else {
        healthInfo = `Morbid obesity (Class III) is associated with life-threatening health conditions requiring urgent medical attention.`;
        recommendation = `Urgent medical consultation required. Treatment may include medical supervision, lifestyle changes, and possibly bariatric surgery consultation.`;
    }
    
    // Add age-specific information if provided
    if (bmiAge) {
        if (bmiAge > 65) {
            healthInfo += ` Note: For adults over 65, a slightly higher BMI (up to 27) may be associated with lower mortality risk.`;
        } else if (bmiAge < 25) {
            healthInfo += ` Note: BMI interpretation may vary for younger adults. Consider body composition analysis.`;
        }
    }
    
    healthDetails.textContent = healthInfo;
    recommendationText.textContent = recommendation;
}

// Calculate ideal weight range
function bmiCalculateIdealWeight(heightM) {
    const idealMin = 18.5 * (heightM * heightM);
    const idealMax = 24.9 * (heightM * heightM);
    const idealOptimal = 21.5 * (heightM * heightM); // Middle of healthy range
    
    // Display ideal weights
    const idealMinEl = document.querySelector('#ideal-min');
    const idealMaxEl = document.querySelector('#ideal-max');
    const idealOptimalEl = document.querySelector('#ideal-optimal');
    const idealAnalysisEl = document.querySelector('#ideal-analysis');
    const idealWeightSection = document.querySelector('#bmi-ideal-weight');
    
    if (idealMinEl) idealMinEl.textContent = idealMin.toFixed(1) + ' kg';
    if (idealMaxEl) idealMaxEl.textContent = idealMax.toFixed(1) + ' kg';
    if (idealOptimalEl) idealOptimalEl.textContent = idealOptimal.toFixed(1) + ' kg';
    
    // Get current weight
    const weightInput = document.querySelector('#bmi-weight-input');
    let currentWeight = parseFloat(weightInput.value) || 70;
    
    // Convert to kg if needed
    if (bmiWeightUnit === 'lb') {
        currentWeight = currentWeight / 2.20462;
    }
    
    // Calculate weight to lose/gain
    let analysis = '';
    if (currentWeight < idealMin) {
        const toGain = (idealMin - currentWeight).toFixed(1);
        analysis = `You are underweight. To reach healthy range, you need to gain approximately ${toGain} kg.`;
    } else if (currentWeight > idealMax) {
        const toLose = (currentWeight - idealMax).toFixed(1);
        analysis = `You are overweight. To reach healthy range, you need to lose approximately ${toLose} kg.`;
    } else {
        analysis = `You are within the healthy weight range. Maintain your current weight.`;
    }
    
    if (idealAnalysisEl) idealAnalysisEl.textContent = analysis;
    if (idealWeightSection) idealWeightSection.style.display = 'block';
}

// Show ideal weight (button click)
function bmiCalculateIdeal() {
    const heightInput = document.querySelector('#bmi-height-input');
    if (!heightInput) return;
    
    let heightCm = parseFloat(heightInput.value) || 175;
    
    // Convert to metric if needed
    if (bmiHeightUnit === 'in') {
        heightCm = heightCm * 2.54;
    }
    
    const heightM = heightCm / 100;
    bmiCalculateIdealWeight(heightM);
}

// Show error message
function bmiShowError(message) {
    const bmiValue = document.querySelector('#bmi-value');
    const bmiCategory = document.querySelector('#bmi-category');
    const healthDetails = document.querySelector('#health-details');
    const healthInfo = document.querySelector('#bmi-health-info');
    
    if (bmiValue) bmiValue.textContent = '‚Äì';
    if (bmiCategory) {
        bmiCategory.textContent = 'Invalid input';
        bmiCategory.style.color = '#ff4d4d';
    }
    if (healthDetails) healthDetails.textContent = message;
    if (healthInfo) healthInfo.style.display = 'block';
    
    // Hide marker
    const marker = document.querySelector('#bmi-marker');
    if (marker) marker.style.display = 'none';
}

// Copy results to clipboard
function bmiCopyResults() {
    const bmiValue = document.querySelector('#bmi-value')?.textContent || 'N/A';
    const bmiCategory = document.querySelector('#bmi-category')?.textContent || 'N/A';
    const bmiRange = document.querySelector('#bmi-range')?.textContent || 'N/A';
    
    const text = `‚öïÔ∏è BMI Results:\nBMI: ${bmiValue}\nCategory: ${bmiCategory}\n${bmiRange}\n\nNote: BMI is a screening tool only. Consult healthcare professional for personalized advice.`;
    
    navigator.clipboard?.writeText(text).then(() => {
        const btn = document.querySelector('[onclick="bmiCopyResults()"]');
        if (btn) {
            btn.innerHTML = '‚úÖ Copied!';
            setTimeout(() => {
                btn.innerHTML = 'üìã Copy';
            }, 2000);
        }
    });
}

// Reset calculator
function bmiReset() {
    // Reset form inputs
    const heightInput = document.querySelector('#bmi-height-input');
    const heightSlider = document.querySelector('#bmi-height');
    const heightDisplay = document.querySelector('#bmi-height-display');
    
    const weightInput = document.querySelector('#bmi-weight-input');
    const weightSlider = document.querySelector('#bmi-weight');
    const weightDisplay = document.querySelector('#bmi-weight-display');
    
    const ageInput = document.querySelector('#bmi-age');
    
    if (heightInput) heightInput.value = 175;
    if (heightSlider) heightSlider.value = 175;
    if (heightDisplay) heightDisplay.textContent = '175 cm';
    
    if (weightInput) weightInput.value = 70;
    if (weightSlider) weightSlider.value = 70;
    if (weightDisplay) weightDisplay.textContent = '70 kg';
    
    if (ageInput) ageInput.value = '';
    
    // Reset units
    bmiSetHeightUnit('cm');
    bmiSetWeightUnit('kg');
    bmiSetGender('male');
    bmiAge = null;
    
    // Reset results
    const bmiValue = document.querySelector('#bmi-value');
    const bmiFormula = document.querySelector('#bmi-formula');
    const bmiCategory = document.querySelector('#bmi-category');
    const bmiRange = document.querySelector('#bmi-range');
    const positionIndicator = document.querySelector('#bmi-position-indicator');
    const marker = document.querySelector('#bmi-marker');
    const healthInfo = document.querySelector('#bmi-health-info');
    const idealWeightSection = document.querySelector('#bmi-ideal-weight');
    
    if (bmiValue) bmiValue.textContent = '‚Äì';
    if (bmiFormula) bmiFormula.textContent = 'kg/m¬≤';
    if (bmiCategory) {
        bmiCategory.textContent = '‚Äì';
        bmiCategory.style.color = '';
    }
    if (bmiRange) bmiRange.textContent = 'Range: ‚Äì';
    if (positionIndicator) positionIndicator.textContent = 'Your position: ‚Äì';
    if (marker) marker.style.display = 'none';
    if (healthInfo) healthInfo.style.display = 'none';
    if (idealWeightSection) idealWeightSection.style.display = 'none';
    
    // Visual feedback
    const resetBtn = document.querySelector('#bmi-reset-btn');
    if (resetBtn) {
        resetBtn.innerHTML = '‚úÖ Reset Complete';
        setTimeout(() => {
            resetBtn.innerHTML = 'üîÑ Reset';
        }, 1000);
    }
}

// Initialize on page load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', bmiInit);
} else {
    bmiInit();
}
</script>
