<h2 id="cable-calc-title">Cable Length & Voltage Drop Calculator</h2>

<div class="description">
  Calculate voltage drop and select proper cable size for your electrical projects.
  <span class="disclaimer">‚ö†Ô∏è Always verify with local electrical codes and professionals.</span>
</div>

<div class="tool-body">
  <!-- ‚ö° POWER INPUT SECTION -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
    <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 15px;">üîå Electrical Parameters:</div>
    
    <!-- POWER & VOLTAGE -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
      <div>
        <label for="cc-load" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #ffa500;">Load Current (A)</span>
          <button type="button" onclick="ccShowExample('current')" style="margin-left: 6px; background: none; border: none; color: #2dd4ff; cursor: help; font-size: 12px;">?</button>
        </label>
        <div style="display: flex; align-items: center;">
          <input type="number" id="cc-load" placeholder="e.g., 10" min="0.1" step="0.1"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,165,0,0.3); background: rgba(255,165,0,0.05); color: #e6faff; font-size: 16px;">
          <div style="margin-left: 8px; color: rgba(255,165,0,0.8); white-space: nowrap;">Amps</div>
        </div>
        <div id="cc-current-example" style="display: none; margin-top: 6px; color: rgba(255,165,0,0.7); font-size: 13px; background: rgba(255,165,0,0.1); padding: 6px; border-radius: 4px;">
          Examples: LED strip (1-2A), Laptop (3A), Car amp (10-30A), RV appliance (15A)
        </div>
      </div>
      
      <div>
        <label for="cc-voltage" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #2dd4ff;">System Voltage (V)</span>
          <button type="button" onclick="ccShowExample('voltage')" style="margin-left: 6px; background: none; border: none; color: #2dd4ff; cursor: help; font-size: 12px;">?</button>
        </label>
        <div style="display: flex; align-items: center;">
          <input type="number" id="cc-voltage" placeholder="e.g., 12" min="1.5" step="0.1"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(45,212,255,0.3); background: rgba(45,212,255,0.05); color: #e6faff; font-size: 16px;">
          <div style="margin-left: 8px; color: rgba(45,212,255,0.8); white-space: nowrap;">Volts</div>
        </div>
        <div id="cc-voltage-example" style="display: none; margin-top: 6px; color: rgba(45,212,255,0.7); font-size: 13px; background: rgba(45,212,255,0.1); padding: 6px; border-radius: 4px;">
          DC: 12V (car), 24V (truck), 48V (solar). AC: 120V (USA), 230V (EU)
        </div>
      </div>
    </div>
    
    <!-- CABLE LENGTH & SIZE -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
      <div>
        <label for="cc-length" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #39ff14;">Cable Length (ft/m)</span>
          <button type="button" onclick="ccShowExample('length')" style="margin-left: 6px; background: none; border: none; color: #2dd4ff; cursor: help; font-size: 12px;">?</button>
        </label>
        <div style="display: flex; align-items: center;">
          <input type="number" id="cc-length" placeholder="e.g., 50" min="1" step="1"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(57,255,20,0.3); background: rgba(57,255,20,0.05); color: #e6faff; font-size: 16px;">
          <select id="cc-length-unit" style="margin-left: 8px; padding: 10px; border-radius: 6px; border: 1px solid rgba(57,255,20,0.3); background: rgba(57,255,20,0.1); color: #e6faff;">
            <option value="ft">Feet</option>
            <option value="m">Meters</option>
          </select>
        </div>
        <div id="cc-length-example" style="display: none; margin-top: 6px; color: rgba(57,255,20,0.7); font-size: 13px; background: rgba(57,255,20,0.1); padding: 6px; border-radius: 4px;">
          Round trip length! For 25ft run, enter 50ft (out + return)
        </div>
      </div>
      
      <div>
        <label for="cc-awg" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #9d4edd;">Wire Size (AWG/mm¬≤)</span>
          <button type="button" onclick="ccShowExample('awg')" style="margin-left: 6px; background: none; border: none; color: #2dd4ff; cursor: help; font-size: 12px;">?</button>
        </label>
        <select id="cc-awg" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(157,78,221,0.3); background: rgba(157,78,221,0.05); color: #e6faff; font-size: 16px;">
          <option value="18">18 AWG (0.82 mm¬≤) - Low power signals</option>
          <option value="16">16 AWG (1.31 mm¬≤) - Lighting, speakers</option>
          <option value="14" selected>14 AWG (2.08 mm¬≤) - 15A circuits</option>
          <option value="12">12 AWG (3.31 mm¬≤) - 20A circuits</option>
          <option value="10">10 AWG (5.26 mm¬≤) - 30A circuits</option>
          <option value="8">8 AWG (8.37 mm¬≤) - High power</option>
          <option value="6">6 AWG (13.3 mm¬≤) - Service entrance</option>
          <option value="4">4 AWG (21.2 mm¬≤) - Large loads</option>
          <option value="2">2 AWG (33.6 mm¬≤) - Very high power</option>
        </select>
        <div id="cc-awg-example" style="display: none; margin-top: 6px; color: rgba(157,78,221,0.7); font-size: 13px; background: rgba(157,78,221,0.1); padding: 6px; border-radius: 4px;">
          Lower AWG = thicker wire = less voltage drop
        </div>
      </div>
    </div>
    
    <!-- VOLTAGE DROP TARGET -->
    <div style="margin-top: 20px;">
      <label for="cc-drop-target" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
        <span style="color: #ffcc00;">Max Voltage Drop Target (%)</span>
        <button type="button" onclick="ccShowExample('drop')" style="margin-left: 6px; background: none; border: none; color: #2dd4ff; cursor: help; font-size: 12px;">?</button>
      </label>
      <div style="display: flex; align-items: center; gap: 10px;">
        <input type="range" id="cc-drop-slider" min="1" max="10" value="3" step="0.5"
               style="flex: 1; height: 6px; border-radius: 3px; background: linear-gradient(to right, #ff4d4d, #ffa500, #39ff14); outline: none;">
        <input type="number" id="cc-drop-target" value="3" min="1" max="10" step="0.5"
               style="width: 70px; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,204,0,0.3); background: rgba(255,204,0,0.1); color: #e6faff; text-align: center;">
        <div style="color: rgba(255,204,0,0.8); white-space: nowrap;">%</div>
      </div>
      <div id="cc-drop-example" style="display: none; margin-top: 6px; color: rgba(255,204,0,0.7); font-size: 13px; background: rgba(255,204,0,0.1); padding: 6px; border-radius: 4px;">
        3% typical for critical loads, 5% for general, 10% max for non-critical
      </div>
    </div>
  </div>
  
  <!-- üöÄ QUICK SCENARIOS -->
  <div style="margin-bottom: 25px;">
    <div style="color: rgba(230,250,255,0.8); margin-bottom: 10px; font-size: 14px;">Common Scenarios:</div>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <button class="cc-example-btn" data-current="3" data-voltage="12" data-length="20" data-awg="16" data-drop="3"
              style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; color: #e6faff; font-size: 13px;">
        üí° 12V LED Lighting (3A, 20ft)
      </button>
      <button class="cc-example-btn" data-current="15" data-voltage="12" data-length="15" data-awg="10" data-drop="3"
              style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; color: #e6faff; font-size: 13px;">
        üöó Car Audio Amp (15A, 15ft)
      </button>
      <button class="cc-example-btn" data-current="10" data-voltage="120" data-length="50" data-awg="14" data-drop="3"
              style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; color: #e6faff; font-size: 13px;">
        üè† Home Outlet (10A, 50ft)
      </button>
      <button class="cc-example-btn" data-current="30" data-voltage="48" data-length="100" data-awg="6" data-drop="5"
              style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; color: #e6faff; font-size: 13px;">
        ‚òÄÔ∏è Solar Array (30A, 100ft)
      </button>
    </div>
  </div>
  
  <!-- üöÄ CALCULATE BUTTON -->
  <div style="text-align: center; margin: 25px 0;">
    <button id="cc-calculate-btn" 
            style="background: #2dd4ff; color: #000; border: none; padding: 14px 32px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 15px rgba(45,212,255,0.3);">
      ‚ö° CALCULATE VOLTAGE DROP
    </button>
    
    <button id="cc-reset-btn" 
            style="background: rgba(255,255,255,0.08); color: #e6faff; border: 1px solid rgba(255,255,255,0.2); padding: 14px 24px; border-radius: 10px; cursor: pointer; font-size: 16px; margin-left: 12px;">
      Reset
    </button>
  </div>
  
  <!-- üìä RESULTS DISPLAY -->
  <div id="cc-results" style="display: none;">
    <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2); margin-bottom: 25px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <div style="color: #39ff14; font-size: 18px; font-weight: 600;">üìä Calculation Results</div>
        <button id="cc-copy-btn" 
                style="background: rgba(57,255,20,0.1); color: #39ff14; border: 1px solid rgba(57,255,20,0.3); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
          Copy Results
        </button>
      </div>
      
      <div id="cc-result-display" style="font-size: 20px; color: #39ff14; text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
        <!-- Results appear here -->
      </div>
      
      <div id="cc-interpretation" style="color: #e6faff; font-size: 15px; line-height: 1.6; padding: 15px; background: rgba(30,30,30,0.5); border-radius: 8px;">
        <!-- Interpretation appears here -->
      </div>
      
      <!-- RECOMMENDED WIRE SIZE -->
      <div id="cc-recommendation" style="margin-top: 20px; padding: 15px; background: rgba(45,212,255,0.1); border-radius: 8px; border: 1px solid rgba(45,212,255,0.3); display: none;">
        <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 10px;">üí° Recommended Wire Size:</div>
        <div id="cc-recommended-wire" style="color: #e6faff;"></div>
      </div>
    </div>
  </div>
  
  <!-- ‚ö†Ô∏è SAFETY & FACTS -->
  <div id="cc-safety-info" style="margin-top: 20px; display: block;">
    <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,165,0,0.2);">
      <div style="color: #ffa500; font-weight: 600; margin-bottom: 15px; font-size: 16px;">
        ‚ö†Ô∏è Electrical Safety & Best Practices
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        <div style="background: rgba(255,165,0,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #ffa500;">
          <div style="color: #ffa500; font-weight: 600; margin-bottom: 5px;">Formula: Vdrop = 2 √ó L √ó I √ó R / 1000</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Voltage drop = 2 √ó Length(ft) √ó Current(A) √ó Resistance(Œ©/kft)</div>
        </div>
        
        <div style="background: rgba(255,77,77,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #ff4d4d;">
          <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 5px;">‚ö†Ô∏è Critical Safety</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">‚Ä¢ Always hire licensed electricians<br>‚Ä¢ Follow NEC/ local codes<br>‚Ä¢ Use proper circuit protection</div>
        </div>
        
        <div style="background: rgba(30,144,255,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #1e90ff;">
          <div style="color: #1e90ff; font-weight: 600; margin-bottom: 5px;">AWG vs mm¬≤</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">‚Ä¢ 14 AWG = 2.08 mm¬≤ (15A max)<br>‚Ä¢ 12 AWG = 3.31 mm¬≤ (20A max)<br>‚Ä¢ 10 AWG = 5.26 mm¬≤ (30A max)</div>
        </div>
        
        <div style="background: rgba(57,255,20,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #39ff14;">
          <div style="color: #39ff14; font-weight: 600; margin-bottom: 5px;">Pro Tips</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">‚Ä¢ Calculate round-trip distance<br>‚Ä¢ Factor in temperature rating<br>‚Ä¢ Consider future expansion<br>‚Ä¢ Use voltage drop tables</div>
        </div>
      </div>
      
      <!-- WIRE RESISTANCE TABLE -->
      <div style="margin-top: 20px; overflow-x: auto;">
        <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 10px; font-size: 14px;">üìã Copper Wire Resistance (Œ© per 1000 ft):</div>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <thead>
            <tr style="background: rgba(45,212,255,0.1);">
              <th style="padding: 8px; text-align: left; border: 1px solid rgba(45,212,255,0.3);">AWG</th>
              <th style="padding: 8px; text-align: left; border: 1px solid rgba(45,212,255,0.3);">mm¬≤</th>
              <th style="padding: 8px; text-align: left; border: 1px solid rgba(45,212,255,0.3);">Resistance (Œ©/kft)</th>
              <th style="padding: 8px; text-align: left; border: 1px solid rgba(45,212,255,0.3);">Max Current*</th>
            </tr>
          </thead>
          <tbody>
            <tr><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">18</td><td>0.82</td><td>6.385</td><td>10A</td></tr>
            <tr style="background: rgba(255,255,255,0.03);"><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">16</td><td>1.31</td><td>4.016</td><td>13A</td></tr>
            <tr><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">14</td><td>2.08</td><td>2.525</td><td>15A</td></tr>
            <tr style="background: rgba(255,255,255,0.03);"><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">12</td><td>3.31</td><td>1.588</td><td>20A</td></tr>
            <tr><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">10</td><td>5.26</td><td>0.9989</td><td>30A</td></tr>
            <tr style="background: rgba(255,255,255,0.03);"><td style="padding: 6px; border: 1px solid rgba(255,255,255,0.1);">8</td><td>8.37</td><td>0.6282</td><td>40A</td></tr>
          </tbody>
        </table>
        <div style="color: rgba(230,250,255,0.6); font-size: 12px; margin-top: 8px; font-style: italic;">* For chassis wiring, not building wiring</div>
      </div>
      
      <div style="margin-top: 15px; padding: 10px; background: rgba(255,165,0,0.1); border-radius: 6px; border: 1px solid rgba(255,165,0,0.3);">
        <div style="color: #ffa500; font-weight: 600; font-size: 14px;">Disclaimer:</div>
        <div style="color: rgba(255,165,0,0.9); font-size: 13px; margin-top: 4px;">
          This tool provides educational estimates only. Actual cable sizing requires compliance with local electrical codes (NEC, IEC, etc.) and professional engineering review.
        </div>
      </div>
    </div>
  </div>
  
  <!-- üö® ERROR MESSAGE -->
  <div id="cc-error" style="margin-top: 20px; padding: 15px; background: rgba(255,77,77,0.1); border-radius: 8px; border: 1px solid rgba(255,77,77,0.3); display: none;">
    <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 5px;">‚ö†Ô∏è Please check your inputs</div>
    <div id="cc-error-text" style="color: rgba(255,77,77,0.9);"></div>
  </div>
</div>

<style>
#cable-calc-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

.description {
  color: rgba(230,250,255,0.8);
  margin-bottom: 20px;
  font-size: 14px;
}

.disclaimer {
  display: block;
  color: rgba(255,165,0,0.8);
  font-size: 12px;
  margin-top: 5px;
  font-style: italic;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .cc-example-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  #cc-calculate-btn, #cc-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  table {
    font-size: 12px !important;
  }
}
</style>

<script>
// ============================================
// CABLE CALCULATOR - PROPERLY SCOPED
// All functions prefixed with "cc" (cable calculator)
// ============================================

let ccExampleActive = null;

// Wire resistance data (Œ© per 1000 ft for copper at 20¬∞C)
const ccWireResistance = {
    '18': 6.385,   // Œ©/kft
    '16': 4.016,
    '14': 2.525,
    '12': 1.588,
    '10': 0.9989,
    '8':  0.6282,
    '6':  0.3951,
    '4':  0.2485,
    '2':  0.1563
};

// Maximum current for chassis wiring (not building wiring)
const ccMaxCurrent = {
    '18': 10,
    '16': 13,
    '14': 15,
    '12': 20,
    '10': 30,
    '8':  40,
    '6':  55,
    '4':  70,
    '2':  95
};

// Initialize the tool
function ccInit() {
    console.log("Cable Calculator: Initializing...");
    
    // Drop target slider and input synchronization
    const dropSlider = document.getElementById('cc-drop-slider');
    const dropInput = document.getElementById('cc-drop-target');
    
    dropSlider.addEventListener('input', function() {
        dropInput.value = this.value;
    });
    
    dropInput.addEventListener('input', function() {
        let value = parseFloat(this.value);
        if (value < 1) value = 1;
        if (value > 10) value = 10;
        this.value = value;
        dropSlider.value = value;
    });
    
    // Example buttons
    const exampleBtns = document.querySelectorAll('.cc-example-btn');
    exampleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const current = this.dataset.current;
            const voltage = this.dataset.voltage;
            const length = this.dataset.length;
            const awg = this.dataset.awg;
            const drop = this.dataset.drop;
            
            document.getElementById('cc-load').value = current;
            document.getElementById('cc-voltage').value = voltage;
            document.getElementById('cc-length').value = length;
            document.getElementById('cc-awg').value = awg;
            document.getElementById('cc-drop-target').value = drop;
            dropSlider.value = drop;
            
            // Visual feedback
            exampleBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
            });
            this.style.background = 'rgba(45,212,255,0.15)';
            this.style.border = '1px solid #2dd4ff';
            
            ccExampleActive = this;
            ccClearResults();
        });
    });
    
    // Calculate button
    document.getElementById('cc-calculate-btn').addEventListener('click', ccCalculate);
    
    // Reset button
    document.getElementById('cc-reset-btn').addEventListener('click', ccReset);
    
    // Copy button
    document.getElementById('cc-copy-btn').addEventListener('click', ccCopyResult);
    
    // Enter key support
    const allInputs = document.querySelectorAll('#cc-load, #cc-voltage, #cc-length, #cc-drop-target');
    allInputs.forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                ccCalculate();
            }
        });
    });
    
    // Set default values
    ccSetDefaultValues();
    
    console.log("‚úÖ Cable Calculator ready!");
}

// Set default values
function ccSetDefaultValues() {
    document.getElementById('cc-load').value = '10';
    document.getElementById('cc-voltage').value = '12';
    document.getElementById('cc-length').value = '25';
    document.getElementById('cc-awg').value = '14';
    document.getElementById('cc-drop-target').value = '3';
    document.getElementById('cc-drop-slider').value = '3';
}

// Show example help text
function ccShowExample(type) {
    const examples = document.querySelectorAll('[id^="cc-"][id$="-example"]');
    examples.forEach(div => div.style.display = 'none');
    
    const exampleDiv = document.getElementById(`cc-${type}-example`);
    if (exampleDiv) {
        exampleDiv.style.display = 'block';
        setTimeout(() => {
            exampleDiv.style.display = 'none';
        }, 5000);
    }
}

// Main calculation function
function ccCalculate() {
    console.log("Calculating voltage drop...");
    
    // Hide previous results/errors
    document.getElementById('cc-results').style.display = 'none';
    document.getElementById('cc-error').style.display = 'none';
    document.getElementById('cc-recommendation').style.display = 'none';
    
    // Get inputs
    const I = parseFloat(document.getElementById('cc-load').value);       // Current (A)
    const V = parseFloat(document.getElementById('cc-voltage').value);    // Voltage (V)
    const L = parseFloat(document.getElementById('cc-length').value);     // Length
    const unit = document.getElementById('cc-length-unit').value;         // ft or m
    const awg = document.getElementById('cc-awg').value;                  // Wire size
    const dropTarget = parseFloat(document.getElementById('cc-drop-target').value); // Target %
    
    // Convert length to feet if needed
    let lengthFt = L;
    if (unit === 'm') {
        lengthFt = L * 3.28084; // Convert meters to feet
    }
    
    // Validate inputs
    if (!I || !V || !L || I <= 0 || V <= 0 || L <= 0) {
        ccShowError('Please enter valid current (A), voltage (V), and length');
        return;
    }
    
    if (dropTarget < 1 || dropTarget > 10) {
        ccShowError('Voltage drop target must be between 1% and 10%');
        return;
    }
    
    if (!ccWireResistance[awg]) {
        ccShowError('Invalid wire size selected');
        return;
    }
    
    try {
        // Get wire resistance (Œ© per 1000 ft)
        const Rper1000ft = ccWireResistance[awg];
        
        // Calculate voltage drop (Vdrop = 2 √ó L(ft) √ó I(A) √ó R(Œ©/kft) / 1000)
        // Factor of 2 for round trip (out and return)
        const Vdrop = (2 * lengthFt * I * Rper1000ft) / 1000;
        
        // Calculate percentage drop
        const dropPercent = (Vdrop / V) * 100;
        
        // Calculate voltage at load
        const Vload = V - Vdrop;
        
        // Calculate power loss
        const Ploss = Vdrop * I;
        
        // Calculate wire resistance for this length
        const wireResistance = (Rper1000ft * lengthFt * 2) / 1000; // Œ© for round trip
        
        // Prepare results
        let result = `üìä Voltage Drop Analysis:\n`;
        result += `‚ö° Voltage drop: ${Vdrop.toFixed(2)} V (${dropPercent.toFixed(2)}%)\n`;
        result += `üîå Voltage at load: ${Vload.toFixed(2)} V\n`;
        result += `üìè Wire resistance: ${wireResistance.toFixed(4)} Œ©\n`;
        result += `üí• Power loss: ${Ploss.toFixed(2)} W`;
        
        if (dropPercent > dropTarget) {
            result += `\n\n‚ùå Drop exceeds ${dropTarget}% target!`;
        } else {
            result += `\n\n‚úÖ Within ${dropTarget}% target ‚úì`;
        }
        
        // Prepare detailed interpretation
        let interpretation = `üìù Calculation Details:\n`;
        interpretation += `‚Ä¢ Current: ${I} A\n`;
        interpretation += `‚Ä¢ Voltage: ${V} V\n`;
        interpretation += `‚Ä¢ Wire length: ${L} ${unit} (${lengthFt.toFixed(1)} ft round trip)\n`;
        interpretation += `‚Ä¢ Wire size: ${awg} AWG (${Rper1000ft} Œ©/kft)\n`;
        interpretation += `‚Ä¢ Max drop target: ${dropTarget}%\n\n`;
        interpretation += `üßÆ Formula: Vdrop = 2 √ó L √ó I √ó R / 1000\n`;
        interpretation += `            = 2 √ó ${lengthFt.toFixed(1)} √ó ${I} √ó ${Rper1000ft} / 1000\n`;
        interpretation += `            = ${Vdrop.toFixed(2)} V\n\n`;
        
        interpretation += `üîç Analysis:\n`;
        if (dropPercent > 10) {
            interpretation += `‚ö†Ô∏è Excessive voltage drop! Equipment may not work properly.\n`;
        } else if (dropPercent > 5) {
            interpretation += `‚ö†Ô∏è Moderate voltage drop. May cause performance issues.\n`;
        } else if (dropPercent > 3) {
            interpretation += `‚ö†Ô∏è Some voltage drop. Acceptable for non-critical loads.\n`;
        } else {
            interpretation += `‚úÖ Good voltage drop. Suitable for most applications.\n`;
        }
        
        // Check if current exceeds wire rating
        const maxI = ccMaxCurrent[awg];
        if (I > maxI) {
            interpretation += `\nüö® Warning: Current (${I}A) exceeds recommended max (${maxI}A) for ${awg} AWG!`;
        }
        
        // Display results
        document.getElementById('cc-result-display').innerHTML = result.replace(/\n/g, '<br>');
        document.getElementById('cc-interpretation').innerHTML = interpretation.replace(/\n/g, '<br>');
        document.getElementById('cc-results').style.display = 'block';
        
        // Show recommendation if drop exceeds target
        if (dropPercent > dropTarget) {
            ccShowRecommendation(I, V, lengthFt, dropTarget);
        }
        
    } catch (error) {
        console.error('Calculation error:', error);
        ccShowError('Unable to calculate. Please check your inputs.');
    }
}

// Show wire size recommendation
function ccShowRecommendation(I, V, lengthFt, dropTarget) {
    let recommendedAWG = null;
    
    // Find smallest AWG that meets drop target
    for (const [awg, resistance] of Object.entries(ccWireResistance)) {
        const Vdrop = (2 * lengthFt * I * resistance) / 1000;
        const dropPercent = (Vdrop / V) * 100;
        
        if (dropPercent <= dropTarget) {
            recommendedAWG = awg;
            break;
        }
    }
    
    if (recommendedAWG) {
        const currentAWG = document.getElementById('cc-awg').value;
        const recommendation = document.getElementById('cc-recommended-wire');
        
        let html = `For ${dropTarget}% max voltage drop:\n`;
        html += `‚Ä¢ Current wire (${currentAWG} AWG): ‚ùå Too small\n`;
        html += `‚Ä¢ Recommended: <span style="color:#39ff14;font-weight:600;">${recommendedAWG} AWG or larger</span>\n\n`;
        html += `Benefits of ${recommendedAWG} AWG:\n`;
        html += `‚Ä¢ Lower voltage drop\n`;
        html += `‚Ä¢ Less power loss\n`;
        html += `‚Ä¢ Reduced heating\n`;
        html += `‚Ä¢ Better efficiency`;
        
        recommendation.innerHTML = html.replace(/\n/g, '<br>');
        document.getElementById('cc-recommendation').style.display = 'block';
    }
}

// Reset function
function ccReset() {
    ccSetDefaultValues();
    
    // Reset example buttons
    if (ccExampleActive) {
        ccExampleActive.style.background = 'rgba(255,255,255,0.05)';
        ccExampleActive.style.border = '1px solid rgba(255,255,255,0.1)';
        ccExampleActive = null;
    }
    
    document.querySelectorAll('.cc-example-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
    });
    
    ccClearResults();
    
    // Focus on current input
    setTimeout(() => {
        document.getElementById('cc-load').focus();
        document.getElementById('cc-load').select();
    }, 50);
    
    console.log("Cable calculator reset");
}

// Clear results
function ccClearResults() {
    document.getElementById('cc-results').style.display = 'none';
    document.getElementById('cc-error').style.display = 'none';
    document.getElementById('cc-recommendation').style.display = 'none';
}

// Copy result
function ccCopyResult() {
    const result = document.getElementById('cc-result-display').textContent;
    const interpretation = document.getElementById('cc-interpretation').textContent;
    const recommendation = document.getElementById('cc-recommended-wire')?.textContent || '';
    
    let text = `Cable Calculator Results\n\n${result}\n\n${interpretation}`;
    if (recommendation) {
        text += `\n\nRecommendation:\n${recommendation}`;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const copyBtn = document.getElementById('cc-copy-btn');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.style.background = 'rgba(57,255,20,0.2)';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy. Please select and copy manually.');
    });
}

// Show error
function ccShowError(message) {
    document.getElementById('cc-error-text').textContent = message;
    document.getElementById('cc-error').style.display = 'block';
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ccInit);
} else {
    setTimeout(ccInit, 100);
}
</script>
