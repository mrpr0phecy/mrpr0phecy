<h2 id="ai-toolbox-title" style="margin-top:0;color:var(--accent);">ü§ñ AI Toolbox Generator</h2>

<form aria-describedby="ai-toolbox-desc">
  <p id="ai-toolbox-desc" class="small" style="color:var(--muted);margin-bottom:16px;">
    Build your own custom AI tools by combining different AI capabilities. Create, save, and share personalized mini-tools in minutes!
    <span style="color:#ffcc00;">‚ú® No coding required - drag, drop, and customize!</span>
  </p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:16px;border:1px solid rgba(45,212,255,0.2);">
      <div style="font-weight:600;color:var(--accent);margin-bottom:12px;">üß± AI Building Blocks</div>
      <div id="ai-blocks" class="small" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <!-- AI blocks will be loaded here -->
      </div>
    </div>
    
    <div style="background:rgba(147,112,219,0.05);border-radius:8px;padding:16px;border:1px solid rgba(147,112,219,0.2);">
      <div style="font-weight:600;color:#9370db;margin-bottom:12px;">üõ†Ô∏è Your Tool Builder</div>
      <div id="ai-builder" 
           style="min-height:200px;background:rgba(0,0,0,0.1);border-radius:8px;border:2px dashed rgba(255,255,255,0.1);padding:16px;display:flex;align-items:center;justify-content:center;">
        <div style="color:var(--muted);text-align:center;">
          <div style="font-size:48px;margin-bottom:8px;">‚¨áÔ∏è</div>
          <div>Drag AI blocks here to build your tool</div>
        </div>
      </div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <div>
      <label for="ai-tool-name" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">Tool Name</label>
      <input id="ai-tool-name" type="text" placeholder="e.g., Instagram Caption Generator" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
    </div>
    
    <div>
      <label for="ai-tool-category" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">Category</label>
      <select id="ai-tool-category" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;">
        <option value="writing">üìù Writing</option>
        <option value="marketing">üìà Marketing</option>
        <option value="coding">üíª Coding</option>
        <option value="creative">üé® Creative</option>
        <option value="productivity">‚ö° Productivity</option>
        <option value="education">üìö Education</option>
      </select>
    </div>
  </div>

  <div style="margin-bottom:20px;">
    <label for="ai-tool-description" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">Tool Description</label>
    <textarea id="ai-tool-description" rows="3" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;"
              placeholder="Describe what your custom AI tool does..."></textarea>
  </div>

  <div style="display:flex;gap:10px;margin-top:20px;flex-wrap:wrap;">
    <button type="button" onclick="aiGenerateTool(this)" id="ai-generate-btn"
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(255,105,180,0.2), rgba(255,105,180,0.1));border:1px solid rgba(255,105,180,0.4);border-radius:8px;color:#ff69b4;cursor:pointer;font-weight:600;min-width:140px;">
      üöÄ Generate AI Tool
    </button>
    <button type="button" onclick="aiPreviewTool(this)"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      üëÅÔ∏è Preview
    </button>
    <button type="button" onclick="aiSaveTool(this)"
            style="padding:12px 16px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;">
      üíæ Save Tool
    </button>
    <button type="button" onclick="aiShareTool(this)"
            style="padding:12px 16px;background:rgba(147,112,219,0.1);border:1px solid rgba(147,112,219,0.3);border-radius:8px;color:#9370db;cursor:pointer;">
      üì§ Share
    </button>
    <button type="button" onclick="aiResetTool(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      üîÑ Reset
    </button>
  </div>
</form>

<div aria-live="polite" style="margin-top:20px;">
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.08);margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="font-weight:600;color:var(--accent);">üéØ Generated AI Tool Preview</div>
      <div id="ai-tool-stats" class="small" style="color:var(--muted);">
        <span id="ai-blocks-count">0</span> blocks ‚Ä¢ <span id="ai-tokens">~0 tokens</span>
      </div>
    </div>
    
    <div id="ai-tool-preview" style="min-height:200px;background:rgba(0,0,0,0.3);border-radius:8px;padding:20px;">
      <div style="color:var(--muted);text-align:center;padding:40px;">
        Your generated AI tool will appear here
      </div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <div style="background:linear-gradient(135deg, rgba(45,212,255,0.1), rgba(147,112,219,0.1));border-radius:8px;padding:16px;border:1px solid rgba(45,212,255,0.2);">
      <div style="font-weight:600;color:var(--accent);margin-bottom:12px;">üìä Tool Analytics</div>
      <div id="ai-analytics" class="small" style="color:var(--muted);">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div>Complexity:</div>
          <div id="ai-complexity" style="color:#39ff14;">Simple</div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div>Estimated Cost:</div>
          <div id="ai-cost" style="color:#ffa500;">$0.01 per use</div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div>Processing Time:</div>
          <div id="ai-time" style="color:#ff69b4;">~2 seconds</div>
        </div>
        <div style="display:flex;justify-content:space-between;">
          <div>Shareability:</div>
          <div id="ai-shareability" style="color:#9370db;">High</div>
        </div>
      </div>
    </div>
    
    <div style="background:linear-gradient(135deg, rgba(57,255,20,0.1), rgba(255,105,180,0.1));border-radius:8px;padding:16px;border:1px solid rgba(57,255,20,0.2);">
      <div style="font-weight:600;color:#39ff14;margin-bottom:12px;">üî• Trending AI Tools</div>
      <div id="ai-trending-tools" class="small" style="color:var(--muted);max-height:120px;overflow-y:auto;">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;padding:4px;cursor:pointer;" onclick="aiLoadTrending('resume-writer')">
          <div>üìÑ AI Resume Writer</div>
          <div style="color:#ff69b4;">1.2k uses</div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;padding:4px;cursor:pointer;" onclick="aiLoadTrending('instagram-captions')">
          <div>üì∏ Instagram Caption Generator</div>
          <div style="color:#ff69b4;">890 uses</div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;padding:4px;cursor:pointer;" onclick="aiLoadTrending('code-explainer')">
          <div>üíª Code Explainer</div>
          <div style="color:#ff69b4;">650 uses</div>
        </div>
        <div style="display:flex;justify-content:space-between;padding:4px;cursor:pointer;" onclick="aiLoadTrending('business-names')">
          <div>üè¢ Business Name Generator</div>
          <div style="color:#ff69b4;">540 uses</div>
        </div>
      </div>
    </div>
  </div>

  <div id="ai-share-container" style="display:none;background:rgba(147,112,219,0.1);border-radius:8px;padding:16px;border:1px solid rgba(147,112,219,0.3);margin-bottom:16px;">
    <div style="font-weight:600;color:#9370db;margin-bottom:8px;">üì± Share Your AI Tool</div>
    <div class="small" style="color:var(--muted);margin-bottom:8px;">Share this unique link with others:</div>
    <div style="display:flex;gap:8px;">
      <input id="ai-share-link" type="text" readonly 
             style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(147,112,219,0.3);background:rgba(0,0,0,0.3);color:inherit;font-family:monospace;font-size:12px;" />
      <button onclick="aiCopyShareLink()" style="padding:8px 16px;background:rgba(147,112,219,0.2);border:1px solid rgba(147,112,219,0.4);border-radius:6px;color:#9370db;cursor:pointer;">
        Copy
      </button>
    </div>
  </div>

  <div id="ai-hint" class="small" style="color:var(--accent);margin-top:12px;text-align:center;min-height:20px;padding:8px;background:rgba(45,212,255,0.05);border-radius:8px;"></div>
</div>

<script>
/* ai-toolbox-generator.html
   - Build custom AI tools by combining capabilities
   - Scoped with ai- prefix
   - Drag & drop interface
   - Shareable generated tools
*/

(function() {
  'use strict';
  
  const card = document.currentScript?.closest('.card') || document;
  
  // AI Building Blocks Database
  const aiBlocks = {
    // Text Processing Blocks
    'text-summarize': {
      name: 'üìÑ Summarize Text',
      category: 'text',
      description: 'Condense long text into key points',
      icon: 'üìÑ',
      color: '#4ecdc4',
      prompt: 'Summarize this text, highlighting the main points:',
      complexity: 1
    },
    'text-rewrite': {
      name: '‚úçÔ∏è Rewrite Text',
      category: 'text',
      description: 'Rephrase text while keeping meaning',
      icon: '‚úçÔ∏è',
      color: '#ff6b6b',
      prompt: 'Rewrite this text in a different style:',
      complexity: 1
    },
    'text-expand': {
      name: 'üìà Expand Text',
      category: 'text',
      description: 'Add more detail and explanation',
      icon: 'üìà',
      color: '#ffd166',
      prompt: 'Expand on this text with more detail:',
      complexity: 1
    },
    'text-translate': {
      name: 'üåê Translate',
      category: 'text',
      description: 'Translate text between languages',
      icon: 'üåê',
      color: '#06d6a0',
      prompt: 'Translate this text to {language}:',
      complexity: 2
    },
    
    // Creative Blocks
    'creative-generate': {
      name: '‚ú® Generate Ideas',
      category: 'creative',
      description: 'Brainstorm creative ideas',
      icon: '‚ú®',
      color: '#ff69b4',
      prompt: 'Generate creative ideas about:',
      complexity: 2
    },
    'creative-story': {
      name: 'üìñ Story Writer',
      category: 'creative',
      description: 'Write stories or narratives',
      icon: 'üìñ',
      color: '#9d4edd',
      prompt: 'Write a story about:',
      complexity: 3
    },
    'creative-poem': {
      name: 'üé≠ Poem Writer',
      category: 'creative',
      description: 'Create poems or lyrics',
      icon: 'üé≠',
      color: '#7209b7',
      prompt: 'Write a poem about:',
      complexity: 2
    },
    
    // Marketing Blocks
    'marketing-headline': {
      name: 'üì¢ Headline Generator',
      category: 'marketing',
      description: 'Create catchy headlines',
      icon: 'üì¢',
      color: '#ff9e00',
      prompt: 'Generate 5 catchy headlines for:',
      complexity: 1
    },
    'marketing-caption': {
      name: 'üì∏ Social Media Captions',
      category: 'marketing',
      description: 'Write social media captions',
      icon: 'üì∏',
      color: '#4361ee',
      prompt: 'Write engaging social media captions for:',
      complexity: 2
    },
    'marketing-adcopy': {
      name: 'üíº Ad Copy Writer',
      category: 'marketing',
      description: 'Create persuasive ad copy',
      icon: 'üíº',
      color: '#3a0ca3',
      prompt: 'Write persuasive ad copy for:',
      complexity: 3
    },
    
    // Coding Blocks
    'code-explain': {
      name: 'üíª Code Explainer',
      category: 'coding',
      description: 'Explain code in simple terms',
      icon: 'üíª',
      color: '#00bbf9',
      prompt: 'Explain this code:',
      complexity: 2
    },
    'code-generate': {
      name: '‚ö° Code Generator',
      category: 'coding',
      description: 'Generate code snippets',
      icon: '‚ö°',
      color: '#00f5d4',
      prompt: 'Generate code for:',
      complexity: 3
    },
    'code-debug': {
      name: 'üîß Code Debugger',
      category: 'coding',
      description: 'Find and fix bugs',
      icon: 'üîß',
      color: '#ff0054',
      prompt: 'Debug this code:',
      complexity: 3
    },
    
    // Analysis Blocks
    'analyze-sentiment': {
      name: 'üòä Sentiment Analysis',
      category: 'analysis',
      description: 'Analyze emotional tone',
      icon: 'üòä',
      color: '#8338ec',
      prompt: 'Analyze the sentiment of:',
      complexity: 2
    },
    'analyze-keywords': {
      name: 'üîë Keyword Extractor',
      category: 'analysis',
      description: 'Extract key terms and phrases',
      icon: 'üîë',
      color: '#ff006e',
      prompt: 'Extract keywords from:',
      complexity: 1
    },
    'analyze-structure': {
      name: 'üèóÔ∏è Structure Analyzer',
      category: 'analysis',
      description: 'Analyze text structure',
      icon: 'üèóÔ∏è',
      color: '#fb5607',
      prompt: 'Analyze the structure of:',
      complexity: 2
    }
  };
  
  // State management
  let aiSelectedBlocks = [];
  let aiCurrentTool = null;
  let aiIsGenerating = false;
  
  // Initialize function
  function aiInit() {
    console.log('AI Toolbox Generator initializing...');
    
    // Load saved tools
    const savedTools = localStorage.getItem('ai-saved-tools');
    if (savedTools) {
      try {
        const tools = JSON.parse(savedTools);
        // Could load into a gallery
      } catch (e) {
        console.log('Could not load saved tools:', e);
      }
    }
    
    // Setup building blocks
    aiSetupBuildingBlocks();
    
    // Setup drag and drop
    aiSetupDragAndDrop();
    
    // Setup event listeners
    aiSetupEventListeners();
    
    // Show initial hint
    aiShowHint('Drag AI blocks to the builder area to create your custom tool!', 'info');
  }
  
  // Setup building blocks display
  function aiSetupBuildingBlocks() {
    const blocksContainer = card.querySelector('#ai-blocks');
    blocksContainer.innerHTML = '';
    
    // Group blocks by category
    const categories = {
      text: [],
      creative: [],
      marketing: [],
      coding: [],
      analysis: []
    };
    
    Object.entries(aiBlocks).forEach(([id, block]) => {
      categories[block.category].push({id, ...block});
    });
    
    // Create blocks
    Object.entries(categories).forEach(([category, blocks]) => {
      if (blocks.length > 0) {
        blocks.forEach(block => {
          const blockElement = document.createElement('div');
          blockElement.className = 'ai-block';
          blockElement.dataset.id = block.id;
          blockElement.draggable = true;
          
          blockElement.style.padding = '8px';
          blockElement.style.background = `rgba(${parseInt(block.color.slice(1,3),16)},${parseInt(block.color.slice(3,5),16)},${parseInt(block.color.slice(5,7),16)},0.1)`;
          blockElement.style.border = `1px solid ${block.color}40`;
          blockElement.style.borderRadius = '6px';
          blockElement.style.cursor = 'grab';
          blockElement.style.transition = 'all 0.2s';
          blockElement.style.display = 'flex';
          blockElement.style.alignItems = 'center';
          blockElement.style.gap = '8px';
          
          blockElement.innerHTML = `
            <div style="font-size:20px;">${block.icon}</div>
            <div>
              <div style="font-weight:600;color:${block.color};">${block.name}</div>
              <div style="font-size:10px;color:var(--muted);">${block.description}</div>
            </div>
          `;
          
          // Add drag start event
          blockElement.addEventListener('dragstart', function(e) {
            e.dataTransfer.setData('text/plain', block.id);
            this.style.opacity = '0.5';
          });
          
          blockElement.addEventListener('dragend', function() {
            this.style.opacity = '1';
          });
          
          blocksContainer.appendChild(blockElement);
        });
      }
    });
  }
  
  // Setup drag and drop
  function aiSetupDragAndDrop() {
    const builderArea = card.querySelector('#ai-builder');
    
    builderArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      this.style.background = 'rgba(147,112,219,0.1)';
      this.style.borderColor = 'rgba(147,112,219,0.3)';
    });
    
    builderArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      this.style.background = 'rgba(0,0,0,0.1)';
      this.style.borderColor = 'rgba(255,255,255,0.1)';
    });
    
    builderArea.addEventListener('drop', function(e) {
      e.preventDefault();
      this.style.background = 'rgba(0,0,0,0.1)';
      this.style.borderColor = 'rgba(255,255,255,0.1)';
      
      const blockId = e.dataTransfer.getData('text/plain');
      if (blockId && aiBlocks[blockId]) {
        aiAddBlockToBuilder(blockId);
      }
    });
  }
  
  // Setup event listeners
  function aiSetupEventListeners() {
    // Auto-update on changes
    card.querySelector('#ai-tool-name').addEventListener('input', aiUpdateAnalytics);
    card.querySelector('#ai-tool-description').addEventListener('input', aiUpdateAnalytics);
  }
  
  // Add block to builder
  function aiAddBlockToBuilder(blockId) {
    const block = aiBlocks[blockId];
    if (!block) return;
    
    // Check if already added
    if (aiSelectedBlocks.includes(blockId)) {
      aiShowHint(`"${block.name}" already added to your tool`, 'warning');
      return;
    }
    
    // Add to selected blocks
    aiSelectedBlocks.push(blockId);
    
    // Update builder display
    aiUpdateBuilderDisplay();
    
    // Update analytics
    aiUpdateAnalytics();
    
    aiShowHint(`Added "${block.name}" to your tool`, 'success');
  }
  
  // Update builder display
  function aiUpdateBuilderDisplay() {
    const builderArea = card.querySelector('#ai-builder');
    
    if (aiSelectedBlocks.length === 0) {
      builderArea.innerHTML = `
        <div style="color:var(--muted);text-align:center;">
          <div style="font-size:48px;margin-bottom:8px;">‚¨áÔ∏è</div>
          <div>Drag AI blocks here to build your tool</div>
        </div>
      `;
      return;
    }
    
    let html = '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
    
    aiSelectedBlocks.forEach((blockId, index) => {
      const block = aiBlocks[blockId];
      html += `
        <div class="ai-builder-block" data-index="${index}" 
             style="padding:8px 12px;background:${block.color}20;border:1px solid ${block.color}40;border-radius:6px;display:flex;align-items:center;gap:6px;cursor:move;">
          <div style="font-size:16px;">${block.icon}</div>
          <div style="font-weight:600;color:${block.color};">${block.name}</div>
          <button onclick="aiRemoveBlock(${index})" 
                  style="margin-left:8px;background:transparent;border:none;color:#ff4d4d;cursor:pointer;font-size:12px;">
            ‚úï
          </button>
        </div>
      `;
    });
    
    html += '</div>';
    builderArea.innerHTML = html;
    
    // Make blocks in builder draggable for reordering
    aiMakeBuilderBlocksDraggable();
  }
  
  // Make builder blocks draggable for reordering
  function aiMakeBuilderBlocksDraggable() {
    const blocks = card.querySelectorAll('.ai-builder-block');
    
    blocks.forEach(block => {
      block.draggable = true;
      
      block.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', this.dataset.index);
        this.style.opacity = '0.5';
      });
      
      block.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.background = 'rgba(147,112,219,0.2)';
      });
      
      block.addEventListener('dragleave', function() {
        this.style.background = '';
      });
      
      block.addEventListener('drop', function(e) {
        e.preventDefault();
        this.style.background = '';
        
        const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
        const toIndex = parseInt(this.dataset.index);
        
        if (!isNaN(fromIndex) && !isNaN(toIndex) && fromIndex !== toIndex) {
          // Reorder blocks
          const [movedBlock] = aiSelectedBlocks.splice(fromIndex, 1);
          aiSelectedBlocks.splice(toIndex, 0, movedBlock);
          aiUpdateBuilderDisplay();
          aiUpdateAnalytics();
        }
      });
      
      block.addEventListener('dragend', function() {
        this.style.opacity = '1';
        this.style.background = '';
      });
    });
  }
  
  // Remove block from builder
  function aiRemoveBlock(index) {
    if (index >= 0 && index < aiSelectedBlocks.length) {
      const removedBlock = aiBlocks[aiSelectedBlocks[index]];
      aiSelectedBlocks.splice(index, 1);
      aiUpdateBuilderDisplay();
      aiUpdateAnalytics();
      aiShowHint(`Removed "${removedBlock.name}" from your tool`, 'info');
    }
  }
  
  // Update analytics
  function aiUpdateAnalytics() {
    const blockCount = aiSelectedBlocks.length;
    const toolName = card.querySelector('#ai-tool-name').value.trim();
    const description = card.querySelector('#ai-tool-description').value.trim();
    
    // Update counts
    card.querySelector('#ai-blocks-count').textContent = blockCount;
    
    // Calculate complexity
    let totalComplexity = aiSelectedBlocks.reduce((sum, blockId) => {
      return sum + (aiBlocks[blockId]?.complexity || 1);
    }, 0);
    
    let complexity = 'Simple';
    if (totalComplexity >= 6) complexity = 'Advanced';
    else if (totalComplexity >= 3) complexity = 'Moderate';
    
    card.querySelector('#ai-complexity').textContent = complexity;
    card.querySelector('#ai-complexity').style.color = 
      complexity === 'Simple' ? '#39ff14' : 
      complexity === 'Moderate' ? '#ffa500' : '#ff4d4d';
    
    // Estimate cost
    const estimatedCost = (totalComplexity * 0.003).toFixed(3);
    card.querySelector('#ai-cost').textContent = `$${estimatedCost} per use`;
    
    // Estimate time
    const estimatedTime = totalComplexity * 1.5;
    card.querySelector('#ai-time').textContent = `~${estimatedTime.toFixed(1)} seconds`;
    
    // Calculate tokens
    const nameTokens = toolName.length / 4;
    const descTokens = description.length / 4;
    const blockTokens = totalComplexity * 50;
    const totalTokens = Math.round(nameTokens + descTokens + blockTokens);
    
    card.querySelector('#ai-tokens').textContent = `~${totalTokens} tokens`;
    
    // Shareability score
    let shareability = 'High';
    if (blockCount === 0) shareability = 'Low';
    else if (totalComplexity >= 6) shareability = 'Medium';
    
    card.querySelector('#ai-shareability').textContent = shareability;
    card.querySelector('#ai-shareability').style.color = 
      shareability === 'High' ? '#9370db' : 
      shareability === 'Medium' ? '#ffa500' : '#ff4d4d';
  }
  
  // Generate AI tool
  function aiGenerateTool(btn) {
    if (aiIsGenerating) return;
    
    const toolName = card.querySelector('#ai-tool-name').value.trim();
    const category = card.querySelector('#ai-tool-category').value;
    const description = card.querySelector('#ai-tool-description').value.trim();
    
    if (!toolName) {
      aiShowHint('Please give your AI tool a name', 'warning');
      return;
    }
    
    if (aiSelectedBlocks.length === 0) {
      aiShowHint('Add at least one AI block to your tool', 'warning');
      return;
    }
    
    if (!description) {
      aiShowHint('Please describe what your tool does', 'warning');
      return;
    }
    
    aiIsGenerating = true;
    const generateBtn = card.querySelector('#ai-generate-btn');
    const originalText = generateBtn.textContent;
    generateBtn.textContent = '‚ö° Generating...';
    generateBtn.disabled = true;
    
    // Simulate generation process
    setTimeout(() => {
      try {
        // Build the AI tool
        aiCurrentTool = {
          id: 'tool_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          name: toolName,
          category: category,
          description: description,
          blocks: aiSelectedBlocks.map(id => aiBlocks[id]),
          createdAt: new Date().toISOString(),
          usageCount: 0
        };
        
        // Generate preview
        aiGenerateToolPreview();
        
        // Enable save and share buttons
        card.querySelector('#ai-share-container').style.display = 'none';
        
        aiShowHint(`‚úÖ Successfully generated "${toolName}"!`, 'success');
        
      } catch (error) {
        console.error('Tool generation error:', error);
        aiShowHint('‚ùå Failed to generate tool', 'error');
      } finally {
        aiIsGenerating = false;
        generateBtn.textContent = originalText;
        generateBtn.disabled = false;
      }
    }, 1000);
  }
  
  // Generate tool preview
  function aiGenerateToolPreview() {
    const preview = card.querySelector('#ai-tool-preview');
    
    if (!aiCurrentTool) {
      preview.innerHTML = '<div style="color:var(--muted);text-align:center;padding:40px;">Your generated AI tool will appear here</div>';
      return;
    }
    
    const { name, description, blocks } = aiCurrentTool;
    
    let html = `
      <div style="margin-bottom:16px;">
        <div style="font-size:24px;font-weight:bold;color:var(--accent);margin-bottom:8px;">${name}</div>
        <div style="color:var(--muted);margin-bottom:16px;">${description}</div>
      </div>
      
      <div style="margin-bottom:16px;">
        <div style="font-weight:600;color:var(--accent);margin-bottom:8px;">üß± AI Capabilities Included:</div>
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
    `;
    
    blocks.forEach(block => {
      html += `
        <div style="padding:6px 10px;background:${block.color}20;border:1px solid ${block.color}40;border-radius:6px;display:flex;align-items:center;gap:6px;">
          <div>${block.icon}</div>
          <div style="font-size:12px;color:${block.color};">${block.name}</div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
      
      <div style="background:rgba(0,0,0,0.3);border-radius:8px;padding:16px;">
        <div style="font-weight:600;color:#39ff14;margin-bottom:8px;">üéØ How to use this tool:</div>
        <div style="color:var(--muted);font-size:14px;">
          1. Input your text/task in the box below<br>
          2. Click "Process" to apply all AI capabilities<br>
          3. Get enhanced output with ${blocks.length} AI transformations<br>
          4. Copy or export your results
        </div>
      </div>
      
      <div style="margin-top:16px;">
        <textarea id="ai-tool-input" rows="3" 
                  style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;margin-bottom:12px;"
                  placeholder="Enter your text here..."></textarea>
        
        <div style="display:flex;gap:8px;">
          <button onclick="aiProcessInput()" 
                  style="flex:1;padding:10px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:6px;color:#39ff14;cursor:pointer;">
            üöÄ Process with AI
          </button>
          <button onclick="aiResetInput()" 
                  style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">
            üîÑ Clear
          </button>
        </div>
      </div>
      
      <div id="ai-tool-output" style="margin-top:16px;display:none;">
        <div style="font-weight:600;color:#ff69b4;margin-bottom:8px;">‚ú® Enhanced Output:</div>
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;padding:16px;color:var(--text);min-height:100px;font-size:14px;line-height:1.5;">
          Your processed output will appear here...
        </div>
      </div>
    `;
    
    preview.innerHTML = html;
  }
  
  // Process input with AI tool
  function aiProcessInput() {
    const input = card.querySelector('#ai-tool-input')?.value.trim();
    if (!input) {
      aiShowHint('Please enter some text to process', 'warning');
      return;
    }
    
    // Simulate AI processing
    const outputArea = card.querySelector('#ai-tool-output');
    if (outputArea) {
      outputArea.style.display = 'block';
      outputArea.querySelector('div:last-child').innerHTML = `
        <div style="color:#39ff14;margin-bottom:8px;">‚ö° Processing with ${aiCurrentTool.blocks.length} AI capabilities...</div>
        <div style="margin-bottom:12px;">${input}</div>
        <div style="border-left:3px solid #ff69b4;padding-left:12px;margin-top:12px;">
          <div style="color:#ff69b4;font-weight:600;margin-bottom:4px;">AI Enhanced:</div>
          <div>${aiSimulateAIProcessing(input)}</div>
        </div>
      `;
      
      // Track usage
      if (aiCurrentTool) {
        aiCurrentTool.usageCount = (aiCurrentTool.usageCount || 0) + 1;
      }
      
      aiShowHint('‚úÖ Text processed with AI enhancements!', 'success');
    }
  }
  
  // Simulate AI processing (demo)
  function aiSimulateAIProcessing(input) {
    // This would call actual AI APIs in production
    // For demo, we simulate transformations
    
    let output = input;
    
    if (aiCurrentTool?.blocks) {
      aiCurrentTool.blocks.forEach(block => {
        switch(block.id) {
          case 'text-summarize':
            output = `üìÑ Summary: ${output.substring(0, 100)}... [Key points extracted]`;
            break;
          case 'text-rewrite':
            output = `‚úçÔ∏è Rewritten: ${output} [Rephrased for clarity]`;
            break;
          case 'text-expand':
            output = `üìà Expanded: ${output} [Additional details and explanations added]`;
            break;
          case 'creative-generate':
            output = `‚ú® Enhanced: ${output} [Creative ideas generated]`;
            break;
          case 'marketing-headline':
            output = `üì¢ Headlines: 1) "${output}" 2) "Discover ${output}" 3) "Ultimate Guide to ${output}"`;
            break;
        }
      });
    }
    
    return output;
  }
  
  // Preview tool
  function aiPreviewTool(btn) {
    if (!aiCurrentTool) {
      aiShowHint('Generate a tool first to preview', 'warning');
      return;
    }
    
    aiGenerateToolPreview();
    aiShowHint('üëÅÔ∏è Tool preview updated', 'info');
  }
  
  // Save tool
  function aiSaveTool(btn) {
    if (!aiCurrentTool) {
      aiShowHint('Generate a tool first to save', 'warning');
      return;
    }
    
    // Get saved tools from localStorage
    const savedTools = JSON.parse(localStorage.getItem('ai-saved-tools') || '[]');
    
    // Check if already saved
    const existingIndex = savedTools.findIndex(tool => tool.id === aiCurrentTool.id);
    if (existingIndex !== -1) {
      savedTools[existingIndex] = aiCurrentTool;
    } else {
      savedTools.push(aiCurrentTool);
    }
    
    // Save to localStorage
    localStorage.setItem('ai-saved-tools', JSON.stringify(savedTools));
    
    // Generate share link
    aiGenerateShareLink();
    
    aiShowHint('üíæ Tool saved successfully!', 'success');
  }
  
  // Share tool
  function aiShareTool(btn) {
    if (!aiCurrentTool) {
      aiShowHint('Generate and save a tool first to share', 'warning');
      return;
    }
    
    // Show share container
    const shareContainer = card.querySelector('#ai-share-container');
    shareContainer.style.display = 'block';
    
    // Generate share link if not already generated
    if (!aiCurrentTool.shareLink) {
      aiGenerateShareLink();
    }
    
    const shareLink = card.querySelector('#ai-share-link');
    shareLink.value = aiCurrentTool.shareLink;
    
    aiShowHint('üì§ Ready to share your AI tool!', 'info');
  }
  
  // Generate share link
  function aiGenerateShareLink() {
    if (!aiCurrentTool) return;
    
    // Create shareable data
    const shareData = {
      name: aiCurrentTool.name,
      blocks: aiCurrentTool.blocks.map(b => b.id),
      description: aiCurrentTool.description,
      created: aiCurrentTool.createdAt
    };
    
    // Generate share link (in production, this would be a real URL)
    const encodedData = btoa(JSON.stringify(shareData));
    aiCurrentTool.shareLink = `${window.location.origin}/aitool/${aiCurrentTool.id}?data=${encodedData}`;
  }
  
  // Copy share link
  function aiCopyShareLink() {
    const shareLink = card.querySelector('#ai-share-link');
    if (!shareLink.value) return;
    
    shareLink.select();
    navigator.clipboard.writeText(shareLink.value).then(() => {
      aiShowHint('‚úÖ Share link copied to clipboard!', 'success');
    }).catch(err => {
      console.error('Copy failed:', err);
      aiShowHint('‚ùå Failed to copy link', 'error');
    });
  }
  
  // Load trending tool
  function aiLoadTrending(toolId) {
    // Example trending tools
    const trendingTools = {
      'resume-writer': {
        name: 'AI Resume Writer',
        blocks: ['text-rewrite', 'text-expand', 'analyze-keywords'],
        description: 'Professional resume optimization and writing assistance'
      },
      'instagram-captions': {
        name: 'Instagram Caption Generator',
        blocks: ['creative-generate', 'marketing-caption', 'text-rewrite'],
        description: 'Create engaging Instagram captions for any photo'
      },
      'code-explainer': {
        name: 'Code Explainer',
        blocks: ['code-explain', 'text-simplify', 'analyze-structure'],
        description: 'Explain complex code in simple, understandable terms'
      },
      'business-names': {
        name: 'Business Name Generator',
        blocks: ['creative-generate', 'analyze-keywords', 'marketing-headline'],
        description: 'Generate creative business names and check availability'
      }
    };
    
    const tool = trendingTools[toolId];
    if (!tool) return;
    
    // Load into builder
    aiSelectedBlocks = [...tool.blocks];
    card.querySelector('#ai-tool-name').value = tool.name;
    card.querySelector('#ai-tool-description').value = tool.description;
    
    // Update displays
    aiUpdateBuilderDisplay();
    aiUpdateAnalytics();
    
    aiShowHint(`Loaded trending tool: "${tool.name}"`, 'success');
  }
  
  // Reset tool
  function aiResetTool(btn) {
    aiSelectedBlocks = [];
    aiCurrentTool = null;
    
    card.querySelector('#ai-tool-name').value = '';
    card.querySelector('#ai-tool-description').value = '';
    card.querySelector('#ai-tool-category').value = 'writing';
    card.querySelector('#ai-tool-preview').innerHTML = '<div style="color:var(--muted);text-align:center;padding:40px;">Your generated AI tool will appear here</div>';
    card.querySelector('#ai-share-container').style.display = 'none';
    
    aiUpdateBuilderDisplay();
    aiUpdateAnalytics();
    
    aiShowHint('üîÑ Builder reset. Ready to create a new AI tool!', 'info');
  }
  
  // Reset input
  function aiResetInput() {
    const input = card.querySelector('#ai-tool-input');
    if (input) input.value = '';
    
    const output = card.querySelector('#ai-tool-output');
    if (output) output.style.display = 'none';
  }
  
  // Show hint message
  function aiShowHint(message, type = 'info') {
    const hint = card.querySelector('#ai-hint');
    hint.textContent = message;
    hint.style.color = type === 'error' ? '#ff4d4d' : 
                      type === 'warning' ? '#ffcc00' : 
                      type === 'success' ? '#39ff14' : 
                      '#2dd4ff';
    
    // Auto-clear after delay
    clearTimeout(hint.timeout);
    hint.timeout = setTimeout(() => {
      if (hint.textContent === message) {
        hint.textContent = '';
      }
    }, 3000);
  }
  
  // Expose functions globally (with prefix)
  window.aiGenerateTool = aiGenerateTool;
  window.aiPreviewTool = aiPreviewTool;
  window.aiSaveTool = aiSaveTool;
  window.aiShareTool = aiShareTool;
  window.aiResetTool = aiResetTool;
  window.aiRemoveBlock = aiRemoveBlock;
  window.aiLoadTrending = aiLoadTrending;
  window.aiProcessInput = aiProcessInput;
  window.aiResetInput = aiResetInput;
  window.aiCopyShareLink = aiCopyShareLink;
  
  // Initialize when ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', aiInit);
  } else {
    aiInit();
  }
  
})();
</script>

<style>
/* AI Toolbox Generator specific styles */
#ai-toolbox-title {
  color: var(--accent);
  margin-top: 0;
  text-shadow: 0 0 10px rgba(45,212,255,0.3);
}

/* AI block animations */
.ai-block {
  transition: all 0.3s ease;
}

.ai-block:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  cursor: grab;
}

.ai-block:active {
  cursor: grabbing;
  transform: scale(0.98);
}

/* Builder block styling */
.ai-builder-block {
  transition: all 0.2s ease;
}

.ai-builder-block:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

/* Drag and drop animations */
@keyframes aiPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

#ai-builder.dragover {
  animation: aiPulse 1s ease-in-out infinite;
  border-color: #9370db !important;
}

/* Trending tools scrollbar */
#ai-trending-tools::-webkit-scrollbar {
  width: 6px;
}

#ai-trending-tools::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#ai-trending-tools::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
}

/* Share link animation */
@keyframes aiHighlight {
  0% { border-color: rgba(147,112,219,0.3); }
  50% { border-color: rgba(147,112,219,0.8); }
  100% { border-color: rgba(147,112,219,0.3); }
}

#ai-share-link:focus {
  animation: aiHighlight 1s ease-in-out;
}

/* Responsive design */
@media (max-width: 768px) {
  div[style*="grid-template-columns:1fr 1fr"] {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  
  #ai-blocks {
    grid-template-columns: 1fr !important;
  }
  
  .ai-block {
    margin-bottom: 8px;
  }
}

@media (max-width: 480px) {
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin-bottom: 8px;
  }
  
  #ai-tool-preview {
    padding: 12px !important;
  }
}

/* Glow effect for generated tools */
#ai-tool-preview {
  box-shadow: 0 0 20px rgba(45,212,255,0.1);
  transition: all 0.3s ease;
}

#ai-tool-preview:hover {
  box-shadow: 0 0 30px rgba(45,212,255,0.2);
}

/* Loading animation */
@keyframes aiLoading {
  0% { opacity: 0.5; }
  50% { opacity: 1; }
  100% { opacity: 0.5; }
}

.ai-loading {
  animation: aiLoading 1.5s ease-in-out infinite;
}
</style>
