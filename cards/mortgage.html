<h2 id="mortgage-title" style="margin-top:0;color:var(--accent);">ğŸ  Mortgage Calculator</h2>

<form aria-describedby="mortgage-desc">
  <p id="mortgage-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Calculate detailed mortgage payments with amortization schedules, extra payments analysis, and regional comparisons.
    <span style="color:var(--accent);display:block;margin-top:4px;">ğŸ’° Monthly payments â€¢ Total interest â€¢ Payoff time â€¢ Amortization schedule â€¢ Regional presets</span>
  </p>

  <!-- MAIN CALCULATOR CONTROLS -->
  <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <!-- Property Value Section -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
      <div>
        <label for="mortgage-price" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          ğŸ¡ Property Value
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <select id="mortgage-currency" style="padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;cursor:pointer;">
            <option value="GBP">Â£ GBP</option>
            <option value="USD">$ USD</option>
            <option value="EUR">â‚¬ EUR</option>
            <option value="CAD">$ CAD</option>
            <option value="JPY">Â¥ JPY</option>
          </select>
          <input 
            id="mortgage-price" 
            type="number" 
            inputmode="decimal" 
            min="0" 
            step="1000" 
            value="350000"
            style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
          />
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button type="button" onclick="mcSetValue('price', 250000)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">Â£250K</button>
          <button type="button" onclick="mcSetValue('price', 350000)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">Â£350K</button>
          <button type="button" onclick="mcSetValue('price', 500000)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">Â£500K</button>
        </div>
      </div>

      <div>
        <label for="mortgage-preset" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          ğŸŒ Region Preset
        </label>
        <select id="mortgage-preset" onchange="mcApplyPreset(this.value)" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;cursor:pointer;">
          <option value="">Custom (Enter Values)</option>
          <option value="uk">ğŸ‡¬ğŸ‡§ United Kingdom (25y, 5.0%)</option>
          <option value="us">ğŸ‡ºğŸ‡¸ United States (30y, 6.5%)</option>
          <option value="de">ğŸ‡©ğŸ‡ª Germany (20y, 3.5%)</option>
          <option value="ca">ğŸ‡¨ğŸ‡¦ Canada (25y, 5.5%)</option>
          <option value="jp">ğŸ‡¯ğŸ‡µ Japan (35y, 1.5%)</option>
          <option value="au">ğŸ‡¦ğŸ‡º Australia (30y, 6.2%)</option>
          <option value="fr">ğŸ‡«ğŸ‡· France (20y, 3.8%)</option>
        </select>
        <div id="mc-preset-info" style="color:rgba(230,250,255,0.6);font-size:12px;margin-top:4px;"></div>
      </div>
    </div>

    <!-- Down Payment Section -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
      <div>
        <label for="mortgage-down" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          ğŸ’° Down Payment
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input 
            id="mortgage-down" 
            type="number" 
            inputmode="decimal" 
            min="0" 
            step="1000" 
            value="35000"
            style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
          />
          <div style="min-width:60px;text-align:center;color:rgba(230,250,255,0.7);font-size:13px;">
            <span id="mc-down-percent">10%</span> of value
          </div>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button type="button" onclick="mcSetDownPayment(5)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">5%</button>
          <button type="button" onclick="mcSetDownPayment(10)" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;flex:1;">10%</button>
          <button type="button" onclick="mcSetDownPayment(20)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">20%</button>
        </div>
      </div>

      <div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div>
            <label for="mortgage-rate" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
              ğŸ“ˆ Interest Rate
            </label>
            <div style="display:flex;align-items:center;gap:8px;">
              <input 
                id="mortgage-rate" 
                type="number" 
                inputmode="decimal" 
                min="0" 
                step="0.01" 
                value="4.5"
                style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
              />
              <div style="color:rgba(230,250,255,0.7);font-size:13px;white-space:nowrap;">%</div>
            </div>
          </div>

          <div>
            <label for="mortgage-years" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
              â±ï¸ Term Length
            </label>
            <div style="display:flex;align-items:center;gap:8px;">
              <input 
                id="mortgage-years" 
                type="number" 
                min="1" 
                max="50" 
                step="1" 
                value="25"
                style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
              />
              <div style="color:rgba(230,250,255,0.7);font-size:13px;white-space:nowrap;">years</div>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button type="button" onclick="mcSetTerm(15)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">15y</button>
          <button type="button" onclick="mcSetTerm(25)" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;flex:1;">25y</button>
          <button type="button" onclick="mcSetTerm(30)" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;flex:1;">30y</button>
        </div>
      </div>
    </div>

    <!-- Additional Options -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
      <div>
        <label for="mortgage-extra" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          ğŸš€ Extra Monthly Payment
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input 
            id="mortgage-extra" 
            type="number" 
            min="0" 
            step="50" 
            value="0"
            style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
          />
          <div style="color:rgba(230,250,255,0.7);font-size:12px;">per month</div>
        </div>
        <div style="color:rgba(230,250,255,0.6);font-size:12px;margin-top:4px;">
          Pay off faster & save on interest
        </div>
      </div>

      <div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div>
            <label for="mc-property-tax" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
              ğŸ›ï¸ Property Tax
            </label>
            <div style="display:flex;align-items:center;gap:4px;">
              <input 
                id="mc-property-tax" 
                type="number" 
                min="0" 
                step="100" 
                value="1200"
                style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
              />
              <div style="color:rgba(230,250,255,0.7);font-size:12px;">/year</div>
            </div>
          </div>

          <div>
            <label for="mc-insurance" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
              ğŸ›¡ï¸ Home Insurance
            </label>
            <div style="display:flex;align-items:center;gap:4px;">
              <input 
                id="mc-insurance" 
                type="number" 
                min="0" 
                step="50" 
                value="800"
                style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;"
              />
              <div style="color:rgba(230,250,255,0.7);font-size:12px;">/year</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scenario Comparison -->
    <div style="margin-top:20px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
      <div style="color:var(--accent);font-weight:500;margin-bottom:8px;font-size:14px;">ğŸ“Š Compare Scenarios:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="mcCompareScenario('no-extra')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">
          No Extra Payments
        </button>
        <button type="button" onclick="mcCompareScenario('with-extra')" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
          +Â£100/mo Extra
        </button>
        <button type="button" onclick="mcCompareScenario('refinance')" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
          Refinance @ 3.5%
        </button>
        <button type="button" onclick="mcCompareScenario('20-down')" style="padding:6px 12px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">
          20% Down Payment
        </button>
      </div>
    </div>
  </div>

  <!-- ACTION BUTTONS -->
  <div style="display:flex;gap:12px;margin-bottom:20px;">
    <button type="button" onclick="mcCalculate(this)" 
            style="flex:2;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:16px;">
      ğŸ§® Calculate Mortgage Details
    </button>
    <button type="button" onclick="mcReset(this)"
            style="flex:1;padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;">
      ğŸ”„ Reset
    </button>
    <button type="button" onclick="mcExport(this)"
            style="padding:14px 20px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:500;">
      ğŸ’¾ Export
    </button>
  </div>
</form>

<!-- RESULTS SECTION -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- QUICK SUMMARY -->
  <div style="background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:12px;border:1px solid rgba(255,255,255,0.08);padding:24px;margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">ğŸ’° Mortgage Summary</div>
      <div id="mc-status" style="color:rgba(230,250,255,0.7);font-size:13px;">Ready to calculate</div>
    </div>

    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:16px;margin-bottom:24px;">
      <div style="text-align:center;padding:16px;background:rgba(45,212,255,0.05);border-radius:10px;border:1px solid rgba(45,212,255,0.1);">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:6px;">Monthly Payment</div>
        <div id="mc-res-monthly" style="font-size:24px;font-weight:700;color:var(--accent);">â€“</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">Principal & Interest</div>
      </div>

      <div style="text-align:center;padding:16px;background:rgba(57,255,20,0.05);border-radius:10px;border:1px solid rgba(57,255,20,0.1);">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:6px;">Total Interest</div>
        <div id="mc-res-interest" style="font-size:24px;font-weight:700;color:#39ff14;">â€“</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">Over loan term</div>
      </div>

      <div style="text-align:center;padding:16px;background:rgba(255,204,0,0.05);border-radius:10px;border:1px solid rgba(255,204,0,0.1);">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:6px;">Payoff Time</div>
        <div id="mc-res-payoff" style="font-size:24px;font-weight:700;color:#ffcc00;">â€“</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">Years & Months</div>
      </div>

      <div style="text-align:center;padding:16px;background:rgba(157,78,221,0.05);border-radius:10px;border:1px solid rgba(157,78,221,0.1);">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:6px;">Total Cost</div>
        <div id="mc-res-total" style="font-size:24px;font-weight:700;color:#9d4edd;">â€“</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">Principal + Interest</div>
      </div>
    </div>

    <!-- Monthly Breakdown -->
    <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;margin-bottom:20px;">
      <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ“Š Loan Amount</div>
        <div id="mc-res-loan" style="font-size:16px;font-weight:600;color:var(--accent);">â€“</div>
      </div>
      <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ“ˆ Interest Rate</div>
        <div id="mc-res-rate" style="font-size:16px;font-weight:600;color:#39ff14;">â€“</div>
      </div>
      <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ’° Monthly Extra</div>
        <div id="mc-res-extra" style="font-size:16px;font-weight:600;color:#ffcc00;">â€“</div>
      </div>
    </div>

    <!-- Savings from Extra Payments -->
    <div id="mc-savings-container" style="display:none;padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.1);margin-top:16px;">
      <div style="color:#39ff14;font-weight:500;margin-bottom:8px;font-size:14px;">ğŸ’¸ Savings from Extra Payments:</div>
      <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;font-size:13px;">
        <div>Time saved: <span id="mc-savings-time" style="color:#39ff14;font-weight:600;">â€“</span></div>
        <div>Interest saved: <span id="mc-savings-interest" style="color:#39ff14;font-weight:600;">â€“</span></div>
        <div>Total saved: <span id="mc-savings-total" style="color:#39ff14;font-weight:600;">â€“</span></div>
      </div>
    </div>
  </div>

  <!-- AMORTIZATION CHART -->
  <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">ğŸ“Š Amortization Schedule</div>
      <div style="display:flex;gap:8px;">
        <button onclick="mcToggleChart('balance')" id="mc-chart-balance" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;font-weight:500;">
          Balance
        </button>
        <button onclick="mcToggleChart('interest')" id="mc-chart-interest" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">
          Interest/Principal
        </button>
        <button onclick="mcToggleChart('equity')" id="mc-chart-equity" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">
          Equity Build-up
        </button>
      </div>
    </div>
    
    <div style="height:300px;position:relative;">
      <canvas id="mc-amortization-chart" style="width:100%;height:100%;"></canvas>
      <div id="mc-chart-legend" style="position:absolute;top:16px;right:16px;background:rgba(0,0,0,0.7);padding:8px 12px;border-radius:6px;font-size:12px;display:none;"></div>
    </div>
    
    <div style="margin-top:16px;display:flex;justify-content:center;gap:16px;font-size:12px;color:rgba(230,250,255,0.7);">
      <div><span style="display:inline-block;width:12px;height:12px;background:var(--accent);border-radius:2px;margin-right:6px;"></span> Loan Balance</div>
      <div><span style="display:inline-block;width:12px;height:12px;background:#39ff14;border-radius:2px;margin-right:6px;"></span> Interest Paid</div>
      <div><span style="display:inline-block;width:12px;height:12px;background:#ffcc00;border-radius:2px;margin-right:6px;"></span> Principal Paid</div>
    </div>
  </div>

  <!-- YEARLY BREAKDOWN TABLE -->
  <div id="mc-table-container" style="display:none;background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">ğŸ“‹ Yearly Payment Breakdown</div>
      <div style="display:flex;gap:8px;">
        <button onclick="mcShowTable('yearly')" id="mc-table-yearly" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;font-weight:500;">
          Yearly
        </button>
        <button onclick="mcShowTable('monthly')" id="mc-table-monthly" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">
          Monthly
        </button>
        <button onclick="mcShowTable('summary')" id="mc-table-summary" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">
          Summary
        </button>
      </div>
    </div>
    
    <div style="overflow-x:auto;">
      <table id="mc-amortization-table" style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead>
          <tr style="background:rgba(0,0,0,0.2);">
            <th style="padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.1);">Year</th>
            <th style="padding:10px;text-align:right;border-bottom:1px solid rgba(255,255,255,0.1);">Balance</th>
            <th style="padding:10px;text-align:right;border-bottom:1px solid rgba(255,255,255,0.1);">Principal</th>
            <th style="padding:10px;text-align:right;border-bottom:1px solid rgba(255,255,255,0.1);">Interest</th>
            <th style="padding:10px;text-align:right;border-bottom:1px solid rgba(255,255,255,0.1);">Cumulative Interest</th>
          </tr>
        </thead>
        <tbody id="mc-table-body">
          <!-- Table rows will be inserted here -->
        </tbody>
      </table>
    </div>
    
    <div style="margin-top:12px;text-align:center;color:rgba(230,250,255,0.6);font-size:12px;">
      Showing first 10 years. Export full schedule for complete details.
    </div>
  </div>

  <!-- SCENARIO COMPARISON -->
  <div id="mc-comparison-container" style="display:none;background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);">
    <div style="color:var(--accent);font-weight:600;margin-bottom:16px;font-size:16px;">ğŸ“ˆ Scenario Comparison</div>
    
    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:12px;margin-bottom:20px;">
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Scenario</div>
        <div style="font-size:14px;color:var(--accent);font-weight:500;">Current</div>
      </div>
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Monthly Payment</div>
        <div id="mc-comp-monthly" style="font-size:16px;font-weight:600;color:#39ff14;">â€“</div>
      </div>
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Total Interest</div>
        <div id="mc-comp-interest" style="font-size:16px;font-weight:600;color:#ffcc00;">â€“</div>
      </div>
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Payoff Time</div>
        <div id="mc-comp-payoff" style="font-size:16px;font-weight:600;color:#9d4edd;">â€“</div>
      </div>
    </div>
    
    <div style="height:200px;">
      <canvas id="mc-comparison-chart" style="width:100%;height:100%;"></canvas>
    </div>
  </div>
</div>

<!-- EDUCATIONAL INFORMATION -->
<details style="margin-top:20px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.05);overflow:hidden;">
  <summary style="padding:16px;color:var(--accent);font-weight:600;font-size:15px;cursor:pointer;list-style:none;">
    ğŸ“š Mortgage Concepts Explained
  </summary>
  <div style="padding:16px;border-top:1px solid rgba(255,255,255,0.05);">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;">
      <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
        <div style="color:var(--accent);font-weight:500;margin-bottom:6px;font-size:14px;">ğŸ“ˆ Amortization Formula</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.5;">
          M = P Ã— [r(1+r)^n] / [(1+r)^n - 1]<br>
          Where:<br>
          M = Monthly payment<br>
          P = Principal loan amount<br>
          r = Monthly interest rate<br>
          n = Number of payments
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.1);">
        <div style="color:#39ff14;font-weight:500;margin-bottom:6px;font-size:14px;">ğŸ’° Extra Payments</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.5;">
          Extra payments go directly toward principal, reducing:<br>
          â€¢ Total interest paid<br>
          â€¢ Loan term length<br>
          â€¢ Future interest calculations<br>
          Even small extra payments can save thousands!
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.1);">
        <div style="color:#ffcc00;font-weight:500;margin-bottom:6px;font-size:14px;">ğŸ›ï¸ Property Taxes & Insurance</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.5;">
          Lenders often require escrow for:<br>
          â€¢ Property taxes (1-3% of home value)<br>
          â€¢ Homeowners insurance (0.3-0.5%)<br>
          â€¢ PMI if down payment < 20%<br>
          These add to your monthly housing costs.
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.1);">
        <div style="color:#9d4edd;font-weight:500;margin-bottom:6px;font-size:14px;">ğŸ“Š Regional Differences</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.5;">
          Mortgage terms vary by country:<br>
          â€¢ US: 30-year fixed common<br>
          â€¢ UK: 25-year with 5-10% down<br>
          â€¢ Japan: 35-year with low rates<br>
          â€¢ Germany: 20-year with strict requirements
        </div>
      </div>
    </div>
  </div>
</details>

<script>
/* mortgage-calculator.html
   Advanced mortgage calculator with amortization, visualizations, and scenario analysis
   Scoped with 'mc' prefix (mortgage calculator)
*/

// APPLICATION STATE
let mcState = {
  currency: 'GBP',
  chartType: 'balance',
  tableType: 'yearly',
  amortizationData: null,
  comparisonData: null,
  chartInstance: null,
  comparisonChart: null
};

// REGION PRESETS
const mcPresets = {
  uk: { years: 25, rate: 5.0, down: 35000, currency: 'GBP', name: 'United Kingdom' },
  us: { years: 30, rate: 6.5, down: 60000, currency: 'USD', name: 'United States' },
  de: { years: 20, rate: 3.5, down: 50000, currency: 'EUR', name: 'Germany' },
  ca: { years: 25, rate: 5.5, down: 40000, currency: 'CAD', name: 'Canada' },
  jp: { years: 35, rate: 1.5, down: 50000, currency: 'JPY', name: 'Japan' },
  au: { years: 30, rate: 6.2, down: 45000, currency: 'AUD', name: 'Australia' },
  fr: { years: 20, rate: 3.8, down: 40000, currency: 'EUR', name: 'France' }
};

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
  // Update down payment percentage
  mcUpdateDownPaymentPercent();
  
  // Add event listeners
  document.getElementById('mortgage-price').addEventListener('input', mcUpdateDownPaymentPercent);
  document.getElementById('mortgage-down').addEventListener('input', mcUpdateDownPaymentPercent);
  document.getElementById('mortgage-currency').addEventListener('change', mcUpdateCurrency);
  
  console.log('Mortgage Calculator initialized');
});

// Helper: Format currency
function mcFormatCurrency(amount, currency = mcState.currency) {
  const formatters = {
    GBP: new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }),
    USD: new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }),
    EUR: new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }),
    CAD: new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' }),
    JPY: new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 })
  };
  
  const formatter = formatters[currency] || formatters.GBP;
  return formatter.format(amount);
}

// Update down payment percentage
function mcUpdateDownPaymentPercent() {
  const price = parseFloat(document.getElementById('mortgage-price').value) || 0;
  const down = parseFloat(document.getElementById('mortgage-down').value) || 0;
  
  if (price > 0) {
    const percent = ((down / price) * 100).toFixed(1);
    document.getElementById('mc-down-percent').textContent = `${percent}%`;
  }
}

// Update currency
function mcUpdateCurrency() {
  const currency = document.getElementById('mortgage-currency').value;
  mcState.currency = currency;
  
  // Update display
  const elements = document.querySelectorAll('[data-currency]');
  elements.forEach(el => {
    if (el.dataset.currencyValue) {
      const value = parseFloat(el.dataset.currencyValue);
      el.textContent = mcFormatCurrency(value, currency);
    }
  });
}

// Set property value
function mcSetValue(type, value) {
  const element = document.getElementById(`mortgage-${type}`);
  if (element) {
    element.value = value;
    element.dispatchEvent(new Event('input'));
  }
}

// Set down payment percentage
function mcSetDownPayment(percent) {
  const price = parseFloat(document.getElementById('mortgage-price').value) || 0;
  const down = (price * percent) / 100;
  document.getElementById('mortgage-down').value = Math.round(down);
  mcUpdateDownPaymentPercent();
}

// Set loan term
function mcSetTerm(years) {
  document.getElementById('mortgage-years').value = years;
}

// Apply region preset
function mcApplyPreset(region) {
  const preset = mcPresets[region];
  if (!preset) return;
  
  // Update inputs
  document.getElementById('mortgage-years').value = preset.years;
  document.getElementById('mortgage-rate').value = preset.rate;
  document.getElementById('mortgage-down').value = preset.down;
  document.getElementById('mortgage-currency').value = preset.currency;
  
  // Update display
  document.getElementById('mc-preset-info').textContent = `Typical ${preset.name} mortgage: ${preset.years} years, ${preset.rate}% interest`;
  
  // Update currency
  mcUpdateCurrency();
  mcUpdateDownPaymentPercent();
}

// Calculate mortgage
function mcCalculate(btn) {
  // Get input values
  const price = parseFloat(document.getElementById('mortgage-price').value) || 0;
  const down = parseFloat(document.getElementById('mortgage-down').value) || 0;
  const rate = parseFloat(document.getElementById('mortgage-rate').value) || 0;
  const years = parseInt(document.getElementById('mortgage-years').value) || 0;
  const extra = parseFloat(document.getElementById('mortgage-extra').value) || 0;
  const tax = parseFloat(document.getElementById('mc-property-tax').value) || 0;
  const insurance = parseFloat(document.getElementById('mc-insurance').value) || 0;
  
  // Calculate loan details
  const principal = Math.max(0, price - down);
  const months = years * 12;
  const monthlyRate = rate / 100 / 12;
  
  // Calculate monthly payment (amortization formula)
  let monthlyPayment = 0;
  let totalPayment = 0;
  let totalInterest = 0;
  let payoffMonths = months;
  
  if (months > 0 && principal > 0) {
    if (monthlyRate === 0) {
      // Simple division for 0% interest
      monthlyPayment = principal / months;
      totalInterest = 0;
      totalPayment = principal;
    } else {
      // Standard amortization formula
      const factor = Math.pow(1 + monthlyRate, months);
      monthlyPayment = (principal * monthlyRate * factor) / (factor - 1);
      
      // Calculate with extra payments
      const result = mcCalculateAmortization(principal, monthlyRate, months, extra);
      payoffMonths = result.payoffMonths;
      totalInterest = result.totalInterest;
      totalPayment = result.totalPayment;
    }
  }
  
  // Add property tax and insurance (monthly)
  const monthlyTax = tax / 12;
  const monthlyInsurance = insurance / 12;
  const totalMonthly = monthlyPayment + extra + monthlyTax + monthlyInsurance;
  
  // Calculate total cost
  const totalCost = principal + totalInterest + tax + insurance;
  
  // Format results
  const currency = mcState.currency;
  
  // Update summary cards
  document.getElementById('mc-res-monthly').textContent = mcFormatCurrency(totalMonthly, currency);
  document.getElementById('mc-res-interest').textContent = mcFormatCurrency(totalInterest, currency);
  document.getElementById('mc-res-total').textContent = mcFormatCurrency(totalCost, currency);
  
  // Calculate payoff time
  const payoffYears = Math.floor(payoffMonths / 12);
  const payoffMonthsRemainder = payoffMonths % 12;
  document.getElementById('mc-res-payoff').textContent = `${payoffYears}y ${payoffMonthsRemainder}m`;
  
  // Update details
  document.getElementById('mc-res-loan').textContent = mcFormatCurrency(principal, currency);
  document.getElementById('mc-res-rate').textContent = `${rate.toFixed(2)}%`;
  document.getElementById('mc-res-extra').textContent = mcFormatCurrency(extra, currency);
  
  // Update status
  document.getElementById('mc-status').textContent = 'Calculated';
  document.getElementById('mc-status').style.color = '#39ff14';
  
  // Calculate amortization schedule
  const amortizationData = mcGenerateAmortizationSchedule(principal, monthlyRate, months, extra);
  mcState.amortizationData = amortizationData;
  
  // Show savings if extra payments
  if (extra > 0) {
    const noExtraData = mcGenerateAmortizationSchedule(principal, monthlyRate, months, 0);
    const timeSaved = months - payoffMonths;
    const interestSaved = noExtraData.totalInterest - totalInterest;
    
    document.getElementById('mc-savings-container').style.display = 'block';
    document.getElementById('mc-savings-time').textContent = `${Math.floor(timeSaved/12)}y ${timeSaved%12}m`;
    document.getElementById('mc-savings-interest').textContent = mcFormatCurrency(interestSaved, currency);
    document.getElementById('mc-savings-total').textContent = mcFormatCurrency(interestSaved, currency);
  } else {
    document.getElementById('mc-savings-container').style.display = 'none';
  }
  
  // Show tables and charts
  document.getElementById('mc-table-container').style.display = 'block';
  document.getElementById('mc-comparison-container').style.display = 'block';
  
  // Generate charts
  mcGenerateChart(amortizationData);
  mcGenerateAmortizationTable(amortizationData);
  mcGenerateComparisonChart(principal, monthlyRate, months);
  
  // Visual feedback
  btn.innerHTML = 'âœ… Calculated!';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ§® Calculate Mortgage Details';
  }, 1000);
}

// Calculate amortization with extra payments
function mcCalculateAmortization(principal, monthlyRate, months, extra) {
  let balance = principal;
  let totalInterest = 0;
  let totalPayment = 0;
  let actualMonths = 0;
  
  const monthlyPayment = monthlyRate === 0 ? 
    principal / months : 
    (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
  
  while (balance > 0 && actualMonths < months * 3) { // Cap at 3x original term
    const interest = balance * monthlyRate;
    const principalPayment = Math.min(balance, monthlyPayment + extra - interest);
    
    totalInterest += interest;
    totalPayment += monthlyPayment + extra;
    balance -= principalPayment;
    actualMonths++;
    
    if (principalPayment <= 0) break; // Prevent infinite loop
  }
  
  return {
    payoffMonths: actualMonths,
    totalInterest: totalInterest,
    totalPayment: totalPayment
  };
}

// Generate amortization schedule
function mcGenerateAmortizationSchedule(principal, monthlyRate, months, extra) {
  let balance = principal;
  let totalInterest = 0;
  let totalPrincipal = 0;
  const schedule = [];
  const yearlySummary = [];
  
  const monthlyPayment = monthlyRate === 0 ? 
    principal / months : 
    (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
  
  let yearInterest = 0;
  let yearPrincipal = 0;
  
  for (let month = 1; month <= months && balance > 0; month++) {
    const interest = balance * monthlyRate;
    const principalPayment = Math.min(balance, monthlyPayment + extra - interest);
    
    totalInterest += interest;
    totalPrincipal += principalPayment;
    balance -= principalPayment;
    
    // Track yearly totals
    yearInterest += interest;
    yearPrincipal += principalPayment;
    
    // Add to monthly schedule (store only every 12th month for performance)
    if (month % 12 === 0 || month === 1 || balance <= 0) {
      schedule.push({
        month: month,
        balance: balance > 0 ? balance : 0,
        interest: interest,
        principal: principalPayment,
        cumulativeInterest: totalInterest
      });
    }
    
    // Yearly summary
    if (month % 12 === 0 || balance <= 0) {
      yearlySummary.push({
        year: Math.ceil(month / 12),
        balance: balance > 0 ? balance : 0,
        interest: yearInterest,
        principal: yearPrincipal,
        cumulativeInterest: totalInterest
      });
      
      yearInterest = 0;
      yearPrincipal = 0;
    }
  }
  
  return {
    schedule: schedule,
    yearlySummary: yearlySummary,
    totalInterest: totalInterest,
    totalPrincipal: totalPrincipal,
    finalBalance: balance
  };
}

// Generate amortization chart
function mcGenerateChart(data) {
  const canvas = document.getElementById('mc-amortization-chart');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  
  // Destroy existing chart
  if (mcState.chartInstance) {
    mcState.chartInstance.destroy();
  }
  
  const labels = data.schedule.map(item => `Year ${Math.ceil(item.month / 12)}`);
  const balances = data.schedule.map(item => item.balance);
  const interest = data.schedule.map(item => item.cumulativeInterest);
  
  mcState.chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Loan Balance',
          data: balances,
          borderColor: 'rgba(45,212,255,1)',
          backgroundColor: 'rgba(45,212,255,0.1)',
          fill: true,
          tension: 0.4
        },
        {
          label: 'Cumulative Interest',
          data: interest,
          borderColor: 'rgba(57,255,20,1)',
          backgroundColor: 'rgba(57,255,20,0.1)',
          fill: true,
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: 'rgba(230,250,255,0.9)'
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255,255,255,0.1)'
          },
          ticks: {
            color: 'rgba(230,250,255,0.7)'
          }
        },
        y: {
          grid: {
            color: 'rgba(255,255,255,0.1)'
          },
          ticks: {
            color: 'rgba(230,250,255,0.7)',
            callback: function(value) {
              return mcFormatCurrency(value, mcState.currency);
            }
          }
        }
      }
    }
  });
}

// Generate amortization table
function mcGenerateAmortizationTable(data) {
  const tbody = document.getElementById('mc-table-body');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  // Show only first 10 years for performance
  const displayYears = data.yearlySummary.slice(0, 10);
  
  displayYears.forEach(yearData => {
    const row = document.createElement('tr');
    row.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
    row.innerHTML = `
      <td style="padding:10px;">Year ${yearData.year}</td>
      <td style="padding:10px;text-align:right;">${mcFormatCurrency(yearData.balance, mcState.currency)}</td>
      <td style="padding:10px;text-align:right;color:#ffcc00;">${mcFormatCurrency(yearData.principal, mcState.currency)}</td>
      <td style="padding:10px;text-align:right;color:#39ff14;">${mcFormatCurrency(yearData.interest, mcState.currency)}</td>
      <td style="padding:10px;text-align:right;color:rgba(230,250,255,0.7);">${mcFormatCurrency(yearData.cumulativeInterest, mcState.currency)}</td>
    `;
    tbody.appendChild(row);
  });
}

// Generate comparison chart
function mcGenerateComparisonChart(principal, monthlyRate, months) {
  const canvas = document.getElementById('mc-comparison-chart');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  
  // Destroy existing chart
  if (mcState.comparisonChart) {
    mcState.comparisonChart.destroy();
  }
  
  // Calculate different scenarios
  const scenarios = [
    { label: 'No Extra', extra: 0, color: 'rgba(45,212,255,0.8)' },
    { label: '+Â£100/mo', extra: 100, color: 'rgba(57,255,20,0.8)' },
    { label: '+Â£200/mo', extra: 200, color: 'rgba(255,204,0,0.8)' },
    { label: '+Â£500/mo', extra: 500, color: 'rgba(157,78,221,0.8)' }
  ];
  
  const data = scenarios.map(scenario => {
    const result = mcCalculateAmortization(principal, monthlyRate, months, scenario.extra);
    return {
      label: scenario.label,
      interest: result.totalInterest,
      months: result.payoffMonths,
      color: scenario.color
    };
  });
  
  // Update comparison display
  const currentExtra = parseFloat(document.getElementById('mortgage-extra').value) || 0;
  const currentResult = mcCalculateAmortization(principal, monthlyRate, months, currentExtra);
  
  document.getElementById('mc-comp-monthly').textContent = mcFormatCurrency(
    (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1) + currentExtra,
    mcState.currency
  );
  document.getElementById('mc-comp-interest').textContent = mcFormatCurrency(currentResult.totalInterest, mcState.currency);
  document.getElementById('mc-comp-payoff').textContent = `${Math.floor(currentResult.payoffMonths/12)}y ${currentResult.payoffMonths%12}m`;
  
  mcState.comparisonChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.map(d => d.label),
      datasets: [
        {
          label: 'Total Interest',
          data: data.map(d => d.interest),
          backgroundColor: data.map(d => d.color),
          borderColor: data.map(d => d.color.replace('0.8', '1')),
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const scenario = data[context.dataIndex];
              return [
                `Interest: ${mcFormatCurrency(scenario.interest, mcState.currency)}`,
                `Payoff: ${Math.floor(scenario.months/12)}y ${scenario.months%12}m`
              ];
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255,255,255,0.1)'
          },
          ticks: {
            color: 'rgba(230,250,255,0.7)'
          }
        },
        y: {
          grid: {
            color: 'rgba(255,255,255,0.1)'
          },
          ticks: {
            color: 'rgba(230,250,255,0.7)',
            callback: function(value) {
              return mcFormatCurrency(value, mcState.currency);
            }
          }
        }
      }
    }
  });
}

// Toggle chart type
function mcToggleChart(type) {
  mcState.chartType = type;
  
  // Update button styles
  ['balance', 'interest', 'equity'].forEach(t => {
    const btn = document.getElementById(`mc-chart-${t}`);
    if (btn) {
      if (t === type) {
        btn.style.background = 'rgba(45,212,255,0.1)';
        btn.style.border = '1px solid rgba(45,212,255,0.3)';
        btn.style.color = 'var(--accent)';
        btn.style.fontWeight = '500';
      } else {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = '#e6faff';
        btn.style.fontWeight = '400';
      }
    }
  });
  
  // Regenerate chart with new type
  if (mcState.amortizationData) {
    mcGenerateChart(mcState.amortizationData); // In full version, this would change chart data
  }
}

// Show table type
function mcShowTable(type) {
  mcState.tableType = type;
  
  // Update button styles
  ['yearly', 'monthly', 'summary'].forEach(t => {
    const btn = document.getElementById(`mc-table-${t}`);
    if (btn) {
      if (t === type) {
        btn.style.background = 'rgba(45,212,255,0.1)';
        btn.style.border = '1px solid rgba(45,212,255,0.3)';
        btn.style.color = 'var(--accent)';
        btn.style.fontWeight = '500';
      } else {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = '#e6faff';
        btn.style.fontWeight = '400';
      }
    }
  });
  
  // Regenerate table with new type
  if (mcState.amortizationData) {
    mcGenerateAmortizationTable(mcState.amortizationData); // In full version, this would change table data
  }
}

// Compare scenario
function mcCompareScenario(scenario) {
  const price = parseFloat(document.getElementById('mortgage-price').value) || 350000;
  const down = parseFloat(document.getElementById('mortgage-down').value) || 35000;
  const principal = Math.max(0, price - down);
  
  switch(scenario) {
    case 'no-extra':
      document.getElementById('mortgage-extra').value = 0;
      break;
    case 'with-extra':
      document.getElementById('mortgage-extra').value = 100;
      break;
    case 'refinance':
      document.getElementById('mortgage-rate').value = 3.5;
      document.getElementById('mortgage-extra').value = 0;
      break;
    case '20-down':
      const twentyPercent = price * 0.2;
      document.getElementById('mortgage-down').value = Math.round(twentyPercent);
      mcUpdateDownPaymentPercent();
      break;
  }
  
  // Recalculate
  mcCalculate(document.querySelector('[onclick="mcCalculate(this)"]'));
  
  // Visual feedback
  const buttons = document.querySelectorAll(`[onclick="mcCompareScenario('${scenario}')"]`);
  buttons.forEach(btn => {
    btn.style.animation = 'pulse 0.5s';
    setTimeout(() => {
      btn.style.animation = '';
    }, 500);
  });
}

// Export data
function mcExport(btn) {
  if (!mcState.amortizationData) {
    alert('Calculate mortgage first before exporting.');
    return;
  }
  
  const data = {
    calculationDate: new Date().toISOString(),
    inputs: {
      price: document.getElementById('mortgage-price').value,
      down: document.getElementById('mortgage-down').value,
      rate: document.getElementById('mortgage-rate').value,
      years: document.getElementById('mortgage-years').value,
      extra: document.getElementById('mortgage-extra').value,
      currency: mcState.currency
    },
    results: {
      monthlyPayment: document.getElementById('mc-res-monthly').textContent,
      totalInterest: document.getElementById('mc-res-interest').textContent,
      totalCost: document.getElementById('mc-res-total').textContent,
      payoffTime: document.getElementById('mc-res-payoff').textContent
    },
    amortizationSchedule: mcState.amortizationData.yearlySummary
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `mortgage-calculator-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  // Visual feedback
  btn.innerHTML = 'âœ… Exported!';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ’¾ Export';
  }, 1000);
}

// Reset calculator
function mcReset(btn) {
  // Reset inputs
  document.querySelector('form').reset();
  
  // Reset currency
  mcState.currency = 'GBP';
  document.getElementById('mortgage-currency').value = 'GBP';
  
  // Reset displays
  document.getElementById('mc-down-percent').textContent = '10%';
  document.getElementById('mc-preset-info').textContent = '';
  document.getElementById('mc-status').textContent = 'Ready to calculate';
  document.getElementById('mc-status').style.color = 'rgba(230,250,255,0.7)';
  
  // Clear results
  document.getElementById('mc-res-monthly').textContent = 'â€“';
  document.getElementById('mc-res-interest').textContent = 'â€“';
  document.getElementById('mc-res-total').textContent = 'â€“';
  document.getElementById('mc-res-payoff').textContent = 'â€“';
  document.getElementById('mc-res-loan').textContent = 'â€“';
  document.getElementById('mc-res-rate').textContent = 'â€“';
  document.getElementById('mc-res-extra').textContent = 'â€“';
  
  // Hide containers
  document.getElementById('mc-savings-container').style.display = 'none';
  document.getElementById('mc-table-container').style.display = 'none';
  document.getElementById('mc-comparison-container').style.display = 'none';
  
  // Clear charts
  if (mcState.chartInstance) {
    mcState.chartInstance.destroy();
    mcState.chartInstance = null;
  }
  
  if (mcState.comparisonChart) {
    mcState.comparisonChart.destroy();
    mcState.comparisonChart = null;
  }
  
  // Clear table
  document.getElementById('mc-table-body').innerHTML = '';
  
  // Visual feedback
  btn.innerHTML = 'âœ… Reset!';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ”„ Reset';
  }, 1000);
}
</script>

<!-- CUSTOM STYLES -->
<style>
#mortgage-title {
  background: linear-gradient(135deg, var(--accent), #ffcc00);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

/* Animations */
@keyframes mcPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

@keyframes mcSlideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.mc-result-card {
  animation: mcSlideIn 0.4s ease-out;
}

/* Custom scrollbar for table */
#mc-table-container > div {
  scrollbar-width: thin;
  scrollbar-color: var(--accent) rgba(255,255,255,0.05);
}

#mc-table-container > div::-webkit-scrollbar {
  height: 6px;
}

#mc-table-container > div::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#mc-table-container > div::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .mc-summary-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
  }
  
  .mc-input-grid {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
}

@media (max-width: 768px) {
  .mc-summary-grid {
    grid-template-columns: 1fr !important;
  }
  
  .mc-details-grid {
    grid-template-columns: 1fr !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin: 4px 0 !important;
  }
  
  .mc-chart-buttons,
  .mc-table-buttons {
    flex-direction: column !important;
  }
  
  .mc-chart-buttons button,
  .mc-table-buttons button {
    width: 100% !important;
    margin: 2px 0 !important;
  }
}

/* Print styles */
@media print {
  button, details, #mc-table-buttons, #mc-chart-buttons {
    display: none !important;
  }
  
  #mc-table-container {
    display: block !important;
    page-break-inside: avoid;
  }
  
  .mc-result-card {
    break-inside: avoid;
    border: 1px solid #000 !important;
    background: white !important;
    color: black !important;
  }
}

/* Input focus effects */
input:focus, select:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Hover effects */
.mc-result-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

/* Table row hover */
#mc-table-body tr:hover {
  background: rgba(45,212,255,0.05) !important;
}

/* Chart tooltip customization */
.chartjs-tooltip {
  background: rgba(0,0,0,0.8) !important;
  border: 1px solid var(--accent) !important;
  border-radius: 6px !important;
  padding: 8px 12px !important;
}

/* Loading animation */
@keyframes mcLoading {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.mc-loading {
  animation: mcLoading 1s linear infinite;
  display: inline-block;
  margin-right: 8px;
}
</style>
