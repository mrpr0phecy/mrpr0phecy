<!-- cards/ear-trainer.html -->
<h2 id="ear-trainer-title" style="margin-top:0;color:var(--accent);position:relative;">
  üéµ Ear Trainer
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    Educational Tool
  </span>
</h2>

<form aria-describedby="ear-trainer-desc">
  <p id="ear-trainer-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Practice recognizing musical intervals with visual guides. ‚ö†Ô∏è For educational purposes ‚Äî always verify with professional resources.
  </p>

  <!-- Interval Selector with Visual Icons -->
  <div style="margin-bottom:20px;">
    <label style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
      üéº Select Interval to Practice
    </label>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;">
      <button type="button" onclick="etSelectInterval('major2')" 
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;transition:all 0.2s;">
        <div style="font-size:1.2rem;">üéµ</div>
        <div style="font-size:0.85rem;">Major 2nd</div>
      </button>
      <button type="button" onclick="etSelectInterval('minor3')"
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;transition:all 0.2s;">
        <div style="font-size:1.2rem;">üé∂</div>
        <div style="font-size:0.85rem;">Minor 3rd</div>
      </button>
      <button type="button" onclick="etSelectInterval('major3')"
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;transition:all 0.2s;">
        <div style="font-size:1.2rem;">üéπ</div>
        <div style="font-size:0.85rem;font-weight:600;">Major 3rd</div>
      </button>
      <button type="button" onclick="etSelectInterval('perfect5')"
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;transition:all 0.2s;">
        <div style="font-size:1.2rem;">‚ú®</div>
        <div style="font-size:0.85rem;">Perfect 5th</div>
      </button>
    </div>
  </div>

  <!-- Main Controls in Grid -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px;margin-bottom:16px;">
    <div class="field">
      <label for="et-interval" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Interval Type
      </label>
      <select id="et-interval" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="major2">Major Second (2 semitones)</option>
        <option value="minor3">Minor Third (3 semitones)</option>
        <option value="major3" selected>Major Third (4 semitones)</option>
        <option value="perfect4">Perfect Fourth (5 semitones)</option>
        <option value="tritone">Tritone (6 semitones)</option>
        <option value="perfect5">Perfect Fifth (7 semitones)</option>
        <option value="minor6">Minor Sixth (8 semitones)</option>
        <option value="major6">Major Sixth (9 semitones)</option>
        <option value="minor7">Minor Seventh (10 semitones)</option>
        <option value="major7">Major Seventh (11 semitones)</option>
        <option value="octave">Octave (12 semitones)</option>
      </select>
    </div>

    <div class="field">
      <label for="et-reference" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Starting Note
      </label>
      <select id="et-reference" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="C" selected>C (Do)</option>
        <option value="D">D (Re)</option>
        <option value="E">E (Mi)</option>
        <option value="F">F (Fa)</option>
        <option value="G">G (Sol)</option>
        <option value="A">A (La)</option>
        <option value="B">B (Ti)</option>
      </select>
    </div>

    <div class="field">
      <label for="et-play-speed" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Play Speed
      </label>
      <select id="et-play-speed" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="slow">Slow (2 sec)</option>
        <option value="normal" selected>Normal (1 sec)</option>
        <option value="fast">Fast (0.5 sec)</option>
      </select>
    </div>
  </div>

  <!-- Visual Piano Preview -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <span style="color:var(--accent);font-weight:500;">üéπ Interval Preview</span>
      <span id="et-piano-notes" style="font-family:monospace;color:rgba(230,250,255,0.8);">C ‚Üí E (Maj 3rd)</span>
    </div>
    <div style="display:flex;height:40px;position:relative;">
      <!-- Simplified piano visualization -->
      <div style="flex:1;background:white;border-right:1px solid #000;position:relative;">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-weight:bold;">C</div>
      </div>
      <div style="flex:1;background:#333;width:60%;position:absolute;left:70%;height:60%;z-index:1;"></div>
      <div style="flex:1;background:white;border-right:1px solid #000;"></div>
      <div style="flex:1;background:white;border-right:1px solid #000;position:relative;">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-weight:bold;">E</div>
      </div>
      <div style="flex:1;background:white;border-right:1px solid #000;"></div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(100px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="etPlayInterval(this)" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ‚ñ∂Ô∏è Play Interval
    </button>
    <button type="button" onclick="etPlayMelodic(this)"
            style="padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      üé∂ Melodic Play
    </button>
    <button type="button" onclick="etPlayHarmonic(this)"
            style="padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      üéµ Harmonic Play
    </button>
    <button type="button" onclick="etReset(this)"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      üîÑ Reset
    </button>
  </div>
</form>

<!-- Results and Educational Content -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Interval Information Card -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:16px;border:1px solid rgba(45,212,255,0.1);margin-bottom:16px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1rem;">üéØ Current Interval Info</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:12px;margin-bottom:12px;">
      <div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Semitones</div>
        <div id="et-semitones" style="font-size:1.2rem;font-weight:600;color:var(--accent);">4</div>
      </div>
      <div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Quality</div>
        <div id="et-quality" style="font-size:1.2rem;font-weight:600;color:#39ff14;">Consonant</div>
      </div>
      <div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Emotional Color</div>
        <div id="et-emotion" style="font-size:1.2rem;font-weight:600;color:#ffcc00;">Bright/Happy</div>
      </div>
    </div>
    <div id="et-interval-description" style="color:rgba(230,250,255,0.9);font-size:0.95rem;line-height:1.5;">
      Major Third (4 semitones) - Sounds bright and happy. Common in major chords.
    </div>
  </div>

  <!-- Educational Tips -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1rem;">üìö Ear Training Tips</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:6px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">‚úÖ Practice Daily</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.8);">5-10 minutes daily is more effective than long sessions weekly</div>
      </div>
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:6px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">üéµ Use Songs</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.8);">Associate intervals with familiar song openings</div>
      </div>
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:6px;">
        <div style="color:#ff2d55;font-weight:600;margin-bottom:4px;">‚ö†Ô∏è Important</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.8);">Always verify with professional teacher or tuning app</div>
      </div>
    </div>
    
    <!-- Famous Song Examples -->
    <div style="margin-top:16px;padding:12px;background:rgba(45,212,255,0.05);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">üé∂ Real-World Examples</div>
      <div id="et-song-examples" style="font-size:0.9rem;color:rgba(230,250,255,0.9);line-height:1.5;">
        ‚Ä¢ Major 3rd: "When the Saints Go Marching In" (opening notes)
        ‚Ä¢ Perfect 5th: "Star Wars" theme (opening interval)
        ‚Ä¢ Minor 3rd: "Greensleeves" (melodic opening)
      </div>
    </div>
  </div>
</div>

<script>
/* ear-trainer.html - Enhanced version
   - Educational ear trainer with visual feedback
   - Scoped with et- prefix
*/

// Interval data with descriptions
const etIntervalData = {
  'major2': { semitones: 2, quality: 'Dissonant', emotion: 'Neutral/Tense', desc: 'Major Second - Whole step. Creates tension, often used for movement.' },
  'minor3': { semitones: 3, quality: 'Consonant', emotion: 'Sad/Melancholic', desc: 'Minor Third - Sounds sad or melancholic. Common in minor chords.' },
  'major3': { semitones: 4, quality: 'Consonant', emotion: 'Bright/Happy', desc: 'Major Third - Sounds bright and happy. Foundation of major chords.' },
  'perfect4': { semitones: 5, quality: 'Consonant', emotion: 'Strong/Stable', desc: 'Perfect Fourth - Sounds strong and stable. Used in many melodies.' },
  'tritone': { semitones: 6, quality: 'Dissonant', emotion: 'Unsettling/Tense', desc: 'Tritone - The "devil\'s interval". Creates tension and suspense.' },
  'perfect5': { semitones: 7, quality: 'Very Consonant', emotion: 'Powerful/Open', desc: 'Perfect Fifth - Very consonant and powerful. Foundation of harmony.' },
  'minor6': { semitones: 8, quality: 'Consonant', emotion: 'Dark/Mysterious', desc: 'Minor Sixth - Sounds dark or mysterious. Used in jazz and film scores.' },
  'major6': { semitones: 9, quality: 'Consonant', emotion: 'Sweet/Nostalgic', desc: 'Major Sixth - Sounds sweet or nostalgic. Common in love songs.' },
  'minor7': { semitones: 10, quality: 'Dissonant', emotion: 'Bluesy/Tense', desc: 'Minor Seventh - Bluesy sound. Creates tension needing resolution.' },
  'major7': { semitones: 11, quality: 'Dissonant', emotion: 'Dreamy/Unresolved', desc: 'Major Seventh - Sounds dreamy or unresolved. Used in jazz.' },
  'octave': { semitones: 12, quality: 'Perfect', emotion: 'Pure/Complete', desc: 'Octave - Same note, different pitch. Sounds pure and complete.' }
};

// Song examples for intervals
const etSongExamples = {
  'major2': '"Happy Birthday" (second and third notes), "Do-Re-Mi" from Sound of Music',
  'minor3': '"Greensleeves", "Georgia On My Mind", "Smoke on the Water" riff',
  'major3': '"When the Saints Go Marching In", "Kumbaya", "Oh When the Saints"',
  'perfect4': '"Here Comes the Bride", "Amazing Grace", "We Wish You a Merry Christmas"',
  'perfect5': '"Star Wars" theme, "Twinkle Twinkle Little Star", "My Favorite Things"',
  'octave': '"Somewhere Over the Rainbow", "The Christmas Song (Chestnuts)"'
};

let currentInterval = 'major3';
let currentNote = 'C';

function etSelectInterval(interval) {
  const card = document.currentScript?.closest('.card') || document;
  currentInterval = interval;
  
  // Update select
  const select = card.querySelector('#et-interval');
  select.value = interval;
  
  // Update preview
  etUpdatePreview();
  
  // Update interval buttons visual state
  card.querySelectorAll('[onclick*="etSelectInterval"]').forEach(btn => {
    btn.style.background = 'rgba(45,212,255,0.1)';
    btn.style.border = '1px solid rgba(45,212,255,0.3)';
  });
  
  const activeBtn = card.querySelector(`[onclick="etSelectInterval('${interval}')"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(45,212,255,0.2)';
    activeBtn.style.border = '2px solid var(--accent)';
  }
}

function etUpdatePreview() {
  const card = document.currentScript?.closest('.card') || document;
  const interval = card.querySelector('#et-interval').value;
  const note = card.querySelector('#et-reference').value;
  
  // Update piano notes display
  const nextNote = etGetNextNote(note, interval);
  card.querySelector('#et-piano-notes').textContent = `${note} ‚Üí ${nextNote} (${etGetIntervalName(interval)})`;
  
  // Update interval info
  const data = etIntervalData[interval];
  if (data) {
    card.querySelector('#et-semitones').textContent = data.semitones;
    card.querySelector('#et-quality').textContent = data.quality;
    card.querySelector('#et-emotion').textContent = data.emotion;
    card.querySelector('#et-interval-description').textContent = data.desc;
  }
  
  // Update song examples
  const examples = etSongExamples[interval] || 'Practice this interval with scales and arpeggios';
  card.querySelector('#et-song-examples').textContent = `‚Ä¢ ${examples}`;
}

function etGetNextNote(startNote, interval) {
  const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
  const data = etIntervalData[interval];
  if (!data) return startNote;
  
  const startIdx = notes.indexOf(startNote);
  const nextIdx = (startIdx + data.semitones) % 12;
  return notes[nextIdx];
}

function etGetIntervalName(interval) {
  const names = {
    'major2': 'Major 2nd',
    'minor3': 'Minor 3rd', 
    'major3': 'Major 3rd',
    'perfect4': 'Perfect 4th',
    'tritone': 'Tritone',
    'perfect5': 'Perfect 5th',
    'minor6': 'Minor 6th',
    'major6': 'Major 6th',
    'minor7': 'Minor 7th',
    'major7': 'Major 7th',
    'octave': 'Octave'
  };
  return names[interval] || interval;
}

function etPlayInterval(btn) {
  const card = btn.closest('.card') || document;
  const interval = card.querySelector('#et-interval').value;
  const note = card.querySelector('#et-reference').value;
  const speed = card.querySelector('#et-play-speed').value;
  
  // Visual feedback
  btn.innerHTML = '‚è≥ Playing...';
  btn.disabled = true;
  
  // Simulate playing with timeout
  setTimeout(() => {
    const data = etIntervalData[interval];
    const nextNote = etGetNextNote(note, interval);
    
    // Create educational message
    const message = `üéµ Played: ${note} ‚Üí ${nextNote} (${etGetIntervalName(interval)})\n` +
                   `üéØ ${data.semitones} semitones | Quality: ${data.quality}\n` +
                   `üé® Emotional color: ${data.emotion}\n\n` +
                   `üí° Tip: ${data.desc}\n` +
                   `‚ö†Ô∏è Always verify with tuner or teacher`;
    
    // Show visual feedback
    const pianoNotes = card.querySelector('#et-piano-notes');
    const originalText = pianoNotes.textContent;
    pianoNotes.style.color = '#39ff14';
    pianoNotes.textContent = `Playing: ${note} ‚Üí ${nextNote}...`;
    
    setTimeout(() => {
      pianoNotes.style.color = 'rgba(230,250,255,0.8)';
      pianoNotes.textContent = originalText;
      btn.innerHTML = '‚úÖ Interval Played';
      
      setTimeout(() => {
        btn.innerHTML = '‚ñ∂Ô∏è Play Interval';
        btn.disabled = false;
      }, 1000);
    }, 1500);
    
    // Audio simulation (in real app, this would play actual tones)
    console.log(`Playing interval: ${note} to ${nextNote} (${interval}) at ${speed} speed`);
    
  }, 300);
}

function etPlayMelodic(btn) {
  const card = btn.closest('.card') || document;
  const interval = card.querySelector('#et-interval').value;
  const note = card.querySelector('#et-reference').value;
  
  btn.innerHTML = 'üé∂ Playing...';
  setTimeout(() => {
    btn.innerHTML = 'üé∂ Melodic Play';
    
    const nextNote = etGetNextNote(note, interval);
    const pianoNotes = card.querySelector('#et-piano-notes');
    pianoNotes.textContent = `Melodic: ${note} ‚Üí ${nextNote} ‚Üí ${note}`;
    pianoNotes.style.color = '#ffcc00';
    
    setTimeout(() => {
      pianoNotes.style.color = 'rgba(230,250,255,0.8)';
      etUpdatePreview();
    }, 2000);
  }, 1000);
}

function etPlayHarmonic(btn) {
  const card = btn.closest('.card') || document;
  const interval = card.querySelector('#et-interval').value;
  const note = card.querySelector('#et-reference').value;
  
  btn.innerHTML = 'üéµ Playing...';
  setTimeout(() => {
    btn.innerHTML = 'üéµ Harmonic Play';
    
    const nextNote = etGetNextNote(note, interval);
    const pianoNotes = card.querySelector('#et-piano-notes');
    pianoNotes.textContent = `Harmonic: ${note} + ${nextNote} together`;
    pianoNotes.style.color = '#2dd4ff';
    
    setTimeout(() => {
      pianoNotes.style.color = 'rgba(230,250,255,0.8)';
      etUpdatePreview();
    }, 2000);
  }, 1000);
}

function etReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset selects
  card.querySelector('#et-interval').value = 'major3';
  card.querySelector('#et-reference').value = 'C';
  card.querySelector('#et-play-speed').value = 'normal';
  
  // Reset buttons
  card.querySelectorAll('[onclick*="etSelectInterval"]').forEach(btn => {
    btn.style.background = 'rgba(45,212,255,0.1)';
    btn.style.border = '1px solid rgba(45,212,255,0.3)';
  });
  
  // Set active button
  const major3Btn = card.querySelector('[onclick="etSelectInterval(\'major3\')"]');
  if (major3Btn) {
    major3Btn.style.background = 'rgba(45,212,255,0.2)';
    major3Btn.style.border = '2px solid var(--accent)';
  }
  
  // Update preview
  etUpdatePreview();
  
  // Visual feedback
  btn.innerHTML = '‚úÖ Reset Complete';
  setTimeout(() => {
    btn.innerHTML = 'üîÑ Reset';
  }, 1000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set up event listeners
    const intervalSelect = card.querySelector('#et-interval');
    const noteSelect = card.querySelector('#et-reference');
    const speedSelect = card.querySelector('#et-play-speed');
    
    intervalSelect.addEventListener('change', etUpdatePreview);
    noteSelect.addEventListener('change', etUpdatePreview);
    speedSelect.addEventListener('change', function() {
      // Just update display, no preview needed
    });
    
    // Initial update
    etUpdatePreview();
    
    console.log('Enhanced Ear Trainer ready');
  });
} else {
  // Run immediately if already loaded
  const card = document.currentScript?.closest('.card') || document;
  if (card) {
    setTimeout(() => {
      const intervalSelect = card.querySelector('#et-interval');
      const noteSelect = card.querySelector('#et-reference');
      
      if (intervalSelect && noteSelect) {
        intervalSelect.addEventListener('change', etUpdatePreview);
        noteSelect.addEventListener('change', etUpdatePreview);
        etUpdatePreview();
      }
    }, 100);
  }
}
</script>

<style>
/* Card-specific styles */
#ear-trainer-title {
  color: var(--accent);
  margin-top: 0;
  position: relative;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(45,212,255,0.2);
}

/* Interactive button states */
button[onclick*="etSelectInterval"]:hover,
button[onclick*="etPlay"]:hover,
button[onclick*="etReset"]:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Quality color coding */
#et-quality[data-quality="Consonant"],
#et-quality[data-quality="Very Consonant"],
#et-quality[data-quality="Perfect"] {
  color: #39ff14 !important;
}

#et-quality[data-quality="Dissonant"] {
  color: #ff2d55 !important;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  .actions {
    grid-template-columns: 1fr !important;
  }
  
  .row {
    grid-template-columns: 1fr !important;
  }
  
  #et-piano-notes {
    font-size: 0.9rem;
  }
}

/* Animation for playing state */
@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

.playing {
  animation: pulse 0.5s infinite;
}
</style>
