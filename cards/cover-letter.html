<h2 id="cover-letter-title" style="margin-top:0;">Cover Letter Builder</h2>

<form aria-describedby="cover-letter-desc">
  <p id="cover-letter-desc" class="small">Create a tailored cover letter quickly. Fill in the role, company, and your highlights — the generator produces a professional draft you can edit and copy.</p>

  <div class="row">
    <div class="field">
      <label for="cl-name">Your name</label>
      <input id="cl-name" type="text" placeholder="e.g. Alex Morgan" />
    </div>
    <div class="field">
      <label for="cl-email">Email / Contact</label>
      <input id="cl-email" type="text" placeholder="e.g. alex@example.com · +44 7123 456789" />
    </div>
    <div class="field">
      <label for="cl-date">Date</label>
      <input id="cl-date" type="date" />
    </div>
  </div>

  <div class="row" style="margin-top:8px;">
    <div class="field">
      <label for="cl-role">Role applying for</label>
      <input id="cl-role" type="text" placeholder="e.g. Product Designer" />
    </div>
    <div class="field">
      <label for="cl-company">Company</label>
      <input id="cl-company" type="text" placeholder="e.g. Acme Ltd" />
    </div>
    <div class="field">
      <label for="cl-location">Company location (optional)</label>
      <input id="cl-location" type="text" placeholder="e.g. London, UK" />
    </div>
  </div>

  <div class="row" style="margin-top:8px;">
    <div class="field" style="flex:1;">
      <label for="cl-opening">Opening line (optional)</label>
      <input id="cl-opening" type="text" placeholder="e.g. I’m excited to apply for..." />
    </div>
    <div class="field">
      <label for="cl-tone">Tone</label>
      <select id="cl-tone">
        <option>Professional</option>
        <option>Friendly</option>
        <option>Confident</option>
        <option>Concise</option>
      </select>
    </div>
  </div>

  <div style="margin-top:8px;">
    <label class="small">Key achievements (comma-separated)</label>
    <input id="cl-achievements" type="text" placeholder="e.g. Led redesign; increased retention 12%; managed 6-person team" />
  </div>

  <div style="margin-top:8px;">
    <label class="small">Relevant skills (comma-separated)</label>
    <input id="cl-skills" type="text" placeholder="e.g. UX, prototyping, stakeholder management" />
  </div>

  <div style="margin-top:8px;">
    <label class="small">Why you (one sentence)</label>
    <input id="cl-why" type="text" placeholder="e.g. I combine product design with user research to deliver measurable growth" />
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="clGenerate(this)">Generate Cover Letter</button>
    <button type="button" class="secondary" onclick="clReset(this)">Reset</button>
    <button type="button" onclick="clCopy(this)">Copy</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Draft Cover Letter</h3>
  <textarea id="cl-output" rows="12" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>
  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div class="small">Estimated words: <span id="cl-wordcount">0</span></div>
    <div id="cl-hint" class="small" style="opacity:0.9;"></div>
  </div>
</div>

<script>
/* Cover Letter Builder
   - Scripts scoped via btn.closest('.card') so multiple instances are safe
   - Lightweight generator that assembles a professional draft from user inputs
*/

function clReset(btn) {
  const card = btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#cl-output').value = "";
  card.querySelector('#cl-wordcount').textContent = "0";
  card.querySelector('#cl-hint').textContent = "";
}

function clCopy(btn) {
  const card = btn.closest('.card');
  const out = card.querySelector('#cl-output').value;
  if (!out.trim()) return;
  navigator.clipboard?.writeText(out).then(() => {
    const hint = card.querySelector('#cl-hint');
    hint.textContent = "Copied to clipboard.";
    setTimeout(() => { if (hint.textContent === "Copied to clipboard.") hint.textContent = ""; }, 1800);
  }).catch(() => {
    alert("Copy failed — select the text and copy manually.");
  });
}

function clGenerate(btn) {
  const card = btn.closest('.card');
  const name = (card.querySelector('#cl-name').value || "").trim();
  const contact = (card.querySelector('#cl-email').value || "").trim();
  const date = (card.querySelector('#cl-date').value || "");
  const role = (card.querySelector('#cl-role').value || "").trim();
  const company = (card.querySelector('#cl-company').value || "").trim();
  const location = (card.querySelector('#cl-location').value || "").trim();
  const opening = (card.querySelector('#cl-opening').value || "").trim();
  const tone = (card.querySelector('#cl-tone').value || "Professional");
  const achievementsRaw = (card.querySelector('#cl-achievements').value || "").trim();
  const skillsRaw = (card.querySelector('#cl-skills').value || "").trim();
  const why = (card.querySelector('#cl-why').value || "").trim();

  if (!name || !role || !company) {
    card.querySelector('#cl-hint').textContent = "Please enter your name, the role, and the company.";
    return;
  }

  const achievements = achievementsRaw ? achievementsRaw.split(',').map(s => s.trim()).filter(Boolean) : [];
  const skills = skillsRaw ? skillsRaw.split(',').map(s => s.trim()).filter(Boolean) : [];

  const header = buildHeader({ name, contact, date });
  const salutation = `Dear Hiring Manager${location ? " — " + location : ""},`;
  const openingLine = opening || `I am writing to express my interest in the ${role} position at ${company}.`;
  const intro = `${openingLine} With ${skills.length ? skills.slice(0,3).join(', ') + ' experience' : 'relevant experience'}, I believe I can contribute to ${company}'s goals.`;

  // build achievement bullets if present
  let achText = "";
  if (achievements.length) {
    achText = "Key achievements:\n" + achievements.slice(0,5).map(a => `- ${a}`).join("\n") + "\n";
  }

  // skills line
  const skillsLine = skills.length ? `Relevant skills: ${skills.join(', ')}.` : "";

  // why you
  const whyLine = why ? `${why}.` : "";

  // closing paragraph: concise call to action
  const closing = `I would welcome the opportunity to discuss how my background and skills can help ${company} achieve its objectives. Thank you for considering my application.`;

  const signOff = `Sincerely,\n${name}${contact ? "\n" + contact : ""}`;

  // tone adjustments (simple)
  const toneAdjust = tone === "Friendly" ? " I look forward to hearing from you." : tone === "Confident" ? " I am confident I can make an immediate impact." : "";

  const bodyParts = [
    salutation,
    "",
    intro,
    "",
    achText,
    skillsLine,
    whyLine ? ("\n" + whyLine) : "",
    "",
    closing + toneAdjust,
    "",
    signOff
  ].filter(Boolean).join("\n");

  const full = header + "\n" + bodyParts;

  card.querySelector('#cl-output').value = full;
  card.querySelector('#cl-wordcount').textContent = estimateWords(full);
  card.querySelector('#cl-hint').textContent = "Draft generated. Edit to add company-specific details and examples.";
}

/* small helpers */

function buildHeader({ name, contact, date }) {
  const parts = [];
  if (date) parts.push(formatDate(date));
  parts.push(name);
  if (contact) parts.push(contact);
  return parts.join("\n");
}

function formatDate(iso) {
  try {
    const d = new Date(iso);
    if (isNaN(d.getTime())) return iso;
    return d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
  } catch {
    return iso;
  }
}

function estimateWords(text) {
  return (text.trim().split(/\s+/).filter(Boolean).length).toString();
}
</script>
