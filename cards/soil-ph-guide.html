<!-- 
===========================================
FILE: cards/soil-ph-guide.html
RULE: Proper Eternal Ethos card structure
===========================================
-->

<!-- ===== 1. TITLE & DESCRIPTION (Standard Template Structure) ===== -->
<h2 id="tt-title">üå± Soil & pH Guide</h2>
<p id="tt-desc" class="small">
    Soil pH and type determine nutrient availability and plant success. 
    Match plants with their preferred conditions.
    <em>This tool is supported by 
        <a href="#contributionsPanel" onclick="showContributionsPanel()">
            user contributions
        </a>.
    </em>
</p>

<!-- ===== 2. MAIN CONTENT ===== -->
<div class="glass glass-lg" style="border-radius:var(--radius-lg);padding:var(--space-lg);margin-bottom:var(--space-lg);">
    
    <!-- Tab Navigation -->
    <div class="tab-navigation" style="margin-bottom:var(--space-lg);">
        <div class="tab-buttons glass glass-md" style="display:grid;grid-template-columns:repeat(5, 1fr);border-radius:var(--radius-md) var(--radius-md) 0 0;overflow:hidden;">
            <button class="tab-button active" onclick="ttShowTab('ph-guide')">
                üìä pH
            </button>
            <button class="tab-button" onclick="ttShowTab('soil-types')">
                üèúÔ∏è Soil
            </button>
            <button class="tab-button" onclick="ttShowTab('plant-finder')">
                üåø Plants
            </button>
            <button class="tab-button" onclick="ttShowTab('amendments')">
                ‚öóÔ∏è Amend
            </button>
            <button class="tab-button" onclick="ttShowTab('calculator')">
                üßÆ Calc
            </button>
        </div>
        
        <!-- Tab Content Container -->
        <div id="tt-tab-content" style="background:var(--bg-card);border-radius:0 0 var(--radius-md) var(--radius-md);padding:var(--space-lg);min-height:400px;">
            <!-- Content will be loaded here -->
        </div>
    </div>
</div>

<!-- ===== 3. SHARING & INFO ===== -->
<div style="margin-top:var(--space-xl);">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-sm);margin-bottom:var(--space-lg);">
        <button onclick="ttShareGuide()" class="btn btn-secondary">
            üì§ Share Guide
        </button>
        <button onclick="ttEmbedGuide()" class="btn btn-secondary">
            üîó Embed Tool
        </button>
    </div>
    
    <details class="glass glass-md" style="border-radius:var(--radius-md);overflow:hidden;">
        <summary style="cursor:pointer;padding:var(--space-md);color:var(--text-secondary);font-weight:var(--weight-semibold);list-style:none;display:flex;align-items:center;justify-content:space-between;">
            <span>üìö How to Use This Guide</span>
            <span style="font-size:0.9em;">‚ñº</span>
        </summary>
        <div style="padding:var(--space-md);border-top:1px solid var(--border-light);color:var(--text-secondary);">
            <p style="margin-bottom:var(--space-sm);">This guide helps you understand soil pH and match plants to soil conditions.</p>
            <p style="margin-bottom:var(--space-sm);"><strong>1.</strong> Check the pH scale to see plant preferences</p>
            <p style="margin-bottom:var(--space-sm);"><strong>2.</strong> Learn about different soil types</p>
            <p style="margin-bottom:var(--space-sm);"><strong>3.</strong> Use the calculator to adjust your soil</p>
        </div>
    </details>
</div>

<!-- ===== 4. JAVASCRIPT ===== -->
<script>
// Tab management
function ttShowTab(tabId) {
    const buttons = document.querySelectorAll('.tab-button');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Load tab content
    loadTabContent(tabId);
}

async function loadTabContent(tabId) {
    const container = document.getElementById('tt-tab-content');
    
    // Show loading state
    container.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;color:var(--text-secondary);">
            <div style="width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:var(--space-md);"></div>
            <div>Loading ${tabId.replace('-', ' ')}...</div>
        </div>
    `;
    
    // Load content based on tab
    setTimeout(() => {
        container.innerHTML = getTabContent(tabId);
        initializeTab(tabId);
    }, 100);
}

function getTabContent(tabId) {
    const content = {
        'ph-guide': `
            <div style="max-width:600px;margin:0 auto;">
                <h3 style="color:var(--text-secondary);margin-bottom:var(--space-md);">pH Scale Guide</h3>
                <div style="height:40px;background:linear-gradient(90deg, #2e7d32 0%, #4caf50 20%, #8bc34a 40%, #ffeb3b 60%, #ff9800 80%, #f44336 100%);border-radius:var(--radius-md);margin:var(--space-lg) 0;position:relative;">
                    <div style="position:absolute;top:-20px;left:0;width:100%;display:flex;justify-content:space-between;font-size:var(--text-xs);color:var(--text-tertiary);">
                        <span>Acidic (4.0)</span>
                        <span>Neutral (7.0)</span>
                        <span>Alkaline (8.5)</span>
                    </div>
                    <div id="ph-marker" style="position:absolute;top:-10px;width:3px;height:60px;background:white;box-shadow:var(--shadow-md);border-radius:2px;transform:translateX(-50%);left:50%;"></div>
                </div>
                
                <input type="range" id="ph-slider" min="4" max="8.5" step="0.1" value="6.5" 
                    style="width:100%;margin-bottom:var(--space-lg);"
                    oninput="updatePH(this.value)">
                
                <div style="text-align:center;margin-bottom:var(--space-lg);">
                    <div style="font-size:var(--text-xxl);font-weight:var(--weight-black);color:var(--accent);">6.5</div>
                    <div style="font-size:var(--text-sm);color:var(--text-secondary);">Slightly Acidic ‚Ä¢ Most vegetables</div>
                </div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:var(--space-sm);">
                    <div class="glass glass-sm" onclick="setPH(4.5)" style="padding:var(--space-sm);text-align:center;cursor:pointer;">
                        <div style="color:#2e7d32;font-weight:var(--weight-semibold);">Strong Acidic</div>
                        <div class="small" style="color:var(--text-secondary);">Blueberries, Azaleas</div>
                    </div>
                    <div class="glass glass-sm" onclick="setPH(5.5)" style="padding:var(--space-sm);text-align:center;cursor:pointer;">
                        <div style="color:#4caf50;font-weight:var(--weight-semibold);">Moderate Acidic</div>
                        <div class="small" style="color:var(--text-secondary);">Potatoes, Peppers</div>
                    </div>
                    <div class="glass glass-sm active" onclick="setPH(6.5)" style="padding:var(--space-sm);text-align:center;cursor:pointer;border:2px solid var(--accent);">
                        <div style="color:#8bc34a;font-weight:var(--weight-semibold);">Slight Acidic</div>
                        <div class="small" style="color:var(--text-secondary);">Most vegetables</div>
                    </div>
                    <div class="glass glass-sm" onclick="setPH(7.3)" style="padding:var(--space-sm);text-align:center;cursor:pointer;">
                        <div style="color:#ff9800;font-weight:var(--weight-semibold);">Neutral/Alkaline</div>
                        <div class="small" style="color:var(--text-secondary);">Brassicas, Beets</div>
                    </div>
                </div>
            </div>
        `,
        'soil-types': `
            <div>
                <h3 style="color:var(--text-secondary);margin-bottom:var(--space-md);">Soil Types</h3>
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:var(--space-md);">
                    <div class="glass glass-md" style="padding:var(--space-md);">
                        <div style="background:#ffd54f;color:#333;padding:var(--space-sm);border-radius:var(--radius-sm);margin-bottom:var(--space-sm);font-weight:var(--weight-semibold);">
                            Sandy Soil
                        </div>
                        <div class="small" style="color:var(--text-secondary);">
                            Quick-draining, warms fast. Best for carrots, lettuce, herbs.
                        </div>
                    </div>
                    <div class="glass glass-md" style="padding:var(--space-md);">
                        <div style="background:#795548;color:white;padding:var(--space-sm);border-radius:var(--radius-sm);margin-bottom:var(--space-sm);font-weight:var(--weight-semibold);">
                            Clay Soil
                        </div>
                        <div class="small" style="color:var(--text-secondary);">
                            Heavy, nutrient-rich. Best for roses, cabbages.
                        </div>
                    </div>
                    <div class="glass glass-md" style="padding:var(--space-md);">
                        <div style="background:#8d6e63;color:white;padding:var(--space-sm);border-radius:var(--radius-sm);margin-bottom:var(--space-sm);font-weight:var(--weight-semibold);">
                            Loam Soil
                        </div>
                        <div class="small" style="color:var(--text-secondary);">
                            Ideal balance. Best for tomatoes, beans, most veggies.
                        </div>
                    </div>
                </div>
            </div>
        `,
        // ... other tab content
    };
    
    return content[tabId] || '<div>Content not found</div>';
}

function initializeTab(tabId) {
    if (tabId === 'ph-guide') {
        updatePH(6.5);
    }
}

function updatePH(value) {
    const marker = document.getElementById('ph-marker');
    const percentage = ((value - 4) / (8.5 - 4)) * 100;
    marker.style.left = `${percentage}%`;
    
    const display = document.querySelector('#tt-tab-content [style*="font-size:var(--text-xxl)"]');
    if (display) {
        display.textContent = value;
    }
}

function setPH(value) {
    const slider = document.getElementById('ph-slider');
    slider.value = value;
    updatePH(value);
}

function ttShareGuide() {
    const shareText = `Check out the Soil & pH Guide - match plants to soil conditions and calculate amendments.`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Soil & pH Guide',
            text: shareText,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(shareText + ' ' + window.location.href);
        showNotification('Guide link copied to clipboard!', 'success');
    }
}

function ttEmbedGuide() {
    const embedCode = `<iframe src="${window.location.origin}/cards/soil-ph-guide.html" width="100%" height="600" style="border:none;border-radius:12px;" title="Soil & pH Guide"></iframe>`;
    navigator.clipboard.writeText(embedCode);
    showNotification('Embed code copied!', 'success');
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    // Load first tab
    loadTabContent('ph-guide');
});
</script>

<!-- ===== 5. CARD-SCOPED STYLES ===== -->
<style>
.tab-button {
    padding: var(--space-md);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-base);
    border-bottom: 3px solid transparent;
}

.tab-button:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
}

.tab-button.active {
    background: rgba(45, 212, 255, 0.1);
    color: var(--accent);
    border-bottom: 3px solid var(--accent);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.glass-sm {
    padding: var(--space-sm);
    border-radius: var(--radius-sm);
}

.glass-sm.active {
    border: 2px solid var(--accent);
    box-shadow: var(--shadow-glow);
}

/* Range slider styling */
input[type="range"] {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
    -webkit-appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 3px solid var(--bg-panel);
    box-shadow: var(--shadow-md);
}

/* Responsive */
@media (max-width: 768px) {
    .tab-buttons {
        grid-template-columns: repeat(3, 1fr) !important;
    }
}

@media (max-width: 480px) {
    .tab-buttons {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}
</style>
