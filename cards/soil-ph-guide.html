<div class="card" id="soil-ph-card">
  <h2 id="soil-ph-title" style="margin-top:0;">Soil & pH Guide</h2>

  <div id="soil-desc" class="small">
    <p>Soil pH and type determine nutrient availability and plant success. Use this interactive guide to match plants with their preferred conditions.</p>
  </div>

  <div class="tab-container" style="margin-top:16px;">
    <div class="tab-buttons" style="display:flex;flex-wrap:wrap;gap:4px;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:16px;">
      <button class="tab-button active" onclick="showTab('ph-guide')">pH Guide</button>
      <button class="tab-button" onclick="showTab('soil-types')">Soil Types</button>
      <button class="tab-button" onclick="showTab('plant-finder')">Plant Finder</button>
      <button class="tab-button" onclick="showTab('amendments')">Amendments</button>
      <button class="tab-button" onclick="showTab('calculator')">pH Calculator</button>
    </div>

    <!-- pH Guide Tab -->
    <div class="tab-content active" id="ph-guide">
      <div style="display:grid;grid-template-columns:1fr;gap:16px;">
        <div>
          <h3 class="small">pH Scale & Plant Preferences</h3>
          <div class="ph-scale" style="height:60px;background:linear-gradient(90deg, #2e7d32 0%, #4caf50 20%, #8bc34a 40%, #ffeb3b 60%, #ff9800 80%, #f44336 100%);border-radius:8px;margin:12px 0;position:relative;">
            <div style="position:absolute;top:-25px;left:0;width:100%;display:flex;justify-content:space-between;">
              <span style="font-size:0.8em;">Strongly Acidic (4.0)</span>
              <span style="font-size:0.8em;">Neutral (7.0)</span>
              <span style="font-size:0.8em;">Alkaline (8.5)</span>
            </div>
            <div id="ph-marker" style="position:absolute;top:-10px;width:3px;height:80px;background:white;box-shadow:0 0 4px rgba(0,0,0,0.5);border-radius:2px;transform:translateX(-50%);"></div>
          </div>
          <input type="range" id="ph-slider" min="4" max="8.5" step="0.1" value="6.5" style="width:100%;margin-bottom:16px;" />
          <div style="text-align:center;">
            <span style="font-size:1.2rem;font-weight:600;" id="ph-value">6.5</span>
            <span style="color:#aaa;"> pH - </span>
            <span id="ph-category">Slightly Acidic</span>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
          <div class="ph-category-card" data-ph-min="4.0" data-ph-max="5.0">
            <div style="padding:8px;background:#2e7d32;border-radius:6px 6px 0 0;color:white;">
              <strong>Strongly Acidic (4.0–5.0)</strong>
            </div>
            <div style="padding:12px;background:rgba(46, 125, 50, 0.1);border-radius:0 0 6px 6px;">
              <div class="small">Blueberries, Cranberries, Azaleas, Rhododendrons, Camellias</div>
            </div>
          </div>
          <div class="ph-category-card" data-ph-min="5.0" data-ph-max="6.0">
            <div style="padding:8px;background:#4caf50;border-radius:6px 6px 0 0;color:white;">
              <strong>Moderately Acidic (5.0–6.0)</strong>
            </div>
            <div style="padding:12px;background:rgba(76, 175, 80, 0.1);border-radius:0 0 6px 6px;">
              <div class="small">Potatoes, Sweet potatoes, Parsley, Peppers, Strawberries</div>
            </div>
          </div>
          <div class="ph-category-card active" data-ph-min="6.0" data-ph-max="7.0">
            <div style="padding:8px;background:#8bc34a;border-radius:6px 6px 0 0;color:white;">
              <strong>Slightly Acidic (6.0–7.0)</strong>
            </div>
            <div style="padding:12px;background:rgba(139, 195, 74, 0.1);border-radius:0 0 6px 6px;">
              <div class="small">Most vegetables, Roses, Lawns, Marigolds, Zinnias</div>
            </div>
          </div>
          <div class="ph-category-card" data-ph-min="7.0" data-ph-max="7.5">
            <div style="padding:8px;background:#ff9800;border-radius:6px 6px 0 0;color:white;">
              <strong>Neutral to Alkaline (7.0–7.5)</strong>
            </div>
            <div style="padding:12px;background:rgba(255, 152, 0, 0.1);border-radius:0 0 6px 6px;">
              <div class="small">Brassicas, Spinach, Beets, Lilacs, Clematis</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Soil Types Tab -->
    <div class="tab-content" id="soil-types">
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;">
        <div class="soil-type-card" data-soil="sandy">
          <div style="padding:12px;background:linear-gradient(135deg, #ffd54f, #ffb300);border-radius:8px 8px 0 0;color:#333;">
            <strong>Sandy Soil</strong>
          </div>
          <div style="padding:12px;background:rgba(255, 213, 79, 0.1);border-radius:0 0 8px 8px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>Characteristics:</strong> Quick-draining, warms fast, low nutrients</p>
            <p class="small" style="margin:0 0 8px 0;"><strong>Best for:</strong> Carrots, Lettuce, Parsnips, Mediterranean herbs</p>
            <p class="small" style="margin:0;"><strong>Improve with:</strong> Compost, peat moss, well-rotted manure</p>
          </div>
        </div>
        <div class="soil-type-card" data-soil="clay">
          <div style="padding:12px;background:linear-gradient(135deg, #795548, #5d4037);border-radius:8px 8px 0 0;color:white;">
            <strong>Clay Soil</strong>
          </div>
          <div style="padding:12px;background:rgba(121, 85, 72, 0.1);border-radius:0 0 8px 8px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>Characteristics:</strong> Heavy, retains water, rich in nutrients</p>
            <p class="small" style="margin:0 0 8px 0;"><strong>Best for:</strong> Roses, Cabbages, Daylilies, Willow trees</p>
            <p class="small" style="margin:0;"><strong>Improve with:</strong> Gypsum, sand, organic matter</p>
          </div>
        </div>
        <div class="soil-type-card" data-soil="loam">
          <div style="padding:12px;background:linear-gradient(135deg, #8d6e63, #6d4c41);border-radius:8px 8px 0 0;color:white;">
            <strong>Loam Soil</strong>
          </div>
          <div style="padding:12px;background:rgba(141, 110, 99, 0.1);border-radius:0 0 8px 8px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>Characteristics:</strong> Ideal balance, fertile, well-draining</p>
            <p class="small" style="margin:0 0 8px 0;"><strong>Best for:</strong> Tomatoes, Beans, Apples, Most vegetables</p>
            <p class="small" style="margin:0;"><strong>Maintain with:</strong> Regular compost, crop rotation</p>
          </div>
        </div>
        <div class="soil-type-card" data-soil="silt">
          <div style="padding:12px;background:linear-gradient(135deg, #a1887f, #8d6e63);border-radius:8px 8px 0 0;color:white;">
            <strong>Silt Soil</strong>
          </div>
          <div style="padding:12px;background:rgba(161, 136, 127, 0.1);border-radius:0 0 8px 8px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>Characteristics:</strong> Smooth texture, holds moisture well</p>
            <p class="small" style="margin:0 0 8px 0;"><strong>Best for:</strong> Leafy greens, Shrubs, Grasses, Most vegetables</p>
            <p class="small" style="margin:0;"><strong>Improve with:</strong> Organic matter, drainage if needed</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Plant Finder Tab -->
    <div class="tab-content" id="plant-finder">
      <div style="margin-bottom:16px;">
        <div class="field">
          <label for="plant-search">Search for a plant</label>
          <input id="plant-search" type="text" placeholder="e.g., tomatoes, roses, blueberries" style="width:100%;" />
        </div>
      </div>

      <div id="plant-results" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;max-height:400px;overflow-y:auto;padding:4px;">
        <!-- Plant cards will be inserted here -->
      </div>
    </div>

    <!-- Amendments Tab -->
    <div class="tab-content" id="amendments">
      <div style="display:grid;grid-template-columns:1fr;gap:16px;">
        <div>
          <h3 class="small">Adjust Soil pH</h3>
          <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:12px;margin-bottom:16px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>To Raise pH (Make less acidic):</strong></p>
            <ul class="small" style="margin:0;padding-left:20px;">
              <li><strong>Agricultural lime:</strong> 5-10 lbs per 100 sq ft</li>
              <li><strong>Dolomitic lime:</strong> Adds magnesium too</li>
              <li><strong>Wood ash:</strong> 10-20 lbs per 100 sq ft</li>
              <li><strong>Oyster shell flour:</strong> Slow release</li>
            </ul>
          </div>
          <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:12px;">
            <p class="small" style="margin:0 0 8px 0;"><strong>To Lower pH (Make more acidic):</strong></p>
            <ul class="small" style="margin:0;padding-left:20px;">
              <li><strong>Elemental sulfur:</strong> 1-2 lbs per 100 sq ft</li>
              <li><strong>Aluminum sulfate:</strong> Quick acting</li>
              <li><strong>Peat moss:</strong> Mix into soil</li>
              <li><strong>Pine needles:</strong> As mulch</li>
              <li><strong>Coffee grounds:</strong> Mild acidifier</li>
            </ul>
          </div>
        </div>

        <div>
          <h3 class="small">Improve Soil Structure</h3>
          <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:12px;">
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:8px;">
              <div>
                <strong class="small">For Sandy Soil:</strong>
                <ul class="small" style="margin:4px 0;padding-left:16px;">
                  <li>Compost</li>
                  <li>Manure</li>
                  <li>Peat moss</li>
                  <li>Clay soil</li>
                </ul>
              </div>
              <div>
                <strong class="small">For Clay Soil:</strong>
                <ul class="small" style="margin:4px 0;padding-left:16px;">
                  <li>Gypsum</li>
                  <li>Sand</li>
                  <li>Compost</li>
                  <li>Perlite</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- pH Calculator Tab -->
    <div class="tab-content" id="calculator">
      <div style="display:grid;grid-template-columns:1fr;gap:16px;">
        <div>
          <h3 class="small">pH Adjustment Calculator</h3>
          <p class="small">Estimate how much amendment you need to adjust your soil pH.</p>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
          <div class="field">
            <label for="current-ph">Current Soil pH</label>
            <input id="current-ph" type="number" min="4" max="9" step="0.1" value="6.0" style="width:100%;" />
          </div>
          <div class="field">
            <label for="target-ph">Target Soil pH</label>
            <input id="target-ph" type="number" min="4" max="9" step="0.1" value="6.5" style="width:100%;" />
          </div>
          <div class="field">
            <label for="soil-area">Area to Treat (sq ft)</label>
            <input id="soil-area" type="number" min="1" max="10000" step="1" value="100" style="width:100%;" />
          </div>
        </div>

        <div class="field">
          <label for="amendment-type">Amendment</label>
          <select id="amendment-type" style="width:100%;">
            <option value="lime">Agricultural Lime (raises pH)</option>
            <option value="sulfur">Elemental Sulfur (lowers pH)</option>
            <option value="gypsum">Gypsum (improves clay)</option>
            <option value="compost">Compost (improves all)</option>
          </select>
        </div>

        <div class="actions" style="margin-top:8px;">
          <button type="button" onclick="calculateAmendment()" class="primary">Calculate</button>
          <button type="button" onclick="resetCalculator()" class="secondary">Reset</button>
        </div>

        <div id="calculator-results" style="background:rgba(76, 175, 80, 0.1);border-radius:8px;padding:16px;display:none;">
          <h4 style="margin:0 0 8px 0;color:#4caf50;">Recommended Application</h4>
          <p style="margin:0;" id="amendment-result"></p>
          <p class="small" style="margin:8px 0 0 0;color:#666;" id="amendment-note"></p>
        </div>
      </div>
    </div>
  </div>

  <details class="small" style="margin-top:12px;border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:8px;">
    <summary style="cursor:pointer;font-weight:500;padding:4px;">Testing & Measurement Tips</summary>
    <div style="margin-top:8px;padding:4px;border-top:1px solid rgba(255,255,255,0.08);">
      <p style="margin:8px 0;"><strong>How to Test Soil pH:</strong></p>
      <ul style="margin:8px 0;padding-left:20px;">
        <li><strong>Test kits:</strong> Available at garden centers</li>
        <li><strong>pH meters:</strong> Digital or analog probes</li>
        <li><strong>Laboratory testing:</strong> Most accurate</li>
        <li><strong>DIY methods:</strong> Baking soda/vinegar test</li>
      </ul>
      <p style="margin:8px 0;"><strong>When to Test:</strong></p>
      <ul style="margin:8px 0;padding-left:20px;">
        <li>Before planting new beds</li>
        <li>When plants show nutrient deficiency</li>
        <li>Annually for established gardens</li>
        <li>After adding amendments</li>
      </ul>
    </div>
  </details>

  <style>
    .card {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #333;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }
    
    .card h2 {
      color: #4caf50;
      font-size: 1.5rem;
      margin-bottom: 8px;
    }
    
    .card .small {
      font-size: 0.875rem;
      color: #aaa;
      line-height: 1.5;
    }
    
    .tab-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 16px;
    }
    
    .tab-button {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: #aaa;
      cursor: pointer;
      font-weight: 500;
      border-radius: 6px 6px 0 0;
      transition: all 0.2s ease;
    }
    
    .tab-button:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .tab-button.active {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border-bottom: 2px solid #4caf50;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .field {
      margin-bottom: 16px;
    }
    
    .field label {
      display: block;
      margin-bottom: 6px;
      color: #ddd;
      font-weight: 500;
    }
    
    .field input,
    .field select {
      padding: 10px 12px;
      border: 1px solid #444;
      border-radius: 8px;
      background: #252525;
      color: #fff;
      font-size: 0.95rem;
    }
    
    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: #4caf50;
      box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    }
    
    .ph-category-card {
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .ph-category-card.active {
      border-color: #4caf50;
      box-shadow: 0 0 0 1px rgba(76, 175, 80, 0.3);
    }
    
    .soil-type-card {
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    
    .soil-type-card:hover {
      transform: translateY(-2px);
    }
    
    .plant-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 12px;
      border-left: 4px solid #4caf50;
    }
    
    .actions button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }
    
    .actions button.primary {
      background: #4caf50;
      color: white;
    }
    
    .actions button.primary:hover {
      background: #388e3c;
    }
    
    .actions button.secondary {
      background: #555;
      color: white;
    }
    
    .actions button.secondary:hover {
      background: #666;
    }
    
    details summary::-webkit-details-marker {
      display: none;
    }
    
    details summary:after {
      content: '▼';
      float: right;
      font-size: 0.75em;
      transition: transform 0.2s ease;
    }
    
    details[open] summary:after {
      transform: rotate(180deg);
    }
    
    input[type="range"] {
      height: 6px;
      padding: 0;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      width: 20px;
      height: 20px;
      background: #4caf50;
      border-radius: 50%;
      cursor: pointer;
      -webkit-appearance: none;
    }
  </style>
</div>

<script>
// Plant database
const PLANT_DATABASE = [
  {
    name: "Tomato",
    type: "Vegetable",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["loam", "sandy"],
    sunlight: "Full sun",
    spacing: "24-36 inches",
    notes: "Rich, well-draining soil. Avoid heavy clay."
  },
  {
    name: "Blueberry",
    type: "Fruit",
    phMin: 4.5,
    phMax: 5.5,
    soil: ["peaty", "sandy"],
    sunlight: "Full sun to partial shade",
    spacing: "4-6 feet",
    notes: "Acidic soil essential. Add sulfur for blueberry-specific soil."
  },
  {
    name: "Rose",
    type: "Flower",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["loam", "clay"],
    sunlight: "Full sun",
    spacing: "2-3 feet",
    notes: "Well-draining soil with good organic matter."
  },
  {
    name: "Potato",
    type: "Vegetable",
    phMin: 5.0,
    phMax: 6.0,
    soil: ["sandy", "loam"],
    sunlight: "Full sun",
    spacing: "12-15 inches",
    notes: "Loose soil for tuber development. Avoid fresh manure."
  },
  {
    name: "Lavender",
    type: "Herb",
    phMin: 6.5,
    phMax: 8.0,
    soil: ["sandy", "chalky"],
    sunlight: "Full sun",
    spacing: "18-24 inches",
    notes: "Well-draining soil essential. Avoid wet conditions."
  },
  {
    name: "Cabbage",
    type: "Vegetable",
    phMin: 6.5,
    phMax: 7.5,
    soil: ["clay", "loam"],
    sunlight: "Full sun",
    spacing: "12-24 inches",
    notes: "Rich soil with consistent moisture."
  },
  {
    name: "Carrot",
    type: "Vegetable",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["sandy", "loam"],
    sunlight: "Full sun",
    spacing: "2-3 inches",
    notes: "Light, stone-free soil. Deep soil for long varieties."
  },
  {
    name: "Strawberry",
    type: "Fruit",
    phMin: 5.5,
    phMax: 6.5,
    soil: ["sandy", "loam"],
    sunlight: "Full sun",
    spacing: "12-18 inches",
    notes: "Well-draining soil with organic matter."
  },
  {
    name: "Azalea",
    type: "Shrub",
    phMin: 4.5,
    phMax: 6.0,
    soil: ["peaty", "loam"],
    sunlight: "Partial shade",
    spacing: "3-6 feet",
    notes: "Acidic soil, consistent moisture, good drainage."
  },
  {
    name: "Broccoli",
    type: "Vegetable",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["loam", "clay"],
    sunlight: "Full sun",
    spacing: "18-24 inches",
    notes: "Rich soil, consistent watering, cool temperatures."
  },
  {
    name: "Basil",
    type: "Herb",
    phMin: 6.0,
    phMax: 7.5,
    soil: ["loam", "sandy"],
    sunlight: "Full sun",
    spacing: "12-18 inches",
    notes: "Warm soil, good drainage, regular harvesting."
  },
  {
    name: "Pepper",
    type: "Vegetable",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["loam", "sandy"],
    sunlight: "Full sun",
    spacing: "18-24 inches",
    notes: "Warm soil, consistent moisture, support for heavy fruits."
  },
  {
    name: "Lettuce",
    type: "Vegetable",
    phMin: 6.0,
    phMax: 7.0,
    soil: ["loam", "silt"],
    sunlight: "Partial shade to full sun",
    spacing: "6-12 inches",
    notes: "Cool weather crop, consistent moisture, fast-growing."
  }
];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Initialize pH slider
  updatePhSlider();
  
  // Load plant database
  loadPlantDatabase();
  
  // Initialize calculator
  resetCalculator();
  
  // Set up search
  const searchInput = document.getElementById('plant-search');
  searchInput.addEventListener('input', debounce(searchPlants, 300));
  
  // Set up pH slider
  const phSlider = document.getElementById('ph-slider');
  phSlider.addEventListener('input', updatePhSlider);
  
  // Click handlers for pH categories
  document.querySelectorAll('.ph-category-card').forEach(card => {
    card.addEventListener('click', function() {
      const min = parseFloat(this.dataset.phMin);
      const max = parseFloat(this.dataset.phMax);
      const avg = (min + max) / 2;
      
      document.getElementById('ph-slider').value = avg;
      updatePhSlider();
    });
  });
});

function showTab(tabId) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Remove active class from all buttons
  document.querySelectorAll('.tab-button').forEach(button => {
    button.classList.remove('active');
  });
  
  // Show selected tab
  document.getElementById(tabId).classList.add('active');
  
  // Activate corresponding button
  event.target.classList.add('active');
  
  // If showing plant finder, populate initial results
  if (tabId === 'plant-finder') {
    searchPlants();
  }
}

function updatePhSlider() {
  const slider = document.getElementById('ph-slider');
  const value = parseFloat(slider.value);
  const scale = document.querySelector('.ph-scale');
  const marker = document.getElementById('ph-marker');
  const phValue = document.getElementById('ph-value');
  const phCategory = document.getElementById('ph-category');
  
  // Calculate position (4.0 to 8.5 range)
  const min = 4.0;
  const max = 8.5;
  const percentage = ((value - min) / (max - min)) * 100;
  
  // Update marker position
  marker.style.left = `${percentage}%`;
  
  // Update displayed value
  phValue.textContent = value.toFixed(1);
  
  // Determine category
  let category = '';
  if (value < 5.0) {
    category = 'Strongly Acidic';
  } else if (value < 6.0) {
    category = 'Moderately Acidic';
  } else if (value < 7.0) {
    category = 'Slightly Acidic';
  } else if (value < 7.5) {
    category = 'Neutral to Slightly Alkaline';
  } else {
    category = 'Alkaline';
  }
  
  phCategory.textContent = category;
  
  // Update active pH category cards
  document.querySelectorAll('.ph-category-card').forEach(card => {
    const min = parseFloat(card.dataset.phMin);
    const max = parseFloat(card.dataset.phMax);
    
    card.classList.remove('active');
    if (value >= min && value <= max) {
      card.classList.add('active');
    }
  });
}

function loadPlantDatabase() {
  const resultsContainer = document.getElementById('plant-results');
  resultsContainer.innerHTML = '';
  
  PLANT_DATABASE.forEach(plant => {
    const card = document.createElement('div');
    card.className = 'plant-card';
    card.innerHTML = `
      <div style="margin-bottom:8px;">
        <strong style="color:#4caf50;">${plant.name}</strong>
        <span class="small" style="color:#aaa;margin-left:8px;">${plant.type}</span>
      </div>
      <div class="small">
        <div style="margin-bottom:4px;">
          <strong>pH:</strong> ${plant.phMin}-${plant.phMax}
        </div>
        <div style="margin-bottom:4px;">
          <strong>Soil:</strong> ${plant.soil.join(', ')}
        </div>
        <div style="margin-bottom:4px;">
          <strong>Sun:</strong> ${plant.sunlight}
        </div>
        <div style="margin-bottom:4px;">
          <strong>Spacing:</strong> ${plant.spacing}
        </div>
        <div>
          <strong>Notes:</strong> ${plant.notes}
        </div>
      </div>
    `;
    resultsContainer.appendChild(card);
  });
}

function searchPlants() {
  const searchTerm = document.getElementById('plant-search').value.toLowerCase();
  const resultsContainer = document.getElementById('plant-results');
  
  if (!searchTerm.trim()) {
    loadPlantDatabase();
    return;
  }
  
  const filteredPlants = PLANT_DATABASE.filter(plant => 
    plant.name.toLowerCase().includes(searchTerm) ||
    plant.type.toLowerCase().includes(searchTerm) ||
    plant.soil.some(s => s.toLowerCase().includes(searchTerm)) ||
    plant.notes.toLowerCase().includes(searchTerm)
  );
  
  resultsContainer.innerHTML = '';
  
  if (filteredPlants.length === 0) {
    resultsContainer.innerHTML = `
      <div style="grid-column:1/-1;text-align:center;padding:20px;color:#aaa;">
        No plants found matching "${searchTerm}"
      </div>
    `;
    return;
  }
  
  filteredPlants.forEach(plant => {
    const card = document.createElement('div');
    card.className = 'plant-card';
    card.innerHTML = `
      <div style="margin-bottom:8px;">
        <strong style="color:#4caf50;">${plant.name}</strong>
        <span class="small" style="color:#aaa;margin-left:8px;">${plant.type}</span>
      </div>
      <div class="small">
        <div style="margin-bottom:4px;">
          <strong>pH:</strong> ${plant.phMin}-${plant.phMax}
        </div>
        <div style="margin-bottom:4px;">
          <strong>Soil:</strong> ${plant.soil.join(', ')}
        </div>
        <div style="margin-bottom:4px;">
          <strong>Sun:</strong> ${plant.sunlight}
        </div>
        <div>
          <strong>Notes:</strong> ${plant.notes}
        </div>
      </div>
    `;
    resultsContainer.appendChild(card);
  });
}

function calculateAmendment() {
  const currentPh = parseFloat(document.getElementById('current-ph').value);
  const targetPh = parseFloat(document.getElementById('target-ph').value);
  const area = parseFloat(document.getElementById('soil-area').value);
  const amendment = document.getElementById('amendment-type').value;
  
  if (currentPh === targetPh) {
    showResult("No amendment needed - pH is already at target level.", "Maintain soil with regular organic matter additions.");
    return;
  }
  
  let result = '';
  let note = '';
  
  if (amendment === 'lime' && currentPh < targetPh) {
    // Lime raises pH
    const phChange = targetPh - currentPh;
    const limePer100 = phChange * 5; // Rough estimate: 5 lbs per 0.1 pH change per 100 sq ft
    const totalLime = (limePer100 * area) / 100;
    
    result = `Apply ${totalLime.toFixed(1)} lbs of agricultural lime to ${area} sq ft.`;
    note = "Apply in spring or fall and work into top 6 inches of soil. Water well after application.";
    
  } else if (amendment === 'sulfur' && currentPh > targetPh) {
    // Sulfur lowers pH
    const phChange = currentPh - targetPh;
    const sulfurPer100 = phChange * 1.5; // Rough estimate: 1.5 lbs per 0.1 pH change per 100 sq ft
    const totalSulfur = (sulfurPer100 * area) / 100;
    
    result = `Apply ${totalSulfur.toFixed(1)} lbs of elemental sulfur to ${area} sq ft.`;
    note = "Apply in fall for spring planting. Sulfur works slowly - test again in 3-4 months.";
    
  } else if (amendment === 'gypsum') {
    // Gypsum improves structure without changing pH
    const gypsumPer100 = 10; // 10 lbs per 100 sq ft
    const totalGypsum = (gypsumPer100 * area) / 100;
    
    result = `Apply ${totalGypsum.toFixed(1)} lbs of gypsum to ${area} sq ft.`;
    note = "Gypsum improves clay soil structure without changing pH. Works best when tilled in.";
    
  } else if (amendment === 'compost') {
    // Compost improves all soils
    const compostPer100 = 30; // 30 lbs (about 1 cubic foot) per 100 sq ft
    const totalCompost = (compostPer100 * area) / 100;
    
    result = `Apply ${totalCompost.toFixed(1)} lbs (about ${Math.round(totalCompost/30)} cubic feet) of compost to ${area} sq ft.`;
    note = "Work into top 6-8 inches of soil. Compost improves structure, fertility, and water retention.";
    
  } else {
    result = "Selected amendment may not be appropriate for desired pH change.";
    note = "Check that you're using the correct amendment for the direction of pH change needed.";
  }
  
  showResult(result, note);
}

function showResult(result, note) {
  const resultsDiv = document.getElementById('calculator-results');
  const resultText = document.getElementById('amendment-result');
  const noteText = document.getElementById('amendment-note');
  
  resultText.textContent = result;
  noteText.textContent = note;
  resultsDiv.style.display = 'block';
  
  // Scroll to results
  resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function resetCalculator() {
  document.getElementById('current-ph').value = "6.0";
  document.getElementById('target-ph').value = "6.5";
  document.getElementById('soil-area').value = "100";
  document.getElementById('amendment-type').value = "lime";
  document.getElementById('calculator-results').style.display = 'none';
}

// Utility function for debouncing search
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}
</script>
