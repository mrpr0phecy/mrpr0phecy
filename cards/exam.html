<h2 id="exam-title" style="margin-top:0;color:var(--accent);border-bottom:2px solid var(--accent);padding-bottom:10px;">
  üéØ Exam & Study Planner
</h2>

<div class="tool-description" style="
  background:linear-gradient(135deg, rgba(45,212,255,0.08), rgba(45,212,255,0.04));
  border-left:4px solid var(--accent);
  padding:16px;
  border-radius:0 12px 12px 0;
  margin-bottom:20px;
">
  <p style="margin:0;display:flex;align-items:flex-start;gap:12px;">
    <span style="font-size:1.8em;flex-shrink:0;">üìö</span>
    <span style="line-height:1.6;">
      A comprehensive exam planning and study management system for students and professionals.
      <strong style="color:var(--accent);">Track exams, create study schedules, set goals, and manage revision.</strong>
    </span>
  </p>
</div>

<!-- QUICK OVERVIEW -->
<div class="overview-section" style="
  background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:24px;
  margin-bottom:24px;
">
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:20px;">
    <div style="text-align:center;">
      <div style="font-size:2.5em;color:var(--accent);font-weight:700;" id="total-exams">0</div>
      <div style="color:rgba(230,250,255,0.7);font-size:0.9em;margin-top:4px;">Total Exams</div>
    </div>
    <div style="text-align:center;">
      <div style="font-size:2.5em;color:#39ff14;font-weight:700;" id="days-until-next">‚Äì</div>
      <div style="color:rgba(230,250,255,0.7);font-size:0.9em;margin-top:4px;">Days Until Next</div>
    </div>
    <div style="text-align:center;">
      <div style="font-size:2.5em;color:#ffcc00;font-weight:700;" id="study-hours">0</div>
      <div style="color:rgba(230,250,255,0.7);font-size:0.9em;margin-top:4px;">Study Hours Planned</div>
    </div>
    <div style="text-align:center;">
      <div style="font-size:2.5em;color:#ff2d55;font-weight:700;" id="urgent-count">0</div>
      <div style="color:rgba(230,250,255,0.7);font-size:0.9em;margin-top:4px;">Urgent (‚â§7 days)</div>
    </div>
  </div>
</div>

<!-- EXAM ADDITION FORM -->
<div class="input-section" style="
  background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:24px;
  margin-bottom:24px;
">
  <h3 style="margin-top:0;color:var(--accent);margin-bottom:20px;">üìù Add New Exam</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin-bottom:20px;">
    <div>
      <label for="exam-subject" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-weight:500;">
        <span style="color:var(--accent);">üìö</span> Subject/Course
      </label>
      <input id="exam-subject" type="text" placeholder="e.g., Advanced Calculus, Network Security"
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
    </div>
    
    <div>
      <label for="exam-date" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-weight:500;">
        <span style="color:var(--accent);">üìÖ</span> Date & Time
      </label>
      <input id="exam-date" type="datetime-local"
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
    </div>
    
    <div>
      <label for="exam-duration" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-weight:500;">
        <span style="color:var(--accent);">‚è±Ô∏è</span> Duration (minutes)
      </label>
      <input id="exam-duration" type="number" min="0" step="5" placeholder="e.g., 180"
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
    </div>
  </div>
  
  <div style="margin-bottom:20px;">
    <label for="exam-notes" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-weight:500;">
      <span style="color:var(--accent);">üìã</span> Important Notes
    </label>
    <textarea id="exam-notes" rows="3"
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;"
              placeholder="Materials to bring, special instructions, room number, etc."></textarea>
  </div>
  
  <div style="margin-bottom:20px;">
    <label for="exam-priority" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.9);font-weight:500;">
      <span style="color:var(--accent);">üéØ</span> Priority Level
    </label>
    <div style="display:flex;gap:12px;">
      <button class="priority-btn active" data-priority="high" onclick="selectPriority('high', this)" style="
        flex:1;padding:12px;background:rgba(255,45,85,0.2);border:2px solid #ff2d55;border-radius:8px;color:#ff2d55;cursor:pointer;font-weight:600;
      ">
        üî¥ High Priority
      </button>
      <button class="priority-btn" data-priority="medium" onclick="selectPriority('medium', this)" style="
        flex:1;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;font-weight:600;
      ">
        üü° Medium
      </button>
      <button class="priority-btn" data-priority="low" onclick="selectPriority('low', this)" style="
        flex:1;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;font-weight:600;
      ">
        üü¢ Low
      </button>
    </div>
  </div>
  
  <!-- STUDY PLAN OPTIONS -->
  <div style="
    background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.2);border-radius:10px;
    padding:16px;margin-bottom:20px;
  ">
    <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.2em;">üìä</span> Study Plan Generator
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;">
      <div>
        <label for="study-hours-per-day" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9em;">
          Daily Study Hours
        </label>
        <select id="study-hours-per-day" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="1">1 hour/day</option>
          <option value="2" selected>2 hours/day</option>
          <option value="3">3 hours/day</option>
          <option value="4">4 hours/day</option>
          <option value="5">5 hours/day</option>
        </select>
      </div>
      
      <div>
        <label for="study-days-per-week" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9em;">
          Study Days/Week
        </label>
        <select id="study-days-per-week" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="5">5 days/week</option>
          <option value="6" selected>6 days/week</option>
          <option value="7">7 days/week</option>
        </select>
      </div>
      
      <div>
        <label for="study-weeks-before" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9em;">
          Start Studying
        </label>
        <select id="study-weeks-before" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="1">1 week before</option>
          <option value="2">2 weeks before</option>
          <option value="3" selected>3 weeks before</option>
          <option value="4">4 weeks before</option>
          <option value="6">6 weeks before</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- ACTION BUTTONS -->
  <div style="display:flex;gap:12px;">
    <button onclick="addExam()" style="
      flex:1;padding:16px;background:linear-gradient(90deg, var(--accent), #0077cc);border:none;border-radius:10px;
      color:white;font-weight:700;font-size:1.1em;cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(45,212,255,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
      üéØ Add Exam & Generate Study Plan
    </button>
    
    <button onclick="resetForm()" style="
      padding:16px 24px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:10px;
      color:inherit;font-weight:600;cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(255,255,255,0.1)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
      üîÑ Clear Form
    </button>
  </div>
</div>

<!-- EXAM LIST & STUDY SCHEDULE -->
<div id="exams-section" style="
  background:linear-gradient(135deg, rgba(57,255,20,0.05), rgba(45,212,255,0.05));
  border:2px solid rgba(57,255,20,0.2);
  border-radius:16px;
  padding:24px;
  display:none;
  margin-bottom:24px;
">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h3 style="margin:0;color:#39ff14;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.3em;">üìÖ</span> Exam Schedule & Study Plan
    </h3>
    <div style="font-size:0.9em;color:rgba(230,250,255,0.7);background:rgba(0,0,0,0.3);padding:6px 12px;border-radius:20px;">
      <span id="total-exams-display">0 Exams</span>
    </div>
  </div>

  <!-- NEXT EXAM BANNER -->
  <div id="next-exam-banner" style="
    background:linear-gradient(90deg, rgba(255,45,85,0.15), rgba(255,45,85,0.05));
    border:2px solid rgba(255,45,85,0.3);
    border-radius:12px;
    padding:20px;
    margin-bottom:24px;
    display:none;
  ">
    <div style="display:flex;align-items:center;gap:16px;">
      <div style="font-size:2.5em;">‚è∞</div>
      <div style="flex:1;">
        <div style="color:#ff2d55;font-weight:700;font-size:1.1em;margin-bottom:4px;" id="next-exam-title">Next Exam</div>
        <div style="color:rgba(230,250,255,0.9);" id="next-exam-details"></div>
        <div style="font-size:0.9em;color:rgba(255,45,85,0.8);margin-top:8px;" id="next-exam-countdown"></div>
      </div>
    </div>
  </div>

  <!-- EXAM LIST -->
  <div style="margin-bottom:32px;">
    <div style="color:var(--accent);font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.2em;">üìã</span> Upcoming Exams
    </div>
    
    <div id="exam-list" style="
      background:rgba(0,0,0,0.2);border-radius:12px;overflow:hidden;
    ">
      <!-- Exams will be added here -->
    </div>
  </div>

  <!-- STUDY SCHEDULE -->
  <div style="margin-bottom:32px;">
    <div style="color:var(--accent);font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.2em;">üìä</span> Recommended Study Schedule
    </div>
    
    <div id="study-schedule" style="
      background:rgba(0,0,0,0.2);border-radius:12px;padding:20px;
    ">
      <p style="margin:0;color:rgba(230,250,255,0.8);text-align:center;">
        Add an exam to generate a personalized study schedule
      </p>
    </div>
  </div>

  <!-- STUDY TIPS -->
  <div style="
    background:linear-gradient(135deg, rgba(255,204,0,0.08), rgba(255,204,0,0.04));
    border:1px solid rgba(255,204,0,0.2);
    border-radius:12px;
    padding:20px;
    margin-bottom:24px;
  ">
    <div style="color:#ffcc00;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:1.2em;">üí°</span> Effective Study Tips
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;">
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:6px;font-size:0.95em;">‚è∞ Pomodoro Technique</div>
        <div style="font-size:0.9em;color:rgba(230,250,255,0.8);line-height:1.5;">
          Study for 25 minutes, break for 5. After 4 cycles, take a 15-30 minute break.
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:6px;font-size:0.95em;">üß† Active Recall</div>
        <div style="font-size:0.9em;color:rgba(230,250,255,0.8);line-height:1.5;">
          Test yourself instead of re-reading. Use flashcards and practice questions.
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:6px;font-size:0.95em;">üìö Spaced Repetition</div>
        <div style="font-size:0.9em;color:rgba(230,250,255,0.8);line-height:1.5;">
          Review material at increasing intervals to strengthen long-term memory.
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:6px;font-size:0.95em;">üîÑ Interleaving</div>
        <div style="font-size:0.9em;color:rgba(230,250,255,0.8);line-height:1.5;">
          Mix different subjects or topics in a single study session.
        </div>
      </div>
    </div>
  </div>

  <!-- ACTION BUTTONS -->
  <div style="display:flex;gap:12px;flex-wrap:wrap;">
    <button onclick="exportStudyPlan()" style="
      flex:1;min-width:150px;padding:14px;background:rgba(57,255,20,0.15);border:1px solid #39ff14;border-radius:10px;color:#39ff14;font-weight:600;cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
      üìÑ Export Plan
    </button>
    
    <button onclick="clearAllExams()" style="
      flex:1;min-width:150px;padding:14px;background:rgba(255,45,85,0.15);border:1px solid #ff2d55;border-radius:10px;color:#ff2d55;font-weight:600;cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
      üóëÔ∏è Clear All
    </button>
    
    <button onclick="printStudyPlan()" style="
      flex:1;min-width:150px;padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:10px;color:inherit;font-weight:600;cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
      üñ®Ô∏è Print
    </button>
  </div>
</div>

<!-- PROGRESS TRACKER -->
<div style="
  background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:24px;
  margin-top:24px;
">
  <div style="color:var(--accent);font-weight:600;margin-bottom:20px;display:flex;align-items:center;gap:8px;">
    <span style="font-size:1.3em;">üìà</span> Study Progress Tracker
  </div>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:24px;">
    <div>
      <div style="color:#ffcc00;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üéØ</span> Daily Study Goals
      </div>
      <div style="
        background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;
      ">
        <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
          <div style="color:rgba(230,250,255,0.8);">Today's Goal:</div>
          <div style="color:#39ff14;font-weight:600;" id="daily-goal">0 hours</div>
        </div>
        <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:12px;">
          <div id="daily-progress" style="height:100%;background:linear-gradient(90deg, #39ff14, #2dd4ff);width:0%;"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.9em;color:rgba(230,250,255,0.6);">
          <div>Progress</div>
          <div><span id="progress-percent">0%</span></div>
        </div>
      </div>
    </div>
    
    <div>
      <div style="color:#2dd4ff;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üìä</span> Study Statistics
      </div>
      <div style="
        background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;
      ">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div style="color:rgba(230,250,255,0.8);">Total Study Hours:</div>
          <div style="color:#2dd4ff;font-weight:600;" id="total-study-hours">0</div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div style="color:rgba(230,250,255,0.8);">Sessions Completed:</div>
          <div style="color:#ffcc00;font-weight:600;" id="sessions-completed">0</div>
        </div>
        <div style="display:flex;justify-content:space-between;">
          <div style="color:rgba(230,250,255,0.8);">Consistency:</div>
          <div style="color:#39ff14;font-weight:600;" id="consistency">0%</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Professional Exam & Study Planner

let examItems = [];
let currentPriority = 'high';

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  loadFromStorage();
  updateOverview();
  startCountdownTimer();
});

function selectPriority(priority, button) {
  currentPriority = priority;
  
  // Update button styles
  document.querySelectorAll('.priority-btn').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  button.classList.add('active');
  
  switch(priority) {
    case 'high':
      button.style.background = 'rgba(255,45,85,0.2)';
      button.style.border = '2px solid #ff2d55';
      button.style.color = '#ff2d55';
      break;
    case 'medium':
      button.style.background = 'rgba(255,204,0,0.2)';
      button.style.border = '2px solid #ffcc00';
      button.style.color = '#ffcc00';
      break;
    case 'low':
      button.style.background = 'rgba(57,255,20,0.2)';
      button.style.border = '2px solid #39ff14';
      button.style.color = '#39ff14';
      break;
  }
}

function addExam() {
  const subject = document.getElementById('exam-subject').value.trim();
  const whenStr = document.getElementById('exam-date').value;
  const durationMin = parseInt(document.getElementById('exam-duration').value, 10) || 0;
  const notes = document.getElementById('exam-notes').value.trim();
  const studyHoursPerDay = parseInt(document.getElementById('study-hours-per-day').value, 10);
  const studyDaysPerWeek = parseInt(document.getElementById('study-days-per-week').value, 10);
  const studyWeeksBefore = parseInt(document.getElementById('study-weeks-before').value, 10);
  
  if (!subject || !whenStr) {
    alert('Please enter subject and date/time');
    return;
  }
  
  const when = new Date(whenStr);
  if (isNaN(when.getTime())) {
    alert('Invalid date/time');
    return;
  }
  
  const exam = {
    id: Date.now() + Math.random().toString(36).substr(2, 9),
    subject,
    when: when.toISOString(),
    durationMin: isNaN(durationMin) ? 0 : durationMin,
    notes,
    priority: currentPriority,
    studyHoursPerDay,
    studyDaysPerWeek,
    studyWeeksBefore,
    added: new Date().toISOString(),
    studySessions: [],
    progress: 0
  };
  
  examItems.push(exam);
  examItems.sort((a, b) => new Date(a.when) - new Date(b.when));
  
  saveToStorage();
  updateOverview();
  renderExams();
  generateStudySchedule(exam);
  resetForm();
  
  // Show exams section
  document.getElementById('exams-section').style.display = 'block';
}

function resetForm() {
  document.getElementById('exam-subject').value = '';
  document.getElementById('exam-date').value = '';
  document.getElementById('exam-duration').value = '';
  document.getElementById('exam-notes').value = '';
  selectPriority('high', document.querySelector('[data-priority="high"]'));
}

function renderExams() {
  const list = document.getElementById('exam-list');
  list.innerHTML = '';
  
  const now = new Date();
  let nextExam = null;
  let urgentCount = 0;
  let totalStudyHours = 0;
  
  examItems.forEach((exam, idx) => {
    const when = new Date(exam.when);
    const timeUntil = when - now;
    const daysUntil = Math.ceil(timeUntil / (1000 * 60 * 60 * 24));
    
    if (daysUntil <= 7 && daysUntil > 0) urgentCount++;
    
    // Calculate study hours for this exam
    const studyStart = new Date(when);
    studyStart.setDate(studyStart.getDate() - (exam.studyWeeksBefore * 7));
    const studyDays = Math.max(1, Math.ceil((when - studyStart) / (1000 * 60 * 60 * 24)));
    const studyHours = Math.ceil((studyDays / 7) * exam.studyDaysPerWeek * exam.studyHoursPerDay);
    totalStudyHours += studyHours;
    
    // Create exam card
    const card = document.createElement('div');
    card.className = 'exam-card';
    card.style.cssText = `
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      gap: 16px;
      transition: background 0.2s;
    `;
    
    if (daysUntil <= 3 && daysUntil > 0) {
      card.style.background = 'rgba(255,45,85,0.1)';
      card.style.borderLeft = '4px solid #ff2d55';
    } else if (daysUntil <= 7) {
      card.style.background = 'rgba(255,204,0,0.1)';
      card.style.borderLeft = '4px solid #ffcc00';
    } else {
      card.style.background = 'rgba(57,255,20,0.05)';
      card.style.borderLeft = '4px solid #39ff14';
    }
    
    // Priority indicator
    const priorityDot = document.createElement('div');
    priorityDot.style.cssText = `
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    `;
    
    switch(exam.priority) {
      case 'high':
        priorityDot.style.background = '#ff2d55';
        break;
      case 'medium':
        priorityDot.style.background = '#ffcc00';
        break;
      case 'low':
        priorityDot.style.background = '#39ff14';
        break;
    }
    
    // Exam info
    const info = document.createElement('div');
    info.style.flex = '1';
    
    const subject = document.createElement('div');
    subject.style.cssText = `
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
      font-size: 1.1em;
    `;
    subject.textContent = exam.subject;
    
    const details = document.createElement('div');
    details.style.cssText = `
      color: rgba(230,250,255,0.8);
      font-size: 0.9em;
      margin-bottom: 6px;
    `;
    
    const detailsText = [
      when.toLocaleString(),
      exam.durationMin ? `${exam.durationMin} minutes` : '',
      `Priority: ${exam.priority.toUpperCase()}`
    ].filter(Boolean).join(' ‚Ä¢ ');
    details.textContent = detailsText;
    
    const countdown = document.createElement('div');
    countdown.style.cssText = `
      color: rgba(230,250,255,0.6);
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 8px;
    `;
    
    const countdownText = formatRemaining(now, when);
    countdown.innerHTML = `
      <span style="color: ${getCountdownColor(daysUntil)}">${countdownText}</span>
      <span style="color: rgba(255,255,255,0.4)">‚Ä¢</span>
      <span>Study: ${studyHours} hours over ${exam.studyWeeksBefore} weeks</span>
    `;
    
    info.appendChild(subject);
    info.appendChild(details);
    info.appendChild(countdown);
    
    if (exam.notes) {
      const notesDiv = document.createElement('div');
      notesDiv.style.cssText = `
        color: rgba(255,204,0,0.8);
        font-size: 0.85em;
        margin-top: 6px;
        padding: 8px;
        background: rgba(255,255,255,0.05);
        border-radius: 6px;
      `;
      notesDiv.textContent = `üìù ${exam.notes}`;
      info.appendChild(notesDiv);
    }
    
    // Action buttons
    const actions = document.createElement('div');
    actions.style.cssText = `
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    `;
    
    const completeBtn = document.createElement('button');
    completeBtn.innerHTML = '‚úÖ';
    completeBtn.title = 'Mark as completed';
    completeBtn.style.cssText = `
      background: rgba(57,255,20,0.1);
      border: 1px solid #39ff14;
      color: #39ff14;
      width: 36px;
      height: 36px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    `;
    completeBtn.onclick = () => markAsCompleted(exam.id);
    
    const deleteBtn = document.createElement('button');
    deleteBtn.innerHTML = 'üóëÔ∏è';
    deleteBtn.title = 'Delete exam';
    deleteBtn.style.cssText = `
      background: rgba(255,45,85,0.1);
      border: 1px solid #ff2d55;
      color: #ff2d55;
      width: 36px;
      height: 36px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    `;
    deleteBtn.onclick = () => deleteExam(exam.id);
    
    actions.appendChild(completeBtn);
    actions.appendChild(deleteBtn);
    
    card.appendChild(priorityDot);
    card.appendChild(info);
    card.appendChild(actions);
    list.appendChild(card);
    
    // Set next exam
    if (!nextExam && timeUntil > 0) {
      nextExam = exam;
    }
  });
  
  // Update next exam banner
  updateNextExamBanner(nextExam);
  
  // Update study hours in overview
  document.getElementById('study-hours').textContent = totalStudyHours;
  document.getElementById('urgent-count').textContent = urgentCount;
  
  // Update total exams display
  document.getElementById('total-exams-display').textContent = `${examItems.length} Exam${examItems.length !== 1 ? 's' : ''}`;
}

function updateNextExamBanner(exam) {
  const banner = document.getElementById('next-exam-banner');
  
  if (!exam) {
    banner.style.display = 'none';
    return;
  }
  
  banner.style.display = 'block';
  document.getElementById('next-exam-title').textContent = `Next: ${exam.subject}`;
  
  const when = new Date(exam.when);
  const details = [
    when.toLocaleString(),
    exam.durationMin ? `${exam.durationMin} minutes` : '',
    `Priority: ${exam.priority.toUpperCase()}`
  ].filter(Boolean).join(' ‚Ä¢ ');
  
  document.getElementById('next-exam-details').textContent = details;
  
  // Update countdown
  updateCountdown(exam);
}

function updateCountdown(exam) {
  const now = new Date();
  const when = new Date(exam.when);
  const diffMs = when - now;
  
  if (diffMs <= 0) {
    document.getElementById('next-exam-countdown').textContent = 'Exam in progress or completed';
    document.getElementById('next-exam-countdown').style.color = '#ff2d55';
    return;
  }
  
  const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
  
  let countdownText = '';
  if (days > 0) {
    countdownText = `${days}d ${hours}h ${minutes}m remaining`;
  } else if (hours > 0) {
    countdownText = `${hours}h ${minutes}m remaining`;
  } else {
    countdownText = `${minutes}m remaining`;
  }
  
  document.getElementById('next-exam-countdown').textContent = countdownText;
  document.getElementById('next-exam-countdown').style.color = getCountdownColor(days);
}

function getCountdownColor(days) {
  if (days <= 1) return '#ff2d55';
  if (days <= 3) return '#ffcc00';
  if (days <= 7) return '#ffcc00';
  return '#39ff14';
}

function formatRemaining(now, when) {
  const diffMs = when - now;
  const absMs = Math.abs(diffMs);
  const days = Math.floor(absMs / (1000 * 60 * 60 * 24));
  const hours = Math.floor((absMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((absMs % (1000 * 60 * 60)) / (1000 * 60));
  
  const core = `${days}d ${hours}h ${minutes}m`;
  return diffMs <= 0 ? `${core} ago` : `${core} remaining`;
}

function generateStudySchedule(exam) {
  const schedule = document.getElementById('study-schedule');
  const when = new Date(exam.when);
  const now = new Date();
  const daysUntil = Math.ceil((when - now) / (1000 * 60 * 60 * 24));
  
  if (daysUntil <= 0) {
    schedule.innerHTML = `
      <div style="text-align:center;color:rgba(230,250,255,0.8);">
        <div style="font-size:1.5em;margin-bottom:12px;">üéâ</div>
        <div>This exam has already occurred.</div>
      </div>
    `;
    return;
  }
  
  const startDate = new Date(when);
  startDate.setDate(startDate.getDate() - (exam.studyWeeksBefore * 7));
  
  const totalStudyDays = Math.min(daysUntil, exam.studyWeeksBefore * 7);
  const studyDaysPerWeek = exam.studyDaysPerWeek;
  const hoursPerDay = exam.studyHoursPerDay;
  const totalStudyHours = Math.ceil((totalStudyDays / 7) * studyDaysPerWeek * hoursPerDay);
  
  let scheduleHTML = `
    <div style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div style="color:var(--accent);font-weight:600;font-size:1.1em;">${exam.subject} Study Plan</div>
        <div style="color:#39ff14;font-weight:600;">${totalStudyHours} total hours</div>
      </div>
      
      <div style="
        background:rgba(0,0,0,0.3);border-radius:10px;padding:16px;margin-bottom:16px;
      ">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
          <div>
            <div style="color:rgba(230,250,255,0.7);font-size:0.9em;">Start Studying</div>
            <div style="color:#ffcc00;font-weight:600;">${startDate.toLocaleDateString()}</div>
          </div>
          <div>
            <div style="color:rgba(230,250,255,0.7);font-size:0.9em;">Weekly Commitment</div>
            <div style="color:#39ff14;font-weight:600;">${studyDaysPerWeek} days √ó ${hoursPerDay}h = ${studyDaysPerWeek * hoursPerDay}h/week</div>
          </div>
          <div>
            <div style="color:rgba(230,250,255,0.7);font-size:0.9em;">Exam Date</div>
            <div style="color:#ff2d55;font-weight:600;">${when.toLocaleDateString()}</div>
          </div>
        </div>
      </div>
  `;
  
  // Weekly breakdown
  const weeks = Math.ceil(totalStudyDays / 7);
  scheduleHTML += `<div style="color:var(--accent);font-weight:600;margin-bottom:12px;">Weekly Breakdown:</div>`;
  
  for (let week = 1; week <= weeks; week++) {
    const weekStart = new Date(startDate);
    weekStart.setDate(weekStart.getDate() + ((week - 1) * 7));
    const weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate() + 6);
    
    const daysInWeek = Math.min(7, totalStudyDays - ((week - 1) * 7));
    const studyHours = Math.min(daysInWeek, studyDaysPerWeek) * hoursPerDay;
    
    scheduleHTML += `
      <div style="
        background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;margin-bottom:8px;
        border-left:3px solid ${week === weeks ? '#ff2d55' : week === 1 ? '#39ff14' : '#ffcc00'};
      ">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;color:var(--accent);">Week ${week}</div>
            <div style="font-size:0.9em;color:rgba(230,250,255,0.7);">
              ${weekStart.toLocaleDateString()} ‚Äì ${weekEnd.toLocaleDateString()}
            </div>
          </div>
          <div style="color:#39ff14;font-weight:600;">${studyHours} hours</div>
        </div>
        <div style="font-size:0.9em;color:rgba(230,250,255,0.7);margin-top:8px;">
          Study ${Math.min(daysInWeek, studyDaysPerWeek)} days this week, ${hoursPerDay} hours each session
        </div>
      </div>
    `;
  }
  
  scheduleHTML += `</div>`;
  schedule.innerHTML = scheduleHTML;
}

function markAsCompleted(examId) {
  examItems = examItems.filter(exam => exam.id !== examId);
  saveToStorage();
  updateOverview();
  renderExams();
  
  if (examItems.length === 0) {
    document.getElementById('exams-section').style.display = 'none';
  }
}

function deleteExam(examId) {
  if (confirm('Are you sure you want to delete this exam?')) {
    examItems = examItems.filter(exam => exam.id !== examId);
    saveToStorage();
    updateOverview();
    renderExams();
    
    if (examItems.length === 0) {
      document.getElementById('exams-section').style.display = 'none';
    }
  }
}

function clearAllExams() {
  if (examItems.length === 0) return;
  
  if (confirm('Are you sure you want to delete all exams?')) {
    examItems = [];
    saveToStorage();
    updateOverview();
    document.getElementById('exams-section').style.display = 'none';
  }
}

function updateOverview() {
  const now = new Date();
  
  // Update total exams
  document.getElementById('total-exams').textContent = examItems.length;
  
  // Find next exam
  let nextExam = null;
  let daysUntilNext = '‚Äì';
  
  for (const exam of examItems) {
    const when = new Date(exam.when);
    if (when > now) {
      nextExam = exam;
      const diffDays = Math.ceil((when - now) / (1000 * 60 * 60 * 24));
      daysUntilNext = diffDays;
      break;
    }
  }
  
  document.getElementById('days-until-next').textContent = daysUntilNext;
  
  // Calculate total study hours
  let totalStudyHours = 0;
  examItems.forEach(exam => {
    const when = new Date(exam.when);
    const now = new Date();
    const daysUntil = Math.max(0, Math.ceil((when - now) / (1000 * 60 * 60 * 24)));
    const weeks = Math.min(exam.studyWeeksBefore, Math.ceil(daysUntil / 7));
    totalStudyHours += Math.ceil((weeks / exam.studyWeeksBefore) * exam.studyWeeksBefore * exam.studyDaysPerWeek * exam.studyHoursPerDay);
  });
  
  document.getElementById('study-hours').textContent = totalStudyHours;
  
  // Calculate urgent exams (‚â§7 days)
  const urgentCount = examItems.filter(exam => {
    const when = new Date(exam.when);
    const daysUntil = Math.ceil((when - now) / (1000 * 60 * 60 * 24));
    return daysUntil > 0 && daysUntil <= 7;
  }).length;
  
  document.getElementById('urgent-count').textContent = urgentCount;
}

function startCountdownTimer() {
  setInterval(() => {
    if (examItems.length > 0) {
      renderExams();
      updateOverview();
    }
  }, 60000); // Update every minute
}

function saveToStorage() {
  localStorage.setItem('examPlannerData', JSON.stringify(examItems));
}

function loadFromStorage() {
  const saved = localStorage.getItem('examPlannerData');
  if (saved) {
    try {
      examItems = JSON.parse(saved);
      examItems.sort((a, b) => new Date(a.when) - new Date(b.when));
      
      if (examItems.length > 0) {
        document.getElementById('exams-section').style.display = 'block';
        updateOverview();
        renderExams();
        
        // Generate study schedule for first exam
        if (examItems.length > 0) {
          generateStudySchedule(examItems[0]);
        }
      }
    } catch (e) {
      console.error('Failed to load saved exams:', e);
    }
  }
}

function exportStudyPlan() {
  if (examItems.length === 0) {
    alert('No exams to export');
    return;
  }
  
  let report = `EXAM STUDY PLAN REPORT\n`;
  report += `Generated: ${new Date().toLocaleString()}\n`;
  report += `Total Exams: ${examItems.length}\n\n`;
  report += `========================================\n\n`;
  
  examItems.forEach((exam, index) => {
    const when = new Date(exam.when);
    const daysUntil = Math.ceil((when - new Date()) / (1000 * 60 * 60 * 24));
    
    report += `EXAM ${index + 1}: ${exam.subject}\n`;
    report += `Date: ${when.toLocaleString()}\n`;
    report += `Duration: ${exam.durationMin || 'N/A'} minutes\n`;
    report += `Priority: ${exam.priority.toUpperCase()}\n`;
    report += `Days until exam: ${daysUntil > 0 ? daysUntil : 'Already occurred'}\n`;
    
    if (exam.notes) {
      report += `Notes: ${exam.notes}\n`;
    }
    
    // Study plan
    const totalStudyHours = Math.ceil((exam.studyWeeksBefore / exam.studyWeeksBefore) * exam.studyWeeksBefore * exam.studyDaysPerWeek * exam.studyHoursPerDay);
    report += `\nSTUDY PLAN:\n`;
    report += `‚Ä¢ Start studying: ${exam.studyWeeksBefore} weeks before exam\n`;
    report += `‚Ä¢ Study schedule: ${exam.studyDaysPerWeek} days/week, ${exam.studyHoursPerDay} hours/day\n`;
    report += `‚Ä¢ Total study hours: ${totalStudyHours} hours\n`;
    
    report += `\n========================================\n\n`;
  });
  
  report += `STUDY TIPS:\n`;
  report += `1. Use the Pomodoro Technique (25 min study, 5 min break)\n`;
  report += `2. Practice active recall instead of passive reading\n`;
  report += `3. Review material using spaced repetition\n`;
  report += `4. Get adequate sleep before the exam\n`;
  report += `5. Stay hydrated and take regular breaks\n`;
  
  const blob = new Blob([report], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().split('T')[0];
  
  a.href = url;
  a.download = `Exam_Study_Plan_${date}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function printStudyPlan() {
  window.print();
}

// Add hover effects
document.addEventListener('mouseover', function(e) {
  if (e.target.classList.contains('priority-btn') && !e.target.classList.contains('active')) {
    e.target.style.transform = 'translateY(-2px)';
    e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
  }
});

document.addEventListener('mouseout', function(e) {
  if (e.target.classList.contains('priority-btn') && !e.target.classList.contains('active')) {
    e.target.style.transform = 'translateY(0)';
    e.target.style.boxShadow = 'none';
  }
});

</script>

<style>
/* Professional styling */
.priority-btn {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.priority-btn:hover {
  transform: translateY(-4px) !important;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;
}

.exam-card:hover {
  background: rgba(255,255,255,0.05) !important;
}

input, select, textarea {
  transition: all 0.2s ease;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px rgba(45,212,255,0.2);
}

/* Smooth animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

#exams-section {
  animation: fadeIn 0.5s ease-out;
}

/* Responsive design */
@media (max-width: 768px) {
  .overview-section > div {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .input-section > div > div {
    grid-template-columns: 1fr !important;
  }
  
  .exam-card {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 12px !important;
  }
  
  .exam-card > div:last-child {
    align-self: flex-end;
  }
}

/* Print styles */
@media print {
  .tool-selector, button {
    display: none !important;
  }
  
  #exams-section {
    display: block !important;
    border: none !important;
    padding: 0 !important;
  }
  
  .exam-card {
    break-inside: avoid;
    page-break-inside: avoid;
  }
}

/* Progress bar animation */
@keyframes progressFill {
  from { width: 0%; }
  to { width: var(--progress-width); }
}

#daily-progress {
  animation: progressFill 1s ease-out;
}
</style>
