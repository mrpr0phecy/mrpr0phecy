<script>
// Add these functions to the existing script section

// 1. Burndown Chart Implementation
function tpRenderBurndownChart() {
    const canvas = document.getElementById('burndown-chart');
    if (!canvas || typeof Chart === 'undefined') {
        // Load Chart.js if needed
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
        script.onload = tpRenderBurndownChart;
        document.head.appendChild(script);
        return;
    }
    
    const ctx = canvas.getContext('2d');
    
    // Calculate sprint data (last 14 days)
    const sprintDays = 14;
    const labels = [];
    const ideal = [];
    const actual = [];
    
    const today = new Date();
    let totalTasks = tpTasks.filter(t => 
        t.createdAt && 
        new Date(t.createdAt) >= new Date(today.getTime() - (sprintDays * 86400000))
    ).length;
    
    for (let i = sprintDays; i >= 0; i--) {
        const date = new Date(today.getTime() - (i * 86400000));
        labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        
        // Ideal burndown (linear)
        ideal.push(totalTasks * (1 - (i / sprintDays)));
        
        // Actual burndown (tasks completed by this day)
        const completedByDate = tpTasks.filter(t => 
            t.status === 'done' && 
            t.completedAt && 
            new Date(t.completedAt) <= date
        ).length;
        actual.push(completedByDate);
    }
    
    // Destroy existing chart if it exists
    if (window.tpBurndownChart) {
        window.tpBurndownChart.destroy();
    }
    
    window.tpBurndownChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Ideal',
                    data: ideal,
                    borderColor: '#39ff14',
                    backgroundColor: 'rgba(57, 255, 20, 0.1)',
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0
                },
                {
                    label: 'Actual',
                    data: actual,
                    borderColor: '#2dd4ff',
                    backgroundColor: 'rgba(45, 212, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: 'rgba(230,250,255,0.8)'
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.05)'
                    },
                    ticks: {
                        color: 'rgba(230,250,255,0.7)'
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.05)'
                    },
                    ticks: {
                        color: 'rgba(230,250,255,0.7)'
                    }
                }
            }
        }
    });
}

// 2. Advanced Task Editing
function tpEditTask(taskId) {
    const task = tpTasks.find(t => t.id === taskId);
    if (!task) return;
    
    // Populate form with task data
    document.getElementById('team-member').value = task.member;
    document.getElementById('task-description').value = task.task;
    document.getElementById('task-priority').value = task.priority;
    tpUpdatePriorityDisplay(task.priority);
    document.getElementById('task-deadline').value = task.deadline;
    document.getElementById('task-status').value = task.status;
    document.getElementById('task-progress').value = task.progress;
    tpUpdateProgressDisplay(task.progress);
    document.getElementById('task-complexity').value = task.complexity;
    
    // Clear and repopulate tags
    const tagsContainer = document.getElementById('selected-tags');
    tagsContainer.innerHTML = '';
    (task.tags || []).forEach(tag => tpAddTag(tag));
    
    // Update suggestion
    tpUpdateDeadlineSuggestion();
    
    // Remove task from list (will be re-added when saved)
    tpTasks = tpTasks.filter(t => t.id !== taskId);
    tpSaveData();
    
    // Scroll to form and focus
    document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
    document.getElementById('task-description').focus();
    
    // Update button text
    const addButton = document.querySelector('button[onclick="tpAddTask()"]');
    const originalText = addButton.textContent;
    addButton.textContent = 'üíæ Update Task';
    addButton.onclick = function() {
        tpAddTask();
        addButton.textContent = originalText;
        addButton.onclick = tpAddTask;
    };
}

// 3. Task Dependencies
function tpAddTaskDependency(taskId, dependsOnId) {
    const task = tpTasks.find(t => t.id === taskId);
    if (task) {
        if (!task.dependencies) task.dependencies = [];
        if (!task.dependencies.includes(dependsOnId)) {
            task.dependencies.push(dependsOnId);
            tpSaveData();
            tpRenderKanban();
        }
    }
}

// 4. Time Tracking
function tpStartTimer(taskId) {
    const task = tpTasks.find(t => t.id === taskId);
    if (task) {
        if (!task.timeSpent) task.timeSpent = 0;
        task.timerStart = new Date().toISOString();
        task.status = 'inprogress';
        task.startedAt = task.startedAt || new Date().toISOString();
        tpSaveData();
        tpRenderKanban();
        
        // Update task element to show timer
        const taskElement = document.querySelector(`[data-id="${taskId}"]`);
        if (taskElement) {
            const timerDiv = document.createElement('div');
            timerDiv.id = `timer-${taskId}`;
            timerDiv.style.cssText = 'font-size:0.7rem;color:#ffcc00;margin-top:4px;';
            timerDiv.textContent = '‚è±Ô∏è 00:00:00';
            taskElement.appendChild(timerDiv);
            
            // Update timer every second
            task.timerInterval = setInterval(() => {
                if (task.timerStart) {
                    const elapsed = Math.floor((new Date() - new Date(task.timerStart)) / 1000);
                    const hours = Math.floor(elapsed / 3600).toString().padStart(2, '0');
                    const minutes = Math.floor((elapsed % 3600) / 60).toString().padStart(2, '0');
                    const seconds = (elapsed % 60).toString().padStart(2, '0');
                    timerDiv.textContent = `‚è±Ô∏è ${hours}:${minutes}:${seconds}`;
                }
            }, 1000);
        }
    }
}

function tpStopTimer(taskId) {
    const task = tpTasks.find(t => t.id === taskId);
    if (task && task.timerStart) {
        const elapsed = Math.floor((new Date() - new Date(task.timerStart)) / 1000);
        task.timeSpent = (task.timeSpent || 0) + elapsed;
        task.timerStart = null;
        
        if (task.timerInterval) {
            clearInterval(task.timerInterval);
            task.timerInterval = null;
        }
        
        tpSaveData();
        tpRenderKanban();
    }
}

// 5. Task Comments/Discussion
function tpAddComment(taskId, comment) {
    const task = tpTasks.find(t => t.id === taskId);
    if (task) {
        if (!task.comments) task.comments = [];
        task.comments.push({
            id: Date.now(),
            text: comment,
            author: 'You',
            timestamp: new Date().toISOString()
        });
        tpSaveData();
    }
}

// 6. Import/Export Enhancements
function tpImportTasks() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            try {
                const importedData = JSON.parse(event.target.result);
                if (Array.isArray(importedData.tasks)) {
                    tpTasks.push(...importedData.tasks);
                    tpSaveData();
                    tpRenderKanban();
                    tpUpdateAnalytics();
                    tpRenderPerformanceTable();
                    alert(`Successfully imported ${importedData.tasks.length} tasks!`);
                } else {
                    alert('Invalid file format. Please import a valid JSON file.');
                }
            } catch (error) {
                alert('Error importing file: ' + error.message);
            }
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

// 7. Advanced Filtering
function tpAdvancedFilter() {
    const filterModal = document.createElement('div');
    filterModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    `;
    
    filterModal.innerHTML = `
        <div style="
            background: #1a1f2b;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(45,212,255,0.3);
            max-height: 80vh;
            overflow-y: auto;
        ">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:var(--accent);margin:0;">üîç Advanced Filters</h3>
                <button onclick="this.closest('div').remove()" style="
                    background:none;
                    border:none;
                    color:rgba(255,255,255,0.7);
                    font-size:20px;
                    cursor:pointer;
                ">√ó</button>
            </div>
            
            <div style="margin-bottom:16px;">
                <label style="display:block;color:var(--accent);margin-bottom:8px;font-weight:500;">Priority Range</label>
                <div style="display:flex;align-items:center;gap:12px;">
                    <input type="range" id="filter-min-priority" min="1" max="10" value="1" 
                           style="flex:1;height:6px;border-radius:3px;background:rgba(45,212,255,0.1);">
                    <span id="min-priority-display" style="color:#2dd4ff;">1</span>
                    <span style="color:rgba(230,250,255,0.5);">to</span>
                    <input type="range" id="filter-max-priority" min="1" max="10" value="10" 
                           style="flex:1;height:6px;border-radius:3px;background:rgba(45,212,255,0.1);">
                    <span id="max-priority-display" style="color:#ff2d55;">10</span>
                </div>
            </div>
            
            <div style="margin-bottom:16px;">
                <label style="display:block;color:var(--accent);margin-bottom:8px;font-weight:500;">Complexity</label>
                <div style="display:flex;flex-wrap:wrap;gap:8px;">
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="quick">
                        <span style="color:rgba(230,250,255,0.9);">Quick</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="simple" checked>
                        <span style="color:rgba(230,250,255,0.9);">Simple</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="moderate" checked>
                        <span style="color:rgba(230,250,255,0.9);">Moderate</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="complex">
                        <span style="color:rgba(230,250,255,0.9);">Complex</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="major">
                        <span style="color:rgba(230,250,255,0.9);">Major</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                        <input type="checkbox" class="complexity-filter" value="epic">
                        <span style="color:rgba(230,250,255,0.9);">Epic</span>
                    </label>
                </div>
            </div>
            
            <div style="margin-bottom:16px;">
                <label style="display:block;color:var(--accent);margin-bottom:8px;font-weight:500;">Team Members</label>
                <div style="display:flex;flex-wrap:wrap;gap:8px;">
                    ${tpTeamMembers.map(member => `
                        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                            <input type="checkbox" class="member-filter" value="${member.name}" checked>
                            <span style="color:rgba(230,250,255,0.9);">${member.name}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
            
            <div style="margin-bottom:16px;">
                <label style="display:block;color:var(--accent);margin-bottom:8px;font-weight:500;">Due Date</label>
                <select id="due-date-filter" style="
                    width:100%;
                    padding:10px;
                    border-radius:8px;
                    border:1px solid rgba(45,212,255,0.3);
                    background:rgba(45,212,255,0.05);
                    color:inherit;
                ">
                    <option value="all">All dates</option>
                    <option value="today">Due today</option>
                    <option value="week">Due this week</option>
                    <option value="overdue">Overdue</option>
                    <option value="future">Future dates</option>
                </select>
            </div>
            
            <div style="display:flex;gap:12px;margin-top:24px;">
                <button onclick="tpApplyAdvancedFilters(this.closest('div'))" style="
                    flex:1;
                    padding:12px;
                    background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));
                    border:1px solid rgba(45,212,255,0.4);
                    border-radius:8px;
                    color:var(--accent);
                    cursor:pointer;
                    font-weight:600;
                ">
                    Apply Filters
                </button>
                <button onclick="tpClearFilters(this.closest('div'))" style="
                    padding:12px 20px;
                    background:rgba(255,255,255,0.05);
                    border:1px solid rgba(255,255,255,0.1);
                    border-radius:8px;
                    color:inherit;
                    cursor:pointer;
                ">
                    Clear All
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(filterModal);
    
    // Add event listeners for priority sliders
    document.getElementById('filter-min-priority').addEventListener('input', function() {
        document.getElementById('min-priority-display').textContent = this.value;
    });
    
    document.getElementById('filter-max-priority').addEventListener('input', function() {
        document.getElementById('max-priority-display').textContent = this.value;
    });
}

function tpApplyAdvancedFilters(modal) {
    const minPriority = parseInt(document.getElementById('filter-min-priority').value);
    const maxPriority = parseInt(document.getElementById('filter-max-priority').value);
    const selectedComplexities = Array.from(document.querySelectorAll('.complexity-filter:checked'))
        .map(cb => cb.value);
    const selectedMembers = Array.from(document.querySelectorAll('.member-filter:checked'))
        .map(cb => cb.value);
    const dueDateFilter = document.getElementById('due-date-filter').value;
    
    // Store filters in global state
    tpAdvancedFilters = {
        minPriority,
        maxPriority,
        complexities: selectedComplexities,
        members: selectedMembers,
        dueDate: dueDateFilter
    };
    
    // Apply filters
    tpRenderKanban();
    modal.closest('div').remove();
}

function tpClearFilters(modal) {
    tpAdvancedFilters = null;
    tpRenderKanban();
    modal.closest('div').remove();
}

// 8. Keyboard Shortcuts
document.addEventListener('keydown', function(e) {
    // Don't trigger if typing in inputs
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    switch(e.key) {
        case 'n':
        case 'N':
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                document.getElementById('team-member').focus();
            }
            break;
        case 'a':
        case 'A':
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                tpAddTask();
            }
            break;
        case 'f':
        case 'F':
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                tpAdvancedFilter();
            }
            break;
        case 'r':
        case 'R':
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                tpGenerateReport();
            }
            break;
        case 'Escape':
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) modal.remove();
            break;
    }
});

// 9. Enhanced Initialize Function
// Replace the existing tpInitialize function with this enhanced version
function tpInitializeEnhanced() {
    console.log('Team Productivity Hub: Initializing...');
    
    // Load saved data
    tpLoadData();
    
    // Set default deadline to 3 days from now
    const defaultDeadline = new Date();
    defaultDeadline.setDate(defaultDeadline.getDate() + 3);
    document.getElementById('task-deadline').valueAsDate = defaultDeadline;
    
    // Initialize UI
    tpUpdatePriorityDisplay(5);
    tpUpdateProgressDisplay(0);
    tpUpdateDeadlineSuggestion();
    
    // Load sample team members if none exist
    if (tpTeamMembers.length === 0) {
        tpTeamMembers = [
            { name: 'Alex Chen', role: 'Frontend Dev', capacity: 8, specialties: ['design', 'react'] },
            { name: 'Sam Rivera', role: 'Backend Dev', capacity: 8, specialties: ['api', 'database'] },
            { name: 'Jordan Taylor', role: 'UX Designer', capacity: 6, specialties: ['design', 'research'] },
            { name: 'Casey Smith', role: 'QA Engineer', capacity: 6, specialties: ['testing', 'bug'] },
            { name: 'Morgan Lee', role: 'Project Manager', capacity: 4, specialties: ['planning', 'meeting'] }
        ];
    }
    
    // Load sample tasks if none exist
    if (tpTasks.length === 0) {
        tpAddSampleTasks();
    }
    
    // Render everything
    tpRenderTasks();
    tpUpdateAnalytics();
    tpRenderKanban();
    tpRenderPerformanceTable();
    tpRenderBurndownChart();
    
    // Set up event listeners
    tpSetupEventListeners();
    
    // Show welcome tooltip
    setTimeout(() => {
        if (tpTasks.length <= 5) {
            const welcome = document.createElement('div');
            welcome.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, rgba(45,212,255,0.1), rgba(45,212,255,0.05));
                border: 1px solid rgba(45,212,255,0.3);
                border-radius: 12px;
                padding: 16px;
                max-width: 300px;
                z-index: 100;
                backdrop-filter: blur(10px);
            `;
            welcome.innerHTML = `
                <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">üöÄ Welcome to AI Team Hub!</div>
                <div style="color:rgba(230,250,255,0.9);font-size:0.9rem;margin-bottom:12px;">
                    Try these shortcuts:
                    <div style="margin-top:8px;">
                        ‚Ä¢ <strong>Ctrl+N</strong>: New task<br>
                        ‚Ä¢ <strong>Ctrl+F</strong>: Advanced filters<br>
                        ‚Ä¢ <strong>Ctrl+R</strong>: Analytics report<br>
                        ‚Ä¢ <strong>Drag & Drop</strong>: Move tasks
                    </div>
                </div>
                <button onclick="this.parentElement.remove()" style="
                    width:100%;
                    padding:8px;
                    background:rgba(45,212,255,0.2);
                    border:1px solid rgba(45,212,255,0.3);
                    border-radius:6px;
                    color:var(--accent);
                    cursor:pointer;
                    font-size:0.9rem;
                ">
                    Got it!
                </button>
            `;
            document.body.appendChild(welcome);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (welcome.parentElement) welcome.remove();
            }, 10000);
        }
    }, 1000);
    
    console.log('Team Productivity Hub: Ready with', tpTasks.length, 'tasks');
}

// 10. Enhanced Kanban Render with Filters
// Replace tpRenderKanban with this enhanced version
function tpRenderKanbanEnhanced() {
    const columns = {
        backlog: document.getElementById('column-backlog'),
        todo: document.getElementById('column-todo'),
        inprogress: document.getElementById('column-inprogress'),
        review: document.getElementById('column-review'),
        done: document.getElementById('column-done')
    };
    
    // Clear all columns
    Object.values(columns).forEach(col => col.innerHTML = '');
    
    // Count tasks per column
    const counts = {
        backlog: 0,
        todo: 0,
        inprogress: 0,
        review: 0,
        done: 0
    };
    
    // Apply all filters
    let filteredTasks = tpTasks;
    
    // Basic filter
    if (tpCurrentFilter === 'active') {
        filteredTasks = filteredTasks.filter(t => t.status !== 'done' && t.status !== 'backlog');
    } else if (tpCurrentFilter === 'overdue') {
        filteredTasks = filteredTasks.filter(t => {
            if (t.status === 'done' || t.status === 'backlog' || !t.deadline) return false;
            const deadline = new Date(t.deadline);
            return deadline < new Date();
        });
    }
    
    // Advanced filters
    if (tpAdvancedFilters) {
        filteredTasks = filteredTasks.filter(task => {
            // Priority filter
            if (task.priority < tpAdvancedFilters.minPriority || 
                task.priority > tpAdvancedFilters.maxPriority) {
                return false;
            }
            
            // Complexity filter
            if (tpAdvancedFilters.complexities.length > 0 && 
                !tpAdvancedFilters.complexities.includes(task.complexity)) {
                return false;
            }
            
            // Member filter
            if (tpAdvancedFilters.members.length > 0 && 
                !tpAdvancedFilters.members.includes(task.member)) {
                return false;
            }
            
            // Due date filter
            if (task.deadline) {
                const deadline = new Date(task.deadline);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                switch(tpAdvancedFilters.dueDate) {
                    case 'today':
                        deadline.setHours(0, 0, 0, 0);
                        if (deadline.getTime() !== today.getTime()) return false;
                        break;
                    case 'week':
                        const weekFromNow = new Date(today.getTime() + 7 * 86400000);
                        if (deadline < today || deadline > weekFromNow) return false;
                        break;
                    case 'overdue':
                        if (deadline >= today || task.status === 'done') return false;
                        break;
                    case 'future':
                        if (deadline <= today) return false;
                        break;
                }
            }
            
            return true;
        });
    }
    
    // Render each task in appropriate column
    filteredTasks.forEach(task => {
        counts[task.status]++;
        
        const taskElement = document.createElement('div');
        taskElement.className = 'kanban-task';
        taskElement.draggable = true;
        taskElement.dataset.id = task.id;
        taskElement.dataset.status = task.status;
        taskElement.ondragstart = tpDragStart;
        taskElement.ondblclick = () => tpEditTask(task.id);
        taskElement.style.cssText = `
            background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.2s;
        `;
        taskElement.onmouseover = () => {
            taskElement.style.transform = 'translateY(-2px)';
            taskElement.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
        };
        taskElement.onmouseout = () => {
            taskElement.style.transform = '';
            taskElement.style.boxShadow = '';
        };
        
        // Priority indicator
        const priorityColor = priorityLabels[task.priority]?.color || '#ffffff';
        
        // Deadline status
        let deadlineClass = '';
        let deadlineText = task.deadline ? new Date(task.deadline).toLocaleDateString() : 'No deadline';
        
        if (task.deadline && task.status !== 'done') {
            const deadlineDate = new Date(task.deadline);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            deadlineDate.setHours(0, 0, 0, 0);
            const diffDays = Math.floor((deadlineDate - today) / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                deadlineClass = 'color:#ff2d55;font-weight:600;';
                deadlineText = `‚ö†Ô∏è Overdue: ${deadlineText}`;
            } else if (diffDays === 0) {
                deadlineClass = 'color:#ffcc00;font-weight:600;';
                deadlineText = `‚ö†Ô∏è Today: ${deadlineText}`;
            } else if (diffDays <= 2) {
                deadlineClass = 'color:#ffa500;';
                deadlineText = `‚ö†Ô∏è ${diffDays}d: ${deadlineText}`;
            }
        }
        
        // Progress bar
        const progressBar = task.status === 'done' ? 100 : task.progress || 0;
        
        // Time spent indicator
        let timeSpent = '';
        if (task.timeSpent) {
            const hours = Math.floor(task.timeSpent / 3600);
            const minutes = Math.floor((task.timeSpent % 3600) / 60);
            timeSpent = `<div style="font-size:0.7rem;color:#ffcc00;margin-top:4px;">‚è±Ô∏è ${hours}h ${minutes}m</div>`;
        }
        
        taskElement.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
                <div>
                    <strong style="color:var(--accent);font-size:0.9rem;">${task.member}</strong>
                    <div style="font-size:0.75rem;color:${priorityColor};margin-top:2px;">
                        ${priorityLabels[task.priority]?.label || 'Priority'} (${task.priority})
                    </div>
                </div>
                <div style="display:flex;gap:4px;">
                    <button onclick="event.stopPropagation(); tpEditTask('${task.id}')" style="
                        background: transparent;
                        border: none;
                        color: rgba(45,212,255,0.7);
                        cursor: pointer;
                        font-size: 12px;
                        padding: 2px;
                    " title="Edit">
                        ‚úèÔ∏è
                    </button>
                    <button onclick="event.stopPropagation(); tpDeleteTask('${task.id}')" style="
                        background: transparent;
                        border: none;
                        color: rgba(255,77,77,0.7);
                        cursor: pointer;
                        font-size: 12px;
                        padding: 2px;
                    " title="Delete">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom:8px;color:rgba(230,250,255,0.9);font-size:0.85rem;">
                ${task.task}
            </div>
            
            <div style="margin-bottom:8px;">
                <div style="height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden;">
                    <div style="height:100%;width:${progressBar}%;background:${priorityColor};border-radius:2px;"></div>
                </div>
                <div style="text-align:center;font-size:0.7rem;color:rgba(230,250,255,0.7);margin-top:2px;">
                    ${progressBar}%
                </div>
                ${timeSpent}
            </div>
            
            <div style="display:flex;justify-content:space-between;font-size:0.7rem;">
                <div style="${deadlineClass}">üìÖ ${deadlineText}</div>
                <div style="display:flex;gap:4px;">
                    ${(task.tags || []).map(tag => `
                        <span style="
                            padding:1px 4px;
                            background:${tpGetTagColor(tag)};
                            border-radius:4px;
                            font-size:0.6rem;
                        ">${tag}</span>
                    `).join('')}
                </div>
            </div>
            
            <div style="font-size:0.6rem;color:rgba(230,250,255,0.5);margin-top:8px;">
                Double-click to edit ‚Ä¢ Drag to move
            </div>
        `;
        
        if (columns[task.status]) {
            columns[task.status].appendChild(taskElement);
        }
    });
    
    // Update counts
    Object.keys(counts).forEach(status => {
        const countElement = document.getElementById(`count-${status}`);
        if (countElement) {
            countElement.textContent = counts[status];
        }
    });
    
    // Update total count
    document.getElementById('task-count').textContent = `${filteredTasks.length} task${filteredTasks.length !== 1 ? 's' : ''}`;
}

// Replace the initialization call at the bottom
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', tpInitializeEnhanced);
} else {
    tpInitializeEnhanced();
}

// Add this CSS to enhance the card
const style = document.createElement('style');
style.textContent = `
    .kanban-task {
        position: relative;
    }
    
    .kanban-task::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--accent);
        opacity: 0;
        transition: opacity 0.2s;
        border-radius: 8px 8px 0 0;
    }
    
    .kanban-task:hover::before {
        opacity: 0.5;
    }
    
    .kanban-column {
        min-height: 200px;
        transition: background 0.2s;
    }
    
    .kanban-column.drag-over {
        background: rgba(45,212,255,0.1);
        border-color: var(--accent);
    }
    
    /* Animation for new tasks */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .kanban-task {
        animation: fadeInUp 0.3s ease-out;
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
        .kanban-columns {
            grid-template-columns: 1fr !important;
        }
        
        #productivity-title {
            font-size: 1.2rem;
        }
        
        .actions {
            grid-template-columns: 1fr !important;
        }
    }
`;
document.head.appendChild(style);
</script>
