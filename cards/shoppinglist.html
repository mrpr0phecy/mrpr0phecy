<h2 id="shoppinglist-title" style="margin-top:0;background:linear-gradient(45deg, #667eea, #764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;">ğŸ›’ Smart Shopping List</h2>

<form aria-describedby="shoppinglist-desc">
  <p id="shoppinglist-desc" class="small" style="color:rgba(102,126,234,0.8);margin-bottom:16px;">
    Add items, organize by category, track quantities, and manage your shopping efficiently.
    <span style="color:#10b981;display:block;margin-top:4px;">
      âœ… Features: Categories, quantity tracking, budget calculator, shareable lists
    </span>
  </p>

  <!-- Quick Add Section -->
  <div style="background:rgba(102,126,234,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(102,126,234,0.1);">
    <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="shoppinglist-item" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#667eea;font-weight:500;">
          <span style="font-size:18px;">ğŸ›ï¸</span> Item Name
        </label>
        <input id="shoppinglist-item" type="text" placeholder="e.g. Organic Milk" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(102,126,234,0.3);background:rgba(102,126,234,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="shoppinglist-quantity" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#667eea;font-weight:500;">
          <span style="font-size:18px;">ğŸ“¦</span> Quantity
        </label>
        <input id="shoppinglist-quantity" type="text" placeholder="e.g. 2" value="1"
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(102,126,234,0.3);background:rgba(102,126,234,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="shoppinglist-category" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#667eea;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Category
        </label>
        <select id="shoppinglist-category" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(102,126,234,0.3);background:rgba(102,126,234,0.05);color:inherit;">
          <option value="groceries">ğŸ›’ Groceries</option>
          <option value="household">ğŸ  Household</option>
          <option value="personal">ğŸ‘¤ Personal Care</option>
          <option value="electronics">ğŸ”Œ Electronics</option>
          <option value="other">ğŸ“¦ Other</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="shoppinglist-price" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#667eea;font-weight:500;">
          <span style="font-size:18px;">ğŸ’°</span> Estimated Price ($)
        </label>
        <input id="shoppinglist-price" type="number" min="0" step="0.01" placeholder="0.00"
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(102,126,234,0.3);background:rgba(102,126,234,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="shoppinglist-priority" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#667eea;font-weight:500;">
          <span style="font-size:18px;">ğŸ¯</span> Priority
        </label>
        <select id="shoppinglist-priority" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(102,126,234,0.3);background:rgba(102,126,234,0.05);color:inherit;">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="urgent">Urgent</option>
        </select>
      </div>
    </div>
    
    <div style="display:flex;justify-content:flex-end;gap:10px;">
      <button type="button" onclick="shoppinglistAdd(this)" 
              style="padding:12px 24px;background:linear-gradient(135deg, rgba(102,126,234,0.2), rgba(102,126,234,0.1));border:1px solid rgba(102,126,234,0.4);border-radius:8px;color:#667eea;cursor:pointer;font-weight:600;">
        â• Add to List
      </button>
    </div>
  </div>

  <!-- List Controls -->
  <div style="background:rgba(16,185,129,0.05);border-radius:8px;padding:12px;margin-bottom:16px;border:1px solid rgba(16,185,129,0.1);">
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button onclick="shoppinglistSort('name')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:6px;color:#667eea;cursor:pointer;font-size:14px;">
        ğŸ”¤ Sort by Name
      </button>
      <button onclick="shoppinglistSort('category')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:6px;color:#667eea;cursor:pointer;font-size:14px;">
        ğŸ“ Sort by Category
      </button>
      <button onclick="shoppinglistSort('priority')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:6px;color:#667eea;cursor:pointer;font-size:14px;">
        ğŸ¯ Sort by Priority
      </button>
      <button onclick="shoppinglistToggleAll()" style="padding:8px 16px;background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:6px;color:#f59e0b;cursor:pointer;font-size:14px;">
        âœ… Mark All as Bought
      </button>
      <button onclick="shoppinglistClearBought()" style="padding:8px 16px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:#ef4444;cursor:pointer;font-size:14px;">
        ğŸ—‘ï¸ Remove Bought Items
      </button>
    </div>
  </div>

  <!-- Budget Summary -->
  <div style="background:rgba(245,158,11,0.05);border-radius:8px;padding:12px;margin-bottom:16px;border:1px solid rgba(245,158,11,0.1);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="display:flex;align-items:center;gap:8px;color:#f59e0b;font-weight:500;">
        <span style="font-size:18px;">ğŸ’°</span>
        <span>Budget Summary</span>
      </div>
      <div style="font-size:14px;color:rgba(230,250,255,0.7);">
        Total: $<span id="shoppinglist-total">0.00</span>
      </div>
    </div>
    
    <div style="display:flex;align-items:center;gap:12px;">
      <div style="flex:1;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
        <div id="shoppinglist-budget-progress" style="height:100%;background:linear-gradient(90deg, #f59e0b, #d97706);width:0%;transition:width 0.5s;border-radius:4px;"></div>
      </div>
      <div id="shoppinglist-budget-status" style="font-size:12px;color:#f59e0b;">$0 spent</div>
    </div>
    
    <div style="display:flex;justify-content:space-between;margin-top:4px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">$0</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">Budget Limit: $<span id="shoppinglist-budget-limit">100</span></div>
    </div>
  </div>

  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="shoppinglistShare(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(102,126,234,0.2), rgba(102,126,234,0.1));border:1px solid rgba(102,126,234,0.4);border-radius:8px;color:#667eea;cursor:pointer;font-weight:600;">
      ğŸ“¤ Share Shopping List
    </button>
    <button type="button" onclick="shoppinglistReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset List
    </button>
    <button type="button" onclick="shoppinglistExport()"
            style="padding:12px 16px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:8px;color:#10b981;cursor:pointer;">
      ğŸ“¥ Export as CSV
    </button>
    <button type="button" onclick="shoppinglistPrint()"
            style="padding:12px 16px;background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:8px;color:#f59e0b;cursor:pointer;">
      ğŸ–¨ï¸ Print List
    </button>
  </div>
</form>

<!-- Results Section -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:#667eea;margin:0;display:flex;align-items:center;gap:8px;">
      <span style="font-size:20px;">ğŸ“‹</span> Your Shopping List (<span id="shoppinglist-count">0</span> items)
    </h3>
    <div id="shoppinglist-hint" style="font-size:12px;color:rgba(230,250,255,0.7);"></div>
  </div>

  <!-- Categories Tabs -->
  <div style="display:flex;gap:4px;margin-bottom:12px;overflow-x:auto;">
    <button onclick="shoppinglistFilter('all')" id="filter-all" style="padding:8px 16px;background:rgba(102,126,234,0.2);border:1px solid rgba(102,126,234,0.4);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      All Items
    </button>
    <button onclick="shoppinglistFilter('groceries')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      ğŸ›’ Groceries
    </button>
    <button onclick="shoppinglistFilter('household')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      ğŸ  Household
    </button>
    <button onclick="shoppinglistFilter('personal')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      ğŸ‘¤ Personal Care
    </button>
    <button onclick="shoppinglistFilter('electronics')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      ğŸ”Œ Electronics
    </button>
    <button onclick="shoppinglistFilter('other')" style="padding:8px 16px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.3);border-radius:8px;color:#667eea;cursor:pointer;white-space:nowrap;">
      ğŸ“¦ Other
    </button>
  </div>

  <!-- Shopping List Items -->
  <div id="shoppinglist-container" style="min-height:200px;">
    <div id="shoppinglist-list" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:12px;">
      {/* Items will appear here */}
    </div>
    
    <div id="shoppinglist-empty" style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
      <div style="font-size:48px;margin-bottom:12px;">ğŸ›’</div>
      <div>Your shopping list is empty.</div>
      <div style="font-size:12px;margin-top:8px;color:rgba(230,250,255,0.4);">Add items using the form above to get started!</div>
    </div>
  </div>

  <!-- Shopping Stats -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;margin-top:20px;">
    <div style="background:rgba(102,126,234,0.1);border-radius:8px;padding:12px;text-align:center;border:1px solid rgba(102,126,234,0.2);">
      <div style="font-size:24px;color:#667eea;font-weight:600;" id="stats-total">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Total Items</div>
    </div>
    <div style="background:rgba(16,185,129,0.1);border-radius:8px;padding:12px;text-align:center;border:1px solid rgba(16,185,129,0.2);">
      <div style="font-size:24px;color:#10b981;font-weight:600;" id="stats-bought">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Bought</div>
    </div>
    <div style="background:rgba(245,158,11,0.1);border-radius:8px;padding:12px;text-align:center;border:1px solid rgba(245,158,11,0.2);">
      <div style="font-size:24px;color:#f59e0b;font-weight:600;" id="stats-pending">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Pending</div>
    </div>
    <div style="background:rgba(239,68,68,0.1);border-radius:8px;padding:12px;text-align:center;border:1px solid rgba(239,68,68,0.2);">
      <div style="font-size:24px;color:#ef4444;font-weight:600;" id="stats-urgent">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Urgent</div>
    </div>
  </div>
</div>

<script>
/* shoppinglist.html - Enhanced Shopping List
   - Full-featured shopping list with categories, budget tracking, and sorting
   - All .card references kept intact
*/

let shoppingItems = [];
let currentFilter = 'all';

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Load saved items from localStorage
  try {
    const saved = localStorage.getItem('shoppinglist-items');
    if (saved) {
      shoppingItems = JSON.parse(saved) || [];
      renderShoppingList();
    }
  } catch (e) {
    // Silently fail if localStorage is not available
  }
  
  // Set active filter button
  document.querySelector('#filter-all').style.background = 'rgba(102,126,234,0.2)';
  
  // Add enter key support
  document.querySelector('#shoppinglist-item').addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
      const addBtn = document.querySelector('.actions button[onclick*="shoppinglistAdd"]');
      shoppinglistAdd(addBtn);
    }
  });
});

function shoppinglistAdd(btn) {
  const card = btn.closest('.card');
  const item = card.querySelector('#shoppinglist-item').value.trim();
  const quantity = card.querySelector('#shoppinglist-quantity').value.trim() || '1';
  const category = card.querySelector('#shoppinglist-category').value;
  const price = parseFloat(card.querySelector('#shoppinglist-price').value) || 0;
  const priority = card.querySelector('#shoppinglist-priority').value;
  
  if (!item) {
    showShoppingHint('âŒ Please enter an item name', '#ef4444');
    return;
  }
  
  const newItem = {
    id: Date.now() + Math.random(),
    name: item,
    quantity: quantity,
    category: category,
    price: price,
    priority: priority,
    bought: false,
    added: new Date().toISOString()
  };
  
  shoppingItems.push(newItem);
  
  // Clear form
  card.querySelector('#shoppinglist-item').value = '';
  card.querySelector('#shoppinglist-price').value = '';
  card.querySelector('#shoppinglist-quantity').value = '1';
  
  // Save to localStorage
  saveShoppingItems();
  
  // Update UI
  renderShoppingList();
  
  showShoppingHint(`âœ… Added "${item}" to your list`, '#10b981');
}

function renderShoppingList() {
  const card = document.querySelector('.card');
  if (!card) return;
  
  const container = card.querySelector('#shoppinglist-list');
  const emptyMsg = card.querySelector('#shoppinglist-empty');
  const filteredItems = currentFilter === 'all' 
    ? shoppingItems 
    : shoppingItems.filter(item => item.category === currentFilter);
  
  // Show/hide empty message
  if (filteredItems.length === 0) {
    container.innerHTML = '';
    if (emptyMsg) emptyMsg.style.display = 'block';
  } else {
    if (emptyMsg) emptyMsg.style.display = 'none';
    
    let html = '';
    filteredItems.forEach(item => {
      const priorityColor = 
        item.priority === 'urgent' ? '#ef4444' :
        item.priority === 'high' ? '#f59e0b' :
        item.priority === 'medium' ? '#667eea' : '#10b981';
      
      const categoryIcon = 
        item.category === 'groceries' ? 'ğŸ›’' :
        item.category === 'household' ? 'ğŸ ' :
        item.category === 'personal' ? 'ğŸ‘¤' :
        item.category === 'electronics' ? 'ğŸ”Œ' : 'ğŸ“¦';
      
      html += `
        <div style="background:${item.bought ? 'rgba(16,185,129,0.1)' : 'rgba(0,0,0,0.3)'};border-radius:8px;padding:16px;border-left:4px solid ${priorityColor};transition:all 0.3s;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
            <div>
              <div style="display:flex;align-items:center;gap:8px;">
                ${categoryIcon}
                <div style="font-weight:600;color:${item.bought ? '#10b981' : priorityColor};${item.bought ? 'text-decoration:line-through;' : ''}">
                  ${escapeHTML(item.name)}
                </div>
              </div>
              <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                Qty: ${escapeHTML(item.quantity)} â€¢ $${item.price.toFixed(2)} â€¢ ${item.priority.charAt(0).toUpperCase() + item.priority.slice(1)}
              </div>
            </div>
            <div style="display:flex;gap:4px;">
              <button onclick="shoppinglistToggle('${item.id}')" style="background:transparent;border:none;color:${item.bought ? '#10b981' : '#667eea'};cursor:pointer;font-size:18px;padding:4px;" title="${item.bought ? 'Mark as pending' : 'Mark as bought'}">
                ${item.bought ? 'âœ…' : 'â¬œ'}
              </button>
              <button onclick="shoppinglistRemove('${item.id}')" style="background:transparent;border:none;color:rgba(239,68,68,0.7);cursor:pointer;font-size:14px;padding:4px;" title="Remove">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
            <div style="font-size:11px;color:rgba(230,250,255,0.5);">
              Added: ${new Date(item.added).toLocaleDateString()}
            </div>
            <div style="font-size:14px;color:#f59e0b;font-weight:600;">
              $${(item.price * parseFloat(item.quantity)).toFixed(2)}
            </div>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;
  }
  
  // Update counters
  updateShoppingStats();
  
  // Update budget
  updateShoppingBudget();
}

function shoppinglistToggle(itemId) {
  const item = shoppingItems.find(i => i.id == itemId);
  if (item) {
    item.bought = !item.bought;
    saveShoppingItems();
    renderShoppingList();
    
    const action = item.bought ? 'bought' : 'pending';
    showShoppingHint(`âœ… Marked "${item.name}" as ${action}`, '#10b981');
  }
}

function shoppinglistRemove(itemId) {
  if (!confirm('Remove this item from your list?')) return;
  
  const itemIndex = shoppingItems.findIndex(i => i.id == itemId);
  if (itemIndex !== -1) {
    const itemName = shoppingItems[itemIndex].name;
    shoppingItems.splice(itemIndex, 1);
    saveShoppingItems();
    renderShoppingList();
    showShoppingHint(`âœ… Removed "${itemName}" from list`, '#10b981');
  }
}

function shoppinglistToggleAll() {
  const allBought = shoppingItems.every(item => item.bought);
  shoppingItems.forEach(item => {
    item.bought = !allBought;
  });
  saveShoppingItems();
  renderShoppingList();
  showShoppingHint(`âœ… ${allBought ? 'Unmarked all items' : 'Marked all items as bought'}`, '#10b981');
}

function shoppinglistClearBought() {
  const boughtCount = shoppingItems.filter(item => item.bought).length;
  if (boughtCount === 0) {
    showShoppingHint('âŒ No bought items to remove', '#ef4444');
    return;
  }
  
  if (!confirm(`Remove ${boughtCount} bought item(s)?`)) return;
  
  shoppingItems = shoppingItems.filter(item => !item.bought);
  saveShoppingItems();
  renderShoppingList();
  showShoppingHint(`âœ… Removed ${boughtCount} bought item(s)`, '#10b981');
}

function shoppinglistSort(sortBy) {
  switch(sortBy) {
    case 'name':
      shoppingItems.sort((a, b) => a.name.localeCompare(b.name));
      break;
    case 'category':
      shoppingItems.sort((a, b) => a.category.localeCompare(b.category));
      break;
    case 'priority':
      const priorityOrder = { urgent: 0, high: 1, medium: 2, low: 3 };
      shoppingItems.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
      break;
  }
  
  saveShoppingItems();
  renderShoppingList();
  showShoppingHint(`âœ… Sorted by ${sortBy}`, '#667eea');
}

function shoppinglistFilter(category) {
  currentFilter = category;
  
  // Update active filter button
  document.querySelectorAll('.results > div > button').forEach(btn => {
    btn.style.background = 'rgba(102,126,234,0.1)';
  });
  
  const activeBtn = document.querySelector(`button[onclick*="${category}"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(102,126,234,0.2)';
  }
  
  renderShoppingList();
}

function shoppinglistReset(btn) {
  const card = btn.closest('.card');
  if (shoppingItems.length === 0) return;
  
  if (!confirm('Reset your entire shopping list? This cannot be undone.')) return;
  
  shoppingItems = [];
  saveShoppingItems();
  renderShoppingList();
  
  // Reset form
  card.querySelector('#shoppinglist-item').value = '';
  card.querySelector('#shoppinglist-quantity').value = '1';
  card.querySelector('#shoppinglist-price').value = '';
  
  showShoppingHint('âœ… Shopping list cleared', '#10b981');
}

function shoppinglistShare(btn) {
  if (shoppingItems.length === 0) {
    showShoppingHint('âŒ No items to share', '#ef4444');
    return;
  }
  
  const shareText = generateShareText();
  
  if (navigator.share) {
    navigator.share({
      title: 'My Shopping List',
      text: shareText,
      url: window.location.href
    }).then(() => {
      showShoppingHint('âœ… List shared successfully', '#10b981');
    }).catch(() => {
      copyToClipboard(shareText);
    });
  } else {
    copyToClipboard(shareText);
  }
}

function shoppinglistExport() {
  if (shoppingItems.length === 0) {
    showShoppingHint('âŒ No items to export', '#ef4444');
    return;
  }
  
  const csv = generateCSV();
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `shopping-list-${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showShoppingHint('âœ… Exported as CSV', '#10b981');
}

function shoppinglistPrint() {
  if (shoppingItems.length === 0) {
    showShoppingHint('âŒ No items to print', '#ef4444');
    return;
  }
  
  const printWindow = window.open('', '_blank');
  const printContent = generatePrintContent();
  
  printWindow.document.write(printContent);
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 500);
  
  showShoppingHint('âœ… Opening print preview...', '#10b981');
}

// Helper Functions
function updateShoppingStats() {
  const card = document.querySelector('.card');
  if (!card) return;
  
  const total = shoppingItems.length;
  const bought = shoppingItems.filter(item => item.bought).length;
  const pending = total - bought;
  const urgent = shoppingItems.filter(item => item.priority === 'urgent' && !item.bought).length;
  
  card.querySelector('#shoppinglist-count').textContent = total;
  card.querySelector('#stats-total').textContent = total;
  card.querySelector('#stats-bought').textContent = bought;
  card.querySelector('#stats-pending').textContent = pending;
  card.querySelector('#stats-urgent').textContent = urgent;
}

function updateShoppingBudget() {
  const card = document.querySelector('.card');
  if (!card) return;
  
  const total = shoppingItems.reduce((sum, item) => {
    return sum + (item.price * parseFloat(item.quantity));
  }, 0);
  
  const boughtTotal = shoppingItems
    .filter(item => item.bought)
    .reduce((sum, item) => sum + (item.price * parseFloat(item.quantity)), 0);
  
  const budgetLimit = 100; // Could be made configurable
  const progress = (boughtTotal / budgetLimit) * 100;
  
  card.querySelector('#shoppinglist-total').textContent = total.toFixed(2);
  card.querySelector('#shoppinglist-budget-progress').style.width = `${Math.min(100, progress)}%`;
  card.querySelector('#shoppinglist-budget-status').textContent = `$${boughtTotal.toFixed(2)} spent`;
  card.querySelector('#shoppinglist-budget-status').style.color = 
    progress > 80 ? '#ef4444' : progress > 50 ? '#f59e0b' : '#10b981';
}

function saveShoppingItems() {
  try {
    localStorage.setItem('shoppinglist-items', JSON.stringify(shoppingItems));
  } catch (e) {
    // Silently fail if localStorage is not available
  }
}

function showShoppingHint(message, color) {
  const hint = document.querySelector('#shoppinglist-hint');
  if (hint) {
    hint.textContent = message;
    hint.style.color = color;
    setTimeout(() => {
      if (hint.textContent === message) hint.textContent = '';
    }, 3000);
  }
}

function escapeHTML(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function generateShareText() {
  let text = 'ğŸ›’ My Shopping List:\n\n';
  
  const categories = {};
  shoppingItems.forEach(item => {
    if (!categories[item.category]) categories[item.category] = [];
    categories[item.category].push(item);
  });
  
  Object.keys(categories).forEach(category => {
    text += `${getCategoryEmoji(category)} ${category.toUpperCase()}:\n`;
    categories[category].forEach(item => {
      const status = item.bought ? 'âœ…' : 'â¬œ';
      text += `${status} ${item.name} (${item.quantity}) - $${(item.price * parseFloat(item.quantity)).toFixed(2)}\n`;
    });
    text += '\n';
  });
  
  const total = shoppingItems.reduce((sum, item) => sum + (item.price * parseFloat(item.quantity)), 0);
  const bought = shoppingItems.filter(item => item.bought).length;
  
  text += `\nğŸ“Š Summary: ${shoppingItems.length} items â€¢ $${total.toFixed(2)} total â€¢ ${bought} bought`;
  
  return text;
}

function generateCSV() {
  const headers = ['Item', 'Quantity', 'Category', 'Price', 'Total', 'Priority', 'Status'];
  const rows = shoppingItems.map(item => [
    item.name,
    item.quantity,
    item.category,
    item.price.toFixed(2),
    (item.price * parseFloat(item.quantity)).toFixed(2),
    item.priority,
    item.bought ? 'Bought' : 'Pending'
  ]);
  
  return [headers, ...rows]
    .map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
    .join('\n');
}

function generatePrintContent() {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <title>Shopping List</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .title { font-size: 24px; font-weight: bold; color: #667eea; }
        .date { color: #666; margin-bottom: 20px; }
        .item { margin-bottom: 10px; padding: 10px; border-left: 4px solid #667eea; background: #f5f5f5; }
        .bought { text-decoration: line-through; color: #999; }
        .total { font-weight: bold; margin-top: 20px; padding-top: 10px; border-top: 2px solid #333; }
        @media print { body { margin: 0; } }
      </style>
    </head>
    <body>
      <div class="header">
        <div class="title">ğŸ›’ Shopping List</div>
        <div class="date">Generated: ${new Date().toLocaleDateString()}</div>
      </div>
      ${shoppingItems.map(item => `
        <div class="item ${item.bought ? 'bought' : ''}">
          <strong>${item.name}</strong> (${item.quantity})<br>
          Category: ${item.category} â€¢ Price: $${item.price.toFixed(2)} â€¢ Total: $${(item.price * parseFloat(item.quantity)).toFixed(2)}<br>
          Priority: ${item.priority} â€¢ Status: ${item.bought ? 'âœ… Bought' : 'â¬œ Pending'}
        </div>
      `).join('')}
      <div class="total">
        Total Items: ${shoppingItems.length} â€¢ Total Cost: $${shoppingItems.reduce((sum, item) => sum + (item.price * parseFloat(item.quantity)), 0).toFixed(2)}
      </div>
      <script>
        setTimeout(() => { window.print(); window.close(); }, 500);
      <\/script>
    </body>
    </html>
  `;
}

function getCategoryEmoji(category) {
  return {
    'groceries': 'ğŸ›’',
    'household': 'ğŸ ',
    'personal': 'ğŸ‘¤',
    'electronics': 'ğŸ”Œ',
    'other': 'ğŸ“¦'
  }[category] || 'ğŸ“¦';
}

function copyToClipboard(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  document.body.appendChild(textArea);
  textArea.select();
  document.execCommand('copy');
  document.body.removeChild(textArea);
  showShoppingHint('âœ… List copied to clipboard', '#10b981');
}
</script>

<style>
/* Shopping List Styles */
#shoppinglist-title {
  margin-bottom: 8px;
}

/* Button animations */
button {
  transition: all 0.3s ease;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Responsive design */
@media (max-width: 768px) {
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
  
  #shoppinglist-container > div {
    grid-template-columns: 1fr !important;
  }
  
  .results > div:first-child {
    flex-direction: column;
    gap: 8px;
  }
}

/* Loading animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

#shoppinglist-list > div {
  animation: fadeIn 0.3s ease;
}
</style>
