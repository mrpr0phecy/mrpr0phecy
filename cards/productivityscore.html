<h2 id="productivity-score-title">üöÄ Productivity Score</h2>

<form aria-describedby="productivity-score-desc">
    <p id="productivity-score-desc" class="small">
        Calculate and analyze your daily productivity with detailed insights and actionable recommendations.
        <span style="color:var(--accent)">Track progress and optimize your workflow.</span>
    </p>
    
    <!-- SCORE INPUTS -->
    <div style="margin-bottom:20px;padding:16px;background:linear-gradient(135deg, rgba(57,255,20,0.05), rgba(45,212,255,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">üìä Enter Your Daily Metrics</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:16px;">
            <div>
                <label for="ps-tasks" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Tasks Completed
                </label>
                <input id="ps-tasks" type="number" min="0" max="50" step="1" value="8"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Completed tasks today
                </div>
            </div>
            
            <div>
                <label for="ps-focus" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Deep Focus Hours
                </label>
                <input id="ps-focus" type="number" min="0" max="12" step="0.5" value="3.5"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Uninterrupted focus time
                </div>
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
            <div>
                <label for="ps-distractions" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Distractions
                </label>
                <input id="ps-distractions" type="number" min="0" max="20" step="1" value="4"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Interruptions or context switches
                </div>
            </div>
            
            <div>
                <label for="ps-goals" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Goals Achieved (%)
                </label>
                <input id="ps-goals" type="number" min="0" max="100" step="1" value="75"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Percentage of daily goals met
                </div>
            </div>
        </div>
        
        <!-- QUICK PRESETS -->
        <div style="margin-bottom:20px;">
            <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Presets:</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="button" onclick="psLoadPreset('low')" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">üìâ Low Day</button>
                <button type="button" onclick="psLoadPreset('average')" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">üìä Average Day</button>
                <button type="button" onclick="psLoadPreset('high')" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">üìà High Day</button>
                <button type="button" onclick="psLoadPreset('ideal')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">‚ú® Ideal Day</button>
            </div>
        </div>
    </div>
    
    <!-- ADDITIONAL METRICS -->
    <div style="margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1.1rem;">üìà Additional Metrics (Optional)</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="ps-energy" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Energy Level (1-10)
                </label>
                <input id="ps-energy" type="number" min="1" max="10" step="1" value="7"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
            </div>
            
            <div>
                <label for="ps-satisfaction" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Satisfaction (1-10)
                </label>
                <input id="ps-satisfaction" type="number" min="1" max="10" step="1" value="8"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- ACTIONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="psCalculateScore()" 
                style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
            üöÄ Calculate Score
        </button>
        <button type="button" onclick="psResetForm()"
                style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            Reset
        </button>
        <button type="button" onclick="psSaveDay()" id="ps-save-btn"
                style="padding:12px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
            üíæ Save Day
        </button>
    </div>
</form>

<!-- MAIN SCORE DISPLAY -->
<div class="results" aria-live="polite" style="margin-top:16px;">
    <div id="ps-main-score" style="text-align:center;padding:30px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
        <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-bottom:8px;">Today's Productivity Score</div>
        <div id="ps-score-value" style="font-size:72px;font-weight:800;background:linear-gradient(135deg, #39ff14, var(--accent), #9d4edd);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">‚Äì</div>
        <div id="ps-score-label" style="font-size:18px;color:rgba(230,250,255,0.8);margin-top:4px;">Enter values and calculate</div>
    </div>
    
    <!-- DETAILED BREAKDOWN -->
    <div id="ps-breakdown" style="display:none;margin-top:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìä Score Breakdown</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:20px;">
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Task Contribution</div>
                <div id="ps-tasks-score" style="font-size:24px;font-weight:700;color:#39ff14;">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Focus Contribution</div>
                <div id="ps-focus-score" style="font-size:24px;font-weight:700;color:var(--accent);">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Goal Contribution</div>
                <div id="ps-goals-score" style="font-size:24px;font-weight:700;color:#ffa500;">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,77,77,0.1);border-radius:8px;border:1px solid rgba(255,77,77,0.3);">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Distraction Penalty</div>
                <div id="ps-distractions-penalty" style="font-size:24px;font-weight:700;color:#ff2d55;">-0</div>
            </div>
        </div>
    </div>
    
    <!-- ANALYSIS & RECOMMENDATIONS -->
    <div id="ps-analysis" style="display:none;margin-top:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üí° Analysis & Recommendations</h3>
        
        <div id="ps-recommendations" style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
            <div style="color:rgba(230,250,255,0.8);">Calculate your score to see personalized recommendations.</div>
        </div>
    </div>
    
    <!-- PRODUCTIVITY TRENDS -->
    <div id="ps-trends" style="display:none;margin-top:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 class="small" style="color:var(--accent);margin:0;">üìà Weekly Trends</h3>
            <button type="button" onclick="psExportData()" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Export Data</button>
        </div>
        
        <div id="ps-trend-chart" style="height:150px;display:flex;align-items:flex-end;gap:4px;padding:20px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);"></div>
        <div id="ps-trend-labels" style="display:flex;justify-content:space-between;margin-top:8px;font-size:11px;color:rgba(230,250,255,0.7);"></div>
    </div>
</div>

<!-- PRODUCTIVITY INSIGHTS -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(157,78,221,0.05), rgba(45,212,255,0.05));border-radius:8px;border:1px solid rgba(157,78,221,0.3);">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üß† Productivity Insights</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
        <div>
            <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üéØ Task Management</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Break large tasks into smaller steps</li>
                <li>Prioritize using Eisenhower Matrix</li>
                <li>Batch similar tasks together</li>
            </ul>
        </div>
        <div>
            <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">‚è±Ô∏è Focus Techniques</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Use Pomodoro technique (25/5)</li>
                <li>Eliminate digital distractions</li>
                <li>Schedule deep work blocks</li>
            </ul>
        </div>
        <div>
            <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">üìä Measurement</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Track what gets measured</li>
                <li>Review progress weekly</li>
                <li>Adjust goals based on data</li>
            </ul>
        </div>
    </div>
</div>

<script>
/* productivity-score.html
   - Comprehensive productivity scoring and analytics
   - Scoped with ps- prefix
*/

// Data storage
let psHistory = [];
let psCurrentScore = 0;

// Load data from localStorage
function psLoadData() {
    try {
        const savedHistory = localStorage.getItem('ps-productivity-history');
        if (savedHistory) {
            psHistory = JSON.parse(savedHistory);
            psUpdateTrends();
        }
    } catch (e) {
        console.error('Failed to load productivity data:', e);
        psHistory = [];
    }
}

// Save data to localStorage
function psSaveData() {
    try {
        localStorage.setItem('ps-productivity-history', JSON.stringify(psHistory));
    } catch (e) {
        console.error('Failed to save productivity data:', e);
    }
}

// Load preset scenarios
function psLoadPreset(preset) {
    const presets = {
        low: { tasks: 2, focus: 1, distractions: 8, goals: 40, energy: 4, satisfaction: 5 },
        average: { tasks: 5, focus: 2.5, distractions: 5, goals: 65, energy: 6, satisfaction: 6 },
        high: { tasks: 10, focus: 4, distractions: 2, goals: 85, energy: 8, satisfaction: 8 },
        ideal: { tasks: 12, focus: 5, distractions: 1, goals: 95, energy: 9, satisfaction: 9 }
    };
    
    const data = presets[preset];
    if (!data) return;
    
    document.getElementById('ps-tasks').value = data.tasks;
    document.getElementById('ps-focus').value = data.focus;
    document.getElementById('ps-distractions').value = data.distractions;
    document.getElementById('ps-goals').value = data.goals;
    document.getElementById('ps-energy').value = data.energy;
    document.getElementById('ps-satisfaction').value = data.satisfaction;
    
    // Visual feedback
    const inputs = document.querySelectorAll('#ps-tasks, #ps-focus, #ps-distractions, #ps-goals, #ps-energy, #ps-satisfaction');
    inputs.forEach(input => {
        input.style.borderColor = '#9d4edd';
        setTimeout(() => {
            input.style.borderColor = 'rgba(45,212,255,0.3)';
        }, 1000);
    });
    
    psCalculateScore();
}

// Calculate productivity score
function psCalculateScore() {
    // Get input values
    const tasks = parseFloat(document.getElementById('ps-tasks').value) || 0;
    const focus = parseFloat(document.getElementById('ps-focus').value) || 0;
    const distractions = parseFloat(document.getElementById('ps-distractions').value) || 0;
    const goals = parseFloat(document.getElementById('ps-goals').value) || 0;
    const energy = parseFloat(document.getElementById('ps-energy').value) || 5;
    const satisfaction = parseFloat(document.getElementById('ps-satisfaction').value) || 5;
    
    // Calculate individual components (max 100 total)
    const tasksScore = Math.min(30, tasks * 2.5); // Max 30 points
    const focusScore = Math.min(30, focus * 6);   // Max 30 points
    const goalsScore = Math.min(30, goals * 0.3); // Max 30 points
    const distractionsPenalty = Math.min(20, distractions * 1.5); // Max 20 point penalty
    
    // Energy and satisfaction modifiers
    const energyModifier = (energy - 5) * 1.5; // -6 to +7.5
    const satisfactionModifier = (satisfaction - 5) * 1;
    
    // Calculate total score
    let totalScore = tasksScore + focusScore + goalsScore - distractionsPenalty;
    totalScore += energyModifier + satisfactionModifier;
    
    // Clamp between 0-100
    totalScore = Math.max(0, Math.min(100, Math.round(totalScore)));
    psCurrentScore = totalScore;
    
    // Update main score display
    const scoreValue = document.getElementById('ps-score-value');
    const scoreLabel = document.getElementById('ps-score-label');
    
    scoreValue.textContent = totalScore;
    
    // Color code and label based on score
    let color = '#ff2d55';
    let label = 'Needs Improvement';
    let emoji = 'üìâ';
    
    if (totalScore >= 80) {
        color = '#39ff14';
        label = 'Excellent!';
        emoji = 'üöÄ';
    } else if (totalScore >= 60) {
        color = '#ffa500';
        label = 'Good';
        emoji = 'üëç';
    } else if (totalScore >= 40) {
        color = '#ffcc00';
        label = 'Average';
        emoji = 'üìä';
    }
    
    scoreValue.style.background = `linear-gradient(135deg, ${color}, var(--accent))`;
    scoreLabel.textContent = `${emoji} ${label}`;
    scoreLabel.style.color = color;
    
    // Show breakdown section
    document.getElementById('ps-breakdown').style.display = 'block';
    document.getElementById('ps-analysis').style.display = 'block';
    
    // Update breakdown values
    document.getElementById('ps-tasks-score').textContent = Math.round(tasksScore);
    document.getElementById('ps-focus-score').textContent = Math.round(focusScore);
    document.getElementById('ps-goals-score').textContent = Math.round(goalsScore);
    document.getElementById('ps-distractions-penalty').textContent = `-${Math.round(distractionsPenalty)}`;
    
    // Generate recommendations
    psGenerateRecommendations(tasks, focus, distractions, goals, energy, satisfaction, totalScore);
    
    // Show save button
    document.getElementById('ps-save-btn').style.display = 'block';
}

// Generate personalized recommendations
function psGenerateRecommendations(tasks, focus, distractions, goals, energy, satisfaction, totalScore) {
    const recommendations = document.getElementById('ps-recommendations');
    let html = '';
    
    // Overall assessment
    if (totalScore >= 80) {
        html += `<div style="color:#39ff14;font-weight:600;margin-bottom:8px;">üéâ Outstanding Productivity!</div>`;
        html += `<div style="color:rgba(230,250,255,0.9);margin-bottom:12px;">You're crushing it! Keep up the excellent work habits.</div>`;
    } else if (totalScore >= 60) {
        html += `<div style="color:#ffa500;font-weight:600;margin-bottom:8px;">üëç Solid Performance</div>`;
        html += `<div style="color:rgba(230,250,255,0.9);margin-bottom:12px;">Good day! Here's how to reach the next level:</div>`;
    } else {
        html += `<div style="color:#ff2d55;font-weight:600;margin-bottom:8px;">üìà Room for Improvement</div>`;
        html += `<div style="color:rgba(230,250,255,0.9);margin-bottom:12px;">Focus on these areas to boost productivity:</div>`;
    }
    
    // Specific recommendations
    html += `<div style="margin-top:12px;">`;
    
    // Tasks recommendations
    if (tasks < 5) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#39ff14;font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Break tasks into smaller steps. Aim for 5+ completed tasks daily.</div>
        </div>`;
    }
    
    // Focus recommendations
    if (focus < 3) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:var(--accent);font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Schedule 3+ hours of deep focus. Try the Pomodoro technique.</div>
        </div>`;
    }
    
    // Distractions recommendations
    if (distractions > 5) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#ff2d55;font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Reduce distractions. Turn off notifications during focus time.</div>
        </div>`;
    }
    
    // Goals recommendations
    if (goals < 70) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#ffa500;font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Set more achievable daily goals. Celebrate small wins.</div>
        </div>`;
    }
    
    // Energy recommendations
    if (energy < 6) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#9d4edd;font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Prioritize sleep and breaks. Energy management is key.</div>
        </div>`;
    }
    
    // Satisfaction recommendations
    if (satisfaction < 6) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#39ff14;font-size:18px;">‚Ä¢</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Find meaning in your work. Connect tasks to larger goals.</div>
        </div>`;
    }
    
    // Positive reinforcement
    if (tasks >= 8) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:#39ff14;font-size:18px;">‚úÖ</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Great job completing ${tasks} tasks! You're highly productive.</div>
        </div>`;
    }
    
    if (focus >= 4) {
        html += `<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;">
            <div style="color:var(--accent);font-size:18px;">‚úÖ</div>
            <div style="color:rgba(230,250,255,0.9);font-size:13px;">Excellent focus time of ${focus} hours! Deep work pays off.</div>
        </div>`;
    }
    
    html += `</div>`;
    
    recommendations.innerHTML = html;
}

// Save today's score
function psSaveDay() {
    if (psCurrentScore === 0) {
        alert('Calculate a score first!');
        return;
    }
    
    const date = new Date().toISOString().split('T')[0];
    const tasks = parseFloat(document.getElementById('ps-tasks').value) || 0;
    const focus = parseFloat(document.getElementById('ps-focus').value) || 0;
    const distractions = parseFloat(document.getElementById('ps-distractions').value) || 0;
    const goals = parseFloat(document.getElementById('ps-goals').value) || 0;
    const energy = parseFloat(document.getElementById('ps-energy').value) || 5;
    const satisfaction = parseFloat(document.getElementById('ps-satisfaction').value) || 5;
    
    // Check if already saved today
    const existingIndex = psHistory.findIndex(entry => entry.date === date);
    
    const entry = {
        date,
        score: psCurrentScore,
        tasks,
        focus,
        distractions,
        goals,
        energy,
        satisfaction,
        timestamp: new Date().toISOString()
    };
    
    if (existingIndex !== -1) {
        psHistory[existingIndex] = entry;
    } else {
        psHistory.push(entry);
    }
    
    // Keep only last 30 days
    if (psHistory.length > 30) {
        psHistory = psHistory.slice(-30);
    }
    
    // Save and update
    psSaveData();
    psUpdateTrends();
    
    // Show success message
    const saveBtn = document.getElementById('ps-save-btn');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = '‚úÖ Saved!';
    saveBtn.style.background = 'rgba(57,255,20,0.2)';
    saveBtn.style.borderColor = 'rgba(57,255,20,0.4)';
    saveBtn.style.color = '#39ff14';
    
    setTimeout(() => {
        saveBtn.textContent = originalText;
        saveBtn.style.background = 'rgba(45,212,255,0.1)';
        saveBtn.style.borderColor = 'rgba(45,212,255,0.3)';
        saveBtn.style.color = 'var(--accent)';
    }, 2000);
}

// Update trends chart
function psUpdateTrends() {
    const trendChart = document.getElementById('ps-trend-chart');
    const trendLabels = document.getElementById('ps-trend-labels');
    const trendsContainer = document.getElementById('ps-trends');
    
    if (psHistory.length < 2) {
        trendsContainer.style.display = 'none';
        return;
    }
    
    trendsContainer.style.display = 'block';
    
    // Get last 7 days
    const last7Days = psHistory.slice(-7);
    const maxScore = Math.max(...last7Days.map(d => d.score), 100);
    const chartHeight = 150;
    
    let chartHTML = '';
    let labelsHTML = '';
    
    last7Days.forEach((day, index) => {
        const height = (day.score / maxScore) * chartHeight;
        const date = new Date(day.date);
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        const dayNum = date.getDate();
        
        // Color based on score
        let color = '#ff2d55';
        if (day.score >= 80) color = '#39ff14';
        else if (day.score >= 60) color = '#ffa500';
        else if (day.score >= 40) color = '#ffcc00';
        
        chartHTML += `
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;">
                <div style="background:${color};width:80%;border-radius:4px 4px 0 0;"
                     style="height:${Math.max(height, 10)}px;"></div>
                <div style="margin-top:4px;color:${color};font-size:12px;font-weight:600;">${day.score}</div>
            </div>
        `;
        
        labelsHTML += `
            <div style="flex:1;text-align:center;font-size:11px;color:rgba(230,250,255,0.8);">
                ${dayName}<br>${dayNum}
            </div>
        `;
    });
    
    trendChart.innerHTML = chartHTML;
    trendLabels.innerHTML = labelsHTML;
}

// Export data
function psExportData() {
    if (psHistory.length === 0) {
        alert('No productivity data to export');
        return;
    }
    
    // Create CSV content
    let csv = 'Date,Score,Tasks,Focus Hours,Distractions,Goals (%),Energy,Satisfaction\n';
    psHistory.forEach(entry => {
        csv += `"${entry.date}",${entry.score},${entry.tasks},${entry.focus},${entry.distractions},${entry.goals},${entry.energy},${entry.satisfaction}\n`;
    });
    
    // Create download link
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `productivity-data-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Reset form
function psResetForm() {
    document.getElementById('ps-tasks').value = '8';
    document.getElementById('ps-focus').value = '3.5';
    document.getElementById('ps-distractions').value = '4';
    document.getElementById('ps-goals').value = '75';
    document.getElementById('ps-energy').value = '7';
    document.getElementById('ps-satisfaction').value = '8';
    
    // Hide sections
    document.getElementById('ps-breakdown').style.display = 'none';
    document.getElementById('ps-analysis').style.display = 'none';
    document.getElementById('ps-save-btn').style.display = 'none';
    
    // Reset main score
    document.getElementById('ps-score-value').textContent = '‚Äì';
    document.getElementById('ps-score-label').textContent = 'Enter values and calculate';
    document.getElementById('ps-score-value').style.background = 'linear-gradient(135deg, #39ff14, var(--accent), #9d4edd)';
    document.getElementById('ps-score-label').style.color = 'rgba(230,250,255,0.8)';
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Load saved data
        psLoadData();
        
        // Auto-calculate on input change
        const inputs = card.querySelectorAll('input[type="number"]');
        let debounceTimer;
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    // Check if all main inputs have values
                    const tasks = document.getElementById('ps-tasks').value;
                    const focus = document.getElementById('ps-focus').value;
                    if (tasks && focus) {
                        psCalculateScore();
                    }
                }, 500);
            });
        });
        
        // Set today's date in placeholder if needed
        const today = new Date().toISOString().split('T')[0];
        
        console.log('Productivity Score ready');
    });
}
</script>

<style>
@keyframes psPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

#productivity-score-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, #39ff14, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

#ps-main-score {
    animation: psPulse 2s ease-in-out infinite;
}

/* Score color transitions */
#ps-score-value {
    transition: all 0.5s ease;
}

/* Responsive design */
@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    #ps-breakdown > div {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* Hover effects for preset buttons */
button[onclick^="psLoadPreset"]:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}

/* Scrollbar styling for trend chart */
#ps-trend-chart {
    overflow-x: auto;
}

#ps-trend-chart::-webkit-scrollbar {
    height: 6px;
}

#ps-trend-chart::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 3px;
}

#ps-trend-chart::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
}
</style>
