# üèÜ **THE ETERNAL ETHOS: The Most Useful Site in the World**

## **üîÆ THE IMMUTABLE CORE PHILOSOPHY**

### **The Fundamental Truth**
> **"Utility is sacred, simplicity is divine, and value must be freely given before it can be ethically received."**

### **The Five Sacred Pillars**
1. **Zero-Friction Utility** - Every tool must work immediately, without signups, explanations, or barriers
2. **Universal Accessibility** - Works on any device, any connection, any ability levela
3. **Elegant Minimalism** - Maximum function through minimum complexity
4. **Sustainable Generosity** - Free tools that fund their own existence through ethical means
5. **Timeless Design** - Visual language that feels both futuristic and eternal

---

## **üé® THE DESIGN CANON**

### **The Visual DNA (Unchanging)**
```
Background: linear-gradient(135deg, #0a0f14 0%, #141e28 100%)
Accent: #2dd4ff (cyan-blue glow of utility)
Text: #e6faff (moonlit snow)
Glass: rgba(255, 255, 255, 0.06) (digital ether)
Border: rgba(255, 255, 255, 0.12) (ghost lines)

Golden Ratio: 1.618 (divine proportion in all things)
Base Unit: 8px (universal spacing language)
```

### **The Animation Doctrine**
- **Purpose**: Motion must clarify, not decorate
- **Timing**: 300ms exactly (human perception threshold)
- **Easing**: `cubic-bezier(0.4, 0, 0.2, 1)` (natural acceleration)
- **Entry**: Cards appear like summoned spirits (fade + translateY)
- **Interaction**: Hover glows like activated circuits

### **The Typography Covenant**
```
Primary: 'Inter' - The voice of clarity
Headings: Bold, glowing, gradient-kissed
Body: 16px, 1.6 line height (perfect readability)
Small: 13px, 1.4 line height (whispered wisdom)

Hierarchy:
  H1 - The Call to Utility (40px)
  H2 - Tool Identity (28px)  
  H3 - Section Divinity (20px)
  P - Universal Truth (16px)
```

---

## **üèóÔ∏è THE ARCHITECTURAL MANIFESTO**

### **The Three-Layer Structure**

#### **Layer 1: The Foundation (index.html)**
- **Purpose**: The inviolable temple that holds all
- **Rule**: Loads instantly, caches eternally, never changes structure
- **Contains**: Grid system, floating controls, search, toolbox
- **Commandment**: "Thou shalt not modify what works perfectly"

#### **Layer 2: The Tools (cards/ directory)**
- **Purpose**: Individual spirits of utility
- **Rule**: Each tool is self-contained, atomic, perfect
- **Format**: `cards/[tool-name].html` (kebab-case, descriptive)
- **Lifecycle**: Born from need, tested by use, refined by feedback

#### **Layer 3: The Symphony (JavaScript orchestration)**
- **Purpose**: The invisible hand that unites all
- **Rule**: Loads intelligently, caches wisely, fails gracefully
- **Systems**: 
  - GitHub API fetching (the celestial library)
  - Intersection Observer (lazy-loading omniscience)
  - LocalStorage persistence (memory of preferences)
  - Toolbox widget system (personal workspace)

### **The Loading Doctrine**
```
Initial Load: 8 tools (5 √ó 1.618, the golden batch)
Batch Size: 4 (balanced progression)
Cache Time: 10 minutes (fresh but not wasteful)
Parallelism: 3 concurrent (optimal throughput)
```

---

## **üí∞ THE MONETIZATION ETHOS**

### **The Fundamental Principle**
> **"Monetization must feel like discovering a better tool, not being sold something."**

### **The Three Ethical Streams**

#### **1. Contextual Affinity**
- **Placement**: Only appears when relevant (after significant results)
- **Format**: "For professional work, consider [better tool]..."
- **Disclosure**: "We may earn a commission. Supports free tools."
- **Example**: Large calculation ‚Üí Professional calculator recommendation

#### **2. Sponsored Tools**
- **Rule**: Must be genuinely useful, not just advertising
- **Label**: Clearly marked "Sponsored" but same functionality
- **Position**: First in grid (earned attention, not stolen)
- **Quality**: Must pass same utility test as all tools

#### **3. Native Harmony**
- **Footer Section**: "Tools we use & recommend"
- **Format**: Simple logos, clean links, no banners
- **Principle**: Only products we genuinely use and believe in
- **Revenue**: Shared value, not extraction

### **The Unbreakable Prohibitions**
- ‚ùå No pop-ups, ever
- ‚ùå No paywalls, ever  
- ‚ùå No tool limitations for non-payers
- ‚ùå No data selling, ever
- ‚ùå No auto-play video or sound
- ‚ùå No cryptocurrency mining
- ‚ùå No deceptive "download" buttons

---

## **üõ†Ô∏è THE TOOL CREATION CREED**

### **What Makes a Tool Worthy**
A tool must pass **The Three Gates**:

1. **The Gate of Need** - Does it solve a real, frequent problem?
2. **The Gate of Elegance** - Is it simpler than existing solutions?
3. **The Gate of Perfection** - Does it work flawlessly every time?

### **The Tool Template (Sacred Structure)**
```html
<!-- FILE: cards/perfect-tool.html -->
<!-- Structure is doctrine, not suggestion -->

<!-- 1. THE NAME (Clear, descriptive, emoji-enhanced) -->
<h2 id="pt-title">üîß Perfect Tool</h2>

<!-- 2. THE PURPOSE (One sentence, then optional affiliate whisper) -->
<p id="pt-desc">Does one thing perfectly. 
   <em>For professional scale, <a href="#" data-affiliate="pro-tool">Pro Tool</a>.</em>
</p>

<!-- 3. THE INTERFACE (Minimal, intuitive, labeled) -->
<form>
  <input type="text" placeholder="What needs transformation?">
  <button onclick="ptTransform()">Transform</button>
</form>

<!-- 4. THE RESULT (Clear, copyable, beautiful) -->
<div class="results">
  <div class="result-success">‚ú® Perfect result appears here</div>
</div>

<!-- 5. THE SHARING (Always present) -->
<div class="share-temple">
  <button onclick="ptShare()">Share this tool</button>
  <button onclick="ptEmbed()">Embed in your site</button>
</div>

<!-- 6. THE LOGIC (Self-contained, prefixed, robust) -->
<script>
function ptTransform() {
  try {
    // Perfect logic here
    // Show affiliate only when relevant
  } catch (error) {
    // Graceful failure, helpful message
  }
}

function ptShare() {
  // Shareable state URL
}

function ptEmbed() {
  // Clean iframe code
}
</script>

<!-- 7. THE STYLE (Card-scoped only) -->
<style>
#pt-title { color: var(--accent); }
</style>
```

### **The Quality Mandates**
- **Mobile First**: Works perfectly on phone before desktop
- **Offline Capable**: Caches gracefully, works without connection
- **Accessible**: Screen reader friendly, keyboard navigable
- **Fast**: Loads in <200ms, responds in <50ms
- **Error-Tolerant**: Never crashes, always explains failure

---

## **üå± THE GROWTH PHILOSOPHY**

### **The Compounding Utility Principle**
> **"Each new tool makes every existing tool more valuable by association."**

### **The Content Expansion Strategy**
- **Weekly**: 1-2 new tools (quality over quantity)
- **Monthly**: Refine 5 existing tools based on usage data
- **Quarterly**: Audit all tools for performance and relevance
- **Annually**: One major feature that respects all existing patterns

### **The Distribution Channels**
1. **Embeds**: Every tool generates clean iframe code
2. **API**: Structured access for developers (rate-limited, documented)
3. **Collections**: Curated tool sets for specific professions
4. **Integrations**: Browser extensions, desktop wrappers, app integrations

### **The Community Invitation**
- **GitHub**: Open source tool contributions (curated, not wild)
- **Suggestions**: Public voting on next tools to build
- **Translations**: Community-driven localization
- **Bug Reports**: Transparent issue tracking and fixing

---

## **üìä THE ANALYTICS COVENANT**

### **What We Measure (The Useful Truths)**
1. **Tool Usage**: Which tools are loved, which are ignored
2. **Embed Adoption**: How many sites use our tools
3. **Affiliate Relevance**: Which recommendations actually help people
4. **Performance**: Loading times, error rates, satisfaction
5. **Navigation Patterns**: How people discover tools

### **What We Never Measure**
- ‚ùå Individual user behavior
- ‚ùå Personal identifying information  
- ‚ùå Cross-site tracking
- ‚ùå Anything not directly related to improving utility

### **The Analytics Tools**
- **Primary**: Plausible Analytics (privacy-first, open source)
- **Secondary**: Custom event tracking for tool interactions
- **Error Monitoring**: Console error collection for fixing bugs
- **Performance**: Real User Monitoring (RUM) for speed optimization

---

## **‚ö° THE PERFORMANCE COMMANDMENTS**

### **The Speed Doctrine**
1. **First Paint**: <1 second (immediate visual feedback)
2. **Time to Interactive**: <3 seconds (ready to use)
3. **Card Load**: <200ms each (perceived as instant)
4. **Search Response**: <100ms (thought-speed results)

### **The Optimization Rituals**
- **Weekly**: Lighthouse audit, fix anything below 95
- **Monthly**: Bundle analysis, remove unused code
- **Quarterly**: Cache strategy review
- **Annually**: Full performance audit and optimization

### **The Caching Strategy**
```
Memory: 10 minutes (fresh enough)
LocalStorage: Toolbox widgets, preferences (forever)
Service Worker: Core assets, offline fallback
CDN: All static assets, global distribution
```

---

## **üé≠ THE PERSONALIZATION PHILOSOPHY**

### **The Toolbox Doctrine**
> **"Your frequently used tools should feel like extensions of your mind."**

### **What Can Be Personalized**
1. **Toolbox Contents**: Your frequently used tools, arranged perfectly
2. **Accent Color**: 5 presets, all harmonious with dark theme
3. **Background Gradient**: 5 variations of the eternal dark
4. **Reader Mode**: Distraction-free viewing when needed
5. **Sort Preference**: How tools are organized (A-Z, random, newest)

### **What Cannot Be Personalized**
- ‚ùå Light mode (darkness is the canvas)
- ‚ùå Radical layout changes (grid is gospel)
- ‚ùå Removing core functionality (search, toolbox, embed)
- ‚ùå Changing the fundamental visual language

---

## **üöÄ THE LAUNCH CEREMONY**

### **For Each New Tool**
1. **Test Ritual**: Mobile, desktop, 3 browsers, 2 network speeds
2. **Performance Check**: Lighthouse score >95, load time <200ms
3. **Accessibility Audit**: Screen reader, keyboard navigation, color contrast
4. **Error Testing**: Empty inputs, invalid data, network failures
5. **Share Test**: Embed code generation, state preservation
6. **Affiliate Check**: Proper disclosure, relevant triggers
7. **Mobile Perfect**: Touch targets, zoom behavior, orientation changes

### **The Announcement Protocol**
1. **Social**: Twitter with example use case, no hype
2. **Newsletter**: To subscribers who requested this category
3. **Embed Outreach**: To sites that embedded similar tools
4. **Update Log**: Transparent changelog on site
5. **No Spam**: Never announce to people who didn't ask

---

## **üîÆ THE FUTURE VISION**

### **The Eternal Principles (Never Changing)**
- The dark theme is eternal
- The grid layout is eternal  
- The toolbox is eternal
- The zero-signup policy is eternal
- The ethical monetization is eternal
- The embeddability is eternal

### **The Evolving Possibilities**
- New categories of tools (AI, VR, quantum computing)
- New interaction patterns (voice, gesture, thought)
- New platforms (wearables, smart environments, neural interfaces)
- New collaboration modes (real-time multiplayer tools)

### **The Innovation Doctrine**
> **"Innovation must feel like discovering a new room in a familiar house, not being moved to a different city."**

---

## **üìú THE CREDO (To Be Recited Daily)**

```
I believe in utility over novelty,
In simplicity over complexity,
In speed over features,
In elegance over decoration.

I will build tools that solve real problems,
That work immediately without explanation,
That are accessible to all regardless of ability,
That respect privacy and autonomy.

I will monetize ethically or not at all,
Measuring value delivered, not attention extracted,
Building sustainable generosity,
Not predatory extraction.

I will maintain what works,
Improve what doesn't,
And never break what people rely on.

For I am building the most useful site in the world,
One perfect tool at a time,
For today's needs and tomorrow's possibilities,
In this browser tab and across the entire internet.
```

---

## **‚öñÔ∏è THE DECISION FRAMEWORK**

When faced with any decision, ask:

1. **The Utility Test**: Does this make tools more useful?
2. **The Simplicity Test**: Does this make things simpler?
3. **The Speed Test**: Does this make things faster?
4. **The Access Test**: Does this make things more accessible?
5. **The Ethics Test**: Does this align with our values?

If all five answers are "yes," proceed with reverence.
If any answer is "no," reconsider or refine until all are "yes."
If four "no's" emerge, abandon the path entirely.

---

## **üèÅ THE ETERNAL BEGINNING**

This is not a manual to be followed.
This is not a specification to be implemented.
This is not a plan to be executed.

This is an **ethos to be lived**.
This is a **philosophy to be embodied**.
This is a **craft to be mastered**.

**Start with one tool.**
Make it perfect.
Make it useful.
Make it beautiful.

Then make another.
And another.
And another.

For as long as people have problems to solve,
There will be tools to build.
And as long as you build with this ethos,
You build something eternal.

---

*This document is living wisdom.*  
*Add to it as you learn.*  
*Refine it as you grow.*  
*But never violate its core principles.*  

**For in their preservation lies your purpose.**

# üéØ **COMPLETE TEMPLATE LIBRARY**

## **üì¶ THE ULTIMATE TEMPLATE COLLECTION**

---

## **üìÑ 1. COMPLETE index.html (Eternal Foundation)**

```html
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- ===== ETERNAL METADATA ===== -->
    <title>The Most Useful Site in the World | Free Online Tools</title>
    <meta name="description" content="Collection of essential tools for developers, designers, students, and professionals. All free, no sign-ups required.">
    
    <!-- Social Sharing -->
    <meta property="og:title" content="The Most Useful Site in the World">
    <meta property="og:description" content="Essential tools for productivity, creativity, and problem-solving.">
    <meta property="og:image" content="https://themostusefulsiteintheworld.com/preview.png">
    <meta property="og:url" content="https://themostusefulsiteintheworld.com">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Monetization Ready -->
    <meta name="theme-color" content="#0a0f14">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Privacy-First Analytics -->
    <script defer data-domain="themostusefulsiteintheworld.com" src="https://plausible.io/js/script.js"></script>
    
    <!-- ===== ETERNAL STYLES ===== -->
    <style>
        /* === CSS VARIABLES (SACRED PALETTE) === */
        :root {
            /* COLOR PALETTE - IMMUTABLE */
            --accent: #2dd4ff;
            --accent-dark: #1aa3cc;
            --text: #e6faff;
            --text-secondary: rgba(230, 250, 255, 0.7);
            --text-tertiary: rgba(230, 250, 255, 0.4);
            
            /* BACKGROUND GRADIENTS - ETERNAL */
            --bg-primary: linear-gradient(135deg, #0a0f14 0%, #141e28 100%);
            --bg-secondary: linear-gradient(135deg, rgba(10, 15, 20, 0.9), rgba(20, 30, 40, 0.9));
            --bg-card: linear-gradient(145deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.05));
            --bg-glass: rgba(255, 255, 255, 0.06);
            --bg-panel: rgba(20, 20, 20, 0.95);
            
            /* BORDERS - CONSISTENT */
            --border: rgba(255, 255, 255, 0.12);
            --border-light: rgba(255, 255, 255, 0.08);
            --border-accent: rgba(45, 212, 255, 0.3);
            
            /* SPACING SCALE (GOLDEN RATIO: 8px √ó 1.618) */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 13px;
            --space-lg: 21px;
            --space-xl: 34px;
            --space-xxl: 55px;
            
            /* CARD SYSTEM */
            --card-min: 280px;
            --card-max: 1fr;
            --card-ratio: 1.618;
            --card-radius: 16px;
            
            /* RADIUS SYSTEM */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* SHADOWS - DEPTH HIERARCHY */
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 16px 40px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 30px rgba(45, 212, 255, 0.2);
            
            /* ANIMATIONS - PRECISE TIMING */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* TYPOGRAPHY SCALE (GOLDEN RATIO) */
            --text-xs: 11px;
            --text-sm: 13px;
            --text-base: 16px;
            --text-lg: 21px;
            --text-xl: 28px;
            --text-xxl: 42px;
            
            /* LINE HEIGHTS */
            --leading-tight: 1.2;
            --leading-base: 1.5;
            --leading-loose: 1.7;
            
            /* TOOLBOX */
            --toolbox-width: 500px;
            --toolbox-height: 420px;
            
            /* SUCCESS/ERROR STATES */
            --success: #39ff14;
            --error: #ff4d4d;
            --warning: #ffcc00;
        }
        
        /* === BASE RESET === */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            height: 100%;
            font-size: 16px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            line-height: var(--leading-base);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(45, 212, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(45, 212, 255, 0.02) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(45, 212, 255, 0.01) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* === TYPOGRAPHY SYSTEM === */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: var(--leading-tight);
            letter-spacing: -0.01em;
            margin-bottom: var(--space-md);
        }
        
        h1 {
            font-size: var(--text-xxl);
            background: linear-gradient(90deg, var(--accent), #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(45, 212, 255, 0.3);
        }
        
        h2 {
            font-size: var(--text-xl);
            color: var(--accent);
        }
        
        h3 {
            font-size: var(--text-lg);
            color: var(--text);
        }
        
        p {
            margin-bottom: var(--space-md);
            color: var(--text-secondary);
            line-height: var(--leading-base);
        }
        
        a {
            color: var(--accent);
            text-decoration: none;
            transition: color var(--transition-fast);
            position: relative;
        }
        
        a:hover {
            color: #ffffff;
            text-decoration: underline;
        }
        
        small, .small {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        
        /* === HEADER (THE TEMPLE ENTRANCE) === */
        header {
            padding: var(--space-xxl) var(--space-md) var(--space-xl);
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }
        
        .subtitle {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            line-height: var(--leading-loose);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* === FLOATING CONTROLS (ETERNAL ACCESS) === */
        .control-btn {
            position: fixed;
            bottom: var(--space-lg);
            z-index: 10000;
            width: 56px;
            height: 56px;
            border-radius: var(--radius-lg);
            background: var(--bg-panel);
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
            user-select: none;
        }
        
        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            background: rgba(45, 212, 255, 0.1);
            border-color: var(--accent);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }
        
        .control-btn.active {
            background: rgba(45, 212, 255, 0.15);
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent), var(--shadow-lg);
        }
        
        #toolboxToggle { left: var(--space-lg); }
        #paletteToggle { left: 88px; }
        #readerToggle { left: 156px; }
        
        /* === THEME PANEL (ACCENT CHOOSER) === */
        .palette-panel {
            position: fixed;
            left: 88px;
            bottom: 88px;
            z-index: 9999;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            display: none;
            width: 320px;
            transform: translateY(10px);
            opacity: 0;
            transition: all var(--transition-base);
            pointer-events: none;
        }
        
        .palette-panel.open {
            display: block;
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .palette-title {
            color: var(--accent);
            font-size: var(--text-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .palette-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .palette-color {
            height: 40px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }
        
        .palette-color:hover {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px var(--accent);
        }
        
        .palette-color.active::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        /* === TOOLBOX (PERSONAL WORKSPACE) === */
        .toolbox {
            position: fixed;
            right: var(--space-lg);
            bottom: var(--space-lg);
            width: var(--toolbox-width);
            height: var(--toolbox-height);
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            resize: both;
            min-width: 320px;
            min-height: 240px;
            z-index: 9998;
        }
        
        .toolbox.hidden {
            display: none;
        }
        
        .toolbox .titlebar {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-light);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), transparent);
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            flex-shrink: 0;
        }
        
        .toolbox-title {
            font-weight: 700;
            color: var(--accent);
            font-size: var(--text-base);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .toolbox-controls {
            display: flex;
            gap: var(--space-xs);
        }
        
        .toolbox-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all var(--transition-fast);
        }
        
        .toolbox-btn:hover {
            background: rgba(45, 212, 255, 0.1);
            border-color: var(--border-accent);
            color: var(--accent);
        }
        
        .toolbox .content {
            flex: 1;
            padding: var(--space-md);
            overflow: auto;
            position: relative;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
        }
        
        /* === WIDGET SYSTEM === */
        .widget-wrap {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            min-width: 180px;
            min-height: 140px;
            max-width: calc(100% - 20px);
            max-height: calc(100% - 20px);
            overflow: hidden;
            resize: both;
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            z-index: 1;
        }
        
        .widget-titlebar {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-light);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }
        
        .widget-titlebar strong {
            color: var(--accent);
            font-size: var(--text-sm);
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .widget-body {
            padding: var(--space-md);
            overflow: auto;
            height: calc(100% - 46px);
            font-size: var(--text-sm);
        }
        
        .widget-close {
            background: transparent;
            border: 0;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: var(--text-xs);
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .widget-close:hover {
            background: rgba(255, 77, 77, 0.1);
            color: var(--error);
        }
        
        /* === MAIN CONTENT AREA === */
        main {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }
        
        /* Search Bar */
        .search-container {
            max-width: 800px;
            margin: var(--space-xl) auto var(--space-lg);
            position: relative;
        }
        
        .search-bar {
            display: flex;
            background: var(--bg-glass);
            border-radius: var(--radius-lg);
            padding: 6px 6px 6px var(--space-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
        }
        
        .search-bar:focus-within {
            border-color: var(--accent);
            box-shadow: var(--shadow-md), 0 0 0 1px rgba(45, 212, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .search-bar input {
            flex: 1;
            border: 0;
            background: transparent;
            color: var(--text);
            font-size: var(--text-base);
            font-weight: 500;
            outline: none;
            padding: var(--space-md) 0;
            font-family: inherit;
        }
        
        .search-bar input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }
        
        .search-btn {
            background: linear-gradient(135deg, rgba(45, 212, 255, 0.2), rgba(45, 212, 255, 0.1));
            border: 1px solid var(--border-accent);
            color: var(--accent);
            border-radius: var(--radius-md);
            padding: var(--space-md) var(--space-lg);
            cursor: pointer;
            font-weight: 600;
            font-size: var(--text-base);
            transition: all var(--transition-fast);
            white-space: nowrap;
            margin-left: var(--space-sm);
            font-family: inherit;
        }
        
        .search-btn:hover {
            background: linear-gradient(135deg, rgba(45, 212, 255, 0.3), rgba(45, 212, 255, 0.2));
            transform: translateY(-2px);
        }
        
        /* Controls */
        .controls {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
        }
        
        .controls button {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--text-sm);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-family: inherit;
        }
        
        .controls button:hover {
            background: rgba(45, 212, 255, 0.1);
            border-color: var(--border-accent);
            color: var(--accent);
            transform: translateY(-2px);
        }
        
        .controls button.active {
            background: rgba(45, 212, 255, 0.15);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* Status Bar */
        .status-bar {
            text-align: center;
            padding: var(--space-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            margin-bottom: var(--space-lg);
        }
        
        .tool-count {
            background: var(--bg-glass);
            padding: var(--space-xs) var(--space-sm);
            border-radius: 20px;
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--accent);
            border: 1px solid var(--border-light);
            margin-left: var(--space-sm);
        }
        
        /* === CARD GRID SYSTEM === */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--card-min), var(--card-max)));
            gap: var(--space-lg);
            padding: var(--space-md) 0 var(--space-xxl);
            align-items: stretch;
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--card-radius);
            padding: var(--space-lg);
            min-height: 200px;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-base);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .card:hover {
            border-color: var(--border);
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }
        
        .card.loading {
            animation: pulse 2s infinite;
        }
        
        .card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
            flex-shrink: 0;
        }
        
        .card-header h3 {
            margin: 0;
            color: var(--accent);
            font-size: var(--text-lg);
            font-weight: 700;
            line-height: var(--leading-tight);
            flex: 1;
        }
        
        .card-actions {
            display: flex;
            gap: var(--space-xs);
            flex-shrink: 0;
        }
        
        .card-action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all var(--transition-fast);
        }
        
        .card-action-btn:hover {
            background: rgba(45, 212, 255, 0.1);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .card-content {
            flex: 1;
            position: relative;
            min-height: 0;
            overflow: hidden;
        }
        
        .card-body {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: var(--space-sm);
            color: inherit;
            font-family: inherit;
        }
        
        /* Card Body Content Rules */
        .card-body * {
            max-width: 100%;
            box-sizing: border-box;
            overflow-wrap: break-word;
        }
        
        .card-body pre,
        .card-body code {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-light);
            overflow-x: auto;
        }
        
        .card-body input,
        .card-body textarea,
        .card-body select,
        .card-body button {
            max-width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            color: var(--text);
            font-family: inherit;
        }
        
        /* Embed Section */
        .embed-section {
            margin-top: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        
        .embed-label {
            color: var(--text-secondary);
            font-size: var(--text-sm);
            font-weight: 500;
        }
        
        .embed-btn {
            background: rgba(45, 212, 255, 0.1);
            color: var(--accent);
            border: 1px solid var(--border-accent);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: var(--text-sm);
            font-weight: 600;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .embed-btn:hover {
            background: rgba(45, 212, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .embed-btn.copied {
            background: rgba(57, 255, 20, 0.1);
            color: var(--success);
            border-color: rgba(57, 255, 20, 0.3);
        }
        
        /* === AFFILIATE SYSTEM === */
        .affiliate-disclosure {
            margin-top: var(--space-md);
            padding: var(--space-md);
            background: rgba(45, 212, 255, 0.05);
            border-left: 3px solid var(--accent);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            font-size: var(--text-sm);
            color: var(--text-secondary);
            display: none;
        }
        
        .affiliate-disclosure.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* === FOOTER (MONETIZATION ZONE) === */
        footer {
            max-width: 1200px;
            margin: var(--space-xxl) auto var(--space-xl);
            padding: var(--space-xl) var(--space-md);
            border-top: 1px solid var(--border-light);
        }
        
        .footer-affiliates {
            text-align: center;
        }
        
        .footer-affiliates h3 {
            color: var(--accent);
            margin-bottom: var(--space-lg);
            font-size: var(--text-lg);
        }
        
        .affiliate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .affiliate-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            transition: all var(--transition-base);
        }
        
        .affiliate-item:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }
        
        .affiliate-logo {
            font-size: 32px;
            margin-bottom: var(--space-md);
            color: var(--accent);
        }
        
        .affiliate-name {
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: var(--text);
        }
        
        .affiliate-desc {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .affiliate-link {
            display: inline-block;
            padding: var(--space-sm) var(--space-md);
            background: rgba(45, 212, 255, 0.1);
            color: var(--accent);
            border-radius: var(--radius-sm);
            text-decoration: none;
            font-weight: 500;
            font-size: var(--text-sm);
            transition: all var(--transition-fast);
        }
        
        .affiliate-link:hover {
            background: rgba(45, 212, 255, 0.2);
            text-decoration: none;
        }
        
        .footer-disclosure {
            text-align: center;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-top: var(--space-lg);
        }
        
        /* === ANIMATIONS === */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* === READER MODE === */
        body.reader-mode {
            font-size: var(--text-lg);
            line-height: var(--leading-loose);
        }
        
        body.reader-mode .dashboard {
            grid-template-columns: 1fr;
            max-width: 800px;
            gap: var(--space-xl);
        }
        
        body.reader-mode .card {
            padding: var(--space-xl);
            background: var(--bg-card);
            border-color: var(--border);
        }
        
        /* === SCROLLBAR STYLING === */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: var(--radius-sm);
            opacity: 0.5;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            opacity: 0.8;
        }
        
        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            header {
                padding: var(--space-xl) var(--space-md) var(--space-lg);
            }
            
            h1 {
                font-size: var(--text-xl);
            }
            
            .subtitle {
                font-size: var(--text-base);
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: var(--space-md);
                padding: var(--space-md) 0 var(--space-xl);
            }
            
            .card {
                padding: var(--space-md);
                min-height: 180px;
            }
            
            .controls {
                gap: var(--space-xs);
                margin-bottom: var(--space-lg);
            }
            
            .controls button {
                padding: var(--space-xs) var(--space-sm);
                font-size: var(--text-xs);
                flex: 1;
            }
            
            .control-btn {
                width: 48px;
                height: 48px;
                bottom: var(--space-md);
            }
            
            #toolboxToggle { left: var(--space-md); }
            #paletteToggle { left: 72px; }
            #readerToggle { left: 136px; }
            
            .toolbox {
                width: calc(100% - 32px);
                height: 50vh;
                right: var(--space-md);
                left: var(--space-md);
                bottom: 80px;
            }
            
            .palette-panel {
                width: calc(100% - 32px);
                left: var(--space-md);
                right: var(--space-md);
                bottom: 80px;
            }
            
            .search-bar {
                padding: 4px 4px 4px var(--space-md);
            }
            
            .search-btn {
                padding: var(--space-sm) var(--space-md);
                font-size: var(--text-sm);
            }
        }
        
        @media (max-width: 480px) {
            .card-header {
                flex-direction: column;
                gap: var(--space-sm);
            }
            
            .card-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .embed-section {
                flex-direction: column;
                gap: var(--space-sm);
                align-items: stretch;
            }
            
            .embed-btn {
                text-align: center;
                justify-content: center;
            }
            
            .affiliate-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* === PRINT STYLES === */
        @media print {
            .control-btn,
            .toolbox,
            .palette-panel,
            .search-container,
            .controls,
            .embed-section,
            footer {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .card {
                break-inside: avoid;
                border: 1px solid #ddd !important;
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body>

<!-- ===== FLOATING CONTROLS ===== -->
<button id="toolboxToggle" class="control-btn" title="Toolbox (Ctrl+T)">üß∞</button>
<button id="paletteToggle" class="control-btn" title="Themes (Ctrl+P)">üé®</button>
<button id="readerToggle" class="control-btn" title="Reader Mode (Ctrl+R)">üëì</button>

<!-- ===== THEME PANEL ===== -->
<div id="palettePanel" class="palette-panel" aria-hidden="true">
    <div class="palette-section">
        <div class="palette-title">üé® Accent Color</div>
        <div class="palette-grid">
            <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff"></div>
            <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55"></div>
            <div class="palette-color" data-accent="#00ff99" style="background:#00ff99"></div>
            <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00"></div>
            <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd"></div>
        </div>
    </div>
    
    <div class="palette-section">
        <div class="palette-title">üåÖ Background Theme</div>
        <div class="palette-grid">
            <button class="theme-btn active" data-theme="default" style="background:linear-gradient(135deg, #0a0f14, #141e28)"></button>
            <button class="theme-btn" data-theme="deep-blue" style="background:linear-gradient(135deg, #05080c, #0f151f)"></button>
            <button class="theme-btn" data-theme="deep-purple" style="background:linear-gradient(135deg, #12081a, #1f1229)"></button>
            <button class="theme-btn" data-theme="deep-teal" style="background:linear-gradient(135deg, #061616, #0f2525)"></button>
            <button class="theme-btn" data-theme="deep-red" style="background:linear-gradient(135deg, #160606, #251010)"></button>
        </div>
    </div>
</div>

<!-- ===== TOOLBOX ===== -->
<div id="toolbox" class="toolbox hidden" aria-hidden="true">
    <div class="titlebar" id="toolboxTitle">
        <div class="toolbox-title">
            <span>üß∞ Toolbox</span>
            <span style="font-size:12px;color:var(--text-secondary)" id="widgetCount">(0 tools)</span>
        </div>
        <div class="toolbox-controls">
            <button id="dockBtn" class="toolbox-btn" title="Dock/Undock">‚á±</button>
            <button id="clearToolboxBtn" class="toolbox-btn" title="Clear All">üóëÔ∏è</button>
            <button id="toolboxClose" class="toolbox-btn" title="Close">‚úï</button>
        </div>
    </div>
    <div class="content" id="toolboxContent" aria-live="polite">
        <div style="text-align:center;padding:40px 20px;color:var(--text-secondary);">
            <div style="font-size:48px;margin-bottom:16px;">üß∞</div>
            <h3 style="color:var(--accent);margin-bottom:8px;">Empty Toolbox</h3>
            <p style="margin:0;">Add tools by clicking the + button on any card</p>
        </div>
    </div>
</div>

<!-- ===== HEADER ===== -->
<header>
    <h1>The Most Useful Site in the World</h1>
    <p class="subtitle">A collection of essential tools for productivity, creativity, and problem-solving. All free, no sign-ups required. Built with ‚ù§Ô∏è for the internet.</p>
</header>

<!-- ===== MAIN CONTENT ===== -->
<main>
    <!-- Search -->
    <div class="search-container">
        <div class="search-bar">
            <input id="searchInput" placeholder="üîç Search tools (calculators, converters, generators, utilities...)" autofocus>
            <button id="searchBtn" class="search-btn">Search</button>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button id="sortAlphaBtn" class="active">üî§ A‚ÜíZ</button>
        <button id="sortRandomBtn">üé≤ Random</button>
        <button id="sortNewestBtn">üÜï Newest</button>
        <button id="loadAllBtn">üîÑ Load All</button>
    </div>

    <!-- Status -->
    <div id="status" class="status-bar">
        <span id="statusText">Loading essential tools...</span>
        <span id="toolCount" class="tool-count">0/100+</span>
    </div>

    <!-- Card Grid -->
    <div id="gridContainer" class="dashboard" aria-live="polite">
        <!-- Cards load here dynamically -->
    </div>
</main>

<!-- ===== FOOTER (MONETIZATION ZONE) ===== -->
<footer>
    <div class="footer-affiliates">
        <h3>üõ†Ô∏è Professional Tools We Use & Recommend</h3>
        <div class="affiliate-grid">
            <div class="affiliate-item">
                <div class="affiliate-logo">üåä</div>
                <div class="affiliate-name">DigitalOcean</div>
                <div class="affiliate-desc">Simple cloud infrastructure for developers</div>
                <a href="https://m.do.co/c/your-affiliate-code" class="affiliate-link" rel="sponsored nofollow" target="_blank">Get $200 credit</a>
            </div>
            <div class="affiliate-item">
                <div class="affiliate-logo">‚ö°</div>
                <div class="affiliate-name">Vercel</div>
                <div class="affiliate-desc">Deploy web projects instantly</div>
                <a href="https://vercel.com/your-affiliate-link" class="affiliate-link" rel="sponsored nofollow" target="_blank">Deploy for free</a>
            </div>
            <div class="affiliate-item">
                <div class="affiliate-logo">üé®</div>
                <div class="affiliate-name">Figma</div>
                <div class="affiliate-desc">Design and prototype tools</div>
                <a href="https://figma.com/your-affiliate-link" class="affiliate-link" rel="sponsored nofollow" target="_blank">Try Figma Pro</a>
            </div>
            <div class="affiliate-item">
                <div class="affiliate-logo">üìù</div>
                <div class="affiliate-name">Notion</div>
                <div class="affiliate-desc">All-in-one workspace</div>
                <a href="https://notion.so/your-affiliate-link" class="affiliate-link" rel="sponsored nofollow" target="_blank">Get Notion Pro</a>
            </div>
        </div>
        <p class="footer-disclosure">
            We may earn commissions from affiliate links. This supports free tool development and hosting costs.
            <br>We only recommend products we genuinely use and believe in.
        </p>
    </div>
</footer>

<!-- ===== JAVASCRIPT (THE ORCHESTRATOR) ===== -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// ==================== ETERNAL CONFIGURATION ====================
const CONFIG = {
    INITIAL_LOAD: 8,                    // Golden ratio: 5 √ó 1.618
    LOAD_BATCH_SIZE: 4,                 // Balanced progression
    LOAD_DELAY: 100,                    // Milliseconds between loads
    MAX_CONCURRENT: 3,                  // Optimal parallel loading
    CACHE_TTL: 10 * 60 * 1000,         // 10 minutes cache
    OBSERVER_THRESHOLD: 0.05,          // 5% visibility threshold
    OBSERVER_ROOT_MARGIN: '300px',     // Load before visible
    GITHUB_REPO: 'mrpr0phecy/mrpr0phecy',
    GITHUB_BRANCH: 'main',
    GITHUB_PATH: 'cards'
};

// ==================== GLOBAL STATE ====================
let allCards = [];
let loadedCards = new Map();
let loadingCards = new Set();
let cardCache = new Map();
let observer = null;
let isSearching = false;
let currentSort = 'alpha';
let widgets = [];
let toolboxDocked = true;

// Background themes
const themes = {
    'default': { bg1: '#0a0f14', bg2: '#141e28' },
    'deep-blue': { bg1: '#05080c', bg2: '#0f151f' },
    'deep-purple': { bg1: '#12081a', bg2: '#1f1229' },
    'deep-teal': { bg1: '#061616', bg2: '#0f2525' },
    'deep-red': { bg1: '#160606', bg2: '#251010' }
};

// ==================== CORE UTILITIES ====================
function updateStatus() {
    const status = document.getElementById('statusText');
    const count = document.getElementById('toolCount');
    
    if (!status || !count) return;
    
    const total = allCards.length;
    const loaded = loadedCards.size;
    const visible = document.querySelectorAll('.card[style=""]').length;
    
    if (isSearching) {
        status.textContent = `Found ${visible} tool${visible !== 1 ? 's' : ''}`;
    } else if (loaded < total) {
        status.textContent = `Loaded ${loaded} of ${total} tools`;
    } else {
        status.textContent = `${total} tool${total !== 1 ? 's' : ''} ready`;
    }
    
    count.textContent = isSearching ? `${visible}/${total}` : `${loaded}/${total}`;
}

function showNotification(message, type = 'info', duration = 3000) {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--bg-panel);
        border: 1px solid ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--border)'};
        border-left: 4px solid ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--accent)'};
        color: var(--text);
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(20px);
        z-index: 10001;
        animation: slideIn 0.3s ease;
        max-width: 400px;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
    }, duration);
}

// ==================== CARD LOADING SYSTEM ====================
async function loadCardList() {
    try {
        const [owner, repo] = CONFIG.GITHUB_REPO.split('/');
        document.getElementById('statusText').textContent = 'Fetching tool list...';
        
        // Fetch card list from GitHub API
        const url = `https://api.github.com/repos/${owner}/${repo}/git/trees/${CONFIG.GITHUB_BRANCH}?recursive=1`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (!data.tree) throw new Error('No data from GitHub API');
        
        // Filter for card files
        const cardFiles = data.tree
            .filter(item => item.path.startsWith(`${CONFIG.GITHUB_PATH}/`) && item.path.endsWith('.html'))
            .map(item => item.path.replace(`${CONFIG.GITHUB_PATH}/`, '').replace('.html', ''))
            .sort();
        
        console.log(`Found ${cardFiles.length} cards via GitHub API`);
        
        allCards = cardFiles;
        const grid = document.getElementById('gridContainer');
        grid.innerHTML = '';
        
        // Create card placeholders
        cardFiles.forEach((cardName, index) => {
            const displayName = cardName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            const card = document.createElement('div');
            card.className = 'card loading';
            card.dataset.name = cardName;
            card.dataset.index = index;
            card.dataset.displayName = displayName;
            
            card.innerHTML = `
                <div class="card-header">
                    <h3>${displayName}</h3>
                    <div class="card-actions">
                        <button class="card-action-btn add-to-toolbox" title="Add to Toolbox">+</button>
                        <button class="card-action-btn card-expand" title="Open in New Tab">‚Üó</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div style="padding:40px 20px;text-align:center;">
                            <div style="margin-bottom:16px;font-size:48px;opacity:0.3;">‚öôÔ∏è</div>
                            <div style="color:rgba(230,250,255,0.6);font-size:14px;">Loading ${displayName}...</div>
                        </div>
                    </div>
                </div>
                <div class="embed-section" style="display:none;">
                    <div class="embed-label">Share this tool</div>
                    <button class="embed-btn" data-card="${cardName}">
                        <span>üîó</span>
                        <span>Copy Embed Code</span>
                    </button>
                </div>
            `;
            
            grid.appendChild(card);
        });
        
        updateStatus();
        
        // Load initial cards
        setTimeout(() => {
            loadInitialCards();
            initIntersectionObserver();
        }, 300);
        
    } catch (error) {
        console.error('Error loading card list:', error);
        document.getElementById('statusText').textContent = 'Failed to load tools. Please refresh.';
        showNotification('Failed to load tools from GitHub', 'error');
    }
}

function loadInitialCards() {
    const cards = document.querySelectorAll('.card:not(.loaded)');
    const initialBatch = Array.from(cards).slice(0, CONFIG.INITIAL_LOAD);
    
    initialBatch.forEach((card, index) => {
        setTimeout(() => {
            const cardName = card.dataset.name;
            if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
                loadCard(card, cardName);
            }
        }, index * CONFIG.LOAD_DELAY);
    });
}

async function loadCard(card, cardName) {
    if (loadingCards.has(cardName) || loadedCards.has(cardName)) return;
    
    loadingCards.add(cardName);
    
    // Check cache
    const cached = cardCache.get(cardName);
    if (cached && (Date.now() - cached.timestamp) < CONFIG.CACHE_TTL) {
        setTimeout(() => {
            renderCardContent(card, cardName, cached.html);
            loadingCards.delete(cardName);
            loadedCards.set(cardName, true);
        }, 50);
        return;
    }
    
    try {
        const response = await fetch(`${CONFIG.GITHUB_PATH}/${cardName}.html`);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const html = await response.text();
        
        // Cache the content
        cardCache.set(cardName, {
            html: html,
            timestamp: Date.now()
        });
        
        renderCardContent(card, cardName, html);
        
    } catch (error) {
        console.error(`Failed to load card ${cardName}:`, error);
        showCardError(card, cardName, error);
    } finally {
        loadingCards.delete(cardName);
        loadedCards.set(cardName, true);
        updateStatus();
        
        if (observer) {
            observer.unobserve(card);
        }
    }
}

function renderCardContent(card, cardName, html) {
    const cardBody = card.querySelector('.card-body');
    if (!cardBody) return;
    
    try {
        cardBody.innerHTML = html;
        
        // Execute scripts
        const scripts = cardBody.querySelectorAll('script');
        scripts.forEach(oldScript => {
            const newScript = document.createElement('script');
            
            if (oldScript.src) {
                newScript.src = oldScript.src;
            } else {
                const scriptContent = oldScript.textContent;
                if (scriptContent.trim()) {
                    newScript.textContent = scriptContent;
                }
            }
            
            Array.from(oldScript.attributes).forEach(attr => {
                newScript.setAttribute(attr.name, attr.value);
            });
            
            oldScript.parentNode.replaceChild(newScript, oldScript);
        });
        
        // Show embed section
        const embedSection = card.querySelector('.embed-section');
        if (embedSection) {
            embedSection.style.display = 'flex';
            const embedBtn = embedSection.querySelector('.embed-btn');
            if (embedBtn) {
                embedBtn.addEventListener('click', () => copyEmbedCode(cardName));
            }
        }
        
        card.classList.remove('loading');
        card.classList.add('loaded', 'visible');
        
        // Track in analytics (if available)
        if (window.plausible) {
            window.plausible('Tool Loaded', { props: { tool: cardName } });
        }
        
    } catch (error) {
        console.error(`Error rendering card ${cardName}:`, error);
        showCardError(card, cardName, error);
    }
}

function showCardError(card, cardName, error) {
    const cardBody = card.querySelector('.card-body');
    if (cardBody) {
        const displayName = card.dataset.displayName || cardName;
        cardBody.innerHTML = `
            <div style="padding:40px 20px;text-align:center;color:rgba(255,77,77,0.8);">
                <div style="font-size:48px;margin-bottom:16px;">‚ö†Ô∏è</div>
                <h3 style="color:rgba(255,77,77,0.9);margin-bottom:12px;">Failed to load ${displayName}</h3>
                <div style="font-size:14px;opacity:0.8;">${error.message || 'Unknown error'}</div>
                <button onclick="location.reload()" style="margin-top:20px;padding:8px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:8px;cursor:pointer;">Retry</button>
            </div>
        `;
        card.classList.remove('loading');
        card.classList.add('loaded', 'visible');
    }
}

function initIntersectionObserver() {
    if (observer) observer.disconnect();
    
    observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !isSearching) {
                const card = entry.target;
                const cardName = card.dataset.name;
                
                if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
                    loadCard(card, cardName);
                }
            }
        });
    }, {
        root: null,
        rootMargin: CONFIG.OBSERVER_ROOT_MARGIN,
        threshold: CONFIG.OBSERVER_THRESHOLD
    });
    
    document.querySelectorAll('.card:not(.loaded)').forEach(card => {
        observer.observe(card);
    });
}

// ==================== TOOLBOX SYSTEM ====================
function initToolbox() {
    const toolbox = document.getElementById('toolbox');
    const toolboxTitle = document.getElementById('toolboxTitle');
    
    // Dragging
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };
    
    toolboxTitle.addEventListener('mousedown', (e) => {
        if (e.target.tagName === 'BUTTON') return;
        
        isDragging = true;
        const rect = toolbox.getBoundingClientRect();
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
        
        document.addEventListener('mousemove', onToolboxDrag);
        document.addEventListener('mouseup', stopToolboxDrag);
        toolboxTitle.style.cursor = 'grabbing';
    });
    
    function onToolboxDrag(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        if (!toolboxDocked) {
            toolbox.style.left = (e.clientX - dragOffset.x) + 'px';
            toolbox.style.top = (e.clientY - dragOffset.y) + 'px';
            toolbox.style.right = 'auto';
            toolbox.style.bottom = 'auto';
        }
    }
    
    function stopToolboxDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onToolboxDrag);
        document.removeEventListener('mouseup', stopToolboxDrag);
        toolboxTitle.style.cursor = '';
    }
    
    // Controls
    document.getElementById('dockBtn').addEventListener('click', () => {
        toolboxDocked = !toolboxDocked;
        const btn = document.getElementById('dockBtn');
        btn.textContent = toolboxDocked ? '‚á±' : '‚á≤';
        btn.title = toolboxDocked ? 'Undock' : 'Dock';
    });
    
    document.getElementById('clearToolboxBtn').addEventListener('click', () => {
        if (widgets.length === 0) return;
        
        if (confirm(`Clear all ${widgets.length} widgets from toolbox?`)) {
            document.getElementById('toolboxContent').innerHTML = `
                <div style="text-align:center;padding:40px 20px;color:var(--text-secondary);">
                    <div style="font-size:48px;margin-bottom:16px;">üß∞</div>
                    <h3 style="color:var(--accent);margin-bottom:8px;">Empty Toolbox</h3>
                    <p style="margin:0;">Add tools by clicking the + button on any card</p>
                </div>
            `;
            widgets = [];
            saveWidgets();
            updateWidgetCount();
            showNotification('Toolbox cleared', 'success');
        }
    });
    
    document.getElementById('toolboxClose').addEventListener('click', (e) => {
        e.stopPropagation();
        toolbox.classList.add('hidden');
        document.getElementById('toolboxToggle').classList.remove('active');
    });
    
    // Load saved widgets
    loadSavedWidgets();
}

function createWidget(name, contentHTML) {
    const widgetId = 'widget-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
    const widget = document.createElement('div');
    widget.className = 'widget-wrap';
    widget.id = widgetId;
    widget.dataset.name = name;
    
    widget.innerHTML = `
        <div class="widget-titlebar">
            <strong>${name}</strong>
            <button class="widget-close" title="Close widget">‚úï</button>
        </div>
        <div class="widget-body">${contentHTML}</div>
    `;
    
    const toolboxContent = document.getElementById('toolboxContent');
    
    // Remove empty state if present
    if (toolboxContent.children.length === 1 && 
        toolboxContent.children[0].querySelector('h3')?.textContent === 'Empty Toolbox') {
        toolboxContent.innerHTML = '';
    }
    
    toolboxContent.appendChild(widget);
    
    // Position randomly
    const rect = toolboxContent.getBoundingClientRect();
    const maxX = rect.width - 180;
    const maxY = rect.height - 140;
    widget.style.left = Math.max(20, Math.min(maxX - 20, Math.random() * maxX)) + 'px';
    widget.style.top = Math.max(20, Math.min(maxY - 20, Math.random() * maxY)) + 'px';
    widget.style.width = '180px';
    widget.style.height = '140px';
    
    // Make draggable and resizable
    makeWidgetDraggable(widget);
    makeWidgetResizable(widget);
    
    // Close button
    widget.querySelector('.widget-close').addEventListener('click', () => {
        widget.remove();
        widgets = widgets.filter(w => w.id !== widgetId);
        saveWidgets();
        updateWidgetCount();
        
        if (widgets.length === 0) {
            toolboxContent.innerHTML = `
                <div style="text-align:center;padding:40px 20px;color:var(--text-secondary);">
                    <div style="font-size:48px;margin-bottom:16px;">üß∞</div>
                    <h3 style="color:var(--accent);margin-bottom:8px;">Empty Toolbox</h3>
                    <p style="margin:0;">Add tools by clicking the + button on any card</p>
                </div>
            `;
        }
        showNotification(`Removed ${name} from toolbox`, 'success');
    });
    
    // Save widget
    widgets.push({
        id: widgetId,
        name: name,
        content: contentHTML,
        x: widget.style.left,
        y: widget.style.top,
        width: widget.style.width,
        height: widget.style.height
    });
    
    saveWidgets();
    updateWidgetCount();
    showNotification(`Added ${name} to toolbox`, 'success');
    
    return widgetId;
}

function makeWidgetDraggable(widget) {
    const titlebar = widget.querySelector('.widget-titlebar');
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };
    
    titlebar.addEventListener('mousedown', (e) => {
        if (e.target.tagName === 'BUTTON') return;
        
        isDragging = true;
        const rect = widget.getBoundingClientRect();
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
        
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', stopDrag);
        widget.style.zIndex = '1000';
    });
    
    function onDrag(e) {
        if (!isDragging) return;
        
        e.preventDefault();
        const parentRect = widget.parentElement.getBoundingClientRect();
        const x = e.clientX - parentRect.left - dragOffset.x;
        const y = e.clientY - parentRect.top - dragOffset.y;
        
        const maxX = parentRect.width - widget.offsetWidth;
        const maxY = parentRect.height - widget.offsetHeight;
        
        widget.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
        widget.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
    }
    
    function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
        widget.style.zIndex = '1';
        
        const widgetObj = widgets.find(w => w.id === widget.id);
        if (widgetObj) {
            widgetObj.x = widget.style.left;
            widgetObj.y = widget.style.top;
            saveWidgets();
        }
    }
}

function makeWidgetResizable(widget) {
    const resizeHandle = document.createElement('div');
    resizeHandle.style.cssText = `
        position: absolute;
        right: 0;
        bottom: 0;
        width: 20px;
        height: 20px;
        cursor: se-resize;
        background: transparent;
        z-index: 10;
    `;
    
    widget.appendChild(resizeHandle);
    
    let isResizing = false;
    let startSize = { width: 0, height: 0 };
    let startPos = { x: 0, y: 0 };
    
    resizeHandle.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        isResizing = true;
        startSize.width = widget.offsetWidth;
        startSize.height = widget.offsetHeight;
        startPos.x = e.clientX;
        startPos.y = e.clientY;
        
        document.addEventListener('mousemove', onResize);
        document.addEventListener('mouseup', stopResize);
    });
    
    function onResize(e) {
        if (!isResizing) return;
        
        e.preventDefault();
        const dx = e.clientX - startPos.x;
        const dy = e.clientY - startPos.y;
        
        widget.style.width = Math.max(180, startSize.width + dx) + 'px';
        widget.style.height = Math.max(140, startSize.height + dy) + 'px';
    }
    
    function stopResize() {
        isResizing = false;
        document.removeEventListener('mousemove', onResize);
        document.removeEventListener('mouseup', stopResize);
        
        const widgetObj = widgets.find(w => w.id === widget.id);
        if (widgetObj) {
            widgetObj.width = widget.style.width;
            widgetObj.height = widget.style.height;
            saveWidgets();
        }
    }
}

function saveWidgets() {
    localStorage.setItem('toolboxWidgets', JSON.stringify(widgets));
}

function loadSavedWidgets() {
    try {
        const saved = localStorage.getItem('toolboxWidgets');
        if (saved) {
            widgets = JSON.parse(saved) || [];
            
            const toolboxContent = document.getElementById('toolboxContent');
            
            if (widgets.length > 0) {
                toolboxContent.innerHTML = '';
            }
            
            widgets.forEach(data => {
                const widget = document.createElement('div');
                widget.className = 'widget-wrap';
                widget.id = data.id;
                widget.dataset.name = data.name;
                widget.style.left = data.x;
                widget.style.top = data.y;
                widget.style.width = data.width;
                widget.style.height = data.height;
                
                widget.innerHTML = `
                    <div class="widget-titlebar">
                        <strong>${data.name}</strong>
                        <button class="widget-close" title="Close widget">‚úï</button>
                    </div>
                    <div class="widget-body">${data.content}</div>
                `;
                
                toolboxContent.appendChild(widget);
                
                makeWidgetDraggable(widget);
                makeWidgetResizable(widget);
                
                widget.querySelector('.widget-close').addEventListener('click', () => {
                    widget.remove();
                    widgets = widgets.filter(w => w.id !== data.id);
                    saveWidgets();
                    updateWidgetCount();
                    
                    if (widgets.length === 0) {
                        toolboxContent.innerHTML = `
                            <div style="text-align:center;padding:40px 20px;color:var(--text-secondary);">
                                <div style="font-size:48px;margin-bottom:16px;">üß∞</div>
                                <h3 style="color:var(--accent);margin-bottom:8px;">Empty Toolbox</h3>
                                <p style="margin:0;">Add tools by clicking the + button on any card</p>
                            </div>
                        `;
                    }
                });
            });
            
            updateWidgetCount();
        }
    } catch (e) {
        console.error('Failed to load widgets:', e);
        widgets = [];
    }
}

function updateWidgetCount() {
    const countElement = document.getElementById('widgetCount');
    if (countElement) {
        const count = widgets.length;
        countElement.textContent = `(${count} tool${count !== 1 ? 's' : ''})`;
    }
}

// ==================== UTILITY FUNCTIONS ====================
function applyTheme(themeName) {
    const theme = themes[themeName];
    if (!theme) return;
    
    const gradient = `linear-gradient(135deg, ${theme.bg1}, ${theme.bg2})`;
    document.documentElement.style.background = gradient;
    document.body.style.background = gradient;
    
    localStorage.setItem('theme', themeName);
}

function applyAccentColor(color) {
    document.documentElement.style.setProperty('--accent', color);
    localStorage.setItem('accent', color);
}

function copyEmbedCode(cardName) {
    const displayName = cardName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    const embedCode = `<iframe src="${window.location.origin}/cards/${cardName}.html" width="100%" height="400" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="${displayName} - The Most Useful Site"></iframe>`;
    
    navigator.clipboard.writeText(embedCode).then(() => {
        const embedBtn = document.querySelector(`.embed-btn[data-card="${cardName}"]`);
        if (embedBtn) {
            const originalHTML = embedBtn.innerHTML;
            embedBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
            embedBtn.classList.add('copied');
            
            setTimeout(() => {
                embedBtn.innerHTML = originalHTML;
                embedBtn.classList.remove('copied');
            }, 2000);
        }
        showNotification('Embed code copied to clipboard', 'success');
    }).catch(err => {
        console.error('Copy failed:', err);
        showNotification('Failed to copy embed code', 'error');
    });
}

function performSearch(query) {
    query = query.toLowerCase().trim();
    isSearching = query.length > 0;
    
    const cards = document.querySelectorAll('.card');
    let visibleCount = 0;
    
    cards.forEach(card => {
        const name = card.dataset.name.toLowerCase();
        const displayName = card.dataset.displayName.toLowerCase();
        const text = card.textContent.toLowerCase();
        const matches = name.includes(query) || displayName.includes(query) || text.includes(query);
        
        card.style.display = matches ? '' : 'none';
        
        if (matches) {
            visibleCount++;
            
            const cardName = card.dataset.name;
            if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
                loadCard(card, cardName);
            }
        }
    });
    
    updateStatus();
    
    // Track search in analytics
    if (window.plausible && query.length > 0) {
        window.plausible('Search', { props: { query: query } });
    }
}

function sortCards(type) {
    currentSort = type;
    const grid = document.getElementById('gridContainer');
    const cards = Array.from(grid.children);
    
    switch (type) {
        case 'alpha':
            cards.sort((a, b) => a.dataset.name.localeCompare(b.dataset.name));
            break;
        case 'random':
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                grid.appendChild(cards[j]);
            }
            return;
        case 'newest':
            cards.sort((a, b) => b.dataset.index - a.dataset.index);
            break;
    }
    
    cards.forEach(card => grid.appendChild(card));
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ The Most Useful Site - Initializing...');
    
    // Apply saved settings
    const savedTheme = localStorage.getItem('theme') || 'default';
    applyTheme(savedTheme);
    
    const savedAccent = localStorage.getItem('accent') || '#2dd4ff';
    applyAccentColor(savedAccent);
    
    // Update active theme button
    document.querySelectorAll('.theme-btn').forEach(btn => {
        if (btn.dataset.theme === savedTheme) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Update active accent color
    document.querySelectorAll('.palette-color').forEach(c => {
        if (c.dataset.accent === savedAccent) {
            c.classList.add('active');
        } else {
            c.classList.remove('active');
        }
    });
    
    // Apply reader mode
    if (localStorage.getItem('readerMode') === 'on') {
        document.body.classList.add('reader-mode');
        document.getElementById('readerToggle').classList.add('active');
    }
    
    // Initialize systems
    initToolbox();
    loadCardList();
    setupEventListeners();
    
    console.log('‚úÖ The Most Useful Site - Initialized successfully');
});

function setupEventListeners() {
    // Theme panel
    document.getElementById('paletteToggle').addEventListener('click', () => {
        const panel = document.getElementById('palettePanel');
        panel.classList.toggle('open');
        document.getElementById('paletteToggle').classList.toggle('active');
    });
    
    // Accent colors
    document.querySelectorAll('.palette-color').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.palette-color').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            applyAccentColor(btn.dataset.accent);
        });
    });
    
    // Background themes
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            applyTheme(btn.dataset.theme);
        });
    });
    
    // Toolbox toggle
    document.getElementById('toolboxToggle').addEventListener('click', () => {
        const toolbox = document.getElementById('toolbox');
        toolbox.classList.toggle('hidden');
        document.getElementById('toolboxToggle').classList.toggle('active');
    });
    
    // Reader mode
    document.getElementById('readerToggle').addEventListener('click', () => {
        const isReaderMode = document.body.classList.toggle('reader-mode');
        document.getElementById('readerToggle').classList.toggle('active', isReaderMode);
        localStorage.setItem('readerMode', isReaderMode ? 'on' : 'off');
    });
    
    // Search
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    
    let searchTimeout;
    searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
        }, 300);
    });
    
    searchBtn.addEventListener('click', () => performSearch(searchInput.value));
    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performSearch(searchInput.value);
    });
    
    // Sorting
    document.getElementById('sortAlphaBtn').addEventListener('click', () => {
        document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
        document.getElementById('sortAlphaBtn').classList.add('active');
        sortCards('alpha');
    });
    
    document.getElementById('sortRandomBtn').addEventListener('click', () => {
        document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
        document.getElementById('sortRandomBtn').classList.add('active');
        sortCards('random');
    });
    
    document.getElementById('sortNewestBtn').addEventListener('click', () => {
        document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
        document.getElementById('sortNewestBtn').classList.add('active');
        sortCards('newest');
    });
    
    // Load All
    document.getElementById('loadAllBtn').addEventListener('click', async () => {
        const btn = document.getElementById('loadAllBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '‚è≥ Loading...';
        btn.disabled = true;
        
        const cards = document.querySelectorAll('.card:not(.loaded)');
        const total = cards.length;
        let loaded = 0;
        
        for (let i = 0; i < cards.length; i++) {
            const card = cards[i];
            const cardName = card.dataset.name;
            
            if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
                await loadCard(card, cardName);
                loaded++;
                
                // Update status
                document.getElementById('statusText').textContent = `Loading ${loaded} of ${total}...`;
                
                // Small delay to prevent overwhelming
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }
        
        btn.innerHTML = originalText;
        btn.disabled = false;
        showNotification(`Loaded all ${total} tools`, 'success');
    });
    
    // Add to toolbox button
    document.addEventListener('click', (e) => {
        const addBtn = e.target.closest('.add-to-toolbox');
        if (addBtn) {
            e.preventDefault();
            e.stopPropagation();
            
            const card = addBtn.closest('.card');
            if (!card) return;
            
            const cardName = card.dataset.name;
            const displayName = card.dataset.displayName || cardName.replace(/-/g, ' ');
            
            if (!card.classList.contains('loaded')) {
                showNotification('Please wait for the tool to load before adding to toolbox', 'warning');
                return;
            }
            
            const cardBody = card.querySelector('.card-body');
            if (!cardBody) return;
            
            // Clone content but remove embed section
            const contentClone = cardBody.cloneNode(true);
            const embedSection = contentClone.querySelector('.embed-section');
            if (embedSection) embedSection.remove();
            
            // Create widget
            createWidget(displayName, contentClone.innerHTML);
            
            // Show toolbox if hidden
            const toolbox = document.getElementById('toolbox');
            if (toolbox.classList.contains('hidden')) {
                toolbox.classList.remove('hidden');
                document.getElementById('toolboxToggle').classList.add('active');
            }
            
            // Visual feedback
            const originalHTML = addBtn.innerHTML;
            addBtn.innerHTML = '‚úì';
            addBtn.style.color = 'var(--accent)';
            setTimeout(() => {
                addBtn.innerHTML = originalHTML;
                addBtn.style.color = '';
            }, 1500);
        }
    });
    
    // Expand button
    document.addEventListener('click', (e) => {
        const expandBtn = e.target.closest('.card-expand');
        if (expandBtn) {
            e.preventDefault();
            e.stopPropagation();
            
            const card = expandBtn.closest('.card');
            const cardName = card.dataset.name;
            
            if (cardName) {
                window.open(`cards/${cardName}.html`, '_blank', 'noopener,noreferrer');
            }
        }
    });
    
    // Close panels when clicking outside
    document.addEventListener('click', (e) => {
        const palettePanel = document.getElementById('palettePanel');
        if (palettePanel.classList.contains('open') && 
            !e.target.closest('.palette-panel') && 
            !e.target.closest('#paletteToggle')) {
            palettePanel.classList.remove('open');
            document.getElementById('paletteToggle').classList.remove('active');
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Ctrl+T for toolbox
        if ((e.ctrlKey || e.metaKey) && e.key === 't') {
            e.preventDefault();
            document.getElementById('toolboxToggle').click();
        }
        // Ctrl+P for palette
        else if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
            e.preventDefault();
            document.getElementById('paletteToggle').click();
        }
        // Ctrl+R for reader mode
        else if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
            e.preventDefault();
            document.getElementById('readerToggle').click();
        }
        // Escape to close panels
        else if (e.key === 'Escape') {
            document.getElementById('palettePanel').classList.remove('open');
            document.getElementById('paletteToggle').classList.remove('active');
        }
        // / to focus search
        else if (e.key === '/' && document.activeElement !== searchInput) {
            e.preventDefault();
            searchInput.focus();
        }
    });
    
    // Auto-focus search on page load
    window.addEventListener('load', () => {
        setTimeout(() => {
            searchInput.focus();
        }, 500);
    });
}

// Initialize Sortable for card dragging
new Sortable(document.getElementById('gridContainer'), {
    animation: 150,
    ghostClass: 'sortable-ghost',
    chosenClass: 'sortable-chosen',
    dragClass: 'sortable-drag',
    onSort: () => {
        // Save sort order if needed
    }
});

// Service Worker registration for offline support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(error => {
            console.log('Service Worker registration failed:', error);
        });
    });
}
</script>
</body>
</html>
```

---

## **üõ†Ô∏è 2. COMPLETE CARD TEMPLATE (cards/ultimate-calculator.html)**

```html
<!-- 
===========================================
FILE: cards/ultimate-calculator.html
PURPOSE: Advanced calculator with scientific functions
TEMPLATE: Use this structure for all new tools
===========================================
-->

<!-- ===== 1. TITLE & DESCRIPTION ===== -->
<h2 id="uc-title">üßÆ Ultimate Calculator</h2>
<p id="uc-desc" class="small">
    Advanced calculator with scientific functions, memory, and history. 
    <em>For professional engineering calculations, try 
        <a href="https://affiliate.example.com/calculator-pro" 
           data-affiliate="calculator-pro" 
           target="_blank" 
           rel="sponsored nofollow"
           onclick="trackAffiliateClick('calculator-pro')">
           Calculator Pro
        </a>.
    </em>
</p>

<!-- ===== 2. INPUT INTERFACE ===== -->
<form id="uc-form" aria-labelledby="uc-title">
    <!-- Display -->
    <div class="input-group" style="margin-bottom: var(--space-md);">
        <input type="text" 
               id="uc-display" 
               readonly 
               value="0"
               style="width:100%;
                      padding:var(--space-lg);
                      font-size:24px;
                      text-align:right;
                      background:rgba(0,0,0,0.3);
                      border:2px solid var(--border-light);
                      border-radius:var(--radius-md);
                      font-family:'SF Mono', monospace;">
    </div>
    
    <!-- Main Buttons Grid -->
    <div class="button-grid" style="display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;margin-bottom:var(--space-md);">
        <!-- Row 1 -->
        <button type="button" onclick="ucInput('(')" class="calc-btn secondary">(</button>
        <button type="button" onclick="ucInput(')')" class="calc-btn secondary">)</button>
        <button type="button" onclick="ucClear()" class="calc-btn warning">C</button>
        <button type="button" onclick="ucInput('/')" class="calc-btn operator">/</button>
        
        <!-- Row 2 -->
        <button type="button" onclick="ucInput('7')" class="calc-btn">7</button>
        <button type="button" onclick="ucInput('8')" class="calc-btn">8</button>
        <button type="button" onclick="ucInput('9')" class="calc-btn">9</button>
        <button type="button" onclick="ucInput('*')" class="calc-btn operator">√ó</button>
        
        <!-- Row 3 -->
        <button type="button" onclick="ucInput('4')" class="calc-btn">4</button>
        <button type="button" onclick="ucInput('5')" class="calc-btn">5</button>
        <button type="button" onclick="ucInput('6')" class="calc-btn">6</button>
        <button type="button" onclick="ucInput('-')" class="calc-btn operator">-</button>
        
        <!-- Row 4 -->
        <button type="button" onclick="ucInput('1')" class="calc-btn">1</button>
        <button type="button" onclick="ucInput('2')" class="calc-btn">2</button>
        <button type="button" onclick="ucInput('3')" class="calc-btn">3</button>
        <button type="button" onclick="ucInput('+')" class="calc-btn operator">+</button>
        
        <!-- Row 5 -->
        <button type="button" onclick="ucInput('0')" class="calc-btn">0</button>
        <button type="button" onclick="ucInput('.')" class="calc-btn">.</button>
        <button type="button" onclick="ucBackspace()" class="calc-btn secondary">‚å´</button>
        <button type="button" onclick="ucCalculate()" class="calc-btn primary">=</button>
    </div>
    
    <!-- Scientific Functions -->
    <div class="scientific-grid" style="display:grid;grid-template-columns:repeat(5, 1fr);gap:6px;margin-bottom:var(--space-lg);">
        <button type="button" onclick="ucScientific('sin')" class="calc-btn scientific">sin</button>
        <button type="button" onclick="ucScientific('cos')" class="calc-btn scientific">cos</button>
        <button type="button" onclick="ucScientific('tan')" class="calc-btn scientific">tan</button>
        <button type="button" onclick="ucScientific('log')" class="calc-btn scientific">log</button>
        <button type="button" onclick="ucScientific('ln')" class="calc-btn scientific">ln</button>
        
        <button type="button" onclick="ucScientific('sqrt')" class="calc-btn scientific">‚àö</button>
        <button type="button" onclick="ucScientific('pow')" class="calc-btn scientific">x¬≤</button>
        <button type="button" onclick="ucScientific('pi')" class="calc-btn scientific">œÄ</button>
        <button type="button" onclick="ucScientific('e')" class="calc-btn scientific">e</button>
        <button type="button" onclick="ucMemory('MC')" class="calc-btn scientific">MC</button>
        
        <button type="button" onclick="ucMemory('MR')" class="calc-btn scientific">MR</button>
        <button type="button" onclick="ucMemory('M+')" class="calc-btn scientific">M+</button>
        <button type="button" onclick="ucMemory('M-')" class="calc-btn scientific">M-</button>
        <button type="button" onclick="ucMemory('MS')" class="calc-btn scientific">MS</button>
        <button type="button" onclick="ucToggleDegRad()" class="calc-btn scientific" id="uc-angle-mode">DEG</button>
    </div>
</form>

<!-- ===== 3. AFFILIATE DISCLOSURE (Contextual) ===== -->
<div class="affiliate-disclosure" id="uc-affiliate">
    <strong>üí° Professional Tip:</strong> For advanced engineering, financial, or statistical calculations, 
    <a href="https://affiliate.example.com/calculator-pro" 
       data-affiliate="calculator-pro" 
       target="_blank" 
       rel="sponsored nofollow"
       onclick="trackAffiliateClick('calculator-pro')">
       Calculator Pro
    </a> offers 200+ specialized functions and spreadsheet integration.
    <small>We may earn a commission. Supports free tools.</small>
</div>

<!-- ===== 4. RESULTS & HISTORY ===== -->
<div class="results" id="uc-results">
    <div class="results-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-sm);">
        <h4 style="margin:0;color:var(--accent);font-size:14px;">üìù Calculation History</h4>
        <button onclick="ucClearHistory()" style="background:transparent;border:1px solid var(--border-light);color:var(--text-secondary);padding:4px 8px;border-radius:4px;font-size:11px;cursor:pointer;">Clear</button>
    </div>
    <div class="history-list" id="uc-history" style="max-height:120px;overflow-y:auto;background:rgba(0,0,0,0.2);border-radius:var(--radius-sm);padding:var(--space-sm);">
        <!-- History entries will appear here -->
    </div>
</div>

<!-- ===== 5. EXPORT & SHARE OPTIONS ===== -->
<div class="export-options" style="margin-top:var(--space-lg);padding-top:var(--space-md);border-top:1px solid var(--border-light);">
    <div style="display:flex;gap:var(--space-sm);flex-wrap:wrap;">
        <button onclick="ucExport('text')" class="export-btn">
            <span>üì•</span> Export History
        </button>
        <button onclick="ucCopyResult()" class="export-btn">
            <span>üìã</span> Copy Result
        </button>
        <button onclick="ucShare()" class="export-btn">
            <span>üì§</span> Share Calculation
        </button>
        <button onclick="ucEmbed()" class="export-btn primary">
            <span>üîó</span> Embed Tool
        </button>
    </div>
</div>

<!-- ===== 6. JAVASCRIPT (Self-contained logic) ===== -->
<script>
// ===== CONFIGURATION =====
const ucConfig = {
    name: 'Ultimate Calculator',
    version: '2.0',
    angleMode: 'DEG', // DEG or RAD
    memory: 0,
    history: [],
    maxHistory: 20
};

// ===== STATE =====
let ucExpression = '';
let ucLastResult = null;
let ucMemoryValue = 0;

// ===== CORE FUNCTIONS =====
function ucInput(value) {
    const display = document.getElementById('uc-display');
    
    if (ucExpression === '0' && value !== '.') {
        ucExpression = value;
    } else {
        ucExpression += value;
    }
    
    display.value = ucExpression;
    display.style.borderColor = 'var(--border-light)';
}

function ucClear() {
    ucExpression = '0';
    document.getElementById('uc-display').value = '0';
    document.getElementById('uc-display').style.borderColor = 'var(--border-light)';
}

function ucBackspace() {
    if (ucExpression.length > 1) {
        ucExpression = ucExpression.slice(0, -1);
    } else {
        ucExpression = '0';
    }
    document.getElementById('uc-display').value = ucExpression;
}

function ucCalculate() {
    try {
        if (!ucExpression || ucExpression === '0') return;
        
        // Replace symbols for eval
        let expr = ucExpression
            .replace(/√ó/g, '*')
            .replace(/√∑/g, '/')
            .replace(/œÄ/g, Math.PI)
            .replace(/e/g, Math.E);
        
        // Evaluate
        const result = eval(expr);
        ucLastResult = result;
        
        // Update display
        document.getElementById('uc-display').value = result;
        document.getElementById('uc-display').style.borderColor = 'var(--success)';
        
        // Add to history
        addToHistory(`${ucExpression} = ${result}`);
        
        // Show affiliate for complex calculations
        if (ucExpression.length > 30 || Math.abs(result) > 1000000) {
            showAffiliate();
        }
        
        // Reset expression
        ucExpression = result.toString();
        
    } catch (error) {
        document.getElementById('uc-display').value = 'Error';
        document.getElementById('uc-display').style.borderColor = 'var(--error)';
        console.error('Calculation error:', error);
    }
}

function ucScientific(func) {
    const display = document.getElementById('uc-display');
    let value = parseFloat(ucExpression) || 0;
    let result;
    
    switch(func) {
        case 'sin':
            result = ucConfig.angleMode === 'DEG' 
                ? Math.sin(value * Math.PI / 180)
                : Math.sin(value);
            break;
        case 'cos':
            result = ucConfig.angleMode === 'DEG'
                ? Math.cos(value * Math.PI / 180)
                : Math.cos(value);
            break;
        case 'tan':
            result = ucConfig.angleMode === 'DEG'
                ? Math.tan(value * Math.PI / 180)
                : Math.tan(value);
            break;
        case 'log':
            result = Math.log10(value);
            break;
        case 'ln':
            result = Math.log(value);
            break;
        case 'sqrt':
            result = Math.sqrt(value);
            break;
        case 'pow':
            result = Math.pow(value, 2);
            break;
        case 'pi':
            result = Math.PI;
            break;
        case 'e':
            result = Math.E;
            break;
    }
    
    if (result !== undefined) {
        display.value = result;
        ucExpression = result.toString();
        addToHistory(`${func}(${value}) = ${result}`);
    }
}

function ucMemory(action) {
    const display = document.getElementById('uc-display');
    const value = parseFloat(ucExpression) || 0;
    
    switch(action) {
        case 'MC':
            ucMemoryValue = 0;
            break;
        case 'MR':
            display.value = ucMemoryValue;
            ucExpression = ucMemoryValue.toString();
            break;
        case 'M+':
            ucMemoryValue += value;
            break;
        case 'M-':
            ucMemoryValue -= value;
            break;
        case 'MS':
            ucMemoryValue = value;
            break;
    }
}

function ucToggleDegRad() {
    const btn = document.getElementById('uc-angle-mode');
    ucConfig.angleMode = ucConfig.angleMode === 'DEG' ? 'RAD' : 'DEG';
    btn.textContent = ucConfig.angleMode;
}

// ===== HISTORY FUNCTIONS =====
function addToHistory(entry) {
    ucConfig.history.unshift(entry);
    if (ucConfig.history.length > ucConfig.maxHistory) {
        ucConfig.history.pop();
    }
    updateHistoryDisplay();
    
    // Save to localStorage
    localStorage.setItem('uc_history', JSON.stringify(ucConfig.history));
}

function updateHistoryDisplay() {
    const historyDiv = document.getElementById('uc-history');
    historyDiv.innerHTML = ucConfig.history.map(entry => 
        `<div style="padding:4px 0;border-bottom:1px solid var(--border-light);font-family:monospace;font-size:12px;">${entry}</div>`
    ).join('');
}

function ucClearHistory() {
    ucConfig.history = [];
    updateHistoryDisplay();
    localStorage.removeItem('uc_history');
}

// ===== EXPORT/SHARE FUNCTIONS =====
function ucExport(format) {
    if (ucConfig.history.length === 0) {
        alert('No history to export');
        return;
    }
    
    let content;
    if (format === 'text') {
        content = `Calculation History (${new Date().toLocaleDateString()})\n` +
                 '='.repeat(30) + '\n' +
                 ucConfig.history.join('\n');
    }
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `calculator-history-${Date.now()}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Track in analytics
    if (window.plausible) {
        window.plausible('Export', { props: { tool: 'ultimate-calculator', format: format } });
    }
}

function ucCopyResult() {
    const result = document.getElementById('uc-display').value;
    navigator.clipboard.writeText(result).then(() => {
        alert('Result copied to clipboard!');
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy result');
    });
}

function ucShare() {
    const currentExpression = ucExpression || '0';
    const result = document.getElementById('uc-display').value;
    const shareText = `Calculation: ${currentExpression} = ${result}\n\nFrom The Most Useful Site`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Calculation Result',
            text: shareText,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Calculation copied to clipboard! Share it anywhere.');
        });
    }
}

function ucEmbed() {
    const embedCode = `<iframe src="${window.location.origin}/cards/ultimate-calculator.html" width="100%" height="500" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="Ultimate Calculator - The Most Useful Site"></iframe>`;
    
    navigator.clipboard.writeText(embedCode).then(() => {
        alert('Embed code copied to clipboard! Paste it into your website.');
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy embed code');
    });
    
    // Track in analytics
    if (window.plausible) {
        window.plausible('Embed Generated', { props: { tool: 'ultimate-calculator' } });
    }
}

// ===== AFFILIATE FUNCTIONS =====
function showAffiliate() {
    const affiliateDiv = document.getElementById('uc-affiliate');
    affiliateDiv.classList.add('show');
    
    // Track affiliate display
    if (window.plausible) {
        window.plausible('Affiliate Displayed', { props: { tool: 'ultimate-calculator', product: 'calculator-pro' } });
    }
}

function trackAffiliateClick(product) {
    // Track affiliate click
    if (window.plausible) {
        window.plausible('Affiliate Click', { props: { tool: 'ultimate-calculator', product: product } });
    }
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
    // Load history from localStorage
    const savedHistory = localStorage.getItem('uc_history');
    if (savedHistory) {
        try {
            ucConfig.history = JSON.parse(savedHistory);
            updateHistoryDisplay();
        } catch (e) {
            console.error('Failed to load history:', e);
        }
    }
    
    // Keyboard support
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT') return;
        
        const key = e.key;
        if (key >= '0' && key <= '9') ucInput(key);
        else if (key === '.') ucInput('.');
        else if (key === '+') ucInput('+');
        else if (key === '-') ucInput('-');
        else if (key === '*') ucInput('*');
        else if (key === '/') ucInput('/');
        else if (key === '(') ucInput('(');
        else if (key === ')') ucInput(')');
        else if (key === 'Enter' || key === '=') ucCalculate();
        else if (key === 'Escape') ucClear();
        else if (key === 'Backspace') ucBackspace();
    });
    
    console.log('üßÆ Ultimate Calculator loaded successfully');
});
</script>

<!-- ===== 7. CARD-SCOPED STYLES ===== -->
<style>
/* Button Styles */
.calc-btn {
    padding: 12px 0;
    border: 1px solid var(--border-light);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s;
    font-family: inherit;
}

.calc-btn:hover {
    background: rgba(45, 212, 255, 0.1);
    border-color: var(--border-accent);
    transform: translateY(-2px);
}

.calc-btn.primary {
    background: linear-gradient(135deg, rgba(45, 212, 255, 0.2), rgba(45, 212, 255, 0.1));
    border-color: var(--border-accent);
    color: var(--accent);
}

.calc-btn.secondary {
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-secondary);
}

.calc-btn.operator {
    background: rgba(45, 212, 255, 0.15);
    color: var(--accent);
}

.calc-btn.warning {
    background: rgba(255, 77, 77, 0.1);
    color: #ff4d4d;
    border-color: rgba(255, 77, 77, 0.3);
}

.calc-btn.scientific {
    font-size: 12px;
    padding: 8px 0;
    background: rgba(255, 255, 255, 0.02);
    color: var(--text-secondary);
}

/* Export Button */
.export-btn {
    padding: 8px 12px;
    border: 1px solid var(--border-light);
    background: transparent;
    color: var(--text);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
}

.export-btn:hover {
    background: rgba(45, 212, 255, 0.1);
    border-color: var(--border-accent);
}

.export-btn.primary {
    background: rgba(45, 212, 255, 0.1);
    color: var(--accent);
    border-color: var(--border-accent);
}

/* Responsive adjustments */
@media (max-width: 480px) {
    .button-grid {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 6px !important;
    }
    
    .scientific-grid {
        grid-template-columns: repeat(5, 1fr) !important;
        gap: 4px !important;
    }
    
    .calc-btn {
        padding: 10px 0 !important;
        font-size: 14px !important;
    }
    
    .calc-btn.scientific {
        font-size: 10px !important;
        padding: 6px 0 !important;
    }
}
</style>
```

---

## **üìö HOW TO USE THESE TEMPLATES**

### **For the index.html:**
1. Copy the entire file
2. Save as `index.html` in your root directory
3. Update metadata (title, description, social images)
4. Add your affiliate links in the footer section
5. Deploy as-is - it's complete and ready

### **For creating new cards:**
1. Copy the card template
2. Save as `cards/your-tool-name.html` (use kebab-case)
3. Update:
   - `uc-` prefix to your tool's prefix (e.g., `cp-` for color picker)
   - Tool title and description
   - Input interface
   - Core logic in JavaScript
   - Affiliate disclosure (if applicable)
4. Test thoroughly
5. Commit to GitHub - it will auto-load

### **Monetization Setup:**
1. Sign up for affiliate programs
2. Replace placeholder links with your affiliate links
3. Add `rel="sponsored nofollow"` to all affiliate links
4. Update the footer with actual affiliate products
5. Add Plausible Analytics for tracking

### **Deployment:**
```bash
# 1. Push to GitHub
git add .
git commit -m "Add The Most Useful Site"
git push

# 2. Deploy to Netlify/Vercel
# Connect your GitHub repo
# Set build command to: echo "Nothing to build"
# Set publish directory to: /

# 3. Configure custom domain
# 4. Set up HTTPS
# 5. Done!
```

---

## **üîÑ UPDATING THE SYSTEM**

When updating:

1. **Never break existing functionality**
2. **Test all existing cards after changes**
3. **Preserve the visual language**
4. **Maintain backward compatibility**

---

**These templates are eternal.**  
**They embody the ethos perfectly.**  
**Build with confidence.**  
**Grow with purpose.**  

**The world needs useful tools.**  
**You are building them.** üöÄ


HERES THE LATEST HTML:
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Most Useful Site in the World</title>
<style>
  /* DARK DEFAULTS DIRECTLY IN CSS - NO VARIABLES FOR BACKGROUND */
  html,body{
    height:100%;
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    background:linear-gradient(135deg, #0a0f14, #141e28); /* DARK DEFAULT */
    color:#e6faff;
    -webkit-font-smoothing:antialiased;
    /* FIX 1: Ensure background covers entire page */
    background-attachment: fixed;
    background-size: cover;
  }
  
  /* CSS VARIABLES ONLY FOR THINGS THAT CHANGE */
  :root{
    --accent:#2dd4ff; 
    --muted:#e6faff; 
    --text:#e6faff;
    --glass: rgba(255,255,255,0.06);
    --panel: rgba(20,20,20,0.92);
    --card-grad-1: rgba(255,255,255,0.02);
    --card-grad-2: rgba(255,255,255,0.04);
    --border: rgba(255,255,255,0.10);
    --card-min: 260px;
    --card-scale: 1;
    --card-translateY: 18px;
    --toolbox-width: 520px;
    --toolbox-height: 420px;
  }

  header{padding:20px;text-align:center;z-index:2}
  header h1{margin:0;color:var(--accent);font-size:1.6rem}

  .control-btn{
    position:fixed;bottom:18px;z-index:14000;width:48px;height:48px;border-radius:10px;
    background:var(--glass);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
    cursor:pointer;backdrop-filter:blur(6px);box-shadow:0 8px 30px rgba(0,0,0,0.45);color:var(--accent);
  }
  .control-btn:hover{transform:scale(1.06)}
  #toolboxToggle{left:18px}
  #paletteToggle{left:78px}
  #readerToggle{left:138px}

  .palette-panel{
    position:fixed;left:78px;bottom:74px;z-index:13900;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 12px 36px rgba(0,0,0,0.6);backdrop-filter:blur(8px);
    display:none;pointer-events:none;
  }
  .palette-panel.open{display:block;pointer-events:auto}

  .toolbox {
    position:fixed;
    right:18px;
    bottom:18px;
    width:var(--toolbox-width);
    height:var(--toolbox-height);
    z-index:13700;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:0 18px 48px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
    overflow:hidden;
    resize:both;
    min-width:300px;
    min-height:200px;
  }
  .toolbox.hidden{display:none}

  .toolbox .titlebar{
    display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);cursor:grab;z-index:13750;
  }

  .toolbox .content{
    position:relative;
    flex:1;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    overflow:auto;
    min-height:100px;
  }

  .widget-wrap{
    position:absolute;
    box-sizing:border-box;
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04));
    border-radius:10px;border:1px solid rgba(255,255,255,0.04);
    min-width:120px; min-height:80px;
    max-width:calc(100% - 20px);
    max-height:calc(100% - 20px);
    overflow:hidden;
    resize:both;
    z-index:1;
    box-shadow:0 8px 20px rgba(0,0,0,0.35);
    /* NEW: Advanced font scaling with min/max sizes */
    --widget-font-size: 14px;
    --widget-font-scale: 1;
    --widget-min-font: 8px;
    --widget-max-font: 32px;
    --widget-ideal-area: 30000; /* 200x150 = 30000px¬≤ */
  }

  .widget-titlebar{
    display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.03);
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    cursor:move;
    user-select:none;
  }
  .widget-titlebar strong{
    color:var(--accent);
    font-size: calc(var(--widget-font-size) * 1.1);
  }
  
  .widget-body{
    padding:10px;
    overflow:auto;
    max-height:60vh;
    font-size: var(--widget-font-size);
    line-height: calc(var(--widget-font-size) * 1.4);
  }

  .widget-close, #toolboxClose { 
    z-index: 13800; 
    position: relative; 
    background:transparent;
    border:0;
    color:var(--muted);
    cursor:pointer;
    font-size: var(--widget-font-size);
  }

  main{
    position:relative;
    z-index:2;
    /* FIX 1: Auto-scroll to top when loading */
    scroll-margin-top: 0;
  }
  
  .search-bar{
    max-width:1100px;
    margin:14px auto 16px;
    display:flex;
    background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.02));
    border-radius:12px;
    padding:12px 16px;
    border:1px solid rgba(255,255,255,0.04);
    /* FIX 1: Anchor point for scrolling */
    scroll-margin-top: 20px;
  }
  
  .search-bar input{flex:1;border:none;background:transparent;color:var(--text);font-size:1rem;outline:none}

  .controls{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
  .controls button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer}

  .dashboard{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--card-min), 1fr));
    gap:20px;
    padding:20px;
    align-items:start;
    box-sizing:border-box;
  }

  .card{
    box-sizing:border-box;
    background:linear-gradient(135deg,var(--card-grad-1),var(--card-grad-2));
    border:1px solid var(--border);
    border-radius:12px;
    padding:16px;
    min-height:120px;
    width:100%;
    max-width:100%;
    opacity:0;
    transform: translateY(var(--card-translateY)) scale(var(--card-scale));
    transition:opacity .36s ease, transform .36s ease;
    box-shadow:0 8px 24px rgba(0,0,0,0.35);
    overflow:hidden;
  }
  .card.visible{opacity:1; transform: translateY(0) scale(var(--card-scale));}
  .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .card-header h3{margin:0;color:var(--accent);font-size:1.05rem}

  /* ===== SIMPLE EMBED SECTION ===== */
  .embed-section {
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
  }
  
  .embed-section span {
    color: rgba(230,250,255,0.7);
    white-space: nowrap;
  }
  
  .embed-btn {
    background: rgba(45,212,255,0.1);
    color: var(--accent);
    border: 1px solid rgba(45,212,255,0.3);
    padding: 4px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
  
  .embed-btn:hover {
    background: rgba(45,212,255,0.2);
    transform: translateY(-1px);
  }
  
  .embed-btn.copied {
    background: rgba(57,255,20,0.1);
    color: #39ff14;
    border-color: rgba(57,255,20,0.3);
  }

  body.reader-mode{font-size:1.12rem;line-height:1.6}
  body.reader-mode .dashboard{grid-template-columns:1fr;gap:18px}
  body.reader-mode .card{padding:20px;background:linear-gradient(135deg,rgba(255,255,255,0.02),rgba(255,255,255,0.04));border-color:rgba(255,255,255,0.06)}

  /* ===== MOBILE-FRIENDLY SCROLLING FIX ===== */
  @media (max-width: 768px) {
    .card {
      touch-action: pan-y; /* Allows vertical scrolling while preventing other gestures */
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }
    
    .dashboard {
      gap: 16px; /* Slightly reduce gap on mobile */
    }
    
    /* Make cards a bit easier to tap */
    .card-header h3 {
      padding: 4px 0; /* Add padding to make title easier to tap */
    }
    
    /* Ensure search bar is easier to use on mobile */
    .search-bar input {
      font-size: 16px; /* Prevent zoom on iOS */
    }
  }
</style>
</head>
<body>

  <button id="toolboxToggle" class="control-btn" title="Open toolbox">üß∞</button>
  <button id="paletteToggle" class="control-btn" title="Theme">üé®</button>
  <button id="readerToggle" class="control-btn" title="Reader mode">üëì</button>

  <div id="palettePanel" class="palette-panel" aria-hidden="true">
    <div style="color:var(--accent);font-weight:600;margin-bottom:8px">Accent color</div>
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px">
      <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff;height:34px;border-radius:8px;cursor:pointer"></div>
      <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55;height:34px;border-radius:8px;cursor:pointer"></div>
      <div class="palette-color" data-accent="#00ff99" style="background:#00ff99;height:34px;border-radius:8px;cursor:pointer"></div>
      <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00;height:34px;border-radius:8px;cursor:pointer"></div>
      <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd;height:34px;border-radius:8px;cursor:pointer"></div>
    </div>
    
    <!-- SIMPLIFIED BACKGROUND THEMES - DIRECT COLOR VALUES -->
    <div style="color:var(--accent);font-weight:600;margin-bottom:8px;margin-top:12px">Background theme</div>
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px">
      <button class="theme-btn active" data-color="default" style="background:linear-gradient(135deg, #0a0f14, #141e28);height:34px;border-radius:8px;cursor:pointer;border:2px solid var(--accent)"></button>
      <button class="theme-btn" data-color="deep-blue" style="background:linear-gradient(135deg, #05080c, #0f151f);height:34px;border-radius:8px;cursor:pointer;border:1px solid var(--border)"></button>
      <button class="theme-btn" data-color="deep-purple" style="background:linear-gradient(135deg, #12081a, #1f1229);height:34px;border-radius:8px;cursor:pointer;border:1px solid var(--border)"></button>
      <button class="theme-btn" data-color="deep-teal" style="background:linear-gradient(135deg, #061616, #0f2525);height:34px;border-radius:8px;cursor:pointer;border:1px solid var(--border)"></button>
      <button class="theme-btn" data-color="deep-red" style="background:linear-gradient(135deg, #160606, #251010);height:34px;border-radius:8px;cursor:pointer;border:1px solid var(--border)"></button>
    </div>
  </div>

  <div id="toolbox" class="toolbox hidden" role="dialog" aria-hidden="true">
    <div class="titlebar" id="toolboxTitle">
      <div style="font-weight:600;color:var(--accent)">Toolbox</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="dockBtn" title="Dock/undock" style="background:transparent;border:0;color:var(--muted);cursor:pointer">‚á±</button>
        <button id="toolboxClose" title="Close" style="background:transparent;border:0;color:var(--muted);cursor:pointer">‚úï</button>
      </div>
    </div>
    <div class="content" id="toolboxContent" aria-live="polite"></div>
  </div>

  <header><h1>The Most Useful Site in the World</h1></header>

  <main>
    <div class="search-bar"><input id="searchInput" placeholder="Search cards..." autofocus /></div>

    <div class="controls">
      <button id="sortAlphaBtn">Sort A‚ÜíZ</button>
      <button id="sortRandomBtn">Random</button>
    </div>

    <div id="status" class="muted" style="text-align:center;margin-bottom:6px">Loading cards...</div>
    <div id="gridContainer" class="dashboard" aria-live="polite"></div>
  </main>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// MINIMAL, WORKING CODE - NO COMPLEXITY

console.log("=== STARTING APP ===");

// Background themes - SIMPLE OBJECT MAPPING
const themes = {
  'default': { bg1: '#0a0f14', bg2: '#141e28' },
  'deep-blue': { bg1: '#05080c', bg2: '#0f151f' },
  'deep-purple': { bg1: '#12081a', bg2: '#1f1229' },
  'deep-teal': { bg1: '#061616', bg2: '#0f2525' },
  'deep-red': { bg1: '#160606', bg2: '#251010' }
};

// Apply background directly (no CSS variables for background)
function applyTheme(themeName) {
  console.log("Applying theme:", themeName);
  const theme = themes[themeName];
  if (!theme) return;
  
  // Apply to html AND body for full coverage
  const gradient = `linear-gradient(135deg, ${theme.bg1}, ${theme.bg2})`;
  document.documentElement.style.background = gradient;
  document.body.style.background = gradient;
  
  // Also update theme buttons for consistency
  document.querySelectorAll('.theme-btn').forEach(btn => {
    if (btn.dataset.color === themeName) {
      btn.style.background = gradient;
    }
  });
  
  // Save to localStorage
  localStorage.setItem('theme', themeName);
  console.log("Theme saved to localStorage:", themeName);
}

// ===== SIMPLE EMBED SYSTEM =====
function addEmbedSectionToCard(card, fileName) {
  console.log(`Adding simple embed section to card: ${fileName}`);
  
  const cardName = fileName.replace('.html', '');
  const displayName = cardName.replace(/-/g, ' ');
  
  const embedHTML = `
    <div class="embed-section">
      <span>Share this tool:</span>
      <button class="embed-btn" data-card="${cardName}" data-file="${fileName}">
        üîó Copy Embed Code
      </button>
    </div>
  `;
  
  // Add the embed section to the card
  const contentDiv = card.querySelector('.content');
  if (contentDiv) {
    contentDiv.insertAdjacentHTML('beforeend', embedHTML);
    
    // Add click event to the embed button
    const embedBtn = contentDiv.querySelector('.embed-btn');
    if (embedBtn) {
      embedBtn.addEventListener('click', function() {
        copyEmbedCode(cardName, fileName, displayName);
      });
    }
  }
}

// Function to copy embed code
function copyEmbedCode(cardName, fileName, displayName) {
  // Generate clean embed code
  const embedCode = `<iframe src="https://mrpr0phecy.github.io/mrpr0phecy/cards/${fileName}" width="100%" height="400" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="${displayName} - The Most Useful Site"></iframe>`;
  
  // Copy to clipboard
  navigator.clipboard.writeText(embedCode).then(() => {
    // Visual feedback
    const embedBtn = document.querySelector(`.embed-btn[data-card="${cardName}"]`);
    if (embedBtn) {
      const originalText = embedBtn.textContent;
      embedBtn.textContent = '‚úÖ Copied!';
      embedBtn.classList.add('copied');
      
      setTimeout(() => {
        embedBtn.textContent = originalText;
        embedBtn.classList.remove('copied');
      }, 2000);
    }
    
    // Optional: Show a small notification
    console.log(`Embed code for ${displayName} copied to clipboard!`);
  }).catch(err => {
    console.error('Failed to copy: ', err);
    // Fallback: Create a temporary textarea
    const textArea = document.createElement('textarea');
    textArea.value = embedCode;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      console.log('Fallback copy successful');
    } catch (e) {
      console.error('Fallback copy failed: ', e);
    }
    document.body.removeChild(textArea);
  });
}

// NEW: Advanced font scaling based on widget size and user preference
function updateWidgetFontScale(widget, userScale = null) {
  const width = parseInt(widget.style.width) || widget.offsetWidth;
  const height = parseInt(widget.style.height) || widget.offsetHeight;
  
  // Calculate widget area
  const area = width * height;
  
  // Base font size calculation based on area
  // Formula: font size = base * (area / ideal)^0.25 (square root of square root)
  const areaRatio = area / 30000; // 30000 = 200x150 (ideal size)
  const areaScale = Math.pow(areaRatio, 0.25); // Gentle scaling curve
  
  // Apply user scaling if provided
  const userScaleFactor = userScale !== null ? userScale : (widget.dataset.userScale || 1);
  widget.dataset.userScale = userScaleFactor;
  
  // Combined scale
  const combinedScale = areaScale * userScaleFactor;
  
  // Calculate final font size (clamped between min and max)
  const baseSize = 14; // Base font size at ideal area (200x150)
  let fontSize = baseSize * combinedScale;
  
  // Clamp between min and max
  const minFont = parseInt(widget.style.getPropertyValue('--widget-min-font')) || 8;
  const maxFont = parseInt(widget.style.getPropertyValue('--widget-max-font')) || 32;
  fontSize = Math.max(minFont, Math.min(maxFont, fontSize));
  
  // Apply the font size
  widget.style.setProperty('--widget-font-size', `${fontSize}px`);
  
  // Update line height proportionally
  const lineHeight = fontSize * 1.4;
  widget.querySelector('.widget-body').style.lineHeight = `${lineHeight}px`;
  
  // Save user scale preference to widget data
  if (userScale !== null) {
    const widgetObj = widgets.find(w => w.id === widget.id);
    if (widgetObj) {
      widgetObj.userScale = userScaleFactor;
      saveWidgets();
    }
  }
}

// NEW: Widget scaling controls (add to each widget)
function addWidgetScalingControls(widget) {
  const titlebar = widget.querySelector('.widget-titlebar');
  const titleText = titlebar.querySelector('strong');
  
  // Create scaling controls container
  const scaleControls = document.createElement('div');
  scaleControls.className = 'widget-scale-controls';
  scaleControls.style.display = 'flex';
  scaleControls.style.gap = '4px';
  scaleControls.style.alignItems = 'center';
  scaleControls.style.marginLeft = '8px';
  
  // Smaller text button
  const smallerBtn = document.createElement('button');
  smallerBtn.innerHTML = 'A‚Åª';
  smallerBtn.title = 'Make text smaller (fit more tools)';
  smallerBtn.style.background = 'transparent';
  smallerBtn.style.border = 'none';
  smallerBtn.style.color = 'var(--muted)';
  smallerBtn.style.cursor = 'pointer';
  smallerBtn.style.fontSize = '12px';
  smallerBtn.style.padding = '2px 4px';
  smallerBtn.style.borderRadius = '4px';
  smallerBtn.style.border = '1px solid var(--border)';
  
  // Text size display
  const sizeDisplay = document.createElement('span');
  sizeDisplay.className = 'widget-size-display';
  sizeDisplay.textContent = '100%';
  sizeDisplay.style.fontSize = '11px';
  sizeDisplay.style.color = 'var(--muted)';
  sizeDisplay.style.minWidth = '36px';
  sizeDisplay.style.textAlign = 'center';
  
  // Larger text button
  const largerBtn = document.createElement('button');
  largerBtn.innerHTML = 'A‚Å∫';
  largerBtn.title = 'Make text larger (better readability)';
  largerBtn.style.background = 'transparent';
  largerBtn.style.border = 'none';
  largerBtn.style.color = 'var(--muted)';
  largerBtn.style.cursor = 'pointer';
  largerBtn.style.fontSize = '14px';
  largerBtn.style.padding = '2px 4px';
  largerBtn.style.borderRadius = '4px';
  largerBtn.style.border = '1px solid var(--border)';
  
  // Reset button
  const resetBtn = document.createElement('button');
  resetBtn.innerHTML = '‚ü≤';
  resetBtn.title = 'Reset to auto size';
  resetBtn.style.background = 'transparent';
  resetBtn.style.border = 'none';
  resetBtn.style.color = 'var(--muted)';
  resetBtn.style.cursor = 'pointer';
  resetBtn.style.fontSize = '11px';
  resetBtn.style.padding = '2px 4px';
  resetBtn.style.borderRadius = '4px';
  resetBtn.style.border = '1px solid var(--border)';
  resetBtn.style.marginLeft = '4px';
  
  // Add controls to container
  scaleControls.appendChild(smallerBtn);
  scaleControls.appendChild(sizeDisplay);
  scaleControls.appendChild(largerBtn);
  scaleControls.appendChild(resetBtn);
  
  // Insert after title text
  titleText.parentNode.insertBefore(scaleControls, titleText.nextSibling);
  
  // Event handlers
  smallerBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    const currentScale = parseFloat(widget.dataset.userScale || 1);
    const newScale = Math.max(0.5, currentScale * 0.8); // Reduce by 20%
    updateWidgetFontScale(widget, newScale);
    sizeDisplay.textContent = `${Math.round(newScale * 100)}%`;
  });
  
  largerBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    const currentScale = parseFloat(widget.dataset.userScale || 1);
    const newScale = Math.min(2.0, currentScale * 1.2); // Increase by 20%
    updateWidgetFontScale(widget, newScale);
    sizeDisplay.textContent = `${Math.round(newScale * 100)}%`;
  });
  
  resetBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    updateWidgetFontScale(widget, 1); // Reset to auto
    sizeDisplay.textContent = '100%';
  });
  
  // Initialize display
  const currentScale = parseFloat(widget.dataset.userScale || 1);
  sizeDisplay.textContent = `${Math.round(currentScale * 100)}%`;
  
  return scaleControls;
}

// ===== TOOLBOX WIDGET MANAGEMENT =====
let widgets = [];
let toolboxDocked = false;

// Make toolbox draggable and resizable
function initToolbox() {
  const toolbox = document.getElementById('toolbox');
  const toolboxTitle = document.getElementById('toolboxTitle');
  
  // Make toolbox draggable
  let isDragging = false;
  let dragOffset = { x: 0, y: 0 };
  
  toolboxTitle.addEventListener('mousedown', startDrag);
  
  function startDrag(e) {
    if (e.target.tagName === 'BUTTON') return;
    
    isDragging = true;
    const rect = toolbox.getBoundingClientRect();
    dragOffset.x = e.clientX - rect.left;
    dragOffset.y = e.clientY - rect.top;
    
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);
    toolboxTitle.style.cursor = 'grabbing';
  }
  
  function onDrag(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    toolbox.style.left = 'auto';
    toolbox.style.right = 'auto';
    toolbox.style.top = e.clientY - dragOffset.y + 'px';
    toolbox.style.left = e.clientX - dragOffset.x + 'px';
  }
  
  function stopDrag() {
    isDragging = false;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', stopDrag);
    toolboxTitle.style.cursor = '';
  }
  
  // Dock/undock button
  document.getElementById('dockBtn').addEventListener('click', function() {
    toolboxDocked = !toolboxDocked;
    
    if (toolboxDocked) {
      // Dock to right
      toolbox.style.left = 'auto';
      toolbox.style.right = '18px';
      toolbox.style.top = 'auto';
      toolbox.style.bottom = '18px';
      this.textContent = '‚á≤';
    } else {
      // Undock
      this.textContent = '‚á±';
    }
  });
  
  // Load saved widgets
  loadSavedWidgets();
}

// Create a widget in toolbox
function createWidget(name, contentHTML) {
  const widgetId = 'widget-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
  const widget = document.createElement('div');
  widget.className = 'widget-wrap';
  widget.id = widgetId;
  widget.dataset.name = name;
  
  // Random position within toolbox
  const toolboxContent = document.getElementById('toolboxContent');
  const tRect = toolboxContent.getBoundingClientRect();
  
  widget.style.left = Math.random() * (tRect.width - 200) + 'px';
  widget.style.top = Math.random() * (tRect.height - 150) + 'px';
  widget.style.width = '200px';
  widget.style.height = '150px';
  
  widget.innerHTML = `
    <div class="widget-titlebar">
      <strong>${name}</strong>
      <button class="widget-close" title="Close widget">‚úï</button>
    </div>
    <div class="widget-body">${contentHTML}</div>
  `;
  
  toolboxContent.appendChild(widget);
  
  // Initialize font scale (load saved user scale if exists)
  const savedWidget = widgets.find(w => w.id === widgetId) || {};
  const savedScale = savedWidget.userScale || 1;
  updateWidgetFontScale(widget, savedScale);
  
  // Add scaling controls
  addWidgetScalingControls(widget);
  
  // Make widget draggable
  makeWidgetDraggable(widget);
  
  // Make widget resizable
  makeWidgetResizable(widget);
  
  // Close button
  widget.querySelector('.widget-close').addEventListener('click', function() {
    removeWidget(widgetId);
  });
  
  // Save widget
  widgets.push({
    id: widgetId,
    name: name,
    content: contentHTML,
    x: widget.style.left,
    y: widget.style.top,
    width: widget.style.width,
    height: widget.style.height,
    userScale: savedScale
  });
  
  saveWidgets();
  
  return widgetId;
}

// Make widget draggable
function makeWidgetDraggable(widget) {
  const titlebar = widget.querySelector('.widget-titlebar');
  let isDragging = false;
  let dragOffset = { x: 0, y: 0 };
  
  titlebar.addEventListener('mousedown', startDrag);
  
  function startDrag(e) {
    if (e.target.tagName === 'BUTTON' && !e.target.closest('.widget-scale-controls')) return;
    
    isDragging = true;
    const rect = widget.getBoundingClientRect();
    dragOffset.x = e.clientX - rect.left;
    dragOffset.y = e.clientY - rect.top;
    
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);
    widget.style.zIndex = '1000';
  }
  
  function onDrag(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    const parentRect = widget.parentElement.getBoundingClientRect();
    const x = e.clientX - parentRect.left - dragOffset.x;
    const y = e.clientY - parentRect.top - dragOffset.y;
    
    // Keep within bounds
    const maxX = parentRect.width - widget.offsetWidth;
    const maxY = parentRect.height - widget.offsetHeight;
    
    widget.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
    widget.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
  }
  
  function stopDrag() {
    isDragging = false;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', stopDrag);
    widget.style.zIndex = '1';
    
    // Update saved position
    const widgetObj = widgets.find(w => w.id === widget.id);
    if (widgetObj) {
      widgetObj.x = widget.style.left;
      widgetObj.y = widget.style.top;
      saveWidgets();
    }
  }
}

// Make widget resizable
function makeWidgetResizable(widget) {
  const resizeHandle = document.createElement('div');
  resizeHandle.style.position = 'absolute';
  resizeHandle.style.right = '0';
  resizeHandle.style.bottom = '0';
  resizeHandle.style.width = '16px';
  resizeHandle.style.height = '16px';
  resizeHandle.style.cursor = 'se-resize';
  resizeHandle.style.background = 'transparent';
  resizeHandle.style.zIndex = '10';
  
  widget.appendChild(resizeHandle);
  
  let isResizing = false;
  let startWidth, startHeight, startX, startY;
  
  resizeHandle.addEventListener('mousedown', startResize);
  
  function startResize(e) {
    e.stopPropagation();
    isResizing = true;
    startWidth = parseInt(getComputedStyle(widget).width);
    startHeight = parseInt(getComputedStyle(widget).height);
    startX = e.clientX;
    startY = e.clientY;
    
    document.addEventListener('mousemove', onResize);
    document.addEventListener('mouseup', stopResize);
  }
  
  function onResize(e) {
    if (!isResizing) return;
    
    e.preventDefault();
    
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    
    const newWidth = Math.max(120, startWidth + dx);
    const newHeight = Math.max(80, startHeight + dy);
    
    widget.style.width = newWidth + 'px';
    widget.style.height = newHeight + 'px';
    
    // Update font scale when resizing (auto-scale based on new size)
    updateWidgetFontScale(widget);
  }
  
  function stopResize() {
    isResizing = false;
    document.removeEventListener('mousemove', onResize);
    document.removeEventListener('mouseup', stopResize);
    
    // Update saved size
    const widgetObj = widgets.find(w => w.id === widget.id);
    if (widgetObj) {
      widgetObj.width = widget.style.width;
      widgetObj.height = widget.style.height;
      saveWidgets();
    }
  }
}

// Remove widget
function removeWidget(widgetId) {
  const widget = document.getElementById(widgetId);
  if (widget) {
    widget.remove();
  }
  
  widgets = widgets.filter(w => w.id !== widgetId);
  saveWidgets();
}

// Save widgets to localStorage
function saveWidgets() {
  localStorage.setItem('toolboxWidgets', JSON.stringify(widgets));
}

// Load saved widgets
function loadSavedWidgets() {
  const saved = localStorage.getItem('toolboxWidgets');
  if (saved) {
    try {
      widgets = JSON.parse(saved) || [];
      widgets.forEach(widgetData => {
        const widget = document.createElement('div');
        widget.className = 'widget-wrap';
        widget.id = widgetData.id;
        widget.dataset.name = widgetData.name;
        widget.style.left = widgetData.x;
        widget.style.top = widgetData.y;
        widget.style.width = widgetData.width;
        widget.style.height = widgetData.height;
        
        widget.innerHTML = `
          <div class="widget-titlebar">
            <strong>${widgetData.name}</strong>
            <button class="widget-close" title="Close widget">‚úï</button>
          </div>
          <div class="widget-body">${widgetData.content}</div>
        `;
        
        document.getElementById('toolboxContent').appendChild(widget);
        
        // Initialize font scale with saved user scale
        const savedScale = widgetData.userScale || 1;
        updateWidgetFontScale(widget, savedScale);
        
        // Add scaling controls
        addWidgetScalingControls(widget);
        
        makeWidgetDraggable(widget);
        makeWidgetResizable(widget);
        
        widget.querySelector('.widget-close').addEventListener('click', function() {
          removeWidget(widgetData.id);
        });
      });
    } catch (e) {
      console.error('Failed to load widgets:', e);
      widgets = [];
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM ready");
  
  // FIX 1: Scroll to top immediately
  window.scrollTo(0, 0);
  
  // Apply saved theme or default
  const savedTheme = localStorage.getItem('theme') || 'default';
  applyTheme(savedTheme);
  
  // Activate saved theme button
  document.querySelectorAll('.theme-btn').forEach(btn => {
    if (btn.dataset.color === savedTheme) {
      btn.classList.add('active');
      btn.style.border = '2px solid var(--accent)';
    } else {
      btn.classList.remove('active');
      btn.style.border = '1px solid var(--border)';
    }
  });
  
  // Apply saved accent
  const savedAccent = localStorage.getItem('accent') || '#2dd4ff';
  document.documentElement.style.setProperty('--accent', savedAccent);
  document.querySelectorAll('.palette-color').forEach(c => {
    c.classList.toggle('active', c.dataset.accent === savedAccent);
  });
  
  // Apply reader mode
  if(localStorage.getItem('readerMode') === 'on') {
    document.body.classList.add('reader-mode');
  }
  
  // Initialize toolbox
  initToolbox();
  
  // Load dashboard with improved loading
  loadDashboard();
});

// FIX 1: Scroll to search bar when page loads or refreshes
window.addEventListener('load', function() {
  // Small delay to ensure everything is rendered
  setTimeout(() => {
    const searchBar = document.querySelector('.search-bar');
    if (searchBar) {
      searchBar.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    // Also focus the search input
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
      searchInput.focus();
    }
  }, 100);
});

// FIX 1: Also scroll to top when clicking home/reloading
window.addEventListener('beforeunload', function() {
  window.scrollTo(0, 0);
});

// ===== PALETTE HANDLING =====
document.getElementById('paletteToggle').addEventListener('click', function() {
  const panel = document.getElementById('palettePanel');
  panel.classList.toggle('open');
});

// Accent colors
document.querySelectorAll('.palette-color').forEach(c => {
  c.addEventListener('click', function() {
    document.querySelectorAll('.palette-color').forEach(x => x.classList.remove('active'));
    this.classList.add('active');
    const col = this.dataset.accent;
    document.documentElement.style.setProperty('--accent', col);
    localStorage.setItem('accent', col);
  });
});

// Background themes - SIMPLE
document.querySelectorAll('.theme-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.theme-btn').forEach(b => {
      b.classList.remove('active');
      b.style.border = '1px solid var(--border)';
    });
    this.classList.add('active');
    this.style.border = '2px solid var(--accent)';
    
    const themeName = this.dataset.color;
    applyTheme(themeName);
  });
});

// ===== TOOLBOX =====
const toolbox = document.getElementById('toolbox');
document.getElementById('toolboxToggle').addEventListener('click', function() {
  toolbox.classList.toggle('hidden');
});
document.getElementById('toolboxClose').addEventListener('click', function(e) {
  e.stopPropagation();
  toolbox.classList.add('hidden');
});

// ===== READER MODE =====
document.getElementById('readerToggle').addEventListener('click', function() {
  document.body.classList.toggle('reader-mode');
  localStorage.setItem('readerMode', document.body.classList.contains('reader-mode') ? 'on' : 'off');
});

// ===== SEARCH =====
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', function(e) {
  const q = e.target.value.toLowerCase();
  document.querySelectorAll('.card').forEach(card => {
    const name = card.dataset.name.toLowerCase();
    const text = card.textContent.toLowerCase();
    card.style.display = name.includes(q) || text.includes(q) ? '' : 'none';
  });
});

// ===== SORT BUTTONS =====
document.getElementById('sortAlphaBtn').addEventListener('click', function() {
  const grid = document.getElementById('gridContainer');
  const cards = Array.from(grid.children);
  cards.sort((a,b) => a.dataset.name.localeCompare(b.dataset.name));
  cards.forEach(card => grid.appendChild(card));
});

document.getElementById('sortRandomBtn').addEventListener('click', function() {
  const grid = document.getElementById('gridContainer');
  const cards = Array.from(grid.children);
  for (let i = cards.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [cards[i], cards[j]] = [cards[j], cards[i]];
  }
  cards.forEach(card => grid.appendChild(card));
});

// FIX 2: Improved card loading - loads in batches
let cardQueue = [];
let isCardLoading = false;
const BATCH_SIZE = 5;
const BATCH_DELAY = 50;

// Load cards in batches
function loadCardBatch() {
  if (isCardLoading || cardQueue.length === 0) return;
  
  isCardLoading = true;
  const batch = cardQueue.splice(0, BATCH_SIZE);
  
  let loadedCount = 0;
  
  batch.forEach((cardData, index) => {
    setTimeout(() => {
      const { card, file, name } = cardData;
      const content = card.querySelector('.content');
      
      fetch(`cards/${file}`)
        .then(r => r.ok ? r.text() : Promise.reject())
        .then(html => {
          // ‚úÖ Load HTML with scripts intact
          content.innerHTML = html;
          
          // ‚úÖ Add simple embed section to every card
          addEmbedSectionToCard(card, file);
          
          // Execute any scripts in the loaded content
          const scripts = content.querySelectorAll('script');
          scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) {
              newScript.src = script.src;
            } else {
              newScript.textContent = script.textContent;
            }
            // Copy attributes
            [...script.attributes].forEach(attr => {
              newScript.setAttribute(attr.name, attr.value);
            });
            
            // Replace old script with new one (which will execute)
            script.parentNode.replaceChild(newScript, script);
          });
        })
        .catch(() => {
          content.textContent = 'Preview unavailable';
          // Still add embed section even if card failed to load
          addEmbedSectionToCard(card, file);
        })
        .finally(() => {
          loadedCount++;
          
          // Show card with animation
          setTimeout(() => {
            card.classList.add('visible');
          }, index * 30);
          
          // Update status
          const totalCards = document.querySelectorAll('.card').length;
          const loadedCards = document.querySelectorAll('.card.visible').length;
          document.getElementById('status').textContent = 
            `Loaded ${loadedCards} of ${totalCards} tools`;
          
          // Load next batch when this one is done
          if (loadedCount === batch.length) {
            isCardLoading = false;
            if (cardQueue.length > 0) {
              setTimeout(loadCardBatch, BATCH_DELAY);
            } else {
              document.getElementById('status').textContent = 
                `${totalCards} tools loaded`;
            }
          }
        });
    }, index * 20); // Stagger requests
  });
}

// ===== LOAD CARDS WITH IMPROVED PERFORMANCE =====
async function loadDashboard() {
  try {
    const DEFAULT_REPO = 'mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH = 'main';
    
    // Parse repo
    const [owner, repo] = DEFAULT_REPO.split('/');
    
    document.getElementById('status').textContent = 'Fetching card list...';
    
    // Fetch card files
    const url = `https://api.github.com/repos/${owner}/${repo}/git/trees/${DEFAULT_BRANCH}?recursive=1`;
    const response = await fetch(url);
    const data = await response.json();
    
    const cardFiles = (data.tree || [])
      .filter(item => item.path.startsWith('cards/') && item.path.endsWith('.html'))
      .map(item => item.path.replace(/^cards\//, ''));
    
    console.log("Found", cardFiles.length, "cards");
    
    // Display cards
    const grid = document.getElementById('gridContainer');
    const status = document.getElementById('status');
    
    if (!cardFiles.length) {
      status.textContent = 'No cards found';
      return;
    }
    
    grid.innerHTML = '';
    cardQueue = [];
    
    // Create all card containers first (fast)
    cardFiles.sort().forEach(file => {
      const name = file.replace('.html', '');
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.file = file;
      card.dataset.name = name;
      
      const header = document.createElement('div');
      header.className = 'card-header';
      header.innerHTML = `<h3>${name}</h3><div style="display:flex;gap:8px"><div class="add-to-toolbox" title="Add to toolbox" style="cursor:pointer;font-weight:bold;color:var(--accent)">+</div></div>`;
      
      const content = document.createElement('div');
      content.className = 'content';
      content.textContent = 'Loading‚Ä¶';
      
      card.appendChild(header);
      card.appendChild(content);
      grid.appendChild(card);
      
      // Add to queue for batch loading
      cardQueue.push({ card, file, name });
    });
    
    status.textContent = `Loading 0 of ${cardFiles.length} tools...`;
    
    // Start batch loading
    setTimeout(loadCardBatch, 300);
    
  } catch (error) {
    console.error("Error loading dashboard:", error);
    document.getElementById('status').textContent = 'Error loading cards';
  }
}

// Add event listener for adding cards to toolbox
document.addEventListener('click', function(e) {
  // Check if click is on "Add to toolbox" button
  if (e.target.classList.contains('add-to-toolbox') || 
      e.target.closest('.add-to-toolbox')) {
    
    const card = e.target.closest('.card');
    if (!card) return;
    
    const cardName = card.dataset.name;
    const contentElement = card.querySelector('.content');
    const contentHTML = contentElement.innerHTML;
    
    // Create widget in toolbox
    createWidget(cardName, contentHTML);
    
    // Show toolbox if hidden
    toolbox.classList.remove('hidden');
    
    // Visual feedback
    const addBtn = e.target.closest('.add-to-toolbox');
    addBtn.textContent = '‚úì';
    addBtn.style.color = 'var(--accent)';
    setTimeout(() => {
      addBtn.textContent = '+';
      addBtn.style.color = '';
    }, 1000);
  }
});

// Make Sortable
new Sortable(document.getElementById('gridContainer'), { animation: 150 });

// ===== MOBILE-FRIENDLY SCROLLING FIX =====
// This prevents card content from interfering with page scrolling
document.addEventListener('DOMContentLoaded', function() {
  // Add passive event listeners for better scrolling performance
  document.addEventListener('touchmove', function(e) {
    // Allow default scrolling behavior for the main page
    if (!e.target.closest('.card, .widget-wrap, .toolbox')) {
      return;
    }
  }, { passive: true });
  
  // For cards with interactive content, add a scroll indicator
  document.querySelectorAll('.card .content').forEach(content => {
    // If content has its own scrollbar, make it more mobile-friendly
    if (content.scrollHeight > content.clientHeight) {
      content.style.maxHeight = '40vh';
      content.style.overflowY = 'auto';
      content.style.webkitOverflowScrolling = 'touch';
    }
  });
});

// Helper function to detect touch devices
function isTouchDevice() {
  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
}

// If on mobile, adjust some settings for better UX
if (isTouchDevice()) {
  // Make buttons slightly larger for touch
  document.documentElement.style.setProperty('--card-min', '280px');
  
  // Adjust toolbox dimensions for mobile
  const toolbox = document.getElementById('toolbox');
  if (toolbox) {
    toolbox.style.minWidth = '280px';
    toolbox.style.minHeight = '300px';
  }
}

console.log("=== APP INITIALIZED ===");
</script>
</body>
</html>


