<h2 id="circuit-calculator-title" style="margin-top:0;">üîå Circuit Calculator</h2>

<form aria-describedby="circuit-calculator-desc">
  <p id="circuit-calculator-desc" class="small">
    Calculate circuit load, breaker size, and wire sizing. Perfect for DIY projects and planning.
  </p>

  <!-- INPUT SECTION -->
  <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;margin-bottom:20px;">
    <div style="color:#2dd4ff;font-weight:600;margin-bottom:15px;">‚ö° Enter Circuit Parameters:</div>
    
    <!-- VOLTAGE & PHASE -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cc-voltage" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#ffa500;">Voltage (V)</span>
        </label>
        <div style="display:flex;align-items:center;">
          <input type="number" id="cc-voltage" placeholder="e.g. 120" min="12" step="1"
                 style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:#e6faff;font-size:16px;">
          <div style="margin-left:8px;color:rgba(255,165,0,0.8);white-space:nowrap;">Volts</div>
        </div>
        <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
          <button type="button" onclick="ccSetVoltage(120)" style="padding:4px 8px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:4px;color:#ffa500;cursor:pointer;font-size:12px;">120V (USA)</button>
          <button type="button" onclick="ccSetVoltage(230)" style="padding:4px 8px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:4px;color:#ffa500;cursor:pointer;font-size:12px;">230V (EU)</button>
          <button type="button" onclick="ccSetVoltage(240)" style="padding:4px 8px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:4px;color:#ffa500;cursor:pointer;font-size:12px;">240V (UK)</button>
        </div>
      </div>
      
      <div>
        <label for="cc-phase" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#2dd4ff;">Phase Type</span>
        </label>
        <select id="cc-phase" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:#e6faff;font-size:16px;">
          <option value="single" selected>Single-phase</option>
          <option value="three">Three-phase</option>
        </select>
      </div>
    </div>
    
    <!-- POWER & POWER FACTOR -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cc-power" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#39ff14;">Load Power (W)</span>
        </label>
        <div style="display:flex;align-items:center;">
          <input type="number" id="cc-power" placeholder="e.g. 2000" min="1" step="1"
                 style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#e6faff;font-size:16px;">
          <div style="margin-left:8px;color:rgba(57,255,20,0.8);white-space:nowrap;">Watts</div>
        </div>
        <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
          <button type="button" onclick="ccSetPower(100)" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:12px;">üí° Light (100W)</button>
          <button type="button" onclick="ccSetPower(1500)" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:12px;">üíª PC (1500W)</button>
          <button type="button" onclick="ccSetPower(3500)" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:12px;">üî• Heater (3500W)</button>
        </div>
      </div>
      
      <div>
        <label for="cc-pf" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#9d4edd;">Power Factor</span>
        </label>
        <div style="display:flex;align-items:center;gap:10px;">
          <input type="range" id="cc-pf-slider" min="70" max="100" value="95" step="1"
                 style="flex:1;height:6px;border-radius:3px;background:linear-gradient(to right, #ff4d4d, #ffa500, #39ff14);outline:none;">
          <input type="number" id="cc-pf" value="0.95" min="0.7" max="1" step="0.01"
                 style="width:70px;padding:8px;border-radius:6px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.1);color:#e6faff;text-align:center;">
          <div style="color:rgba(157,78,221,0.8);white-space:nowrap;">PF</div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
          Resistive: 1.0 | Motors: 0.8 | Electronics: 0.95
        </div>
      </div>
    </div>
    
    <!-- WIRE DISTANCE -->
    <div style="margin-top:20px;">
      <label for="cc-length" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
        <span style="color:#ffcc00;">Wire Length (optional)</span>
      </label>
      <div style="display:flex;align-items:center;">
        <input type="number" id="cc-length" placeholder="e.g. 50" min="0" step="1"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:#e6faff;font-size:16px;">
        <select id="cc-length-unit" style="margin-left:8px;padding:10px;border-radius:6px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.1);color:#e6faff;">
          <option value="ft">Feet</option>
          <option value="m">Meters</option>
        </select>
      </div>
      <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
        For voltage drop calculation (round-trip distance)
      </div>
    </div>
  </div>
  
  <!-- QUICK EXAMPLES -->
  <div style="margin-bottom:25px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:10px;font-size:14px;">Quick Examples:</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="cc-example-btn" data-voltage="120" data-power="100" data-pf="1" data-phase="single" data-length="20"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üí° Lamp (120V, 100W)
      </button>
      <button class="cc-example-btn" data-voltage="230" data-power="2000" data-pf="0.95" data-phase="single" data-length="15"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üíª Computer (230V, 2000W)
      </button>
      <button class="cc-example-btn" data-voltage="400" data-power="5000" data-pf="0.85" data-phase="three" data-length="30"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üè≠ Motor (400V, 5kW, 3-phase)
      </button>
      <button class="cc-example-btn" data-voltage="240" data-power="3000" data-pf="1" data-phase="single" data-length="25"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üî• Water Heater (240V, 3kW)
      </button>
    </div>
  </div>
  
  <!-- CALCULATE BUTTON -->
  <div style="text-align:center;margin:25px 0;">
    <button id="cc-calculate-btn" 
            style="background:#2dd4ff;color:#000;border:none;padding:14px 32px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;box-shadow:0 4px 15px rgba(45,212,255,0.3);">
      ‚ö° CALCULATE CIRCUIT
    </button>
    
    <button id="cc-reset-btn" 
            style="background:rgba(255,255,255,0.08);color:#e6faff;border:1px solid rgba(255,255,255,0.2);padding:14px 24px;border-radius:10px;cursor:pointer;font-size:16px;margin-left:12px;">
      Reset
    </button>
  </div>
  
  <!-- RESULTS DISPLAY -->
  <div id="cc-results" style="display:none;">
    <div style="background:rgba(20,20,20,0.7);border-radius:10px;padding:25px;border:1px solid rgba(57,255,20,0.2);margin-bottom:25px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div style="color:#39ff14;font-size:18px;font-weight:600;">üìä Circuit Calculation Results</div>
        <button id="cc-copy-btn" 
                style="background:rgba(57,255,20,0.1);color:#39ff14;border:1px solid rgba(57,255,20,0.3);padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;">
          Copy Results
        </button>
      </div>
      
      <div id="cc-result-display" style="font-size:16px;color:#39ff14;margin-bottom:20px;padding:15px;background:rgba(0,0,0,0.3);border-radius:8px;white-space:pre-line;">
        <!-- Results appear here -->
      </div>
      
      <!-- WIRE SIZE RECOMMENDATION -->
      <div id="cc-wire-recommendation" style="margin-top:20px;padding:15px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);display:none;">
        <div style="color:#2dd4ff;font-weight:600;margin-bottom:10px;">üí° Recommended Wire Size:</div>
        <div id="cc-recommended-wire" style="color:#e6faff;"></div>
      </div>
      
      <!-- VOLTAGE DROP CALCULATION -->
      <div id="cc-voltage-drop" style="margin-top:20px;padding:15px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);display:none;">
        <div style="color:#ffa500;font-weight:600;margin-bottom:10px;">üìè Voltage Drop Analysis:</div>
        <div id="cc-drop-calculation" style="color:#e6faff;"></div>
      </div>
    </div>
  </div>
  
  <!-- SAFETY & FACTS -->
  <div id="cc-safety-info" style="margin-top:20px;display:block;">
    <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;border:1px solid rgba(255,165,0,0.2);">
      <div style="color:#ffa500;font-weight:600;margin-bottom:15px;font-size:16px;">
        ‚ö° Electrical Safety & Standards
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;">
        <div style="background:rgba(255,165,0,0.05);padding:12px;border-radius:8px;border-left:3px solid #ffa500;">
          <div style="color:#ffa500;font-weight:600;margin-bottom:5px;">Formulas:</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">‚Ä¢ Single-phase: I = P √∑ (V √ó PF)<br>‚Ä¢ Three-phase: I = P √∑ (‚àö3 √ó V √ó PF)<br>‚Ä¢ Voltage drop: Vdrop = 2 √ó L √ó I √ó R</div>
        </div>
        
        <div style="background:rgba(255,77,77,0.05);padding:12px;border-radius:8px;border-left:3px solid #ff4d4d;">
          <div style="color:#ff4d4d;font-weight:600;margin-bottom:5px;">‚ö†Ô∏è Safety First!</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">‚Ä¢ Always consult licensed electricians<br>‚Ä¢ Follow NEC/IEC/BS 7671 codes<br>‚Ä¢ Use proper circuit protection</div>
        </div>
        
        <div style="background:rgba(30,144,255,0.05);padding:12px;border-radius:8px;border-left:3px solid #1e90ff;">
          <div style="color:#1e90ff;font-weight:600;margin-bottom:5px;">Breaker Sizing</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">‚Ä¢ Continuous loads: 125% rule<br>‚Ä¢ Non-continuous: 100% rule<br>‚Ä¢ Match wire ampacity</div>
        </div>
        
        <div style="background:rgba(57,255,20,0.05);padding:12px;border-radius:8px;border-left:3px solid #39ff14;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:5px;">Pro Tips</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">‚Ä¢ Calculate round-trip distance<br>‚Ä¢ Factor in ambient temperature<br>‚Ä¢ Consider future expansion<br>‚Ä¢ Include derating factors</div>
        </div>
      </div>
      
      <!-- WIRE AMPACITY TABLE -->
      <div style="margin-top:20px;overflow-x:auto;">
        <div style="color:#2dd4ff;font-weight:600;margin-bottom:10px;font-size:14px;">üìã Common Wire Sizes & Ampacities:</div>
        <table style="width:100%;border-collapse:collapse;font-size:13px;">
          <thead>
            <tr style="background:rgba(45,212,255,0.1);">
              <th style="padding:8px;text-align:left;border:1px solid rgba(45,212,255,0.3);">AWG</th>
              <th style="padding:8px;text-align:left;border:1px solid rgba(45,212,255,0.3);">mm¬≤</th>
              <th style="padding:8px;text-align:left;border:1px solid rgba(45,212,255,0.3);">Max Ampacity*</th>
              <th style="padding:8px;text-align:left;border:1px solid rgba(45,212,255,0.3);">Typical Use</th>
            </tr>
          </thead>
          <tbody>
            <tr><td style="padding:6px;border:1px solid rgba(255,255,255,0.1);">14</td><td>2.08</td><td>15A</td><td>Lighting circuits</td></tr>
            <tr style="background:rgba(255,255,255,0.03);"><td style="padding:6px;border:1px solid rgba(255,255,255,0.1);">12</td><td>3.31</td><td>20A</td><td>General outlets</td></tr>
            <tr><td style="padding:6px;border:1px solid rgba(255,255,255,0.1);">10</td><td>5.26</td><td>30A</td><td>Dryers, water heaters</td></tr>
            <tr style="background:rgba(255,255,255,0.03);"><td style="padding:6px;border:1px solid rgba(255,255,255,0.1);">8</td><td>8.37</td><td>40A</td><td>Ranges, HVAC</td></tr>
            <tr><td style="padding:6px;border:1px solid rgba(255,255,255,0.1);">6</td><td>13.3</td><td>55A</td><td>Electric vehicle</td></tr>
          </tbody>
        </table>
        <div style="color:rgba(230,250,255,0.6);font-size:12px;margin-top:8px;font-style:italic;">* For 75¬∞C copper wire in free air. Actual values vary by installation.</div>
      </div>
      
      <div style="margin-top:15px;padding:10px;background:rgba(255,165,0,0.1);border-radius:6px;border:1px solid rgba(255,165,0,0.3);">
        <div style="color:#ffa500;font-weight:600;font-size:14px;">Disclaimer:</div>
        <div style="color:rgba(255,165,0,0.9);font-size:13px;margin-top:4px;">
          This tool provides educational estimates only. Always consult with a qualified electrician and follow local electrical codes for actual installations.
        </div>
      </div>
    </div>
  </div>
  
  <!-- ERROR MESSAGE -->
  <div id="cc-error" style="margin-top:20px;padding:15px;background:rgba(255,77,77,0.1);border-radius:8px;border:1px solid rgba(255,77,77,0.3);display:none;">
    <div style="color:#ff4d4d;font-weight:600;margin-bottom:5px;">‚ö†Ô∏è Please check your inputs</div>
    <div id="cc-error-text" style="color:rgba(255,77,77,0.9);"></div>
  </div>
</form>

<style>
#circuit-calculator-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .cc-example-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  #cc-calculate-btn, #cc-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  table {
    font-size: 12px !important;
  }
}
</style>

<script>
/* circuit-calculator.html
   - Enhanced circuit calculator with voltage drop
   - Scoped with cc- prefix
*/

let ccExampleActive = null;

// Wire resistance per 1000 ft for copper at 75¬∞C
const ccWireResistance = {
    '14': 2.525,
    '12': 1.588,
    '10': 0.9989,
    '8':  0.6282,
    '6':  0.3951,
    '4':  0.2485
};

// Standard breaker sizes (for recommendation)
const ccStandardBreakers = [15, 20, 25, 30, 35, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200];

// Initialize the calculator
function ccInit() {
    console.log("Circuit Calculator: Initializing...");
    
    // PF slider and input synchronization
    const pfSlider = document.getElementById('cc-pf-slider');
    const pfInput = document.getElementById('cc-pf');
    
    pfSlider.addEventListener('input', function() {
        pfInput.value = (this.value / 100).toFixed(2);
    });
    
    pfInput.addEventListener('input', function() {
        let value = parseFloat(this.value);
        if (value < 0.7) value = 0.7;
        if (value > 1) value = 1;
        this.value = value.toFixed(2);
        pfSlider.value = value * 100;
    });
    
    // Example buttons
    const exampleBtns = document.querySelectorAll('.cc-example-btn');
    exampleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const voltage = this.dataset.voltage;
            const power = this.dataset.power;
            const pf = this.dataset.pf;
            const phase = this.dataset.phase;
            const length = this.dataset.length;
            
            document.getElementById('cc-voltage').value = voltage;
            document.getElementById('cc-power').value = power;
            document.getElementById('cc-pf').value = pf;
            pfSlider.value = pf * 100;
            document.getElementById('cc-phase').value = phase;
            document.getElementById('cc-length').value = length;
            
            // Visual feedback
            exampleBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
            });
            this.style.background = 'rgba(45,212,255,0.15)';
            this.style.border = '1px solid #2dd4ff';
            
            ccExampleActive = this;
            ccClearResults();
        });
    });
    
    // Calculate button
    document.getElementById('cc-calculate-btn').addEventListener('click', ccCalculate);
    
    // Reset button
    document.getElementById('cc-reset-btn').addEventListener('click', ccReset);
    
    // Copy button
    document.getElementById('cc-copy-btn').addEventListener('click', ccCopyResult);
    
    // Enter key support
    const allInputs = document.querySelectorAll('#cc-voltage, #cc-power, #cc-pf, #cc-length');
    allInputs.forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                ccCalculate();
            }
        });
    });
    
    // Set default values
    ccSetDefaultValues();
    
    console.log("‚úÖ Circuit Calculator ready!");
}

// Helper functions for quick buttons
function ccSetVoltage(voltage) {
    document.getElementById('cc-voltage').value = voltage;
    document.getElementById('cc-voltage').focus();
}

function ccSetPower(power) {
    document.getElementById('cc-power').value = power;
    document.getElementById('cc-power').focus();
}

// Set default values
function ccSetDefaultValues() {
    document.getElementById('cc-voltage').value = '230';
    document.getElementById('cc-power').value = '2000';
    document.getElementById('cc-pf').value = '0.95';
    document.getElementById('cc-pf-slider').value = '95';
    document.getElementById('cc-phase').value = 'single';
    document.getElementById('cc-length').value = '';
}

// Show error
function ccShowError(message) {
    document.getElementById('cc-error-text').textContent = message;
    document.getElementById('cc-error').style.display = 'block';
}

// Clear results
function ccClearResults() {
    document.getElementById('cc-results').style.display = 'none';
    document.getElementById('cc-error').style.display = 'none';
    document.getElementById('cc-wire-recommendation').style.display = 'none';
    document.getElementById('cc-voltage-drop').style.display = 'none';
}

// Main calculation function
function ccCalculate() {
    console.log("Calculating circuit...");
    
    // Hide previous results/errors
    ccClearResults();
    
    // Get inputs
    const V = parseFloat(document.getElementById('cc-voltage').value);
    const P = parseFloat(document.getElementById('cc-power').value);
    const pf = parseFloat(document.getElementById('cc-pf').value) || 1;
    const phase = document.getElementById('cc-phase').value;
    const length = parseFloat(document.getElementById('cc-length').value) || 0;
    const unit = document.getElementById('cc-length-unit').value;
    
    // Validate inputs
    if (!V || !P || V <= 0 || P <= 0) {
        ccShowError('Please enter valid voltage (V) and power (W) values');
        return;
    }
    
    if (pf < 0.7 || pf > 1) {
        ccShowError('Power factor must be between 0.7 and 1.0');
        return;
    }
    
    try {
        // Calculate current
        let I = 0;
        if (phase === "single") {
            I = P / (V * pf);
        } else {
            I = P / (Math.sqrt(3) * V * pf);
        }
        
        // Calculate breaker size (125% rule for continuous loads)
        const breakerContinuous = Math.ceil(I * 1.25);
        const breakerStandard = ccFindStandardBreaker(breakerContinuous);
        
        // Calculate circuit power in kW
        const kW = P / 1000;
        
        // Prepare results
        let result = `üìä Circuit Analysis Results:\n\n`;
        result += `‚ö° Voltage: ${V} V (${phase})\n`;
        result += `üîå Power: ${P} W (${kW.toFixed(2)} kW)\n`;
        result += `üéØ Power Factor: ${pf.toFixed(2)}\n\n`;
        result += `üìà Calculated Current: ${I.toFixed(2)} A\n`;
        result += `üõ°Ô∏è Breaker Size (continuous): ${breakerStandard} A\n`;
        result += `   (Based on ${I.toFixed(2)} A √ó 125% = ${breakerContinuous.toFixed(1)} A)\n\n`;
        
        // Add efficiency note
        if (pf < 0.9) {
            result += `üí° Note: Low power factor (${pf.toFixed(2)}) increases current draw.\n`;
            result += `   Consider power factor correction for better efficiency.\n`;
        }
        
        // Display results
        document.getElementById('cc-result-display').innerHTML = result.replace(/\n/g, '<br>');
        document.getElementById('cc-results').style.display = 'block';
        
        // Show wire size recommendation
        if (breakerStandard) {
            ccShowWireRecommendation(breakerStandard, I, V, length, unit);
        }
        
        // Show voltage drop if length provided
        if (length > 0 && breakerStandard) {
            ccCalculateVoltageDrop(I, V, length, unit, breakerStandard);
        }
        
    } catch (e) {
        console.error('Calculation error:', e);
        ccShowError('Unable to calculate. Please check your inputs.');
    }
}

// Find nearest standard breaker size
function ccFindStandardBreaker(calculated) {
    for (const breaker of ccStandardBreakers) {
        if (breaker >= calculated) {
            return breaker;
        }
    }
    return ccStandardBreakers[ccStandardBreakers.length - 1];
}

// Show wire size recommendation
function ccShowWireRecommendation(breaker, current, voltage, length, unit) {
    const wireSizes = {
        '15': '14 AWG (2.08 mm¬≤)',
        '20': '12 AWG (3.31 mm¬≤)',
        '30': '10 AWG (5.26 mm¬≤)',
        '40': '8 AWG (8.37 mm¬≤)',
        '50': '6 AWG (13.3 mm¬≤)',
        '60': '4 AWG (21.2 mm¬≤)',
        '70': '3 AWG (26.7 mm¬≤)',
        '80': '2 AWG (33.6 mm¬≤)',
        '100': '1 AWG (42.4 mm¬≤)'
    };
    
    let recommendation = `For ${breaker}A circuit breaker:\n`;
    recommendation += `‚Ä¢ Minimum wire: <span style="color:#39ff14;font-weight:600;">${wireSizes[breaker] || `${breaker}A rated wire`}</span>\n\n`;
    recommendation += `üìè Derating factors:\n`;
    recommendation += `‚Ä¢ Ambient temperature: Use next larger size if > 30¬∞C\n`;
    recommendation += `‚Ä¢ Conduit fill: Derate for 3+ conductors\n`;
    recommendation += `‚Ä¢ Continuous load: Already factored (125%)\n`;
    recommendation += `‚Ä¢ Voltage drop: Check below if distance provided`;
    
    document.getElementById('cc-recommended-wire').innerHTML = recommendation.replace(/\n/g, '<br>');
    document.getElementById('cc-wire-recommendation').style.display = 'block';
}

// Calculate voltage drop
function ccCalculateVoltageDrop(current, voltage, length, unit, breaker) {
    // Convert length to feet if needed
    let lengthFt = length;
    if (unit === 'm') {
        lengthFt = length * 3.28084; // Convert meters to feet
    }
    
    // Round trip distance (out and return)
    const roundTripFt = lengthFt * 2;
    
    // Get appropriate wire size for this breaker
    let wireSize = '14';
    if (breaker >= 100) wireSize = '1';
    else if (breaker >= 70) wireSize = '3';
    else if (breaker >= 60) wireSize = '4';
    else if (breaker >= 50) wireSize = '6';
    else if (breaker >= 40) wireSize = '8';
    else if (breaker >= 30) wireSize = '10';
    else if (breaker >= 20) wireSize = '12';
    else if (breaker >= 15) wireSize = '14';
    
    // Get wire resistance
    const resistance = ccWireResistance[wireSize] || 1.588; // Default to 12 AWG
    
    // Calculate voltage drop
    const Vdrop = (roundTripFt * current * resistance) / 1000;
    const dropPercent = (Vdrop / voltage) * 100;
    
    // Calculate voltage at load
    const Vload = voltage - Vdrop;
    
    // Prepare voltage drop analysis
    let analysis = `For ${length} ${unit} (${lengthFt.toFixed(1)} ft one-way):\n`;
    analysis += `‚Ä¢ Round-trip distance: ${roundTripFt.toFixed(1)} ft\n`;
    analysis += `‚Ä¢ Voltage drop: ${Vdrop.toFixed(2)} V (${dropPercent.toFixed(2)}%)\n`;
    analysis += `‚Ä¢ Voltage at load: ${Vload.toFixed(2)} V\n\n`;
    
    analysis += `üéØ Analysis:\n`;
    if (dropPercent < 3) {
        analysis += `‚úÖ Excellent! Under 3% target for branch circuits.\n`;
    } else if (dropPercent < 5) {
        analysis += `‚ö†Ô∏è Acceptable for feeders, high for branch circuits.\n`;
        analysis += `   Consider larger wire if this is a branch circuit.\n`;
    } else {
        analysis += `‚ùå Excessive voltage drop (>5%).\n`;
        analysis += `   Upsize wire or reduce circuit length.\n`;
    }
    
    // Add recommendation if needed
    if (dropPercent > 3) {
        analysis += `\nüí° Recommendation: Consider ${ccGetLargerWire(wireSize)}`;
    }
    
    document.getElementById('cc-drop-calculation').innerHTML = analysis.replace(/\n/g, '<br>');
    document.getElementById('cc-voltage-drop').style.display = 'block';
}

// Get next larger wire size
function ccGetLargerWire(currentWire) {
    const wireSequence = ['14', '12', '10', '8', '6', '4', '3', '2', '1'];
    const index = wireSequence.indexOf(currentWire);
    if (index < wireSequence.length - 1) {
        return `${wireSequence[index + 1]} AWG`;
    }
    return "larger wire size";
}

// Reset function
function ccReset() {
    ccSetDefaultValues();
    
    // Reset example buttons
    if (ccExampleActive) {
        ccExampleActive.style.background = 'rgba(255,255,255,0.05)';
        ccExampleActive.style.border = '1px solid rgba(255,255,255,0.1)';
        ccExampleActive = null;
    }
    
    document.querySelectorAll('.cc-example-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
    });
    
    ccClearResults();
    
    // Focus on voltage input
    setTimeout(() => {
        document.getElementById('cc-voltage').focus();
        document.getElementById('cc-voltage').select();
    }, 50);
    
    console.log("Circuit calculator reset");
}

// Copy result
function ccCopyResult() {
    const result = document.getElementById('cc-result-display').textContent;
    const wireRec = document.getElementById('cc-recommended-wire')?.textContent || '';
    const dropCalc = document.getElementById('cc-drop-calculation')?.textContent || '';
    
    let text = `Circuit Calculator Results\n\n${result}`;
    if (wireRec) {
        text += `\n\nWire Recommendation:\n${wireRec}`;
    }
    if (dropCalc) {
        text += `\n\nVoltage Drop:\n${dropCalc}`;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const copyBtn = document.getElementById('cc-copy-btn');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.style.background = 'rgba(57,255,20,0.2)';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy. Please select and copy manually.');
    });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ccInit);
} else {
    setTimeout(ccInit, 100);
}
</script>
