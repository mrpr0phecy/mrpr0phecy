<!-- cards/grade-calculator.html -->

<h2 id="grade-calculator-title">Grade Calculator üìä</h2>

<form aria-describedby="grade-desc">
  <p id="grade-desc" class="small">Calculate weighted grades, predict final scores, and see what you need to achieve your target grade.</p>

  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
    <div>
      <label for="gc-category" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Category</label>
      <select id="gc-category" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="homework">üìù Homework</option>
        <option value="quiz">üìã Quiz</option>
        <option value="exam">üìö Exam</option>
        <option value="project">üé® Project</option>
        <option value="participation">üí¨ Participation</option>
        <option value="lab">üß™ Lab Work</option>
        <option value="presentation">üé§ Presentation</option>
        <option value="essay">‚úçÔ∏è Essay</option>
      </select>
    </div>
    
    <div>
      <label for="gc-name" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Item Name</label>
      <input id="gc-name" type="text" placeholder="e.g. Chapter 3 Quiz" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
    
    <div>
      <label for="gc-score" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Your Score</label>
      <div style="position:relative;">
        <input id="gc-score" type="number" min="0" max="100" step="0.1" placeholder="e.g. 85" 
               style="width:100%;padding:10px 30px 10px 10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        <span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);color:rgba(230,250,255,0.7);">%</span>
      </div>
    </div>
    
    <div>
      <label for="gc-weight" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Weight</label>
      <div style="position:relative;">
        <input id="gc-weight" type="number" min="0" max="100" step="0.1" placeholder="e.g. 15" 
               style="width:100%;padding:10px 30px 10px 10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        <span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);color:rgba(230,250,255,0.7);">%</span>
      </div>
    </div>
  </div>

  <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
    <button type="button" onclick="gcAddItem(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ‚ûï Add Grade Item
    </button>
    <button type="button" onclick="gcCalculate()"
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
      üßÆ Calculate Overall
    </button>
    <button type="button" onclick="gcResetForm(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset Form
    </button>
    <button type="button" onclick="gcClearAll()"
            style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:8px;color:#ff4d4d;cursor:pointer;">
      Clear All
    </button>
  </div>
</form>

<div aria-live="polite" style="margin-top:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìã Grade Items</h3>
  <div id="gc-items-list" style="max-height:300px;overflow-y:auto;padding-right:8px;">
    <!-- Grade items will appear here -->
    <div style="padding:30px;text-align:center;color:rgba(230,250,255,0.5);font-style:italic;">
      No grade items added yet. Add your first item above!
    </div>
  </div>
</div>

<div style="margin-top:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
  <h4 style="color:var(--accent);margin-top:0;margin-bottom:12px;">üìà Grade Analysis</h4>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;margin-bottom:16px;">
    <!-- Current Overall Grade -->
    <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;text-align:center;">
      <div style="color:var(--accent);font-size:13px;margin-bottom:4px;">Current Overall</div>
      <div style="font-size:32px;font-weight:600;color:#39ff14;" id="gc-current-overall">0%</div>
    </div>
    
    <!-- Total Weight Used -->
    <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;text-align:center;">
      <div style="color:#9d4edd;font-size:13px;margin-bottom:4px;">Weight Used</div>
      <div style="display:flex;align-items:baseline;justify-content:center;gap:4px;">
        <div style="font-size:32px;font-weight:600;color:#9d4edd;" id="gc-total-weight">0</div>
        <div style="color:rgba(230,250,255,0.7);font-size:14px;">%</div>
      </div>
    </div>
    
    <!-- Weight Remaining -->
    <div style="padding:12px;background:rgba(255,204,0,0.1);border-radius:8px;text-align:center;">
      <div style="color:#ffcc00;font-size:13px;margin-bottom:4px;">Weight Remaining</div>
      <div style="display:flex;align-items:baseline;justify-content:center;gap:4px;">
        <div style="font-size:32px;font-weight:600;color:#ffcc00;" id="gc-weight-remaining">100</div>
        <div style="color:rgba(230,250,255,0.7);font-size:14px;">%</div>
      </div>
    </div>
    
    <!-- Letter Grade -->
    <div style="padding:12px;background:rgba(255,107,157,0.1);border-radius:8px;text-align:center;">
      <div style="color:#ff6b9d;font-size:13px;margin-bottom:4px;">Letter Grade</div>
      <div style="font-size:32px;font-weight:600;color:#ff6b9d;" id="gc-letter-grade">‚Äì</div>
    </div>
  </div>
  
  <!-- Target Grade Calculator -->
  <div style="margin-top:16px;padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.2);">
    <div style="color:#39ff14;font-weight:600;margin-bottom:12px;">üéØ What do I need on remaining items?</div>
    
    <div style="display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;">
      <div>
        <label for="gc-target-grade" style="display:block;margin-bottom:6px;color:#39ff14;font-size:13px;">Target Grade (%)</label>
        <input id="gc-target-grade" type="number" min="0" max="100" value="70" 
               style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;" />
      </div>
      
      <button onclick="gcCalculateTarget()" 
              style="padding:10px 16px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;align-self:end;">
        Calculate
      </button>
    </div>
    
    <div id="gc-target-result" style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;display:none;">
      <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üìä Required Performance:</div>
      <div id="gc-target-text" style="font-size:14px;color:rgba(230,250,255,0.9);"></div>
    </div>
  </div>
</div>

<div style="margin-top:20px;padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.2);">
  <h4 style="color:#9d4edd;margin-top:0;margin-bottom:12px;">üìñ Grade Categories & Tips</h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;font-size:13px;">
    <div>
      <div style="color:#ff6b9d;font-weight:600;margin-bottom:4px;">A (90-100%)</div>
      <div style="color:rgba(230,250,255,0.8);">Excellent work. Shows mastery of all concepts.</div>
    </div>
    <div>
      <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">B (80-89%)</div>
      <div style="color:rgba(230,250,255,0.8);">Good work. Solid understanding with minor errors.</div>
    </div>
    <div>
      <div style="color:#2dd4ff;font-weight:600;margin-bottom:4px;">C (70-79%)</div>
      <div style="color:rgba(230,250,255,0.8);">Average. Understands basics but needs improvement.</div>
    </div>
    <div>
      <div style="color:#ff4d4d;font-weight:600;margin-bottom:4px;">D/F (0-69%)</div>
      <div style="color:rgba(230,250,255,0.8);">Needs significant improvement. Review fundamentals.</div>
    </div>
  </div>
</div>

<script>
/* grade-calculator.html
   - Weighted grade calculator with target grade prediction
   - Scoped with gc- prefix
*/

// Category configurations
const gradeCategories = {
  'homework': { emoji: 'üìù', color: '#2dd4ff' },
  'quiz': { emoji: 'üìã', color: '#9d4edd' },
  'exam': { emoji: 'üìö', color: '#ff6b9d' },
  'project': { emoji: 'üé®', color: '#ffcc00' },
  'participation': { emoji: 'üí¨', color: '#39ff14' },
  'lab': { emoji: 'üß™', color: '#ff9500' },
  'presentation': { emoji: 'üé§', color: '#8e44ad' },
  'essay': { emoji: '‚úçÔ∏è', color: '#00ff99' }
};

// Letter grade ranges
const letterGrades = [
  { range: [97, 100], grade: 'A+', color: '#39ff14' },
  { range: [93, 96.9], grade: 'A', color: '#39ff14' },
  { range: [90, 92.9], grade: 'A-', color: '#39ff14' },
  { range: [87, 89.9], grade: 'B+', color: '#ffcc00' },
  { range: [83, 86.9], grade: 'B', color: '#ffcc00' },
  { range: [80, 82.9], grade: 'B-', color: '#ffcc00' },
  { range: [77, 79.9], grade: 'C+', color: '#2dd4ff' },
  { range: [73, 76.9], grade: 'C', color: '#2dd4ff' },
  { range: [70, 72.9], grade: 'C-', color: '#2dd4ff' },
  { range: [67, 69.9], grade: 'D+', color: '#ff9500' },
  { range: [63, 66.9], grade: 'D', color: '#ff9500' },
  { range: [60, 62.9], grade: 'D-', color: '#ff9500' },
  { range: [0, 59.9], grade: 'F', color: '#ff4d4d' }
];

let gradeItems = [];
const STORAGE_KEY = 'grade-calculator-items';

// Load saved items
function gcLoad() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      gradeItems = JSON.parse(saved);
      gcRender();
      gcCalculate();
    }
  } catch (e) {
    console.error('Failed to load grade items:', e);
  }
}

// Save items
function gcSave() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(gradeItems));
  } catch (e) {
    console.error('Failed to save grade items:', e);
  }
}

// Add a grade item
function gcAddItem(btn) {
  const card = btn.closest('.card') || document;
  const category = card.querySelector('#gc-category').value;
  const name = card.querySelector('#gc-name').value.trim();
  const score = parseFloat(card.querySelector('#gc-score').value);
  const weight = parseFloat(card.querySelector('#gc-weight').value);

  if (!name || isNaN(score) || isNaN(weight)) {
    gcShowMessage(card, 'Please fill all fields', '#ff4d4d');
    return;
  }

  if (score < 0 || score > 100) {
    gcShowMessage(card, 'Score must be between 0-100%', '#ff4d4d');
    return;
  }

  if (weight < 0 || weight > 100) {
    gcShowMessage(card, 'Weight must be between 0-100%', '#ff4d4d');
    return;
  }

  const itemId = Date.now();
  gradeItems.push({
    id: itemId,
    category: category,
    name: name,
    score: score,
    weight: weight,
    weightedScore: (score * weight) / 100,
    date: new Date().toLocaleDateString()
  });
  
  gcRender();
  gcSave();
  
  // Reset form
  card.querySelector('#gc-name').value = '';
  card.querySelector('#gc-score').value = '';
  card.querySelector('#gc-weight').value = '';
  card.querySelector('#gc-name').focus();
  
  gcShowMessage(card, `‚úÖ "${name}" added`, '#39ff14');
}

// Render grade items
function gcRender() {
  const card = document.currentScript?.closest('.card') || document;
  const list = card.querySelector('#gc-items-list');
  
  if (gradeItems.length === 0) {
    list.innerHTML = `
      <div style="padding:30px;text-align:center;color:rgba(230,250,255,0.5);font-style:italic;">
        No grade items added yet. Add your first item above!
      </div>
    `;
    return;
  }
  
  let html = '';
  gradeItems.forEach((item, index) => {
    const category = gradeCategories[item.category] || gradeCategories['homework'];
    const percent = (item.score).toFixed(1);
    const letter = getLetterGrade(item.score);
    
    html += `
      <div class="grade-item" data-id="${item.id}" 
           style="background:rgba(255,255,255,0.03);border-left:3px solid ${category.color};margin-bottom:8px;padding:12px;border-radius:8px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-size:18px;">${category.emoji}</span>
            <div style="font-weight:600;color:var(--accent);">${item.name}</div>
          </div>
          <div>
            <button onclick="gcRemoveItem('${item.id}')" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px 8px;border-radius:4px;font-size:12px;">üóëÔ∏è</button>
          </div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;font-size:13px;">
          <div style="text-align:center;padding:6px;background:rgba(45,212,255,0.1);border-radius:6px;">
            <div style="color:var(--accent);font-size:11px;margin-bottom:2px;">Score</div>
            <div style="font-weight:600;color:#39ff14;">${percent}%</div>
          </div>
          <div style="text-align:center;padding:6px;background:rgba(157,78,221,0.1);border-radius:6px;">
            <div style="color:#9d4edd;font-size:11px;margin-bottom:2px;">Weight</div>
            <div style="font-weight:600;color:#9d4edd;">${item.weight}%</div>
          </div>
          <div style="text-align:center;padding:6px;background:rgba(255,107,157,0.1);border-radius:6px;">
            <div style="color:#ff6b9d;font-size:11px;margin-bottom:2px;">Letter</div>
            <div style="font-weight:600;color:${letter.color};">${letter.grade}</div>
          </div>
        </div>
        
        <div style="margin-top:6px;text-align:center;font-size:12px;color:rgba(230,250,255,0.7);">
          Contributes ${item.weightedScore.toFixed(2)} points to overall grade
        </div>
      </div>
    `;
  });
  
  list.innerHTML = html;
}

// Calculate overall grade
function gcCalculate() {
  if (gradeItems.length === 0) {
    // Reset displays
    document.getElementById('gc-current-overall').textContent = '0%';
    document.getElementById('gc-total-weight').textContent = '0';
    document.getElementById('gc-weight-remaining').textContent = '100';
    document.getElementById('gc-letter-grade').textContent = '‚Äì';
    return;
  }
  
  let totalWeightedScore = 0;
  let totalWeight = 0;
  
  gradeItems.forEach(item => {
    totalWeightedScore += item.weightedScore;
    totalWeight += item.weight;
  });
  
  // Calculate overall percentage
  const overallPercent = totalWeight > 0 ? (totalWeightedScore / totalWeight) * 100 : 0;
  const weightRemaining = Math.max(0, 100 - totalWeight);
  
  // Get letter grade
  const letter = getLetterGrade(overallPercent);
  
  // Update displays
  document.getElementById('gc-current-overall').textContent = `${overallPercent.toFixed(1)}%`;
  document.getElementById('gc-total-weight').textContent = totalWeight.toFixed(1);
  document.getElementById('gc-weight-remaining').textContent = weightRemaining.toFixed(1);
  document.getElementById('gc-letter-grade').textContent = letter.grade;
  document.getElementById('gc-letter-grade').style.color = letter.color;
}

// Calculate target grade
function gcCalculateTarget() {
  const targetGrade = parseFloat(document.getElementById('gc-target-grade').value);
  
  if (isNaN(targetGrade) || targetGrade < 0 || targetGrade > 100) {
    gcShowMessage(null, 'Please enter a valid target grade (0-100%)', '#ff4d4d');
    return;
  }
  
  // Calculate current weighted score and weight
  let currentWeightedScore = 0;
  let currentWeight = 0;
  
  gradeItems.forEach(item => {
    currentWeightedScore += item.weightedScore;
    currentWeight += item.weight;
  });
  
  const weightRemaining = 100 - currentWeight;
  
  if (weightRemaining <= 0) {
    gcShowMessage(null, 'No weight remaining. Course is complete.', '#ff4d4d');
    return;
  }
  
  // Calculate required score on remaining weight
  const totalPointsNeeded = targetGrade; // Since target is percentage of 100%
  const pointsFromCurrent = currentWeightedScore;
  const pointsNeededFromRemaining = totalPointsNeeded - pointsFromCurrent;
  const requiredPercentage = (pointsNeededFromRemaining / weightRemaining) * 100;
  
  // Display result
  const resultDiv = document.getElementById('gc-target-result');
  const resultText = document.getElementById('gc-target-text');
  
  resultDiv.style.display = 'block';
  
  if (requiredPercentage > 100) {
    resultText.innerHTML = `
      <div style="color:#ff4d4d;margin-bottom:6px;">‚ö†Ô∏è Target may not be achievable</div>
      <div>You would need <strong style="color:#ff4d4d;">${requiredPercentage.toFixed(1)}%</strong> on the remaining <strong>${weightRemaining.toFixed(1)}%</strong> weight.</div>
      <div style="margin-top:4px;font-size:12px;color:rgba(230,250,255,0.7);">Consider focusing on maximum scores on remaining items.</div>
    `;
  } else if (requiredPercentage < 0) {
    resultText.innerHTML = `
      <div style="color:#39ff14;margin-bottom:6px;">üéâ Target already achieved!</div>
      <div>You're already above your target grade!</div>
      <div style="margin-top:4px;font-size:12px;color:rgba(230,250,255,0.7);">Great work! You can maintain or improve your grade.</div>
    `;
  } else {
    const targetLetter = getLetterGrade(requiredPercentage);
    resultText.innerHTML = `
      <div style="color:#39ff14;margin-bottom:6px;">üìä Required Performance</div>
      <div>You need an average of <strong style="color:#39ff14;">${requiredPercentage.toFixed(1)}%</strong> on the remaining <strong>${weightRemaining.toFixed(1)}%</strong> weight.</div>
      <div style="margin-top:4px;font-size:12px;color:rgba(230,250,255,0.7);">
        That's equivalent to a <strong style="color:${targetLetter.color};">${targetLetter.grade}</strong> on remaining items.
      </div>
    `;
  }
}

// Remove a grade item
function gcRemoveItem(itemId) {
  gradeItems = gradeItems.filter(item => item.id != itemId);
  gcRender();
  gcSave();
  gcCalculate();
}

// Reset form
function gcResetForm(btn) {
  const card = btn.closest('.card') || document;
  card.querySelector('#gc-name').value = '';
  card.querySelector('#gc-score').value = '';
  card.querySelector('#gc-weight').value = '';
  card.querySelector('#gc-name').focus();
}

// Clear all items
function gcClearAll() {
  if (gradeItems.length === 0) return;
  
  if (confirm('Are you sure you want to clear all grade items?')) {
    gradeItems = [];
    gcRender();
    gcSave();
    gcCalculate();
    
    const card = document.currentScript?.closest('.card') || document;
    gcShowMessage(card, '‚úÖ All grade items cleared', '#39ff14');
  }
}

// Helper function to get letter grade
function getLetterGrade(percentage) {
  for (const grade of letterGrades) {
    if (percentage >= grade.range[0] && percentage <= grade.range[1]) {
      return grade;
    }
  }
  return letterGrades[letterGrades.length - 1]; // Default to F
}

function gcShowMessage(card, message, color = '#2dd4ff') {
  const messageDiv = document.createElement('div');
  messageDiv.textContent = message;
  messageDiv.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(20,20,20,0.95);
    color: ${color};
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid ${color}40;
    z-index: 10000;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `;
  
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.style.opacity = '0';
    messageDiv.style.transform = 'translateX(20px)';
    setTimeout(() => {
      if (messageDiv.parentNode) {
        document.body.removeChild(messageDiv);
      }
    }, 300);
  }, 2000);
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(gcLoad, 100);
  });
} else {
  setTimeout(gcLoad, 100);
}
</script>

<style>
#grade-calculator-title {
  color: var(--accent);
  margin-top: 0;
  border-bottom: 1px solid rgba(45,212,255,0.2);
  padding-bottom: 10px;
  margin-bottom: 16px;
}

.grade-item {
  transition: all 0.2s ease;
}

.grade-item:hover {
  background: rgba(45,212,255,0.05) !important;
  transform: translateX(2px);
}

#gc-items-list::-webkit-scrollbar {
  width: 6px;
}

#gc-items-list::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#gc-items-list::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}

@media (max-width: 768px) {
  div[style*="grid-template-columns:repeat(auto-fit"] {
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  
  div[style*="grid-template-columns:1fr auto"] {
    grid-template-columns: 1fr !important;
  }
  
  div[style*="grid-template-columns:1fr 1fr 1fr"] {
    grid-template-columns: 1fr !important;
    gap: 6px !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin-bottom: 8px;
  }
}
</style>
