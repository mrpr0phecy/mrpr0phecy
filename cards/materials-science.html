<h2 id="materials-science-title">Materials Science Tools & Facts</h2>

<form aria-describedby="materials-science-desc">
  <p id="materials-science-desc" class="small">
    Calculate material properties and explore fascinating facts about metals, polymers, and composites.
    <span style="color:var(--accent)">Uses real material properties from established databases.</span>
  </p>

  <!-- INPUT SECTION - NO EXTRA WRAPPERS -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
    <div class="field">
      <label for="ms-tool" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Tool Selection
      </label>
      <select id="ms-tool" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
        <option value="density" selected>Density (œÅ = m/V)</option>
        <option value="stress">Stress (œÉ = F/A)</option>
        <option value="strain">Strain (Œµ = ŒîL/L)</option>
        <option value="youngs-modulus">Young's Modulus (E = œÉ/Œµ)</option>
        <option value="hardness">Hardness Conversion</option>
        <option value="thermal-expansion">Thermal Expansion (Œ± = ŒîL/LŒîT)</option>
        <option value="conductivity">Electrical/Heat Conductivity</option>
        <option value="specific-heat">Specific Heat Capacity</option>
      </select>
    </div>

    <div class="field">
      <label for="ms-material" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Material Type
      </label>
      <select id="ms-material" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
        <option value="custom">Custom Values</option>
        <option value="steel">Steel</option>
        <option value="aluminum">Aluminum</option>
        <option value="copper">Copper</option>
        <option value="titanium">Titanium</option>
        <option value="glass">Glass</option>
        <option value="concrete">Concrete</option>
        <option value="wood-pine">Wood (Pine)</option>
        <option value="plastic-pet">Plastic (PET)</option>
        <option value="rubber">Rubber</option>
      </select>
    </div>
  </div>

  <!-- PARAMETER INPUTS - DYNAMICALLY SHOWN -->
  <div id="ms-params-container" style="margin-bottom:16px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Enter Values (comma-separated, e.g., m=10,V=2):</div>
    <input id="ms-values" type="text" placeholder="e.g., m=10, V=2, F=200, A=50, L=100, ŒîL=2, ŒîT=50" 
           style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
  </div>

  <!-- QUICK EXAMPLES -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Examples:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="msExample('density')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Density Example</button>
      <button type="button" onclick="msExample('stress')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Stress Example</button>
      <button type="button" onclick="msExample('youngs')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Young's Example</button>
      <button type="button" onclick="msExample('expansion')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Thermal Example</button>
    </div>
  </div>

  <!-- ACTIONS - USING THEME COLORS -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="msCalculate(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      Calculate
    </button>
    <button type="button" onclick="msReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="msCopy(this)"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      Copy Result
    </button>
  </div>
</form>

<!-- RESULTS - ARIA LIVE FOR ACCESSIBILITY -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üß™ Materials Science Results</h3>
  <textarea id="ms-output" rows="8" 
            style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:monospace;font-size:14px;line-height:1.4;"
            readonly></textarea>

  <!-- MATERIAL FACTS - CONDITIONAL DISPLAY -->
  <div id="ms-facts-container" style="margin-top:16px;display:none;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
    <h4 style="color:var(--accent);margin:0 0 8px 0;font-size:15px;">üìö Materials Science Facts:</h4>
    <div id="ms-facts-content" style="font-size:14px;line-height:1.5;color:rgba(230,250,255,0.9);">
      <!-- Facts will be inserted here -->
    </div>
  </div>

  <!-- HINT AND STATUS -->
  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div id="ms-hint" class="small" style="color:#39ff14;font-size:13px;flex:1;"></div>
    <div style="display:flex;align-items:center;gap:8px;">
      <label style="display:flex;align-items:center;gap:4px;font-size:13px;color:rgba(230,250,255,0.8);cursor:pointer;">
        <input type="checkbox" id="ms-show-facts" checked style="cursor:pointer;">
        Show Materials Facts
      </label>
    </div>
  </div>
</div>

<script>
/* materials-science.html
   - Calculates material properties and shows facts
   - Scoped with ms- prefix (materials science)
   - Uses theme colors and follows manual guidelines
*/

// MATERIAL DATABASE
const msMaterialsDB = {
  'steel': {
    density: 7850, // kg/m¬≥
    youngsModulus: 200e9, // Pa
    tensileStrength: 400e6, // Pa
    thermalExpansion: 12e-6, // 1/K
    thermalConductivity: 50, // W/(m¬∑K)
    specificHeat: 450, // J/(kg¬∑K)
    hardnessVickers: 150,
    facts: [
      'Steel is an alloy of iron and carbon, with carbon content up to 2.1% by weight.',
      'Adding chromium (>10.5%) creates stainless steel, resistant to corrosion.',
      'World steel production exceeds 1.8 billion tonnes annually.',
      'The Eiffel Tower contains about 7,300 tonnes of wrought iron, a form of steel.',
      'Steel is 100% recyclable without loss of quality.'
    ]
  },
  'aluminum': {
    density: 2700,
    youngsModulus: 69e9,
    tensileStrength: 90e6,
    thermalExpansion: 23e-6,
    thermalConductivity: 237,
    specificHeat: 900,
    hardnessVickers: 25,
    facts: [
      'Aluminum is the most abundant metal in Earth\'s crust (8.3%).',
      'Despite its abundance, it was once more valuable than gold (19th century).',
      'Aluminum oxide (alumina) forms a protective layer preventing further oxidation.',
      'Recycling aluminum uses only 5% of the energy needed for primary production.',
      'The Washington Monument is capped with a 2.8 kg aluminum pyramid.'
    ]
  },
  'copper': {
    density: 8960,
    youngsModulus: 110e9,
    tensileStrength: 210e6,
    thermalExpansion: 17e-6,
    thermalConductivity: 401,
    specificHeat: 385,
    hardnessVickers: 45,
    facts: [
      'Copper has been used for over 10,000 years, dating back to 9000 BC.',
      'It is an excellent conductor: 97% of electrical conductivity of silver.',
      'The Statue of Liberty contains 81 tonnes of copper, now covered with patina.',
      'Copper has natural antimicrobial properties, killing bacteria on contact.',
      'A single copper penny (pre-1982) contains about 0.88 grams of copper.'
    ]
  },
  'glass': {
    density: 2500,
    youngsModulus: 70e9,
    tensileStrength: 30e6,
    thermalExpansion: 8.5e-6,
    thermalConductivity: 1.05,
    specificHeat: 840,
    hardnessMohs: 5.5,
    facts: [
      'Glass is an amorphous solid, lacking long-range crystalline order.',
      'Obsidian (volcanic glass) was used for tools and weapons in prehistoric times.',
      'Float glass process, invented in 1959, produces flat glass by floating on molten tin.',
      'Gorilla Glass, used in smartphones, is chemically strengthened through ion exchange.',
      'Some glasses (like Vycor) can be up to 96% silica, with very low thermal expansion.'
    ]
  },
  'concrete': {
    density: 2400,
    youngsModulus: 30e9,
    compressiveStrength: 25e6,
    thermalExpansion: 12e-6,
    thermalConductivity: 1.7,
    specificHeat: 880,
    facts: [
      'Concrete is the second most consumed substance on Earth after water.',
      'Roman concrete (opus caementicium) still stands after 2000+ years.',
      'Modern concrete often contains fly ash (waste from coal plants) to improve properties.',
      'The Three Gorges Dam used 27.2 million cubic meters of concrete.',
      'Ultra-high-performance concrete (UHPC) can reach compressive strengths over 150 MPa.'
    ]
  }
};

// Function to parse comma-separated values
function parseMs(str) {
  const vals = {};
  if (!str) return vals;
  
  str.split(',').forEach(pair => {
    const trimmed = pair.trim();
    const eqIndex = trimmed.indexOf('=');
    if (eqIndex > 0) {
      const key = trimmed.substring(0, eqIndex).trim();
      const value = parseFloat(trimmed.substring(eqIndex + 1));
      if (!isNaN(value)) {
        vals[key] = value;
      }
    }
  });
  return vals;
}

// Calculate based on selected tool
function msCalculate(btn) {
  const card = btn.closest('.card') || document;
  const tool = card.querySelector('#ms-tool').value;
  const material = card.querySelector('#ms-material').value;
  const values = parseMs(card.querySelector('#ms-values').value || '');
  const showFacts = card.querySelector('#ms-show-facts').checked;
  
  let result = '';
  let hint = '';
  
  // Use material properties if not custom
  const materialProps = msMaterialsDB[material];
  
  switch (tool) {
    case 'density':
      if (values.m && values.V) {
        const density = values.m / values.V;
        result = `Density Calculation:\n`;
        result += `Mass (m) = ${values.m} kg\n`;
        result += `Volume (V) = ${values.V} m¬≥\n`;
        result += `Density (œÅ) = m/V = ${density.toFixed(2)} kg/m¬≥\n`;
        if (materialProps) {
          result += `\nReference: ${material.charAt(0).toUpperCase() + material.slice(1)} density = ${materialProps.density} kg/m¬≥`;
          const diff = ((density - materialProps.density) / materialProps.density * 100).toFixed(1);
          result += ` (Difference: ${diff}%)`;
        }
      } else {
        result = 'Enter values: m=mass (kg), V=volume (m¬≥)';
      }
      break;
      
    case 'stress':
      if (values.F && values.A) {
        const stress = values.F / values.A;
        result = `Stress Calculation:\n`;
        result += `Force (F) = ${values.F} N\n`;
        result += `Area (A) = ${values.A} m¬≤\n`;
        result += `Stress (œÉ) = F/A = ${stress.toFixed(2)} Pa\n`;
        if (materialProps && materialProps.tensileStrength) {
          const ratio = (stress / materialProps.tensileStrength * 100).toFixed(1);
          result += `\n${ratio}% of ${material.charAt(0).toUpperCase() + material.slice(1)} tensile strength (${(materialProps.tensileStrength/1e6).toFixed(0)} MPa)`;
        }
      } else {
        result = 'Enter values: F=force (N), A=cross-sectional area (m¬≤)';
      }
      break;
      
    case 'strain':
      if (values['ŒîL'] && values.L) {
        const strain = values['ŒîL'] / values.L;
        result = `Strain Calculation:\n`;
        result += `Length change (ŒîL) = ${values['ŒîL']} m\n`;
        result += `Original length (L) = ${values.L} m\n`;
        result += `Strain (Œµ) = ŒîL/L = ${strain.toFixed(6)}\n`;
        result += `Percent strain = ${(strain * 100).toFixed(3)}%`;
      } else {
        result = 'Enter values: ŒîL=length change (m), L=original length (m)';
      }
      break;
      
    case 'youngs-modulus':
      if (values.F && values.A && values['ŒîL'] && values.L) {
        const stress = values.F / values.A;
        const strain = values['ŒîL'] / values.L;
        const youngs = stress / strain;
        result = `Young's Modulus Calculation:\n`;
        result += `Stress (œÉ) = ${stress.toFixed(2)} Pa\n`;
        result += `Strain (Œµ) = ${strain.toFixed(6)}\n`;
        result += `Young's Modulus (E) = œÉ/Œµ = ${youngs.toFixed(2)} Pa\n`;
        if (materialProps && materialProps.youngsModulus) {
          const ratio = (youngs / materialProps.youngsModulus * 100).toFixed(1);
          result += `\n${ratio}% of ${material.charAt(0).toUpperCase() + material.slice(1)} Young's modulus (${(materialProps.youngsModulus/1e9).toFixed(0)} GPa)`;
        }
      } else {
        result = 'Enter values: F=force (N), A=area (m¬≤), ŒîL=length change (m), L=original length (m)';
      }
      break;
      
    case 'thermal-expansion':
      if (values['ŒîL'] && values.L && values['ŒîT']) {
        const alpha = values['ŒîL'] / (values.L * values['ŒîT']);
        result = `Thermal Expansion Calculation:\n`;
        result += `Length change (ŒîL) = ${values['ŒîL']} m\n`;
        result += `Original length (L) = ${values.L} m\n`;
        result += `Temperature change (ŒîT) = ${values['ŒîT']} K\n`;
        result += `Coefficient (Œ±) = ŒîL/(L¬∑ŒîT) = ${alpha.toExponential(2)} 1/K\n`;
        if (materialProps && materialProps.thermalExpansion) {
          const ratio = (alpha / materialProps.thermalExpansion * 100).toFixed(1);
          result += `\n${ratio}% of ${material.charAt(0).toUpperCase() + material.slice(1)} thermal expansion coefficient (${materialProps.thermalExpansion.toExponential(2)} 1/K)`;
        }
      } else {
        result = 'Enter values: ŒîL=length change (m), L=original length (m), ŒîT=temperature change (K)';
      }
      break;
      
    default:
      result = 'Select a tool and enter required values.';
  }
  
  // Update output
  const output = card.querySelector('#ms-output');
  output.value = result;
  
  // Show hint
  hint = '‚úì Calculation complete.';
  const hintEl = card.querySelector('#ms-hint');
  hintEl.textContent = hint;
  setTimeout(() => {
    if (hintEl.textContent === hint) hintEl.textContent = '';
  }, 3000);
  
  // Show facts if enabled
  const factsContainer = card.querySelector('#ms-facts-container');
  const factsContent = card.querySelector('#ms-facts-content');
  
  if (showFacts && materialProps && materialProps.facts) {
    factsContent.innerHTML = materialProps.facts.map(fact => 
      `<div style="margin-bottom:6px;padding-left:4px;border-left:2px solid var(--accent);">${fact}</div>`
    ).join('');
    factsContainer.style.display = 'block';
  } else {
    factsContainer.style.display = 'none';
  }
}

// Reset function
function msReset(btn) {
  const card = btn.closest('.card') || document;
  card.querySelector('#ms-values').value = '';
  card.querySelector('#ms-output').value = '';
  card.querySelector('#ms-hint').textContent = '';
  card.querySelector('#ms-facts-container').style.display = 'none';
  card.querySelector('#ms-tool').selectedIndex = 0;
  card.querySelector('#ms-material').selectedIndex = 0;
  card.querySelector('#ms-show-facts').checked = true;
}

// Copy function
function msCopy(btn) {
  const card = btn.closest('.card') || document;
  const output = card.querySelector('#ms-output').value;
  if (!output.trim()) return;
  
  navigator.clipboard.writeText(output).then(() => {
    const hint = card.querySelector('#ms-hint');
    hint.textContent = '‚úÖ Copied to clipboard!';
    hint.style.color = '#39ff14';
    setTimeout(() => {
      if (hint.textContent === '‚úÖ Copied to clipboard!') {
        hint.textContent = '';
      }
    }, 2000);
  }).catch(() => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = output;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      const hint = card.querySelector('#ms-hint');
      hint.textContent = '‚úÖ Copied!';
      setTimeout(() => { hint.textContent = ''; }, 2000);
    } catch (err) {
      alert('Copy failed. Please select and copy manually.');
    }
    document.body.removeChild(textArea);
  });
}

// Example loader
function msExample(type) {
  const card = document.currentScript?.closest('.card') || document;
  const valuesInput = card.querySelector('#ms-values');
  const toolSelect = card.querySelector('#ms-tool');
  const materialSelect = card.querySelector('#ms-material');
  
  switch (type) {
    case 'density':
      valuesInput.value = 'm=10, V=0.002';
      toolSelect.value = 'density';
      materialSelect.value = 'steel';
      break;
    case 'stress':
      valuesInput.value = 'F=10000, A=0.0001';
      toolSelect.value = 'stress';
      materialSelect.value = 'aluminum';
      break;
    case 'youngs':
      valuesInput.value = 'F=10000, A=0.0001, ŒîL=0.001, L=1';
      toolSelect.value = 'youngs-modulus';
      materialSelect.value = 'steel';
      break;
    case 'expansion':
      valuesInput.value = 'ŒîL=0.001, L=1, ŒîT=50';
      toolSelect.value = 'thermal-expansion';
      materialSelect.value = 'copper';
      break;
  }
  
  // Trigger calculation
  setTimeout(() => msCalculate(card.querySelector('[onclick="msCalculate(this)"]')), 100);
}

// Update hint when tool changes
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    
    card.querySelector('#ms-tool').addEventListener('change', function() {
      const tool = this.value;
      let hint = '';
      
      switch (tool) {
        case 'density': hint = 'Enter: m=mass (kg), V=volume (m¬≥)'; break;
        case 'stress': hint = 'Enter: F=force (N), A=area (m¬≤)'; break;
        case 'strain': hint = 'Enter: ŒîL=length change (m), L=original length (m)'; break;
        case 'youngs-modulus': hint = 'Enter: F=force (N), A=area (m¬≤), ŒîL=length change (m), L=original length (m)'; break;
        case 'thermal-expansion': hint = 'Enter: ŒîL=length change (m), L=original length (m), ŒîT=temperature change (K)'; break;
        default: hint = 'Select a material type for reference values';
      }
      
      card.querySelector('#ms-hint').textContent = hint;
    });
    
    // Auto-calculate when material is selected (if values exist)
    card.querySelector('#ms-material').addEventListener('change', function() {
      if (card.querySelector('#ms-values').value.trim()) {
        setTimeout(() => msCalculate(card.querySelector('[onclick="msCalculate(this)"]')), 300);
      }
    });
    
    console.log('Materials Science tool initialized');
  });
}
</script>

<!-- CARD-SPECIFIC STYLES -->
<style>
#materials-science-title {
  color: var(--accent);
  margin-top: 0;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  #ms-params-container {
    grid-template-columns: 1fr !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin: 4px 0 !important;
  }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  #ms-output {
    background: rgba(0, 0, 0, 0.3) !important;
  }
  
  #ms-facts-container {
    background: rgba(255, 255, 255, 0.03) !important;
  }
}
</style>
