<h2 id="conduit-sizing-title" style="margin-top:0;color:var(--accent);">âš¡ Conduit Sizing Calculator</h2>

<form aria-describedby="conduit-sizing-desc" style="margin-bottom:20px;">
  <p id="conduit-sizing-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:16px;">
    Calculate conduit sizes based on NEC requirements, wire types, and installation conditions.
    <span style="color:var(--accent);display:block;margin-top:4px;">
      âš ï¸ <strong>Disclaimer:</strong> For educational purposes. Always consult NEC codebook and licensed electrician.
    </span>
  </p>

  <!-- Conductor Configuration -->
  <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(45,212,255,0.1);">
    <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:16px;">ğŸ”Œ Conductor Configuration</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="cond-wire-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ“ Wire Type
        </label>
        <select id="cond-wire-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="thhn" selected>THHN/THWN-2 (Common)</option>
          <option value="xhhw">XHHW (High Temp)</option>
          <option value="uf">UF (Underground)</option>
          <option value="nm">NM-B (Romex)</option>
          <option value="service">Service Entrance (SE)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="cond-wire-size" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          âš¡ Wire Gauge (AWG/kcmil)
        </label>
        <select id="cond-wire-size" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="14">14 AWG</option>
          <option value="12" selected>12 AWG</option>
          <option value="10">10 AWG</option>
          <option value="8">8 AWG</option>
          <option value="6">6 AWG</option>
          <option value="4">4 AWG</option>
          <option value="2">2 AWG</option>
          <option value="1">1 AWG</option>
          <option value="1/0">1/0</option>
          <option value="2/0">2/0</option>
          <option value="3/0">3/0</option>
          <option value="4/0">4/0</option>
          <option value="250">250 kcmil</option>
          <option value="300">300 kcmil</option>
          <option value="350">350 kcmil</option>
          <option value="400">400 kcmil</option>
          <option value="500">500 kcmil</option>
        </select>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <div class="field">
        <label for="cond-count" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ”¢ Number of Conductors
        </label>
        <input id="cond-count" type="range" min="1" max="30" step="1" value="3"
               oninput="condUpdateDisplay('count', this.value)"
               style="width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(57,255,20,0.6) 0%, rgba(57,255,20,0.3) 100%);outline:none;">
        <div style="display:flex;justify-content:space-between;margin-top:4px;">
          <span style="font-size:11px;color:rgba(230,250,255,0.6);">1</span>
          <span id="cond-count-display" style="font-weight:600;color:#39ff14;">3</span>
          <span style="font-size:11px;color:rgba(230,250,255,0.6);">30</span>
        </div>
      </div>

      <div class="field">
        <label for="cond-grounds" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          âš¡ Ground Wires
        </label>
        <select id="cond-grounds" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:inherit;">
          <option value="0">No ground</option>
          <option value="1" selected>1 ground</option>
          <option value="2">2 grounds</option>
          <option value="3">3 grounds</option>
        </select>
      </div>

      <div class="field">
        <label for="cond-voltage" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          âš¡ Voltage System
        </label>
        <select id="cond-voltage" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;">
          <option value="120">120V Single Phase</option>
          <option value="120240" selected>120/240V Split Phase</option>
          <option value="208">208V 3-Phase</option>
          <option value="240">240V 3-Phase</option>
          <option value="480">480V 3-Phase</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Conduit Configuration -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.1);">
    <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:16px;">ğŸ“ Conduit Configuration</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="cond-conduit-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ› ï¸ Conduit Material
        </label>
        <select id="cond-conduit-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="emt" selected>EMT (Electrical Metallic Tubing)</option>
          <option value="imc">IMC (Intermediate Metal Conduit)</option>
          <option value="rigid">Rigid Metal Conduit (RMC)</option>
          <option value="pvc40">PVC Schedule 40</option>
          <option value="pvc80">PVC Schedule 80</option>
          <option value="flex">Flexible Metal Conduit (FMC)</option>
          <option value="lfmc">Liquidtight Flexible Metal (LFMC)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="cond-fill-rule" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ“Š NEC Fill Rule (%)
        </label>
        <select id="cond-fill-rule" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
          <option value="53">1 wire: 53% fill</option>
          <option value="31">2 wires: 31% fill</option>
          <option value="40" selected>3+ wires: 40% fill</option>
          <option value="over40">Custom fill %</option>
        </select>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="cond-run-length" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ“ Run Length (feet)
        </label>
        <input id="cond-run-length" type="number" min="1" max="500" value="50"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:inherit;">
      </div>

      <div class="field">
        <label for="cond-bends" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ”„ Number of Bends
        </label>
        <select id="cond-bends" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;">
          <option value="0" selected>Straight run (0-2 bends)</option>
          <option value="1">1 major bend (90Â° elbow)</option>
          <option value="2">2 bends (pull box required)</option>
          <option value="3">3+ bends (use pull boxes)</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Installation Conditions -->
  <div style="margin-bottom:16px;">
    <details style="border:1px solid rgba(255,255,255,0.1);border-radius:8px;overflow:hidden;">
      <summary style="padding:12px 16px;background:rgba(255,255,255,0.05);cursor:pointer;color:var(--accent);font-weight:500;list-style:none;">
        ğŸŒ¡ï¸ Installation Conditions
      </summary>
      <div style="padding:16px;background:rgba(0,0,0,0.2);">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
          <div class="field">
            <label for="cond-temperature" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸŒ¡ï¸ Ambient Temperature (Â°F)
            </label>
            <select id="cond-temperature" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:inherit;">
              <option value="30">30Â°F (Very Cold)</option>
              <option value="60">60Â°F (Cool)</option>
              <option value="86" selected>86Â°F (Standard)</option>
              <option value="104">104Â°F (Hot)</option>
              <option value="122">122Â°F (Very Hot)</option>
            </select>
          </div>
          
          <div class="field">
            <label for="cond-conductors-bundle" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ”— Conductors in Raceway
            </label>
            <select id="cond-conductors-bundle" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
              <option value="1-3">1-3 current-carrying</option>
              <option value="4-6" selected>4-6 current-carrying</option>
              <option value="7-9">7-9 current-carrying</option>
              <option value="10-20">10-20 current-carrying</option>
              <option value="21-30">21-30 current-carrying</option>
            </select>
          </div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div class="field">
            <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ“ Installation Location
            </label>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;">
                <input type="checkbox" name="cond-location" value="damp" style="accent-color:var(--accent);">
                Damp location
              </label>
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;">
                <input type="checkbox" name="cond-location" value="wet" style="accent-color:var(--accent);">
                Wet location
              </label>
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;">
                <input type="checkbox" name="cond-location" value="direct-burial" style="accent-color:var(--accent);">
                Direct burial
              </label>
            </div>
          </div>
          
          <div class="field">
            <label for="cond-derating" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ“‰ Derating Factor
            </label>
            <div style="display:flex;align-items:center;gap:8px;">
              <input id="cond-derating" type="range" min="70" max="100" step="5" value="100"
                     oninput="condUpdateDisplay('derating', this.value)"
                     style="flex:1;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(255,77,77,0.6) 0%, rgba(255,77,77,0.3) 100%);outline:none;">
              <span id="cond-derating-display" style="font-weight:600;color:#ff4d4d;min-width:40px;text-align:right;">100%</span>
            </div>
          </div>
        </div>
      </div>
    </details>
  </div>

  <!-- Quick Scenarios -->
  <div style="margin-bottom:20px;">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;font-size:14px;">ğŸš€ Common Scenarios</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="condLoadScenario('residential')" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">ğŸ  Residential Circuit</button>
      <button type="button" onclick="condLoadScenario('commercial')" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">ğŸ¢ Commercial Feed</button>
      <button type="button" onclick="condLoadScenario('motor')" style="padding:8px 12px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">âš™ï¸ Motor Circuit</button>
      <button type="button" onclick="condLoadScenario('service')" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">ğŸ”Œ Service Entrance</button>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="condCalculate()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ğŸ§® Calculate Conduit Size
    </button>
    <button type="button" onclick="condReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset
    </button>
    <button type="button" onclick="condExport()"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      ğŸ“‹ Export Results
    </button>
  </div>
</form>

<!-- Results Section -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:var(--accent);margin:0;">ğŸ“Š Conduit Sizing Results</h3>
    <div id="cond-status" style="font-size:12px;color:rgba(230,250,255,0.7);"></div>
  </div>

  <!-- Quick Results -->
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px;">
    <div style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:14px;font-weight:600;color:var(--accent);" id="cond-stat-size">â€“</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Minimum Conduit</div>
    </div>
    <div style="background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:14px;font-weight:600;color:#39ff14;" id="cond-stat-fill">â€“</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Fill Percentage</div>
    </div>
    <div style="background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:14px;font-weight:600;color:#ffa500;" id="cond-stat-area">â€“</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Total Area</div>
    </div>
    <div style="background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:14px;font-weight:600;color:#ff4d4d;" id="cond-stat-csa">â€“</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Conduit CSA</div>
    </div>
  </div>

  <!-- Detailed Results -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:16px;margin-bottom:16px;">
    <h4 style="color:var(--accent);margin:0 0 12px 0;font-size:14px;">ğŸ“ Calculation Details</h4>
    <textarea id="cond-output" rows="12" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.4);color:inherit;font-family:'Courier New',monospace;font-size:13px;resize:vertical;"></textarea>
  </div>

  <!-- NEC Code References -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;margin-bottom:16px;">
    <h4 style="color:var(--accent);margin:0 0 8px 0;font-size:14px;">ğŸ“š NEC Code References</h4>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:12px;">
      <div>
        <div style="color:rgba(230,250,255,0.8);margin-bottom:4px;">
          â€¢ <strong>NEC 300.17:</strong> Number of conductors in raceway
        </div>
        <div style="color:rgba(230,250,255,0.8);margin-bottom:4px;">
          â€¢ <strong>NEC 310.15:</strong> Ampacity adjustments
        </div>
        <div style="color:rgba(230,250,255,0.8);">
          â€¢ <strong>NEC 334.80:</strong> Conductor ampacity
        </div>
      </div>
      <div>
        <div style="color:rgba(230,250,255,0.8);margin-bottom:4px;">
          â€¢ <strong>NEC 352.22:</strong> PVC conduit fill
        </div>
        <div style="color:rgba(230,250,255,0.8);margin-bottom:4px;">
          â€¢ <strong>NEC 358.22:</strong> EMT conduit fill
        </div>
        <div style="color:rgba(230,250,255,0.8);">
          â€¢ <strong>NEC Annex C:</strong> Conduit fill tables
        </div>
      </div>
    </div>
  </div>

  <!-- Conduit Size Chart -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;">
    <h4 style="color:var(--accent);margin:0 0 8px 0;font-size:14px;">ğŸ“ Standard Conduit Sizes</h4>
    <div style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:11px;">
        <thead>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
            <th style="padding:6px;text-align:left;color:var(--accent);">Trade Size</th>
            <th style="padding:6px;text-align:right;color:#39ff14;">ID (inches)</th>
            <th style="padding:6px;text-align:right;color:#ffa500;">Area (inÂ²)</th>
            <th style="padding:6px;text-align:right;color:#ff4d4d;">Max Fill 40%</th>
            <th style="padding:6px;text-align:right;color:var(--accent);">Typical Use</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
            <td style="padding:6px;color:rgba(230,250,255,0.9);">1/2"</td>
            <td style="padding:6px;text-align:right;color:#39ff14;">0.622</td>
            <td style="padding:6px;text-align:right;color:#ffa500;">0.304</td>
            <td style="padding:6px;text-align:right;color:#ff4d4d;">0.122</td>
            <td style="padding:6px;text-align:right;color:rgba(230,250,255,0.7);">Residential circuits</td>
          </tr>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
            <td style="padding:6px;color:rgba(230,250,255,0.9);">3/4"</td>
            <td style="padding:6px;text-align:right;color:#39ff14;">0.824</td>
            <td style="padding:6px;text-align:right;color:#ffa500;">0.533</td>
            <td style="padding:6px;text-align:right;color:#ff4d4d;">0.213</td>
            <td style="padding:6px;text-align:right;color:rgba(230,250,255,0.7);">Small feeders</td>
          </tr>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
            <td style="padding:6px;color:rgba(230,250,255,0.9);">1"</td>
            <td style="padding:6px;text-align:right;color:#39ff14;">1.049</td>
            <td style="padding:6px;text-align:right;color:#ffa500;">0.864</td>
            <td style="padding:6px;text-align:right;color:#ff4d4d;">0.346</td>
            <td style="padding:6px;text-align:right;color:rgba(230,250,255,0.7);">Commercial circuits</td>
          </tr>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
            <td style="padding:6px;color:rgba(230,250,255,0.9);">1Â¼"</td>
            <td style="padding:6px;text-align:right;color:#39ff14;">1.380</td>
            <td style="padding:6px;text-align:right;color:#ffa500;">1.496</td>
            <td style="padding:6px;text-align:right;color:#ff4d4d;">0.598</td>
            <td style="padding:6px;text-align:right;color:rgba(230,250,255,0.7);">Large feeders</td>
          </tr>
          <tr>
            <td style="padding:6px;color:rgba(230,250,255,0.9);">1Â½"</td>
            <td style="padding:6px;text-align:right;color:#39ff14;">1.610</td>
            <td style="padding:6px;text-align:right;color:#ffa500;">2.036</td>
            <td style="padding:6px;text-align:right;color:#ff4d4d;">0.814</td>
            <td style="padding:6px;text-align:right;color:rgba(230,250,255,0.7);">Service entrance</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Warning Banner -->
<div style="margin-top:24px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:8px;padding:16px;">
  <div style="display:flex;align-items:flex-start;gap:12px;">
    <div style="font-size:24px;">âš ï¸</div>
    <div>
      <h4 style="color:#ff4d4d;margin:0 0 8px 0;font-size:14px;">IMPORTANT DISCLAIMER</h4>
      <p style="margin:0;font-size:12px;line-height:1.5;color:rgba(230,250,255,0.9);">
        This tool provides <strong>educational estimates only</strong>. Electrical work requires:
        â€¢ Compliance with NEC/BS/IEC codes â€¢ Local jurisdiction approvals â€¢ Licensed electrician installation â€¢
        Manufacturer specifications â€¢ Site-specific conditions assessment
      </p>
    </div>
  </div>
</div>

<script>
/* conduit-sizing.html
   - Advanced conduit sizing calculator with NEC compliance
   - Scoped with "cond" prefix (conduit)
*/

// Wire area database (in square inches for NEC calculations)
const wireAreas = {
  // AWG sizes (square inches)
  '14': 0.0091,    // 14 AWG THHN
  '12': 0.0133,    // 12 AWG THHN
  '10': 0.0211,    // 10 AWG THHN
  '8': 0.0366,     // 8 AWG THHN
  '6': 0.0507,     // 6 AWG THHN
  '4': 0.0824,     // 4 AWG THHN
  '2': 0.1158,     // 2 AWG THHN
  '1': 0.1562,     // 1 AWG THHN
  '1/0': 0.1855,   // 1/0 AWG THHN
  '2/0': 0.2223,   // 2/0 AWG THHN
  '3/0': 0.2679,   // 3/0 AWG THHN
  '4/0': 0.3237,   // 4/0 AWG THHN
  '250': 0.3970,   // 250 kcmil
  '300': 0.4608,   // 300 kcmil
  '350': 0.5242,   // 350 kcmil
  '400': 0.5864,   // 400 kcmil
  '500': 0.7073    // 500 kcmil
};

// Conduit area database (internal area in square inches)
const conduitAreas = {
  // EMT (Electrical Metallic Tubing)
  'emt': {
    '1/2"': 0.304,
    '3/4"': 0.533,
    '1"': 0.864,
    '1Â¼"': 1.496,
    '1Â½"': 2.036,
    '2"': 3.356,
    '2Â½"': 5.858,
    '3"': 8.846,
    '3Â½"': 11.545,
    '4"': 14.725
  },
  // PVC Schedule 40
  'pvc40': {
    '1/2"': 0.291,
    '3/4"': 0.533,
    '1"': 0.864,
    '1Â¼"': 1.496,
    '1Â½"': 2.036,
    '2"': 3.356,
    '2Â½"': 5.858,
    '3"': 8.846,
    '3Â½"': 11.545,
    '4"': 14.725
  },
  // PVC Schedule 80 (thicker walls)
  'pvc80': {
    '1/2"': 0.235,
    '3/4"': 0.415,
    '1"': 0.739,
    '1Â¼"': 1.242,
    '1Â½"': 1.767,
    '2"': 2.874,
    '2Â½"': 4.969,
    '3"': 7.499,
    '3Â½"': 9.768,
    '4"': 12.461
  },
  // Rigid Metal Conduit (RMC)
  'rigid': {
    '1/2"': 0.304,
    '3/4"': 0.533,
    '1"': 0.864,
    '1Â¼"': 1.496,
    '1Â½"': 2.036,
    '2"': 3.356,
    '2Â½"': 5.858,
    '3"': 8.846,
    '3Â½"': 11.545,
    '4"': 14.725
  }
};

// NEC fill percentages
const necFillPercentages = {
  '1': 0.53,  // 1 conductor: 53% fill
  '2': 0.31,  // 2 conductors: 31% fill
  '3': 0.40,  // 3+ conductors: 40% fill
  'over40': 0.40  // Custom default
};

let condCurrentCalculation = null;

// UI Update Functions
function condUpdateDisplay(type, value) {
  const display = document.querySelector(`#cond-${type}-display`);
  if (!display) return;
  
  switch(type) {
    case 'count':
      display.textContent = parseInt(value);
      break;
    case 'derating':
      display.textContent = `${parseInt(value)}%`;
      break;
  }
  
  // Auto-calculate on change
  setTimeout(condCalculate, 100);
}

function condCalculate() {
  try {
    // Get all inputs
    const wireType = document.querySelector('#cond-wire-type').value;
    const wireSize = document.querySelector('#cond-wire-size').value;
    const conductorCount = parseInt(document.querySelector('#cond-count').value) || 1;
    const groundCount = parseInt(document.querySelector('#cond-grounds').value) || 1;
    const voltage = document.querySelector('#cond-voltage').value;
    const conduitType = document.querySelector('#cond-conduit-type').value;
    const fillRule = document.querySelector('#cond-fill-rule').value;
    const runLength = parseInt(document.querySelector('#cond-run-length').value) || 50;
    const bends = document.querySelector('#cond-bends').value;
    const temperature = document.querySelector('#cond-temperature').value;
    const bundle = document.querySelector('#cond-conductors-bundle').value;
    const derating = parseInt(document.querySelector('#cond-derating').value) || 100;
    
    // Get wire area
    const wireArea = wireAreas[wireSize] || 0.0133; // Default to 12 AWG
    
    // Calculate total conductor area
    const totalConductors = conductorCount + groundCount;
    const totalWireArea = totalConductors * wireArea;
    
    // Determine NEC fill percentage
    let fillPercentage;
    if (fillRule === 'over40') {
      fillPercentage = 0.40; // Default 40%
    } else {
      fillPercentage = necFillPercentages[fillRule] || 0.40;
    }
    
    // Calculate required conduit area
    const requiredArea = totalWireArea / fillPercentage;
    
    // Find appropriate conduit size
    const conduitSizes = conduitAreas[conduitType] || conduitAreas['emt'];
    let recommendedSize = '1/2"';
    let conduitArea = conduitSizes['1/2"'];
    
    // Find smallest conduit that fits
    for (const [size, area] of Object.entries(conduitSizes)) {
      if (area >= requiredArea) {
        recommendedSize = size;
        conduitArea = area;
        break;
      }
    }
    
    // If no conduit is large enough, use largest available
    if (conduitArea < requiredArea) {
      const sizes = Object.keys(conduitSizes);
      recommendedSize = sizes[sizes.length - 1];
      conduitArea = conduitSizes[recommendedSize];
    }
    
    // Calculate actual fill percentage
    const actualFill = (totalWireArea / conduitArea) * 100;
    
    // Calculate pulling tension (simplified)
    const pullingTension = runLength > 100 ? 'Consider pull boxes' : 'Acceptable';
    
    // Determine bend requirements
    let bendRecommendation = 'Pull boxes recommended';
    if (bends === '0') {
      bendRecommendation = 'Straight run - OK';
    } else if (bends === '1') {
      bendRecommendation = 'One bend - Use large radius elbow';
    } else if (bends === '2') {
      bendRecommendation = 'Two bends - Pull box may be required';
    }
    
    // Temperature adjustment
    const tempAdjustment = temperature > 86 ? 'Derate required' : 'Within limits';
    
    // Derating calculation
    const deratedAmpacity = derating < 100 ? 'Ampacity derating applies' : 'No derating needed';
    
    // Save calculation for export
    condCurrentCalculation = {
      timestamp: new Date().toISOString(),
      parameters: {
        wireType,
        wireSize,
        conductorCount,
        groundCount,
        voltage,
        conduitType,
        fillRule,
        runLength,
        bends,
        temperature,
        bundle,
        derating
      },
      results: {
        recommendedSize,
        conduitArea,
        totalWireArea,
        actualFill,
        pullingTension,
        bendRecommendation,
        tempAdjustment,
        deratedAmpacity
      }
    };
    
    // Update quick stats
    document.querySelector('#cond-stat-size').textContent = recommendedSize;
    document.querySelector('#cond-stat-fill').textContent = `${actualFill.toFixed(1)}%`;
    document.querySelector('#cond-stat-area').textContent = `${totalWireArea.toFixed(3)} inÂ²`;
    document.querySelector('#cond-stat-csa').textContent = `${conduitArea.toFixed(3)} inÂ²`;
    
    // Build detailed output
    let outputText = `CONDUIT SIZING CALCULATION\n`;
    outputText += `â•`.repeat(40) + `\n\n`;
    
    outputText += `WIRE SPECIFICATIONS:\n`;
    outputText += `â€¢ Wire type: ${document.querySelector('#cond-wire-type').selectedOptions[0].text}\n`;
    outputText += `â€¢ Wire size: ${wireSize} ${wireSize.includes('/') ? 'AWG' : wireSize <= 4 ? 'kcmil' : 'AWG'}\n`;
    outputText += `â€¢ Conductors: ${conductorCount} current-carrying\n`;
    outputText += `â€¢ Ground wires: ${groundCount}\n`;
    outputText += `â€¢ Voltage: ${document.querySelector('#cond-voltage').selectedOptions[0].text}\n\n`;
    
    outputText += `CONDUIT SPECIFICATIONS:\n`;
    outputText += `â€¢ Conduit type: ${document.querySelector('#cond-conduit-type').selectedOptions[0].text}\n`;
    outputText += `â€¢ NEC fill rule: ${(fillPercentage * 100).toFixed(0)}%\n`;
    outputText += `â€¢ Run length: ${runLength} feet\n`;
    outputText += `â€¢ Bends: ${document.querySelector('#cond-bends').selectedOptions[0].text}\n\n`;
    
    outputText += `CALCULATION RESULTS:\n`;
    outputText += `â€¢ Minimum conduit size: ${recommendedSize}\n`;
    outputText += `â€¢ Total wire area: ${totalWireArea.toFixed(4)} inÂ²\n`;
    outputText += `â€¢ Conduit internal area: ${conduitArea.toFixed(4)} inÂ²\n`;
    outputText += `â€¢ Actual fill: ${actualFill.toFixed(1)}%\n`;
    outputText += `â€¢ Pulling tension: ${pullingTension}\n`;
    outputText += `â€¢ Bend requirements: ${bendRecommendation}\n`;
    outputText += `â€¢ Temperature: ${tempAdjustment}\n`;
    outputText += `â€¢ Derating: ${deratedAmpacity}\n\n`;
    
    outputText += `RECOMMENDATIONS:\n`;
    outputText += `1. Use ${recommendedSize} ${document.querySelector('#cond-conduit-type').selectedOptions[0].text}\n`;
    
    if (actualFill > 38) {
      outputText += `2. âš ï¸ Fillæ¥è¿‘40%æé™ - è€ƒè™‘åŠ å¤§å¯¼ç®¡å°ºå¯¸\n`;
    }
    
    if (runLength > 100) {
      outputText += `3. ğŸ“ é•¿åº¦è¶…è¿‡100è‹±å°º - å»ºè®®ä½¿ç”¨æ‹‰çº¿ç›’\n`;
    }
    
    if (temperature > 86) {
      outputText += `4. ğŸŒ¡ï¸ é«˜æ¸©ç¯å¢ƒ - éœ€è¦é™é¢è®¡ç®—\n`;
    }
    
    if (derating < 100) {
      outputText += `5. ğŸ“‰ é™é¢ç³»æ•°åº”ç”¨: ${derating}%\n`;
    }
    
    outputText += `\nâš ï¸ DISCLAIMER: Always verify with NEC codebook and licensed electrician.`;
    
    // Update output
    document.querySelector('#cond-output').value = outputText;
    
    // Update status
    const status = document.querySelector('#cond-status');
    status.textContent = 'âœ… Calculation complete';
    status.style.color = '#39ff14';
    
  } catch (error) {
    console.error('Calculation error:', error);
    document.querySelector('#cond-output').value = `ERROR: ${error.message}\n\nPlease check inputs and try again.`;
    document.querySelector('#cond-status').textContent = 'âŒ Calculation error';
    document.querySelector('#cond-status').style.color = '#ff4d4d';
  }
}

function condLoadScenario(type) {
  const scenarios = {
    residential: {
      wireType: 'thhn',
      wireSize: '12',
      conductorCount: 3,
      grounds: 1,
      voltage: '120240',
      conduitType: 'emt',
      fillRule: '40',
      runLength: 40,
      bends: '0',
      temperature: '86',
      bundle: '4-6',
      derating: 100
    },
    commercial: {
      wireType: 'thhn',
      wireSize: '4',
      conductorCount: 4,
      grounds: 1,
      voltage: '208',
      conduitType: 'emt',
      fillRule: '40',
      runLength: 75,
      bends: '2',
      temperature: '104',
      bundle: '7-9',
      derating: 80
    },
    motor: {
      wireType: 'thhn',
      wireSize: '8',
      conductorCount: 3,
      grounds: 1,
      voltage: '240',
      conduitType: 'rigid',
      fillRule: '40',
      runLength: 60,
      bends: '1',
      temperature: '104',
      bundle: '1-3',
      derating: 100
    },
    service: {
      wireType: 'service',
      wireSize: '2/0',
      conductorCount: 3,
      grounds: 1,
      voltage: '120240',
      conduitType: 'pvc40',
      fillRule: '40',
      runLength: 30,
      bends: '0',
      temperature: '86',
      bundle: '1-3',
      derating: 100
    }
  };
  
  const scenario = scenarios[type];
  if (!scenario) return;
  
  // Update inputs
  document.querySelector('#cond-wire-type').value = scenario.wireType;
  document.querySelector('#cond-wire-size').value = scenario.wireSize;
  document.querySelector('#cond-count').value = scenario.conductorCount;
  document.querySelector('#cond-grounds').value = scenario.grounds;
  document.querySelector('#cond-voltage').value = scenario.voltage;
  document.querySelector('#cond-conduit-type').value = scenario.conduitType;
  document.querySelector('#cond-fill-rule').value = scenario.fillRule;
  document.querySelector('#cond-run-length').value = scenario.runLength;
  document.querySelector('#cond-bends').value = scenario.bends;
  document.querySelector('#cond-temperature').value = scenario.temperature;
  document.querySelector('#cond-conductors-bundle').value = scenario.bundle;
  document.querySelector('#cond-derating').value = scenario.derating;
  
  // Update displays
  condUpdateDisplay('count', scenario.conductorCount);
  condUpdateDisplay('derating', scenario.derating);
  
  // Calculate
  setTimeout(condCalculate, 100);
}

function condReset() {
  if (!confirm('Reset all values to defaults?')) return;
  
  // Reset to defaults
  document.querySelector('#cond-wire-type').value = 'thhn';
  document.querySelector('#cond-wire-size').value = '12';
  document.querySelector('#cond-count').value = 3;
  document.querySelector('#cond-grounds').value = '1';
  document.querySelector('#cond-voltage').value = '120240';
  document.querySelector('#cond-conduit-type').value = 'emt';
  document.querySelector('#cond-fill-rule').value = '40';
  document.querySelector('#cond-run-length').value = 50;
  document.querySelector('#cond-bends').value = '0';
  document.querySelector('#cond-temperature').value = '86';
  document.querySelector('#cond-conductors-bundle').value = '4-6';
  document.querySelector('#cond-derating').value = 100;
  
  // Reset displays
  condUpdateDisplay('count', 3);
  condUpdateDisplay('derating', 100);
  
  // Clear results
  document.querySelector('#cond-output').value = '';
  document.querySelector('#cond-status').textContent = '';
  
  // Reset stats
  document.querySelector('#cond-stat-size').textContent = 'â€“';
  document.querySelector('#cond-stat-fill').textContent = 'â€“';
  document.querySelector('#cond-stat-area').textContent = 'â€“';
  document.querySelector('#cond-stat-csa').textContent = 'â€“';
}

function condExport() {
  if (!condCurrentCalculation) {
    document.querySelector('#cond-status').textContent = 'âŒ No calculation to export';
    document.querySelector('#cond-status').style.color = '#ff4d4d';
    return;
  }
  
  const dataStr = JSON.stringify(condCurrentCalculation, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `conduit-calculation-${new Date().toISOString().split('T')[0]}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  // Visual feedback
  const status = document.querySelector('#cond-status');
  status.textContent = 'âœ… Data exported';
  status.style.color = '#39ff14';
  setTimeout(() => {
    status.textContent = '';
  }, 2000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    // Set initial display values
    condUpdateDisplay('count', 3);
    condUpdateDisplay('derating', 100);
    
    // Calculate on load
    setTimeout(condCalculate, 500);
    
    // Add input listeners for auto-calculation
    [
      '#cond-wire-type',
      '#cond-wire-size', 
      '#cond-grounds',
      '#cond-voltage',
      '#cond-conduit-type',
      '#cond-fill-rule',
      '#cond-run-length',
      '#cond-bends',
      '#cond-temperature',
      '#cond-conductors-bundle'
    ].forEach(selector => {
      const input = document.querySelector(selector);
      if (input) {
        input.addEventListener('change', condCalculate);
      }
    });
  });
}
</script>

<style>
/* Card-specific styles */
#conduit-sizing-title {
  color: var(--accent);
  margin-top: 0;
  margin-bottom: 4px;
}

/* Range slider styling */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 8px;
  border-radius: 4px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 10px rgba(45,212,255,0.5);
}

input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 10px rgba(45,212,255,0.5);
}

/* Table styling */
table {
  border-collapse: separate;
  border-spacing: 0;
}

th, td {
  padding: 6px;
}

tbody tr:hover {
  background: rgba(45,212,255,0.05);
}

/* Checkbox styling */
input[type="checkbox"] {
  margin: 0;
}

/* Responsive design */
@media (max-width: 768px) {
  #conduit-sizing-title {
    font-size: 1.2rem;
  }
  
  .input-section {
    grid-template-columns: 1fr !important;
  }
  
  .quick-stats {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
  
  .scenario-buttons {
    flex-direction: column;
  }
  
  .scenario-buttons button {
    width: 100%;
  }
}

/* Details/summary styling */
details summary::-webkit-details-marker {
  display: none;
}

details summary {
  list-style: none;
}

details[open] summary {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 16px;
}

/* Warning banner animation */
@keyframes pulseWarning {
  0% { background-color: rgba(255,77,77,0.1); }
  50% { background-color: rgba(255,77,77,0.15); }
  100% { background-color: rgba(255,77,77,0.1); }
}

.warning-banner {
  animation: pulseWarning 2s infinite;
}

/* Custom scrollbar for tables */
table::-webkit-scrollbar {
  height: 6px;
}

table::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

table::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}
</style>
