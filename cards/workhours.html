<h2 id="workhours-title" style="margin-top:0;color:var(--accent);">‚è±Ô∏è Work Hours & Pay Calculator</h2>

<form aria-describedby="workhours-desc">
  <p id="workhours-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.8);">
    Calculate work hours, breaks, overtime, and pay. Track multiple shifts, different pay rates, and generate detailed timesheets.
    <span style="color:var(--accent);font-weight:500;">Perfect for freelancers, contractors, and employees!</span>
  </p>

  <!-- Shift Details -->
  <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìÖ Shift Details</div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
      <!-- Start Time -->
      <div class="field">
        <label for="wh-start-time" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Start Time</label>
        <input id="wh-start-time" type="time" value="09:00" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Shift start time</div>
      </div>

      <!-- End Time -->
      <div class="field">
        <label for="wh-end-time" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">End Time</label>
        <input id="wh-end-time" type="time" value="17:00" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Shift end time</div>
      </div>

      <!-- Date -->
      <div class="field">
        <label for="wh-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Date</label>
        <input id="wh-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Work date</div>
      </div>
    </div>

    <!-- Quick Shifts -->
    <div style="margin-bottom:12px;">
      <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:6px;">‚è∞ Common Shifts:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="whSetShift('9-5')" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">9 AM - 5 PM</button>
        <button type="button" onclick="whSetShift('8-4')" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">8 AM - 4 PM</button>
        <button type="button" onclick="whSetShift('10-6')" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">10 AM - 6 PM</button>
        <button type="button" onclick="whSetShift('night')" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">8 PM - 4 AM</button>
        <button type="button" onclick="whSetShift('half')" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">9 AM - 1 PM</button>
      </div>
    </div>
  </div>

  <!-- Pay Rate -->
  <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üí∞ Pay Rate & Currency</div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;">
      <!-- Hourly Rate -->
      <div class="field">
        <label for="wh-hourly-rate" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">Hourly Rate</label>
        <div style="display:flex;align-items:center;gap:8px;">
          <select id="wh-currency" 
                  style="padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
            <option value="GBP">¬£</option>
            <option value="USD">$</option>
            <option value="EUR">‚Ç¨</option>
            <option value="CAD">$</option>
            <option value="AUD">$</option>
          </select>
          <input id="wh-hourly-rate" type="number" min="0" step="0.01" value="15.00" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Rate per hour</div>
      </div>

      <!-- Overtime Rate -->
      <div class="field">
        <label for="wh-overtime-rate" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">Overtime Multiplier</label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="wh-overtime-rate" type="number" min="1" max="3" step="0.1" value="1.5" 
                 style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <div style="color:rgba(230,250,255,0.8);">√ó regular rate</div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">e.g., 1.5 for time-and-a-half</div>
      </div>

      <!-- Overtime Threshold -->
      <div class="field">
        <label for="wh-overtime-threshold" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">Overtime After</label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="wh-overtime-threshold" type="number" min="0" max="24" step="0.5" value="8" 
                 style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <div style="color:rgba(230,250,255,0.8);">hours/day</div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Overtime starts after this</div>
      </div>
    </div>

    <!-- Quick Rates -->
    <div style="margin-top:12px;">
      <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:6px;">üíº Common Rates:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="whSetRate(7.50)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£7.50 (UK Min)</button>
        <button type="button" onclick="whSetRate(10.42)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£10.42</button>
        <button type="button" onclick="whSetRate(12.00)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£12.00</button>
        <button type="button" onclick="whSetRate(15.00)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£15.00</button>
        <button type="button" onclick="whSetRate(20.00)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£20.00</button>
        <button type="button" onclick="whSetRate(25.00)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">¬£25.00</button>
      </div>
    </div>
  </div>

  <!-- Breaks -->
  <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">‚òï Breaks</div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
      <!-- Break Duration -->
      <div class="field">
        <label for="wh-break-duration" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">Total Break Time</label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="wh-break-duration" type="number" min="0" max="480" step="5" value="60" 
                 style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <div style="color:rgba(230,250,255,0.8);">minutes</div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">Unpaid break time</div>
      </div>

      <!-- Break Type -->
      <div class="field">
        <label for="wh-break-type" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">Break Type</label>
        <select id="wh-break-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;">
          <option value="unpaid" selected>Unpaid (deducted from hours)</option>
          <option value="paid">Paid (included in hours)</option>
          <option value="none">No breaks</option>
        </select>
      </div>
    </div>

    <!-- Quick Breaks -->
    <div>
      <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:6px;">‚è±Ô∏è Common Breaks:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="whSetBreak(0)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">No Break</button>
        <button type="button" onclick="whSetBreak(15)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">15 min</button>
        <button type="button" onclick="whSetBreak(30)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">30 min</button>
        <button type="button" onclick="whSetBreak(45)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">45 min</button>
        <button type="button" onclick="whSetBreak(60)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">1 hour</button>
        <button type="button" onclick="whSetBreak(90)" 
                style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">1.5 hours</button>
      </div>
    </div>
  </div>

  <!-- Multiple Shifts -->
  <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìã Multiple Shifts (Optional)</div>
    
    <div id="wh-shifts-container">
      <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:8px;">
        Add multiple shifts for the same day or week
      </div>
      
      <div id="wh-shifts-list" style="margin-bottom:12px;">
        <!-- Shifts will be added here -->
      </div>
      
      <div style="display:flex;gap:8px;">
        <button type="button" onclick="whAddShift()" 
                style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:6px;cursor:pointer;font-size:13px;">
          ‚ûï Add Another Shift
        </button>
        <button type="button" onclick="whClearShifts()" 
                style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:6px;cursor:pointer;font-size:13px;">
          üóëÔ∏è Clear All Shifts
        </button>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
    <button type="button" onclick="whCalculate()" 
            style="flex:1;min-width:200px;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ‚è±Ô∏è Calculate Hours & Pay
    </button>
    <button type="button" onclick="whCopyTimesheet()"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;">
      üìã Copy Timesheet
    </button>
    <button type="button" onclick="whReset()"
            style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
      üîÑ Reset All
    </button>
  </div>
</form>

<!-- Results -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìä Work Hours & Pay Summary</h3>
  
  <!-- Quick Summary -->
  <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);margin-bottom:16px;">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;text-align:center;">
      <div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Total Hours</div>
        <div id="wh-total-hours" style="font-size:18px;font-weight:600;color:#e6faff;">‚Äì</div>
      </div>
      <div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Regular Hours</div>
        <div id="wh-regular-hours" style="font-size:18px;font-weight:600;color:#39ff14;">‚Äì</div>
      </div>
      <div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Overtime Hours</div>
        <div id="wh-overtime-hours" style="font-size:18px;font-weight:600;color:#ffcc00;">‚Äì</div>
      </div>
      <div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Total Pay</div>
        <div id="wh-total-pay" style="font-size:18px;font-weight:600;color:#2dd4ff;">‚Äì</div>
      </div>
    </div>
  </div>
  
  <!-- Detailed Breakdown -->
  <div id="wh-breakdown" style="display:none;margin-bottom:16px;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(57,255,20,0.2);">
      <div style="color:#39ff14;font-weight:500;margin-bottom:12px;">üßÆ Detailed Breakdown</div>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;">
        <div>
          <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:8px;">‚è∞ Time Summary:</div>
          <div id="wh-time-summary" style="font-size:13px;color:rgba(230,250,255,0.8);line-height:1.6;">
            <!-- Time summary will be added here -->
          </div>
        </div>
        
        <div>
          <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:8px;">üí∞ Pay Summary:</div>
          <div id="wh-pay-summary" style="font-size:13px;color:rgba(230,250,255,0.8);line-height:1.6;">
            <!-- Pay summary will be added here -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Hourly Breakdown -->
  <div id="wh-hourly-breakdown" style="display:none;margin-bottom:16px;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,204,0,0.2);">
      <div style="color:#ffcc00;font-weight:500;margin-bottom:12px;">üìà Hourly Breakdown</div>
      <div id="wh-hourly-chart" style="height:60px;display:flex;align-items:flex-end;gap:4px;margin-bottom:12px;">
        <!-- Chart bars will be added here -->
      </div>
      <div style="display:flex;justify-content:space-between;font-size:12px;color:rgba(230,250,255,0.7);">
        <div id="wh-chart-min">9 AM</div>
        <div id="wh-chart-max">5 PM</div>
      </div>
    </div>
  </div>
  
  <!-- Multiple Shifts Results -->
  <div id="wh-shifts-results" style="display:none;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
      <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìã Multiple Shifts Summary</div>
      <div id="wh-shifts-summary">
        <!-- Shifts summary will be added here -->
      </div>
    </div>
  </div>
  
  <!-- Status -->
  <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:rgba(230,250,255,0.7);">
    <div>
      <span id="wh-status">Enter shift details to calculate</span>
      <span id="wh-hint" style="margin-left:8px;"></span>
    </div>
    <div id="wh-currency-display">Currency: ¬£ GBP</div>
  </div>
</div>

<details class="small" style="margin-top:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
  <summary style="color:var(--accent);font-weight:500;cursor:pointer;">üìù How It Works & Labor Laws</summary>
  <div style="margin-top:8px;font-size:13px;line-height:1.5;color:rgba(230,250,255,0.8);">
    <p><strong>Formulas:</strong></p>
    <ul style="list-style:disc;padding-left:20px;margin:8px 0;">
      <li><strong>Total Hours</strong> = End Time - Start Time - Break Time (if unpaid)</li>
      <li><strong>Regular Hours</strong> = Minimum(Total Hours, Overtime Threshold)</li>
      <li><strong>Overtime Hours</strong> = Maximum(0, Total Hours - Overtime Threshold)</li>
      <li><strong>Regular Pay</strong> = Regular Hours √ó Hourly Rate</li>
      <li><strong>Overtime Pay</strong> = Overtime Hours √ó Hourly Rate √ó Overtime Multiplier</li>
      <li><strong>Total Pay</strong> = Regular Pay + Overtime Pay</li>
    </ul>
    
    <p><strong>UK Working Time Regulations:</strong></p>
    <ul style="list-style:disc;padding-left:20px;margin:8px 0;">
      <li>Maximum 48-hour average working week (can opt out)</li>
      <li>11 hours rest between shifts</li>
      <li>24 hours uninterrupted rest per week (or 48 hours per fortnight)</li>
      <li>20-minute break for shifts over 6 hours</li>
      <li>5.6 weeks (28 days) paid annual leave for full-time workers</li>
    </ul>
    
    <p><strong>Overtime Rules (UK):</strong></p>
    <ul style="list-style:disc;padding-left:20px;margin:8px 0;">
      <li>No statutory right to overtime pay - depends on contract</li>
      <li>Common overtime rates: Time-and-a-half (1.5√ó), Double time (2√ó)</li>
      <li>Overtime often paid after 37.5-40 hours per week</li>
      <li>Check your employment contract for specific terms</li>
    </ul>
    
    <p style="margin-top:8px;padding:8px;background:rgba(255,204,0,0.1);border-radius:6px;border:1px solid rgba(255,204,0,0.3);">
      <span style="color:#ffcc00;font-weight:500;">‚ö†Ô∏è Important:</span> This calculator is for estimation only. Always refer to your employment contract and consult with HR or legal professionals for accurate pay calculations.
    </p>
  </div>
</details>

<script>
/* workhours.html - Work Hours & Pay Calculator
   - Calculates hours, breaks, overtime, and pay
   - Handles multiple shifts and currencies
   - Scoped with wh- prefix (Work Hours)
*/

// Currency symbols
const whCurrencySymbols = {
    'GBP': '¬£',
    'USD': '$',
    'EUR': '‚Ç¨',
    'CAD': '$',
    'AUD': '$'
};

// Store multiple shifts
let whShifts = [];

// Initialize
function whInitialize() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set today's date as default
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    card.querySelector('#wh-date').value = formattedDate;
    
    // Update currency display
    const currencySelect = card.querySelector('#wh-currency');
    currencySelect.addEventListener('change', function() {
        const symbol = whCurrencySymbols[this.value] || this.value;
        card.querySelector('#wh-currency-display').textContent = `Currency: ${symbol} ${this.value}`;
    });
    
    // Initial currency display
    const symbol = whCurrencySymbols[currencySelect.value] || currencySelect.value;
    card.querySelector('#wh-currency-display').textContent = `Currency: ${symbol} ${currencySelect.value}`;
    
    console.log('Work Hours Calculator initialized');
}

// Set quick shift
function whSetShift(shiftType) {
    const card = document.currentScript?.closest('.card') || document;
    
    const shifts = {
        '9-5': { start: '09:00', end: '17:00' },
        '8-4': { start: '08:00', end: '16:00' },
        '10-6': { start: '10:00', end: '18:00' },
        'night': { start: '20:00', end: '04:00' },
        'half': { start: '09:00', end: '13:00' }
    };
    
    const shift = shifts[shiftType];
    if (!shift) return;
    
    card.querySelector('#wh-start-time').value = shift.start;
    card.querySelector('#wh-end-time').value = shift.end;
    
    // Show confirmation
    card.querySelector('#wh-hint').textContent = `Set to ${shiftType} shift`;
    card.querySelector('#wh-hint').style.color = '#39ff14';
    setTimeout(() => {
        card.querySelector('#wh-hint').textContent = '';
    }, 2000);
}

// Set quick rate
function whSetRate(rate) {
    const card = document.currentScript?.closest('.card') || document;
    card.querySelector('#wh-hourly-rate').value = rate.toFixed(2);
    
    // Show confirmation
    card.querySelector('#wh-hint').textContent = `Rate set to ${whCurrencySymbols[card.querySelector('#wh-currency').value] || ''}${rate.toFixed(2)}`;
    card.querySelector('#wh-hint').style.color = '#39ff14';
    setTimeout(() => {
        card.querySelector('#wh-hint').textContent = '';
    }, 2000);
}

// Set break duration
function whSetBreak(minutes) {
    const card = document.currentScript?.closest('.card') || document;
    card.querySelector('#wh-break-duration').value = minutes;
    
    // Update break type if needed
    if (minutes === 0) {
        card.querySelector('#wh-break-type').value = 'none';
    } else {
        card.querySelector('#wh-break-type').value = 'unpaid';
    }
    
    // Show confirmation
    card.querySelector('#wh-hint').textContent = `Break set to ${minutes} minutes`;
    card.querySelector('#wh-hint').style.color = '#39ff14';
    setTimeout(() => {
        card.querySelector('#wh-hint').textContent = '';
    }, 2000);
}

// Add multiple shift
function whAddShift() {
    const card = document.currentScript?.closest('.card') || document;
    const shiftsList = card.querySelector('#wh-shifts-list');
    
    const shiftId = Date.now();
    const shift = {
        id: shiftId,
        startTime: '09:00',
        endTime: '17:00',
        breakMinutes: 60,
        breakType: 'unpaid'
    };
    
    whShifts.push(shift);
    
    // Create shift element
    const shiftDiv = document.createElement('div');
    shiftDiv.className = 'wh-shift';
    shiftDiv.style.cssText = 'display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:8px;align-items:center;padding:12px;background:rgba(255,255,255,0.02);border-radius:6px;margin-bottom:8px;';
    shiftDiv.dataset.id = shiftId;
    
    // Start time
    const startInput = document.createElement('input');
    startInput.type = 'time';
    startInput.value = shift.startTime;
    startInput.style.cssText = 'padding:6px;border-radius:4px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;';
    startInput.addEventListener('change', function() {
        shift.startTime = this.value;
    });
    
    // End time
    const endInput = document.createElement('input');
    endInput.type = 'time';
    endInput.value = shift.endTime;
    endInput.style.cssText = 'padding:6px;border-radius:4px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;';
    endInput.addEventListener('change', function() {
        shift.endTime = this.value;
    });
    
    // Break minutes
    const breakInput = document.createElement('input');
    breakInput.type = 'number';
    breakInput.min = '0';
    breakInput.max = '480';
    breakInput.step = '5';
    breakInput.value = shift.breakMinutes;
    breakInput.placeholder = 'Break mins';
    breakInput.style.cssText = 'padding:6px;border-radius:4px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;';
    breakInput.addEventListener('change', function() {
        shift.breakMinutes = parseInt(this.value) || 0;
    });
    
    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.type = 'button';
    deleteBtn.textContent = 'üóëÔ∏è';
    deleteBtn.title = 'Remove shift';
    deleteBtn.style.cssText = 'padding:6px 8px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:4px;cursor:pointer;font-size:12px;';
    deleteBtn.onclick = function() {
        whShifts = whShifts.filter(s => s.id !== shiftId);
        shiftDiv.remove();
    };
    
    shiftDiv.appendChild(startInput);
    shiftDiv.appendChild(endInput);
    shiftDiv.appendChild(breakInput);
    shiftDiv.appendChild(deleteBtn);
    shiftsList.appendChild(shiftDiv);
}

// Clear all shifts
function whClearShifts() {
    const card = document.currentScript?.closest('.card') || document;
    const shiftsList = card.querySelector('#wh-shifts-list');
    
    if (whShifts.length === 0) return;
    
    if (confirm('Clear all additional shifts?')) {
        whShifts = [];
        shiftsList.innerHTML = '';
    }
}

// Calculate time difference in hours
function whCalculateTimeDifference(startTime, endTime) {
    const [startHours, startMinutes] = startTime.split(':').map(Number);
    const [endHours, endMinutes] = endTime.split(':').map(Number);
    
    let startTotal = startHours + (startMinutes / 60);
    let endTotal = endHours + (endMinutes / 60);
    
    // Handle overnight shifts
    if (endTotal < startTotal) {
        endTotal += 24;
    }
    
    return endTotal - startTotal;
}

// Format hours to HH:MM
function whFormatHours(hours) {
    const totalMinutes = Math.round(hours * 60);
    const h = Math.floor(totalMinutes / 60);
    const m = totalMinutes % 60;
    return `${h}h ${m}m`;
}

// Format hours to decimal
function whFormatHoursDecimal(hours) {
    return hours.toFixed(2);
}

// Main calculation function
function whCalculate() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Get main shift inputs
    const startTime = card.querySelector('#wh-start-time').value;
    const endTime = card.querySelector('#wh-end-time').value;
    const date = card.querySelector('#wh-date').value;
    const hourlyRate = parseFloat(card.querySelector('#wh-hourly-rate').value) || 0;
    const overtimeMultiplier = parseFloat(card.querySelector('#wh-overtime-rate').value) || 1.5;
    const overtimeThreshold = parseFloat(card.querySelector('#wh-overtime-threshold').value) || 8;
    const breakMinutes = parseInt(card.querySelector('#wh-break-duration').value) || 0;
    const breakType = card.querySelector('#wh-break-type').value;
    const currency = card.querySelector('#wh-currency').value;
    
    if (!startTime || !endTime) {
        card.querySelector('#wh-status').textContent = 'Error: Please enter start and end times';
        card.querySelector('#wh-status').style.color = '#ff4d4d';
        return;
    }
    
    if (hourlyRate <= 0) {
        card.querySelector('#wh-status').textContent = 'Error: Please enter an hourly rate';
        card.querySelector('#wh-status').style.color = '#ff4d4d';
        return;
    }
    
    // Calculate main shift
    let totalHours = whCalculateTimeDifference(startTime, endTime);
    
    // Adjust for breaks
    let paidHours = totalHours;
    if (breakType === 'unpaid' && breakMinutes > 0) {
        totalHours -= (breakMinutes / 60);
    } else if (breakType === 'none') {
        // No adjustment needed
    }
    // For paid breaks, totalHours remains the same
    
    // Calculate overtime
    let regularHours = Math.min(totalHours, overtimeThreshold);
    let overtimeHours = Math.max(0, totalHours - overtimeThreshold);
    
    // Calculate pay
    const regularPay = regularHours * hourlyRate;
    const overtimePay = overtimeHours * hourlyRate * overtimeMultiplier;
    const totalPay = regularPay + overtimePay;
    
    // Get currency symbol
    const symbol = whCurrencySymbols[currency] || currency;
    
    // Calculate for multiple shifts if any
    let allShiftsData = [];
    let totalAllHours = totalHours;
    let totalAllRegularHours = regularHours;
    let totalAllOvertimeHours = overtimeHours;
    let totalAllPay = totalPay;
    
    if (whShifts.length > 0) {
        whShifts.forEach(shift => {
            const shiftHours = whCalculateTimeDifference(shift.startTime, shift.endTime);
            let shiftTotalHours = shiftHours;
            
            if (shift.breakType === 'unpaid' && shift.breakMinutes > 0) {
                shiftTotalHours -= (shift.breakMinutes / 60);
            }
            
            const shiftRegularHours = Math.min(shiftTotalHours, overtimeThreshold);
            const shiftOvertimeHours = Math.max(0, shiftTotalHours - overtimeThreshold);
            const shiftRegularPay = shiftRegularHours * hourlyRate;
            const shiftOvertimePay = shiftOvertimeHours * hourlyRate * overtimeMultiplier;
            const shiftTotalPay = shiftRegularPay + shiftOvertimePay;
            
            allShiftsData.push({
                startTime: shift.startTime,
                endTime: shift.endTime,
                totalHours: shiftTotalHours,
                regularHours: shiftRegularHours,
                overtimeHours: shiftOvertimeHours,
                totalPay: shiftTotalPay
            });
            
            totalAllHours += shiftTotalHours;
            totalAllRegularHours += shiftRegularHours;
            totalAllOvertimeHours += shiftOvertimeHours;
            totalAllPay += shiftTotalPay;
        });
    }
    
    // Update displays
    card.querySelector('#wh-total-hours').textContent = whFormatHours(totalAllHours);
    card.querySelector('#wh-regular-hours').textContent = whFormatHours(totalAllRegularHours);
    card.querySelector('#wh-overtime-hours').textContent = whFormatHours(totalAllOvertimeHours);
    card.querySelector('#wh-total-pay').textContent = `${symbol}${totalAllPay.toFixed(2)}`;
    
    // Update status
    card.querySelector('#wh-status').textContent = 'Calculation complete';
    card.querySelector('#wh-status').style.color = '#39ff14';
    
    // Show detailed breakdown
    whShowBreakdown(startTime, endTime, totalHours, regularHours, overtimeHours, 
                   hourlyRate, overtimeMultiplier, regularPay, overtimePay, totalPay,
                   breakMinutes, breakType, symbol);
    
    // Show hourly breakdown chart
    whShowHourlyChart(startTime, endTime, breakMinutes, breakType);
    
    // Show multiple shifts results if any
    if (whShifts.length > 0) {
        whShowShiftsSummary(allShiftsData, symbol);
        card.querySelector('#wh-shifts-results').style.display = 'block';
    } else {
        card.querySelector('#wh-shifts-results').style.display = 'none';
    }
}

// Show detailed breakdown
function whShowBreakdown(startTime, endTime, totalHours, regularHours, overtimeHours,
                        hourlyRate, overtimeMultiplier, regularPay, overtimePay, totalPay,
                        breakMinutes, breakType, symbol) {
    const card = document.currentScript?.closest('.card') || document;
    
    // Time summary
    const timeSummary = `
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Shift:</span>
            <span>${startTime} - ${endTime}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Total Duration:</span>
            <span>${whFormatHours(totalHours + (breakType === 'unpaid' ? breakMinutes/60 : 0))}</span>
        </div>
        ${breakMinutes > 0 ? `
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Break (${breakType}):</span>
            <span>${breakMinutes} minutes</span>
        </div>
        ` : ''}
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Paid Hours:</span>
            <span>${whFormatHours(totalHours)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Regular Hours:</span>
            <span>${whFormatHours(regularHours)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);">
            <span style="font-weight:500;">Overtime Hours:</span>
            <span style="font-weight:500;color:#ffcc00;">${whFormatHours(overtimeHours)}</span>
        </div>
    `;
    
    card.querySelector('#wh-time-summary').innerHTML = timeSummary;
    
    // Pay summary
    const paySummary = `
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Hourly Rate:</span>
            <span>${symbol}${hourlyRate.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Overtime Rate:</span>
            <span>${symbol}${(hourlyRate * overtimeMultiplier).toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Regular Pay:</span>
            <span>${symbol}${regularPay.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Overtime Pay:</span>
            <span>${symbol}${overtimePay.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);">
            <span style="font-weight:500;">Total Pay:</span>
            <span style="font-weight:500;color:#2dd4ff;">${symbol}${totalPay.toFixed(2)}</span>
        </div>
    `;
    
    card.querySelector('#wh-pay-summary').innerHTML = paySummary;
    card.querySelector('#wh-breakdown').style.display = 'block';
}

// Show hourly breakdown chart
function whShowHourlyChart(startTime, endTime, breakMinutes, breakType) {
    const card = document.currentScript?.closest('.card') || document;
    const chart = card.querySelector('#wh-hourly-chart');
    const minLabel = card.querySelector('#wh-chart-min');
    const maxLabel = card.querySelector('#wh-chart-max');
    
    // Parse times
    const [startHour, startMin] = startTime.split(':').map(Number);
    const [endHour, endMin] = endTime.split(':').map(Number);
    
    let startTotal = startHour + (startMin / 60);
    let endTotal = endHour + (endMin / 60);
    
    // Handle overnight
    if (endTotal < startTotal) {
        endTotal += 24;
    }
    
    // Calculate duration
    const duration = endTotal - startTotal;
    const breakStart = startTotal + (duration / 2) - (breakMinutes / 120); // Put break in middle
    
    // Clear chart
    chart.innerHTML = '';
    
    // Create bars for each 15-minute segment
    const segments = Math.ceil(duration * 4); // 4 segments per hour (15 min each)
    const segmentDuration = 0.25; // 0.25 hours = 15 minutes
    
    for (let i = 0; i < segments; i++) {
        const segmentTime = startTotal + (i * segmentDuration);
        const segmentEndTime = segmentTime + segmentDuration;
        
        // Check if this segment includes break time
        let isBreak = false;
        if (breakMinutes > 0 && breakType === 'unpaid') {
            const breakEnd = breakStart + (breakMinutes / 60);
            if (segmentTime < breakEnd && segmentEndTime > breakStart) {
                isBreak = true;
            }
        }
        
        // Create bar
        const bar = document.createElement('div');
        bar.style.cssText = `flex:1;height:${isBreak ? '20%' : '100%'};background:${isBreak ? '#ff4d4d' : '#2dd4ff'};border-radius:2px;transition:height 0.3s;`;
        bar.title = `${Math.floor(segmentTime % 24)}:${((segmentTime % 1) * 60).toString().padStart(2, '0')} - ${isBreak ? 'Break' : 'Working'}`;
        chart.appendChild(bar);
    }
    
    // Update labels
    minLabel.textContent = `${Math.floor(startTotal % 24)}:${((startTotal % 1) * 60).toString().padStart(2, '0')}`;
    maxLabel.textContent = `${Math.floor(endTotal % 24)}:${((endTotal % 1) * 60).toString().padStart(2, '0')}`;
    
    card.querySelector('#wh-hourly-breakdown').style.display = 'block';
}

// Show multiple shifts summary
function whShowShiftsSummary(shiftsData, symbol) {
    const card = document.currentScript?.closest('.card') || document;
    const summary = card.querySelector('#wh-shifts-summary');
    
    let summaryHTML = '<div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:8px;">';
    
    // Main shift (always first)
    summaryHTML += `
        <div style="padding:10px;background:rgba(45,212,255,0.05);border-radius:6px;">
            <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Main Shift</div>
            <div style="font-size:14px;font-weight:600;color:#2dd4ff;">${shiftsData[0] ? whFormatHours(shiftsData[0].totalHours) : '0h'}</div>
            <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:2px;">${symbol}${shiftsData[0]?.totalPay?.toFixed(2) || '0.00'}</div>
        </div>
    `;
    
    // Additional shifts
    shiftsData.slice(1).forEach((shift, index) => {
        summaryHTML += `
            <div style="padding:10px;background:rgba(57,255,20,0.05);border-radius:6px;">
                <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Shift ${index + 2}</div>
                <div style="font-size:14px;font-weight:600;color:#39ff14;">${whFormatHours(shift.totalHours)}</div>
                <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:2px;">${shift.startTime} - ${shift.endTime}</div>
            </div>
        `;
    });
    
    summaryHTML += '</div>';
    summary.innerHTML = summaryHTML;
}

// Copy timesheet to clipboard
function whCopyTimesheet() {
    const card = document.currentScript?.closest('.card') || document;
    const currency = card.querySelector('#wh-currency').value;
    const symbol = whCurrencySymbols[currency] || currency;
    const date = card.querySelector('#wh-date').value;
    
    let output = `‚è±Ô∏è Work Hours Timesheet\n`;
    output += `======================\n\n`;
    output += `Date: ${date}\n\n`;
    
    // Get main shift values
    const startTime = card.querySelector('#wh-start-time').value;
    const endTime = card.querySelector('#wh-end-time').value;
    const breakMinutes = parseInt(card.querySelector('#wh-break-duration').value) || 0;
    const breakType = card.querySelector('#wh-break-type').value;
    
    // Get calculated values from display
    const totalHours = card.querySelector('#wh-total-hours').textContent;
    const regularHours = card.querySelector('#wh-regular-hours').textContent;
    const overtimeHours = card.querySelector('#wh-overtime-hours').textContent;
    const totalPay = card.querySelector('#wh-total-pay').textContent;
    
    output += `MAIN SHIFT:\n`;
    output += `Start: ${startTime}\n`;
    output += `End: ${endTime}\n`;
    if (breakMinutes > 0) {
        output += `Break: ${breakMinutes} minutes (${breakType})\n`;
    }
    output += `Total Hours: ${totalHours}\n`;
    output += `Regular Hours: ${regularHours}\n`;
    output += `Overtime Hours: ${overtimeHours}\n`;
    output += `Total Pay: ${totalPay}\n\n`;
    
    // Add breakdown if available
    const breakdown = card.querySelector('#wh-breakdown');
    if (breakdown.style.display !== 'none') {
        output += `BREAKDOWN:\n`;
        const timeLines = card.querySelector('#wh-time-summary').textContent.split('\n');
        const payLines = card.querySelector('#wh-pay-summary').textContent.split('\n');
        
        timeLines.forEach(line => {
            if (line.trim()) output += `${line.trim()}\n`;
        });
        output += `\n`;
        payLines.forEach(line => {
            if (line.trim()) output += `${line.trim()}\n`;
        });
        output += `\n`;
    }
    
    // Add multiple shifts if available
    if (whShifts.length > 0) {
        output += `ADDITIONAL SHIFTS:\n`;
        whShifts.forEach((shift, index) => {
            output += `Shift ${index + 1}: ${shift.startTime} - ${shift.endTime}\n`;
            if (shift.breakMinutes > 0) {
                output += `  Break: ${shift.breakMinutes} minutes\n`;
            }
        });
        output += `\n`;
    }
    
    output += `Generated with Work Hours Calculator`;
    
    navigator.clipboard.writeText(output).then(() => {
        card.querySelector('#wh-hint').textContent = 'Timesheet copied!';
        card.querySelector('#wh-hint').style.color = '#39ff14';
        
        setTimeout(() => {
            card.querySelector('#wh-hint').textContent = '';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
        card.querySelector('#wh-hint').textContent = 'Copy failed';
        card.querySelector('#wh-hint').style.color = '#ff4d4d';
    });
}

// Reset form
function whReset() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Reset form values
    card.querySelector('#wh-start-time').value = '09:00';
    card.querySelector('#wh-end-time').value = '17:00';
    card.querySelector('#wh-hourly-rate').value = '15.00';
    card.querySelector('#wh-overtime-rate').value = '1.5';
    card.querySelector('#wh-overtime-threshold').value = '8';
    card.querySelector('#wh-break-duration').value = '60';
    card.querySelector('#wh-break-type').value = 'unpaid';
    
    // Set today's date
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    card.querySelector('#wh-date').value = formattedDate;
    
    // Clear shifts
    whShifts = [];
    card.querySelector('#wh-shifts-list').innerHTML = '';
    
    // Reset displays
    card.querySelector('#wh-total-hours').textContent = '‚Äì';
    card.querySelector('#wh-regular-hours').textContent = '‚Äì';
    card.querySelector('#wh-overtime-hours').textContent = '‚Äì';
    card.querySelector('#wh-total-pay').textContent = '‚Äì';
    
    // Hide detailed sections
    card.querySelector('#wh-breakdown').style.display = 'none';
    card.querySelector('#wh-hourly-breakdown').style.display = 'none';
    card.querySelector('#wh-shifts-results').style.display = 'none';
    
    // Reset status
    card.querySelector('#wh-status').textContent = 'Enter shift details to calculate';
    card.querySelector('#wh-status').style.color = '';
    card.querySelector('#wh-hint').textContent = '';
    
    console.log('Work Hours Calculator reset');
}

// Initialize when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', whInitialize);
} else {
    whInitialize();
}

// Auto-calculate when key inputs change
document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    const inputs = card.querySelectorAll('#wh-start-time, #wh-end-time, #wh-hourly-rate');
    
    inputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.value) {
                whCalculate();
            }
        });
    });
});
</script>

<style>
#workhours-title {
    color: var(--accent);
    margin-top: 0;
    font-size: 1.2rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .actions button {
        min-width: 100% !important;
        margin-bottom: 8px;
    }
    
    .wh-shift {
        grid-template-columns: 1fr 1fr !important;
    }
    
    #wh-hourly-chart {
        height: 40px !important;
    }
}

/* Animation for calculated values */
@keyframes highlight {
    0% { background-color: rgba(45,212,255,0.1); }
    100% { background-color: transparent; }
}

.highlight {
    animation: highlight 1s ease;
}

/* Tooltip for chart bars */
#wh-hourly-chart div:hover {
    opacity: 0.8;
}
</style>
