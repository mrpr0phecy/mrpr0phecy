<h2 id="retirement-calculator-title">üí∞ Retirement Calculator</h2>

<form aria-describedby="retirement-calculator-desc">
    <p id="retirement-calculator-desc" class="small" style="margin-bottom:20px;color:var(--muted)">
        Estimate your retirement savings growth with compound interest.
        <span style="color:var(--accent)">‚ö†Ô∏è Educational only ‚Äî consult a financial advisor.</span>
    </p>
    
    <!-- CURRENT SITUATION -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üìä Current Situation</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
            <div>
                <label for="rc-current-savings" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Current Savings
                </label>
                <div style="display:flex;gap:8px;">
                    <select id="rc-currency" style="width:80px;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                        <option value="$">$ USD</option>
                        <option value="¬£">¬£ GBP</option>
                        <option value="‚Ç¨">‚Ç¨ EUR</option>
                        <option value="¬•">¬• JPY</option>
                    </select>
                    <input id="rc-current-savings" type="number" min="0" step="1000" placeholder="0" value="10000" 
                           style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                </div>
            </div>
            
            <div>
                <label for="rc-current-age" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Current Age
                </label>
                <input id="rc-current-age" type="number" min="18" max="100" value="30" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- CONTRIBUTIONS -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üí∏ Contributions</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="rc-monthly-contrib" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Monthly Contribution
                </label>
                <input id="rc-monthly-contrib" type="number" min="0" step="50" placeholder="500" value="500" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
            
            <div>
                <label for="rc-annual-increase" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Annual Increase (%)
                </label>
                <input id="rc-annual-increase" type="number" min="0" max="20" step="0.5" placeholder="3" value="3" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- RETURNS & TIMELINE -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üìà Growth & Timeline</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="rc-annual-return" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Annual Return (%)
                </label>
                <input id="rc-annual-return" type="number" min="0" max="20" step="0.1" placeholder="7" value="7" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
            
            <div>
                <label for="rc-retirement-age" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Retirement Age
                </label>
                <input id="rc-retirement-age" type="number" min="40" max="100" value="65" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- WITHDRAWAL STRATEGY -->
    <div style="margin-bottom:20px;">
        <details>
            <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.1);">
                ‚öôÔ∏è Withdrawal Strategy
            </summary>
            <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Retirement Withdrawals</div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
                    <div>
                        <label for="rc-withdrawal-rate" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Annual Withdrawal Rate (%)
                        </label>
                        <input id="rc-withdrawal-rate" type="number" min="1" max="10" step="0.25" value="4" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                    
                    <div>
                        <label for="rc-retirement-length" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Retirement Length (Years)
                        </label>
                        <input id="rc-retirement-length" type="number" min="10" max="50" step="5" value="30" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                </div>
                
                <div style="margin-top:8px;font-size:12px;color:#ffcc00;">
                    üí° The "4% rule" suggests withdrawing 4% annually in retirement
                </div>
            </div>
        </details>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div style="display:flex;gap:10px;">
        <button type="button" onclick="rcCalculate()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.3), rgba(45,212,255,0.2));border:1px solid rgba(45,212,255,0.6);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üßÆ Calculate
        </button>
        <button type="button" onclick="rcReset()"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            üîÑ Reset
        </button>
    </div>
</form>

<!-- RESULTS -->
<div id="rc-results" style="margin-top:24px;display:none;">
    <h3 style="color:var(--accent);margin-bottom:16px;font-size:16px;">üìä Retirement Projection</h3>
    
    <!-- QUICK SUMMARY -->
    <div style="margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:bold;color:#39ff14;" id="rc-future-value">$0</div>
                <div style="font-size:11px;color:var(--muted);">Retirement Nest Egg</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:var(--accent);" id="rc-monthly-income">$0</div>
                <div style="font-size:11px;color:var(--muted);">Monthly Withdrawal</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#ffcc00;" id="rc-years-to-go">0</div>
                <div style="font-size:11px;color:var(--muted);">Years to Retirement</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#9d4edd;" id="rc-interest-earned">$0</div>
                <div style="font-size:11px;color:var(--muted);">Interest Earned</div>
            </div>
        </div>
    </div>
    
    <!-- BREAKDOWN CHART -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìà Savings Breakdown</div>
        <div style="position:relative;height:200px;background:rgba(0,0,0,0.2);border-radius:8px;padding:12px;">
            <canvas id="rc-chart" width="400" height="200"></canvas>
        </div>
    </div>
    
    <!-- YEARLY PROJECTION -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìÖ Yearly Projection</div>
        <div id="rc-projection" style="max-height:300px;overflow-y:auto;padding:4px;">
            <!-- Yearly data will appear here -->
        </div>
    </div>
    
    <!-- RETIREMENT SUSTAINABILITY -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üîÑ Retirement Sustainability</div>
        <div id="rc-sustainability" style="padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border-left:3px solid #39ff14;">
            <!-- Sustainability analysis will appear here -->
        </div>
    </div>
    
    <!-- EXPORT OPTIONS -->
    <div style="display:flex;gap:8px;">
        <button type="button" onclick="rcExport()" 
                style="flex:1;padding:10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:13px;">
            üì• Export Plan
        </button>
        <button type="button" onclick="rcSave()"
                style="padding:10px 14px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:13px;">
            üíæ Save
        </button>
        <button type="button" onclick="rcPrint()"
                style="padding:10px 14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-size:13px;">
            üñ®Ô∏è Print
        </button>
    </div>
</div>

<!-- MATH DETAILS -->
<details style="margin-top:20px;">
    <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(0,0,0,0.2);border-radius:8px;">
        üìö How the Math Works
    </summary>
    <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-family:monospace;font-size:13px;color:var(--muted);">
            <div>Future Value Formula:</div>
            <div>FV = P √ó (1+r)^n + C √ó [((1+r)^n ‚àí 1) / r]</div>
            <div>Where:</div>
            <div>  P = Current savings</div>
            <div>  C = Monthly contribution</div>
            <div>  r = Monthly interest rate (annual rate / 12)</div>
            <div>  n = Number of months until retirement</div>
            <div>  Includes annual contribution increases</div>
            <div style="margin-top:8px;color:#ffcc00;">‚ö†Ô∏è Educational only ‚Äî consult a financial advisor for real planning.</div>
        </div>
    </div>
</details>

<script>
/* retirement-calculator.html
   - Retirement savings calculator with projections
   - Scoped with rc- prefix (Retirement Calculator)
*/

let rcChart = null;

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rcInit);
} else {
    rcInit();
}

function rcInit() {
    console.log('Retirement Calculator initialized');
    
    // Load saved data if any
    const saved = localStorage.getItem('rc-data');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            
            // Load all inputs
            for (const [key, value] of Object.entries(data)) {
                const input = document.getElementById(`rc-${key}`);
                if (input) input.value = value;
            }
        } catch (e) {
            console.error('Failed to load saved data:', e);
        }
    }
}

// Save data
function rcSaveData() {
    const data = {
        'current-savings': document.getElementById('rc-current-savings').value,
        'current-age': document.getElementById('rc-current-age').value,
        'monthly-contrib': document.getElementById('rc-monthly-contrib').value,
        'annual-increase': document.getElementById('rc-annual-increase').value,
        'annual-return': document.getElementById('rc-annual-return').value,
        'retirement-age': document.getElementById('rc-retirement-age').value,
        'withdrawal-rate': document.getElementById('rc-withdrawal-rate').value,
        'retirement-length': document.getElementById('rc-retirement-length').value,
        'currency': document.getElementById('rc-currency').value
    };
    
    localStorage.setItem('rc-data', JSON.stringify(data));
}

// Format currency
function rcFormatCurrency(amount, currency = '$') {
    if (amount >= 1000000) {
        return `${currency}${(amount / 1000000).toFixed(2)}M`;
    } else if (amount >= 1000) {
        return `${currency}${(amount / 1000).toFixed(1)}K`;
    } else {
        return `${currency}${amount.toFixed(0)}`;
    }
}

// Calculate retirement projection
function rcCalculate() {
    // Get inputs
    const currentSavings = parseFloat(document.getElementById('rc-current-savings').value) || 0;
    const currentAge = parseInt(document.getElementById('rc-current-age').value) || 30;
    const monthlyContrib = parseFloat(document.getElementById('rc-monthly-contrib').value) || 0;
    const annualIncrease = parseFloat(document.getElementById('rc-annual-increase').value) / 100 || 0;
    const annualReturn = parseFloat(document.getElementById('rc-annual-return').value) / 100 || 0;
    const retirementAge = parseInt(document.getElementById('rc-retirement-age').value) || 65;
    const withdrawalRate = parseFloat(document.getElementById('rc-withdrawal-rate').value) / 100 || 0.04;
    const retirementLength = parseInt(document.getElementById('rc-retirement-length').value) || 30;
    const currency = document.getElementById('rc-currency').value;
    
    if (currentAge >= retirementAge) {
        rcShowMessage('Current age must be less than retirement age', 'warning');
        return;
    }
    
    // Calculate years to retirement
    const yearsToRetirement = retirementAge - currentAge;
    const monthsToRetirement = yearsToRetirement * 12;
    
    // Calculate future value with compounding and increasing contributions
    const monthlyReturn = annualReturn / 12;
    let futureValue = currentSavings;
    let totalContributions = 0;
    let currentMonthlyContrib = monthlyContrib;
    const yearlyData = [];
    
    // Project year by year
    for (let year = 1; year <= yearsToRetirement; year++) {
        let yearEndBalance = futureValue;
        
        // Monthly compounding for this year
        for (let month = 1; month <= 12; month++) {
            // Add monthly contribution at start of month
            yearEndBalance += currentMonthlyContrib;
            totalContributions += currentMonthlyContrib;
            
            // Apply monthly interest
            yearEndBalance *= (1 + monthlyReturn);
        }
        
        futureValue = yearEndBalance;
        
        // Store yearly data
        yearlyData.push({
            year: year,
            age: currentAge + year,
            balance: futureValue,
            contributions: currentMonthlyContrib * 12,
            yearContributions: currentMonthlyContrib * 12
        });
        
        // Increase contributions for next year
        currentMonthlyContrib *= (1 + annualIncrease);
    }
    
    // Calculate interest earned
    const totalInterest = futureValue - totalContributions - currentSavings;
    
    // Calculate retirement withdrawal info
    const annualWithdrawal = futureValue * withdrawalRate;
    const monthlyWithdrawal = annualWithdrawal / 12;
    
    // Calculate retirement sustainability
    const sustainabilityYears = rcCalculateSustainability(futureValue, annualWithdrawal, annualReturn);
    
    // Display results
    rcDisplayResults(
        futureValue, 
        monthlyWithdrawal, 
        yearsToRetirement, 
        totalInterest, 
        totalContributions + currentSavings,
        currency
    );
    
    // Show yearly projection
    rcDisplayProjection(yearlyData, currency);
    
    // Show sustainability analysis
    rcDisplaySustainability(sustainabilityYears, retirementLength, annualWithdrawal, futureValue, currency);
    
    // Draw chart
    rcDrawChart(currentSavings, totalContributions, totalInterest, currency);
    
    // Save data
    rcSaveData();
    
    // Show results section
    document.getElementById('rc-results').style.display = 'block';
    
    rcShowMessage('Calculation complete!', 'success');
}

// Calculate retirement sustainability
function rcCalculateSustainability(balance, annualWithdrawal, annualReturn) {
    let years = 0;
    let remaining = balance;
    const monthlyReturn = annualReturn / 12;
    
    while (remaining > 0 && years < 100) {
        // Apply monthly interest for the year
        for (let month = 1; month <= 12; month++) {
            remaining *= (1 + monthlyReturn);
            // Monthly withdrawal
            remaining -= (annualWithdrawal / 12);
            
            if (remaining <= 0) {
                return years + (month / 12);
            }
        }
        years++;
    }
    
    return years;
}

// Display main results
function rcDisplayResults(futureValue, monthlyWithdrawal, yearsToRetirement, totalInterest, totalContributions, currency) {
    document.getElementById('rc-future-value').textContent = rcFormatCurrency(futureValue, currency);
    document.getElementById('rc-monthly-income').textContent = rcFormatCurrency(monthlyWithdrawal, currency);
    document.getElementById('rc-years-to-go').textContent = yearsToRetirement;
    document.getElementById('rc-interest-earned').textContent = rcFormatCurrency(totalInterest, currency);
}

// Display yearly projection
function rcDisplayProjection(yearlyData, currency) {
    const container = document.getElementById('rc-projection');
    let html = '<div style="display:flex;flex-direction:column;gap:8px;">';
    
    yearlyData.forEach(data => {
        html += `
            <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:3px solid var(--accent);">
                <div>
                    <div style="color:var(--accent);font-weight:500;">Age ${data.age}</div>
                    <div style="font-size:11px;color:var(--muted);">Year ${data.year}</div>
                </div>
                <div style="text-align:right;">
                    <div style="color:#39ff14;font-weight:600;">${rcFormatCurrency(data.balance, currency)}</div>
                    <div style="font-size:11px;color:var(--muted);">Balance</div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// Display sustainability analysis
function rcDisplaySustainability(sustainabilityYears, retirementLength, annualWithdrawal, futureValue, currency) {
    const container = document.getElementById('rc-sustainability');
    let html = '';
    
    const sustainabilityRatio = sustainabilityYears / retirementLength;
    let status = '';
    let statusColor = '';
    
    if (sustainabilityRatio >= 1.5) {
        status = 'Excellent';
        statusColor = '#39ff14';
    } else if (sustainabilityRatio >= 1.0) {
        status = 'Good';
        statusColor = '#2dd4ff';
    } else if (sustainabilityRatio >= 0.75) {
        status = 'Moderate';
        statusColor = '#ffcc00';
    } else {
        status = 'Insufficient';
        statusColor = '#ff2d55';
    }
    
    html += `
        <div style="margin-bottom:8px;">
            <span style="color:var(--accent);">Sustainability: </span>
            <span style="color:${statusColor};font-weight:600;">${status}</span>
        </div>
        <div style="margin-bottom:8px;font-size:13px;">
            ‚Ä¢ Funds should last <strong>${sustainabilityYears.toFixed(1)} years</strong><br>
            ‚Ä¢ Your target retirement length: <strong>${retirementLength} years</strong><br>
            ‚Ä¢ Annual withdrawal: <strong>${rcFormatCurrency(annualWithdrawal, currency)}</strong><br>
            ‚Ä¢ Withdrawal rate: <strong>${(annualWithdrawal / futureValue * 100).toFixed(1)}%</strong>
        </div>
    `;
    
    if (sustainabilityYears < retirementLength) {
        html += `
            <div style="margin-top:8px;padding:8px;background:rgba(255,45,85,0.1);border-radius:6px;border-left:3px solid #ff2d55;">
                <div style="color:#ff2d55;font-weight:500;font-size:13px;">‚ö†Ô∏è Recommendation:</div>
                <div style="font-size:12px;color:var(--muted);">
                    Consider saving more or reducing withdrawal rate to ${((annualWithdrawal * (sustainabilityYears / retirementLength)) / futureValue * 100).toFixed(1)}%
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// Draw chart
function rcDrawChart(initial, contributions, interest, currency) {
    const canvas = document.getElementById('rc-chart');
    const ctx = canvas.getContext('2d');
    
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Calculate percentages
    const total = initial + contributions + interest;
    const initialPercent = (initial / total) * 100;
    const contribPercent = (contributions / total) * 100;
    const interestPercent = (interest / total) * 100;
    
    // Draw donut chart
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = Math.min(centerX, centerY) - 20;
    
    let startAngle = 0;
    const segments = [
        { percent: initialPercent, color: '#2dd4ff', label: 'Initial' },
        { percent: contribPercent, color: '#39ff14', label: 'Contributions' },
        { percent: interestPercent, color: '#ffcc00', label: 'Interest' }
    ];
    
    // Draw segments
    segments.forEach(segment => {
        if (segment.percent <= 0) return;
        
        const endAngle = startAngle + (segment.percent / 100) * 2 * Math.PI;
        
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = segment.color;
        ctx.fill();
        
        // Draw segment border
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.strokeStyle = 'rgba(255,255,255,0.3)';
        ctx.lineWidth = 1;
        ctx.stroke();
        
        startAngle = endAngle;
    });
    
    // Draw center hole
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.6, 0, 2 * Math.PI);
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.fill();
    
    // Draw legend
    let legendY = 20;
    segments.forEach(segment => {
        if (segment.percent <= 0) return;
        
        ctx.fillStyle = segment.color;
        ctx.fillRect(20, legendY, 12, 12);
        
        ctx.fillStyle = '#e6faff';
        ctx.font = '12px Inter, sans-serif';
        ctx.fillText(`${segment.label}: ${segment.percent.toFixed(1)}%`, 40, legendY + 10);
        
        legendY += 20;
    });
    
    // Draw total in center
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 14px Inter, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(rcFormatCurrency(total, currency), centerX, centerY);
    ctx.font = '10px Inter, sans-serif';
    ctx.fillText('Total', centerX, centerY + 20);
}

// Export plan
function rcExport() {
    const currency = document.getElementById('rc-currency').value;
    const currentAge = parseInt(document.getElementById('rc-current-age').value) || 30;
    const retirementAge = parseInt(document.getElementById('rc-retirement-age').value) || 65;
    
    let text = `RETIREMENT SAVINGS PLAN\n`;
    text += `Generated: ${new Date().toLocaleDateString()}\n`;
    text += '='.repeat(50) + '\n\n';
    
    text += 'INPUTS:\n';
    text += '='.repeat(50) + '\n\n';
    
    text += `Current Age: ${currentAge}\n`;
    text += `Retirement Age: ${retirementAge}\n`;
    text += `Current Savings: ${currency}${document.getElementById('rc-current-savings').value}\n`;
    text += `Monthly Contribution: ${currency}${document.getElementById('rc-monthly-contrib').value}\n`;
    text += `Annual Contribution Increase: ${document.getElementById('rc-annual-increase').value}%\n`;
    text += `Expected Annual Return: ${document.getElementById('rc-annual-return').value}%\n`;
    text += `Withdrawal Rate: ${document.getElementById('rc-withdrawal-rate').value}%\n`;
    text += `Retirement Length: ${document.getElementById('rc-retirement-length').value} years\n\n`;
    
    text += 'RESULTS:\n';
    text += '='.repeat(50) + '\n\n';
    
    const results = document.querySelectorAll('#rc-results .result, #rc-sustainability');
    results.forEach(result => {
        text += result.textContent.replace(/\s+/g, ' ').trim() + '\n';
    });
    
    text += '\n' + '='.repeat(50) + '\n';
    text += '‚ö†Ô∏è Educational only ‚Äî consult a financial advisor for real planning.';
    
    // Create download
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `retirement-plan-${currentAge}-${retirementAge}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    rcShowMessage('Plan exported!', 'success');
}

// Save data
function rcSave() {
    rcSaveData();
    rcShowMessage('Settings saved!', 'success');
}

// Print results
function rcPrint() {
    const printContent = document.getElementById('rc-results').innerHTML;
    const originalContent = document.body.innerHTML;
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Retirement Plan</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                h3 { color: #2dd4ff; }
                .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }
                .stat { padding: 10px; background: #f5f5f5; border-radius: 8px; text-align: center; }
                .stat-value { font-size: 20px; font-weight: bold; color: #2dd4ff; }
                .stat-label { font-size: 12px; color: #666; }
            </style>
        </head>
        <body>
            ${printContent}
            <div style="text-align:center;margin-top:30px;color:#999;font-size:12px;">
                Generated with Retirement Calculator
            </div>
            <script>
                window.onload = () => window.print();
            <\/script>
        </body>
        </html>
    `);
    printWindow.document.close();
}

// Reset calculator
function rcReset() {
    if (confirm('Reset all inputs?')) {
        document.querySelector('form').reset();
        document.getElementById('rc-results').style.display = 'none';
        
        // Clear chart
        const canvas = document.getElementById('rc-chart');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        localStorage.removeItem('rc-data');
        rcShowMessage('Calculator reset', 'info');
    }
}

// Show message
function rcShowMessage(msg, type) {
    const colors = { success: '#39ff14', warning: '#ffcc00', error: '#ff2d55', info: '#2dd4ff' };
    
    // Remove existing
    const existing = document.querySelector('.rc-msg');
    if (existing) existing.remove();
    
    // Create new
    const div = document.createElement('div');
    div.className = 'rc-msg';
    div.textContent = msg;
    div.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background: rgba(0,0,0,0.9);
        border: 1px solid ${colors[type]};
        border-radius: 8px;
        color: ${colors[type]};
        z-index: 10000;
        font-weight: 500;
        animation: rcSlideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(div);
    
    setTimeout(() => {
        div.style.animation = 'rcSlideOut 0.3s ease-out';
        setTimeout(() => div.remove(), 300);
    }, 3000);
}

// Add animation styles
if (!document.querySelector('#rc-styles')) {
    const style = document.createElement('style');
    style.id = 'rc-styles';
    style.textContent = `
        @keyframes rcSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes rcSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        #rc-projection::-webkit-scrollbar {
            width: 6px;
        }
        
        #rc-projection::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        #rc-projection::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }
        
        details[open] summary {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        details[open] summary ~ div {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border: 1px solid rgba(255,204,0,0.1);
            border-top: none;
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
#retirement-calculator-title {
    color: var(--accent);
    margin-top: 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    #rc-chart {
        height: 180px !important;
    }
    
    #rc-projection {
        max-height: 250px !important;
    }
    
    .grid-stats {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    
    input, button, select {
        font-size: 16px !important; /* Prevents iOS zoom */
        min-height: 44px; /* Better touch target */
    }
    
    button {
        padding: 12px !important;
    }
}
</style>
