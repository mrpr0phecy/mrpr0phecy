<article class="card" id="retirement-card" aria-labelledby="retirement-title">
  <h2 id="retirement-title" style="margin-top:0;">Retirement Savings Calculator</h2>

  <form aria-describedby="retirement-desc">
    <p id="retirement-desc" class="small">Estimate how your savings will grow with regular contributions and compound interest.</p>

    <div class="field">
      <label for="retirement-current">Current savings</label>
      <div class="input"><input id="retirement-current" type="number" inputmode="decimal" min="0" step="100" value="10000" /></div>
    </div>

    <div class="row">
      <div class="field">
        <label for="retirement-monthly">Monthly contribution</label>
        <div class="input"><input id="retirement-monthly" type="number" min="0" step="50" value="500" /></div>
      </div>
      <div class="field">
        <label for="retirement-rate">Annual interest rate (%)</label>
        <div class="input"><input id="retirement-rate" type="number" min="0" step="0.1" value="5" /></div>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="retirement-years">Years until retirement</label>
        <div class="input"><input id="retirement-years" type="number" min="1" step="1" value="30" /></div>
      </div>
    </div>

    <div class="actions">
      <button type="button" onclick="retirementCalculate(this)">Calculate</button>
      <button type="button" class="secondary" onclick="retirementReset(this)">Reset</button>
    </div>
  </form>

  <div class="results" aria-live="polite">
    <div class="result">
      <div class="label">Future value</div>
      <div class="value" id="retirement-res-future">–</div>
    </div>
    <div class="result">
      <div class="label">Total contributions</div>
      <div class="value" id="retirement-res-contrib">–</div>
    </div>
    <div class="result">
      <div class="label">Total interest earned</div>
      <div class="value" id="retirement-res-interest">–</div>
    </div>
  </div>

  <!-- Chart -->
  <div style="margin-top:20px;">
    <canvas id="retirement-chart" width="400" height="200" aria-label="Savings growth chart"></canvas>
  </div>

  <details class="small" style="margin-top:12px;">
    <summary>How the math works</summary>
    <p>
      Future value = Current savings × (1+r)^n + Contributions × (((1+r)^n − 1) / r).  
      r = monthly interest rate, n = number of months.
    </p>
  </details>
</article>

<script>
function retirementCalculate(btn) {
  const card = btn.closest('.card');
  const get = id => card.querySelector('#'+id);
  const current = parseFloat(get('retirement-current').value) || 0;
  const monthly = parseFloat(get('retirement-monthly').value) || 0;
  const rateA = (parseFloat(get('retirement-rate').value) || 0) / 100;
  const years = parseInt(get('retirement-years').value, 10) || 0;

  const months = years * 12;
  const r = rateA / 12;

  // Compound growth
  const futureValue = current * Math.pow(1+r, months) +
    monthly * ((Math.pow(1+r, months) - 1) / r);

  const totalContrib = monthly * months + current;
  const interestEarned = futureValue - totalContrib;

  const fmtMoney = n => new Intl.NumberFormat(undefined, { style: 'currency', currency: 'GBP' }).format(n);
  card.querySelector('#retirement-res-future').textContent  = fmtMoney(futureValue);
  card.querySelector('#retirement-res-contrib').textContent = fmtMoney(totalContrib);
  card.querySelector('#retirement-res-interest').textContent= fmtMoney(interestEarned);

  drawRetirementChart(futureValue, totalContrib, interestEarned);
}

function retirementReset(btn) {
  const card = btn.closest('.card');
  const form = card.querySelector('form');
  form.reset();
  card.querySelector('#retirement-res-future').textContent   = '–';
  card.querySelector('#retirement-res-contrib').textContent  = '–';
  card.querySelector('#retirement-res-interest').textContent = '–';
  const ctx = card.querySelector('#retirement-chart').getContext('2d');
  ctx.clearRect(0,0,400,200);
}

function drawRetirementChart(future, contrib, interest) {
  const canvas = document.getElementById('retirement-chart');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const values = [contrib, interest];
  const colors = ['#2dd4ff','#9ccbe0'];
  const labels = ['Contributions','Interest'];

  const total = future;
  let startAngle = 0;

  values.forEach((val,i) => {
    const sliceAngle = (val/total) * 2*Math.PI;
    ctx.fillStyle = colors[i];
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, canvas.height/2);
    ctx.arc(canvas.width/2, canvas.height/2, 90, startAngle, startAngle+sliceAngle);
    ctx.closePath();
    ctx.fill();
    startAngle += sliceAngle;
  });

  ctx.fillStyle = '#e6faff';
  ctx.font = '12px Inter, sans-serif';
  ctx.fillText(labels[0], 10, 20);
  ctx.fillText(labels[1], 10, 40);
}
</script>
