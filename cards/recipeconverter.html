<!-- cards/recipe-converter.html -->
<h2 id="recipe-converter-title">üç≥ Recipe Converter</h2>

<form aria-describedby="recipe-converter-desc">
    <p id="recipe-converter-desc" class="small" style="margin-bottom:20px;color:var(--muted)">
        Scale recipes, convert measurements, and adjust serving sizes.
        <span style="color:var(--accent)">Supports metric, imperial, cups, spoons.</span>
    </p>
    
    <!-- BASIC SETTINGS -->
    <div style="margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
            <div>
                <label for="rc-name" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Recipe Name
                </label>
                <input id="rc-name" type="text" placeholder="e.g., Chocolate Chip Cookies" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
            
            <div>
                <label for="rc-category" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Category
                </label>
                <select id="rc-category" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="baking">Baking</option>
                    <option value="cooking">Cooking</option>
                    <option value="dessert">Dessert</option>
                </select>
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px;">
            <div>
                <label for="rc-original" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Original Servings
                </label>
                <input id="rc-original" type="number" min="1" max="100" value="4" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;text-align:center;" />
            </div>
            
            <div>
                <label for="rc-new" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    New Servings
                </label>
                <input id="rc-new" type="number" min="1" max="100" value="2" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;text-align:center;" />
            </div>
        </div>
    </div>
    
    <!-- QUICK SERVING BUTTONS -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--muted);margin-bottom:8px;font-size:13px;">Quick Adjust:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="rcSetServings(0.5)" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Half</button>
            <button type="button" onclick="rcSetServings(1)" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Original</button>
            <button type="button" onclick="rcSetServings(2)" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Double</button>
            <button type="button" onclick="rcSetServings(3)" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Triple</button>
        </div>
    </div>
    
    <!-- INGREDIENT MANAGER -->
    <div style="margin-bottom:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 style="color:var(--accent);margin:0;font-size:16px;">ü•ï Ingredients</h3>
            <button type="button" onclick="rcAddIngredient()" 
                    style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
                + Add
            </button>
        </div>
        
        <div id="rc-ingredients-container" style="display:flex;flex-direction:column;gap:8px;">
            <!-- Ingredients will be added here -->
            <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);font-size:14px;">
                No ingredients yet. Click "Add" to start.
            </div>
        </div>
    </div>
    
    <!-- MEASUREMENT CONVERSION -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üìè Convert Units</h3>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
            <div>
                <select id="rc-from-unit" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="cups">Cups</option>
                    <option value="tbsp">Tablespoons</option>
                    <option value="tsp">Teaspoons</option>
                    <option value="g">Grams</option>
                    <option value="oz">Ounces</option>
                </select>
            </div>
            
            <div>
                <select id="rc-to-unit" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="ml">Milliliters</option>
                    <option value="g">Grams</option>
                    <option value="cups">Cups</option>
                    <option value="oz">Ounces</option>
                    <option value="tbsp">Tablespoons</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="rcConvert()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.3), rgba(45,212,255,0.2));border:1px solid rgba(45,212,255,0.6);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üîÑ Convert
        </button>
        <button type="button" onclick="rcReset()"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            Reset
        </button>
    </div>
</form>

<!-- RESULTS -->
<div id="rc-results" style="margin-top:20px;display:none;">
    <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üìä Results</h3>
    
    <div style="margin-bottom:16px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:8px;margin-bottom:12px;">
            <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;text-align:center;">
                <div style="font-size:18px;font-weight:bold;color:#39ff14;" id="rc-scale-factor">1.0x</div>
                <div style="font-size:11px;color:var(--muted);">Scale</div>
            </div>
            
            <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;text-align:center;">
                <div style="font-size:18px;font-weight:bold;color:var(--accent);" id="rc-original-count">4</div>
                <div style="font-size:11px;color:var(--muted);">Original</div>
            </div>
            
            <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;text-align:center;">
                <div style="font-size:18px;font-weight:bold;color:#ffcc00;" id="rc-new-count">2</div>
                <div style="font-size:11px;color:var(--muted);">New</div>
            </div>
        </div>
    </div>
    
    <div id="rc-ingredient-results" style="max-height:300px;overflow-y:auto;padding:4px;">
        <!-- Results will appear here -->
    </div>
    
    <div style="margin-top:16px;display:flex;gap:8px;">
        <button type="button" onclick="rcCopy()" 
                style="flex:1;padding:10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:13px;">
            üìã Copy Results
        </button>
        <button type="button" onclick="rcExport()"
                style="padding:10px 14px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:13px;">
            üì• Export
        </button>
    </div>
</div>

<script>
/* recipe-converter.html
   - Recipe scaling and conversion tool
   - Scoped with rc- prefix (Recipe Converter)
*/

let rcIngredients = [];
let rcConvertedIngredients = [];

// Conversion factors
const rcConversions = {
    cups: { ml: 240, g: 200, oz: 8.45, tbsp: 16, tsp: 48 },
    tbsp: { ml: 15, g: 14, oz: 0.53, cups: 0.0625, tsp: 3 },
    tsp: { ml: 5, g: 4.7, oz: 0.17, cups: 0.0208, tbsp: 0.333 },
    g: { oz: 0.035, cups: 0.005, tbsp: 0.071, tsp: 0.214 },
    oz: { g: 28.35, cups: 0.118, tbsp: 1.89, tsp: 5.67 },
    ml: { cups: 0.0042, tbsp: 0.067, tsp: 0.2, oz: 0.034 }
};

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rcInit);
} else {
    rcInit();
}

function rcInit() {
    console.log('Recipe Converter initialized');
    // Add first ingredient automatically
    setTimeout(() => {
        rcAddIngredient();
        // Set defaults for first ingredient
        setTimeout(() => {
            const first = document.querySelector('.rc-ingredient');
            if (first) {
                first.querySelector('.rc-ing-name').value = 'Flour';
                first.querySelector('.rc-ing-amount').value = '2';
                first.querySelector('.rc-ing-unit').value = 'cups';
            }
        }, 100);
    }, 500);
}

// Add ingredient row
function rcAddIngredient() {
    const container = document.getElementById('rc-ingredients-container');
    
    // Remove placeholder if present
    const placeholder = container.querySelector('div');
    if (placeholder && placeholder.innerHTML.includes('No ingredients')) {
        placeholder.remove();
    }
    
    const id = 'ing-' + Date.now();
    const div = document.createElement('div');
    div.className = 'rc-ingredient';
    div.id = id;
    div.style.cssText = 'padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);';
    
    div.innerHTML = `
        <div style="display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" class="rc-ing-name" placeholder="Name" 
                   style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
            
            <input type="text" class="rc-ing-amount" placeholder="Amount" 
                   style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;text-align:center;" />
            
            <select class="rc-ing-unit" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
                <option value="cups">cups</option>
                <option value="tbsp">tbsp</option>
                <option value="tsp">tsp</option>
                <option value="g">g</option>
                <option value="oz">oz</option>
                <option value="ml">ml</option>
                <option value="each">each</option>
            </select>
            
            <button type="button" onclick="rcRemoveIngredient('${id}')" 
                    style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px;font-size:18px;">√ó</button>
        </div>
    `;
    
    container.appendChild(div);
}

// Remove ingredient
function rcRemoveIngredient(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
    
    const container = document.getElementById('rc-ingredients-container');
    if (container.children.length === 0) {
        container.innerHTML = `
            <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);font-size:14px;">
                No ingredients yet. Click "Add" to start.
            </div>
        `;
    }
}

// Set servings
function rcSetServings(factor) {
    const original = parseInt(document.getElementById('rc-original').value) || 1;
    const newServings = Math.round(original * factor);
    document.getElementById('rc-new').value = newServings;
    rcShowMessage(`Set to ${newServings} servings (${factor}x)`, 'info');
}

// Main conversion function
function rcConvert() {
    // Collect ingredients
    const ingredients = [];
    const items = document.querySelectorAll('.rc-ingredient');
    
    if (items.length === 0) {
        rcShowMessage('Add ingredients first', 'warning');
        return;
    }
    
    items.forEach(item => {
        const name = item.querySelector('.rc-ing-name').value.trim();
        const amount = item.querySelector('.rc-ing-amount').value.trim();
        const unit = item.querySelector('.rc-ing-unit').value;
        
        if (name && amount && unit) {
            ingredients.push({
                name: name,
                amount: parseFloat(amount) || 0,
                unit: unit,
                id: item.id
            });
        }
    });
    
    if (ingredients.length === 0) {
        rcShowMessage('Enter valid ingredients', 'warning');
        return;
    }
    
    // Get scaling
    const original = parseInt(document.getElementById('rc-original').value) || 1;
    const newServing = parseInt(document.getElementById('rc-new').value) || 1;
    const scale = newServing / original;
    
    // Get unit conversion
    const fromUnit = document.getElementById('rc-from-unit').value;
    const toUnit = document.getElementById('rc-to-unit').value;
    
    // Convert
    rcConvertedIngredients = ingredients.map(ing => {
        let scaledAmount = ing.amount * scale;
        let convertedAmount = scaledAmount;
        let convertedUnit = ing.unit;
        
        // Apply unit conversion if different
        if (rcConversions[ing.unit] && rcConversions[ing.unit][toUnit]) {
            convertedAmount = scaledAmount * rcConversions[ing.unit][toUnit];
            convertedUnit = toUnit;
        }
        
        return {
            ...ing,
            scaledAmount: scaledAmount,
            convertedAmount: convertedAmount,
            convertedUnit: convertedUnit,
            display: rcFormatAmount(convertedAmount, convertedUnit) + ' ' + convertedUnit
        };
    });
    
    // Display results
    rcDisplayResults();
    
    // Update metrics
    document.getElementById('rc-scale-factor').textContent = scale.toFixed(2) + 'x';
    document.getElementById('rc-original-count').textContent = original;
    document.getElementById('rc-new-count').textContent = newServing;
    
    // Show results section
    document.getElementById('rc-results').style.display = 'block';
    
    rcShowMessage(`Converted ${ingredients.length} ingredients`, 'success');
}

// Format amount nicely
function rcFormatAmount(amount, unit) {
    if (amount <= 0) return '0';
    
    // For cups, show fractions
    if (unit === 'cups' || unit === 'cup') {
        if (Math.abs(amount - 0.25) < 0.01) return '¬º';
        if (Math.abs(amount - 0.33) < 0.01) return '‚Öì';
        if (Math.abs(amount - 0.5) < 0.01) return '¬Ω';
        if (Math.abs(amount - 0.66) < 0.01) return '‚Öî';
        if (Math.abs(amount - 0.75) < 0.01) return '¬æ';
    }
    
    // Round appropriately
    let rounded = amount;
    if (amount < 1) rounded = Math.round(amount * 4) / 4; // Quarter increments
    else if (amount < 10) rounded = Math.round(amount * 2) / 2; // Half increments
    else rounded = Math.round(amount); // Whole numbers
    
    // Remove trailing zeros
    return rounded.toString().replace(/\.0+$/, '');
}

// Display results
function rcDisplayResults() {
    const container = document.getElementById('rc-ingredient-results');
    
    let html = '<div style="display:flex;flex-direction:column;gap:8px;">';
    
    rcConvertedIngredients.forEach(ing => {
        html += `
            <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:6px;border-left:3px solid #39ff14;">
                <div>
                    <div style="color:var(--accent);font-size:14px;font-weight:500;">${ing.name}</div>
                    <div style="font-size:12px;color:var(--muted);">
                        ${ing.amount} ${ing.unit} ‚Üí ${ing.display}
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// Copy results
function rcCopy() {
    if (rcConvertedIngredients.length === 0) {
        rcShowMessage('No results to copy', 'warning');
        return;
    }
    
    const name = document.getElementById('rc-name').value || 'Recipe';
    const servings = document.getElementById('rc-new').value;
    
    let text = `${name} (Serves ${servings})\n\n`;
    text += 'Ingredients:\n';
    
    rcConvertedIngredients.forEach(ing => {
        text += `‚Ä¢ ${ing.display} ${ing.name}\n`;
    });
    
    text += `\nConverted with Recipe Converter`;
    
    navigator.clipboard.writeText(text).then(() => {
        rcShowMessage('Copied to clipboard!', 'success');
    });
}

// Export results
function rcExport() {
    if (rcConvertedIngredients.length === 0) {
        rcShowMessage('No results to export', 'warning');
        return;
    }
    
    const name = document.getElementById('rc-name').value || 'Recipe';
    const servings = document.getElementById('rc-new').value;
    const original = document.getElementById('rc-original').value;
    const scale = (servings / original).toFixed(2);
    
    let text = `RECIPE: ${name}\n`;
    text += `Original: ${original} servings\n`;
    text += `Converted: ${servings} servings (${scale}x)\n`;
    text += `Generated: ${new Date().toLocaleDateString()}\n`;
    text += '='.repeat(40) + '\n\n';
    text += 'INGREDIENTS:\n';
    text += '='.repeat(40) + '\n\n';
    
    rcConvertedIngredients.forEach((ing, i) => {
        text += `${i + 1}. ${ing.name}\n`;
        text += `   Original: ${ing.amount} ${ing.unit}\n`;
        text += `   Converted: ${ing.display}\n\n`;
    });
    
    // Create download
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${name.toLowerCase().replace(/\s+/g, '-')}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    rcShowMessage('Exported!', 'success');
}

// Reset everything
function rcReset() {
    if (confirm('Reset all inputs?')) {
        // Clear ingredients
        const container = document.getElementById('rc-ingredients-container');
        container.innerHTML = `
            <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);font-size:14px;">
                No ingredients yet. Click "Add" to start.
            </div>
        `;
        
        // Reset form
        document.getElementById('rc-name').value = '';
        document.getElementById('rc-original').value = '4';
        document.getElementById('rc-new').value = '2';
        
        // Hide results
        document.getElementById('rc-results').style.display = 'none';
        
        rcConvertedIngredients = [];
        
        rcShowMessage('Reset complete', 'info');
    }
}

// Show message
function rcShowMessage(msg, type) {
    const colors = { success: '#39ff14', warning: '#ffcc00', error: '#ff2d55', info: '#2dd4ff' };
    
    // Remove existing
    const existing = document.querySelector('.rc-msg');
    if (existing) existing.remove();
    
    // Create new
    const div = document.createElement('div');
    div.className = 'rc-msg';
    div.textContent = msg;
    div.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background: rgba(0,0,0,0.9);
        border: 1px solid ${colors[type]};
        border-radius: 8px;
        color: ${colors[type]};
        z-index: 10000;
        font-weight: 500;
        animation: rcSlideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(div);
    
    setTimeout(() => {
        div.style.animation = 'rcSlideOut 0.3s ease-out';
        setTimeout(() => div.remove(), 300);
    }, 3000);
}

// Add animation styles
if (!document.querySelector('#rc-styles')) {
    const style = document.createElement('style');
    style.id = 'rc-styles';
    style.textContent = `
        @keyframes rcSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes rcSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
#recipe-converter-title {
    color: var(--accent);
    margin-top: 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .rc-ingredient > div {
        grid-template-columns: 1fr 1fr !important;
        gap: 8px !important;
    }
    
    .rc-ingredient > div input,
    .rc-ingredient > div select {
        font-size: 16px !important; /* Prevents iOS zoom */
    }
    
    #rc-ingredients-container {
        max-height: 300px;
        overflow-y: auto;
    }
}
</style>
