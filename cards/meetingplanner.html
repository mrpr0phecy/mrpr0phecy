<h2 id="meeting-planner-title">Meeting Planner & Scheduler</h2>

<form aria-describedby="meeting-planner-desc">
  <p id="meeting-planner-desc" class="small">
    Find optimal meeting times across multiple time zones, track availability, and generate meeting agendas.
    <span style="color:var(--accent)">Perfect for remote teams, interviews, and collaborative scheduling!</span>
  </p>

  <!-- MEETING DETAILS -->
  <div style="background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(45,212,255,0.15);padding:12px;margin-bottom:16px;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div>
        <label for="mp-name" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Meeting Name
        </label>
        <input id="mp-name" type="text" placeholder="e.g., Project Kickoff, Team Sync" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
      
      <div>
        <label for="mp-duration" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Meeting Duration
        </label>
        <select id="mp-duration" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="15">15 minutes</option>
          <option value="30" selected>30 minutes</option>
          <option value="45">45 minutes</option>
          <option value="60">60 minutes</option>
          <option value="90">90 minutes</option>
          <option value="120">120 minutes</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div>
        <label for="mp-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Meeting Date
        </label>
        <input id="mp-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
      
      <div>
        <label for="mp-timezone" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Your Timezone
        </label>
        <select id="mp-timezone" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="UTC">UTC (GMT)</option>
          <option value="EST" selected>EST (GMT-5)</option>
          <option value="PST">PST (GMT-8)</option>
          <option value="CET">CET (GMT+1)</option>
          <option value="IST">IST (GMT+5:30)</option>
          <option value="JST">JST (GMT+9)</option>
          <option value="AEST">AEST (GMT+10)</option>
        </select>
      </div>
    </div>
  </div>

  <!-- PARTICIPANT INPUT -->
  <div style="margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
      <label style="color:var(--accent);font-weight:500;">
        Add Participant Availability
      </label>
      <button type="button" onclick="mpAddParticipant()" style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);padding:4px 8px;border-radius:6px;cursor:pointer;font-size:12px;">
        + Add Row
      </button>
    </div>
    
    <div id="mp-participants-container" style="background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(255,255,255,0.05);padding:8px;max-height:300px;overflow-y:auto;">
      <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:8px;margin-bottom:8px;padding:0 8px;">
        <div style="color:rgba(230,250,255,0.8);font-size:13px;font-weight:500;">Participant</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;font-weight:500;">From</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;font-weight:500;">To</div>
        <div style="color:rgba(230,250,255,0.8);font-size:13px;font-weight:500;">Timezone</div>
        <div style="width:24px;"></div>
      </div>
      
      <!-- Participant rows will be added here -->
      <div class="mp-participant-row">
        <input type="text" placeholder="e.g., Alice Smith" class="mp-participant-name" 
               style="grid-column:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
        <input type="time" value="09:00" class="mp-participant-start" 
               style="grid-column:2;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
        <input type="time" value="17:00" class="mp-participant-end" 
               style="grid-column:3;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
        <select class="mp-participant-timezone" 
                style="grid-column:4;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;">
          <option value="EST" selected>EST</option>
          <option value="PST">PST</option>
          <option value="CET">CET</option>
          <option value="UTC">UTC</option>
        </select>
        <button type="button" onclick="mpRemoveParticipant(this)" class="mp-remove-btn"
                style="grid-column:5;background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:8px;font-size:18px;line-height:1;">√ó</button>
      </div>
    </div>
    
    <div style="font-size:13px;color:rgba(230,250,255,0.6);margin-top:6px;">
      Add participants and their available time slots. Times should be in their local timezone.
    </div>
  </div>

  <!-- QUICK PRESETS -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Presets:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="mpPreset('workday')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Standard Workday</button>
      <button type="button" onclick="mpPreset('global')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Global Team</button>
      <button type="button" onclick="mpPreset('interview')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Interview Schedule</button>
      <button type="button" onclick="mpPreset('clear')" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;cursor:pointer;font-size:12px;">Clear All</button>
    </div>
  </div>

  <!-- ADVANCED OPTIONS -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Advanced Options:</div>
    <div style="display:flex;flex-wrap:wrap;gap:16px;align-items:center;">
      <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
        <input type="checkbox" id="mp-buffer-time" checked style="cursor:pointer;">
        <span style="color:rgba(230,250,255,0.9);font-size:14px;">Add 15min buffer between meetings</span>
      </label>
      <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
        <input type="checkbox" id="mp-avoid-lunch" checked style="cursor:pointer;">
        <span style="color:rgba(230,250,255,0.9);font-size:14px;">Avoid lunch hours (12:00-13:00)</span>
      </label>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="mpFindTimes()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      üîç Find Available Times
    </button>
    <button type="button" onclick="mpGenerateAgenda()"
            style="padding:12px 16px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;">
      üìã Generate Agenda
    </button>
    <button type="button" onclick="mpReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="mpCopyResults()"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      Copy
    </button>
  </div>
</form>

<!-- RESULTS AREA -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">üìÖ Meeting Availability Analysis</h3>
    <div id="mp-status" style="color:rgba(230,250,255,0.7);font-size:13px;"></div>
  </div>

  <!-- OPTIMAL TIMES -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);padding:16px;margin-bottom:12px;">
    <div style="color:rgba(230,250,255,0.8);font-size:14px;margin-bottom:6px;">üéØ Optimal Meeting Times:</div>
    <div id="mp-optimal-times" style="font-family:monospace;font-size:15px;color:#39ff14;padding:8px;background:rgba(0,0,0,0.3);border-radius:4px;min-height:36px;display:flex;align-items:center;">
      Click "Find Available Times" to see optimal slots
    </div>
  </div>

  <!-- TIME SLOT GRID -->
  <div style="margin-bottom:12px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">‚è∞ Available Time Slots (9AM-5PM):</div>
    <div id="mp-time-grid" style="display:grid;grid-template-columns:repeat(8, 1fr);gap:4px;font-size:12px;">
      <!-- Time slots will be generated here -->
    </div>
  </div>

  <!-- PARTICIPANT OVERVIEW -->
  <div style="margin-bottom:12px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">üë• Participant Overview:</div>
    <div id="mp-participant-overview" style="background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(255,255,255,0.05);padding:12px;max-height:200px;overflow-y:auto;">
      <div style="color:rgba(230,250,255,0.6);font-size:13px;text-align:center;padding:20px;">
        Add participants to see their availability
      </div>
    </div>
  </div>

  <!-- MEETING AGENDA -->
  <div id="mp-agenda-container" style="display:none;margin-top:12px;padding:12px;background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(255,165,0,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="color:#ffa500;font-weight:500;font-size:14px;">üìã Generated Meeting Agenda:</div>
      <button type="button" onclick="mpHideAgenda()" style="background:transparent;border:none;color:rgba(255,165,0,0.7);cursor:pointer;font-size:20px;">√ó</button>
    </div>
    <div id="mp-agenda-content" style="font-size:13px;color:rgba(230,250,255,0.9);line-height:1.5;">
      <!-- Agenda will appear here -->
    </div>
    <button type="button" onclick="mpCopyAgenda()" style="margin-top:8px;padding:6px 12px;background:rgba(255,165,0,0.2);border:1px solid rgba(255,165,0,0.4);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">
      Copy Agenda
    </button>
  </div>

  <!-- TIMEZONE CONVERSION -->
  <div id="mp-timezone-container" style="display:none;margin-top:12px;padding:12px;background:rgba(0,0,0,0.15);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">üåê Timezone Conversion:</div>
    <div id="mp-timezone-content" style="font-family:monospace;font-size:13px;color:rgba(230,250,255,0.9);line-height:1.5;"></div>
  </div>

  <!-- STATISTICS -->
  <div style="margin-top:12px;display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;font-size:13px;">
    <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
      <div style="color:rgba(230,250,255,0.6);">Participants</div>
      <div id="mp-stats-participants" style="color:var(--accent);font-weight:600;font-size:16px;">0</div>
    </div>
    <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
      <div style="color:rgba(230,250,255,0.6);">Available Slots</div>
      <div id="mp-stats-slots" style="color:#39ff14;font-weight:600;font-size:16px;">0</div>
    </div>
    <div style="text-align:center;padding:8px;background:rgba(0,0,0,0.15);border-radius:6px;">
      <div style="color:rgba(230,250,255,0.6);">Best Slot</div>
      <div id="mp-stats-best" style="color:#ffa500;font-weight:600;font-size:16px;">-</div>
    </div>
  </div>

  <!-- HINT AND STATUS -->
  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div id="mp-hint" class="small" style="color:#39ff14;font-size:13px;flex:1;"></div>
    <div id="mp-summary" style="color:rgba(230,250,255,0.7);font-size:13px;"></div>
  </div>
</div>

<script>
/* meeting-planner.html
   - Advanced meeting scheduling with timezone support
   - Scoped with mp- prefix (meeting planner)
   - Finds optimal meeting times across participants
*/

// TIMEZONE OFFSETS (hours from UTC)
const mpTimezoneOffsets = {
  'UTC': 0,
  'EST': -5,
  'PST': -8,
  'CET': 1,
  'IST': 5.5,
  'JST': 9,
  'AEST': 10
};

// Initialize participants
function mpInitializeParticipants() {
  const container = document.getElementById('mp-participants-container');
  const rows = container.querySelectorAll('.mp-participant-row');
  
  // Add event listeners to existing rows
  rows.forEach(row => {
    const nameInput = row.querySelector('.mp-participant-name');
    const startInput = row.querySelector('.mp-participant-start');
    const endInput = row.querySelector('.mp-participant-end');
    
    nameInput.addEventListener('input', mpUpdateCalculations);
    startInput.addEventListener('input', mpUpdateCalculations);
    endInput.addEventListener('input', mpUpdateCalculations);
  });
  
  // Set default date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('mp-date').value = today;
  
  // Load example data on first run
  if (!localStorage.getItem('mp-initialized')) {
    setTimeout(mpPreset, 500, 'workday');
    localStorage.setItem('mp-initialized', 'true');
  }
}

// Add new participant row
function mpAddParticipant() {
  const container = document.getElementById('mp-participants-container');
  const row = document.createElement('div');
  row.className = 'mp-participant-row';
  row.style.cssText = `
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr auto;
    gap: 8px;
    margin-bottom: 8px;
  `;
  
  row.innerHTML = `
    <input type="text" placeholder="e.g., Alice Smith" class="mp-participant-name" 
           style="grid-column:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
    <input type="time" value="09:00" class="mp-participant-start" 
           style="grid-column:2;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
    <input type="time" value="17:00" class="mp-participant-end" 
           style="grid-column:3;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;" />
    <select class="mp-participant-timezone" 
            style="grid-column:4;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;">
      <option value="EST" selected>EST</option>
      <option value="PST">PST</option>
      <option value="CET">CET</option>
      <option value="UTC">UTC</option>
      <option value="IST">IST</option>
      <option value="JST">JST</option>
      <option value="AEST">AEST</option>
    </select>
    <button type="button" onclick="mpRemoveParticipant(this)" class="mp-remove-btn"
            style="grid-column:5;background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:8px;font-size:18px;line-height:1;">√ó</button>
  `;
  
  container.appendChild(row);
  
  // Add event listeners
  const nameInput = row.querySelector('.mp-participant-name');
  const startInput = row.querySelector('.mp-participant-start');
  const endInput = row.querySelector('.mp-participant-end');
  
  nameInput.addEventListener('input', mpUpdateCalculations);
  startInput.addEventListener('input', mpUpdateCalculations);
  endInput.addEventListener('input', mpUpdateCalculations);
  
  // Update hint
  mpShowHint('Participant added. Set availability and click "Find Available Times"', 'var(--accent)');
}

// Remove participant
function mpRemoveParticipant(btn) {
  const row = btn.closest('.mp-participant-row');
  if (row) {
    row.remove();
    mpUpdateCalculations();
    mpShowHint('Participant removed', '#ff4d4d');
    setTimeout(() => {
      if (document.getElementById('mp-hint').textContent === 'Participant removed') {
        document.getElementById('mp-hint').textContent = '';
      }
    }, 2000);
  }
}

// Get all participants
function mpGetParticipants() {
  const rows = document.querySelectorAll('.mp-participant-row');
  const participants = [];
  
  rows.forEach(row => {
    const name = row.querySelector('.mp-participant-name').value.trim();
    const start = row.querySelector('.mp-participant-start').value;
    const end = row.querySelector('.mp-participant-end').value;
    const timezone = row.querySelector('.mp-participant-timezone').value;
    
    if (name && start && end) {
      participants.push({
        name: name,
        start: start,
        end: end,
        timezone: timezone,
        offset: mpTimezoneOffsets[timezone] || 0
      });
    }
  });
  
  return participants;
}

// Convert time to UTC for comparison
function mpTimeToUTC(timeStr, offset) {
  const [hours, minutes] = timeStr.split(':').map(Number);
  let utcHours = hours - offset;
  
  // Handle overflow/underflow
  if (utcHours >= 24) utcHours -= 24;
  if (utcHours < 0) utcHours += 24;
  
  return utcHours * 60 + minutes; // Return as minutes
}

// Convert UTC to local time
function mpUTCToLocal(utcMinutes, offset) {
  let localHours = Math.floor((utcMinutes + offset * 60) / 60) % 24;
  if (localHours < 0) localHours += 24;
  const localMinutes = (utcMinutes + offset * 60) % 60;
  
  return `${localHours.toString().padStart(2, '0')}:${localMinutes.toString().padStart(2, '0')}`;
}

// Find available meeting times
function mpFindTimes() {
  const participants = mpGetParticipants();
  const duration = parseInt(document.getElementById('mp-duration').value) || 30;
  const meetingName = document.getElementById('mp-name').value.trim() || 'Meeting';
  const meetingDate = document.getElementById('mp-date').value;
  const baseTimezone = document.getElementById('mp-timezone').value;
  const baseOffset = mpTimezoneOffsets[baseTimezone] || 0;
  const addBuffer = document.getElementById('mp-buffer-time').checked;
  const avoidLunch = document.getElementById('mp-avoid-lunch').checked;
  
  if (participants.length === 0) {
    mpShowError('Please add at least one participant');
    return;
  }
  
  // Convert all times to UTC minutes for comparison
  const utcParticipants = participants.map(p => ({
    ...p,
    startUTC: mpTimeToUTC(p.start, p.offset),
    endUTC: mpTimeToUTC(p.end, p.offset)
  }));
  
  // Find common availability
  const timeSlots = [];
  const durationMinutes = duration;
  const bufferMinutes = addBuffer ? 15 : 0;
  
  // Check every 15-minute interval
  for (let start = 0; start < 24 * 60; start += 15) {
    const end = start + durationMinutes;
    
    // Check if all participants are available
    const allAvailable = utcParticipants.every(p => {
      // Check if slot fits within participant's availability
      const fits = start >= p.startUTC && end <= p.endUTC;
      
      // Avoid lunch hours if enabled
      const lunchStart = mpTimeToUTC('12:00', p.offset);
      const lunchEnd = mpTimeToUTC('13:00', p.offset);
      const avoidsLunch = !avoidLunch || (end <= lunchStart || start >= lunchEnd);
      
      return fits && avoidsLunch;
    });
    
    if (allAvailable) {
      timeSlots.push({
        start: start,
        end: end,
        localTime: mpUTCToLocal(start, baseOffset),
        participants: participants.length
      });
    }
  }
  
  // Update display
  mpUpdateOptimalTimes(timeSlots, duration, baseTimezone);
  mpUpdateTimeGrid(timeSlots, baseOffset);
  mpUpdateParticipantOverview(participants);
  mpUpdateStatistics(timeSlots.length);
  
  // Show timezone conversion for first slot
  if (timeSlots.length > 0) {
    mpShowTimezoneConversion(timeSlots[0].start, participants, baseTimezone);
  }
  
  // Update status
  document.getElementById('mp-status').textContent = '‚úì Found ' + timeSlots.length + ' available slots';
  document.getElementById('mp-status').style.color = '#39ff14';
  document.getElementById('mp-hint').textContent = 'Available times calculated for ' + participants.length + ' participants';
  document.getElementById('mp-hint').style.color = '#39ff14';
  document.getElementById('mp-summary').textContent = meetingDate ? `Date: ${meetingDate}` : '';
}

// Update optimal times display
function mpUpdateOptimalTimes(timeSlots, duration, baseTimezone) {
  const container = document.getElementById('mp-optimal-times');
  
  if (timeSlots.length === 0) {
    container.innerHTML = '<span style="color:#ff4d4d;">‚ùå No common available times found</span>';
    document.getElementById('mp-stats-best').textContent = '-';
    return;
  }
  
  // Find best slots (morning and afternoon)
  const morningSlots = timeSlots.filter(s => s.start < 12 * 60);
  const afternoonSlots = timeSlots.filter(s => s.start >= 12 * 60);
  
  let html = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">';
  
  if (morningSlots.length > 0) {
    html += `
      <div>
        <div style="color:rgba(230,250,255,0.7);font-size:12px;margin-bottom:4px;">üåÖ Morning</div>
        <div style="color:#39ff14;font-weight:600;">${morningSlots[0].localTime} (${baseTimezone})</div>
      </div>
    `;
  }
  
  if (afternoonSlots.length > 0) {
    html += `
      <div>
        <div style="color:rgba(230,250,255,0.7);font-size:12px;margin-bottom:4px;">üåá Afternoon</div>
        <div style="color:#39ff14;font-weight:600;">${afternoonSlots[0].localTime} (${baseTimezone})</div>
      </div>
    `;
  }
  
  html += '</div>';
  
  if (timeSlots.length > 2) {
    html += `<div style="margin-top:8px;color:rgba(230,250,255,0.6);font-size:12px;">+ ${timeSlots.length - 2} more slots available</div>`;
  }
  
  container.innerHTML = html;
  
  // Update best slot stat
  document.getElementById('mp-stats-best').textContent = timeSlots[0].localTime;
}

// Update time grid visualization
function mpUpdateTimeGrid(timeSlots, baseOffset) {
  const container = document.getElementById('mp-time-grid');
  const hours = ['9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM'];
  
  let html = '';
  
  // Create header
  hours.forEach(hour => {
    html += `<div style="text-align:center;color:rgba(230,250,255,0.6);padding:4px;">${hour}</div>`;
  });
  
  // Create availability indicators
  hours.forEach((hour, index) => {
    const hourStart = (9 + index) * 60; // Convert to minutes from midnight
    const hourEnd = hourStart + 60;
    
    // Check if any slot overlaps this hour
    const hasSlot = timeSlots.some(slot => 
      (slot.start >= hourStart && slot.start < hourEnd) ||
      (slot.end > hourStart && slot.end <= hourEnd) ||
      (slot.start <= hourStart && slot.end >= hourEnd)
    );
    
    const color = hasSlot ? '#39ff14' : '#ff4d4d';
    const label = hasSlot ? '‚úì Available' : '‚úó Busy';
    
    html += `
      <div style="background:${color}20;border:1px solid ${color}40;border-radius:4px;padding:8px;text-align:center;color:${color};">
        ${label}
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// Update participant overview
function mpUpdateParticipantOverview(participants) {
  const container = document.getElementById('mp-participant-overview');
  
  let html = '<div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:8px;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.05);">';
  html += '<div style="color:rgba(230,250,255,0.8);font-weight:500;">Participant</div>';
  html += '<div style="color:rgba(230,250,255,0.8);font-weight:500;">Available From</div>';
  html += '<div style="color:rgba(230,250,255,0.8);font-weight:500;">Available To</div>';
  html += '<div style="color:rgba(230,250,255,0.8);font-weight:500;">Timezone</div>';
  html += '</div>';
  
  participants.forEach(p => {
    html += `
      <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:8px;margin-bottom:6px;padding:4px;background:rgba(255,255,255,0.03);border-radius:4px;">
        <div style="color:rgba(230,250,255,0.9);">${p.name}</div>
        <div style="color:var(--accent);">${p.start}</div>
        <div style="color:var(--accent);">${p.end}</div>
        <div style="color:${mpGetTimezoneColor(p.timezone)};">${p.timezone}</div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// Get timezone color
function mpGetTimezoneColor(timezone) {
  const colors = {
    'EST': '#ffa500',
    'PST': '#ff4d4d',
    'CET': '#2dd4ff',
    'UTC': '#39ff14',
    'IST': '#9d4edd',
    'JST': '#ffcc00',
    'AEST': '#00ff99'
  };
  return colors[timezone] || 'rgba(230,250,255,0.7)';
}

// Show timezone conversion
function mpShowTimezoneConversion(utcStart, participants, baseTimezone) {
  const container = document.getElementById('mp-timezone-container');
  const content = document.getElementById('mp-timezone-content');
  const baseOffset = mpTimezoneOffsets[baseTimezone] || 0;
  
  let html = `<div style="margin-bottom:6px;">Selected time in different timezones:</div>`;
  html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">`;
  
  // Show for each unique timezone
  const uniqueTimezones = [...new Set(participants.map(p => p.timezone))];
  uniqueTimezones.forEach(tz => {
    const offset = mpTimezoneOffsets[tz] || 0;
    const localTime = mpUTCToLocal(utcStart, offset);
    html += `
      <div style="padding:4px;background:rgba(255,255,255,0.03);border-radius:4px;">
        <span style="color:${mpGetTimezoneColor(tz)};">${tz}</span>: ${localTime}
      </div>
    `;
  });
  
  html += `</div>`;
  content.innerHTML = html;
  container.style.display = 'block';
}

// Update statistics
function mpUpdateStatistics(availableSlots) {
  const participants = mpGetParticipants();
  document.getElementById('mp-stats-participants').textContent = participants.length;
  document.getElementById('mp-stats-slots').textContent = availableSlots;
}

// Generate meeting agenda
function mpGenerateAgenda() {
  const meetingName = document.getElementById('mp-name').value.trim() || 'Team Meeting';
  const duration = parseInt(document.getElementById('mp-duration').value) || 30;
  const meetingDate = document.getElementById('mp-date').value;
  const participants = mpGetParticipants();
  
  if (participants.length === 0) {
    mpShowError('Please add participants first');
    return;
  }
  
  const container = document.getElementById('mp-agenda-container');
  const content = document.getElementById('mp-agenda-content');
  
  // Format date
  const dateObj = meetingDate ? new Date(meetingDate) : new Date();
  const formattedDate = dateObj.toLocaleDateString('en-US', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  let html = `
    <div style="margin-bottom:12px;">
      <strong>Meeting:</strong> ${meetingName}<br>
      <strong>Date:</strong> ${formattedDate}<br>
      <strong>Duration:</strong> ${duration} minutes<br>
      <strong>Participants:</strong> ${participants.map(p => p.name).join(', ')}
    </div>
    
    <div style="margin-bottom:8px;color:#ffa500;font-weight:500;">Agenda:</div>
    <div style="margin-left:12px;">
  `;
  
  // Create agenda items based on duration
  if (duration >= 60) {
    html += `
      <div style="margin-bottom:4px;">‚Ä¢ Welcome & introductions (5min)</div>
      <div style="margin-bottom:4px;">‚Ä¢ Review of previous action items (10min)</div>
      <div style="margin-bottom:4px;">‚Ä¢ Main discussion topics (${duration - 30}min)</div>
      <div style="margin-bottom:4px;">‚Ä¢ Action items & next steps (10min)</div>
      <div>‚Ä¢ Wrap up (5min)</div>
    `;
  } else if (duration >= 30) {
    html += `
      <div style="margin-bottom:4px;">‚Ä¢ Quick check-in (5min)</div>
      <div style="margin-bottom:4px;">‚Ä¢ Main topic discussion (${duration - 10}min)</div>
      <div>‚Ä¢ Action items (5min)</div>
    `;
  } else {
    html += `
      <div style="margin-bottom:4px;">‚Ä¢ Brief update (10min)</div>
      <div>‚Ä¢ Decision/discussion (${duration - 10}min)</div>
    `;
  }
  
  html += `
    </div>
    <div style="margin-top:12px;font-size:12px;color:rgba(230,250,255,0.6);">
      Tip: Share this agenda with participants before the meeting.
    </div>
  `;
  
  content.innerHTML = html;
  container.style.display = 'block';
  
  mpShowHint('Meeting agenda generated', '#ffa500');
}

// Hide agenda
function mpHideAgenda() {
  document.getElementById('mp-agenda-container').style.display = 'none';
}

// Copy agenda
function mpCopyAgenda() {
  const content = document.getElementById('mp-agenda-content').textContent;
  
  navigator.clipboard.writeText(content).then(() => {
    mpShowSuccess('Agenda copied to clipboard!');
  }).catch(() => {
    // Fallback
    const textArea = document.createElement('textarea');
    textArea.value = content;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      mpShowSuccess('Copied!');
    } catch (err) {
      alert('Copy failed. Please select and copy manually.');
    }
    document.body.removeChild(textArea);
  });
}

// Copy results
function mpCopyResults() {
  const participants = mpGetParticipants();
  const optimalTimes = document.getElementById('mp-optimal-times').textContent;
  
  if (participants.length === 0) {
    mpShowError('Nothing to copy');
    return;
  }
  
  let text = 'Meeting Availability Results\n\n';
  text += 'Participants:\n';
  
  participants.forEach(p => {
    text += `- ${p.name}: ${p.start}-${p.end} (${p.timezone})\n`;
  });
  
  text += `\nOptimal Times:\n${optimalTimes}\n`;
  
  navigator.clipboard.writeText(text).then(() => {
    mpShowSuccess('Results copied to clipboard!');
  }).catch(() => {
    // Fallback
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      mpShowSuccess('Copied!');
    } catch (err) {
      alert('Copy failed. Please select and copy manually.');
    }
    document.body.removeChild(textArea);
  });
}

// Quick presets
function mpPreset(preset) {
  if (preset === 'clear') {
    mpReset();
    return;
  }
  
  // Clear existing participants
  const container = document.getElementById('mp-participants-container');
  const rows = container.querySelectorAll('.mp-participant-row');
  rows.forEach(row => row.remove());
  
  const presets = {
    'workday': [
      { name: 'Alice Smith', start: '09:00', end: '17:00', tz: 'EST' },
      { name: 'Bob Johnson', start: '08:00', end: '16:00', tz: 'PST' },
      { name: 'Carol Davis', start: '10:00', end: '18:00', tz: 'CET' }
    ],
    'global': [
      { name: 'Tokyo Team', start: '09:00', end: '17:00', tz: 'JST' },
      { name: 'London Team', start: '09:00', end: '17:00', tz: 'UTC' },
      { name: 'New York Team', start: '09:00', end: '17:00', tz: 'EST' },
      { name: 'Sydney Team', start: '09:00', end: '17:00', tz: 'AEST' }
    ],
    'interview': [
      { name: 'Interviewer 1', start: '10:00', end: '16:00', tz: 'EST' },
      { name: 'Interviewer 2', start: '09:00', end: '15:00', tz: 'PST' },
      { name: 'Candidate', start: '08:00', end: '18:00', tz: 'CET' }
    ]
  };
  
  const selectedPreset = presets[preset] || presets.workday;
  
  // Add preset participants
  selectedPreset.forEach(p => {
    mpAddParticipant();
    const rows = container.querySelectorAll('.mp-participant-row');
    const lastRow = rows[rows.length - 1];
    
    lastRow.querySelector('.mp-participant-name').value = p.name;
    lastRow.querySelector('.mp-participant-start').value = p.start;
    lastRow.querySelector('.mp-participant-end').value = p.end;
    lastRow.querySelector('.mp-participant-timezone').value = p.tz;
  });
  
  // Set meeting name
  const meetingNames = {
    'workday': 'Team Weekly Sync',
    'global': 'Global Team Meeting',
    'interview': 'Technical Interview'
  };
  document.getElementById('mp-name').value = meetingNames[preset] || 'Team Meeting';
  
  // Auto-find times
  setTimeout(mpFindTimes, 300);
  
  mpShowHint(`Loaded ${preset} preset`, 'var(--accent)');
}

// Update calculations in real-time
function mpUpdateCalculations() {
  const participants = mpGetParticipants();
  
  if (participants.length > 0) {
    document.getElementById('mp-status').textContent = 'Ready';
    document.getElementById('mp-status').style.color = 'var(--accent)';
  }
}

function mpShowError(message) {
  document.getElementById('mp-status').textContent = '‚úó Error';
  document.getElementById('mp-status').style.color = '#ff4d4d';
  document.getElementById('mp-hint').textContent = message;
  document.getElementById('mp-hint').style.color = '#ff4d4d';
}

function mpShowSuccess(message) {
  document.getElementById('mp-hint').textContent = message;
  document.getElementById('mp-hint').style.color = '#39ff14';
  setTimeout(() => {
    if (document.getElementById('mp-hint').textContent === message) {
      document.getElementById('mp-hint').textContent = '';
    }
  }, 2000);
}

function mpShowHint(message, color = 'var(--accent)') {
  document.getElementById('mp-hint').textContent = message;
  document.getElementById('mp-hint').style.color = color;
}

function mpReset() {
  // Clear participants
  const container = document.getElementById('mp-participants-container');
  const rows = container.querySelectorAll('.mp-participant-row');
  rows.forEach(row => row.remove());
  
  // Add one empty row
  mpAddParticipant();
  
  // Reset other inputs
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('mp-date').value = today;
  document.getElementById('mp-name').value = '';
  document.getElementById('mp-buffer-time').checked = true;
  document.getElementById('mp-avoid-lunch').checked = true;
  
  // Reset displays
  document.getElementById('mp-optimal-times').textContent = 'Click "Find Available Times" to see optimal slots';
  document.getElementById('mp-time-grid').innerHTML = '';
  document.getElementById('mp-participant-overview').innerHTML = `
    <div style="color:rgba(230,250,255,0.6);font-size:13px;text-align:center;padding:20px;">
      Add participants to see their availability
    </div>
  `;
  document.getElementById('mp-agenda-container').style.display = 'none';
  document.getElementById('mp-timezone-container').style.display = 'none';
  document.getElementById('mp-status').textContent = '';
  document.getElementById('mp-hint').textContent = '';
  document.getElementById('mp-summary').textContent = '';
  document.getElementById('mp-stats-participants').textContent = '0';
  document.getElementById('mp-stats-slots').textContent = '0';
  document.getElementById('mp-stats-best').textContent = '-';
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    mpInitializeParticipants();
    console.log('Meeting Planner initialized');
  });
}
</script>

<!-- CARD-SPECIFIC STYLES -->
<style>
#meeting-planner-title {
  color: var(--accent);
  margin-top: 0;
}

/* Participant rows styling */
.mp-participant-row {
  transition: all 0.2s ease;
}

.mp-participant-row:hover {
  background: rgba(255,255,255,0.02);
  border-radius: 4px;
}

.mp-participant-name:focus,
.mp-participant-start:focus,
.mp-participant-end:focus,
.mp-participant-timezone:focus {
  outline: none;
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px rgba(45,212,255,0.2);
}

/* Scrollbar styling */
#mp-participants-container::-webkit-scrollbar,
#mp-participant-overview::-webkit-scrollbar {
  width: 6px;
}

#mp-participants-container::-webkit-scrollbar-track,
#mp-participant-overview::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#mp-participants-container::-webkit-scrollbar-thumb,
#mp-participant-overview::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  .row {
    grid-template-columns: 1fr !important;
  }
  
  .mp-participant-row {
    grid-template-columns: 2fr 1fr auto !important;
  }
  
  .mp-participant-row > *:nth-child(4) {
    display: none; /* Hide timezone on mobile */
  }
  
  .mp-participant-row > *:nth-child(5) {
    grid-column: 3 !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin: 4px 0 !important;
  }
  
  #mp-time-grid {
    grid-template-columns: repeat(4, 1fr) !important;
  }
  
  #mp-participant-overview > div:first-child {
    grid-template-columns: 2fr 1fr !important;
  }
  
  #mp-participant-overview > div:first-child > div:nth-child(3),
  #mp-participant-overview > div:first-child > div:nth-child(4) {
    display: none;
  }
  
  .mp-participant-row > div {
    grid-template-columns: 2fr 1fr !important;
  }
  
  .mp-participant-row > div > div:nth-child(3),
  .mp-participant-row > div > div:nth-child(4) {
    display: none;
  }
}

/* Dark mode enhancements */
@media (prefers-color-scheme: dark) {
  #mp-participant-overview,
  #mp-participants-container {
    background: rgba(0, 0, 0, 0.25) !important;
  }
  
  .mp-participant-name,
  .mp-participant-start,
  .mp-participant-end,
  .mp-participant-timezone {
    background: rgba(255, 255, 255, 0.05) !important;
  }
}

/* Print styles */
@media print {
  #mp-agenda-container,
  #mp-timezone-container,
  .actions,
  #mp-hint,
  #mp-status,
  #mp-summary,
  #mp-time-grid {
    display: none !important;
  }
  
  #mp-participants-container {
    max-height: none !important;
    overflow: visible !important;
  }
  
  .mp-participant-row {
    break-inside: avoid;
  }
}

/* Time slot animation */
@keyframes slotHighlight {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

#mp-time-grid > div {
  transition: all 0.3s ease;
}

#mp-time-grid > div:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
</style>
