<h2 id="salary-calculator-title">üí∞ Salary Calculator</h2>

<form aria-describedby="salary-calculator-desc">
    <p id="salary-calculator-desc" class="small" style="margin-bottom:20px;color:var(--muted)">
        Calculate net salary after taxes, deductions, and contributions.
        <span style="color:var(--accent)">‚ö†Ô∏è Estimates only ‚Äî consult a tax professional.</span>
    </p>
    
    <!-- BASIC INFORMATION -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üë§ Personal Information</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
            <div>
                <label for="sc-country" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Country
                </label>
                <select id="sc-country" onchange="scUpdateTaxBrackets()"
                        style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="uk">United Kingdom</option>
                    <option value="us">United States</option>
                    <option value="ca">Canada</option>
                    <option value="au">Australia</option>
                    <option value="de">Germany</option>
                    <option value="fr">France</option>
                </select>
            </div>
            
            <div>
                <label for="sc-currency" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Currency
                </label>
                <select id="sc-currency" 
                        style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="¬£">¬£ GBP</option>
                    <option value="$">$ USD</option>
                    <option value="‚Ç¨">‚Ç¨ EUR</option>
                    <option value="CA$">CA$ CAD</option>
                    <option value="AU$">AU$ AUD</option>
                </select>
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="sc-pay-period" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Pay Period
                </label>
                <select id="sc-pay-period" 
                        style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                    <option value="annual">Annual</option>
                    <option value="monthly">Monthly</option>
                    <option value="biweekly">Bi-Weekly</option>
                    <option value="weekly">Weekly</option>
                    <option value="daily">Daily</option>
                    <option value="hourly">Hourly</option>
                </select>
            </div>
            
            <div>
                <label for="sc-hours" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Hours/Week
                </label>
                <input id="sc-hours" type="number" min="1" max="168" value="40" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- SALARY INPUT -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üíº Salary Details</h3>
        
        <div>
            <label for="sc-gross" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                Gross Income
            </label>
            <input id="sc-gross" type="number" min="0" step="1000" placeholder="40000" value="40000" 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
        </div>
    </div>
    
    <!-- TAX BRACKETS -->
    <div style="margin-bottom:20px;">
        <details>
            <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
                ‚öôÔ∏è Tax Settings (UK Example)
            </summary>
            <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">UK Tax Bands 2024/25</div>
                
                <div id="sc-tax-brackets" style="display:flex;flex-direction:column;gap:8px;">
                    <!-- Tax brackets will be generated here -->
                </div>
                
                <div style="margin-top:12px;font-size:12px;color:#ffcc00;">
                    üí° Personal Allowance: ¬£12,570 (0% tax up to this amount)
                </div>
            </div>
        </details>
    </div>
    
    <!-- DEDUCTIONS -->
    <div style="margin-bottom:20px;">
        <details>
            <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.1);">
                üîß Additional Deductions
            </summary>
            <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Salary Deductions</div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
                    <div>
                        <label for="sc-ni" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            National Insurance (%)
                        </label>
                        <input id="sc-ni" type="number" min="0" max="20" step="0.1" placeholder="12" value="12" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                    
                    <div>
                        <label for="sc-pension" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Pension Contribution (%)
                        </label>
                        <input id="sc-pension" type="number" min="0" max="20" step="0.5" placeholder="5" value="5" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                </div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-top:12px;">
                    <div>
                        <label for="sc-student-loan" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Student Loan (%)
                        </label>
                        <input id="sc-student-loan" type="number" min="0" max="15" step="0.1" placeholder="9" value="9" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                    
                    <div>
                        <label for="sc-other-deductions" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Other Deductions (Flat)
                        </label>
                        <input id="sc-other-deductions" type="number" min="0" step="100" placeholder="0" value="0" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                </div>
            </div>
        </details>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div style="display:flex;gap:10px;">
        <button type="button" onclick="scCalculate()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.3), rgba(45,212,255,0.2));border:1px solid rgba(45,212,255,0.6);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üìä Calculate Net Salary
        </button>
        <button type="button" onclick="scReset()"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            üîÑ Reset
        </button>
    </div>
</form>

<!-- RESULTS -->
<div id="sc-results" style="margin-top:24px;display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="color:var(--accent);margin:0;font-size:16px;">üí∞ Salary Breakdown</h3>
        <div style="display:flex;gap:8px;">
            <button type="button" onclick="scExport()" 
                    style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
                üì• Export
            </button>
            <button type="button" onclick="scSave()"
                    style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
                üíæ Save
            </button>
        </div>
    </div>
    
    <!-- QUICK SUMMARY -->
    <div style="margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:bold;color:#39ff14;" id="sc-net-annual">¬£0</div>
                <div style="font-size:11px;color:var(--muted);">Annual Net</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:bold;color:var(--accent);" id="sc-tax-paid">¬£0</div>
                <div style="font-size:11px;color:var(--muted);">Total Tax</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#ffcc00;" id="sc-monthly-net">¬£0</div>
                <div style="font-size:11px;color:var(--muted);">Monthly Net</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#9d4edd;" id="sc-tax-rate">0%</div>
                <div style="font-size:11px;color:var(--muted);">Effective Tax Rate</div>
            </div>
        </div>
    </div>
    
    <!-- BREAKDOWN CHART -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìä Income Breakdown</div>
        <div style="position:relative;height:200px;background:rgba(0,0,0,0.2);border-radius:8px;padding:12px;">
            <canvas id="sc-chart" width="400" height="200"></canvas>
        </div>
    </div>
    
    <!-- DETAILED BREAKDOWN -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìù Detailed Breakdown</div>
        <div id="sc-breakdown" style="max-height:300px;overflow-y:auto;padding:4px;">
            <!-- Breakdown will appear here -->
        </div>
    </div>
    
    <!-- PAY PERIOD COMPARISON -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìÖ Pay Period Comparison</div>
        <div id="sc-pay-periods" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:8px;">
            <!-- Pay period data will appear here -->
        </div>
    </div>
    
    <!-- EXPORT OPTIONS -->
    <div style="display:flex;gap:8px;">
        <button type="button" onclick="scCopy()" 
                style="flex:1;padding:10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:13px;">
            üìã Copy Breakdown
        </button>
        <button type="button" onclick="scPrint()"
                style="padding:10px 14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-size:13px;">
            üñ®Ô∏è Print
        </button>
    </div>
</div>

<!-- TAX DISCLAIMER -->
<div style="margin-top:20px;padding:16px;background:rgba(255,77,77,0.05);border-radius:8px;border-left:3px solid #ff4d4d;">
    <div style="color:#ff4d4d;font-weight:500;margin-bottom:8px;">‚ö†Ô∏è Important Disclaimer</div>
    <div style="font-size:13px;color:var(--muted);">
        This calculator provides estimates only. Actual tax amounts may vary based on individual circumstances, 
        tax credits, deductions, and local regulations. Always consult with a qualified tax professional or 
        accountant for accurate tax calculations. Tax rates and thresholds are subject to change.
    </div>
</div>

<script>
/* salary-calculator.html
   - Advanced salary after tax calculator
   - Scoped with sc- prefix (Salary Calculator)
*/

// Country-specific tax brackets (simplified examples)
const scTaxBrackets = {
    uk: [
        { min: 0, max: 12570, rate: 0, name: 'Personal Allowance' },
        { min: 12570, max: 50270, rate: 20, name: 'Basic Rate' },
        { min: 50270, max: 125140, rate: 40, name: 'Higher Rate' },
        { min: 125140, max: Infinity, rate: 45, name: 'Additional Rate' }
    ],
    us: [
        { min: 0, max: 11000, rate: 10, name: '10% Bracket' },
        { min: 11000, max: 44725, rate: 12, name: '12% Bracket' },
        { min: 44725, max: 95375, rate: 22, name: '22% Bracket' },
        { min: 95375, max: 182100, rate: 24, name: '24% Bracket' },
        { min: 182100, max: 231250, rate: 32, name: '32% Bracket' },
        { min: 231250, max: 578125, rate: 35, name: '35% Bracket' },
        { min: 578125, max: Infinity, rate: 37, name: '37% Bracket' }
    ],
    ca: [
        { min: 0, max: 53359, rate: 15, name: '15% Bracket' },
        { min: 53359, max: 106717, rate: 20.5, name: '20.5% Bracket' },
        { min: 106717, max: 165430, rate: 26, name: '26% Bracket' },
        { min: 165430, max: 235675, rate: 29, name: '29% Bracket' },
        { min: 235675, max: Infinity, rate: 33, name: '33% Bracket' }
    ]
};

// Pay period multipliers
const scPayPeriods = {
    annual: 1,
    monthly: 12,
    biweekly: 26,
    weekly: 52,
    daily: 260, // Assuming 5 days/week * 52 weeks
    hourly: 2080 // Assuming 40 hours/week * 52 weeks
};

let scChart = null;

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', scInit);
} else {
    scInit();
}

function scInit() {
    console.log('Salary Calculator initialized');
    
    // Load saved data if any
    const saved = localStorage.getItem('sc-data');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            
            // Load all inputs
            for (const [key, value] of Object.entries(data)) {
                const input = document.getElementById(`sc-${key}`);
                if (input) input.value = value;
            }
            
            // Update tax brackets based on saved country
            if (data.country) {
                scUpdateTaxBrackets(data.country);
            }
        } catch (e) {
            console.error('Failed to load saved data:', e);
        }
    } else {
        // Initialize with UK tax brackets
        scUpdateTaxBrackets('uk');
    }
    
    // Set up chart if available
    if (typeof Chart !== 'undefined') {
        scInitializeChart();
    }
}

// Update tax brackets based on country
function scUpdateTaxBrackets(country = null) {
    if (!country) {
        country = document.getElementById('sc-country').value;
    }
    
    const container = document.getElementById('sc-tax-brackets');
    const brackets = scTaxBrackets[country] || scTaxBrackets.uk;
    
    let html = '';
    brackets.forEach((bracket, index) => {
        const maxDisplay = bracket.max === Infinity ? 'and above' : `to ${scFormatCurrency(bracket.max, '¬£')}`;
        html += `
            <div style="display:flex;justify-content:space-between;align-items:center;padding:6px;background:rgba(0,0,0,0.1);border-radius:4px;">
                <div>
                    <div style="color:var(--accent);font-size:12px;">${bracket.name}</div>
                    <div style="color:var(--muted);font-size:11px;">${scFormatCurrency(bracket.min, '¬£')} ${maxDisplay}</div>
                </div>
                <div style="color:#ffcc00;font-weight:600;font-size:14px;">${bracket.rate}%</div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Save data
function scSaveData() {
    const data = {
        'country': document.getElementById('sc-country').value,
        'currency': document.getElementById('sc-currency').value,
        'pay-period': document.getElementById('sc-pay-period').value,
        'hours': document.getElementById('sc-hours').value,
        'gross': document.getElementById('sc-gross').value,
        'ni': document.getElementById('sc-ni').value,
        'pension': document.getElementById('sc-pension').value,
        'student-loan': document.getElementById('sc-student-loan').value,
        'other-deductions': document.getElementById('sc-other-deductions').value
    };
    
    localStorage.setItem('sc-data', JSON.stringify(data));
}

// Format currency
function scFormatCurrency(amount, currency = '¬£') {
    if (amount >= 1000000) {
        return `${currency}${(amount / 1000000).toFixed(2)}M`;
    } else if (amount >= 1000) {
        return `${currency}${(amount / 1000).toFixed(1)}K`;
    } else {
        return `${currency}${amount.toFixed(0)}`;
    }
}

// Initialize chart
function scInitializeChart() {
    const ctx = document.getElementById('sc-chart').getContext('2d');
    
    scChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Net Income', 'Income Tax', 'National Insurance', 'Pension', 'Student Loan', 'Other'],
            datasets: [{
                data: [0, 0, 0, 0, 0, 0],
                backgroundColor: [
                    'rgba(57, 255, 20, 0.7)',
                    'rgba(45, 212, 255, 0.7)',
                    'rgba(255, 204, 0, 0.7)',
                    'rgba(157, 78, 221, 0.7)',
                    'rgba(255, 77, 77, 0.7)',
                    'rgba(128, 128, 128, 0.7)'
                ],
                borderColor: [
                    'rgba(57, 255, 20, 1)',
                    'rgba(45, 212, 255, 1)',
                    'rgba(255, 204, 0, 1)',
                    'rgba(157, 78, 221, 1)',
                    'rgba(255, 77, 77, 1)',
                    'rgba(128, 128, 128, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        color: '#e6faff',
                        font: {
                            size: 10
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = Math.round((value / total) * 100);
                            return `${label}: ${scFormatCurrency(value, '¬£')} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}

// Main calculation function
function scCalculate() {
    // Get inputs
    const country = document.getElementById('sc-country').value;
    const currency = document.getElementById('sc-currency').value;
    const payPeriod = document.getElementById('sc-pay-period').value;
    const hoursPerWeek = parseInt(document.getElementById('sc-hours').value) || 40;
    const grossInput = parseFloat(document.getElementById('sc-gross').value) || 0;
    const niRate = parseFloat(document.getElementById('sc-ni').value) / 100 || 0;
    const pensionRate = parseFloat(document.getElementById('sc-pension').value) / 100 || 0;
    const studentLoanRate = parseFloat(document.getElementById('sc-student-loan').value) / 100 || 0;
    const otherDeductions = parseFloat(document.getElementById('sc-other-deductions').value) || 0;
    
    if (grossInput <= 0) {
        scShowMessage('Enter a valid gross income', 'warning');
        return;
    }
    
    // Convert gross income to annual based on pay period
    let grossAnnual;
    switch(payPeriod) {
        case 'annual':
            grossAnnual = grossInput;
            break;
        case 'monthly':
            grossAnnual = grossInput * 12;
            break;
        case 'biweekly':
            grossAnnual = grossInput * 26;
            break;
        case 'weekly':
            grossAnnual = grossInput * 52;
            break;
        case 'daily':
            grossAnnual = grossInput * 260;
            break;
        case 'hourly':
            grossAnnual = grossInput * hoursPerWeek * 52;
            break;
        default:
            grossAnnual = grossInput;
    }
    
    // Calculate progressive tax based on brackets
    const brackets = scTaxBrackets[country] || scTaxBrackets.uk;
    let totalTax = 0;
    let remainingIncome = grossAnnual;
    
    const taxBreakdown = [];
    for (const bracket of brackets) {
        if (remainingIncome <= 0) break;
        
        const taxableInBracket = Math.min(
            remainingIncome,
            bracket.max === Infinity ? remainingIncome : bracket.max - bracket.min
        );
        
        if (taxableInBracket > 0) {
            const taxInBracket = taxableInBracket * (bracket.rate / 100);
            totalTax += taxInBracket;
            
            taxBreakdown.push({
                bracket: bracket.name,
                taxable: taxableInBracket,
                tax: taxInBracket,
                rate: bracket.rate
            });
            
            remainingIncome -= taxableInBracket;
        }
    }
    
    // Calculate other deductions
    const nationalInsurance = grossAnnual * niRate;
    const pension = grossAnnual * pensionRate;
    const studentLoan = grossAnnual * studentLoanRate;
    const totalDeductions = totalTax + nationalInsurance + pension + studentLoan + otherDeductions;
    
    // Calculate net income
    const netAnnual = grossAnnual - totalDeductions;
    const effectiveTaxRate = (totalTax / grossAnnual) * 100;
    
    // Calculate pay period amounts
    const netMonthly = netAnnual / 12;
    const netWeekly = netAnnual / 52;
    const netDaily = netAnnual / 260;
    const netHourly = grossAnnual / (hoursPerWeek * 52);
    
    // Display results
    scDisplayResults(
        grossAnnual, netAnnual, totalTax, effectiveTaxRate, 
        nationalInsurance, pension, studentLoan, otherDeductions,
        netMonthly, netWeekly, netDaily, netHourly,
        currency, payPeriod, hoursPerWeek, taxBreakdown
    );
    
    // Draw chart
    scDrawChart(
        netAnnual, totalTax, nationalInsurance, pension, studentLoan, otherDeductions
    );
    
    // Save data
    scSaveData();
    
    // Show results section
    document.getElementById('sc-results').style.display = 'block';
    
    scShowMessage('Salary calculated!', 'success');
}

// Display results
function scDisplayResults(
    grossAnnual, netAnnual, totalTax, effectiveTaxRate,
    nationalInsurance, pension, studentLoan, otherDeductions,
    netMonthly, netWeekly, netDaily, netHourly,
    currency, payPeriod, hoursPerWeek, taxBreakdown
) {
    // Update quick stats
    document.getElementById('sc-net-annual').textContent = scFormatCurrency(netAnnual, currency);
    document.getElementById('sc-tax-paid').textContent = scFormatCurrency(totalTax, currency);
    document.getElementById('sc-monthly-net').textContent = scFormatCurrency(netMonthly, currency);
    document.getElementById('sc-tax-rate').textContent = effectiveTaxRate.toFixed(1) + '%';
    
    // Generate detailed breakdown
    let breakdown = `<div style="display:flex;flex-direction:column;gap:8px;">`;
    
    // Income section
    breakdown += `
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid #39ff14;">
            <div style="color:#39ff14;font-weight:500;margin-bottom:8px;">üíº Income Summary</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;">
                <div>Gross Annual:</div>
                <div style="text-align:right;color:#39ff14;font-weight:600;">${scFormatCurrency(grossAnnual, currency)}</div>
                <div>Net Annual:</div>
                <div style="text-align:right;color:#39ff14;font-weight:600;">${scFormatCurrency(netAnnual, currency)}</div>
                <div>Effective Tax Rate:</div>
                <div style="text-align:right;color:var(--accent);">${effectiveTaxRate.toFixed(1)}%</div>
            </div>
        </div>
    `;
    
    // Tax breakdown
    breakdown += `
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid var(--accent);">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üìä Tax Breakdown</div>
    `;
    
    taxBreakdown.forEach(item => {
        breakdown += `
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);">
                <div>${item.bracket} (${item.rate}%):</div>
                <div style="text-align:right;">${scFormatCurrency(item.tax, currency)}</div>
            </div>
        `;
    });
    
    breakdown += `
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;padding-top:8px;margin-top:8px;border-top:1px solid rgba(255,255,255,0.1);">
                <div style="font-weight:600;">Total Tax:</div>
                <div style="text-align:right;font-weight:600;color:var(--accent);">${scFormatCurrency(totalTax, currency)}</div>
            </div>
        </div>
    `;
    
    // Other deductions
    breakdown += `
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid #ffcc00;">
            <div style="color:#ffcc00;font-weight:500;margin-bottom:8px;">üîß Other Deductions</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;">
                <div>National Insurance:</div>
                <div style="text-align:right;">${scFormatCurrency(nationalInsurance, currency)}</div>
                <div>Pension:</div>
                <div style="text-align:right;">${scFormatCurrency(pension, currency)}</div>
                <div>Student Loan:</div>
                <div style="text-align:right;">${scFormatCurrency(studentLoan, currency)}</div>
                <div>Other Deductions:</div>
                <div style="text-align:right;">${scFormatCurrency(otherDeductions, currency)}</div>
                <div style="font-weight:600;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);">Total Deductions:</div>
                <div style="text-align:right;font-weight:600;color:#ffcc00;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);">
                    ${scFormatCurrency(totalTax + nationalInsurance + pension + studentLoan + otherDeductions, currency)}
                </div>
            </div>
        </div>
    `;
    
    breakdown += `</div>`;
    
    document.getElementById('sc-breakdown').innerHTML = breakdown;
    
    // Update pay period comparison
    scUpdatePayPeriods(netAnnual, netMonthly, netWeekly, netDaily, netHourly, currency);
}

// Update pay period comparison
function scUpdatePayPeriods(netAnnual, netMonthly, netWeekly, netDaily, netHourly, currency) {
    const container = document.getElementById('sc-pay-periods');
    
    const periods = [
        { label: 'Annual', value: netAnnual, icon: 'üìÖ' },
        { label: 'Monthly', value: netMonthly, icon: 'üìÜ' },
        { label: 'Weekly', value: netWeekly, icon: 'üóìÔ∏è' },
        { label: 'Daily', value: netDaily, icon: 'üìÖ' },
        { label: 'Hourly', value: netHourly, icon: '‚è∞' }
    ];
    
    let html = '';
    periods.forEach(period => {
        html += `
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;margin-bottom:4px;">${period.icon}</div>
                <div style="color:var(--accent);font-weight:500;margin-bottom:4px;">${period.label}</div>
                <div style="font-size:18px;font-weight:bold;color:#39ff14;">${scFormatCurrency(period.value, currency)}</div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Draw chart
function scDrawChart(netAnnual, totalTax, nationalInsurance, pension, studentLoan, otherDeductions) {
    if (!scChart && typeof Chart !== 'undefined') {
        scInitializeChart();
    }
    
    if (scChart) {
        scChart.data.datasets[0].data = [
            netAnnual,
            totalTax,
            nationalInsurance,
            pension,
            studentLoan,
            otherDeductions
        ];
        scChart.update();
    } else {
        // Fallback to manual chart if Chart.js not available
        const canvas = document.getElementById('sc-chart');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Simple text display
        ctx.fillStyle = '#ffffff';
        ctx.font = '16px
