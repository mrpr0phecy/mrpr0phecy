<h2 id="lab-safety-title" style="margin-top:0;">Lab Safety Tools & Facts</h2>

<form aria-describedby="lab-safety-desc">
  <p id="lab-safety-desc" class="small">Review lab safety rules and generate reminders for safe scientific work.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
    <div class="field">
      <label for="labs-tool">Safety Tool</label>
      <select id="labs-tool" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
        <option value="rules" selected>ğŸ§ª General Safety Rules</option>
        <option value="ppe">ğŸ›¡ï¸ Personal Protective Equipment</option>
        <option value="emergency">ğŸš¨ Emergency Procedures</option>
        <option value="chemicals">ğŸ§ª Chemical Handling</option>
        <option value="biohazards">ğŸ¦  Biological Safety</option>
        <option value="electrical">âš¡ Electrical Safety</option>
        <option value="radiation">â˜¢ï¸ Radiation Safety</option>
        <option value="waste">ğŸ—‘ï¸ Waste Disposal</option>
      </select>
      <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">Select a safety category</div>
    </div>

    <div class="field">
      <label for="labs-show-facts">Show Safety Facts</label>
      <select id="labs-show-facts" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
        <option value="yes" selected>Yes - Show 5 facts</option>
        <option value="no">No - Hide facts</option>
        <option value="random">Random - 3 random facts</option>
      </select>
      <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">Include safety facts</div>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
    <button type="button" onclick="labsGenerate(this)" style="flex:1;padding:12px 20px;background:linear-gradient(135deg, #d32f2f, #b71c1c);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-shield-alt" style="margin-right:8px;"></i>Generate Safety Guide
    </button>
    <button type="button" class="secondary" onclick="labsReset(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-redo" style="margin-right:8px;"></i>Reset
    </button>
    <button type="button" onclick="labsCopy(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="far fa-copy" style="margin-right:8px;"></i>Copy Output
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:25px;padding:20px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
    <h3 class="small" style="margin:0;font-size:16px;font-weight:600;color:#ffcdd2;">
      <i class="fas fa-exclamation-triangle" style="margin-right:8px;"></i>Lab Safety Reminders & Facts
    </h3>
    <div id="labs-status" style="font-size:12px;padding:4px 10px;border-radius:12px;background:rgba(211, 47, 47, 0.2);color:#ef9a9a;"></div>
  </div>
  
  <textarea id="labs-output" rows="10" style="width:100%;padding:15px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.2);color:#e0f2fe;font-family:'Courier New',monospace;font-size:13px;line-height:1.5;resize:vertical;"></textarea>

  <div id="labs-facts-container" style="margin-top:20px;padding:15px;border-radius:8px;background:rgba(211, 47, 47, 0.05);border:1px solid rgba(211, 47, 47, 0.2);display:none;">
    <h4 style="margin:0 0 10px 0;font-size:14px;color:#ffcdd2;display:flex;align-items:center;">
      <i class="fas fa-lightbulb" style="margin-right:8px;"></i>Safety Facts
    </h4>
    <ul id="labs-facts-list" style="list-style:none;padding:0;margin:0;font-size:0.95rem;line-height:1.6;color:#ffccbc;">
      <!-- Facts will be populated by JavaScript -->
    </ul>
  </div>

  <div style="margin-top:15px;display:flex;justify-content:space-between;align-items:center;">
    <div id="labs-hint" class="small" style="opacity:0.9;font-size:13px;color:#ffab91;"></div>
    <div id="labs-count" style="font-size:12px;color:#ff8a65;display:none;">
      <span id="rules-count">0</span> rules â€¢ 
      <span id="facts-count">0</span> facts
    </div>
  </div>
</div>

<script>
/* lab-safety.html
   - Generates lab safety reminders and shows facts
   - Scoped with labs- prefix
*/

// Safety facts database
const labsSafetyFacts = [
  "Always wear safety goggles when handling chemicals or glassware.",
  "Never pipette by mouth â€” use mechanical pipettors.",
  "Know the location of fire extinguishers, safety showers, and eyewash stations.",
  "Dispose of sharps (needles, broken glass) in designated puncture-proof containers.",
  "Label all samples, reagents, and solutions clearly with name, date, and concentration.",
  "Wash hands thoroughly with soap and water after completing lab work.",
  "Report all spills, accidents, and injuries immediately to your supervisor.",
  "Never eat, drink, or apply cosmetics in the laboratory.",
  "Keep workspaces uncluttered to prevent accidents and contamination.",
  "Follow all institutional safety protocols and Standard Operating Procedures (SOPs).",
  "Use fume hoods when working with volatile or toxic chemicals.",
  "Wear appropriate gloves for the materials you're handling (nitrile, latex, neoprene).",
  "Tie back long hair and avoid loose clothing or jewelry that could catch on equipment.",
  "Never work alone in the laboratory after hours.",
  "Store chemicals according to compatibility groups (flammables, acids, bases, oxidizers).",
  "Use secondary containment for liquid chemicals to prevent spill spread.",
  "Check equipment for damage before use and never use damaged equipment.",
  "Know the meaning of all hazard symbols (flammable, toxic, corrosive, etc.).",
  "Keep emergency numbers posted near all laboratory telephones.",
  "Decontaminate work surfaces before and after each experiment.",
  "Use insulated gloves when handling hot glassware or equipment.",
  "Never smell chemicals directly â€” waft vapors toward your nose.",
  "Keep flammable materials away from heat sources and open flames.",
  "Use proper lifting techniques when moving heavy equipment or containers.",
  "Secure compressed gas cylinders with chains or straps.",
  "Use face shields in addition to goggles for procedures with splash risk.",
  "Dispose of chemical waste in designated, properly labeled containers.",
  "Check that safety equipment (eyewash, shower) is accessible and functional weekly.",
  "Use spill kits appropriate for the chemicals in your lab.",
  "Complete all required safety training before beginning work."
];

// Detailed safety rules for each category
const labsSafetyRules = {
  "rules": {
    title: "ğŸ§ª GENERAL LABORATORY SAFETY RULES",
    rules: [
      "1. Always wear appropriate personal protective equipment (PPE) for the task",
      "2. Never eat, drink, chew gum, or apply cosmetics in the laboratory",
      "3. Keep work areas clean and organized at all times",
      "4. Report all accidents, injuries, and near misses immediately",
      "5. Follow written procedures and protocols exactly as specified",
      "6. Never work alone in the laboratory, especially with hazardous materials",
      "7. Know the location and proper use of all emergency equipment",
      "8. Wash hands thoroughly before leaving the laboratory",
      "9. Secure long hair and remove loose jewelry before working",
      "10. Never use damaged equipment or glassware"
    ],
    icon: "ğŸ§ª"
  },
  "ppe": {
    title: "ğŸ›¡ï¸ PERSONAL PROTECTIVE EQUIPMENT (PPE)",
    rules: [
      "1. SAFETY GOGGLES: Required for all chemical handling and procedures with splash risk",
      "2. LAB COAT: Must be worn at all times in the laboratory (fire-resistant if working with flammables)",
      "3. GLOVES: Select appropriate material (nitrile, latex, neoprene) based on chemical compatibility",
      "4. CLOSED-TOE SHOES: Leather or synthetic materials covering entire foot",
      "5. FACE SHIELDS: Required for procedures with high splash risk or flying particles",
      "6. APRON: Additional protection when working with large volumes of corrosives",
      "7. HEARING PROTECTION: Required when noise levels exceed 85 decibels",
      "8. RESPIRATORY PROTECTION: Use when ventilation is inadequate (requires training and fit testing)",
      "9. HEAT-RESISTANT GLOVES: For handling hot equipment or glassware",
      "10. INSPECT PPE before each use for damage or deterioration"
    ],
    icon: "ğŸ›¡ï¸"
  },
  "emergency": {
    title: "ğŸš¨ EMERGENCY PROCEDURES",
    rules: [
      "1. FIRE: RACE - Rescue, Alarm, Contain, Extinguish/Evacuate",
      "2. CHEMICAL SPILL: Alert others, contain spill, use appropriate spill kit",
      "3. MEDICAL EMERGENCY: Call for help immediately, provide first aid if trained",
      "4. EYE EXPOSURE: Flush with eyewash for 15 minutes, seek medical attention",
      "5. SKIN CONTACT: Remove contaminated clothing, flush with water for 15 minutes",
      "6. INHALATION: Move to fresh air immediately, seek medical attention",
      "7. INGESTION: Do NOT induce vomiting, seek medical attention immediately",
      "8. EVACUATION: Know primary and secondary exit routes from your work area",
      "9. EMERGENCY NUMBERS: Post near all phones (911, Poison Control, security)",
      "10. DRILLS: Participate in all emergency drills and training sessions"
    ],
    icon: "ğŸš¨"
  },
  "chemicals": {
    title: "ğŸ§ª CHEMICAL HANDLING SAFETY",
    rules: [
      "1. SDS: Review Safety Data Sheets before using any chemical",
      "2. LABELING: All containers must have proper GHS-compliant labels",
      "3. VENTILATION: Use fume hoods for volatile, toxic, or odorous chemicals",
      "4. COMPATIBILITY: Store chemicals by hazard class (flammables, acids, bases, oxidizers)",
      "5. TRANSFER: Use secondary containment when moving chemicals",
      "6. MINIMIZATION: Use smallest quantity necessary for the experiment",
      "7. DISPOSAL: Never pour chemicals down the drain unless specifically permitted",
      "8. SPILL PREPARATION: Have appropriate spill kits readily available",
      "9. INCOMPATIBLES: Never mix unknown chemicals or waste",
      "10. EXPIRATION: Monitor chemical shelf life and dispose of expired materials"
    ],
    icon: "ğŸ§ª"
  },
  "biohazards": {
    title: "ğŸ¦  BIOLOGICAL SAFETY",
    rules: [
      "1. BIOSAFETY LEVEL: Know and follow your lab's designated BSL requirements",
      "2. BIOLOGICAL SAFETY CABINET: Use BSC for procedures with infectious agents",
      "3. AUTOCLAVE: Treat all biohazardous waste by autoclaving before disposal",
      "4. SHARPS: Dispose in puncture-resistant, leak-proof containers",
      "5. PERSONAL HYGIENE: Wash hands after handling biological materials",
      "6. DECONTAMINATION: Regularly disinfect work surfaces with appropriate agents",
      "7. MEDICAL SURVEILLANCE: Participate in required health monitoring programs",
      "8. VACCINATIONS: Complete all required immunizations for work with specific agents",
      "9. TRANSPORT: Use secondary containment when moving biological materials",
      "10. TRAINING: Complete biosafety training specific to the agents you work with"
    ],
    icon: "ğŸ¦ "
  },
  "electrical": {
    title: "âš¡ ELECTRICAL SAFETY",
    rules: [
      "1. INSPECTION: Check cords and plugs for damage before use",
      "2. GROUNDING: Ensure all equipment is properly grounded",
      "3. OVERLOADING: Do not overload electrical circuits or outlets",
      "4. WATER: Keep electrical equipment away from water and wet surfaces",
      "5. MODIFICATION: Never modify electrical equipment without authorization",
      "6. UNATTENDED: Do not leave heating equipment unattended",
      "7. QUALIFIED PERSONNEL: Only trained personnel should repair electrical equipment",
      "8. LOCKOUT/TAGOUT: Follow procedures when servicing equipment",
      "9. EXTENSION CORDS: Use only temporarily and never as permanent wiring",
      "10. GFCI: Use Ground Fault Circuit Interrupters in wet locations"
    ],
    icon: "âš¡"
  },
  "radiation": {
    title: "â˜¢ï¸ RADIATION SAFETY",
    rules: [
      "1. ALARA: Keep exposures As Low As Reasonably Achievable",
      "2. TIME: Minimize time spent near radiation sources",
      "3. DISTANCE: Maximize distance from radiation sources",
      "4. SHIELDING: Use appropriate shielding (lead, concrete, water)",
      "5. MONITORING: Wear dosimetry badges as required",
      "6. SURVEYS: Conduct regular contamination surveys",
      "7. TRAINING: Complete radiation safety training before working with sources",
      "8. INVENTORY: Maintain accurate inventory of all radioactive materials",
      "9. POSTING: Ensure proper signage in radiation areas",
      "10. DISPOSAL: Follow specific procedures for radioactive waste disposal"
    ],
    icon: "â˜¢ï¸"
  },
  "waste": {
    title: "ğŸ—‘ï¸ WASTE DISPOSAL PROCEDURES",
    rules: [
      "1. SEGREGATION: Separate waste by hazard class (chemical, biological, radioactive)",
      "2. LABELING: Label all waste containers with contents, date, and hazards",
      "3. COMPATIBILITY: Never mix incompatible wastes",
      "4. CONTAINERS: Use appropriate containers (chemical-resistant, puncture-proof)",
      "5. FILL LEVEL: Do not fill containers more than 75% capacity",
      "6. CLOSURE: Keep waste containers closed except when adding waste",
      "7. STORAGE: Store waste in designated areas with secondary containment",
      "8. MANIFESTS: Complete required paperwork for hazardous waste pickup",
      "9. TRAINING: Receive waste disposal training specific to your waste streams",
      "10. MINIMIZATION: Implement waste reduction strategies in experimental design"
    ],
    icon: "ğŸ—‘ï¸"
  }
};

function labsReset(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  card.querySelector('form').reset();
  card.querySelector('#labs-output').value = "";
  card.querySelector('#labs-hint').textContent = "";
  card.querySelector('#labs-status').textContent = "";
  card.querySelector('#labs-facts-container').style.display = "none";
  card.querySelector('#labs-count').style.display = "none";
}

function labsCopy(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  const out = card.querySelector('#labs-output').value;
  if(!out.trim()){
    labsShowHint(card, "No safety guide to copy", "warning");
    return;
  }
  
  // Include facts if visible
  let fullText = out;
  const factsContainer = card.querySelector('#labs-facts-container');
  if(factsContainer.style.display === "block") {
    const factsList = card.querySelector('#labs-facts-list');
    if(factsList) {
      const facts = Array.from(factsList.children).map(li => li.textContent).join('\n');
      fullText += '\n\nSAFETY FACTS:\n' + facts;
    }
  }
  
  navigator.clipboard?.writeText(fullText).then(() => {
    labsShowHint(card, "âœ“ Safety guide copied to clipboard", "success");
    setTimeout(() => {
      const hint = card.querySelector('#labs-hint');
      if(hint.textContent.includes("copied")) hint.textContent = "";
    }, 2000);
  }).catch(() => {
    // Fallback for older browsers
    const textarea = card.createElement('textarea');
    textarea.value = fullText;
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand('copy');
      labsShowHint(card, "âœ“ Copied to clipboard", "success");
    } catch(err) {
      labsShowHint(card, "Copy failed - select and copy manually", "error");
    }
    document.body.removeChild(textarea);
  });
}

function labsGenerate(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  const tool = card.querySelector('#labs-tool').value;
  const showFacts = card.querySelector('#labs-show-facts').value;
  
  // Get safety rules for selected tool
  const safetyData = labsSafetyRules[tool] || labsSafetyRules.rules;
  
  // Generate output
  let output = `=== LAB SAFETY GUIDE ===\n\n`;
  output += `${safetyData.icon} ${safetyData.title}\n\n`;
  output += safetyData.rules.join('\n');
  output += `\n\n=== IMPORTANT REMINDERS ===\n`;
  output += `â€¢ Complete all required safety training\n`;
  output += `â€¢ Review SDS before using any chemical\n`;
  output += `â€¢ Know emergency procedures for your specific hazards\n`;
  output += `â€¢ Report unsafe conditions to your supervisor\n`;
  output += `\nGenerated: ${new Date().toLocaleDateString()}`;
  
  card.querySelector('#labs-output').value = output;
  card.querySelector('#labs-status').textContent = "Safety Guide Generated";
  card.querySelector('#labs-status').style.background = "rgba(211, 47, 47, 0.3)";
  card.querySelector('#labs-status').style.color = "#ffab91";
  
  // Handle facts display
  const factsContainer = card.querySelector('#labs-facts-container');
  const factsList = card.querySelector('#labs-facts-list');
  
  if(showFacts === "no") {
    factsContainer.style.display = "none";
  } else {
    factsList.innerHTML = "";
    let factsToShow = [];
    
    if(showFacts === "random") {
      // Get 3 random unique facts
      const shuffled = [...labsSafetyFacts].sort(() => 0.5 - Math.random());
      factsToShow = shuffled.slice(0, 3);
    } else {
      // Get 5 facts
      factsToShow = labsSafetyFacts.slice(0, 5);
    }
    
    factsToShow.forEach(fact => {
      const li = document.createElement('li');
      li.style.padding = "5px 0 5px 25px";
      li.style.position = "relative";
      li.innerHTML = `<i class="fas fa-exclamation-circle" style="position:absolute;left:0;color:#ff8a65;font-size:12px;"></i> ${fact}`;
      factsList.appendChild(li);
    });
    
    factsContainer.style.display = "block";
  }
  
  // Update stats
  const stats = card.querySelector('#labs-count');
  stats.style.display = "flex";
  card.querySelector('#rules-count').textContent = safetyData.rules.length;
  card.querySelector('#facts-count').textContent = factsContainer.style.display === "block" ? 
    (showFacts === "random" ? 3 : 5) : 0;
  
  labsShowHint(card, `âœ“ ${safetyData.title} generated successfully`, "success");
}

function labsShowHint(card, message, type){
  const hint = card.querySelector('#labs-hint');
  const status = card.querySelector('#labs-status');
  
  hint.textContent = message;
  
  if(type === "success"){
    hint.style.color = "#a5d6a7";
    status.style.background = "rgba(76, 175, 80, 0.2)";
    status.style.color = "#81c784";
    status.textContent = "âœ“ Ready";
  } else if(type === "error"){
    hint.style.color = "#ef9a9a";
    status.style.background = "rgba(244, 67, 54, 0.3)";
    status.style.color = "#ffab91";
    status.textContent = "âœ— Error";
  } else if(type === "warning"){
    hint.style.color = "#fff59d";
    status.style.background = "rgba(255, 193, 7, 0.2)";
    status.style.color = "#ffcc80";
    status.textContent = "âš  Warning";
  }
  
  // Clear hint after 3 seconds if it's a success message
  if(type === "success"){
    setTimeout(() => {
      if(hint.textContent === message) hint.textContent = "";
    }, 3000);
  }
}

// Add interactivity
document.addEventListener('DOMContentLoaded', function() {
  const card = document.querySelector('.card');
  if(card) {
    const toolSelect = card.querySelector('#labs-tool');
    if(toolSelect) {
      toolSelect.addEventListener('change', function() {
        card.querySelector('#labs-status').textContent = "Category Selected";
        card.querySelector('#labs-status').style.background = "rgba(255, 193, 7, 0.2)";
        card.querySelector('#labs-status').style.color = "#ffcc80";
      });
    }
  }
});
</script>
