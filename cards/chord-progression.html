<h2 style="margin-top:0;color:var(--accent);">ðŸŽ¼ Chord Progression Builder</h2>

<form aria-describedby="chord-progression-desc">
  <p id="chord-progression-desc" class="small">
    Build, analyze, and explore chord progressions for songwriting. 
    <span style="color:var(--accent);">Perfect for musicians and composers!</span>
  </p>

  <!-- Key Selection -->
  <div class="field" style="margin-bottom:16px;">
    <label for="progression-key" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Choose Key
    </label>
    <select id="progression-key" 
            style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-size:1rem;">
      <option value="C">C Major / A Minor</option>
      <option value="G">G Major / E Minor</option>
      <option value="D">D Major / B Minor</option>
      <option value="A">A Major / Fâ™¯ Minor</option>
      <option value="E">E Major / Câ™¯ Minor</option>
      <option value="B">B Major / Gâ™¯ Minor</option>
      <option value="Fâ™¯">Fâ™¯ Major / Dâ™¯ Minor</option>
      <option value="Câ™¯">Câ™¯ Major / Aâ™¯ Minor</option>
      <option value="F">F Major / D Minor</option>
      <option value="Bâ™­">Bâ™­ Major / G Minor</option>
      <option value="Eâ™­">Eâ™­ Major / C Minor</option>
      <option value="Aâ™­">Aâ™­ Major / F Minor</option>
      <option value="Dâ™­">Dâ™­ Major / Bâ™­ Minor</option>
      <option value="Gâ™­">Gâ™­ Major / Eâ™­ Minor</option>
    </select>
  </div>

  <!-- Mode Selection -->
  <div class="field" style="margin-bottom:16px;">
    <label for="progression-mode" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Mode
    </label>
    <select id="progression-mode" 
            style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-size:1rem;">
      <option value="major">Major (Ionian) - Happy, Bright</option>
      <option value="minor">Minor (Aeolian) - Sad, Melancholic</option>
      <option value="dorian">Dorian - Jazzy, Soulful</option>
      <option value="mixolydian">Mixolydian - Bluesy, Rock</option>
      <option value="lydian">Lydian - Dreamy, Mystical</option>
      <option value="phrygian">Phrygian - Spanish, Exotic</option>
      <option value="locrian">Locrian - Tense, Unresolved</option>
    </select>
  </div>

  <!-- Progression Builder -->
  <div class="field" style="margin-bottom:16px;">
    <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Build Your Progression
    </label>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;">
      <button type="button" onclick="addChord('I')" 
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:bold;font-size:1.2rem;">I</button>
      <button type="button" onclick="addChord('IV')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:bold;font-size:1.2rem;">IV</button>
      <button type="button" onclick="addChord('V')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:bold;font-size:1.2rem;">V</button>
      <button type="button" onclick="addChord('vi')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:bold;font-size:1.2rem;">vi</button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
      <button type="button" onclick="addChord('ii')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text-secondary);cursor:pointer;">ii</button>
      <button type="button" onclick="addChord('iii')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text-secondary);cursor:pointer;">iii</button>
      <button type="button" onclick="addChord('viiÂ°')"
              style="padding:12px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text-secondary);cursor:pointer;">viiÂ°</button>
      <button type="button" onclick="addChord('+')"
              style="padding:12px 8px;background:rgba(45,212,255,0.05);border:1px solid rgba(255,255,255,0.05);border-radius:8px;color:var(--text-secondary);cursor:pointer;font-size:1.5rem;">+</button>
    </div>
  </div>

  <!-- Current Progression Display -->
  <div class="field" style="margin-bottom:16px;">
    <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Current Progression
    </label>
    <div id="current-progression" 
         style="min-height:60px;padding:16px;border-radius:8px;border:2px dashed rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);display:flex;align-items:center;justify-content:center;font-size:1.4rem;letter-spacing:4px;">
      Click chords above to build
    </div>
  </div>

  <!-- Quick Progressions -->
  <div class="field" style="margin-bottom:16px;">
    <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Popular Progressions
    </label>
    <div style="display:flex;flex-wrap:wrap;gap:8px;">
      <button type="button" onclick="loadProgression('I-V-vi-IV')" 
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">
        I-V-vi-IV (Pop)
      </button>
      <button type="button" onclick="loadProgression('vi-IV-I-V')"
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">
        vi-IV-I-V (Alternative)
      </button>
      <button type="button" onclick="loadProgression('I-IV-V-IV')"
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">
        I-IV-V-IV (Rock)
      </button>
      <button type="button" onclick="loadProgression('ii-V-I')"
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">
        ii-V-I (Jazz)
      </button>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="analyzeProgression(this)" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:1rem;">
      ðŸŽµ Analyze Progression
    </button>
    <button type="button" onclick="resetProgression(this)"
            style="padding:14px 18px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      Reset
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">ðŸŽ¶ Analysis Results</h3>
  
  <!-- Results Output -->
  <textarea id="progression-output" rows="8" 
            style="width:100%;padding:14px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:'Courier New',monospace;font-size:0.95rem;resize:vertical;"></textarea>

  <!-- Chord Details -->
  <div id="chord-details" style="margin-top:16px;padding:14px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;">
    <h4 style="margin-top:0;margin-bottom:12px;color:var(--accent);">ðŸŽ¼ Chord Details</h4>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:3px solid var(--accent);">
        <strong style="color:var(--accent);display:block;margin-bottom:4px;">I Chord</strong>
        <span>Tonic: Home chord, feels resolved</span>
      </div>
      <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:3px solid #4ecdc4;">
        <strong style="color:#4ecdc4;display:block;margin-bottom:4px;">IV Chord</strong>
        <span>Subdominant: Builds tension gently</span>
      </div>
      <div style="padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:3px solid #ffd166;">
        <strong style="color:#ffd166;display:block;margin-bottom:4px;">V Chord</strong>
        <span>Dominant: Creates strong resolution</span>
      </div>
    </div>
  </div>

  <!-- Song Examples -->
  <div id="song-examples" style="margin-top:16px;padding:14px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;">
    <h4 style="margin-top:0;margin-bottom:12px;color:var(--accent);">ðŸŽµ Songs Using This Progression</h4>
    <ul style="list-style:none;padding-left:0;margin:0;font-size:0.95rem;line-height:1.6;">
      <li style="margin-bottom:6px;padding-left:20px;position:relative;">
        <span style="position:absolute;left:0;color:var(--accent);">â€¢</span>
        <strong>I-V-vi-IV:</strong> "Let It Be", "No Woman No Cry", "Don't Stop Believin'"
      </li>
      <li style="margin-bottom:6px;padding-left:20px;position:relative;">
        <span style="position:absolute;left:0;color:#4ecdc4;">â€¢</span>
        <strong>vi-IV-I-V:</strong> "Complicated", "Someone Like You", "With Or Without You"
      </li>
      <li style="padding-left:20px;position:relative;">
        <span style="position:absolute;left:0;color:#ffd166;">â€¢</span>
        <strong>I-IV-V-IV:</strong> "La Bamba", "Twist and Shout", "Wild Thing"
      </li>
    </ul>
  </div>

  <!-- Hint Message -->
  <div style="margin-top:12px;">
    <div id="progression-hint" class="small" 
         style="padding:10px 14px;background:rgba(45,212,255,0.1);border-radius:6px;border-left:3px solid var(--accent);">
      ðŸŽ¹ Tip: Start with I-IV-V for a classic sound, then add vi for emotional depth
    </div>
  </div>
</div>

<script>
// Chord progression functionality - scoped with progression- prefix
let currentChords = [];
let currentKey = 'C';
let currentMode = 'major';

// Roman numeral to chord mapping for major keys
const majorKeyChords = {
  'I': ['major', 'Tonic - Home chord'],
  'ii': ['minor', 'Supertonic - Gentle tension'],
  'iii': ['minor', 'Mediant - Bridge chord'],
  'IV': ['major', 'Subdominant - Builds energy'],
  'V': ['major', 'Dominant - Wants to resolve'],
  'vi': ['minor', 'Submediant - Emotional'],
  'viiÂ°': ['diminished', 'Leading tone - Tense']
};

// Chord note mappings
const chordNotes = {
  'C': { 'major': 'C-E-G', 'minor': 'C-Eâ™­-G', 'diminished': 'C-Eâ™­-Gâ™­' },
  'G': { 'major': 'G-B-D', 'minor': 'G-Bâ™­-D', 'diminished': 'G-Bâ™­-Dâ™­' },
  'D': { 'major': 'D-Fâ™¯-A', 'minor': 'D-F-A', 'diminished': 'D-F-Aâ™­' },
  'A': { 'major': 'A-Câ™¯-E', 'minor': 'A-C-E', 'diminished': 'A-C-Eâ™­' },
  'E': { 'major': 'E-Gâ™¯-B', 'minor': 'E-G-B', 'diminished': 'E-G-Bâ™­' },
  'B': { 'major': 'B-Dâ™¯-Fâ™¯', 'minor': 'B-D-Fâ™¯', 'diminished': 'B-D-F' },
  'Fâ™¯': { 'major': 'Fâ™¯-Aâ™¯-Câ™¯', 'minor': 'Fâ™¯-A-Câ™¯', 'diminished': 'Fâ™¯-A-C' },
  'Câ™¯': { 'major': 'Câ™¯-Eâ™¯-Gâ™¯', 'minor': 'Câ™¯-E-Gâ™¯', 'diminished': 'Câ™¯-E-G' },
  'F': { 'major': 'F-A-C', 'minor': 'F-Aâ™­-C', 'diminished': 'F-Aâ™­-Câ™­' },
  'Bâ™­': { 'major': 'Bâ™­-D-F', 'minor': 'Bâ™­-Dâ™­-F', 'diminished': 'Bâ™­-Dâ™­-Fâ™­' },
  'Eâ™­': { 'major': 'Eâ™­-G-Bâ™­', 'minor': 'Eâ™­-Gâ™­-Bâ™­', 'diminished': 'Eâ™­-Gâ™­-Bâ™­â™­' },
  'Aâ™­': { 'major': 'Aâ™­-C-Eâ™­', 'minor': 'Aâ™­-Câ™­-Eâ™­', 'diminished': 'Aâ™­-Câ™­-Eâ™­â™­' },
  'Dâ™­': { 'major': 'Dâ™­-F-Aâ™­', 'minor': 'Dâ™­-Fâ™­-Aâ™­', 'diminished': 'Dâ™­-Fâ™­-Aâ™­â™­' },
  'Gâ™­': { 'major': 'Gâ™­-Bâ™­-Dâ™­', 'minor': 'Gâ™­-Bâ™­â™­-Dâ™­', 'diminished': 'Gâ™­-Bâ™­â™­-Dâ™­â™­' }
};

// Key circle to get actual chords
const keyCircle = {
  'C': ['C', 'Dm', 'Em', 'F', 'G', 'Am', 'Bdim'],
  'G': ['G', 'Am', 'Bm', 'C', 'D', 'Em', 'Fâ™¯dim'],
  'D': ['D', 'Em', 'Fâ™¯m', 'G', 'A', 'Bm', 'Câ™¯dim'],
  'A': ['A', 'Bm', 'Câ™¯m', 'D', 'E', 'Fâ™¯m', 'Gâ™¯dim'],
  'E': ['E', 'Fâ™¯m', 'Gâ™¯m', 'A', 'B', 'Câ™¯m', 'Dâ™¯dim'],
  'B': ['B', 'Câ™¯m', 'Dâ™¯m', 'E', 'Fâ™¯', 'Gâ™¯m', 'Aâ™¯dim'],
  'F': ['F', 'Gm', 'Am', 'Bâ™­', 'C', 'Dm', 'Edim'],
  'Bâ™­': ['Bâ™­', 'Cm', 'Dm', 'Eâ™­', 'F', 'Gm', 'Adim'],
  'Eâ™­': ['Eâ™­', 'Fm', 'Gm', 'Aâ™­', 'Bâ™­', 'Cm', 'Ddim'],
  'Aâ™­': ['Aâ™­', 'Bâ™­m', 'Cm', 'Dâ™­', 'Eâ™­', 'Fm', 'Gdim'],
  'Dâ™­': ['Dâ™­', 'Eâ™­m', 'Fm', 'Gâ™­', 'Aâ™­', 'Bâ™­m', 'Cdim']
};

function addChord(romanNumeral) {
  const card = document.currentScript.closest('.card') || document;
  
  // Update display
  currentChords.push(romanNumeral);
  const display = card.querySelector('#current-progression');
  display.textContent = currentChords.join(' - ');
  display.style.borderStyle = 'solid';
  display.style.borderColor = 'rgba(45,212,255,0.5)';
  
  // Update hint
  const hint = card.querySelector('#progression-hint');
  hint.textContent = `Added ${romanNumeral} chord. Click "Analyze" to see details!`;
  hint.style.color = 'var(--accent)';
}

function loadProgression(pattern) {
  const card = document.currentScript.closest('.card') || document;
  const chords = pattern.split('-');
  currentChords = chords;
  
  const display = card.querySelector('#current-progression');
  display.textContent = currentChords.join(' - ');
  display.style.borderStyle = 'solid';
  display.style.borderColor = 'rgba(45,212,255,0.5)';
  
  const hint = card.querySelector('#progression-hint');
  hint.textContent = `Loaded "${pattern}" progression. Ready to analyze!`;
  hint.style.color = 'var(--accent)';
}

function resetProgression(btn) {
  const card = btn.closest('.card') || document;
  currentChords = [];
  
  const display = card.querySelector('#current-progression');
  display.textContent = 'Click chords above to build';
  display.style.borderStyle = 'dashed';
  display.style.borderColor = 'rgba(45,212,255,0.3)';
  
  const output = card.querySelector('#progression-output');
  output.value = '';
  
  const details = card.querySelector('#chord-details');
  details.style.display = 'none';
  
  const examples = card.querySelector('#song-examples');
  examples.style.display = 'none';
  
  const hint = card.querySelector('#progression-hint');
  hint.textContent = 'ðŸŽ¹ Tip: Start with I-IV-V for a classic sound, then add vi for emotional depth';
  hint.style.color = '';
}

function analyzeProgression(btn) {
  const card = btn.closest('.card') || document;
  const keySelect = card.querySelector('#progression-key');
  const modeSelect = card.querySelector('#progression-mode');
  
  currentKey = keySelect.value;
  currentMode = modeSelect.value;
  
  if (currentChords.length === 0) {
    const output = card.querySelector('#progression-output');
    output.value = "âš ï¸ Please build a progression first!\n\nClick the Roman numeral buttons (I, IV, V, vi) above to create a chord progression.\n\nOr try a preset like 'I-V-vi-IV' (Pop progression).";
    return;
  }
  
  // Build analysis
  let output = `ðŸŽ¼ Chord Progression Analysis\n`;
  output += `â•`.repeat(40) + `\n\n`;
  output += `Key: ${currentKey} ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)}\n`;
  output += `Progression: ${currentChords.join(' â†’ ')}\n\n`;
  
  // Get actual chords
  const keyChords = keyCircle[currentKey] || keyCircle['C'];
  const romanMapping = ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'viiÂ°'];
  
  output += `ðŸŽµ Actual Chords:\n`;
  currentChords.forEach((roman, index) => {
    const romanIndex = romanMapping.indexOf(roman);
    if (romanIndex !== -1) {
      output += `  ${roman} = ${keyChords[romanIndex]} (${getChordNotes(currentKey, romanIndex)})\n`;
    }
  });
  
  output += `\nðŸŽ¶ Analysis:\n`;
  
  // Analyze progression characteristics
  const progressionStr = currentChords.join('-');
  
  if (progressionStr.includes('I-V-vi-IV')) {
    output += `âœ“ Classic Pop Progression\n`;
    output += `â€¢ Used in countless pop songs\n`;
    output += `â€¢ Creates emotional journey\n`;
    output += `â€¢ Strong resolution to I\n`;
  } else if (progressionStr.includes('vi-IV-I-V')) {
    output += `âœ“ Alternative/Rock Progression\n`;
    output += `â€¢ Starts on vi for emotional pull\n`;
    output += `â€¢ Common in 80s/90s alternative\n`;
    output += `â€¢ Creates nostalgic feeling\n`;
  } else if (progressionStr.includes('ii-V-I')) {
    output += `âœ“ Jazz Standard Progression\n`;
    output += `â€¢ The ultimate jazz resolution\n`;
    output += `â€¢ Creates tension and release\n`;
    output += `â€¢ Perfect for improvisation\n`;
  } else if (currentChords[0] === 'I' && currentChords[currentChords.length-1] === 'I') {
    output += `âœ“ Resolved Progression\n`;
    output += `â€¢ Starts and ends on tonic\n`;
    output += `â€¢ Feels complete and satisfying\n`;
  } else {
    output += `âœ“ Unique Progression\n`;
    output += `â€¢ Interesting chord choices\n`;
    output += `â€¢ Try adding 7th chords for jazz flavor\n`;
    output += `â€¢ Consider modulation to related keys\n`;
  }
  
  output += `\nâœ¨ Tips:\n`;
  output += `â€¢ Add 7th chords for jazz feel\n`;
  output += `â€¢ Try inversions for smoother voice leading\n`;
  output += `â€¢ Experiment with rhythm and tempo\n`;
  
  const outputArea = card.querySelector('#progression-output');
  outputArea.value = output;
  
  // Show additional sections
  const details = card.querySelector('#chord-details');
  const examples = card.querySelector('#song-examples');
  details.style.display = 'block';
  examples.style.display = 'block';
  
  // Update hint
  const hint = card.querySelector('#progression-hint');
  hint.textContent = `âœ… Analyzed ${currentChords.length}-chord progression in ${currentKey} ${currentMode}`;
  hint.style.color = '#39ff14';
}

function getChordNotes(key, romanIndex) {
  const romanMapping = ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'viiÂ°'];
  const roman = romanMapping[romanIndex];
  
  if (!chordNotes[key]) return 'Notes not available';
  
  const chordType = roman === 'I' || roman === 'IV' || roman === 'V' ? 'major' : 
                   roman === 'viiÂ°' ? 'diminished' : 'minor';
  
  return chordNotes[key][chordType] || 'C-E-G';
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Add keyboard shortcuts
  const keySelect = card.querySelector('#progression-key');
  if (keySelect) {
    keySelect.addEventListener('change', function() {
      const hint = card.querySelector('#progression-hint');
      hint.textContent = `ðŸŽ¹ Key changed to ${this.value}. Build a new progression!`;
      hint.style.color = 'var(--accent)';
    });
  }
  
  const modeSelect = card.querySelector('#progression-mode');
  if (modeSelect) {
    modeSelect.addEventListener('change', function() {
      const hint = card.querySelector('#progression-hint');
      const modeName = this.options[this.selectedIndex].text.split(' - ')[0];
      hint.textContent = `ðŸŽµ Mode changed to ${modeName}. Affects chord quality!`;
      hint.style.color = 'var(--accent)';
    });
  }
});
</script>