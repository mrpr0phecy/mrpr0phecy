<h2 id="chord-finder-title" style="margin-top:0;">ðŸŽµ Chord Finder</h2>

<form aria-describedby="chord-finder-desc">
  <p id="chord-finder-desc" class="small">
    Identify chords from selected notes. <span style="color:var(--accent);">Perfect for songwriters and beginners!</span>
  </p>

  <div class="field" style="margin-bottom:16px;position:relative;">
    <label for="chord-notes" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Enter Notes <span style="font-size:0.9em;opacity:0.8;">(comma separated or click piano keys)</span>
    </label>
    <input id="chord-notes" type="text" placeholder="e.g. C, E, G or click piano keys â†’" 
           style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-size:1rem;" />
    
    <!-- Interactive Piano Keys -->
    <div style="margin-top:12px;display:grid;grid-template-columns:repeat(7,1fr);gap:4px;background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);">
      <button type="button" class="piano-key" data-note="C" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;" 
              onclick="chordAddNote('C')">C</button>
      <button type="button" class="piano-key" data-note="D" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('D')">D</button>
      <button type="button" class="piano-key" data-note="E" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('E')">E</button>
      <button type="button" class="piano-key" data-note="F" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('F')">F</button>
      <button type="button" class="piano-key" data-note="G" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('G')">G</button>
      <button type="button" class="piano-key" data-note="A" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('A')">A</button>
      <button type="button" class="piano-key" data-note="B" style="padding:20px 4px;background:white;color:black;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.2s;"
              onclick="chordAddNote('B')">B</button>
    </div>
    
    <!-- Quick Common Chords -->
    <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;">
      <span style="font-size:0.9em;color:rgba(230,250,255,0.7);margin-right:8px;">Try:</span>
      <button type="button" onclick="chordSetNotes('C,E,G')" style="padding:4px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">C Major</button>
      <button type="button" onclick="chordSetNotes('A,C,E')" style="padding:4px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">A Minor</button>
      <button type="button" onclick="chordSetNotes('G,B,D')" style="padding:4px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">G Major</button>
      <button type="button" onclick="chordSetNotes('F,A,C')" style="padding:4px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9em;">F Major</button>
    </div>
  </div>

  <div class="field" style="margin-bottom:12px;">
    <label for="chord-show-facts" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Show Music Theory Facts
    </label>
    <select id="chord-show-facts" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.05);color:inherit;">
      <option value="yes" selected>Yes - Show helpful theory</option>
      <option value="no">No - Just show chord</option>
    </select>
  </div>

  <div class="actions" style="margin-top:16px;display:flex;gap:10px;">
    <button type="button" onclick="chordFind(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ðŸŽµ Find Chord
    </button>
    <button type="button" class="secondary" onclick="chordReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      Reset
    </button>
    <button type="button" onclick="chordCopy(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;transition:all 0.2s;">
      Copy
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">ðŸŽ¶ Chord Results</h3>
  <textarea id="chord-output" rows="6" 
            style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:monospace;font-size:0.95rem;resize:vertical;"></textarea>

  <div id="chord-facts-container" style="margin-top:16px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;">
    <h4 style="margin-top:0;margin-bottom:8px;color:var(--accent);">Music Theory Facts</h4>
    <ul style="list-style:none;padding-left:0;margin:0;font-size:0.95rem;line-height:1.6;">
      <li style="margin-bottom:6px;padding-left:12px;position:relative;">ðŸŽ¹ <strong>Major chords</strong>: Root + major third + perfect fifth (e.g. Câ€“Eâ€“G = bright/happy)</li>
      <li style="margin-bottom:6px;padding-left:12px;position:relative;">ðŸŽµ <strong>Minor chords</strong>: Root + minor third + perfect fifth (e.g. Aâ€“Câ€“E = sad/melancholic)</li>
      <li style="margin-bottom:6px;padding-left:12px;position:relative;">ðŸŽ¼ <strong>Seventh chords</strong>: Add a seventh note for jazz/soul (e.g. Câ€“Eâ€“Gâ€“Bâ™­)</li>
      <li style="padding-left:12px;position:relative;">âœ¨ <strong>Tip</strong>: Try C, E, G, B for a Cmaj7 (dreamy sound)</li>
    </ul>
  </div>

  <div style="margin-top:12px;">
    <div id="chord-hint" class="small" style="padding:8px 12px;background:rgba(45,212,255,0.1);border-radius:6px;border-left:3px solid var(--accent);"></div>
  </div>
</div>

<script>
/* chord-finder.html
   - Educational chord finder card
   - Scoped with chord- prefix
*/

// Helper function to add note via piano keys
function chordAddNote(note) {
  const card = document.currentScript.closest('.card') || document;
  const input = card.querySelector('#chord-notes');
  const current = input.value.trim();
  const notes = current ? current.split(',').map(n => n.trim()) : [];
  
  // Add note if not already there
  if (!notes.includes(note)) {
    notes.push(note);
    input.value = notes.join(', ');
    
    // Visual feedback on piano key
    const pianoKey = card.querySelector(`[data-note="${note}"]`);
    if (pianoKey) {
      pianoKey.style.background = 'var(--accent)';
      pianoKey.style.color = 'black';
      setTimeout(() => {
        pianoKey.style.background = 'white';
        pianoKey.style.color = 'black';
      }, 300);
    }
  }
}

// Helper function to set common chords
function chordSetNotes(notes) {
  const card = document.currentScript.closest('.card') || document;
  const input = card.querySelector('#chord-notes');
  input.value = notes;
  input.focus();
}

function chordReset(btn){
  const card = btn.closest('.card') || document;
  card.querySelector('form').reset();
  card.querySelector('#chord-output').value = "";
  card.querySelector('#chord-hint').textContent = "";
  card.querySelector('#chord-facts-container').style.display = "none";
  
  // Reset piano keys visual
  card.querySelectorAll('.piano-key').forEach(key => {
    key.style.background = 'white';
    key.style.color = 'black';
  });
}

function chordCopy(btn){
  const card = btn.closest('.card') || document;
  const out = card.querySelector('#chord-output').value;
  if(!out.trim()) return;
  
  navigator.clipboard?.writeText(out).then(() => {
    const hint = card.querySelector('#chord-hint');
    hint.textContent = "âœ… Copied to clipboard!";
    hint.style.color = "var(--accent)";
    setTimeout(() => {
      if(hint.textContent.includes("Copied")) {
        hint.textContent = "";
        hint.style.color = "";
      }
    }, 2000);
  }).catch(() => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = out;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    
    const hint = card.querySelector('#chord-hint');
    hint.textContent = "âœ… Copied!";
    hint.style.color = "var(--accent)";
    setTimeout(() => { hint.textContent = ""; }, 1500);
  });
}

function chordFind(btn){
  const card = btn.closest('.card') || document;
  const notesStr = card.querySelector('#chord-notes').value.trim();
  const showFacts = card.querySelector('#chord-show-facts').value === "yes";
  let out = "";
  
  if(notesStr){
    const notes = notesStr.split(',').map(n => n.trim().toUpperCase().replace(/[^A-G#â™­b]/g, ''));
    
    // Enhanced chord recognition
    const chordMap = {
      'C,E,G': 'C Major (Câ€“Eâ€“G) - Bright, happy sound',
      'C,EB,G': 'C Minor (Câ€“Eâ™­â€“G) - Melancholic, soulful',
      'C,E,G,B': 'C Major 7th (Câ€“Eâ€“Gâ€“B) - Dreamy, jazzy',
      'C,E,G,BB': 'C Dominant 7th (Câ€“Eâ€“Gâ€“Bâ™­) - Bluesy, tense',
      'A,C,E': 'A Minor (Aâ€“Câ€“E) - Sad, contemplative',
      'A,C#,E': 'A Major (Aâ€“C#â€“E) - Bright, uplifting',
      'D,F#,A': 'D Major (Dâ€“F#â€“A) - Strong, triumphant',
      'D,F,A': 'D Minor (Dâ€“Fâ€“A) - Melancholic, thoughtful',
      'G,B,D': 'G Major (Gâ€“Bâ€“D) - Warm, folk sound',
      'G,BB,D': 'G Minor (Gâ€“Bâ™­â€“D) - Dark, emotional',
      'F,A,C': 'F Major (Fâ€“Aâ€“C) - Warm, rich',
      'F,AB,C': 'F Minor (Fâ€“Aâ™­â€“C) - Deep, dramatic',
      'E,G#,B': 'E Major (Eâ€“G#â€“B) - Bright, open',
      'E,G,B': 'E Minor (Eâ€“Gâ€“B) - Sad, mysterious'
    };
    
    const normalizedNotes = notes.sort().join(',');
    let found = false;
    
    for (const [pattern, description] of Object.entries(chordMap)) {
      const patternNotes = pattern.split(',').map(n => n.trim());
      if (patternNotes.length === notes.length && 
          patternNotes.every(note => notes.includes(note))) {
        out = `âœ… Chord identified: ${description}`;
        found = true;
        break;
      }
    }
    
    if (!found) {
      // Try to guess chord type
      if (notes.length === 3) {
        out = `ðŸŽµ Triad detected: ${notes.join('â€“')}\nTry adding a 4th note for 7th chords!`;
      } else if (notes.length === 4) {
        out = `ðŸŽ¼ 4-note chord: ${notes.join('â€“')}\nPossible 7th chord or extended harmony`;
      } else if (notes.length > 4) {
        out = `ðŸŽ¹ Extended chord: ${notes.join('â€“')}\nComplex harmony - great for jazz!`;
      } else {
        out = `ðŸŽ¶ Notes: ${notes.join(', ')}\nEnter 3+ notes for chord identification`;
      }
    }
    
    // Add emoji based on chord type
    if (out.includes('Major')) out = 'ðŸŽµ ' + out;
    else if (out.includes('Minor')) out = 'ðŸŽ¹ ' + out;
    else if (out.includes('7th')) out = 'ðŸŽ¼ ' + out;
    
  } else {
    out = "ðŸŽ¹ Enter notes above or click piano keys to start!\nTry: C, E, G for C Major";
  }
  
  card.querySelector('#chord-output').value = out;
  card.querySelector('#chord-hint').textContent = "âœ¨ Ready for your next chord!";
  card.querySelector('#chord-hint').style.color = "var(--accent)";
  card.querySelector('#chord-facts-container').style.display = showFacts ? "block" : "none";
}

// Add keyboard shortcuts
document.addEventListener('DOMContentLoaded', function() {
  const card = document.currentScript?.closest('.card') || document;
  const input = card.querySelector('#chord-notes');
  
  if (input) {
    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const findBtn = card.querySelector('button[onclick*="chordFind"]');
        if (findBtn) findBtn.click();
      }
    });
  }
});
</script>
