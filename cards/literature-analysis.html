<!-- cards/study-assistant.html -->
<h2 id="study-assistant-title" style="margin-top:0;color:var(--accent);font-size:1.4rem;margin-bottom:8px;">üß† AI Study Assistant</h2>

<form aria-describedby="study-assistant-desc" style="margin-bottom:20px;">
    <p id="study-assistant-desc" class="small" style="color:rgba(230,250,255,0.9);margin-bottom:20px;line-height:1.5;">
        <span style="color:var(--accent);font-weight:500;">üöÄ Ace your exams:</span> Transform any topic into flashcards, practice quizzes, study guides, and mnemonics. Perfect for students, lifelong learners, and professionals.
    </p>
    
    <!-- STUDY MODES -->
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px;">
        <button type="button" onclick="saSetMode('flashcards')" class="mode-btn active" style="padding:12px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;">
            <span style="font-size:18px;">üé¥</span> Flashcards
        </button>
        <button type="button" onclick="saSetMode('quiz')" class="mode-btn" style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;">
            <span style="font-size:18px;">‚ùì</span> Quiz
        </button>
        <button type="button" onclick="saSetMode('summary')" class="mode-btn" style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;">
            <span style="font-size:18px;">üìù</span> Study Guide
        </button>
        <button type="button" onclick="saSetMode('mnemonic')" class="mode-btn" style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;">
            <span style="font-size:18px;">üéØ</span> Mnemonics
        </button>
    </div>
    
    <!-- TOPIC INPUT -->
    <div class="field" style="margin-bottom:16px;">
        <label for="sa-topic" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
            <span style="display:flex;align-items:center;gap:6px;">
                <span style="font-size:18px;">üìö</span> Study Topic
            </span>
            <span style="font-weight:normal;font-size:12px;color:rgba(230,250,255,0.7);">(e.g., "Photosynthesis", "French Revolution", "JavaScript Arrays")</span>
        </label>
        <input id="sa-topic" type="text" 
               placeholder="Enter your study topic here..."
               style="width:100%;padding:14px;border-radius:10px;border:1px solid rgba(45,212,255,0.4);background:rgba(255,255,255,0.03);color:inherit;font-size:15px;transition:border 0.2s ease;">
    </div>
    
    <!-- DETAILS -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px;">
        <div>
            <label for="sa-level" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üéì</span> Education Level
            </label>
            <select id="sa-level" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="middle">Middle School</option>
                <option value="high" selected>High School</option>
                <option value="college">College/University</option>
                <option value="professional">Professional</option>
            </select>
        </div>
        
        <div>
            <label for="sa-items" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üìä</span> Number of Items
            </label>
            <select id="sa-items" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="5">5 items</option>
                <option value="10" selected>10 items</option>
                <option value="15">15 items</option>
                <option value="20">20 items</option>
            </select>
        </div>
    </div>
    
    <!-- ADDITIONAL NOTES -->
    <div class="field" style="margin-bottom:16px;">
        <label for="sa-notes" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
            <span style="display:flex;align-items:center;gap:6px;">
                <span style="font-size:18px;">üí°</span> Specific Focus (Optional)
            </span>
            <span style="font-weight:normal;font-size:12px;color:rgba(230,250,255,0.7);">Key points, chapters, or concepts to emphasize</span>
        </label>
        <textarea id="sa-notes" rows="3"
                  placeholder="Example: Focus on equations and real-world applications..."
                  style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.03);color:inherit;font-size:14px;resize:vertical;"></textarea>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="display:flex;gap:12px;margin-top:20px;">
        <button type="button" onclick="saGenerate(this)" 
                style="flex:2;padding:14px 20px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.5);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform 0.2s ease;">
            <span style="font-size:18px;">‚ö°</span> Generate Study Materials
        </button>
        
        <button type="button" onclick="saExport()" id="sa-export-btn"
                style="padding:14px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:10px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üì•</span> Export
        </button>
        
        <button type="button" onclick="saReset(this)"
                style="padding:14px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üîÑ</span> Clear
        </button>
    </div>
</form>

<!-- STUDY MATERIALS OUTPUT -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h3 class="small" style="color:var(--accent);font-size:16px;margin:0;display:flex;align-items:center;gap:8px;">
            <span style="font-size:18px;" id="sa-output-icon">üé¥</span>
            <span id="sa-output-title">Flashcards</span>
        </h3>
        <div id="sa-stats" style="display:flex;gap:12px;font-size:12px;color:rgba(230,250,255,0.7);">
            <span>Items: <span id="sa-item-count">0</span></span>
            <span>Study time: <span id="sa-study-time">0m</span></span>
        </div>
    </div>
    
    <div id="sa-output-container" style="padding:16px;border-radius:10px;border:1px solid rgba(45,212,255,0.3);background:linear-gradient(135deg, rgba(20,20,20,0.9), rgba(10,15,20,0.9));min-height:200px;max-height:400px;overflow-y:auto;">
        <div id="sa-output" style="color:inherit;font-family:'Inter', system-ui, sans-serif;font-size:14px;line-height:1.6;">
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
                <div style="font-size:48px;margin-bottom:16px;">üìö</div>
                <div style="font-weight:500;margin-bottom:8px;color:var(--accent);">Ready to study?</div>
                <div>Enter a topic above and click "Generate Study Materials"</div>
                <div style="font-size:12px;margin-top:12px;color:rgba(230,250,255,0.4);">Try: "Photosynthesis", "World War II", "Python Functions"</div>
            </div>
        </div>
    </div>
    
    <!-- FLASHCARD NAVIGATION (Hidden by default) -->
    <div id="sa-flashcard-nav" style="display:none;margin-top:12px;text-align:center;">
        <div style="display:flex;align-items:center;justify-content:center;gap:16px;">
            <button onclick="saPrevCard()" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">‚óÄ Previous</button>
            <span id="sa-card-counter" style="font-size:13px;color:var(--accent);">Card 1 of 10</span>
            <button onclick="saNextCard()" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">Next ‚ñ∂</button>
        </div>
        <div style="margin-top:8px;">
            <button onclick="saFlipCard()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:6px;cursor:pointer;font-size:12px;">üîÑ Flip Card</button>
            <button onclick="saMarkKnown()" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:6px;cursor:pointer;font-size:12px;margin-left:8px;">‚úÖ Mark as Known</button>
        </div>
    </div>
    
    <!-- QUIZ CONTROLS (Hidden by default) -->
    <div id="sa-quiz-controls" style="display:none;margin-top:12px;text-align:center;">
        <div style="display:flex;align-items:center;justify-content:center;gap:16px;">
            <button onclick="saCheckAnswer()" style="padding:10px 20px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);color:var(--accent);border-radius:8px;cursor:pointer;font-weight:500;">Check Answer</button>
            <button onclick="saNextQuestion()" style="padding:10px 20px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;font-weight:500;">Next Question ‚Üí</button>
        </div>
        <div id="sa-quiz-score" style="margin-top:12px;font-size:13px;color:rgba(230,250,255,0.8);">
            Score: <span id="sa-score-value">0</span>/<span id="sa-total-questions">0</span>
        </div>
    </div>
    
    <!-- QUICK TIPS -->
    <div id="sa-hint" style="margin-top:12px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:3px solid var(--accent);font-size:13px;color:rgba(230,250,255,0.9);">
        <strong style="color:var(--accent);">üí° Study Tip:</strong> Use the spaced repetition method‚Äîreview material after 1 day, 3 days, then 1 week for maximum retention.
    </div>
</div>

<!-- PROGRESS TRACKER -->
<div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.08);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-size:13px;color:rgba(230,250,255,0.7);">üìà Study Progress</div>
        <div id="sa-progress-percent" style="font-size:13px;color:var(--accent);font-weight:500;">0%</div>
    </div>
    <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
        <div id="sa-progress-bar" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:0%;transition:width 0.3s ease;"></div>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:4px;">
        <div style="font-size:11px;color:rgba(230,250,255,0.5);">Mastered: <span id="sa-mastered">0</span> items</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.5);">Total: <span id="sa-total-items">0</span> items</div>
    </div>
</div>

<script>
/* study-assistant.html
   - AI-powered study tool for students and learners
   - Scoped with sa- prefix
*/

let currentMode = 'flashcards';
let currentCardIndex = 0;
let flashcards = [];
let quizQuestions = [];
let currentQuestionIndex = 0;
let quizScore = 0;
let masteredItems = 0;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('Study Assistant ready! üß†');
    
    // Load saved progress
    const savedProgress = localStorage.getItem('sa-progress');
    if (savedProgress) {
        const progress = JSON.parse(savedProgress);
        masteredItems = progress.mastered || 0;
        updateProgress();
    }
});

// Set study mode
function saSetMode(mode) {
    currentMode = mode;
    
    // Update button states
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = document.querySelector(`[onclick="saSetMode('${mode}')"]`);
    if (activeBtn) {
        activeBtn.style.background = 'rgba(45,212,255,0.2)';
        activeBtn.style.border = '2px solid var(--accent)';
        activeBtn.style.color = 'var(--accent)';
    }
    
    // Update output title and icon
    const icons = {
        'flashcards': 'üé¥',
        'quiz': '‚ùì',
        'summary': 'üìù',
        'mnemonic': 'üéØ'
    };
    
    const titles = {
        'flashcards': 'Flashcards',
        'quiz': 'Practice Quiz',
        'summary': 'Study Guide',
        'mnemonic': 'Memory Aids'
    };
    
    document.getElementById('sa-output-icon').textContent = icons[mode];
    document.getElementById('sa-output-title').textContent = titles[mode];
    
    // Show/hide navigation
    document.getElementById('sa-flashcard-nav').style.display = mode === 'flashcards' ? 'block' : 'none';
    document.getElementById('sa-quiz-controls').style.display = mode === 'quiz' ? 'block' : 'none';
    
    saShowNotification(`Switched to ${titles[mode]} mode`, 'info');
}

// Generate study materials
function saGenerate(btn) {
    const topic = document.getElementById('sa-topic').value.trim();
    const level = document.getElementById('sa-level').value;
    const items = parseInt(document.getElementById('sa-items').value);
    const notes = document.getElementById('sa-notes').value.trim();
    const mode = currentMode;
    
    if (!topic) {
        saShowNotification('Please enter a study topic!', 'warning');
        return;
    }
    
    // Show loading state
    btn.innerHTML = '<span style="font-size:18px;">‚è≥</span> Generating...';
    btn.disabled = true;
    
    setTimeout(() => {
        let output = '';
        let studyTime = 0;
        
        switch(mode) {
            case 'flashcards':
                flashcards = saGenerateFlashcards(topic, level, items, notes);
                output = saRenderFlashcards();
                studyTime = items * 1.5; // 1.5 minutes per card
                break;
                
            case 'quiz':
                quizQuestions = saGenerateQuiz(topic, level, items, notes);
                currentQuestionIndex = 0;
                quizScore = 0;
                output = saRenderQuiz();
                studyTime = items * 2; // 2 minutes per question
                break;
                
            case 'summary':
                output = saGenerateSummary(topic, level, items, notes);
                studyTime = Math.ceil(items / 2); // 0.5 minutes per item
                break;
                
            case 'mnemonic':
                output = saGenerateMnemonics(topic, level, items, notes);
                studyTime = Math.ceil(items * 0.8); // 0.8 minutes per mnemonic
                break;
        }
        
        // Update output
        document.getElementById('sa-output').innerHTML = output;
        document.getElementById('sa-item-count').textContent = items;
        document.getElementById('sa-study-time').textContent = studyTime + 'm';
        
        // Update total items for progress
        document.getElementById('sa-total-items').textContent = items;
        
        // Update progress
        updateProgress();
        
        // Reset button
        btn.innerHTML = '<span style="font-size:18px;">‚ö°</span> Generate Study Materials';
        btn.disabled = false;
        
        // Show notification
        saShowNotification(`${items} ${mode} generated for "${topic}"!`, 'success');
        
        // Auto-scroll to output
        document.getElementById('sa-output-container').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
        
    }, 800);
}

// Generate flashcards
function saGenerateFlashcards(topic, level, count, notes) {
    const cards = [];
    const subjects = {
        'science': ['Definition', 'Process', 'Examples', 'Formula', 'Importance'],
        'history': ['Event', 'Date', 'Key Figures', 'Causes', 'Effects'],
        'language': ['Word', 'Translation', 'Usage', 'Grammar Rule', 'Synonyms'],
        'math': ['Theorem', 'Formula', 'Application', 'Proof', 'Example'],
        'general': ['Concept', 'Explanation', 'Examples', 'Applications', 'Key Points']
    };
    
    // Determine subject based on topic
    let subject = 'general';
    if (topic.toLowerCase().includes('biology') || topic.toLowerCase().includes('chemistry') || topic.toLowerCase().includes('physics')) {
        subject = 'science';
    } else if (topic.toLowerCase().includes('history') || topic.toLowerCase().includes('war') || topic.toLowerCase().includes('revolution')) {
        subject = 'history';
    } else if (topic.toLowerCase().includes('language') || topic.toLowerCase().includes('vocabulary') || topic.toLowerCase().includes('grammar')) {
        subject = 'language';
    } else if (topic.toLowerCase().includes('math') || topic.toLowerCase().includes('algebra') || topic.toLowerCase().includes('calculus')) {
        subject = 'math';
    }
    
    const prompts = subjects[subject];
    
    for (let i = 1; i <= count; i++) {
        const prompt = prompts[i % prompts.length];
        cards.push({
            front: `${topic} - ${prompt} ${i}`,
            back: `Detailed explanation for ${prompt.toLowerCase()} ${i} of ${topic}. ${notes ? `\n\nFocus: ${notes}` : ''}`,
            known: false
        });
    }
    
    return cards;
}

// Render flashcards
function saRenderFlashcards() {
    if (flashcards.length === 0) return '<div>No flashcards generated yet.</div>';
    
    currentCardIndex = 0;
    document.getElementById('sa-card-counter').textContent = `Card 1 of ${flashcards.length}`;
    
    return `
        <div id="sa-flashcard" style="perspective:1000px;cursor:pointer;" onclick="saFlipCard()">
            <div id="sa-flashcard-inner" style="position:relative;width:100%;height:200px;transition:transform 0.8s;transform-style:preserve-3d;">
                <div id="sa-flashcard-front" style="position:absolute;width:100%;height:100%;backface-visibility:hidden;background:rgba(45,212,255,0.1);border-radius:10px;padding:20px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:18px;font-weight:600;color:var(--accent);">
                    ${flashcards[0].front}
                </div>
                <div id="sa-flashcard-back" style="position:absolute;width:100%;height:100%;backface-visibility:hidden;background:rgba(20,20,20,0.9);border-radius:10px;padding:20px;transform:rotateY(180deg);overflow-y:auto;border:1px solid rgba(45,212,255,0.3);">
                    <div style="font-size:16px;margin-bottom:10px;color:var(--accent);">Answer:</div>
                    <div style="font-size:14px;line-height:1.5;">${flashcards[0].back}</div>
                </div>
            </div>
        </div>
        <div style="text-align:center;margin-top:16px;font-size:12px;color:rgba(230,250,255,0.5);">
            Click card to flip ‚Ä¢ Use navigation below
        </div>
    `;
}

// Flashcard navigation
function saFlipCard() {
    const inner = document.getElementById('sa-flashcard-inner');
    if (!inner) return;
    
    const currentRotation = inner.style.transform === 'rotateY(180deg)' ? 'rotateY(0deg)' : 'rotateY(180deg)';
    inner.style.transform = currentRotation;
}

function saPrevCard() {
    if (currentCardIndex > 0) {
        currentCardIndex--;
        updateFlashcardDisplay();
    }
}

function saNextCard() {
    if (currentCardIndex < flashcards.length - 1) {
        currentCardIndex++;
        updateFlashcardDisplay();
    }
}

function saMarkKnown() {
    if (flashcards[currentCardIndex]) {
        flashcards[currentCardIndex].known = !flashcards[currentCardIndex].known;
        masteredItems = flashcards.filter(card => card.known).length;
        
        // Visual feedback
        const btn = document.querySelector('[onclick="saMarkKnown()"]');
        if (flashcards[currentCardIndex].known) {
            btn.innerHTML = '‚úÖ Known';
            btn.style.background = 'rgba(57,255,20,0.2)';
            btn.style.color = '#39ff14';
        } else {
            btn.innerHTML = '‚úÖ Mark as Known';
            btn.style.background = 'rgba(57,255,20,0.1)';
            btn.style.color = '#39ff14';
        }
        
        updateProgress();
        saveProgress();
    }
}

function updateFlashcardDisplay() {
    if (!flashcards[currentCardIndex]) return;
    
    const front = document.getElementById('sa-flashcard-front');
    const back = document.getElementById('sa-flashcard-back');
    const counter = document.getElementById('sa-card-counter');
    
    if (front && back && counter) {
        front.innerHTML = flashcards[currentCardIndex].front;
        back.innerHTML = `
            <div style="font-size:16px;margin-bottom:10px;color:var(--accent);">Answer:</div>
            <div style="font-size:14px;line-height:1.5;">${flashcards[currentCardIndex].back}</div>
        `;
        counter.textContent = `Card ${currentCardIndex + 1} of ${flashcards.length}`;
        
        // Reset flip
        const inner = document.getElementById('sa-flashcard-inner');
        if (inner) inner.style.transform = 'rotateY(0deg)';
        
        // Update mark button
        const markBtn = document.querySelector('[onclick="saMarkKnown()"]');
        if (markBtn) {
            if (flashcards[currentCardIndex].known) {
                markBtn.innerHTML = '‚úÖ Known';
                markBtn.style.background = 'rgba(57,255,20,0.2)';
            } else {
                markBtn.innerHTML = '‚úÖ Mark as Known';
                markBtn.style.background = 'rgba(57,255,20,0.1)';
            }
        }
    }
}

// Generate quiz
function saGenerateQuiz(topic, level, count, notes) {
    const questions = [];
    
    for (let i = 1; i <= count; i++) {
        const questionTypes = ['multiple-choice', 'true-false', 'short-answer'];
        const type = questionTypes[i % questionTypes.length];
        
        let question = {};
        
        switch(type) {
            case 'multiple-choice':
                question = {
                    type: 'multiple-choice',
                    question: `What is key concept ${i} about ${topic}?`,
                    options: [
                        `Correct answer for concept ${i}`,
                        `Common misconception about ${topic}`,
                        `Related but different concept`,
                        `Historical context only`
                    ],
                    correct: 0,
                    explanation: `This is important because... ${notes ? `\nNote: ${notes}` : ''}`
                };
                break;
                
            case 'true-false':
                question = {
                    type: 'true-false',
                    question: `True or False: Statement ${i} about ${topic} is accurate.`,
                    correct: i % 2 === 0, // Alternate between true and false
                    explanation: `Explanation of why this is ${i % 2 === 0 ? 'true' : 'false'}...`
                };
                break;
                
            case 'short-answer':
                question = {
                    type: 'short-answer',
                    question: `Explain concept ${i} in ${topic}.`,
                    answer: `Concept ${i} involves... ${notes ? `\nKey point: ${notes}` : ''}`,
                    explanation: `This concept is fundamental because...`
                };
                break;
        }
        
        questions.push(question);
    }
    
    return questions;
}

// Render quiz
function saRenderQuiz() {
    if (quizQuestions.length === 0) return '<div>No quiz questions generated yet.</div>';
    
    currentQuestionIndex = 0;
    document.getElementById('sa-total-questions').textContent = quizQuestions.length;
    document.getElementById('sa-score-value').textContent = '0';
    
    return saRenderQuestion(0);
}

function saRenderQuestion(index) {
    if (!quizQuestions[index]) return '';
    
    const question = quizQuestions[index];
    let html = `<div style="margin-bottom:20px;">`;
    
    html += `<div style="font-size:16px;font-weight:600;margin-bottom:16px;color:var(--accent);">Question ${index + 1}:</div>`;
    html += `<div style="font-size:15px;margin-bottom:20px;line-height:1.5;">${question.question}</div>`;
    
    if (question.type === 'multiple-choice') {
        html += `<div style="display:grid;gap:10px;">`;
        question.options.forEach((option, i) => {
            html += `
                <label style="display:flex;align-items:center;gap:10px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;border:1px solid rgba(255,255,255,0.1);cursor:pointer;">
                    <input type="radio" name="quiz-answer" value="${i}" style="accent-color:var(--accent);">
                    <span>${option}</span>
                </label>
            `;
        });
        html += `</div>`;
    } else if (question.type === 'true-false') {
        html += `
            <div style="display:flex;gap:12px;">
                <label style="flex:1;text-align:center;padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);cursor:pointer;">
                    <input type="radio" name="quiz-answer" value="true" style="accent-color:#39ff14;">
                    <span style="color:#39ff14;">True</span>
                </label>
                <label style="flex:1;text-align:center;padding:12px;background:rgba(255,45,85,0.1);border-radius:8px;border:1px solid rgba(255,45,85,0.3);cursor:pointer;">
                    <input type="radio" name="quiz-answer" value="false" style="accent-color:#ff2d55;">
                    <span style="color:#ff2d55;">False</span>
                </label>
            </div>
        `;
    } else if (question.type === 'short-answer') {
        html += `
            <textarea id="short-answer-input" rows="3" placeholder="Type your answer here..." style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.03);color:inherit;"></textarea>
        `;
    }
    
    html += `</div>`;
    
    // Add answer display area (initially hidden)
    html += `
        <div id="quiz-answer" style="display:none;margin-top:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:3px solid var(--accent);">
            <div style="font-weight:600;color:var(--accent);margin-bottom:8px;">Explanation:</div>
            <div>${question.explanation}</div>
        </div>
    `;
    
    return html;
}

// Quiz functions
function saCheckAnswer() {
    const question = quizQuestions[currentQuestionIndex];
    if (!question) return;
    
    let isCorrect = false;
    
    if (question.type === 'multiple-choice') {
        const selected = document.querySelector('input[name="quiz-answer"]:checked');
        isCorrect = selected && parseInt(selected.value) === question.correct;
    } else if (question.type === 'true-false') {
        const selected = document.querySelector('input[name="quiz-answer"]:checked');
        isCorrect = selected && selected.value === question.correct.toString();
    } else if (question.type === 'short-answer') {
        const answer = document.getElementById('short-answer-input')?.value.trim();
        // For demo purposes, always mark as correct if something is entered
        isCorrect = answer && answer.length > 5;
    }
    
    if (isCorrect) {
        quizScore++;
        saShowNotification('Correct! ‚úÖ', 'success');
    } else {
        saShowNotification('Try again! ‚ùå', 'error');
    }
    
    // Update score
    document.getElementById('sa-score-value').textContent = quizScore;
    
    // Show explanation
    document.getElementById('quiz-answer').style.display = 'block';
}

function saNextQuestion() {
    if (currentQuestionIndex < quizQuestions.length - 1) {
        currentQuestionIndex++;
        document.getElementById('sa-output').innerHTML = saRenderQuestion(currentQuestionIndex);
        document.getElementById('quiz-answer').style.display = 'none';
    } else {
        // Quiz complete
        const percentage = Math.round((quizScore / quizQuestions.length) * 100);
        document.getElementById('sa-output').innerHTML = `
            <div style="text-align:center;padding:40px 20px;">
                <div style="font-size:48px;margin-bottom:16px;">${percentage >= 80 ? 'üéâ' : percentage >= 60 ? 'üëç' : 'üìö'}</div>
                <div style="font-size:20px;font-weight:600;margin-bottom:12px;color:var(--accent);">Quiz Complete!</div>
                <div style="margin-bottom:16px;">Score: <strong style="color:${percentage >= 80 ? '#39ff14' : percentage >= 60 ? 'var(--accent)' : '#ffcc00'}">${quizScore}/${quizQuestions.length}</strong> (${percentage}%)</div>
                <div style="font-size:14px;color:rgba(230,250,255,0.7);">
                    ${percentage >= 80 ? 'Excellent work! You\'ve mastered this topic.' : 
                      percentage >= 60 ? 'Good job! Review the flashcards for better retention.' :
                      'Keep practicing! Try the flashcards mode to strengthen your understanding.'}
                </div>
            </div>
        `;
    }
}

// Generate summary
function saGenerateSummary(topic, level, items, notes) {
    const levels = {
        'middle': 'simple and clear',
        'high': 'detailed and comprehensive',
        'college': 'academic and thorough',
        'professional': 'advanced and practical'
    };
    
    return `
        <div style="margin-bottom:20px;">
            <div style="font-size:16px;font-weight:600;margin-bottom:12px;color:var(--accent);">üìö Study Guide: ${topic}</div>
            <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:16px;">Level: ${level.charAt(0).toUpperCase() + level.slice(1)} ‚Ä¢ ${levels[level]}</div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üîë Key Concepts:</div>
            <ul style="margin:0;padding-left:20px;">
                ${Array.from({length: items}, (_, i) => 
                    `<li style="margin-bottom:6px;">Concept ${i + 1}: Essential understanding point</li>`
                ).join('')}
            </ul>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìñ Detailed Breakdown:</div>
            <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
                ${Array.from({length: Math.min(3, items)}, (_, i) => 
                    `<div style="margin-bottom:12px;">
                        <strong>Concept ${i + 1}:</strong> Detailed explanation with examples and applications.
                    </div>`
                ).join('')}
            </div>
        </div>
        
        ${notes ? `
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üéØ Your Focus Areas:</div>
            <div style="color:rgba(230,250,255,0.9);">${notes}</div>
        </div>
        ` : ''}
        
        <div style="margin-top:20px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;">
            <div style="font-weight:600;margin-bottom:4px;color:var(--accent);">üí° Study Strategy:</div>
            <div style="font-size:13px;">Review this guide daily. Create flashcards for concepts you find challenging. Practice explaining concepts aloud.</div>
        </div>
    `;
}

// Generate mnemonics
function saGenerateMnemonics(topic, level, items, notes) {
    const mnemonicTypes = ['Acronym', 'Rhyme', 'Visual', 'Story', 'Chunking', 'Method of Loci'];
    
    return `
        <div style="margin-bottom:20px;">
            <div style="font-size:16px;font-weight:600;margin-bottom:12px;color:var(--accent);">üéØ Memory Aids for: ${topic}</div>
            <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:16px;">${items} memory techniques to help you remember</div>
        </div>
        
        <div style="display:grid;gap:12px;">
            ${Array.from({length: items}, (_, i) => {
                const type = mnemonicTypes[i % mnemonicTypes.length];
                return `
                    <div style="background:rgba(255,255,255,0.03);padding:16px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                            <div style="font-weight:600;color:var(--accent);">${type} Technique</div>
                            <div style="font-size:12px;padding:2px 8px;background:rgba(45,212,255,0.1);border-radius:4px;color:var(--accent);">#${i + 1}</div>
                        </div>
                        <div style="margin-bottom:8px;">Mnemonic for remembering concept ${i + 1}:</div>
                        <div style="font-style:italic;color:rgba(230,250,255,0.9);background:rgba(0,0,0,0.2);padding:8px;border-radius:4px;border-left:3px solid var(--accent);">
                            "Creative memory phrase or acronym here..."
                        </div>
                        <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:8px;">
                            üîç How it works: This technique helps by...
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        <div style="margin-top:20px;padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;border-left:3px solid #39ff14;">
            <div style="font-weight:600;margin-bottom:4px;color:#39ff14;">‚ú® Pro Tip:</div>
            <div style="font-size:13px;">Create your own personalized mnemonics‚Äîthey're more effective because they connect to your existing knowledge and experiences.</div>
        </div>
    `;
}

// Export function
function saExport() {
    const topic = document.getElementById('sa-topic').value || 'Study Materials';
    const mode = currentMode;
    const content = document.getElementById('sa-output').innerText || document.getElementById('sa-output').textContent;
    
    if (!content || content.includes('Ready to study?')) {
        saShowNotification('Generate materials first!', 'warning');
        return;
    }
    
    const blob = new Blob([`${topic} - ${mode.toUpperCase()}\n\n${content}`], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${topic.replace(/\s+/g, '_')}_${mode}_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    saShowNotification('Materials exported! üì•', 'success');
}

// Reset everything
function saReset(btn) {
    const card = btn.closest('.card');
    card.querySelector('form').reset();
    document.getElementById('sa-output').innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
            <div style="font-size:48px;margin-bottom:16px;">üìö</div>
            <div style="font-weight:500;margin-bottom:8px;color:var(--accent);">Ready to study?</div>
            <div>Enter a topic above and click "Generate Study Materials"</div>
            <div style="font-size:12px;margin-top:12px;color:rgba(230,250,255,0.4);">Try: "Photosynthesis", "World War II", "Python Functions"</div>
        </div>
    `;
    
    // Reset stats
    document.getElementById('sa-item-count').textContent = '0';
    document.getElementById('sa-study-time').textContent = '0m';
    document.getElementById('sa-total-items').textContent = '0';
    document.getElementById('sa-mastered').textContent = '0';
    
    // Hide navigation
    document.getElementById('sa-flashcard-nav').style.display = 'none';
    document.getElementById('sa-quiz-controls').style.display = 'none';
    
    // Reset progress
    masteredItems = 0;
    updateProgress();
    saveProgress();
    
    saShowNotification('Cleared! Ready for new study session. üß†', 'info');
}

// Progress tracking
function updateProgress() {
    const totalItems = parseInt(document.getElementById('sa-total-items').textContent) || 0;
    const percent = totalItems > 0 ? Math.round((masteredItems / totalItems) * 100) : 0;
    
    document.getElementById('sa-progress-percent').textContent = percent + '%';
    document.getElementById('sa-progress-bar').style.width = percent + '%';
    document.getElementById('sa-mastered').textContent = masteredItems;
    
    // Update hint based on progress
    const hint = document.getElementById('sa-hint');
    if (percent === 100 && totalItems > 0) {
        hint.innerHTML = '<strong style="color:#39ff14;">üéâ Mastered!</strong> You\'ve learned all items. Time for review in 3 days.';
    } else if (percent >= 70) {
        hint.innerHTML = '<strong style="color:var(--accent);">üí™ Great progress!</strong> Keep reviewing challenging items.';
    }
}

function saveProgress() {
    const progress = {
        mastered: masteredItems,
        lastUpdated: new Date().toISOString()
    };
    localStorage.setItem('sa-progress', JSON.stringify(progress));
}

// Notification system
function saShowNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 16px;
        background: ${type === 'success' ? 'rgba(57,255,20,0.15)' : 
                     type === 'error' ? 'rgba(255,45,85,0.15)' : 
                     type === 'warning' ? 'rgba(255,204,0,0.15)' : 
                     'rgba(45,212,255,0.15)'};
        border: 1px solid ${type === 'success' ? 'rgba(57,255,20,0.3)' : 
                           type === 'error' ? 'rgba(255,45,85,0.3)' : 
                           type === 'warning' ? 'rgba(255,204,0,0.3)' : 
                           'rgba(45,212,255,0.3)'};
        color: ${type === 'success' ? '#39ff14' : 
                type === 'error' ? '#ff2d55' : 
                type === 'warning' ? '#ffcc00' : 
                'var(--accent)'};
        border-radius: 8px;
        z-index: 10000;
        backdrop-filter: blur(10px);
        font-weight: 500;
        animation: saSlideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'saSlideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Add CSS animations
if (!document.querySelector('#sa-styles')) {
    const style = document.createElement('style');
    style.id = 'sa-styles';
    style.textContent = `
        @keyframes saSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes saSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        button:active {
            transform: translateY(0);
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--accent) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(45,212,255,0.1);
        }
        #sa-flashcard-inner {
            transition: transform 0.6s !important;
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
/* Card-specific responsive styles */
#study-assistant-title {
    animation: saFadeIn 0.5s ease;
}

@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
        justify-content: center;
    }
    
    .mode-btn {
        font-size: 13px !important;
        padding: 10px !important;
    }
}

@keyframes saFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
