<h2 id="sl-buildmate-title" style="margin-top:0;background:linear-gradient(45deg, #8b5cf6, #3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;">ğŸ—ï¸ Second Life Builder's Mate</h2>

<form aria-describedby="sl-buildmate-desc">
  <p id="sl-buildmate-desc" class="small" style="color:rgba(139,92,246,0.8);margin-bottom:16px;">
    Professional toolkit for Second Life builders: prim allowance, object sizing, weight calculation, grid alignment, and LOD optimization.
    <span style="color:#10b981;display:block;margin-top:4px;">
      âœ… Features: Prim/LI calculation, mesh optimization, physics analysis, export scripts
    </span>
  </p>

  <!-- Parcel Configuration -->
  <div style="background:rgba(139,92,246,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(139,92,246,0.1);">
    <h3 style="color:#8b5cf6;margin:0 0 12px 0;font-size:16px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:18px;">ğŸï¸</span> Parcel Configuration
    </h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="sl-bm-parcel" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#8b5cf6;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Parcel Size (mÂ²)
        </label>
        <input id="sl-bm-parcel" type="number" min="1" max="65536" placeholder="1024" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;" />
        <div style="font-size:11px;color:rgba(139,92,246,0.6);margin-top:4px;">Standard: 512, 1024, 4096, 16384</div>
      </div>
      
      <div class="field">
        <label for="sl-bm-landtype" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#8b5cf6;font-weight:500;">
          <span style="font-size:18px;">ğŸŒ</span> Land Type
        </label>
        <select id="sl-bm-landtype" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;">
          <option value="mainland">ğŸ  Mainland (0.117 LI/mÂ²)</option>
          <option value="private">ğŸ¡ Private Estate (0.229 LI/mÂ²)</option>
          <option value="homestead">ğŸï¸ Homestead (0.563 LI/mÂ²)</option>
          <option value="openspace">ğŸŒŒ Openspace (0.063 LI/mÂ²)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-primcount" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#8b5cf6;font-weight:500;">
          <span style="font-size:18px;">ğŸ§±</span> Existing Prims/LI
        </label>
        <input id="sl-bm-primcount" type="number" min="0" placeholder="0" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;" />
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sl-bm-tier" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#8b5cf6;font-weight:500;">
          <span style="font-size:18px;">ğŸ’°</span> Premium Tier
        </label>
        <select id="sl-bm-tier" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;">
          <option value="0">Basic (No Bonus)</option>
          <option value="512">512 mÂ² (+117 LI)</option>
          <option value="1024">1024 mÂ² (+234 LI)</option>
          <option value="2048">2048 mÂ² (+468 LI)</option>
          <option value="4096">4096 mÂ² (+937 LI)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-groupbonus" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#8b5cf6;font-weight:500;">
          <span style="font-size:18px;">ğŸ‘¥</span> Group Bonus (%)
        </label>
        <input id="sl-bm-groupbonus" type="number" min="0" max="100" value="10" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- Object Dimensions & Properties -->
  <div style="background:rgba(59,130,246,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(59,130,246,0.1);">
    <h3 style="color:#3b82f6;margin:0 0 12px 0;font-size:16px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:18px;">ğŸ“¦</span> Object Dimensions & Properties
    </h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="sl-bm-length" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Length (m)
        </label>
        <input id="sl-bm-length" type="number" min="0.01" max="64" step="0.01" placeholder="2.0" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;" />
        <div style="font-size:11px;color:rgba(59,130,246,0.6);margin-top:4px;">SL Max: 64m</div>
      </div>
      
      <div class="field">
        <label for="sl-bm-width" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Width (m)
        </label>
        <input id="sl-bm-width" type="number" min="0.01" max="64" step="0.01" placeholder="1.0" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="sl-bm-height" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ“Š</span> Height (m)
        </label>
        <input id="sl-bm-height" type="number" min="0.01" max="64" step="0.01" placeholder="0.5" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;" />
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="sl-bm-density" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">âš–ï¸</span> Density (kg/mÂ³)
        </label>
        <select id="sl-bm-density" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;">
          <option value="100">Feather (100 kg/mÂ³)</option>
          <option value="500" selected>Wood (500 kg/mÂ³)</option>
          <option value="1000">Water (1000 kg/mÂ³)</option>
          <option value="2000">Concrete (2000 kg/mÂ³)</option>
          <option value="7800">Steel (7800 kg/mÂ³)</option>
          <option value="custom">Custom Density</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-objecttype" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ”§</span> Object Type
        </label>
        <select id="sl-bm-objecttype" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;">
          <option value="prim">Prim (Legacy)</option>
          <option value="mesh" selected>Mesh</option>
          <option value="sculpt">Sculpted Prim</option>
          <option value="linkset">Linkset</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-lod" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ‘ï¸</span> LOD Setting
        </label>
        <select id="sl-bm-lod" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;">
          <option value="low">Low (0.125)</option>
          <option value="medium" selected>Medium (0.24)</option>
          <option value="high">High (0.5)</option>
          <option value="ultra">Ultra (1.0)</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sl-bm-physics" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">âš¡</span> Physics Type
        </label>
        <select id="sl-bm-physics" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;">
          <option value="none">None</option>
          <option value="prim" selected>Prim</option>
          <option value="convex">Convex Hull</option>
          <option value="mesh">Mesh</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-material" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ¨</span> Material
        </label>
        <select id="sl-bm-material" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;">
          <option value="stone">Stone</option>
          <option value="metal">Metal</option>
          <option value="glass">Glass</option>
          <option value="wood" selected>Wood</option>
          <option value="flesh">Flesh</option>
          <option value="plastic">Plastic</option>
          <option value="rubber">Rubber</option>
          <option value="light">Light</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-textures" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#3b82f6;font-weight:500;">
          <span style="font-size:18px;">ğŸ–¼ï¸</span> Texture Count
        </label>
        <input id="sl-bm-textures" type="number" min="0" max="100" value="1" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(59,130,246,0.3);background:rgba(59,130,246,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- Grid & Positioning -->
  <div style="background:rgba(16,185,129,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(16,185,129,0.1);">
    <h3 style="color:#10b981;margin:0 0 12px 0;font-size:16px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:18px;">ğŸ¯</span> Grid & Positioning
    </h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="sl-bm-grid" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ”²</span> Grid Step (m)
        </label>
        <select id="sl-bm-grid" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;">
          <option value="0.125">0.125 (1/8)</option>
          <option value="0.25" selected>0.25 (1/4)</option>
          <option value="0.5">0.5 (1/2)</option>
          <option value="1">1.0 (Full)</option>
          <option value="custom">Custom Step</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-snap" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ§²</span> Snap Mode
        </label>
        <select id="sl-bm-snap" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;">
          <option value="ground">Ground</option>
          <option value="surface" selected>Surface</option>
          <option value="grid">Grid</option>
          <option value="none">None (Free)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-rotation" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ”„</span> Rotation Step (Â°)
        </label>
        <select id="sl-bm-rotation" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;">
          <option value="5">5Â°</option>
          <option value="15">15Â°</option>
          <option value="30">30Â°</option>
          <option value="45" selected>45Â°</option>
          <option value="90">90Â°</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sl-bm-x" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> X Position (m)
        </label>
        <input id="sl-bm-x" type="number" step="0.01" placeholder="10.3" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="sl-bm-y" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Y Position (m)
        </label>
        <input id="sl-bm-y" type="number" step="0.01" placeholder="7.8" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="sl-bm-z" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#10b981;font-weight:500;">
          <span style="font-size:18px;">ğŸ“</span> Z Position (m)
        </label>
        <input id="sl-bm-z" type="number" step="0.01" placeholder="0.0" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(16,185,129,0.3);background:rgba(16,185,129,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- Advanced Options -->
  <div style="background:rgba(245,158,11,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(245,158,11,0.1);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h3 style="color:#f59e0b;margin:0;font-size:16px;">âš¡ Advanced Optimization</h3>
      <label style="display:flex;align-items:center;gap:8px;font-size:14px;color:#f59e0b;">
        <input type="checkbox" id="sl-bm-show-advanced" style="accent-color:#f59e0b;">
        Show Advanced Options
      </label>
    </div>
    
    <div id="sl-bm-advanced-options" style="display:none;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sl-bm-triangles" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#f59e0b;font-weight:500;">
          <span style="font-size:18px;">ğŸ”º</span> Triangle Count
        </label>
        <input id="sl-bm-triangles" type="number" min="1" max="100000" placeholder="1000" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(245,158,11,0.3);background:rgba(245,158,11,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="sl-bm-downloadweight" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#f59e0b;font-weight:500;">
          <span style="font-size:18px;">ğŸ“¥</span> Download Weight
        </label>
        <select id="sl-bm-downloadweight" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(245,158,11,0.3);background:rgba(245,158,11,0.05);color:inherit;">
          <option value="0.5">0.5 (Low)</option>
          <option value="1.0" selected>1.0 (Medium)</option>
          <option value="2.0">2.0 (High)</option>
          <option value="4.0">4.0 (Very High)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sl-bm-scriptmemory" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;color:#f59e0b;font-weight:500;">
          <span style="font-size:18px;">ğŸ’¾</span> Script Memory (KB)
        </label>
        <input id="sl-bm-scriptmemory" type="number" min="0" max="65536" placeholder="64" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(245,158,11,0.3);background:rgba(245,158,11,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="slBMCalc(this)" 
            style="flex:1;padding:14px 20px;background:linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.1));border:1px solid rgba(139,92,246,0.4);border-radius:8px;color:#8b5cf6;cursor:pointer;font-weight:600;">
      ğŸ§® Calculate All Metrics
    </button>
    <button type="button" onclick="slBMReset(this)"
            style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset All
    </button>
    <button type="button" onclick="slBMCopy(this)"
            style="padding:14px 20px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:8px;color:#10b981;cursor:pointer;">
      ğŸ“‹ Copy Results
    </button>
    <button type="button" onclick="slBMGenerateScript(this)"
            style="padding:14px 20px;background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:8px;color:#3b82f6;cursor:pointer;">
      ğŸ“œ Generate LSL Script
    </button>
  </div>
</form>

<!-- Results Dashboard -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:20px;margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 class="small" style="color:#8b5cf6;margin:0;display:flex;align-items:center;gap:8px;">
        <span style="font-size:20px;">ğŸ“Š</span> Builder's Results Dashboard
      </h3>
      <div id="sl-bm-hint" style="font-size:12px;color:rgba(230,250,255,0.7);"></div>
    </div>
    
    <!-- Quick Stats -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;margin-bottom:20px;">
      <div style="background:rgba(139,92,246,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(139,92,246,0.2);">
        <div style="font-size:24px;color:#8b5cf6;font-weight:600;" id="sl-bm-prims">â€“</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Available Prims</div>
      </div>
      <div style="background:rgba(59,130,246,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(59,130,246,0.2);">
        <div style="font-size:24px;color:#3b82f6;font-weight:600;" id="sl-bm-volume">â€“</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Volume (mÂ³)</div>
      </div>
      <div style="background:rgba(16,185,129,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(16,185,129,0.2);">
        <div style="font-size:24px;color:#10b981;font-weight:600;" id="sl-bm-weight">â€“</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Weight (kg)</div>
      </div>
      <div style="background:rgba(245,158,11,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(245,158,11,0.2);">
        <div style="font-size:24px;color:#f59e0b;font-weight:600;" id="sl-bm-li">â€“</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Land Impact</div>
      </div>
    </div>
    
    <!-- Detailed Output -->
    <textarea id="sl-bm-output" rows="12" placeholder="Click 'Calculate All Metrics' to see detailed resultsâ€¦" 
              style="width:100%;padding:16px;border-radius:8px;border:1px solid rgba(139,92,246,0.3);background:rgba(139,92,246,0.05);color:inherit;font-family:'Courier New', monospace;resize:vertical;"></textarea>
    
    <!-- Additional Actions -->
    <div style="display:flex;gap:12px;margin-top:16px;">
      <button onclick="slBMCopyResults()" style="flex:1;padding:10px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:6px;color:#10b981;cursor:pointer;">
        ğŸ“‹ Copy Results
      </button>
      <button onclick="slBMExportJSON()" style="flex:1;padding:10px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.3);border-radius:6px;color:#8b5cf6;cursor:pointer;">
        ğŸ“ Export as JSON
      </button>
      <button onclick="slBMSimulate()" style="flex:1;padding:10px;background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:6px;color:#3b82f6;cursor:pointer;">
        ğŸ® Simulate in SL
      </button>
      <button onclick="slBMPrint()" style="flex:1;padding:10px;background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:6px;color:#f59e0b;cursor:pointer;">
        ğŸ–¨ï¸ Print Report
      </button>
    </div>
  </div>

  <!-- Optimization Tips -->
  <div style="background:rgba(16,185,129,0.05);border-radius:8px;border:1px solid rgba(16,185,129,0.1);padding:16px;">
    <h4 style="color:#10b981;margin:0 0 12px 0;font-size:14px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:18px;">ğŸ’¡</span> Optimization Tips & Best Practices
    </h4>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
      <div style="background:rgba(0,0,0,0.3);border-radius:6px;padding:12px;">
        <div style="color:#8b5cf6;font-weight:600;margin-bottom:4px;font-size:13px;">ğŸ¯ Prim/LI Optimization</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);line-height:1.4;">
          â€¢ Use mesh for complex shapes<br>
          â€¢ Combine small prims into linksets<br>
          â€¢ Use lowest LOD that looks good<br>
          â€¢ Reduce physics complexity<br>
          â€¢ Optimize texture usage
        </div>
      </div>
      
      <div style="background:rgba(0,0,0,0.3);border-radius:6px;padding:12px;">
        <div style="color:#3b82f6;font-weight:600;margin-bottom:4px;font-size:13px;">ğŸ“ Building Techniques</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);line-height:1.4;">
          â€¢ Plan before building<br>
          â€¢ Use grid snapping consistently<br>
          â€¢ Check prim counts regularly<br>
          â€¢ Test at different draw distances<br>
          â€¢ Use appropriate materials
        </div>
      </div>
      
      <div style="background:rgba(0,0,0,0.3);border-radius:6px;padding:12px;">
        <div style="color:#10b981;font-weight:600;margin-bottom:4px;font-size:13px;">âš¡ Performance Tips</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);line-height:1.4;">
          â€¢ Keep triangle count low<br>
          â€¢ Use efficient UV mapping<br>
          â€¢ Minimize script usage<br>
          â€¢ Reduce particle effects<br>
          â€¢ Optimize for mobile viewers
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* Second Life Builder's Mate - Enhanced Professional Version
   - Comprehensive building toolkit for Second Life
   - All .card references kept intact
*/

// SL Building Constants
const SL_BM_CONSTANTS = {
  primRates: {
    mainland: 0.117,     // LI per mÂ²
    private: 0.229,      // LI per mÂ²
    homestead: 0.563,    // LI per mÂ²
    openspace: 0.063     // LI per mÂ²
  },
  
  tierBonuses: {
    512: 117,    // Additional LI
    1024: 234,
    2048: 468,
    4096: 937
  },
  
  materialDensities: {
    stone: 2500,
    metal: 7800,
    glass: 2500,
    wood: 500,
    flesh: 1000,
    plastic: 950,
    rubber: 1100,
    light: 100
  },
  
  lodMultipliers: {
    low: 0.125,
    medium: 0.24,
    high: 0.5,
    ultra: 1.0
  },
  
  physicsWeights: {
    none: 0.0,
    prim: 0.1,
    convex: 0.2,
    mesh: 0.5
  },
  
  maxDimensions: {
    length: 64,
    width: 64,
    height: 64
  }
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Advanced options toggle
  const toggle = document.querySelector('#sl-bm-show-advanced');
  const advanced = document.querySelector('#sl-bm-advanced-options');
  
  if (toggle && advanced) {
    toggle.addEventListener('change', function() {
      advanced.style.display = this.checked ? 'grid' : 'none';
    });
  }
  
  // Auto-populate example data for demo
  if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
    setTimeout(() => {
      document.querySelector('#sl-bm-parcel').value = 1024;
      document.querySelector('#sl-bm-length').value = 2.5;
      document.querySelector('#sl-bm-width').value = 1.2;
      document.querySelector('#sl-bm-height').value = 0.8;
      document.querySelector('#sl-bm-x').value = 15.75;
      document.querySelector('#sl-bm-y').value = 22.5;
      document.querySelector('#sl-bm-z').value = 0.5;
    }, 100);
  }
});

// Main Calculation Function
function slBMCalc(btn) {
  const card = btn.closest('.card');
  
  // Get all values
  const parcelSize = parseFloat(card.querySelector('#sl-bm-parcel').value) || 1024;
  const landType = card.querySelector('#sl-bm-landtype').value;
  const existingPrims = parseFloat(card.querySelector('#sl-bm-primcount').value) || 0;
  const tier = card.querySelector('#sl-bm-tier').value;
  const groupBonus = parseFloat(card.querySelector('#sl-bm-groupbonus').value) || 0;
  
  const length = parseFloat(card.querySelector('#sl-bm-length').value) || 2.0;
  const width = parseFloat(card.querySelector('#sl-bm-width').value) || 1.0;
  const height = parseFloat(card.querySelector('#sl-bm-height').value) || 0.5;
  const densitySelect = card.querySelector('#sl-bm-density').value;
  const density = densitySelect === 'custom' ? 
    parseFloat(card.querySelector('#sl-bm-custom-density')?.value || 500) : 
    parseFloat(densitySelect) || 500;
  
  const objectType = card.querySelector('#sl-bm-objecttype').value;
  const lod = card.querySelector('#sl-bm-lod').value;
  const physics = card.querySelector('#sl-bm-physics').value;
  const material = card.querySelector('#sl-bm-material').value;
  const textureCount = parseFloat(card.querySelector('#sl-bm-textures').value) || 1;
  
  const gridStep = card.querySelector('#sl-bm-grid').value === 'custom' ?
    parseFloat(card.querySelector('#sl-bm-custom-grid')?.value || 0.25) :
    parseFloat(card.querySelector('#sl-bm-grid').value) || 0.25;
  
  const snap = card.querySelector('#sl-bm-snap').value;
  const rotationStep = parseFloat(card.querySelector('#sl-bm-rotation').value) || 45;
  
  const xPos = parseFloat(card.querySelector('#sl-bm-x').value) || 0;
  const yPos = parseFloat(card.querySelector('#sl-bm-y').value) || 0;
  const zPos = parseFloat(card.querySelector('#sl-bm-z').value) || 0;
  
  // Advanced options
  const triangles = parseFloat(card.querySelector('#sl-bm-triangles')?.value) || 1000;
  const downloadWeight = parseFloat(card.querySelector('#sl-bm-downloadweight')?.value) || 1.0;
  const scriptMemory = parseFloat(card.querySelector('#sl-bm-scriptmemory')?.value) || 64;
  
  // Calculate metrics
  const volume = length * width * height;
  const weight = volume * density;
  
  // Land Impact Calculation
  const baseLI = parcelSize * (SL_BM_CONSTANTS.primRates[landType] || SL_BM_CONSTANTS.primRates.mainland);
  const tierBonus = SL_BM_CONSTANTS.tierBonuses[tier] || 0;
  const groupBonusLI = (baseLI * groupBonus) / 100;
  const totalAllowedLI = Math.floor(baseLI + tierBonus + groupBonusLI);
  const availableLI = Math.max(0, totalAllowedLI - existingPrims);
  
  // Object LI Calculation (simplified)
  let objectLI = 1.0; // Base LI
  
  // Adjust for object type
  if (objectType === 'mesh') objectLI *= 0.8;
  if (objectType === 'sculpt') objectLI *= 1.2;
  if (objectType === 'linkset') objectLI *= 0.9;
  
  // Adjust for LOD
  objectLI *= SL_BM_CONSTANTS.lodMultipliers[lod] || 1.0;
  
  // Adjust for physics
  objectLI += SL_BM_CONSTANTS.physicsWeights[physics] || 0;
  
  // Adjust for size (larger objects cost more)
  const sizeFactor = Math.sqrt(volume) / 10;
  objectLI *= (1 + sizeFactor);
  
  // Adjust for triangles
  if (triangles > 0) {
    const triangleFactor = Math.min(2.0, triangles / 5000);
    objectLI *= triangleFactor;
  }
  
  // Final object LI (rounded)
  objectLI = Math.max(0.5, Math.round(objectLI * 10) / 10);
  
  // How many of these objects can fit?
  const maxObjects = Math.floor(availableLI / objectLI);
  
  // Grid snapping
  const snappedX = snap === 'none' ? xPos : Math.round(xPos / gridStep) * gridStep;
  const snappedY = snap === 'none' ? yPos : Math.round(yPos / gridStep) * gridStep;
  const snappedZ = snap === 'none' ? zPos : Math.round(zPos / gridStep) * gridStep;
  
  // Generate detailed report
  let output = '='.repeat(60) + '\n';
  output += 'SECOND LIFE BUILDER\'S MATE - COMPREHENSIVE REPORT\n';
  output += '='.repeat(60) + '\n\n';
  
  output += 'ğŸï¸ PARCEL ANALYSIS:\n';
  output += `â€¢ Parcel Size: ${parcelSize} mÂ²\n`;
  output += `â€¢ Land Type: ${landType.charAt(0).toUpperCase() + landType.slice(1)}\n`;
  output += `â€¢ Base LI Allowance: ${Math.floor(baseLI)} prims\n`;
  output += `â€¢ Tier Bonus: +${tierBonus} LI\n`;
  output += `â€¢ Group Bonus: +${Math.floor(groupBonusLI)} LI (${groupBonus}%)\n`;
  output += `â€¢ Total Allowed: ${totalAllowedLI} LI\n`;
  output += `â€¢ Existing Usage: ${existingPrims} LI\n`;
  output += `â€¢ Available: ${availableLI} LI\n\n`;
  
  output += 'ğŸ“¦ OBJECT ANALYSIS:\n';
  output += `â€¢ Dimensions: ${length.toFixed(2)}m Ã— ${width.toFixed(2)}m Ã— ${height.toFixed(2)}m\n`;
  output += `â€¢ Volume: ${volume.toFixed(3)} mÂ³\n`;
  output += `â€¢ Weight: ${weight.toFixed(1)} kg (Density: ${density} kg/mÂ³)\n`;
  output += `â€¢ Object Type: ${objectType.charAt(0).toUpperCase() + objectType.slice(1)}\n`;
  output += `â€¢ Material: ${material.charAt(0).toUpperCase() + material.slice(1)}\n`;
  output += `â€¢ Estimated Land Impact: ${objectLI.toFixed(1)} LI\n`;
  output += `â€¢ Maximum Objects Possible: ${maxObjects}\n\n`;
  
  output += 'ğŸ¯ POSITIONING & GRID:\n';
  output += `â€¢ Original Position: (${xPos.toFixed(2)}, ${yPos.toFixed(2)}, ${zPos.toFixed(2)})\n`;
  output += `â€¢ Grid Step: ${gridStep}m\n`;
  output += `â€¢ Snap Mode: ${snap.charAt(0).toUpperCase() + snap.slice(1)}\n`;
  output += `â€¢ Snapped Position: (${snappedX.toFixed(2)}, ${snappedY.toFixed(2)}, ${snappedZ.toFixed(2)})\n`;
  output += `â€¢ Rotation Step: ${rotationStep}Â°\n\n`;
  
  output += 'âš¡ PERFORMANCE METRICS:\n';
  output += `â€¢ LOD Setting: ${lod.toUpperCase()}\n`;
  output += `â€¢ Physics Type: ${physics.charAt(0).toUpperCase() + physics.slice(1)}\n`;
  output += `â€¢ Texture Count: ${textureCount}\n`;
  output += `â€¢ Triangle Count: ${triangles}\n`;
  output += `â€¢ Download Weight: ${downloadWeight}\n`;
  output += `â€¢ Script Memory: ${scriptMemory} KB\n\n`;
  
  output += 'ğŸ’¡ RECOMMENDATIONS:\n';
  
  if (objectLI > 10) {
    output += 'â€¢ âš ï¸ High LI object - consider optimization\n';
  }
  
  if (volume > 50) {
    output += 'â€¢ âš ï¸ Large object - may cause lag\n';
  }
  
  if (textureCount > 4) {
    output += 'â€¢ âš ï¸ High texture count - try texture atlasing\n';
  }
  
  if (maxObjects < 5) {
    output += 'â€¢ âš ï¸ Low object count possible - optimize LI\n';
  } else {
    output += 'â€¢ âœ“ Good object efficiency\n';
  }
  
  if (physics === 'mesh' && triangles > 10000) {
    output += 'â€¢ âš ï¸ High physics triangle count - simplify\n';
  }
  
  output += '\n='.repeat(60) + '\n';
  output += `Generated: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n`;
  output += '='.repeat(60);
  
  // Update dashboard
  card.querySelector('#sl-bm-output').value = output;
  card.querySelector('#sl-bm-prims').textContent = availableLI;
  card.querySelector('#sl-bm-volume').textContent = volume.toFixed(1);
  card.querySelector('#sl-bm-weight').textContent = weight.toFixed(0);
  card.querySelector('#sl-bm-li').textContent = objectLI.toFixed(1);
  
  // Update hint
  card.querySelector('#sl-bm-hint').textContent = `âœ… Calculated for ${parcelSize}mÂ² parcel`;
  card.querySelector('#sl-bm-hint').style.color = '#10b981';
  
  // Show success notification
  showBuilderNotification('âœ… All metrics calculated successfully!', '#10b981');
}

function slBMReset(btn) {
  const card = btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#sl-bm-output').value = '';
  card.querySelector('#sl-bm-hint').textContent = '';
  
  // Reset dashboard
  card.querySelector('#sl-bm-prims').textContent = 'â€“';
  card.querySelector('#sl-bm-volume').textContent = 'â€“';
  card.querySelector('#sl-bm-weight').textContent = 'â€“';
  card.querySelector('#sl-bm-li').textContent = 'â€“';
  
  // Hide advanced options
  const advanced = card.querySelector('#sl-bm-advanced-options');
  if (advanced) advanced.style.display = 'none';
  const toggle = card.querySelector('#sl-bm-show-advanced');
  if (toggle) toggle.checked = false;
  
  showBuilderNotification('âœ… All fields reset', '#10b981');
}

function slBMCopy(btn) {
  const card = btn.closest('.card');
  const output = card.querySelector('#sl-bm-output').value;
  
  if (!output.trim()) {
    showBuilderNotification('âŒ No results to copy', '#ef4444');
    return;
  }
  
  navigator.clipboard.writeText(output)
    .then(() => {
      card.querySelector('#sl-bm-hint').textContent = 'âœ… Results copied to clipboard';
      card.querySelector('#sl-bm-hint').style.color = '#10b981';
      setTimeout(() => {
        card.querySelector('#sl-bm-hint').textContent = '';
      }, 2000);
    })
    .catch(() => {
      // Fallback
      const textArea = document.createElement('textarea');
      textArea.value = output;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      
      card.querySelector('#sl-bm-hint').textContent = 'âœ… Copied (fallback method)';
      card.querySelector('#sl-bm-hint').style.color = '#10b981';
      setTimeout(() => {
        card.querySelector('#sl-bm-hint').textContent = '';
      }, 2000);
    });
}

function slBMGenerateScript(btn) {
  const card = btn.closest('.card');
  
  const length = parseFloat(card.querySelector('#sl-bm-length').value) || 2.0;
  const width = parseFloat(card.querySelector('#sl-bm-width').value) || 1.0;
  const height = parseFloat(card.querySelector('#sl-bm-height').value) || 0.5;
  const x = parseFloat(card.querySelector('#sl-bm-x').value) || 0;
  const y = parseFloat(card.querySelector('#sl-bm-y').value) || 0;
  const z = parseFloat(card.querySelector('#sl-bm-z').value) || 0;
  
  const lslScript = `// Generated by Builder's Mate
// LSL Script for Object Placement
// Generated: ${new Date().toLocaleDateString()}

default
{
    state_entry()
    {
        // Set object dimensions
        llSetScale(<${length.toFixed(3)}, ${width.toFixed(3)}, ${height.toFixed(3)}>);
        
        // Set object position
        llSetRegionPos(<${x.toFixed(3)}, ${y.toFixed(3)}, ${z.toFixed(3)}>);
        
        // Set object description with metrics
        llSetObjectDesc("Dimensions: ${length.toFixed(2)}x${width.toFixed(2)}x${height.toFixed(2)}m");
        
        // Notify owner
        llOwnerSay("Object placed at position: " + (string)llGetPos());
        llOwnerSay("Object scale: " + (string)llGetScale());
    }
    
    touch_start(integer num_detected)
    {
        llSay(0, "Object Info:\\nScale: " + (string)llGetScale() + "\\nPos: " + (string)llGetPos());
    }
}`;

  card.querySelector('#sl-bm-output').value = lslScript;
  showBuilderNotification('âœ… LSL script generated!', '#3b82f6');
}

function slBMCopyResults() {
  slBMCopy(document.querySelector('.actions button[onclick*="slBMCopy"]'));
}

function slBMExportJSON() {
  const card = document.querySelector('.card');
  const output = card.querySelector('#sl-bm-output').value;
  
  if (!output.trim()) {
    showBuilderNotification('âŒ No results to export', '#ef4444');
    return;
  }
  
  const exportData = {
    timestamp: new Date().toISOString(),
    analysis: output,
    metrics: {
      prims: card.querySelector('#sl-bm-prims').textContent,
      volume: card.querySelector('#sl-bm-volume').textContent,
      weight: card.querySelector('#sl-bm-weight').textContent,
      li: card.querySelector('#sl-bm-li').textContent
    }
  };
  
  const json = JSON.stringify(exportData, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `sl-builder-report-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showBuilderNotification('âœ… Exported as JSON', '#8b5cf6');
}

function slBMSimulate() {
  showBuilderNotification('ğŸ® Simulation would run here in a full implementation', '#3b82f6');
}

function slBMPrint() {
  const card = document.querySelector('.card');
  const output = card.querySelector('#sl-bm-output').value;
  
  if (!output.trim()) {
    showBuilderNotification('âŒ No results to print', '#ef4444');
    return;
  }
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Second Life Builder's Report</title>
      <style>
        body { font-family: 'Courier New', monospace; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .title { font-size: 24px; font-weight: bold; color: #8b5cf6; }
        .date { color: #666; margin-bottom: 20px; }
        pre { white-space: pre-wrap; background: #f5f5f5; padding: 20px; border-radius: 8px; }
        @media print { body { margin: 0; } }
      </style>
    </head>
    <body>
      <div class="header">
        <div class="title">Second Life Builder's Report</div>
        <div class="date">Printed: ${new Date().toLocaleDateString()}</div>
      </div>
      <pre>${output}</pre>
      <script>
        setTimeout(() => { window.print(); window.close(); }, 500);
      <\/script>
    </body>
    </html>
  `);
  
  printWindow.document.close();
  showBuilderNotification('âœ… Opening print preview...', '#f59e0b');
}

// Helper Functions
function showBuilderNotification(message, color) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${color};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    animation: slideIn 0.3s ease;
  `;
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .actions {
      flex-direction: column;
    }
    
    .actions button {
      width: 100%;
      margin: 4px 0 !important;
    }
    
    .results > div:first-child > div:first-child {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
`;
document.head.appendChild(style);
</script>
