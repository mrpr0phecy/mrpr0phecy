<h2 id="habit-title" style="margin-top:0;">Habit Tracker</h2>

<form aria-describedby="habit-desc">
  <p id="habit-desc" class="small">Track daily habits and build streaks.</p>

  <div class="row">
    <div class="field">
      <label for="habit-name">Habit name</label>
      <input id="habit-name" type="text" placeholder="e.g. Morning run" />
    </div>
    <div class="field">
      <label for="habit-date">Date</label>
      <input id="habit-date" type="date" />
    </div>
  </div>

  <div class="actions">
    <button type="button" onclick="habitAdd(this)">Log Habit</button>
    <button type="button" class="secondary" onclick="habitReset(this)">Reset</button>
  </div>
</form>

<div class="results" aria-live="polite">
  <h3 class="small">Habit log</h3>
  <ul id="habit-list" class="small"></ul>
</div>

<script>
let habits = [];

function habitAdd(btn) {
  const card = btn.closest('.card');
  const name = card.querySelector('#habit-name').value.trim();
  const date = card.querySelector('#habit-date').value;

  if (!name || !date) return;

  habits.push({ name, date });
  renderHabits(card);
  card.querySelector('form').reset();
}

function renderHabits(card) {
  const list = card.querySelector('#habit-list');
  list.innerHTML = "";

  // Group by habit name
  const grouped = {};
  habits.forEach(h => {
    if (!grouped[h.name]) grouped[h.name] = [];
    grouped[h.name].push(h.date);
  });

  for (const [name, dates] of Object.entries(grouped)) {
    dates.sort();
    const streak = calcStreak(dates);
    const li = document.createElement('li');
    li.textContent = name + " â€” " + dates.length + " logs, current streak: " + streak + " days";
    list.appendChild(li);
  }
}

function calcStreak(dates) {
  let streak = 1;
  for (let i = dates.length - 1; i > 0; i--) {
    const d1 = new Date(dates[i]);
    const d0 = new Date(dates[i - 1]);
    const diff = (d1 - d0) / (1000 * 60 * 60 * 24);
    if (diff === 1) streak++;
    else break;
  }
  return streak;
}

function habitReset(btn) {
  const card = btn.closest('.card');
  habits = [];
  card.querySelector('form').reset();
  card.querySelector('#habit-list').innerHTML = "";
}
</script>
