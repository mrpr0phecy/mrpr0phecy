<h2 id="lab-planner-title" style="margin-top:0;">Lab Planner</h2>

<form aria-describedby="lab-planner-desc">
  <p id="lab-planner-desc" class="small">Plan lab experiments by organizing materials, steps, and timing. Enter details and generate a structured plan.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr;gap:15px;">
    <div class="field">
      <label for="lab-materials">Materials <span style="color:#4fc3f7;font-size:0.9em;">(comma separated)</span></label>
      <input id="lab-materials" type="text" placeholder="e.g. beaker, water, salt, thermometer" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">Enter all materials separated by commas</div>
    </div>

    <div class="field">
      <label for="lab-steps">Steps <span style="color:#4fc3f7;font-size:0.9em;">(one per line)</span></label>
      <textarea id="lab-steps" rows="4" placeholder="e.g. 1. Measure 100ml water
2. Add 10g salt
3. Heat to 60°C
4. Record observations" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;resize:vertical;"></textarea>
      <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">Number your steps for clarity</div>
    </div>

    <div class="field" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
      <div>
        <label for="lab-time">Estimated Time (minutes)</label>
        <input id="lab-time" type="number" min="1" max="480" placeholder="e.g. 30" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
        <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">1-480 minutes</div>
      </div>
      <div>
        <label for="lab-show-summary">Show summary</label>
        <select id="lab-show-summary" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
          <option value="yes" selected>Yes</option>
          <option value="no">No</option>
        </select>
        <div class="hint" style="font-size:12px;color:#90caf9;margin-top:4px;">Include summary in plan</div>
      </div>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
    <button type="button" onclick="labGenerate(this)" style="flex:1;padding:12px 20px;background:linear-gradient(135deg, #1976d2, #0d47a1);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-flask" style="margin-right:8px;"></i>Generate Plan
    </button>
    <button type="button" class="secondary" onclick="labReset(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-redo" style="margin-right:8px;"></i>Reset
    </button>
    <button type="button" onclick="labCopy(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="far fa-copy" style="margin-right:8px;"></i>Copy Plan
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:25px;padding:20px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
    <h3 class="small" style="margin:0;font-size:16px;font-weight:600;color:#bbdefb;">
      <i class="fas fa-clipboard-list" style="margin-right:8px;"></i>Lab Plan
    </h3>
    <div id="lab-status" style="font-size:12px;padding:4px 10px;border-radius:12px;background:rgba(25,118,210,0.2);color:#64b5f6;"></div>
  </div>
  
  <textarea id="lab-output" rows="10" style="width:100%;padding:15px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.2);color:#e0f2fe;font-family:'Courier New',monospace;font-size:13px;line-height:1.5;resize:vertical;"></textarea>

  <div style="margin-top:15px;display:flex;justify-content:space-between;align-items:center;">
    <div id="lab-hint" class="small" style="opacity:0.9;font-size:13px;color:#90caf9;"></div>
    <div id="lab-stats" style="font-size:12px;color:#64b5f6;display:none;">
      <span id="material-count">0</span> materials • 
      <span id="step-count">0</span> steps • 
      <span id="time-value">0</span> min
    </div>
  </div>
</div>

<script>
/* lab-planner.html
   - Generates structured lab experiment plans
   - Scoped with lab- prefix
*/

function labReset(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  card.querySelector('form').reset();
  card.querySelector('#lab-output').value = "";
  card.querySelector('#lab-hint').textContent = "";
  card.querySelector('#lab-status').textContent = "";
  card.querySelector('#lab-stats').style.display = "none";
  
  // Reset validation styles
  const inputs = card.querySelectorAll('input, textarea');
  inputs.forEach(input => {
    input.style.borderColor = 'rgba(255,255,255,0.15)';
    input.style.boxShadow = 'none';
  });
}

function labCopy(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  const out = card.querySelector('#lab-output').value;
  if(!out.trim()){
    labShowHint(card, "No plan to copy", "warning");
    return;
  }
  
  navigator.clipboard?.writeText(out).then(() => {
    labShowHint(card, "✓ Copied to clipboard", "success");
    setTimeout(() => {
      const hint = card.querySelector('#lab-hint');
      if(hint.textContent.includes("Copied")) hint.textContent = "";
    }, 2000);
  }).catch(() => {
    // Fallback for older browsers
    const textarea = card.querySelector('#lab-output');
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    try {
      document.execCommand('copy');
      labShowHint(card, "✓ Copied to clipboard", "success");
    } catch(err) {
      labShowHint(card, "Copy failed - select and copy manually", "error");
    }
  });
}

function labGenerate(btn){
  const card = btn.closest('.card');
  if (!card) return;
  
  const materialsInput = card.querySelector('#lab-materials');
  const stepsInput = card.querySelector('#lab-steps');
  const timeInput = card.querySelector('#lab-time');
  
  const materials = materialsInput.value.trim();
  const steps = stepsInput.value.trim();
  const time = parseInt(timeInput.value);
  const showSummary = card.querySelector('#lab-show-summary').value === "yes";
  
  // Reset validation
  [materialsInput, stepsInput, timeInput].forEach(input => {
    input.style.borderColor = 'rgba(255,255,255,0.15)';
    input.style.boxShadow = 'none';
  });
  
  // Validate inputs
  let isValid = true;
  let errorMessage = "";
  
  if(!materials){
    materialsInput.style.borderColor = '#f44336';
    materialsInput.style.boxShadow = '0 0 0 1px rgba(244, 67, 54, 0.3)';
    isValid = false;
    errorMessage = "Please enter materials";
  }
  
  if(!steps){
    stepsInput.style.borderColor = '#f44336';
    stepsInput.style.boxShadow = '0 0 0 1px rgba(244, 67, 54, 0.3)';
    isValid = false;
    errorMessage = errorMessage ? "Please enter materials and steps" : "Please enter steps";
  }
  
  if(isNaN(time) || time < 1 || time > 480){
    timeInput.style.borderColor = '#f44336';
    timeInput.style.boxShadow = '0 0 0 1px rgba(244, 67, 54, 0.3)';
    isValid = false;
    errorMessage = errorMessage ? "Please check all fields" : "Please enter a valid time (1-480 minutes)";
  }
  
  if(!isValid){
    labShowHint(card, errorMessage, "error");
    return;
  }
  
  // Process materials into list
  const materialsList = materials.split(',')
    .map(item => item.trim())
    .filter(item => item.length > 0);
  
  // Process steps
  const stepsList = steps.split('\n')
    .map(step => step.trim())
    .filter(step => step.length > 0);
  
  // Generate output
  let output = "=== LAB EXPERIMENT PLAN ===\n\n";
  output += "MATERIALS REQUIRED:\n";
  materialsList.forEach((item, index) => {
    output += `  ${index + 1}. ${item}\n`;
  });
  
  output += "\nPROCEDURE:\n";
  stepsList.forEach((step, index) => {
    // Add numbering if not already numbered
    const stepText = step.match(/^\d+[\.\)]\s*/) ? step : `${index + 1}. ${step}`;
    output += `  ${stepText}\n`;
  });
  
  output += `\nTIME ESTIMATE: ${time} minutes\n`;
  
  if(showSummary){
    const materialCount = materialsList.length;
    const stepCount = stepsList.length;
    const timeEstimate = time < 60 ? `${time} minutes` : 
                         time === 60 ? `1 hour` : 
                         `${Math.floor(time/60)} hour${Math.floor(time/60) > 1 ? 's' : ''} and ${time % 60} minutes`;
    
    output += `\nSUMMARY:\n`;
    output += `  • Materials: ${materialCount} item${materialCount !== 1 ? 's' : ''}\n`;
    output += `  • Steps: ${stepCount}\n`;
    output += `  • Estimated duration: ${timeEstimate}\n`;
    output += `  • Complexity: ${stepCount < 5 ? 'Simple' : stepCount < 10 ? 'Moderate' : 'Complex'}`;
  }
  
  output += "\n\n=== END OF PLAN ===";
  
  card.querySelector('#lab-output').value = output;
  card.querySelector('#lab-status').textContent = "Plan Generated";
  card.querySelector('#lab-status').style.background = "rgba(76, 175, 80, 0.2)";
  card.querySelector('#lab-status').style.color = "#81c784";
  
  // Update stats
  const stats = card.querySelector('#lab-stats');
  stats.style.display = "flex";
  card.querySelector('#material-count').textContent = materialsList.length;
  card.querySelector('#step-count').textContent = stepsList.length;
  card.querySelector('#time-value').textContent = time;
  
  labShowHint(card, "✓ Lab plan generated successfully", "success");
}

function labShowHint(card, message, type){
  const hint = card.querySelector('#lab-hint');
  const status = card.querySelector('#lab-status');
  
  hint.textContent = message;
  status.textContent = type === "success" ? "Ready" : 
                       type === "error" ? "Error" : 
                       type === "warning" ? "Warning" : "";
  
  if(type === "success"){
    hint.style.color = "#81c784";
    status.style.background = "rgba(76, 175, 80, 0.2)";
    status.style.color = "#81c784";
  } else if(type === "error"){
    hint.style.color = "#ef9a9a";
    status.style.background = "rgba(244, 67, 54, 0.2)";
    status.style.color = "#ef9a9a";
  } else if(type === "warning"){
    hint.style.color = "#fff59d";
    status.style.background = "rgba(255, 193, 7, 0.2)";
    status.style.color = "#fff59d";
  }
  
  // Clear hint after 3 seconds if it's a success message
  if(type === "success"){
    setTimeout(() => {
      if(hint.textContent === message) hint.textContent = "";
    }, 3000);
  }
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
  // This would be added to the page where the card exists
  const card = document.querySelector('.card');
  if(card) {
    const timeInput = card.querySelector('#lab-time');
    if(timeInput) {
      timeInput.addEventListener('input', function() {
        const value = parseInt(this.value);
        if(value > 480) this.value = 480;
        if(value < 1 && this.value !== '') this.value = 1;
      });
    }
    
    const materialsInput = card.querySelector('#lab-materials');
    if(materialsInput) {
      materialsInput.addEventListener('input', function() {
        this.style.borderColor = 'rgba(255,255,255,0.15)';
        this.style.boxShadow = 'none';
      });
    }
    
    const stepsInput = card.querySelector('#lab-steps');
    if(stepsInput) {
      stepsInput.addEventListener('input', function() {
        this.style.borderColor = 'rgba(255,255,255,0.15)';
        this.style.boxShadow = 'none';
      });
    }
  }
});
</script>
