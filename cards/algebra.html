<h2 id="algebra-title">Algebra Solver</h2>

<form id="alg-form" onsubmit="event.preventDefault(); algSolve();">
  <p class="card-description">Solve algebraic equations instantly. Supports linear, quadratic, and various formats.</p>
  
  <div class="input-section">
    <label for="alg-equation">Equation (use 'x' as variable)</label>
    <input type="text" id="alg-equation" 
           placeholder="e.g., 2x + 5 = 13, x¬≤ - 4 = 0, 3(x-2) = 2x+1"
           autocomplete="off"
           style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.05);color:#e6faff;font-size:16px;margin:8px 0;">
    
    <div class="equation-examples" style="margin:8px 0 16px;color:rgba(230,250,255,0.7);font-size:14px;">
      Examples: <code>2x + 5 = 13</code> ‚Ä¢ <code>x^2 - 9 = 0</code> ‚Ä¢ <code>3x - 7 = 2</code> ‚Ä¢ <code>2(x+1) = 3x-4</code>
    </div>
  </div>
  
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:16px 0;">
    <div>
      <label for="alg-type" style="display:block;margin-bottom:6px;">Equation Type</label>
      <select id="alg-type" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#e6faff;">
        <option value="auto" selected>Auto-detect</option>
        <option value="linear">Linear (ax + b = c)</option>
        <option value="quadratic">Quadratic (ax¬≤ + bx + c = 0)</option>
      </select>
    </div>
    
    <div>
      <label for="alg-show-steps" style="display:block;margin-bottom:6px;">Show Steps</label>
      <select id="alg-show-steps" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#e6faff;">
        <option value="yes" selected>Yes - Show detailed steps</option>
        <option value="no">No - Show answer only</option>
      </select>
    </div>
  </div>
  
  <div class="actions" style="display:flex;gap:12px;margin:20px 0;">
    <button type="submit" 
            style="flex:1;background:#2dd4ff;color:#000;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;">
      <span style="display:inline-flex;align-items:center;gap:6px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
        Solve Equation
      </span>
    </button>
    
    <button type="button" onclick="algReset()"
            style="background:rgba(255,255,255,0.08);color:#e6faff;border:1px solid rgba(255,255,255,0.15);padding:12px 20px;border-radius:8px;cursor:pointer;">
      Clear
    </button>
  </div>
</form>

<div class="results-section" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 style="color:#2dd4ff;margin:0;">Solution</h3>
    <div id="alg-status" style="font-size:14px;color:rgba(230,250,255,0.7);">
      <span id="alg-steps-indicator">‚Äì</span>
      <button onclick="algCopySolution()" 
              style="margin-left:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:4px 10px;border-radius:4px;cursor:pointer;font-size:13px;">
        üìã Copy
      </button>
    </div>
  </div>
  
  <div id="alg-output" 
       style="min-height:180px;max-height:400px;overflow-y:auto;padding:16px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(13,17,23,0.7);color:#c9d1d9;font-family:monospace;white-space:pre-wrap;line-height:1.5;">
    <div style="color:rgba(230,250,255,0.6);text-align:center;padding:40px 0;">
      Enter an equation above to see the solution...
    </div>
  </div>
  
  <div id="alg-hint" style="margin-top:12px;padding:10px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);color:#2dd4ff;font-size:14px;display:none;">
    <span id="hint-text"></span>
  </div>
</div>

<script>
// Robust Algebra Solver with enhanced parsing
function algParseEquation(equation) {
  // Normalize equation
  let eq = equation.trim()
    .replace(/\s+/g, '')
    .toLowerCase()
    .replace(/x\^2/g, 'x¬≤')
    .replace(/\*\*/g, '^')
    .replace(/(\d)\(/g, '$1*(')
    .replace(/\)(\d)/g, ')*$1')
    .replace(/\)x/g, ')*x')
    .replace(/x\(/g, 'x*(');
  
  // Handle implicit multiplication
  eq = eq.replace(/(\d)x/g, '$1*x').replace(/x(\d)/g, 'x*$1');
  
  // Split by equals sign
  const sides = eq.split('=');
  if (sides.length !== 2) {
    throw new Error('Equation must contain exactly one equals sign (=)');
  }
  
  // Function to evaluate a side
  const evaluateSide = (side) => {
    // Handle subtraction by adding + signs
    side = side.replace(/([+-])/g, ',$1');
    const terms = side.split(',').filter(t => t);
    
    let a = 0, b = 0, c = 0; // ax¬≤ + bx + c
    
    for (let term of terms) {
      if (!term) continue;
      
      let sign = 1;
      if (term[0] === '+') {
        term = term.substring(1);
      } else if (term[0] === '-') {
        sign = -1;
        term = term.substring(1);
      }
      
      // Check what type of term
      if (term.includes('x¬≤')) {
        const coeff = term.replace('x¬≤', '') || '1';
        a += sign * parseFloat(coeff);
      } else if (term.includes('x*x')) {
        const coeff = term.replace('x*x', '') || '1';
        a += sign * parseFloat(coeff);
      } else if (term.includes('x')) {
        const coeff = term.replace('x', '') || '1';
        b += sign * parseFloat(coeff);
      } else {
        c += sign * parseFloat(term);
      }
    }
    
    return { a, b, c };
  };
  
  const left = evaluateSide(sides[0]);
  const right = evaluateSide(sides[1]);
  
  // Move everything to left side: left - right = 0
  return {
    a: left.a - right.a,
    b: left.b - right.b,
    c: left.c - right.c,
    original: equation
  };
}

function algFormatNumber(num) {
  if (Math.abs(num) < 1e-10) return '0';
  if (Math.abs(num - Math.round(num)) < 1e-9) {
    return Math.round(num).toString();
  }
  // Show up to 8 decimal places if needed
  const str = num.toFixed(8).replace(/\.?0+$/, '');
  return str.length > 12 ? num.toExponential(4) : str;
}

function algFormatTerm(coeff, variable) {
  if (Math.abs(coeff) < 1e-10) return '';
  const sign = coeff >= 0 ? '+' : '-';
  const absVal = Math.abs(coeff);
  const num = algFormatNumber(absVal);
  
  if (variable === '') {
    return `${sign} ${num}`;
  }
  return `${sign} ${num === '1' ? '' : num}${variable}`;
}

function algSolve() {
  const equationInput = document.getElementById('alg-equation').value.trim();
  const typeSelect = document.getElementById('alg-type').value;
  const showSteps = document.getElementById('alg-show-steps').value === 'yes';
  const outputDiv = document.getElementById('alg-output');
  const hintDiv = document.getElementById('alg-hint');
  const hintText = document.getElementById('hint-text');
  
  // Clear previous state
  hintDiv.style.display = 'none';
  outputDiv.style.color = '#c9d1d9';
  
  if (!equationInput) {
    outputDiv.innerHTML = '<div style="color:rgba(255,77,77,0.8);text-align:center;padding:20px;">Please enter an equation to solve</div>';
    return;
  }
  
  try {
    // Parse the equation
    const { a, b, c, original } = algParseEquation(equationInput);
    
    // Determine equation type if auto
    let equationType = typeSelect;
    if (typeSelect === 'auto') {
      equationType = Math.abs(a) > 1e-10 ? 'quadratic' : 'linear';
    }
    
    const steps = [];
    const results = [];
    
    // Add initial step
    steps.push(`üìù Original equation: ${original}`);
    steps.push(`üîç Simplified form: ${algFormatTerm(a, 'x¬≤').replace('+ ', '')}${algFormatTerm(b, 'x')}${algFormatTerm(c, '')} = 0`);
    
    if (equationType === 'linear') {
      if (Math.abs(a) > 1e-10) {
        results.push('‚ö†Ô∏è This appears to be a quadratic equation (contains x¬≤).');
        results.push('Switch to Quadratic mode or use Auto-detect for accurate solution.');
        equationType = 'quadratic'; // Switch for calculation
      } else {
        steps.push(`üìê Equation type: Linear (degree 1)`);
        
        if (Math.abs(b) < 1e-10) {
          if (Math.abs(c) < 1e-10) {
            results.push('‚úÖ Identity: True for all real numbers x');
            steps.push('0 = 0 ‚Üí The equation is always true');
          } else {
            results.push('‚ùå Contradiction: No solution');
            steps.push(`${algFormatNumber(c)} = 0 ‚Üí Impossible, no solution`);
          }
        } else {
          const solution = -c / b;
          results.push(`‚úÖ Solution: x = ${algFormatNumber(solution)}`);
          
          steps.push(`‚û°Ô∏è Move constant to right: ${algFormatNumber(b)}x = ${algFormatNumber(-c)}`);
          steps.push(`‚û°Ô∏è Divide by ${algFormatNumber(b)}: x = ${algFormatNumber(-c)} √∑ ${algFormatNumber(b)}`);
          steps.push(`‚úÖ Result: x = ${algFormatNumber(solution)}`);
          
          // Verification
          steps.push(`üîç Verification: ${algFormatNumber(b)} √ó ${algFormatNumber(solution)} + ${algFormatNumber(c)} = ${algFormatNumber(b * solution + c)}`);
        }
      }
    }
    
    if (equationType === 'quadratic') {
      steps.push(`üìê Equation type: Quadratic (degree 2)`);
      
      if (Math.abs(a) < 1e-10) {
        results.push('‚ö†Ô∏è This is actually a linear equation (no x¬≤ term).');
        results.push('Using linear solution method...');
        equationType = 'linear';
      } else {
        const discriminant = b * b - 4 * a * c;
        steps.push(`üìä Discriminant (Œî) = b¬≤ - 4ac = ${algFormatNumber(b)}¬≤ - 4√ó${algFormatNumber(a)}√ó${algFormatNumber(c)}`);
        steps.push(`üìä Œî = ${algFormatNumber(discriminant)}`);
        
        if (discriminant > 0) {
          const sqrtD = Math.sqrt(discriminant);
          const x1 = (-b + sqrtD) / (2 * a);
          const x2 = (-b - sqrtD) / (2 * a);
          
          results.push(`‚úÖ Two distinct real solutions:`);
          results.push(`x‚ÇÅ = ${algFormatNumber(x1)}`);
          results.push(`x‚ÇÇ = ${algFormatNumber(x2)}`);
          
          steps.push(`‚û°Ô∏è Œî > 0 ‚Üí Two real roots`);
          steps.push(`‚û°Ô∏è x‚ÇÅ = (-b + ‚àöŒî)/(2a) = (${algFormatNumber(-b)} + ${algFormatNumber(sqrtD)})/(2√ó${algFormatNumber(a)})`);
          steps.push(`‚û°Ô∏è x‚ÇÇ = (-b - ‚àöŒî)/(2a) = (${algFormatNumber(-b)} - ${algFormatNumber(sqrtD)})/(2√ó${algFormatNumber(a)})`);
        } else if (Math.abs(discriminant) < 1e-10) {
          const x = -b / (2 * a);
          results.push(`‚úÖ One real solution (double root):`);
          results.push(`x = ${algFormatNumber(x)}`);
          
          steps.push(`‚û°Ô∏è Œî = 0 ‚Üí One repeated root`);
          steps.push(`‚û°Ô∏è x = -b/(2a) = ${algFormatNumber(-b)}/(2√ó${algFormatNumber(a)})`);
        } else {
          const real = -b / (2 * a);
          const imag = Math.sqrt(-discriminant) / (2 * a);
          
          results.push(`‚úÖ Two complex solutions:`);
          results.push(`x‚ÇÅ = ${algFormatNumber(real)} + ${algFormatNumber(imag)}i`);
          results.push(`x‚ÇÇ = ${algFormatNumber(real)} - ${algFormatNumber(imag)}i`);
          
          steps.push(`‚û°Ô∏è Œî < 0 ‚Üí Two complex conjugate roots`);
          steps.push(`‚û°Ô∏è Real part = -b/(2a) = ${algFormatNumber(real)}`);
          steps.push(`‚û°Ô∏è Imaginary part = ‚àö(-Œî)/(2a) = ${algFormatNumber(imag)}`);
        }
      }
    }
    
    // Display results
    const stepsHTML = steps.map(step => 
      `<div style="margin-bottom:8px;padding-left:12px;border-left:2px solid rgba(45,212,255,0.5);">${step}</div>`
    ).join('');
    
    const resultsHTML = results.map(result => 
      `<div style="margin:6px 0;${result.includes('‚úÖ') ? 'color:#39ff14;' : result.includes('‚ö†Ô∏è') ? 'color:#ffa500;' : 'color:#ff4d4d;'}">${result}</div>`
    ).join('');
    
    outputDiv.innerHTML = showSteps ? 
      `${stepsHTML}<div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.1);"><strong>Final Answer:</strong>${resultsHTML}</div>` :
      `<div style="font-size:16px;line-height:1.6;">${resultsHTML}</div>`;
    
    // Show hint
    if (results.some(r => r.includes('‚úÖ'))) {
      hintText.textContent = '‚úì Equation solved successfully!';
      hintDiv.style.background = 'rgba(57,255,20,0.1)';
      hintDiv.style.borderColor = 'rgba(57,255,20,0.3)';
      hintDiv.style.color = '#39ff14';
      hintDiv.style.display = 'block';
    } else if (results.some(r => r.includes('‚ö†Ô∏è'))) {
      hintText.textContent = 'Note: Check equation type or formatting';
      hintDiv.style.background = 'rgba(255,165,0,0.1)';
      hintDiv.style.borderColor = 'rgba(255,165,0,0.3)';
      hintDiv.style.color = '#ffa500';
      hintDiv.style.display = 'block';
    }
    
    document.getElementById('alg-steps-indicator').textContent = showSteps ? 'Detailed steps shown' : 'Answer only';
    
  } catch (error) {
    outputDiv.innerHTML = `
      <div style="color:#ff4d4d;margin-bottom:12px;">‚ùå Error: ${error.message}</div>
      <div style="background:rgba(255,77,77,0.1);padding:12px;border-radius:6px;border-left:3px solid #ff4d4d;">
        <strong>Tips for entering equations:</strong>
        <ul style="margin:8px 0 0 20px;">
          <li>Use 'x' as the variable (e.g., 2x + 3 = 7)</li>
          <li>For powers, use 'x¬≤' or 'x^2' (e.g., x¬≤ - 9 = 0)</li>
          <li>Include the equals sign (=)</li>
          <li>Use parentheses for grouping: 2(x+1) = 3x</li>
          <li>Examples: 
            <code style="margin-left:8px;">3x - 5 = 10</code>
            <code style="margin-left:8px;">x^2 + 2x + 1 = 0</code>
            <code style="margin-left:8px;">2(x-3) = x+4</code>
          </li>
        </ul>
      </div>
    `;
    
    hintText.textContent = 'Unable to parse equation. Check format above.';
    hintDiv.style.background = 'rgba(255,77,77,0.1)';
    hintDiv.style.borderColor = 'rgba(255,77,77,0.3)';
    hintDiv.style.color = '#ff4d4d';
    hintDiv.style.display = 'block';
  }
}

function algReset() {
  document.getElementById('alg-equation').value = '';
  document.getElementById('alg-type').value = 'auto';
  document.getElementById('alg-show-steps').value = 'yes';
  document.getElementById('alg-output').innerHTML = '<div style="color:rgba(230,250,255,0.6);text-align:center;padding:40px 0;">Enter an equation above to see the solution...</div>';
  document.getElementById('alg-hint').style.display = 'none';
  document.getElementById('alg-steps-indicator').textContent = '‚Äì';
  document.getElementById('alg-equation').focus();
}

function algCopySolution() {
  const output = document.getElementById('alg-output');
  const text = output.innerText || output.textContent;
  
  if (!text || text.includes('Enter an equation')) return;
  
  navigator.clipboard.writeText(text).then(() => {
    const hintDiv = document.getElementById('alg-hint');
    hintDiv.style.display = 'block';
    hintDiv.style.background = 'rgba(45,212,255,0.1)';
    hintDiv.style.borderColor = 'rgba(45,212,255,0.3)';
    hintDiv.style.color = '#2dd4ff';
    document.getElementById('hint-text').textContent = '‚úì Solution copied to clipboard!';
    
    setTimeout(() => {
      if (hintDiv.style.display === 'block') {
        hintDiv.style.display = 'none';
      }
    }, 2000);
  });
}

// Enter key support
document.getElementById('alg-equation').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    algSolve();
  }
});

// Auto-focus on card load
setTimeout(() => {
  document.getElementById('alg-equation')?.focus();
}, 100);
</script></script>
