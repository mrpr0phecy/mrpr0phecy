<h2 id="algebra-title">Algebra Solver</h2>

<div style="color: rgba(230,250,255,0.8); margin: 10px 0 20px 0; font-size: 15px;">
  Solve equations with clarity. See every step, understand every transformation.
</div>

<!-- üéØ EQUATION BUILDER -->
<div class="equation-builder" style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
  <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
    <div style="color: #e6faff; font-size: 16px;">Equation:</div>
    
    <div style="display: flex; align-items: center; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px 15px; border: 1px solid rgba(255,255,255,0.1);">
      <input type="text" id="eq-left" placeholder="Enter left side" 
             style="background:none; border:none; color:#e6faff; font-size:16px; width:150px; outline:none;"
             value="2x + 5">
      <span style="color:#2dd4ff; font-weight:bold; margin:0 12px;">=</span>
      <input type="text" id="eq-right" placeholder="Enter right side" 
             style="background:none; border:none; color:#e6faff; font-size:16px; width:80px; outline:none;"
             value="13">
    </div>
    
    <button onclick="solveEquation()" 
            style="background:#2dd4ff; color:#000; border:none; padding:12px 24px; border-radius:8px; font-weight:600; cursor:pointer;">
      Solve
    </button>
    
    <button onclick="clearEquation()" 
            style="background:rgba(255,255,255,0.08); color:#e6faff; border:1px solid rgba(255,255,255,0.2); padding:12px 20px; border-radius:8px; cursor:pointer;">
      Clear
    </button>
  </div>
  
  <!-- üîß QUICK EQUATIONS -->
  <div style="margin-top: 15px; color: rgba(230,250,255,0.7); font-size: 14px;">
    <div style="margin-bottom: 8px;">Try:</div>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <span onclick="setQuickEq('2x + 5 = 13')" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">2x + 5 = 13</span>
      <span onclick="setQuickEq('3x - 7 = 2x + 1')" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">3x - 7 = 2x + 1</span>
      <span onclick="setQuickEq('x¬≤ - 9 = 0')" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">x¬≤ - 9 = 0</span>
      <span onclick="setQuickEq('2x¬≤ + 3x - 2 = 0')" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">2x¬≤ + 3x - 2 = 0</span>
      <span onclick="setQuickEq('4(x-2) = 2x + 12')" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">4(x-2) = 2x + 12</span>
    </div>
  </div>
</div>

<!-- üìä SOLUTION PANEL -->
<div id="solution-panel" style="display: none;">
  <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
    <div style="color: #39ff14; font-size: 18px; font-weight: 600;">Solution Found</div>
    <button onclick="copySolution()" 
            style="background:rgba(57,255,20,0.1); color:#39ff14; border:1px solid rgba(57,255,20,0.3); padding:8px 16px; border-radius:6px; cursor:pointer; font-size:14px;">
      Copy Solution
    </button>
  </div>
  
  <!-- üéØ ANSWER -->
  <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2); margin-bottom: 25px;">
    <div style="font-size: 24px; font-weight: 600; color: #39ff14; text-align: center; margin-bottom: 20px;" id="final-answer">
      x = 4
    </div>
    
    <!-- üìà EQUATION VISUALIZATION -->
    <div style="margin-bottom: 25px;">
      <div style="color: #2dd4ff; margin-bottom: 10px; font-size: 15px;">Equation Balance:</div>
      <div id="balance-visual" style="display: flex; align-items: center; justify-content: center; gap: 20px; padding: 15px; background: rgba(30,30,30,0.5); border-radius: 8px;">
        <!-- Will be filled by JavaScript -->
      </div>
    </div>
    
    <!-- üìù STEP-BY-STEP -->
    <div>
      <div style="color: #2dd4ff; margin-bottom: 15px; font-size: 15px;">Step-by-Step Solution:</div>
      <div id="solution-steps" style="line-height: 1.6; color: #e6faff;">
        <!-- Steps will be filled here -->
      </div>
    </div>
  </div>
  
  <!-- üî¨ ANALYSIS -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
    <div style="color: #2dd4ff; margin-bottom: 15px; font-size: 15px;">Equation Analysis:</div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Type:</div>
        <div style="color: #e6faff; font-weight: 500;" id="eq-type">Linear</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Degree:</div>
        <div style="color: #e6faff; font-weight: 500;" id="eq-degree">1</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Solution Count:</div>
        <div style="color: #e6faff; font-weight: 500;" id="solution-count">1</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Verified:</div>
        <div style="color: #39ff14; font-weight: 500;" id="verified-status">‚úì Yes</div>
      </div>
    </div>
  </div>
</div>

<!-- üö® ERROR PANEL -->
<div id="error-panel" style="display: none; background: rgba(255,77,77,0.1); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,77,77,0.3); margin-top: 20px;">
  <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 10px;">Unable to Solve</div>
  <div id="error-message" style="color: rgba(255,77,77,0.9); margin-bottom: 15px;">
    Please check your equation format.
  </div>
  <div style="color: rgba(255,255,255,0.7); font-size: 14px;">
    <div style="margin-bottom: 8px;">Format tips:</div>
    <ul style="margin: 0; padding-left: 20px;">
      <li>Use <code>x</code> as the variable</li>
      <li>For exponents: <code>x^2</code> or <code>x¬≤</code></li>
      <li>For multiplication: <code>2*x</code> or <code>2x</code></li>
      <li>Use parentheses: <code>3(x + 2) = 15</code></li>
    </ul>
  </div>
</div>

<script>
// Simple, robust equation solver
function solveEquation() {
  const left = document.getElementById('eq-left').value.trim();
  const right = document.getElementById('eq-right').value.trim();
  
  // Hide previous panels
  document.getElementById('solution-panel').style.display = 'none';
  document.getElementById('error-panel').style.display = 'none';
  
  if (!left || !right) {
    showError('Please enter both sides of the equation');
    return;
  }
  
  try {
    // Parse and solve
    const solution = parseAndSolve(left, right);
    
    // Display results
    displaySolution(solution);
    
  } catch (error) {
    showError(`Could not solve: ${error.message}`);
  }
}

function parseAndSolve(left, right) {
  const equation = `${left} = ${right}`;
  
  // Check if quadratic
  const isQuadratic = left.includes('¬≤') || left.includes('^2') || 
                     left.includes('x*x') || left.includes('x^2');
  
  if (isQuadratic) {
    return solveQuadratic(left, right);
  } else {
    return solveLinear(left, right);
  }
}

function solveLinear(left, right) {
  // Extract coefficients using simple parsing
  let xCoeff = 0;
  let constLeft = 0;
  let constRight = parseFloat(right) || 0;
  
  // Extract x coefficient
  const xMatch = left.match(/([-+]?\s*\d*\.?\d*)\s*x/);
  if (xMatch) {
    let coeff = xMatch[1].replace(/\s/g, '');
    if (coeff === '' || coeff === '+') xCoeff = 1;
    else if (coeff === '-') xCoeff = -1;
    else xCoeff = parseFloat(coeff);
  }
  
  // Extract constant from left side
  const leftWithoutX = left.replace(/([-+]?\s*\d*\.?\d*)\s*x/g, '');
  const leftParts = leftWithoutX.match(/[-+]?\s*\d+\.?\d*/g) || [];
  leftParts.forEach(part => {
    const val = parseFloat(part.replace(/\s/g, '')) || 0;
    constLeft += val;
  });
  
  // Calculate solution
  const solution = (constRight - constLeft) / xCoeff;
  
  return {
    type: 'linear',
    solution: solution,
    equation: `${left} = ${right}`,
    coefficients: { a: xCoeff, b: constLeft, c: constRight },
    steps: generateLinearSteps(xCoeff, constLeft, constRight, solution)
  };
}

function solveQuadratic(left, right) {
  // Simple coefficient extraction for standard forms
  let a = 0, b = 0, c = 0;
  
  // Clean the expression
  const expr = left.replace(/\s/g, '');
  
  // Extract a (coefficient of x¬≤)
  const aMatch = expr.match(/([-+]?\d*)x[¬≤^2]/) || expr.match(/([-+]?\d*)x\*x/);
  if (aMatch) {
    const coeff = aMatch[1];
    if (coeff === '' || coeff === '+') a = 1;
    else if (coeff === '-') a = -1;
    else a = parseFloat(coeff);
  }
  
  // Extract b (coefficient of x)
  const bMatch = expr.match(/([-+]?\d*)x(?!\*x|[¬≤^2])/);
  if (bMatch) {
    const coeff = bMatch[1];
    if (coeff === '' || coeff === '+') b = 1;
    else if (coeff === '-') b = -1;
    else b = parseFloat(coeff);
  }
  
  // Extract c (constant)
  const cMatch = expr.match(/([-+]?\d+)(?![^x]*x)/);
  if (cMatch) {
    c = parseFloat(cMatch[0]);
  }
  
  // Adjust for right side
  const rightNum = parseFloat(right) || 0;
  c = c - rightNum;
  
  // Calculate discriminant
  const discriminant = b * b - 4 * a * c;
  
  let solutions = [];
  let solutionType = '';
  
  if (discriminant > 0) {
    const sqrtD = Math.sqrt(discriminant);
    solutions = [
      (-b + sqrtD) / (2 * a),
      (-b - sqrtD) / (2 * a)
    ];
    solutionType = 'two real solutions';
  } else if (Math.abs(discriminant) < 1e-10) {
    solutions = [-b / (2 * a)];
    solutionType = 'one real solution (double root)';
  } else {
    const real = -b / (2 * a);
    const imag = Math.sqrt(-discriminant) / (2 * a);
    solutions = [
      { real, imag },
      { real, imag: -imag }
    ];
    solutionType = 'two complex solutions';
  }
  
  return {
    type: 'quadratic',
    solutions: solutions,
    solutionType: solutionType,
    equation: `${left} = ${right}`,
    coefficients: { a, b, c },
    discriminant: discriminant,
    steps: generateQuadraticSteps(a, b, c, discriminant, solutions)
  };
}

function generateLinearSteps(a, b, c, solution) {
  return [
    `1. Original equation: ${a === 1 ? '' : a}x ${b >= 0 ? '+' : ''}${b} = ${c}`,
    `2. Subtract ${b} from both sides: ${a}x = ${c} - ${b} = ${c - b}`,
    `3. Divide both sides by ${a}: x = ${c - b} √∑ ${a}`,
    `4. Calculate: x = ${formatNumber(solution)}`,
    `5. Verification: ${a} √ó ${formatNumber(solution)} ${b >= 0 ? '+' : ''}${b} = ${a * solution + b} ‚úì`
  ];
}

function generateQuadraticSteps(a, b, c, discriminant, solutions) {
  const steps = [
    `1. Standard form: ${a}x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
    `2. Discriminant: D = b¬≤ - 4ac = ${b}¬≤ - 4√ó${a}√ó${c} = ${formatNumber(discriminant)}`
  ];
  
  if (typeof solutions[0] === 'number') {
    if (solutions.length === 2) {
      steps.push(`3. D > 0 ‚Üí Two real solutions`);
      steps.push(`4. x‚ÇÅ = (-b + ‚àöD)/(2a) = (${-b} + ‚àö${formatNumber(discriminant)})/(2√ó${a})`);
      steps.push(`5. x‚ÇÇ = (-b - ‚àöD)/(2a) = (${-b} - ‚àö${formatNumber(discriminant)})/(2√ó${a})`);
      steps.push(`6. Solutions: x‚ÇÅ = ${formatNumber(solutions[0])}, x‚ÇÇ = ${formatNumber(solutions[1])}`);
    } else {
      steps.push(`3. D = 0 ‚Üí One repeated solution`);
      steps.push(`4. x = -b/(2a) = ${-b}/(2√ó${a})`);
      steps.push(`5. Solution: x = ${formatNumber(solutions[0])}`);
    }
  } else {
    steps.push(`3. D < 0 ‚Üí Complex solutions`);
    steps.push(`4. Real part = -b/(2a) = ${formatNumber(solutions[0].real)}`);
    steps.push(`5. Imaginary part = ‚àö(-D)/(2a) = ${formatNumber(solutions[0].imag)}`);
    steps.push(`6. Solutions: x‚ÇÅ = ${formatNumber(solutions[0].real)} + ${formatNumber(solutions[0].imag)}i`);
    steps.push(`7. Solutions: x‚ÇÇ = ${formatNumber(solutions[1].real)} - ${formatNumber(solutions[1].imag)}i`);
  }
  
  return steps;
}

function displaySolution(solution) {
  const panel = document.getElementById('solution-panel');
  
  if (solution.type === 'linear') {
    document.getElementById('final-answer').textContent = `x = ${formatNumber(solution.solution)}`;
    document.getElementById('eq-type').textContent = 'Linear';
    document.getElementById('eq-degree').textContent = '1';
    document.getElementById('solution-count').textContent = '1';
  } else {
    if (typeof solution.solutions[0] === 'number') {
      if (solution.solutions.length === 2) {
        document.getElementById('final-answer').innerHTML = 
          `x‚ÇÅ = ${formatNumber(solution.solutions[0])}<br>x‚ÇÇ = ${formatNumber(solution.solutions[1])}`;
        document.getElementById('solution-count').textContent = '2';
      } else {
        document.getElementById('final-answer').textContent = `x = ${formatNumber(solution.solutions[0])}`;
        document.getElementById('solution-count').textContent = '1';
      }
    } else {
      document.getElementById('final-answer').innerHTML = 
        `x‚ÇÅ = ${formatNumber(solution.solutions[0].real)} + ${formatNumber(solution.solutions[0].imag)}i<br>` +
        `x‚ÇÇ = ${formatNumber(solution.solutions[1].real)} - ${formatNumber(solution.solutions[1].imag)}i`;
      document.getElementById('solution-count').textContent = '2';
    }
    document.getElementById('eq-type').textContent = 'Quadratic';
    document.getElementById('eq-degree').textContent = '2';
  }
  
  // Display steps
  const stepsHtml = solution.steps.map(step => 
    `<div style="margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 6px; border-left: 3px solid #2dd4ff;">${step}</div>`
  ).join('');
  
  document.getElementById('solution-steps').innerHTML = stepsHtml;
  
  // Show visualization
  createBalanceVisual(solution);
  
  panel.style.display = 'block';
}

function createBalanceVisual(solution) {
  const visual = document.getElementById('balance-visual');
  
  if (solution.type === 'linear') {
    visual.innerHTML = `
      <div style="text-align: center;">
        <div style="color: rgba(230,250,255,0.8); margin-bottom: 5px;">Balance Point:</div>
        <div style="font-size: 18px; color: #39ff14;">x = ${formatNumber(solution.solution)}</div>
        <div style="margin-top: 10px; color: rgba(230,250,255,0.6); font-size: 14px;">
          Where left side equals right side
        </div>
      </div>
    `;
  } else {
    visual.innerHTML = `
      <div style="text-align: center;">
        <div style="color: rgba(230,250,255,0.8); margin-bottom: 5px;">Parabola Roots:</div>
        <div style="font-size: 18px; color: #39ff14;">
          ${typeof solution.solutions[0] === 'number' 
            ? `x = ${solution.solutions.map(s => formatNumber(s)).join(', ')}`
            : 'Complex solutions'}
        </div>
        <div style="margin-top: 10px; color: rgba(230,250,255,0.6); font-size: 14px;">
          Where the curve crosses the x-axis
        </div>
      </div>
    `;
  }
}

function showError(message) {
  document.getElementById('error-message').textContent = message;
  document.getElementById('error-panel').style.display = 'block';
}

function clearEquation() {
  document.getElementById('eq-left').value = '';
  document.getElementById('eq-right').value = '';
  document.getElementById('solution-panel').style.display = 'none';
  document.getElementById('error-panel').style.display = 'none';
  document.getElementById('eq-left').focus();
}

function setQuickEq(equation) {
  const parts = equation.split('=');
  if (parts.length === 2) {
    document.getElementById('eq-left').value = parts[0].trim();
    document.getElementById('eq-right').value = parts[1].trim();
    document.getElementById('solution-panel').style.display = 'none';
    document.getElementById('error-panel').style.display = 'none';
  }
}

function formatNumber(num) {
  if (typeof num !== 'number') return num;
  if (Math.abs(num) < 1e-10) return '0';
  if (Math.abs(num - Math.round(num)) < 1e-6) {
    return Math.round(num).toString();
  }
  return num.toFixed(6).replace(/\.?0+$/, '');
}

function copySolution() {
  const answer = document.getElementById('final-answer').textContent;
  const steps = document.getElementById('solution-steps').textContent;
  const text = `Algebra Solution:\n${answer}\n\nSteps:\n${steps}`;
  
  navigator.clipboard.writeText(text).then(() => {
    alert('Solution copied to clipboard!');
  });
}

// Enter key support
document.getElementById('eq-left').addEventListener('keypress', e => {
  if (e.key === 'Enter') solveEquation();
});

document.getElementById('eq-right').addEventListener('keypress', e => {
  if (e.key === 'Enter') solveEquation();
});

// Auto-focus
setTimeout(() => {
  document.getElementById('eq-left').focus();
}, 100);
</script>