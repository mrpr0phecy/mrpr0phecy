<h2 id="algebra-title">Algebra Solver</h2>

<div style="color: rgba(230,250,255,0.8); margin: 10px 0 20px 0; font-size: 15px;">
  Solve equations instantly. Type any equation and click Solve.
</div>

<!-- üéØ SIMPLE INPUT AREA -->
<div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
  <div style="margin-bottom: 15px;">
    <div style="color: #e6faff; margin-bottom: 8px;">Enter Equation:</div>
    <input type="text" id="algebra-input" 
           placeholder="e.g., 2x + 5 = 13 or x¬≤ - 9 = 0"
           style="width:100%; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.05); color:#e6faff; font-size:16px;"
           value="2x + 5 = 13">
  </div>
  
  <!-- üöÄ ACTION BUTTONS -->
  <div style="display: flex; gap: 12px; margin-bottom: 15px;">
    <button id="solve-button" 
            style="flex:1; background:#2dd4ff; color:#000; border:none; padding:14px 24px; border-radius:8px; font-weight:600; cursor:pointer; font-size:16px;">
      SOLVE EQUATION
    </button>
    
    <button id="clear-button" 
            style="background:rgba(255,255,255,0.08); color:#e6faff; border:1px solid rgba(255,255,255,0.2); padding:14px 20px; border-radius:8px; cursor:pointer;">
      Clear
    </button>
  </div>
  
  <!-- üìö QUICK EXAMPLES -->
  <div style="margin-top: 20px;">
    <div style="color: rgba(230,250,255,0.7); margin-bottom: 10px;">Quick Examples:</div>
    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
      <button class="example-btn" data-example="2x + 5 = 13" style="padding:8px 12px; background:rgba(45,212,255,0.1); border:1px solid rgba(45,212,255,0.3); color:#2dd4ff; border-radius:6px; cursor:pointer;">2x + 5 = 13</button>
      <button class="example-btn" data-example="3x - 7 = 8" style="padding:8px 12px; background:rgba(45,212,255,0.1); border:1px solid rgba(45,212,255,0.3); color:#2dd4ff; border-radius:6px; cursor:pointer;">3x - 7 = 8</button>
      <button class="example-btn" data-example="x¬≤ = 9" style="padding:8px 12px; background:rgba(45,212,255,0.1); border:1px solid rgba(45,212,255,0.3); color:#2dd4ff; border-radius:6px; cursor:pointer;">x¬≤ = 9</button>
      <button class="example-btn" data-example="2x¬≤ - 8 = 0" style="padding:8px 12px; background:rgba(45,212,255,0.1); border:1px solid rgba(45,212,255,0.3); color:#2dd4ff; border-radius:6px; cursor:pointer;">2x¬≤ - 8 = 0</button>
      <button class="example-btn" data-example="3(x-2) = 2x + 4" style="padding:8px 12px; background:rgba(45,212,255,0.1); border:1px solid rgba(45,212,255,0.3); color:#2dd4ff; border-radius:6px; cursor:pointer;">3(x-2) = 2x + 4</button>
    </div>
  </div>
</div>

<!-- üìä SOLUTION DISPLAY -->
<div id="solution-area" style="display: none;">
  <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2);">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
      <div style="color: #39ff14; font-size: 18px; font-weight: 600;">‚úÖ Solution Found</div>
      <button id="copy-button" style="background:rgba(57,255,20,0.1); color:#39ff14; border:1px solid rgba(57,255,20,0.3); padding:8px 16px; border-radius:6px; cursor:pointer; font-size:14px;">
        Copy Answer
      </button>
    </div>
    
    <div id="answer-display" style="font-size: 22px; color: #39ff14; text-align: center; margin-bottom: 25px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
      <!-- Answer appears here -->
    </div>
    
    <div>
      <div style="color: #2dd4ff; margin-bottom: 12px; font-size: 15px;">Step-by-Step Solution:</div>
      <div id="steps-display" style="line-height: 1.6; color: #e6faff; padding: 15px; background: rgba(30,30,30,0.5); border-radius: 8px;">
        <!-- Steps appear here -->
      </div>
    </div>
  </div>
</div>

<!-- üö® ERROR DISPLAY -->
<div id="error-area" style="display: none; background: rgba(255,77,77,0.1); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,77,77,0.3); margin-top: 20px;">
  <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 10px;">‚ö†Ô∏è Unable to Solve</div>
  <div id="error-text" style="color: rgba(255,77,77,0.9); margin-bottom: 15px;">
    Please check your equation format.
  </div>
  <div style="color: rgba(255,255,255,0.7); font-size: 14px;">
    <strong>Tips:</strong> Use 'x' as variable ‚Ä¢ For x¬≤ use 'x^2' or 'x*x' ‚Ä¢ Always include '=' sign
  </div>
</div>

<!-- üîß SCRIPT THAT ALWAYS WORKS -->
<script>
// ===================================================
// UNIVERSAL ALGEBRA SOLVER - Works in any environment
// ===================================================

// Create a unique namespace for this card
const AlgebraSolver = {
  
  // Initialize everything
  init: function() {
    console.log('üîß Algebra Solver: Initializing...');
    
    // Wait a moment for DOM to be ready
    setTimeout(() => {
      this.setupEventListeners();
      console.log('‚úÖ Algebra Solver: Ready!');
    }, 50);
  },
  
  // Setup all event listeners
  setupEventListeners: function() {
    // SOLVE button
    const solveBtn = document.getElementById('solve-button');
    if (solveBtn) {
      solveBtn.addEventListener('click', () => this.solve());
      console.log('‚úÖ Solve button listener added');
    }
    
    // CLEAR button
    const clearBtn = document.getElementById('clear-button');
    if (clearBtn) {
      clearBtn.addEventListener('click', () => this.clear());
      console.log('‚úÖ Clear button listener added');
    }
    
    // COPY button
    const copyBtn = document.getElementById('copy-button');
    if (copyBtn) {
      copyBtn.addEventListener('click', () => this.copyAnswer());
      console.log('‚úÖ Copy button listener added');
    }
    
    // EXAMPLE buttons
    const exampleBtns = document.querySelectorAll('.example-btn');
    exampleBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const example = e.target.getAttribute('data-example');
        this.loadExample(example);
      });
    });
    console.log(`‚úÖ ${exampleBtns.length} example buttons ready`);
    
    // ENTER key support
    const inputField = document.getElementById('algebra-input');
    if (inputField) {
      inputField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') this.solve();
      });
      console.log('‚úÖ Enter key listener added');
    }
  },
  
  // Main solve function
  solve: function() {
    console.log('üîç Solving equation...');
    
    const input = document.getElementById('algebra-input');
    if (!input) return;
    
    const equation = input.value.trim();
    
    // Hide previous results
    this.hideElements();
    
    if (!equation) {
      this.showError('Please enter an equation');
      return;
    }
    
    if (!equation.includes('=')) {
      this.showError('Equation must contain an equals sign (=)');
      return;
    }
    
    if (!equation.includes('x')) {
      this.showError('Equation should contain x as the variable');
      return;
    }
    
    try {
      const solution = this.parseEquation(equation);
      this.displaySolution(solution);
    } catch (error) {
      console.error('Solve error:', error);
      this.showError('Unable to solve this equation. Try one of the examples.');
    }
  },
  
  // Parse and solve equation
  parseEquation: function(equation) {
    const parts = equation.split('=');
    if (parts.length !== 2) {
      throw new Error('Invalid equation format');
    }
    
    const left = parts[0].trim();
    const right = parts[1].trim();
    
    // Check if quadratic
    const isQuadratic = left.includes('¬≤') || left.includes('^2') || 
                       left.includes('x*x') || left.includes('x^2');
    
    if (isQuadratic) {
      return this.solveQuadratic(left, right);
    } else {
      return this.solveLinear(left, right);
    }
  },
  
  // Solve linear equation
  solveLinear: function(left, right) {
    // Simple parsing for linear equations
    let xCoeff = 0;
    let constant = 0;
    
    // Extract x coefficient
    const xMatch = left.match(/([-+]?\s*\d*\.?\d*)\s*x/);
    if (xMatch) {
      let coeff = xMatch[1].replace(/\s/g, '');
      if (coeff === '' || coeff === '+') xCoeff = 1;
      else if (coeff === '-') xCoeff = -1;
      else xCoeff = parseFloat(coeff);
    }
    
    // Extract constant from left side
    const leftWithoutX = left.replace(/([-+]?\s*\d*\.?\d*)\s*x/g, '');
    const numbers = leftWithoutX.match(/[-+]?\s*\d+\.?\d*/g) || [];
    numbers.forEach(num => {
      constant += parseFloat(num.replace(/\s/g, '')) || 0;
    });
    
    // Right side value
    const rightValue = parseFloat(right) || 0;
    
    // Calculate solution
    const solution = (rightValue - constant) / xCoeff;
    
    return {
      type: 'linear',
      solution: solution,
      equation: `${left} = ${right}`,
      steps: [
        `Equation: ${left} = ${right}`,
        `Move constants to right: ${xCoeff}x = ${rightValue} - ${constant}`,
        `Simplify: ${xCoeff}x = ${rightValue - constant}`,
        `Divide by ${xCoeff}: x = ${rightValue - constant} √∑ ${xCoeff}`,
        `Solution: x = ${this.formatNumber(solution)}`,
        `Check: ${xCoeff} √ó ${this.formatNumber(solution)} ${constant >= 0 ? '+' : ''}${constant} = ${xCoeff * solution + constant} ‚úì`
      ]
    };
  },
  
  // Solve quadratic equation
  solveQuadratic: function(left, right) {
    // Simple quadratic solver for standard forms
    let a = 0, b = 0, c = 0;
    
    const expr = left.replace(/\s/g, '');
    
    // Get coefficient of x¬≤
    const aMatch = expr.match(/([-+]?\d*)x[¬≤^2]/) || expr.match(/([-+]?\d*)x\*x/);
    if (aMatch) {
      const coeff = aMatch[1];
      if (coeff === '' || coeff === '+') a = 1;
      else if (coeff === '-') a = -1;
      else a = parseFloat(coeff);
    }
    
    // Get coefficient of x
    const bMatch = expr.match(/([-+]?\d*)x(?!\*x|[¬≤^2])/);
    if (bMatch) {
      const coeff = bMatch[1];
      if (coeff === '' || coeff === '+') b = 1;
      else if (coeff === '-') b = -1;
      else b = parseFloat(coeff);
    }
    
    // Get constant
    const cMatch = expr.match(/([-+]?\d+)(?![^x]*x)/);
    if (cMatch) {
      c = parseFloat(cMatch[0]);
    }
    
    // Adjust for right side
    const rightNum = parseFloat(right) || 0;
    c = c - rightNum;
    
    // Calculate discriminant
    const discriminant = b * b - 4 * a * c;
    
    let answer = '';
    let steps = [
      `Equation: ${left} = ${right}`,
      `Standard form: ${a}x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
      `Discriminant: D = b¬≤ - 4ac = ${b}¬≤ - 4√ó${a}√ó${c} = ${this.formatNumber(discriminant)}`
    ];
    
    if (discriminant > 0) {
      const sqrtD = Math.sqrt(discriminant);
      const x1 = (-b + sqrtD) / (2 * a);
      const x2 = (-b - sqrtD) / (2 * a);
      
      answer = `x‚ÇÅ = ${this.formatNumber(x1)}\nx‚ÇÇ = ${this.formatNumber(x2)}`;
      steps.push(`D > 0 ‚Üí Two real solutions`);
      steps.push(`x‚ÇÅ = (-b + ‚àöD)/(2a) = (${-b} + ${this.formatNumber(sqrtD)})/(2√ó${a})`);
      steps.push(`x‚ÇÇ = (-b - ‚àöD)/(2a) = (${-b} - ${this.formatNumber(sqrtD)})/(2√ó${a})`);
      
    } else if (Math.abs(discriminant) < 1e-10) {
      const x = -b / (2 * a);
      answer = `x = ${this.formatNumber(x)} (double root)`;
      steps.push(`D = 0 ‚Üí One repeated solution`);
      steps.push(`x = -b/(2a) = ${-b}/(2√ó${a})`);
      
    } else {
      const real = -b / (2 * a);
      const imag = Math.sqrt(-discriminant) / (2 * a);
      answer = `x‚ÇÅ = ${this.formatNumber(real)} + ${this.formatNumber(imag)}i\nx‚ÇÇ = ${this.formatNumber(real)} - ${this.formatNumber(imag)}i`;
      steps.push(`D < 0 ‚Üí Two complex solutions`);
      steps.push(`Real part = -b/(2a) = ${this.formatNumber(real)}`);
      steps.push(`Imaginary part = ‚àö(-D)/(2a) = ${this.formatNumber(imag)}`);
    }
    
    return {
      type: 'quadratic',
      answer: answer,
      equation: `${left} = ${right}`,
      steps: steps
    };
  },
  
  // Display solution
  displaySolution: function(solution) {
    const solutionArea = document.getElementById('solution-area');
    const answerDisplay = document.getElementById('answer-display');
    const stepsDisplay = document.getElementById('steps-display');
    
    if (!solutionArea || !answerDisplay || !stepsDisplay) return;
    
    // Show answer
    if (solution.type === 'linear') {
      answerDisplay.textContent = `x = ${this.formatNumber(solution.solution)}`;
    } else {
      answerDisplay.innerHTML = solution.answer.replace(/\n/g, '<br>');
    }
    
    // Show steps
    const stepsHtml = solution.steps.map(step => 
      `<div style="margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 6px; border-left: 3px solid #2dd4ff;">${step}</div>`
    ).join('');
    
    stepsDisplay.innerHTML = stepsHtml;
    
    // Show solution area
    solutionArea.style.display = 'block';
    
    console.log('‚úÖ Solution displayed');
  },
  
  // Show error
  showError: function(message) {
    const errorArea = document.getElementById('error-area');
    const errorText = document.getElementById('error-text');
    
    if (errorArea && errorText) {
      errorText.textContent = message;
      errorArea.style.display = 'block';
    }
  },
  
  // Hide all result areas
  hideElements: function() {
    const solutionArea = document.getElementById('solution-area');
    const errorArea = document.getElementById('error-area');
    
    if (solutionArea) solutionArea.style.display = 'none';
    if (errorArea) errorArea.style.display = 'none';
  },
  
  // Clear everything
  clear: function() {
    const input = document.getElementById('algebra-input');
    if (input) {
      input.value = '2x + 5 = 13';
      input.focus();
    }
    this.hideElements();
    console.log('üßπ Cleared');
  },
  
  // Load example
  loadExample: function(example) {
    const input = document.getElementById('algebra-input');
    if (input) {
      input.value = example;
      input.focus();
    }
    this.hideElements();
    console.log(`üìù Loaded example: ${example}`);
  },
  
  // Copy answer to clipboard
  copyAnswer: function() {
    const answerDisplay = document.getElementById('answer-display');
    if (!answerDisplay) return;
    
    const text = answerDisplay.textContent;
    navigator.clipboard.writeText(text).then(() => {
      alert('‚úì Answer copied to clipboard!');
    });
  },
  
  // Format numbers nicely
  formatNumber: function(num) {
    if (typeof num !== 'number') return num;
    if (Math.abs(num) < 1e-10) return '0';
    if (Math.abs(num - Math.round(num)) < 1e-6) {
      return Math.round(num).toString();
    }
    return num.toFixed(6).replace(/\.?0+$/, '');
  }
};

// ===================================================
// AUTO-START THE SOLVER
// ===================================================

// Method 1: Start immediately
AlgebraSolver.init();

// Method 2: Also expose to global scope for debugging
window.AlgebraSolver = AlgebraSolver;

// Method 3: Provide a manual start function
window.startAlgebraSolver = function() {
  console.log('üöÄ Manually starting Algebra Solver...');
  AlgebraSolver.init();
};

console.log('üß© Algebra Solver script loaded successfully');
console.log('üí° If buttons don\'t work, try: startAlgebraSolver() in console');

// Method 4: Auto-retry if needed
setTimeout(() => {
  // Check if event listeners were added
  const solveBtn = document.getElementById('solve-button');
  if (solveBtn && !solveBtn._listenersAdded) {
    console.log('üîÑ Retrying initialization...');
    AlgebraSolver.init();
  }
}, 1000);
</script>

<!-- üîç DEBUG HELPER -->
<div style="margin-top: 20px; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 6px; border: 1px dashed rgba(255,255,255,0.1); display: none;" id="debug-info">
  <div style="color: rgba(230,250,255,0.7); font-size: 12px; font-family: monospace;">
    Algebra Solver Status: <span id="debug-status">Loading...</span>
  </div>
</div>

<script>
// Debug script
setTimeout(() => {
  const solveBtn = document.getElementById('solve-button');
  const debugInfo = document.getElementById('debug-info');
  const debugStatus = document.getElementById('debug-status');
  
  if (debugInfo && debugStatus) {
    debugInfo.style.display = 'block';
    
    if (solveBtn && solveBtn.onclick) {
      debugStatus.textContent = '‚úÖ Ready';
      debugStatus.style.color = '#39ff14';
    } else {
      debugStatus.textContent = '‚ùå Not initialized';
      debugStatus.style.color = '#ff4d4d';
      debugStatus.innerHTML += ' <button onclick="startAlgebraSolver()" style="margin-left:10px; padding:2px 8px; background:#2dd4ff; color:#000; border:none; border-radius:4px; cursor:pointer;">Fix</button>';
    }
  }
}, 500);
</script>