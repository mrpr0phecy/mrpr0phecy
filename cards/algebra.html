<h2 id="algebra-title">Algebra Solver</h2>

<div style="color: rgba(230,250,255,0.8); margin: 10px 0 20px 0; font-size: 15px;">
  Solve equations with clarity. See every step, understand every transformation.
</div>

<!-- üéØ EQUATION BUILDER -->
<div class="equation-builder" style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
  <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
    <div style="color: #e6faff; font-size: 16px;">Equation:</div>
    
    <div style="display: flex; align-items: center; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px 15px; border: 1px solid rgba(255,255,255,0.1);">
      <input type="text" id="alg-eq-left" placeholder="Enter left side" 
             style="background:none; border:none; color:#e6faff; font-size:16px; width:150px; outline:none;"
             value="2x + 5">
      <span style="color:#2dd4ff; font-weight:bold; margin:0 12px;">=</span>
      <input type="text" id="alg-eq-right" placeholder="Enter right side" 
             style="background:none; border:none; color:#e6faff; font-size:16px; width:80px; outline:none;"
             value="13">
    </div>
    
    <button id="alg-solve-btn" 
            style="background:#2dd4ff; color:#000; border:none; padding:12px 24px; border-radius:8px; font-weight:600; cursor:pointer;">
      Solve
    </button>
    
    <button id="alg-clear-btn" 
            style="background:rgba(255,255,255,0.08); color:#e6faff; border:1px solid rgba(255,255,255,0.2); padding:12px 20px; border-radius:8px; cursor:pointer;">
      Clear
    </button>
  </div>
  
  <!-- üîß QUICK EQUATIONS -->
  <div style="margin-top: 15px; color: rgba(230,250,255,0.7); font-size: 14px;">
    <div style="margin-bottom: 8px;">Try:</div>
    <div id="alg-examples" style="display: flex; gap: 10px; flex-wrap: wrap;">
      <span class="alg-example-btn" data-eq="2x + 5 = 13" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">2x + 5 = 13</span>
      <span class="alg-example-btn" data-eq="3x - 7 = 2x + 1" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">3x - 7 = 2x + 1</span>
      <span class="alg-example-btn" data-eq="x¬≤ - 9 = 0" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">x¬≤ - 9 = 0</span>
      <span class="alg-example-btn" data-eq="2x¬≤ + 3x - 2 = 0" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">2x¬≤ + 3x - 2 = 0</span>
      <span class="alg-example-btn" data-eq="4(x-2) = 2x + 12" style="cursor:pointer; padding:6px 12px; background:rgba(45,212,255,0.1); border-radius:6px; border:1px solid rgba(45,212,255,0.3);">4(x-2) = 2x + 12</span>
    </div>
  </div>
</div>

<!-- üìä SOLUTION PANEL -->
<div id="alg-solution-panel" style="display: none;">
  <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
    <div style="color: #39ff14; font-size: 18px; font-weight: 600;">Solution Found</div>
    <button id="alg-copy-btn" 
            style="background:rgba(57,255,20,0.1); color:#39ff14; border:1px solid rgba(57,255,20,0.3); padding:8px 16px; border-radius:6px; cursor:pointer; font-size:14px;">
      Copy Solution
    </button>
  </div>
  
  <!-- üéØ ANSWER -->
  <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2); margin-bottom: 25px;">
    <div style="font-size: 24px; font-weight: 600; color: #39ff14; text-align: center; margin-bottom: 20px;" id="alg-final-answer">
      x = 4
    </div>
    
    <!-- üìà EQUATION VISUALIZATION -->
    <div style="margin-bottom: 25px;">
      <div style="color: #2dd4ff; margin-bottom: 10px; font-size: 15px;">Equation Balance:</div>
      <div id="alg-balance-visual" style="display: flex; align-items: center; justify-content: center; gap: 20px; padding: 15px; background: rgba(30,30,30,0.5); border-radius: 8px;">
        <!-- Will be filled by JavaScript -->
      </div>
    </div>
    
    <!-- üìù STEP-BY-STEP -->
    <div>
      <div style="color: #2dd4ff; margin-bottom: 15px; font-size: 15px;">Step-by-Step Solution:</div>
      <div id="alg-solution-steps" style="line-height: 1.6; color: #e6faff;">
        <!-- Steps will be filled here -->
      </div>
    </div>
  </div>
  
  <!-- üî¨ ANALYSIS -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
    <div style="color: #2dd4ff; margin-bottom: 15px; font-size: 15px;">Equation Analysis:</div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Type:</div>
        <div style="color: #e6faff; font-weight: 500;" id="alg-eq-type">Linear</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Degree:</div>
        <div style="color: #e6faff; font-weight: 500;" id="alg-eq-degree">1</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Solution Count:</div>
        <div style="color: #e6faff; font-weight: 500;" id="alg-solution-count">1</div>
      </div>
      
      <div>
        <div style="color: rgba(230,250,255,0.7); margin-bottom: 5px;">Verified:</div>
        <div style="color: #39ff14; font-weight: 500;" id="alg-verified-status">‚úì Yes</div>
      </div>
    </div>
  </div>
</div>

<!-- üö® ERROR PANEL -->
<div id="alg-error-panel" style="display: none; background: rgba(255,77,77,0.1); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,77,77,0.3); margin-top: 20px;">
  <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 10px;">Unable to Solve</div>
  <div id="alg-error-message" style="color: rgba(255,77,77,0.9); margin-bottom: 15px;">
    Please check your equation format.
  </div>
  <div style="color: rgba(255,255,255,0.7); font-size: 14px;">
    <div style="margin-bottom: 8px;">Format tips:</div>
    <ul style="margin: 0; padding-left: 20px;">
      <li>Use <code>x</code> as the variable</li>
      <li>For exponents: <code>x^2</code> or <code>x¬≤</code></li>
      <li>For multiplication: <code>2*x</code> or <code>2x</code></li>
      <li>Use parentheses: <code>3(x + 2) = 15</code></li>
    </ul>
  </div>
</div>

<script>
// ============================================
// ALGEBRA SOLVER - BULLETPROOF SCOPING
// All functions are scoped to this card only
// ============================================

// Wait for the card to be fully loaded in the DOM
(function() {
  // Initialize when the card is ready
  setTimeout(initAlgebraSolver, 100);
  
  function initAlgebraSolver() {
    console.log('üîß Initializing Algebra Solver...');
    
    // Get elements with card-specific IDs
    const solveBtn = document.getElementById('alg-solve-btn');
    const clearBtn = document.getElementById('alg-clear-btn');
    const copyBtn = document.getElementById('alg-copy-btn');
    const leftInput = document.getElementById('alg-eq-left');
    const rightInput = document.getElementById('alg-eq-right');
    
    if (!solveBtn || !clearBtn) {
      console.error('Algebra Solver: Could not find buttons');
      return;
    }
    
    console.log('‚úÖ Algebra Solver elements found:', { solveBtn, clearBtn, leftInput, rightInput });
    
    // Attach event listeners DIRECTLY (not via onclick attributes)
    solveBtn.addEventListener('click', algSolve);
    clearBtn.addEventListener('click', algClear);
    if (copyBtn) copyBtn.addEventListener('click', algCopySolution);
    
    // Add event listeners to example buttons
    const exampleBtns = document.querySelectorAll('.alg-example-btn');
    exampleBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const equation = this.getAttribute('data-eq');
        algSetExample(equation);
      });
    });
    
    // Enter key support
    if (leftInput) {
      leftInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') algSolve();
      });
    }
    
    if (rightInput) {
      rightInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') algSolve();
      });
    }
    
    // Auto-focus
    if (leftInput) leftInput.focus();
    
    console.log('‚úÖ Algebra Solver initialized successfully');
  }
  
  // ========== CORE FUNCTIONS ==========
  
  function algSolve() {
    console.log('üîç Solving equation...');
    
    const left = document.getElementById('alg-eq-left')?.value.trim() || '';
    const right = document.getElementById('alg-eq-right')?.value.trim() || '';
    
    // Hide previous panels
    const solutionPanel = document.getElementById('alg-solution-panel');
    const errorPanel = document.getElementById('alg-error-panel');
    if (solutionPanel) solutionPanel.style.display = 'none';
    if (errorPanel) errorPanel.style.display = 'none';
    
    if (!left || !right) {
      algShowError('Please enter both sides of the equation');
      return;
    }
    
    try {
      console.log('Solving:', left, '=', right);
      const solution = algParseAndSolve(left, right);
      algDisplaySolution(solution);
    } catch (error) {
      console.error('Solving error:', error);
      algShowError(`Could not solve: ${error.message}`);
    }
  }
  
  function algParseAndSolve(left, right) {
    const equation = `${left} = ${right}`;
    
    // Check if quadratic
    const isQuadratic = left.includes('¬≤') || left.includes('^2') || 
                       left.includes('x*x') || left.includes('x^2');
    
    if (isQuadratic) {
      return algSolveQuadratic(left, right);
    } else {
      return algSolveLinear(left, right);
    }
  }
  
  function algSolveLinear(left, right) {
    // Simple linear solver
    let xCoeff = 0;
    let constLeft = 0;
    let constRight = parseFloat(right) || 0;
    
    // Extract x coefficient
    const xMatch = left.match(/([-+]?\s*\d*\.?\d*)\s*x/);
    if (xMatch) {
      let coeff = xMatch[1].replace(/\s/g, '');
      if (coeff === '' || coeff === '+') xCoeff = 1;
      else if (coeff === '-') xCoeff = -1;
      else xCoeff = parseFloat(coeff);
    }
    
    // Extract constant from left side
    const leftWithoutX = left.replace(/([-+]?\s*\d*\.?\d*)\s*x/g, '');
    const leftParts = leftWithoutX.match(/[-+]?\s*\d+\.?\d*/g) || [];
    leftParts.forEach(part => {
      const val = parseFloat(part.replace(/\s/g, '')) || 0;
      constLeft += val;
    });
    
    // Calculate solution
    const solution = (constRight - constLeft) / xCoeff;
    
    return {
      type: 'linear',
      solution: solution,
      equation: `${left} = ${right}`,
      coefficients: { a: xCoeff, b: constLeft, c: constRight },
      steps: algGenerateLinearSteps(xCoeff, constLeft, constRight, solution)
    };
  }
  
  function algSolveQuadratic(left, right) {
    // Simple quadratic solver
    let a = 0, b = 0, c = 0;
    
    const expr = left.replace(/\s/g, '');
    
    // Extract a (coefficient of x¬≤)
    const aMatch = expr.match(/([-+]?\d*)x[¬≤^2]/) || expr.match(/([-+]?\d*)x\*x/);
    if (aMatch) {
      const coeff = aMatch[1];
      if (coeff === '' || coeff === '+') a = 1;
      else if (coeff === '-') a = -1;
      else a = parseFloat(coeff);
    }
    
    // Extract b (coefficient of x)
    const bMatch = expr.match(/([-+]?\d*)x(?!\*x|[¬≤^2])/);
    if (bMatch) {
      const coeff = bMatch[1];
      if (coeff === '' || coeff === '+') b = 1;
      else if (coeff === '-') b = -1;
      else b = parseFloat(coeff);
    }
    
    // Extract c (constant)
    const cMatch = expr.match(/([-+]?\d+)(?![^x]*x)/);
    if (cMatch) {
      c = parseFloat(cMatch[0]);
    }
    
    // Adjust for right side
    const rightNum = parseFloat(right) || 0;
    c = c - rightNum;
    
    // Calculate discriminant
    const discriminant = b * b - 4 * a * c;
    
    let solutions = [];
    let solutionType = '';
    
    if (discriminant > 0) {
      const sqrtD = Math.sqrt(discriminant);
      solutions = [
        (-b + sqrtD) / (2 * a),
        (-b - sqrtD) / (2 * a)
      ];
      solutionType = 'two real solutions';
    } else if (Math.abs(discriminant) < 1e-10) {
      solutions = [-b / (2 * a)];
      solutionType = 'one real solution (double root)';
    } else {
      const real = -b / (2 * a);
      const imag = Math.sqrt(-discriminant) / (2 * a);
      solutions = [
        { real, imag },
        { real, imag: -imag }
      ];
      solutionType = 'two complex solutions';
    }
    
    return {
      type: 'quadratic',
      solutions: solutions,
      solutionType: solutionType,
      equation: `${left} = ${right}`,
      coefficients: { a, b, c },
      discriminant: discriminant,
      steps: algGenerateQuadraticSteps(a, b, c, discriminant, solutions)
    };
  }
  
  function algGenerateLinearSteps(a, b, c, solution) {
    return [
      `1. Original equation: ${a === 1 ? '' : a}x ${b >= 0 ? '+' : ''}${b} = ${c}`,
      `2. Subtract ${b} from both sides: ${a}x = ${c} - ${b} = ${c - b}`,
      `3. Divide both sides by ${a}: x = ${c - b} √∑ ${a}`,
      `4. Calculate: x = ${algFormatNumber(solution)}`,
      `5. Verification: ${a} √ó ${algFormatNumber(solution)} ${b >= 0 ? '+' : ''}${b} = ${a * solution + b} ‚úì`
    ];
  }
  
  function algGenerateQuadraticSteps(a, b, c, discriminant, solutions) {
    const steps = [
      `1. Standard form: ${a}x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
      `2. Discriminant: D = b¬≤ - 4ac = ${b}¬≤ - 4√ó${a}√ó${c} = ${algFormatNumber(discriminant)}`
    ];
    
    if (typeof solutions[0] === 'number') {
      if (solutions.length === 2) {
        steps.push(`3. D > 0 ‚Üí Two real solutions`);
        steps.push(`4. x‚ÇÅ = (-b + ‚àöD)/(2a) = (${-b} + ‚àö${algFormatNumber(discriminant)})/(2√ó${a})`);
        steps.push(`5. x‚ÇÇ = (-b - ‚àöD)/(2a) = (${-b} - ‚àö${algFormatNumber(discriminant)})/(2√ó${a})`);
        steps.push(`6. Solutions: x‚ÇÅ = ${algFormatNumber(solutions[0])}, x‚ÇÇ = ${algFormatNumber(solutions[1])}`);
      } else {
        steps.push(`3. D = 0 ‚Üí One repeated solution`);
        steps.push(`4. x = -b/(2a) = ${-b}/(2√ó${a})`);
        steps.push(`5. Solution: x = ${algFormatNumber(solutions[0])}`);
      }
    } else {
      steps.push(`3. D < 0 ‚Üí Complex solutions`);
      steps.push(`4. Real part = -b/(2a) = ${algFormatNumber(solutions[0].real)}`);
      steps.push(`5. Imaginary part = ‚àö(-D)/(2a) = ${algFormatNumber(solutions[0].imag)}`);
      steps.push(`6. Solutions: x‚ÇÅ = ${algFormatNumber(solutions[0].real)} + ${algFormatNumber(solutions[0].imag)}i`);
      steps.push(`7. Solutions: x‚ÇÇ = ${algFormatNumber(solutions[1].real)} - ${algFormatNumber(solutions[1].imag)}i`);
    }
    
    return steps;
  }
  
  function algDisplaySolution(solution) {
    const panel = document.getElementById('alg-solution-panel');
    if (!panel) return;
    
    if (solution.type === 'linear') {
      const answerEl = document.getElementById('alg-final-answer');
      if (answerEl) answerEl.textContent = `x = ${algFormatNumber(solution.solution)}`;
      
      const typeEl = document.getElementById('alg-eq-type');
      const degreeEl = document.getElementById('alg-eq-degree');
      const countEl = document.getElementById('alg-solution-count');
      
      if (typeEl) typeEl.textContent = 'Linear';
      if (degreeEl) degreeEl.textContent = '1';
      if (countEl) countEl.textContent = '1';
    } else {
      const answerEl = document.getElementById('alg-final-answer');
      if (answerEl) {
        if (typeof solution.solutions[0] === 'number') {
          if (solution.solutions.length === 2) {
            answerEl.innerHTML = 
              `x‚ÇÅ = ${algFormatNumber(solution.solutions[0])}<br>x‚ÇÇ = ${algFormatNumber(solution.solutions[1])}`;
          } else {
            answerEl.textContent = `x = ${algFormatNumber(solution.solutions[0])}`;
          }
        } else {
          answerEl.innerHTML = 
            `x‚ÇÅ = ${algFormatNumber(solution.solutions[0].real)} + ${algFormatNumber(solution.solutions[0].imag)}i<br>` +
            `x‚ÇÇ = ${algFormatNumber(solution.solutions[1].real)} - ${algFormatNumber(solution.solutions[1].imag)}i`;
        }
      }
      
      const typeEl = document.getElementById('alg-eq-type');
      const degreeEl = document.getElementById('alg-eq-degree');
      const countEl = document.getElementById('alg-solution-count');
      
      if (typeEl) typeEl.textContent = 'Quadratic';
      if (degreeEl) degreeEl.textContent = '2';
      if (countEl) countEl.textContent = solution.solutions.length.toString();
    }
    
    // Display steps
    const stepsHtml = solution.steps.map(step => 
      `<div style="margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 6px; border-left: 3px solid #2dd4ff;">${step}</div>`
    ).join('');
    
    const stepsEl = document.getElementById('alg-solution-steps');
    if (stepsEl) stepsEl.innerHTML = stepsHtml;
    
    // Show panel
    panel.style.display = 'block';
  }
  
  function algShowError(message) {
    const errorPanel = document.getElementById('alg-error-panel');
    const errorMessage = document.getElementById('alg-error-message');
    
    if (errorPanel && errorMessage) {
      errorMessage.textContent = message;
      errorPanel.style.display = 'block';
    }
  }
  
  function algClear() {
    const leftInput = document.getElementById('alg-eq-left');
    const rightInput = document.getElementById('alg-eq-right');
    const solutionPanel = document.getElementById('alg-solution-panel');
    const errorPanel = document.getElementById('alg-error-panel');
    
    if (leftInput) leftInput.value = '';
    if (rightInput) rightInput.value = '';
    if (solutionPanel) solutionPanel.style.display = 'none';
    if (errorPanel) errorPanel.style.display = 'none';
    
    // Restore default example
    if (leftInput) leftInput.value = '2x + 5';
    if (rightInput) rightInput.value = '13';
    
    if (leftInput) leftInput.focus();
  }
  
  function algSetExample(equation) {
    const parts = equation.split('=');
    if (parts.length === 2) {
      const leftInput = document.getElementById('alg-eq-left');
      const rightInput = document.getElementById('alg-eq-right');
      const solutionPanel = document.getElementById('alg-solution-panel');
      const errorPanel = document.getElementById('alg-error-panel');
      
      if (leftInput) leftInput.value = parts[0].trim();
      if (rightInput) rightInput.value = parts[1].trim();
      if (solutionPanel) solutionPanel.style.display = 'none';
      if (errorPanel) errorPanel.style.display = 'none';
    }
  }
  
  function algFormatNumber(num) {
    if (typeof num !== 'number') return num;
    if (Math.abs(num) < 1e-10) return '0';
    if (Math.abs(num - Math.round(num)) < 1e-6) {
      return Math.round(num).toString();
    }
    return num.toFixed(6).replace(/\.?0+$/, '');
  }
  
  function algCopySolution() {
    const answerEl = document.getElementById('alg-final-answer');
    const stepsEl = document.getElementById('alg-solution-steps');
    
    if (!answerEl || !stepsEl) return;
    
    const answer = answerEl.textContent;
    const steps = stepsEl.textContent;
    const text = `Algebra Solution:\n${answer}\n\nSteps:\n${steps}`;
    
    navigator.clipboard.writeText(text).then(() => {
      alert('Solution copied to clipboard!');
    });
  }
  
  // Expose functions globally for debugging (optional)
  window.algSolve = algSolve;
  window.algClear = algClear;
  window.algSetExample = algSetExample;
  window.algCopySolution = algCopySolution;
  
  console.log('‚úÖ Algebra Solver functions exposed globally');
})();
</script>