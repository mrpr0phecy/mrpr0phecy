<h2 id="citation-gen-title" style="margin-top:0;">üìö Citation Generator</h2>

<form aria-describedby="citation-gen-desc">
  <p id="citation-gen-desc" class="small">
    Generate perfectly formatted citations in APA, MLA, or Chicago style. Supports multiple authors, websites, and academic sources.
  </p>

  <!-- INPUT SECTION - THEMED -->
  <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;margin-bottom:20px;">
    <div style="color:#2dd4ff;font-weight:600;margin-bottom:15px;">üìñ Source Information:</div>
    
    <!-- SOURCE TYPE -->
    <div style="margin-bottom:20px;">
      <label style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.8);font-size:14px;">
        <span style="color:#ffa500;">Source Type</span>
      </label>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button type="button" class="cg-source-type active" data-type="book"
                style="padding:8px 16px;background:linear-gradient(135deg, rgba(255,165,0,0.2), rgba(255,165,0,0.1));border:1px solid rgba(255,165,0,0.4);border-radius:6px;color:#ffa500;cursor:pointer;font-weight:500;">
          üìï Book
        </button>
        <button type="button" class="cg-source-type" data-type="article"
                style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;">
          üìÑ Journal Article
        </button>
        <button type="button" class="cg-source-type" data-type="website"
                style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;">
          üåê Website
        </button>
        <button type="button" class="cg-source-type" data-type="video"
                style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;">
          üìπ Video
        </button>
        <button type="button" class="cg-source-type" data-type="thesis"
                style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;">
          üéì Thesis
        </button>
      </div>
    </div>
    
    <!-- AUTHOR SECTION -->
    <div style="margin-bottom:20px;">
      <label for="cg-author" style="display:block;margin-bottom:8px;color:rgba(230,250,255,0.8);font-size:14px;">
        <span style="color:#2dd4ff;">Author(s)</span>
        <span style="font-size:12px;color:rgba(230,250,255,0.6);margin-left:8px;">Separate multiple authors with commas</span>
      </label>
      <input id="cg-author" type="text" placeholder="e.g. Smith, John or Doe, Jane, Johnson, Bob" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:#e6faff;font-size:16px;" />
    </div>
    
    <!-- TITLE & YEAR -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cg-title" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#39ff14;">Title</span>
        </label>
        <input id="cg-title" type="text" placeholder="Book/article title" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#e6faff;font-size:16px;" />
      </div>
      
      <div>
        <label for="cg-year" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#9d4edd;">Year</span>
        </label>
        <input id="cg-year" type="number" placeholder="2024" min="1000" max="9999" step="1"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:#e6faff;font-size:16px;" />
      </div>
    </div>
    
    <!-- PUBLISHER & LOCATION -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cg-publisher" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#ffcc00;">Publisher / Journal</span>
        </label>
        <input id="cg-publisher" type="text" placeholder="Publisher name or Journal title" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:#e6faff;font-size:16px;" />
      </div>
      
      <div>
        <label for="cg-location" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#e83e8c;">Location / URL</span>
        </label>
        <input id="cg-location" type="text" placeholder="City, State or https://..." 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(232,62,140,0.3);background:rgba(232,62,140,0.05);color:#e6faff;font-size:16px;" />
      </div>
    </div>
    
    <!-- ADDITIONAL FIELDS (DYNAMIC) -->
    <div id="cg-additional-fields" style="margin-top:20px;display:none;">
      <!-- Will be populated based on source type -->
    </div>
  </div>
  
  <!-- CITATION STYLE SELECTION -->
  <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;margin-bottom:20px;">
    <div style="color:#2dd4ff;font-weight:600;margin-bottom:15px;">üéØ Citation Style:</div>
    
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;">
      <button type="button" class="cg-style-btn active" data-style="APA"
              style="padding:10px 20px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:#2dd4ff;cursor:pointer;font-weight:600;">
        APA 7th Edition
      </button>
      <button type="button" class="cg-style-btn" data-style="MLA"
              style="padding:10px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;">
        MLA 9th Edition
      </button>
      <button type="button" class="cg-style-btn" data-style="Chicago"
              style="padding:10px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;">
        Chicago 17th Ed.
      </button>
    </div>
    
    <!-- OPTIONS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
      <div>
        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;color:rgba(230,250,255,0.8);">
          <input type="checkbox" id="cg-hanging-indent" style="cursor:pointer;">
          <div>
            <div style="font-weight:600;color:#39ff14;">Hanging Indent</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.6);">Format with hanging indent</div>
          </div>
        </label>
      </div>
      
      <div>
        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;color:rgba(230,250,255,0.8);">
          <input type="checkbox" id="cg-html-format" checked style="cursor:pointer;">
          <div>
            <div style="font-weight:600;color:#9d4edd;">HTML Formatting</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.6);">Include italicized titles</div>
          </div>
        </label>
      </div>
      
      <div>
        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;color:rgba(230,250,255,0.8);">
          <input type="checkbox" id="cg-include-url" style="cursor:pointer;">
          <div>
            <div style="font-weight:600;color:#ffcc00;">Include URL/DOI</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.6);">Add access information</div>
          </div>
        </label>
      </div>
    </div>
  </div>
  
  <!-- QUICK EXAMPLES -->
  <div style="margin-bottom:25px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:10px;font-size:14px;">Quick Examples:</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="cg-example-btn" data-type="book" data-author="King, Stephen" data-title="The Shining" data-year="1977" data-publisher="Doubleday" data-location="New York, NY"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üìö Book Example
      </button>
      <button class="cg-example-btn" data-type="article" data-author="Watson, James D., Crick, Francis" data-title="Molecular structure of nucleic acids" data-year="1953" data-publisher="Nature" data-location="London"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üìÑ Journal Article
      </button>
      <button class="cg-example-btn" data-type="website" data-author="Wikipedia contributors" data-title="Artificial intelligence" data-year="2024" data-publisher="Wikipedia" data-location="https://en.wikipedia.org"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üåê Website Example
      </button>
    </div>
  </div>
  
  <!-- GENERATE BUTTON -->
  <div style="text-align:center;margin:25px 0;">
    <button id="cg-generate-btn" 
            style="background:#2dd4ff;color:#000;border:none;padding:14px 32px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;box-shadow:0 4px 15px rgba(45,212,255,0.3);">
      üìù GENERATE CITATION
    </button>
    
    <button id="cg-reset-btn" 
            style="background:rgba(255,255,255,0.08);color:#e6faff;border:1px solid rgba(255,255,255,0.2);padding:14px 24px;border-radius:10px;cursor:pointer;font-size:16px;margin-left:12px;">
      Reset
    </button>
  </div>
  
  <!-- RESULTS DISPLAY -->
  <div id="cg-results" style="display:none;">
    <div style="background:rgba(20,20,20,0.7);border-radius:10px;padding:25px;border:1px solid rgba(57,255,20,0.2);margin-bottom:25px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div style="color:#39ff14;font-size:18px;font-weight:600;">üìã Generated Citations</div>
        <button id="cg-copy-btn" 
                style="background:rgba(57,255,20,0.1);color:#39ff14;border:1px solid rgba(57,255,20,0.3);padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;">
          Copy All
        </button>
      </div>
      
      <!-- CITATION STYLES -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;">
        <!-- APA -->
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;border:1px solid rgba(45,212,255,0.2);overflow:hidden;">
          <div style="background:rgba(45,212,255,0.1);padding:12px;color:#2dd4ff;font-weight:600;font-size:14px;">
            APA 7th Edition
          </div>
          <div id="cg-apa-output" style="padding:15px;color:#e6faff;font-family:'Times New Roman',serif;line-height:1.6;min-height:120px;">
            Fill in fields and click Generate
          </div>
          <div style="border-top:1px solid rgba(255,255,255,0.1);padding:8px 15px;background:rgba(0,0,0,0.2);">
            <button class="cg-copy-style-btn" data-style="APA"
                    style="background:transparent;border:1px solid rgba(45,212,255,0.3);color:#2dd4ff;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">
              Copy APA
            </button>
          </div>
        </div>
        
        <!-- MLA -->
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;border:1px solid rgba(255,165,0,0.2);overflow:hidden;">
          <div style="background:rgba(255,165,0,0.1);padding:12px;color:#ffa500;font-weight:600;font-size:14px;">
            MLA 9th Edition
          </div>
          <div id="cg-mla-output" style="padding:15px;color:#e6faff;font-family:'Times New Roman',serif;line-height:1.6;min-height:120px;">
            Fill in fields and click Generate
          </div>
          <div style="border-top:1px solid rgba(255,255,255,0.1);padding:8px 15px;background:rgba(0,0,0,0.2);">
            <button class="cg-copy-style-btn" data-style="MLA"
                    style="background:transparent;border:1px solid rgba(255,165,0,0.3);color:#ffa500;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">
              Copy MLA
            </button>
          </div>
        </div>
        
        <!-- CHICAGO -->
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;border:1px solid rgba(157,78,221,0.2);overflow:hidden;">
          <div style="background:rgba(157,78,221,0.1);padding:12px;color:#9d4edd;font-weight:600;font-size:14px;">
            Chicago 17th Ed.
          </div>
          <div id="cg-chicago-output" style="padding:15px;color:#e6faff;font-family:'Times New Roman',serif;line-height:1.6;min-height:120px;">
            Fill in fields and click Generate
          </div>
          <div style="border-top:1px solid rgba(255,255,255,0.1);padding:8px 15px;background:rgba(0,0,0,0.2);">
            <button class="cg-copy-style-btn" data-style="Chicago"
                    style="background:transparent;border:1px solid rgba(157,78,221,0.3);color:#9d4edd;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">
              Copy Chicago
            </button>
          </div>
        </div>
      </div>
      
      <!-- STATUS -->
      <div style="margin-top:20px;padding:12px;background:rgba(45,212,255,0.1);border-radius:6px;border:1px solid rgba(45,212,255,0.3);">
        <div style="color:#2dd4ff;font-size:14px;display:flex;justify-content:space-between;">
          <span>Status: <span id="cg-status" style="color:#39ff14;">Ready</span></span>
          <span id="cg-hint" style="color:rgba(230,250,255,0.7);"></span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- CITATION GUIDE -->
  <div id="cg-guide" style="margin-top:25px;display:block;">
    <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;border:1px solid rgba(255,165,0,0.2);">
      <div style="color:#ffa500;font-weight:600;margin-bottom:15px;font-size:16px;">
        üìö Citation Style Guide
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;">
        <div style="background:rgba(255,165,0,0.05);padding:12px;border-radius:8px;border-left:3px solid #ffa500;">
          <div style="color:#ffa500;font-weight:600;margin-bottom:5px;">APA (7th Edition)</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Author, A. A. (Year). <em>Title of work</em>.<br>
            ‚Ä¢ Publisher.<br>
            ‚Ä¢ URL or DOI if available<br>
            ‚Ä¢ Used in: Psychology, Education, Sciences
          </div>
        </div>
        
        <div style="background:rgba(45,212,255,0.05);padding:12px;border-radius:8px;border-left:3px solid #2dd4ff;">
          <div style="color:#2dd4ff;font-weight:600;margin-bottom:5px;">MLA (9th Edition)</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Author. <em>Title of Source</em>.<br>
            ‚Ä¢ Publisher, Year.<br>
            ‚Ä¢ Container, location.<br>
            ‚Ä¢ Used in: Humanities, Literature, Arts
          </div>
        </div>
        
        <div style="background:rgba(157,78,221,0.05);padding:12px;border-radius:8px;border-left:3px solid #9d4edd;">
          <div style="color:#9d4edd;font-weight:600;margin-bottom:5px;">Chicago (17th Ed.)</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Author. <em>Title</em>.<br>
            ‚Ä¢ Place: Publisher, Year.<br>
            ‚Ä¢ Notes-Bibliography style shown<br>
            ‚Ä¢ Used in: History, Business, Fine Arts
          </div>
        </div>
        
        <div style="background:rgba(57,255,20,0.05);padding:12px;border-radius:8px;border-left:3px solid #39ff14;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:5px;">Pro Tips</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Always verify with official style guides<br>
            ‚Ä¢ Check your institution's requirements<br>
            ‚Ä¢ Use DOI when available for articles<br>
            ‚Ä¢ Include access dates for online sources
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ERROR MESSAGE -->
  <div id="cg-error" style="margin-top:20px;padding:15px;background:rgba(255,77,77,0.1);border-radius:8px;border:1px solid rgba(255,77,77,0.3);display:none;">
    <div style="color:#ff4d4d;font-weight:600;margin-bottom:5px;">‚ö†Ô∏è Missing Information</div>
    <div id="cg-error-text" style="color:rgba(255,77,77,0.9);"></div>
  </div>
</form>

<style>
#citation-gen-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .cg-example-btn, .cg-source-type, .cg-style-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  #cg-generate-btn, #cg-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  #cg-results > div > div {
    grid-template-columns: 1fr !important;
  }
}
</style>

<script>
/* citation-generator.html
   - Complete citation generator with APA, MLA, Chicago
   - Scoped with cg- prefix
*/

let cgSourceType = 'book';
let cgCitationStyle = 'APA';

// Initialize
function cgInit() {
    console.log("Citation Generator: Initializing...");
    
    // Source type buttons
    const sourceTypeBtns = document.querySelectorAll('.cg-source-type');
    sourceTypeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const type = this.dataset.type;
            cgSourceType = type;
            
            // Update active state
            sourceTypeBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
                b.style.color = '#e6faff';
            });
            this.style.background = `linear-gradient(135deg, rgba(255,165,0,0.2), rgba(255,165,0,0.1))`;
            this.style.border = '1px solid rgba(255,165,0,0.4)';
            this.style.color = '#ffa500';
            
            // Update additional fields
            cgUpdateAdditionalFields(type);
            cgClearResults();
        });
    });
    
    // Style buttons
    const styleBtns = document.querySelectorAll('.cg-style-btn');
    styleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const style = this.dataset.style;
            cgCitationStyle = style;
            
            // Update active state
            styleBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
                b.style.color = '#e6faff';
            });
            this.style.background = `linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1))`;
            this.style.border = '1px solid rgba(45,212,255,0.4)';
            this.style.color = '#2dd4ff';
            
            cgClearResults();
        });
    });
    
    // Example buttons
    const exampleBtns = document.querySelectorAll('.cg-example-btn');
    exampleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById('cg-author').value = this.dataset.author || '';
            document.getElementById('cg-title').value = this.dataset.title || '';
            document.getElementById('cg-year').value = this.dataset.year || '';
            document.getElementById('cg-publisher').value = this.dataset.publisher || '';
            document.getElementById('cg-location').value = this.dataset.location || '';
            
            // Set source type
            const type = this.dataset.type;
            sourceTypeBtns.forEach(b => {
                if(b.dataset.type === type) {
                    b.click();
                }
            });
            
            // Visual feedback
            exampleBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
            });
            this.style.background = 'rgba(45,212,255,0.15)';
            this.style.border = '1px solid #2dd4ff';
            
            cgClearResults();
        });
    });
    
    // Generate button
    document.getElementById('cg-generate-btn').addEventListener('click', cgGenerate);
    
    // Reset button
    document.getElementById('cg-reset-btn').addEventListener('click', cgReset);
    
    // Copy buttons
    document.getElementById('cg-copy-btn').addEventListener('click', cgCopyAll);
    document.querySelectorAll('.cg-copy-style-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const style = this.dataset.style;
            cgCopyStyle(style);
        });
    });
    
    // Enter key support
    const inputs = document.querySelectorAll('#cg-author, #cg-title, #cg-year, #cg-publisher, #cg-location');
    inputs.forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                cgGenerate();
            }
        });
    });
    
    // Initialize additional fields
    cgUpdateAdditionalFields('book');
    
    console.log("‚úÖ Citation Generator ready!");
}

// Update additional fields based on source type
function cgUpdateAdditionalFields(type) {
    const container = document.getElementById('cg-additional-fields');
    if (!container) return;
    
    let html = '';
    
    switch(type) {
        case 'book':
            html = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                    <div>
                        <label for="cg-edition" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#4dabf7;">Edition</span>
                        </label>
                        <input id="cg-edition" type="text" placeholder="e.g. 2nd edition" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(77,171,247,0.3);background:rgba(77,171,247,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                    <div>
                        <label for="cg-pages" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#e83e8c;">Page Range</span>
                        </label>
                        <input id="cg-pages" type="text" placeholder="e.g. 45-67 or 230" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(232,62,140,0.3);background:rgba(232,62,140,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                </div>
            `;
            break;
            
        case 'article':
            html = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                    <div>
                        <label for="cg-volume" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#4dabf7;">Volume</span>
                        </label>
                        <input id="cg-volume" type="text" placeholder="e.g. 15" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(77,171,247,0.3);background:rgba(77,171,247,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                    <div>
                        <label for="cg-issue" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#e83e8c;">Issue</span>
                        </label>
                        <input id="cg-issue" type="text" placeholder="e.g. 3" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(232,62,140,0.3);background:rgba(232,62,140,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                    <div>
                        <label for="cg-doi" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#39ff14;">DOI/URL</span>
                        </label>
                        <input id="cg-doi" type="text" placeholder="e.g. 10.1234/abcd.1234" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                </div>
            `;
            break;
            
        case 'website':
            html = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                    <div>
                        <label for="cg-access-date" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#4dabf7;">Access Date</span>
                        </label>
                        <input id="cg-access-date" type="date" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(77,171,247,0.3);background:rgba(77,171,247,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                    <div>
                        <label for="cg-website-title" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
                            <span style="color:#e83e8c;">Website Title</span>
                        </label>
                        <input id="cg-website-title" type="text" placeholder="e.g. The New York Times" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(232,62,140,0.3);background:rgba(232,62,140,0.05);color:#e6faff;font-size:16px;" />
                    </div>
                </div>
            `;
            break;
    }
    
    container.innerHTML = html;
    container.style.display = html ? 'block' : 'none';
}

// Reset function
function cgReset() {
    document.getElementById('cg-author').value = '';
    document.getElementById('cg-title').value = '';
    document.getElementById('cg-year').value = '';
    document.getElementById('cg-publisher').value = '';
    document.getElementById('cg-location').value = '';
    
    // Reset example buttons
    document.querySelectorAll('.cg-example-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
    });
    
    // Reset checkboxes
    document.getElementById('cg-hanging-indent').checked = false;
    document.getElementById('cg-html-format').checked = true;
    document.getElementById('cg-include-url').checked = false;
    
    // Reset to default type
    const defaultType = document.querySelector('.cg-source-type[data-type="book"]');
    if (defaultType) defaultType.click();
    
    cgClearResults();
    
    // Focus on author input
    setTimeout(() => {
        document.getElementById('cg-author').focus();
    }, 50);
    
    console.log("Citation generator reset");
}

// Clear results
function cgClearResults() {
    document.getElementById('cg-results').style.display = 'none';
    document.getElementById('cg-error').style.display = 'none';
    
    // Reset outputs
    document.getElementById('cg-apa-output').textContent = 'Fill in fields and click Generate';
    document.getElementById('cg-mla-output').textContent = 'Fill in fields and click Generate';
    document.getElementById('cg-chicago-output').textContent = 'Fill in fields and click Generate';
    
    document.getElementById('cg-status').textContent = 'Ready';
    document.getElementById('cg-status').style.color = '#39ff14';
    document.getElementById('cg-hint').textContent = '';
}

// Show error
function cgShowError(message) {
    document.getElementById('cg-error-text').textContent = message;
    document.getElementById('cg-error').style.display = 'block';
    document.getElementById('cg-status').textContent = 'Error';
    document.getElementById('cg-status').style.color = '#ff4d4d';
}

// Generate citations
function cgGenerate() {
    console.log("Generating citations...");
    
    // Hide previous results/errors
    cgClearResults();
    
    // Get inputs
    const author = document.getElementById('cg-author').value.trim();
    const title = document.getElementById('cg-title').value.trim();
    const year = document.getElementById('cg-year').value.trim();
    const publisher = document.getElementById('cg-publisher').value.trim();
    const location = document.getElementById('cg-location').value.trim();
    
    // Get additional fields
    const edition = document.getElementById('cg-edition')?.value.trim() || '';
    const pages = document.getElementById('cg-pages')?.value.trim() || '';
    const volume = document.getElementById('cg-volume')?.value.trim() || '';
    const issue = document.getElementById('cg-issue')?.value.trim() || '';
    const doi = document.getElementById('cg-doi')?.value.trim() || '';
    const accessDate = document.getElementById('cg-access-date')?.value || '';
    const websiteTitle = document.getElementById('cg-website-title')?.value.trim() || '';
    
    // Get options
    const hangingIndent = document.getElementById('cg-hanging-indent').checked;
    const htmlFormat = document.getElementById('cg-html-format').checked;
    const includeUrl = document.getElementById('cg-include-url').checked;
    
    // Validate
    if (!author || !title || !year) {
        cgShowError("Please fill in at least Author, Title, and Year");
        return;
    }
    
    document.getElementById('cg-status').textContent = "Generating...";
    document.getElementById('cg-status').style.color = "#ffa500";
    
    // Parse authors
    const authors = cgParseAuthors(author);
    
    // Generate citations
    const apa = cgGenerateAPA(authors, title, year, publisher, location, cgSourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl);
    const mla = cgGenerateMLA(authors, title, year, publisher, location, cgSourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl);
    const chicago = cgGenerateChicago(authors, title, year, publisher, location, cgSourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl);
    
    // Display results
    document.getElementById('cg-apa-output').innerHTML = htmlFormat ? apa : cgStripHTML(apa);
    document.getElementById('cg-mla-output').innerHTML = htmlFormat ? mla : cgStripHTML(mla);
    document.getElementById('cg-chicago-output').innerHTML = htmlFormat ? chicago : cgStripHTML(chicago);
    document.getElementById('cg-results').style.display = 'block';
    
    document.getElementById('cg-status').textContent = "Completed ‚úì";
    document.getElementById('cg-status').style.color = "#39ff14";
    document.getElementById('cg-hint').textContent = "3 citation styles generated";
    
    // Show guide
    document.getElementById('cg-guide').style.display = 'block';
}

// Parse author string into array of objects
function cgParseAuthors(authorStr) {
    const authors = [];
    const authorList = authorStr.split(',').map(a => a.trim()).filter(a => a);
    
    for (let i = 0; i < authorList.length; i++) {
        const author = authorList[i];
        const parts = author.split(' ').filter(p => p);
        
        if (parts.length >= 2) {
            const lastName = parts[0].endsWith(',') ? parts[0].slice(0, -1) : parts[0];
            const firstName = parts.slice(1).join(' ');
            authors.push({ lastName, firstName });
        } else {
            authors.push({ lastName: author, firstName: '' });
        }
    }
    
    return authors;
}

// Format author list for APA
function cgFormatAuthorsAPA(authors) {
    if (authors.length === 0) return '';
    if (authors.length === 1) return `${authors[0].lastName}, ${authors[0].firstName.charAt(0)}.`;
    if (authors.length === 2) return `${authors[0].lastName}, ${authors[0].firstName.charAt(0)}., & ${authors[1].lastName}, ${authors[1].firstName.charAt(0)}.`;
    
    const formatted = authors.slice(0, -1).map(a => `${a.lastName}, ${a.firstName.charAt(0)}.`).join(', ');
    const last = authors[authors.length - 1];
    return `${formatted}, & ${last.lastName}, ${last.firstName.charAt(0)}.`;
}

// Format author list for MLA
function cgFormatAuthorsMLA(authors) {
    if (authors.length === 0) return '';
    if (authors.length === 1) return `${authors[0].lastName}, ${authors[0].firstName}.`;
    if (authors.length === 2) return `${authors[0].lastName}, ${authors[0].firstName}, and ${authors[1].firstName} ${authors[1].lastName}.`;
    if (authors.length === 3) return `${authors[0].lastName}, ${authors[0].firstName}, et al.`;
    
    return `${authors[0].lastName}, ${authors[0].firstName}, et al.`;
}

// Format author list for Chicago
function cgFormatAuthorsChicago(authors) {
    if (authors.length === 0) return '';
    if (authors.length === 1) return `${authors[0].lastName}, ${authors[0].firstName}.`;
    if (authors.length === 2) return `${authors[0].lastName}, ${authors[0].firstName}, and ${authors[1].firstName} ${authors[1].lastName}.`;
    if (authors.length === 3) return `${authors[0].lastName}, ${authors[0].firstName}, ${authors[1].firstName} ${authors[1].lastName}, and ${authors[2].firstName} ${authors[2].lastName}.`;
    
    return `${authors[0].lastName}, ${authors[0].firstName}, et al.`;
}

// Generate APA citation
function cgGenerateAPA(authors, title, year, publisher, location, sourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl) {
    let citation = '';
    
    // Author
    const authorStr = cgFormatAuthorsAPA(authors);
    if (authorStr) citation += authorStr + ' ';
    
    // Year
    citation += `(${year}). `;
    
    // Title with italics if HTML
    const titleFormatted = htmlFormat ? `<em>${title}</em>` : title;
    
    switch(sourceType) {
        case 'book':
            citation += `${titleFormatted}`;
            if (edition) citation += ` (${edition}).`;
            else citation += '.';
            if (publisher) citation += ` ${publisher}.`;
            break;
            
        case 'article':
            citation += `${titleFormatted}. `;
            if (journal) citation += `<em>${publisher}</em>`;
            if (volume) citation += `, <em>${volume}</em>`;
            if (issue) citation += `(${issue})`;
            if (pages) citation += `, ${pages}.`;
            else citation += '.';
            if (doi && includeUrl) citation += ` https://doi.org/${doi}`;
            break;
            
        case 'website':
            citation += `${titleFormatted}. `;
            if (websiteTitle) citation += `<em>${websiteTitle}</em>. `;
            if (accessDate) {
                const date = new Date(accessDate);
                citation += `Retrieved ${date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
            }
            if (location && includeUrl) citation += `, from ${location}`;
            else if (accessDate) citation += '.';
            break;
            
        default:
            citation += `${titleFormatted}.`;
            if (publisher) citation += ` ${publisher}.`;
    }
    
    if (hangingIndent) {
        citation = citation.replace(/\. /g, '.<br>&nbsp;&nbsp;&nbsp;&nbsp;');
    }
    
    return citation;
}

// Generate MLA citation
function cgGenerateMLA(authors, title, year, publisher, location, sourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl) {
    let citation = '';
    
    // Author
    const authorStr = cgFormatAuthorsMLA(authors);
    if (authorStr) citation += authorStr + ' ';
    
    // Title with italics if HTML
    const titleFormatted = htmlFormat ? `<em>${title}</em>` : title;
    
    switch(sourceType) {
        case 'book':
            citation += `${titleFormatted}. `;
            if (edition) citation += `${edition} ed., `;
            if (publisher) citation += `${publisher}, `;
            citation += `${year}.`;
            break;
            
        case 'article':
            citation += `"${title}." `;
            if (publisher) citation += `<em>${publisher}</em>, `;
            if (volume) citation += `vol. ${volume}, `;
            if (issue) citation += `no. ${issue}, `;
            citation += `${year}, `;
            if (pages) citation += `pp. ${pages}.`;
            else citation += '.';
            break;
            
        case 'website':
            citation += `"${title}." `;
            if (websiteTitle) citation += `<em>${websiteTitle}</em>, `;
            if (publisher) citation += `${publisher}, `;
            citation += `${year}, `;
            if (location && includeUrl) citation += `${location}. `;
            else citation += '. ';
            if (accessDate) {
                const date = new Date(accessDate);
                citation += `Accessed ${date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}.`;
            }
            break;
            
        default:
            citation += `${titleFormatted}. `;
            if (publisher) citation += `${publisher}, `;
            citation += `${year}.`;
    }
    
    if (hangingIndent) {
        citation = citation.replace(/\. /g, '.<br>&nbsp;&nbsp;&nbsp;&nbsp;');
    }
    
    return citation;
}

// Generate Chicago citation
function cgGenerateChicago(authors, title, year, publisher, location, sourceType, edition, pages, volume, issue, doi, accessDate, websiteTitle, hangingIndent, htmlFormat, includeUrl) {
    let citation = '';
    
    // Author
    const authorStr = cgFormatAuthorsChicago(authors);
    if (authorStr) citation += authorStr + ' ';
    
    // Title with italics if HTML
    const titleFormatted = htmlFormat ? `<em>${title}</em>` : title;
    
    switch(sourceType) {
        case 'book':
            citation += `${titleFormatted}. `;
            if (edition) citation += `${edition} ed. `;
            if (location) citation += `${location}: `;
            if (publisher) citation += `${publisher}, `;
            citation += `${year}.`;
            break;
            
        case 'article':
            citation += `"${title}." `;
            if (publisher) citation += `<em>${publisher}</em> `;
            if (volume) citation += `${volume}, `;
            if (issue) citation += `no. ${issue} `;
            citation += `(${year})`;
            if (pages) citation += `: ${pages}.`;
            else citation += '.';
            if (doi && includeUrl) citation += ` https://doi.org/${doi}`;
            break;
            
        case 'website':
            citation += `"${title}." `;
            if (websiteTitle) citation += `${websiteTitle}. `;
            if (publisher) citation += `${publisher}. `;
            citation += `${year}. `;
            if (location && includeUrl) citation += `${location}. `;
            if (accessDate) {
                const date = new Date(accessDate);
                citation += `Accessed ${date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}.`;
            }
            break;
            
        default:
            citation += `${titleFormatted}. `;
            if (location) citation += `${location}: `;
            if (publisher) citation += `${publisher}, `;
            citation += `${year}.`;
    }
    
    if (hangingIndent) {
        citation = citation.replace(/\. /g, '.<br>&nbsp;&nbsp;&nbsp;&nbsp;');
    }
    
    return citation;
}

// Strip HTML tags for plain text
function cgStripHTML(html) {
    const div = document.createElement('div');
    div.innerHTML = html;
    return div.textContent || div.innerText || '';
}

// Copy specific style
function cgCopyStyle(style) {
    let text = '';
    
    switch(style) {
        case 'APA':
            text = document.getElementById('cg-apa-output').textContent;
            break;
        case 'MLA':
            text = document.getElementById('cg-mla-output').textContent;
            break;
        case 'Chicago':
            text = document.getElementById('cg-chicago-output').textContent;
            break;
    }
    
    if (!text || text.includes('Fill in fields')) {
        alert('Please generate citations first');
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const hint = document.getElementById('cg-hint');
        hint.textContent = `${style} citation copied!`;
        hint.style.color = '#39ff14';
        
        // Visual feedback on button
        const btn = document.querySelector(`.cg-copy-style-btn[data-style="${style}"]`);
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        
        setTimeout(() => {
            hint.textContent = '';
            btn.textContent = originalText;
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy. Please select and copy manually.');
    });
}

// Copy all citations
function cgCopyAll() {
    const apa = document.getElementById('cg-apa-output').textContent;
    const mla = document.getElementById('cg-mla-output').textContent;
    const chicago = document.getElementById('cg-chicago-output').textContent;
    
    if (apa.includes('Fill in fields')) {
        alert('Please generate citations first');
        return;
    }
    
    const text = `APA CITATION:\n${apa}\n\nMLA CITATION:\n${mla}\n\nCHICAGO CITATION:\n${chicago}`;
    
    navigator.clipboard.writeText(text).then(() => {
        const hint = document.getElementById('cg-hint');
        hint.textContent = 'All citations copied!';
        hint.style.color = '#39ff14';
        
        const btn = document.getElementById('cg-copy-btn');
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        
        setTimeout(() => {
            hint.textContent = '';
            btn.textContent = originalText;
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy. Please select and copy manually.');
    });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', cgInit);
} else {
    setTimeout(cgInit, 100);
}
</script>
