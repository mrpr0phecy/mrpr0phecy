<!-- 
===========================================
FILE: cards/seed-germination.html
RULE: Follows Sacred Tool Template structure
===========================================
-->

<!-- ===== 1. TITLE & DESCRIPTION ===== -->
<h2 id="tt-title">üå± Seed Germination Calculator</h2>
<p id="tt-desc" class="small">
    Predict germination time based on seed type, temperature, and environmental factors using USDA, UC Davis, and university research data.
    <em>This tool is supported by 
        <a href="#contributionsPanel" onclick="showContributionsPanel()">
            user contributions
        </a>.
    </em>
</p>

<!-- ===== 2. MAIN CONTENT AREA ===== -->
<div class="glass glass-lg" style="border-radius:var(--radius-lg);padding:var(--space-lg);margin-bottom:var(--space-lg);">

    <!-- Seed Type Selection -->
    <div style="margin-bottom:var(--space-lg);">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:var(--space-md);margin-bottom:var(--space-md);">
            <div>
                <label for="tt-seed-type" style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üåø Seed Type
                </label>
                <select id="tt-seed-type" class="glass glass-dark" style="width:100%;padding:var(--space-sm);border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);">
                    <option value="tomato">üçÖ Tomato</option>
                    <option value="lettuce">ü•¨ Lettuce</option>
                    <option value="bean">ü´ò Bean (Common)</option>
                    <option value="carrot">ü•ï Carrot</option>
                    <option value="pepper">üå∂Ô∏è Pepper</option>
                    <option value="cucumber">ü•í Cucumber</option>
                    <option value="spinach">üçÉ Spinach</option>
                    <option value="basil">üåø Basil</option>
                    <option value="zucchini">ü•í Zucchini</option>
                    <option value="radish">üßÖ Radish</option>
                    <option value="pea">ü´õ Pea</option>
                    <option value="corn">üåΩ Corn</option>
                </select>
            </div>
            
            <div>
                <label for="tt-seed-variety" style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üé® Variety (Optional)
                </label>
                <input id="tt-seed-variety" type="text" placeholder="e.g., Beefsteak, Romaine" 
                    class="glass glass-dark"
                    style="width:100%;padding:var(--space-sm);border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);" />
            </div>
        </div>
        
        <!-- Temperature Controls -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:var(--space-md);margin-bottom:var(--space-lg);">
            <div>
                <label style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üå°Ô∏è Soil Temperature
                </label>
                <div class="glass glass-dark" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm);">
                        <input type="range" id="tt-soil-temp" min="0" max="40" step="0.5" value="20" 
                            style="flex:1;"
                            oninput="ttUpdateSoilTemp(this.value)">
                        <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:var(--accent);min-width:40px;">
                            <span id="tt-soil-temp-value">20</span>¬∞C
                        </div>
                    </div>
                    <div class="small" style="color:var(--text-tertiary);">
                        Optimal: <span id="tt-temp-range">15-29¬∞C</span>
                    </div>
                </div>
            </div>
            
            <div>
                <label style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    ‚òÄÔ∏è Air Temperature
                </label>
                <div class="glass glass-dark" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm);">
                        <input type="range" id="tt-air-temp" min="0" max="40" step="0.5" value="22" 
                            style="flex:1;"
                            oninput="ttUpdateAirTemp(this.value)">
                        <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:var(--accent);min-width:40px;">
                            <span id="tt-air-temp-value">22</span>¬∞C
                        </div>
                    </div>
                    <div class="small" style="color:var(--text-tertiary);">
                        Daytime average
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Environmental Conditions -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:var(--space-md);margin-bottom:var(--space-lg);">
            <div>
                <label for="tt-soil-moisture" style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üíß Soil Moisture
                </label>
                <select id="tt-soil-moisture" class="glass glass-dark" style="width:100%;padding:var(--space-sm);border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);">
                    <option value="optimal" selected>Optimal (80% field capacity)</option>
                    <option value="dry">Dry (40% field capacity)</option>
                    <option value="wet">Wet (saturated)</option>
                    <option value="variable">Variable</option>
                </select>
            </div>
            
            <div>
                <label for="tt-light-exposure" style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üåû Light Exposure
                </label>
                <select id="tt-light-exposure" class="glass glass-dark" style="width:100%;padding:var(--space-sm);border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);">
                    <option value="full" selected>Full Sun (6+ hours)</option>
                    <option value="partial">Partial Sun (4-6 hours)</option>
                    <option value="shade">Shade (<4 hours)</option>
                    <option value="indirect">Indirect Light</option>
                </select>
            </div>
            
            <div>
                <label for="tt-seed-age" style="display:block;margin-bottom:var(--space-xs);color:var(--text-secondary);font-size:var(--text-sm);">
                    üìÖ Seed Age
                </label>
                <div class="glass glass-dark" style="padding:var(--space-sm);border-radius:var(--radius-sm);">
                    <div style="display:flex;align-items:center;gap:var(--space-sm);">
                        <input type="range" id="tt-seed-age" min="0" max="60" value="0" 
                            style="flex:1;"
                            oninput="ttUpdateSeedAge(this.value)">
                        <div style="font-size:var(--text-sm);color:var(--accent);min-width:30px;">
                            <span id="tt-seed-age-value">0</span> mo
                        </div>
                    </div>
                    <div class="small" style="color:var(--text-tertiary);margin-top:var(--space-xs);">
                        0 = fresh seeds, >12 = older seeds
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Control Buttons -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:var(--space-sm);">
            <button onclick="ttCalculateGermination()" class="btn btn-primary">
                <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                    üßÆ Calculate
                </span>
            </button>
            <button onclick="ttResetCalculator()" class="btn btn-secondary">
                <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                    üîÑ Reset
                </span>
            </button>
            <button onclick="ttOptimizeConditions()" class="btn btn-secondary">
                <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                    ‚ö° Optimize
                </span>
            </button>
        </div>
    </div>
    
    <!-- Results Section -->
    <div style="margin-top:var(--space-xl);padding-top:var(--space-lg);border-top:1px solid var(--border-light);">
        <h3 style="font-size:var(--text-sm);font-weight:var(--weight-semibold);color:var(--text-secondary);margin-bottom:var(--space-md);">
            Germination Prediction
        </h3>
        
        <!-- Main Output -->
        <div id="tt-output" class="glass glass-dark" style="padding:var(--space-lg);border-radius:var(--radius-lg);min-height:200px;display:flex;align-items:center;justify-content:center;border-left:4px solid var(--accent);">
            <div style="text-align:center;color:var(--text-tertiary);">
                <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üå±</div>
                <div>Select seed type and conditions to calculate germination</div>
            </div>
        </div>
        
        <!-- Metrics -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:var(--space-md);margin-top:var(--space-lg);">
            <div class="glass glass-md" style="padding:var(--space-md);border-radius:var(--radius-md);text-align:center;">
                <div style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-xs);">
                    üìÖ Germination Days
                </div>
                <div id="tt-germ-days" style="font-size:var(--text-xxl);font-weight:var(--weight-black);color:var(--accent);">
                    ‚Äì
                </div>
            </div>
            
            <div class="glass glass-md" style="padding:var(--space-md);border-radius:var(--radius-md);text-align:center;">
                <div style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-xs);">
                    üìä Success Rate
                </div>
                <div id="tt-success-rate" style="font-size:var(--text-xxl);font-weight:var(--weight-black);color:#4caf50;">
                    ‚Äì
                </div>
            </div>
            
            <div class="glass glass-md" style="padding:var(--space-md);border-radius:var(--radius-md);text-align:center;">
                <div style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-xs);">
                    ‚ö†Ô∏è Risk Level
                </div>
                <div id="tt-risk-level" style="font-size:var(--text-xxl);font-weight:var(--weight-black);">
                    ‚Äì
                </div>
            </div>
        </div>
        
        <!-- Hint -->
        <div id="tt-hint" class="small" style="margin-top:var(--space-md);padding:var(--space-sm);border-radius:var(--radius-sm);background:rgba(45,212,255,0.05);color:var(--text-secondary);display:none;"></div>
    </div>
</div>

<!-- ===== 3. SCIENTIFIC INFO & SHARING ===== -->
<div style="margin-top:var(--space-xl);">
    <details class="glass glass-md" style="border-radius:var(--radius-lg);overflow:hidden;margin-bottom:var(--space-lg);">
        <summary style="cursor:pointer;padding:var(--space-lg);color:var(--text-secondary);font-weight:var(--weight-semibold);list-style:none;display:flex;align-items:center;justify-content:space-between;">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üî¨ Scientific Data & Sources
            </span>
            <span style="font-size:0.9em;">‚ñº</span>
        </summary>
        <div style="padding:var(--space-lg);border-top:1px solid var(--border-light);">
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:var(--space-xl);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-sm);">Data Sources</h4>
                    <ul style="margin:0;padding-left:0;">
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">USDA Plant Hardiness Zone Database</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">University of California Davis Seed Biology</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">International Seed Testing Association</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">Royal Horticultural Society Guides</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-sm);">Models Used</h4>
                    <ul style="margin:0;padding-left:0;">
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">Thermal Time Model (TTM)</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">Cardinal Temperature Model</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);margin-bottom:var(--space-sm);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">Hydrotime Model for moisture</span>
                        </li>
                        <li style="display:flex;align-items:flex-start;gap:var(--space-xs);">
                            <span style="color:var(--accent);">‚Ä¢</span>
                            <span class="small" style="color:var(--text-secondary);">Seed viability degradation</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div style="margin-top:var(--space-lg);padding:var(--space-md);background:rgba(76,175,80,0.1);border-radius:var(--radius-md);border:1px solid rgba(76,175,80,0.2);">
                <p class="small" style="margin:0;color:#4caf50;font-weight:var(--weight-semibold);">
                    üìö This calculator provides research-based estimates for educational purposes.
                </p>
            </div>
        </div>
    </details>
    
    <!-- Sharing & Embedding -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-sm);">
        <button onclick="ttShareGermination()" class="btn btn-secondary">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üì§ Share Results
            </span>
        </button>
        <button onclick="ttEmbedGermination()" class="btn btn-secondary">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üîó Embed Tool
            </span>
        </button>
    </div>
</div>

<!-- ===== 4. JAVASCRIPT ===== -->
<script>
// TOOL-SPECIFIC FUNCTIONS
const ttState = {
    seedType: 'tomato',
    soilTemp: 20,
    airTemp: 22,
    soilMoisture: 'optimal',
    lightExposure: 'full',
    seedAge: 0,
    variety: '',
    
    // Seed database (simplified for example)
    seedData: {
        tomato: { 
            name: "Tomato", minTemp: 10, optimalTemp: 24, maxTemp: 35, baseDays: 6,
            lightReq: "light-neutral", moisture: 0.8, viabilityLoss: 0.15,
            sources: ["UC Davis", "USDA", "RHS"]
        },
        lettuce: { 
            name: "Lettuce", minTemp: 2, optimalTemp: 18, maxTemp: 24, baseDays: 7,
            lightReq: "light-required", moisture: 0.75, viabilityLoss: 0.20,
            sources: ["University of Florida", "ISTA"]
        },
        bean: { 
            name: "Bean", minTemp: 10, optimalTemp: 26, maxTemp: 32, baseDays: 5,
            lightReq: "dark-required", moisture: 0.85, viabilityLoss: 0.10,
            sources: ["Cornell University", "USDA"]
        },
        carrot: { 
            name: "Carrot", minTemp: 7, optimalTemp: 20, maxTemp: 29, baseDays: 14,
            lightReq: "light-neutral", moisture: 0.70, viabilityLoss: 0.25,
            sources: ["University of Wisconsin", "Thompson & Morgan"]
        },
        pepper: { 
            name: "Pepper", minTemp: 15, optimalTemp: 27, maxTemp: 35, baseDays: 10,
            lightReq: "light-required", moisture: 0.80, viabilityLoss: 0.18,
            sources: ["New Mexico State University", "USDA"]
        }
    }
};

// Update functions
function ttUpdateSoilTemp(value) {
    ttState.soilTemp = parseFloat(value);
    document.getElementById('tt-soil-temp-value').textContent = value;
    ttCalculateGermination();
}

function ttUpdateAirTemp(value) {
    ttState.airTemp = parseFloat(value);
    document.getElementById('tt-air-temp-value').textContent = value;
    ttCalculateGermination();
}

function ttUpdateSeedAge(value) {
    ttState.seedAge = parseInt(value);
    document.getElementById('tt-seed-age-value').textContent = value;
    ttCalculateGermination();
}

// Main calculation function
function ttCalculateGermination() {
    const seedType = document.getElementById('tt-seed-type').value;
    const variety = document.getElementById('tt-seed-variety').value;
    const soilMoisture = document.getElementById('tt-soil-moisture').value;
    const lightExposure = document.getElementById('tt-light-exposure').value;
    
    // Update state
    ttState.seedType = seedType;
    ttState.variety = variety;
    ttState.soilMoisture = soilMoisture;
    ttState.lightExposure = lightExposure;
    
    const seedData = ttState.seedData[seedType];
    if (!seedData) return;
    
    // Update temperature range display
    document.getElementById('tt-temp-range').textContent = 
        `${seedData.minTemp}-${seedData.optimalTemp}¬∞C`;
    
    // Calculate germination using Thermal Time Model
    let germDays = calculateThermalTime(
        seedData.minTemp,
        seedData.optimalTemp,
        ttState.soilTemp,
        seedData.baseDays
    );
    
    // Check if temperature is within range
    if (germDays === Infinity) {
        showTemperatureWarning(seedData);
        return;
    }
    
    // Apply environmental factors
    germDays *= calculateMoistureEffect(soilMoisture);
    germDays *= calculateLightEffect(lightExposure, seedData.lightReq);
    germDays *= calculateViabilityEffect(ttState.seedAge, seedData.viabilityLoss);
    
    // Round to whole number
    germDays = Math.round(germDays);
    
    // Calculate success rate
    let successRate = calculateSuccessRate(seedData, ttState);
    
    // Determine risk level
    const riskLevel = calculateRiskLevel(successRate);
    
    // Update display
    updateResultsDisplay(seedData, variety, germDays, successRate, riskLevel);
    
    // Track calculation
    if (window.plausible) {
        window.plausible('Germination Calculated', { 
            props: { seedType: seedData.name, days: germDays } 
        });
    }
}

// Helper calculations
function calculateThermalTime(minTemp, optimalTemp, currentTemp, baseDays) {
    if (currentTemp <= minTemp) return Infinity;
    
    if (currentTemp >= optimalTemp) {
        const q10 = 2.0;
        const tempDiff = currentTemp - optimalTemp;
        const rateMultiplier = Math.pow(q10, tempDiff / 10);
        return baseDays / rateMultiplier;
    }
    
    const tempRange = optimalTemp - minTemp;
    const tempProgress = (currentTemp - minTemp) / tempRange;
    return baseDays * (1 + (1 - tempProgress) * 0.5);
}

function calculateMoistureEffect(moisture) {
    const effects = {
        'optimal': 1.0,
        'dry': 1.5,
        'wet': 1.3,
        'variable': 1.2
    };
    return effects[moisture] || 1.0;
}

function calculateLightEffect(lightExposure, lightReq) {
    if (lightReq === 'light-required') {
        return (lightExposure === 'full' || lightExposure === 'partial') ? 1.0 : 2.0;
    } else if (lightReq === 'dark-required' || lightReq === 'dark-preferred') {
        return (lightExposure === 'shade' || lightExposure === 'indirect') ? 1.0 : 1.3;
    }
    return 1.0;
}

function calculateViabilityEffect(seedAgeMonths, annualLoss) {
    const years = seedAgeMonths / 12;
    const viability = Math.max(0.1, 1 - (years * annualLoss));
    return 1 + (1 - viability); // Slower germination for older seeds
}

function calculateSuccessRate(seedData, state) {
    let rate = 85;
    
    // Temperature effect
    const tempOptimality = 1 - Math.abs(state.soilTemp - seedData.optimalTemp) / 20;
    rate *= Math.max(0.5, tempOptimality);
    
    // Viability effect
    const years = state.seedAge / 12;
    const viability = Math.max(0.1, 1 - (years * seedData.viabilityLoss));
    rate *= viability;
    
    // Moisture effect
    if (state.soilMoisture !== 'optimal') rate *= 0.8;
    
    return Math.round(Math.min(95, Math.max(10, rate)));
}

function calculateRiskLevel(successRate) {
    if (successRate < 50) return { text: "High", color: "#f44336" };
    if (successRate < 75) return { text: "Medium", color: "#ff9800" };
    return { text: "Low", color: "#4caf50" };
}

// Display functions
function showTemperatureWarning(seedData) {
    const output = document.getElementById('tt-output');
    output.innerHTML = `
        <div style="text-align:center;">
            <div style="font-size:var(--text-xxl);margin-bottom:var(--space-sm);">‚ùÑÔ∏è</div>
            <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:#f44336;margin-bottom:var(--space-sm);">
                Too Cold for Germination
            </div>
            <div class="small" style="color:var(--text-secondary);margin-bottom:var(--space-md);">
                Soil temperature (${ttState.soilTemp}¬∞C) is below ${seedData.name}'s minimum of ${seedData.minTemp}¬∞C
            </div>
            <div class="glass glass-sm" style="display:inline-block;padding:var(--space-sm);border-radius:var(--radius-sm);">
                <span style="color:var(--accent);font-weight:var(--weight-semibold);">üí° Recommendation:</span>
                <span style="color:var(--text);"> Use a seedling heat mat or move to a warmer location</span>
            </div>
        </div>
    `;
    
    document.getElementById('tt-germ-days').textContent = "‚àû";
    document.getElementById('tt-success-rate').textContent = "0%";
    document.getElementById('tt-risk-level').textContent = "High";
    document.getElementById('tt-risk-level').style.color = "#f44336";
    
    showHint(`‚ùÑÔ∏è Soil too cold for ${seedData.name} germination`);
}

function updateResultsDisplay(seedData, variety, germDays, successRate, riskLevel) {
    const output = document.getElementById('tt-output');
    
    output.innerHTML = `
        <div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-md);">
                <div>
                    <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:var(--text);">
                        ${seedData.name}${variety ? ` (${variety})` : ''}
                    </div>
                    <div class="small" style="color:var(--text-secondary);">
                        Based on ${seedData.sources.join(", ")} research
                    </div>
                </div>
                <div style="background:rgba(76,175,80,0.1);color:#4caf50;padding:var(--space-xs) var(--space-sm);border-radius:12px;font-size:var(--text-sm);font-weight:var(--weight-semibold);">
                    üå± Ready in ${germDays} days
                </div>
            </div>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:var(--space-md);margin-bottom:var(--space-lg);">
                <div class="condition-box">
                    <div class="small" style="color:var(--text-tertiary);">üå°Ô∏è Temperature</div>
                    <div style="color:var(--text);font-weight:var(--weight-semibold);">
                        ${ttState.soilTemp}¬∞C soil, ${ttState.airTemp}¬∞C air
                    </div>
                </div>
                <div class="condition-box">
                    <div class="small" style="color:var(--text-tertiary);">üíß Soil</div>
                    <div style="color:var(--text);font-weight:var(--weight-semibold);">
                        ${ttState.soilMoisture} moisture
                    </div>
                </div>
                <div class="condition-box">
                    <div class="small" style="color:var(--text-tertiary);">üåû Light</div>
                    <div style="color:var(--text);font-weight:var(--weight-semibold);">
                        ${ttState.lightExposure} exposure
                    </div>
                </div>
            </div>
            
            <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                <div style="color:var(--accent);font-weight:var(--weight-semibold);margin-bottom:var(--space-sm);">
                    üìù Recommendations:
                </div>
                ${getRecommendations(seedData)}
            </div>
        </div>
    `;
    
    document.getElementById('tt-germ-days').textContent = germDays;
    document.getElementById('tt-success-rate').textContent = `${successRate}%`;
    document.getElementById('tt-risk-level').textContent = riskLevel.text;
    document.getElementById('tt-risk-level').style.color = riskLevel.color;
    
    showHint(`‚úì Germination calculated for ${seedData.name}`);
}

function getRecommendations(seedData) {
    let recommendations = [];
    
    if (ttState.soilTemp < seedData.optimalTemp - 5) {
        recommendations.push(`Increase soil temperature by ${Math.round(seedData.optimalTemp - ttState.soilTemp)}¬∞C`);
    }
    
    if (ttState.soilMoisture !== 'optimal') {
        recommendations.push("Maintain optimal soil moisture (neither too dry nor saturated)");
    }
    
    if (ttState.seedAge > 12) {
        recommendations.push("Consider using fresher seeds for better germination");
    }
    
    if (seedData.lightReq === 'light-required' && (ttState.lightExposure === 'shade' || ttState.lightExposure === 'indirect')) {
        recommendations.push(`${seedData.name} needs light - don't bury seeds too deep`);
    }
    
    if (recommendations.length === 0) {
        recommendations.push("Conditions are optimal! Keep soil consistently moist");
    }
    
    return recommendations.map(rec => `<div style="margin-bottom:var(--space-xs);">‚Ä¢ ${rec}</div>`).join('');
}

function showHint(message) {
    const hint = document.getElementById('tt-hint');
    hint.textContent = message;
    hint.style.display = 'block';
    setTimeout(() => {
        if (hint.textContent === message) {
            hint.style.display = 'none';
        }
    }, 5000);
}

// Control functions
function ttResetCalculator() {
    document.getElementById('tt-seed-type').value = 'tomato';
    document.getElementById('tt-seed-variety').value = '';
    document.getElementById('tt-soil-temp').value = '20';
    document.getElementById('tt-air-temp').value = '22';
    document.getElementById('tt-soil-moisture').value = 'optimal';
    document.getElementById('tt-light-exposure').value = 'full';
    document.getElementById('tt-seed-age').value = '0';
    
    ttUpdateSoilTemp(20);
    ttUpdateAirTemp(22);
    ttUpdateSeedAge(0);
    
    showHint("Calculator reset to default values");
}

function ttOptimizeConditions() {
    const seedType = document.getElementById('tt-seed-type').value;
    const seedData = ttState.seedData[seedType];
    
    if (!seedData) return;
    
    document.getElementById('tt-soil-temp').value = seedData.optimalTemp;
    document.getElementById('tt-air-temp').value = seedData.optimalTemp + 2;
    document.getElementById('tt-soil-moisture').value = 'optimal';
    document.getElementById('tt-light-exposure').value = 
        seedData.lightReq === 'light-required' ? 'full' : 'partial';
    document.getElementById('tt-seed-age').value = '0';
    
    ttUpdateSoilTemp(seedData.optimalTemp);
    ttUpdateAirTemp(seedData.optimalTemp + 2);
    ttUpdateSeedAge(0);
    
    showHint(`‚ö° Conditions optimized for ${seedData.name}`);
}

// Sharing functions
function ttShareGermination() {
    const seedType = document.getElementById('tt-seed-type').value;
    const seedData = ttState.seedData[seedType];
    const germDays = document.getElementById('tt-germ-days').textContent;
    const successRate = document.getElementById('tt-success-rate').textContent;
    
    const shareText = `Seed Germination Prediction:\n` +
                     `‚Ä¢ Seed: ${seedData?.name || 'Unknown'}\n` +
                     `‚Ä¢ Days to germinate: ${germDays}\n` +
                     `‚Ä¢ Success rate: ${successRate}\n` +
                     `‚Ä¢ Using The Most Useful Site's Germination Calculator`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Seed Germination Results',
            text: shareText,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(shareText);
        showNotification('Germination results copied to clipboard!', 'success');
    }
}

function ttEmbedGermination() {
    const embedCode = `<iframe src="${window.location.origin}/cards/seed-germination.html" width="100%" height="700" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="Seed Germination Calculator - The Most Useful Site"></iframe>`;
    
    navigator.clipboard.writeText(embedCode);
    showNotification('Embed code copied to clipboard!', 'success');
    
    if (window.plausible) {
        window.plausible('Embed Generated', { props: { tool: 'seed-germination' } });
    }
}

// Event listeners
document.getElementById('tt-seed-type').addEventListener('change', ttCalculateGermination);
document.getElementById('tt-seed-variety').addEventListener('input', () => {
    setTimeout(ttCalculateGermination, 300);
});
document.getElementById('tt-soil-moisture').addEventListener('change', ttCalculateGermination);
document.getElementById('tt-light-exposure').addEventListener('change', ttCalculateGermination);

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        ttCalculateGermination();
    }
    if (e.key === 'r' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        ttResetCalculator();
    }
    if (e.key === 'o' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        ttOptimizeConditions();
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    console.log('üå± Seed Germination Calculator loaded');
    ttCalculateGermination(); // Initial calculation
});
</script>

<!-- ===== 5. CARD-SCOPED STYLES ===== -->
<style>
#tt-title {
    color: var(--accent);
    margin-bottom: var(--space-sm);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.condition-box {
    padding: var(--space-sm);
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-light);
}

/* Range input styling */
input[type="range"] {
    height: 6px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
    -webkit-appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 3px solid var(--bg-panel);
    box-shadow: var(--shadow-md);
}

input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 3px solid var(--bg-panel);
    box-shadow: var(--shadow-md);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .glass-lg {
        padding: var(--space-md) !important;
    }
    
    .condition-box {
        grid-column: 1 / -1;
    }
}

@media (max-width: 480px) {
    .glass-glass-md {
        padding: var(--space-sm) !important;
    }
    
    #tt-output {
        padding: var(--space-md) !important;
    }
    
    .btn {
        width: 100%;
    }
}
</style>
