<h2 id="optics-title" style="margin-top:0;color:var(--accent);">ğŸ”¬ Optics Calculator & Explorer</h2>

<form aria-describedby="optics-desc" style="margin-bottom:20px;">
  <p id="optics-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:16px;">
    Calculate optical properties, simulate light behavior, and explore fascinating physics of light.
  </p>

  <!-- CALCULATION SECTION -->
  <div style="background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.15);border-radius:10px;padding:16px;margin-bottom:20px;">
    <h3 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">âš™ï¸ Optical Calculations</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
      <div>
        <label for="opt-tool" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Select Tool
        </label>
        <select id="opt-tool" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="lens" selected>ğŸ” Lens Equation (1/f = 1/do + 1/di)</option>
          <option value="magnification">ğŸ“ Magnification (M = âˆ’di/do)</option>
          <option value="refraction">ğŸ’ Refractive Index (n = c/v)</option>
          <option value="critical_angle">ğŸŒŠ Critical Angle (Î¸c = sinâ»Â¹(n2/n1))</option>
          <option value="lens_power">ğŸ‘ï¸ Lens Power (P = 1/f)</option>
          <option value="wavelength">ğŸŒˆ Wavelength to Frequency (f = c/Î»)</option>
        </select>
      </div>
      
      <div>
        <label for="opt-units" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Units
        </label>
        <select id="opt-units" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="si">SI (meters, diopters)</option>
          <option value="cm">Centimeters</option>
          <option value="mm">Millimeters</option>
        </select>
      </div>
    </div>

    <!-- INPUT FIELDS (DYNAMIC) -->
    <div id="opt-inputs-container" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;margin-bottom:16px;">
      <!-- Dynamic inputs will be inserted here -->
    </div>

    <!-- QUICK PRESETS -->
    <div style="margin-bottom:16px;">
      <div style="color:rgba(230,250,255,0.8);margin-bottom:6px;font-size:13px;">ğŸ’¡ Quick Presets:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="optApplyPreset('camera')" class="preset-btn">ğŸ“· Camera Lens</button>
        <button type="button" onclick="optApplyPreset('microscope')" class="preset-btn">ğŸ”¬ Microscope</button>
        <button type="button" onclick="optApplyPreset('telescope')" class="preset-btn">ğŸ”­ Telescope</button>
        <button type="button" onclick="optApplyPreset('eye')" class="preset-btn">ğŸ‘ï¸ Human Eye</button>
        <button type="button" onclick="optApplyPreset('glass')" class="preset-btn">ğŸ· Glass Prism</button>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions" style="display:flex;gap:10px;margin-top:12px;">
      <button type="button" onclick="optCalculate()" 
              style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
        ğŸŒˆ Calculate Optics
      </button>
      <button type="button" onclick="optReset()"
              style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
        ğŸ”„ Reset
      </button>
      <button type="button" onclick="optCopy()"
              style="padding:12px 16px;background:rgba(57,255,20,0.05);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
        ğŸ“‹ Copy
      </button>
    </div>
  </div>
</form>

<!-- RESULTS SECTION -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
    <!-- CALCULATION RESULTS -->
    <div>
      <h3 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ“Š Calculation Results</h3>
      <div id="opt-output" style="background:rgba(20,20,20,0.5);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:16px;min-height:120px;font-family:monospace;line-height:1.6;">
        <div style="color:rgba(230,250,255,0.7);">Select a tool and enter values...</div>
      </div>
      
      <!-- FORMULA DETAILS -->
      <div id="opt-formula-details" style="margin-top:12px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.15);display:none;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:6px;">ğŸ“ Formula:</div>
        <div id="opt-formula-text" style="font-family:monospace;color:rgba(230,250,255,0.9);font-size:14px;"></div>
        <div style="color:rgba(230,250,255,0.7);font-size:12px;margin-top:6px;" id="opt-formula-desc"></div>
      </div>
    </div>
    
    <!-- OPTICS FACTS -->
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <h3 style="color:var(--accent);font-size:14px;margin:0;">âœ¨ Optics Facts</h3>
        <button onclick="optRandomFact()" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">ğŸ² Random Fact</button>
      </div>
      <div id="opt-facts-container" style="background:rgba(20,20,20,0.5);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:16px;max-height:200px;overflow-y:auto;">
        <!-- Facts will be loaded dynamically -->
      </div>
    </div>
  </div>
  
  <!-- OPTICAL PROPERTIES TABLE -->
  <div style="background:rgba(20,20,20,0.3);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:16px;margin-top:20px;">
    <h3 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ“š Common Optical Properties</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div style="background:rgba(255,255,255,0.03);border-radius:6px;padding:10px;">
        <div style="color:#ffcc00;font-size:13px;">ğŸ’§ Water</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);">n â‰ˆ 1.33</div>
      </div>
      <div style="background:rgba(255,255,255,0.03);border-radius:6px;padding:10px;">
        <div style="color:#2dd4ff;font-size:13px;">ğŸ¥ƒ Glass</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);">n â‰ˆ 1.5-1.9</div>
      </div>
      <div style="background:rgba(255,255,255,0.03);border-radius:6px;padding:10px;">
        <div style="color:#39ff14;font-size:13px;">ğŸ’ Diamond</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);">n â‰ˆ 2.42</div>
      </div>
      <div style="background:rgba(255,255,255,0.03);border-radius:6px;padding:10px;">
        <div style="color:#ff2d55;font-size:13px;">ğŸ‘ï¸ Eye Lens</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);">n â‰ˆ 1.386-1.406</div>
      </div>
      <div style="background:rgba(255,255,255,0.03);border-radius:6px;padding:10px;">
        <div style="color:#9d4edd;font-size:13px;">ğŸŒŒ Vacuum</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.8);">c = 299,792,458 m/s</div>
      </div>
    </div>
  </div>
</div>

<!-- LIGHT SIMULATION (VISUAL) -->
<div style="margin-top:20px;background:rgba(20,20,20,0.5);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:16px;">
  <h3 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ¨ Light Behavior Simulation</h3>
  <div style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;margin-bottom:12px;">
    <div style="flex:1;min-width:200px;">
      <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Simulation Type</label>
      <select id="opt-sim-type" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
        <option value="refraction">Refraction</option>
        <option value="reflection">Reflection</option>
        <option value="lens">Lens Focusing</option>
        <option value="prism">Prism Dispersion</option>
      </select>
    </div>
    <div>
      <button onclick="optRunSimulation()" style="padding:10px 16px;background:linear-gradient(135deg, rgba(157,78,221,0.2), rgba(157,78,221,0.1));border:1px solid rgba(157,78,221,0.4);border-radius:8px;color:#9d4edd;cursor:pointer;font-weight:600;">â–¶ï¸ Run Simulation</button>
    </div>
  </div>
  
  <div id="opt-simulation-canvas" style="background:rgba(0,0,0,0.3);border-radius:8px;height:120px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.05);">
    <!-- Simulation visualization will be drawn here -->
    <div style="position:absolute;top:50%;left:0;right:0;text-align:center;color:rgba(230,250,255,0.5);">
      Click "Run Simulation" to visualize light behavior
    </div>
  </div>
</div>

<script>
/* optics-calculator.html
   - Comprehensive optics calculator with simulations
   - Scoped with opt- prefix
*/

// Optics facts database
const optFacts = [
  {fact: "Light travels at 299,792,458 meters per second in a vacuum - the universal speed limit!", category: "speed", emoji: "âš¡"},
  {fact: "Rainbows form when sunlight refracts, reflects, and disperses in water droplets at a 42Â° angle.", category: "weather", emoji: "ğŸŒˆ"},
  {fact: "Fiber optics use total internal reflection to transmit data at nearly the speed of light.", category: "technology", emoji: "ğŸ”Œ"},
  {fact: "The human eye lens changes shape (accommodation) to focus on objects at different distances.", category: "biology", emoji: "ğŸ‘ï¸"},
  {fact: "Mirages are optical illusions caused by refraction of light through layers of air with different temperatures.", category: "illusion", emoji: "ğŸœï¸"},
  {fact: "Polarized sunglasses block horizontally polarized light to reduce glare from reflective surfaces.", category: "technology", emoji: "ğŸ•¶ï¸"},
  {fact: "Lasers produce coherent light where all waves are in phase and travel in the same direction.", category: "physics", emoji: "ğŸ”¦"},
  {fact: "The Hubble Space Telescope can see objects 13.4 billion light-years away - almost to the beginning of the universe.", category: "astronomy", emoji: "ğŸ”­"},
  {fact: "Diffraction causes light to bend around obstacles and creates interference patterns.", category: "physics", emoji: "ğŸŒ€"},
  {fact: "The blue color of the sky (Rayleigh scattering) occurs because blue light scatters more than other colors.", category: "atmosphere", emoji: "â˜ï¸"},
  {fact: "Photonic crystals can manipulate light to create 'invisibility cloaks' in certain wavelengths.", category: "technology", emoji: "ğŸ‘»"},
  {fact: "The human eye can detect a single photon under ideal conditions - the ultimate sensitivity!", category: "biology", emoji: "ğŸ‘ï¸"},
  {fact: "Optical tweezers use laser light to trap and manipulate microscopic particles without physical contact.", category: "technology", emoji: "ğŸ”¬"},
  {fact: "The speed of light in water is about 225,000 km/s - 75% of its speed in a vacuum.", category: "physics", emoji: "ğŸ’§"},
  {fact: "Some deep-sea fish use bioluminescence to create light through chemical reactions.", category: "biology", emoji: "ğŸ "}
];

// Optical tool configurations
const optTools = {
  lens: {
    name: "Lens Equation",
    formula: "1/f = 1/do + 1/di",
    description: "Relates focal length (f) to object distance (do) and image distance (di).",
    inputs: [
      {id: "do", label: "Object Distance (do)", unit: "m", placeholder: "e.g., 0.5"},
      {id: "di", label: "Image Distance (di)", unit: "m", placeholder: "e.g., 0.3"}
    ],
    calculate: (vals) => {
      const f = (vals.do * vals.di) / (vals.do + vals.di);
      return `Focal length: f = ${f.toFixed(4)} m\nPower: P = ${(1/f).toFixed(2)} diopters`;
    }
  },
  magnification: {
    name: "Magnification",
    formula: "M = -di/do",
    description: "Linear magnification of an optical system.",
    inputs: [
      {id: "do", label: "Object Distance (do)", unit: "m", placeholder: "e.g., 0.2"},
      {id: "di", label: "Image Distance (di)", unit: "m", placeholder: "e.g., 0.4"}
    ],
    calculate: (vals) => {
      const M = -(vals.di / vals.do);
      return `Magnification: M = ${M.toFixed(2)}\nImage is ${M > 0 ? 'upright' : 'inverted'} and ${Math.abs(M) > 1 ? 'enlarged' : 'reduced'}`;
    }
  },
  refraction: {
    name: "Refractive Index",
    formula: "n = c/v",
    description: "Speed of light in vacuum divided by speed in medium.",
    inputs: [
      {id: "c", label: "Speed in Vacuum (c)", unit: "m/s", placeholder: "299792458"},
      {id: "v", label: "Speed in Medium (v)", unit: "m/s", placeholder: "200000000"}
    ],
    calculate: (vals) => {
      const n = vals.c / vals.v;
      return `Refractive index: n = ${n.toFixed(3)}\nLight slows to ${(100/n).toFixed(1)}% of vacuum speed`;
    }
  },
  critical_angle: {
    name: "Critical Angle",
    formula: "Î¸c = sinâ»Â¹(n2/n1)",
    description: "Angle for total internal reflection.",
    inputs: [
      {id: "n1", label: "Refractive Index 1 (n1)", unit: "", placeholder: "e.g., 1.5"},
      {id: "n2", label: "Refractive Index 2 (n2)", unit: "", placeholder: "e.g., 1.0"}
    ],
    calculate: (vals) => {
      if (vals.n2 >= vals.n1) return "No total internal reflection (n2 â‰¥ n1)";
      const thetaC = Math.asin(vals.n2 / vals.n1) * (180 / Math.PI);
      return `Critical angle: Î¸c = ${thetaC.toFixed(2)}Â°\nTotal internal reflection occurs above this angle`;
    }
  },
  lens_power: {
    name: "Lens Power",
    formula: "P = 1/f",
    description: "Optical power in diopters (inverse of focal length in meters).",
    inputs: [
      {id: "f", label: "Focal Length (f)", unit: "m", placeholder: "e.g., 0.25"}
    ],
    calculate: (vals) => {
      const P = 1 / vals.f;
      return `Lens power: P = ${P.toFixed(2)} D\n${P > 0 ? 'Converging (positive) lens' : 'Diverging (negative) lens'}`;
    }
  },
  wavelength: {
    name: "Wavelength â†” Frequency",
    formula: "f = c/Î», Î» = c/f",
    description: "Convert between wavelength and frequency of light.",
    inputs: [
      {id: "value", label: "Value", unit: "", placeholder: "e.g., 500"},
      {id: "type", label: "Type", unit: "", type: "select", options: [
        {value: "wavelength_nm", label: "Wavelength (nm)"},
        {value: "frequency_hz", label: "Frequency (Hz)"}
      ]}
    ],
    calculate: (vals) => {
      const c = 299792458; // m/s
      if (vals.type === "wavelength_nm") {
        const lambda = vals.value * 1e-9; // nm to m
        const f = c / lambda;
        return `Wavelength: ${vals.value} nm\nFrequency: ${(f/1e12).toFixed(2)} THz\nColor: ${getColorFromWavelength(vals.value)}`;
      } else {
        const f = vals.value;
        const lambda = c / f;
        return `Frequency: ${(f/1e12).toFixed(2)} THz\nWavelength: ${(lambda*1e9).toFixed(2)} nm\nColor: ${getColorFromWavelength(lambda*1e9)}`;
      }
    }
  }
};

// Preset configurations
const optPresets = {
  camera: {tool: "lens", values: {do: 2, di: 0.05}, name: "Camera Lens"},
  microscope: {tool: "magnification", values: {do: 0.02, di: 0.16}, name: "Microscope"},
  telescope: {tool: "magnification", values: {do: 1000, di: 0.5}, name: "Telescope"},
  eye: {tool: "lens_power", values: {f: 0.017}, name: "Human Eye"},
  glass: {tool: "refraction", values: {c: 299792458, v: 199861639}, name: "Glass Prism"}
};

// Helper functions
function getColorFromWavelength(nm) {
  if (nm < 450) return "Violet";
  if (nm < 485) return "Blue";
  if (nm < 500) return "Cyan";
  if (nm < 565) return "Green";
  if (nm < 590) return "Yellow";
  if (nm < 625) return "Orange";
  return "Red";
}

// Main functions
function optInitialize() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Load facts
  const factsContainer = card.querySelector('#opt-facts-container');
  factsContainer.innerHTML = '';
  optFacts.slice(0, 5).forEach(fact => {
    const factEl = document.createElement('div');
    factEl.style.cssText = 'margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.05);';
    factEl.innerHTML = `<div style="color:var(--accent);font-size:12px;">${fact.emoji} ${fact.category}</div>
                       <div style="color:rgba(230,250,255,0.9);font-size:13px;margin-top:2px;">${fact.fact}</div>`;
    factsContainer.appendChild(factEl);
  });
  
  // Set up tool selector
  const toolSelect = card.querySelector('#opt-tool');
  toolSelect.addEventListener('change', optUpdateInputs);
  
  // Initialize inputs
  optUpdateInputs();
}

function optUpdateInputs() {
  const card = document.currentScript?.closest('.card') || document;
  const tool = card.querySelector('#opt-tool').value;
  const container = card.querySelector('#opt-inputs-container');
  const toolConfig = optTools[tool];
  
  container.innerHTML = '';
  
  toolConfig.inputs.forEach(input => {
    const inputDiv = document.createElement('div');
    
    if (input.type === 'select') {
      inputDiv.innerHTML = `
        <label style="display:block;margin-bottom:4px;color:rgba(230,250,255,0.8);font-size:13px;">${input.label}</label>
        <select id="opt-input-${input.id}" 
                style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          ${input.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('')}
        </select>
      `;
    } else {
      inputDiv.innerHTML = `
        <label style="display:block;margin-bottom:4px;color:rgba(230,250,255,0.8);font-size:13px;">${input.label}</label>
        <input type="number" id="opt-input-${input.id}" 
               placeholder="${input.placeholder}"
               style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
        <div style="color:rgba(230,250,255,0.5);font-size:11px;margin-top:2px;">${input.unit}</div>
      `;
    }
    
    container.appendChild(inputDiv);
  });
  
  // Update formula display
  const formulaText = card.querySelector('#opt-formula-text');
  const formulaDesc = card.querySelector('#opt-formula-desc');
  const formulaDetails = card.querySelector('#opt-formula-details');
  
  formulaText.textContent = toolConfig.formula;
  formulaDesc.textContent = toolConfig.description;
  formulaDetails.style.display = 'block';
}

function optCalculate() {
  const card = document.currentScript?.closest('.card') || document;
  const tool = card.querySelector('#opt-tool').value;
  const toolConfig = optTools[tool];
  const units = card.querySelector('#opt-units').value;
  
  // Collect values
  const values = {};
  toolConfig.inputs.forEach(input => {
    const inputEl = card.querySelector(`#opt-input-${input.id}`);
    if (inputEl) {
      let value = parseFloat(inputEl.value);
      
      // Convert units if needed
      if (units === 'cm' && input.unit === 'm') value /= 100;
      if (units === 'mm' && input.unit === 'm') value /= 1000;
      
      if (input.type === 'select') {
        values[input.id] = inputEl.value;
      } else {
        values[input.id] = value;
      }
    }
  });
  
  // Calculate
  try {
    const result = toolConfig.calculate(values);
    const outputDiv = card.querySelector('#opt-output');
    outputDiv.innerHTML = `<div style="color:#fff;font-weight:500;margin-bottom:6px;">${toolConfig.name}</div>
                          <div style="color:rgba(230,250,255,0.9);white-space:pre-line;">${result}</div>`;
    
    // Add unit info
    const unitText = units === 'si' ? 'SI units' : units.toUpperCase();
    outputDiv.innerHTML += `<div style="color:rgba(230,250,255,0.5);font-size:12px;margin-top:8px;">ğŸ”„ Using ${unitText}</div>`;
  } catch (error) {
    card.querySelector('#opt-output').innerHTML = `<div style="color:#ff2d55;">Error: Please check your inputs</div>`;
  }
}

function optApplyPreset(presetName) {
  const card = document.currentScript?.closest('.card') || document;
  const preset = optPresets[presetName];
  
  if (!preset) return;
  
  // Select the tool
  card.querySelector('#opt-tool').value = preset.tool;
  optUpdateInputs();
  
  // Fill in values
  setTimeout(() => {
    Object.entries(preset.values).forEach(([key, value]) => {
      const inputEl = card.querySelector(`#opt-input-${key}`);
      if (inputEl) inputEl.value = value;
    });
    
    // Update output to show preset info
    const outputDiv = card.querySelector('#opt-output');
    outputDiv.innerHTML = `<div style="color:var(--accent);font-weight:500;">${preset.name} Preset Loaded</div>
                          <div style="color:rgba(230,250,255,0.8);margin-top:4px;">Ready to calculate!</div>`;
  }, 100);
}

function optRandomFact() {
  const card = document.currentScript?.closest('.card') || document;
  const randomIndex = Math.floor(Math.random() * optFacts.length);
  const fact = optFacts[randomIndex];
  
  // Show notification
  const factsContainer = card.querySelector('#opt-facts-container');
  factsContainer.innerHTML = `
    <div style="text-align:center;padding:20px;">
      <div style="font-size:32px;margin-bottom:8px;">${fact.emoji}</div>
      <div style="color:var(--accent);font-weight:500;margin-bottom:6px;">${fact.category}</div>
      <div style="color:rgba(230,250,255,0.9);font-size:14px;line-height:1.4;">${fact.fact}</div>
      <div style="margin-top:12px;">
        <button onclick="optInitialize()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Show All Facts</button>
      </div>
    </div>
  `;
}

function optRunSimulation() {
  const card = document.currentScript?.closest('.card') || document;
  const simType = card.querySelector('#opt-sim-type').value;
  const canvas = card.querySelector('#opt-simulation-canvas');
  
  // Clear and prepare canvas
  canvas.innerHTML = '';
  canvas.style.height = '120px';
  
  // Create visual representation
  const vis = document.createElement('div');
  vis.style.cssText = 'position:relative;width:100%;height:100%;background:linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.8));';
  
  switch(simType) {
    case 'refraction':
      vis.innerHTML = `
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:1px;background:rgba(255,255,255,0.1);"></div>
        <div style="position:absolute;top:20%;left:30%;width:60px;height:2px;background:linear-gradient(90deg, #ff2d55, #ffcc00);transform:rotate(30deg);transform-origin:left center;"></div>
        <div style="position:absolute;top:20%;left:30%;width:60px;height:2px;background:linear-gradient(90deg, #ffcc00, #2dd4ff);transform:rotate(20deg);transform-origin:left center;"></div>
        <div style="position:absolute;bottom:40%;left:50%;color:rgba(230,250,255,0.7);font-size:12px;">Air â†’ Water refraction</div>
      `;
      break;
      
    case 'reflection':
      vis.innerHTML = `
        <div style="position:absolute;bottom:30%;left:0;right:0;height:2px;background:rgba(255,255,255,0.3);"></div>
        <div style="position:absolute;top:40%;left:40%;width:50px;height:2px;background:linear-gradient(90deg, #2dd4ff, transparent);transform:rotate(-45deg);"></div>
        <div style="position:absolute;top:40%;left:40%;width:50px;height:2px;background:linear-gradient(90deg, #ffcc00, transparent);transform:rotate(45deg);"></div>
        <div style="position:absolute;bottom:50%;left:50%;color:rgba(230,250,255,0.7);font-size:12px;">Angle of incidence = Angle of reflection</div>
      `;
      break;
      
    case 'lens':
      vis.innerHTML = `
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:4px;height:60%;background:rgba(255,255,255,0.2);border-radius:2px;"></div>
        <div style="position:absolute;top:50%;left:30%;width:30px;height:2px;background:linear-gradient(90deg, #2dd4ff, transparent);"></div>
        <div style="position:absolute;top:50%;left:30%;width:30px;height:2px;background:linear-gradient(90deg, #2dd4ff, transparent);transform:rotate(10deg);"></div>
        <div style="position:absolute;top:50%;left:30%;width:30px;height:2px;background:linear-gradient(90deg, #2dd4ff, transparent);transform:rotate(-10deg);"></div>
        <div style="position:absolute;top:50%;left:50%;width:30px;height:2px;background:linear-gradient(90deg, #ffcc00, #ff2d55);transform:translateX(-50%);"></div>
        <div style="position:absolute;bottom:40%;left:50%;color:rgba(230,250,255,0.7);font-size:12px;">Converging lens focusing light</div>
      `;
      break;
      
    case 'prism':
      vis.innerHTML = `
        <div style="position:absolute;top:50%;left:40%;width:0;height:0;border-left:30px solid transparent;border-right:30px solid transparent;border-bottom:60px solid rgba(45,212,255,0.2);"></div>
        <div style="position:absolute;top:20%;left:50%;width:40px;height:2px;background:linear-gradient(90deg, white, #ff2d55, #ffcc00, #2dd4ff, #9d4edd);"></div>
        <div style="position:absolute;top:70%;left:20%;width:60px;height:2px;background:linear-gradient(90deg, #ff2d55, transparent);transform:rotate(30deg);"></div>
        <div style="position:absolute;top:70%;left:20%;width:60px;height:2px;background:linear-gradient(90deg, #2dd4ff, transparent);transform:rotate(20deg);"></div>
        <div style="position:absolute;bottom:40%;left:50%;color:rgba(230,250,255,0.7);font-size:12px;">Prism dispersing white light</div>
      `;
      break;
  }
  
  canvas.appendChild(vis);
}

function optReset() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Reset tool to default
  card.querySelector('#opt-tool').value = 'lens';
  optUpdateInputs();
  
  // Clear results
  card.querySelector('#opt-output').innerHTML = '<div style="color:rgba(230,250,255,0.7);">Select a tool and enter values...</div>';
  
  // Reset simulation
  card.querySelector('#opt-simulation-canvas').innerHTML = '<div style="position:absolute;top:50%;left:0;right:0;text-align:center;color:rgba(230,250,255,0.5);">Click "Run Simulation" to visualize light behavior</div>';
  
  // Reload facts
  optInitialize();
}

function optCopy() {
  const card = document.currentScript?.closest('.card') || document;
  const output = card.querySelector('#opt-output').textContent;
  
  if (!output.trim() || output.includes('Select a tool')) {
    return;
  }
  
  navigator.clipboard.writeText(output).then(() => {
    // Show confirmation
    const oldHTML = card.querySelector('#opt-output').innerHTML;
    card.querySelector('#opt-output').innerHTML = oldHTML + '<div style="color:#39ff14;font-size:12px;margin-top:8px;">âœ… Copied to clipboard!</div>';
    
    setTimeout(() => {
      card.querySelector('#opt-output').innerHTML = oldHTML;
    }, 1500);
  });
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', optInitialize);
} else {
  optInitialize();
}
</script>

<style>
/* Optics card specific styles */
#optics-title {
  color: var(--accent);
  margin-top: 0;
  margin-bottom: 8px;
}

.preset-btn {
  padding: 8px 12px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: #e6faff;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
}

.preset-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
  color: var(--accent);
  transform: translateY(-1px);
}

#opt-facts-container {
  scrollbar-width: thin;
  scrollbar-color: var(--accent) rgba(255,255,255,0.05);
}

#opt-facts-container::-webkit-scrollbar {
  width: 6px;
}

#opt-facts-container::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#opt-facts-container::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
}

/* Responsive design */
@media (max-width: 768px) {
  .results > div {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
  
  .preset-btn {
    padding: 10px 14px;
    font-size: 14px;
  }
  
  #opt-inputs-container {
    grid-template-columns: 1fr !important;
  }
}
</style>
