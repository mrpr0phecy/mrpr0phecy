<h2 id="power-calculator-title">‚ö° Power Calculator</h2>

<form aria-describedby="power-calculator-desc">
    <p id="power-calculator-desc" class="small">
        Calculate electrical power values with multiple calculation modes.
        <span style="color:#ffcc00;">‚ö†Ô∏è Educational purposes only ‚Äî consult licensed electrician for actual installations.</span>
    </p>
    
    <!-- CALCULATION MODE SELECTION -->
    <div class="field" style="margin-bottom:20px;">
        <label for="pc-mode" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
            Calculation Mode
        </label>
        <select id="pc-mode" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;"
                onchange="pcUpdateInputs()">
            <option value="basic">Basic Power (P = VI)</option>
            <option value="ac">AC Power with Power Factor</option>
            <option value="three-phase">Three-Phase Power</option>
            <option value="appliance">Appliance Power Consumption</option>
            <option value="wire-sizing">Wire Size Estimation</option>
            <option value="breaker">Breaker Size Calculation</option>
            <option value="energy-cost">Energy Cost Calculator</option>
        </select>
    </div>
    
    <!-- DYNAMIC INPUT FIELDS -->
    <div id="pc-inputs" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:20px;">
        <!-- Basic inputs for basic mode -->
        <div>
            <label for="pc-voltage" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Voltage (V)
            </label>
            <input id="pc-voltage" type="number" placeholder="e.g., 120" step="any"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                Common: 120V (US), 230V (EU), 240V (AU)
            </div>
        </div>
        
        <div>
            <label for="pc-current" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Current (A)
            </label>
            <input id="pc-current" type="number" placeholder="e.g., 10" step="any"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                Maximum circuit current
            </div>
        </div>
    </div>
    
    <!-- ADDITIONAL INPUTS (Appear based on mode) -->
    <div id="pc-extra-inputs" style="display:none;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:20px;">
        <!-- Will be populated dynamically -->
    </div>
    
    <!-- VOLTAGE PRESETS -->
    <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
        <div style="color:var(--accent);font-weight:500;margin-bottom:8px;font-size:14px;">Quick Voltage Presets:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="pcSetVoltage(120)" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">120V (US)</button>
            <button type="button" onclick="pcSetVoltage(230)" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">230V (EU)</button>
            <button type="button" onclick="pcSetVoltage(240)" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">240V (AU/UK)</button>
            <button type="button" onclick="pcSetVoltage(110)" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">110V (JP)</button>
            <button type="button" onclick="pcSetVoltage(220)" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">220V (CN)</button>
        </div>
    </div>
    
    <!-- SAFETY WARNING -->
    <div style="margin-bottom:20px;padding:12px;background:linear-gradient(135deg, rgba(255,77,77,0.1), rgba(255,165,0,0.1));border-radius:8px;border:1px solid rgba(255,77,77,0.3);">
        <div style="color:#ff2d55;font-weight:600;margin-bottom:6px;">‚ö†Ô∏è IMPORTANT SAFETY NOTICE</div>
        <div style="color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
            This calculator is for <strong>educational purposes only</strong>. Always consult a licensed electrician for actual installations. 
            Electrical work can be dangerous and must comply with local codes and regulations.
        </div>
    </div>
    
    <!-- ACTIONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="pcCalculate()" 
                style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            ‚ö° Calculate Power
        </button>
        <button type="button" onclick="pcReset()"
                style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            Reset
        </button>
        <button type="button" onclick="pcCopyResults()" id="pc-copy-btn"
                style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
            üìã Copy
        </button>
    </div>
</form>

<!-- RESULTS -->
<div class="results" aria-live="polite" style="margin-top:16px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìä Calculation Results</h3>
    
    <div id="pc-output" style="padding:20px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);min-height:150px;">
        <div style="text-align:center;color:rgba(230,250,255,0.6);padding:40px 20px;">
            <div style="font-size:48px;margin-bottom:16px;">‚ö°</div>
            <h3 style="color:var(--accent);margin-bottom:8px;">Power Calculator Ready</h3>
            <p>Select a calculation mode and enter values to begin.</p>
        </div>
    </div>
    
    <!-- DETAILED RESULTS GRID -->
    <div id="pc-results-grid" style="display:none;margin-top:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;">
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Real Power (W)</div>
                <div id="pc-real-power" style="font-size:28px;font-weight:700;color:var(--accent);">‚Äì</div>
            </div>
            
            <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Apparent Power (VA)</div>
                <div id="pc-apparent-power" style="font-size:28px;font-weight:700;color:#9d4edd;">‚Äì</div>
            </div>
            
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Current (A)</div>
                <div id="pc-result-current" style="font-size:28px;font-weight:700;color:#39ff14;">‚Äì</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Safety Margin</div>
                <div id="pc-safety-margin" style="font-size:28px;font-weight:700;color:#ffa500;">‚Äì</div>
            </div>
        </div>
    </div>
    
    <!-- TECHNICAL DETAILS -->
    <div id="pc-technical-details" style="display:none;margin-top:20px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
        <h4 style="color:var(--accent);margin-bottom:12px;">üîß Technical Details</h4>
        <div id="pc-details-content" style="font-family:monospace;font-size:13px;line-height:1.6;white-space:pre-line;"></div>
    </div>
</div>

<!-- SAFETY INFORMATION -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(255,77,77,0.05), rgba(255,165,0,0.05));border-radius:8px;border:1px solid rgba(255,77,77,0.3);">
    <h3 class="small" style="color:#ff2d55;margin-bottom:8px;">‚ö†Ô∏è Electrical Safety Information</h3>
    <ul style="margin:0;padding-left:20px;color:rgba(230,250,255,0.9);font-size:14px;line-height:1.6;">
        <li>Always turn off power at the breaker before working on electrical circuits</li>
        <li>Use proper personal protective equipment (PPE)</li>
        <li>Follow National Electrical Code (NEC) or local regulations</li>
        <li>Continuous loads should be calculated at 125% of rated current</li>
        <li>Wire size must be appropriate for current and distance</li>
        <li>Grounding and bonding are critical for safety</li>
        <li>Always have circuits inspected by qualified personnel</li>
    </ul>
</div>

<script>
/* power-calculator.html
   - Comprehensive electrical power calculator
   - Scoped with pc- prefix
*/

// Configuration for different calculation modes
const pcModes = {
    basic: {
        name: "Basic Power Calculation",
        inputs: [
            { id: "pc-voltage", label: "Voltage (V)", required: true },
            { id: "pc-current", label: "Current (A)", required: true }
        ],
        calculate: (voltage, current) => {
            const realPower = voltage * current;
            const apparentPower = realPower;
            return {
                realPower,
                apparentPower,
                current,
                details: `Basic Power Calculation:\nP = V √ó I\nP = ${voltage}V √ó ${current}A = ${realPower}W`
            };
        }
    },
    ac: {
        name: "AC Power with Power Factor",
        inputs: [
            { id: "pc-voltage", label: "Voltage (V)", required: true },
            { id: "pc-current", label: "Current (A)", required: true },
            { id: "pc-power-factor", label: "Power Factor (0-1)", required: true }
        ],
        calculate: (voltage, current, powerFactor) => {
            const apparentPower = voltage * current;
            const realPower = apparentPower * powerFactor;
            const reactivePower = Math.sqrt(apparentPower * apparentPower - realPower * realPower);
            return {
                realPower,
                apparentPower,
                reactivePower,
                powerFactor,
                details: `AC Power Calculation:\nApparent Power (S) = V √ó I = ${voltage}V √ó ${current}A = ${apparentPower}VA\nReal Power (P) = S √ó PF = ${apparentPower}VA √ó ${powerFactor} = ${realPower}W\nPower Factor: ${powerFactor}`
            };
        }
    },
    'three-phase': {
        name: "Three-Phase Power",
        inputs: [
            { id: "pc-voltage", label: "Line Voltage (V)", required: true },
            { id: "pc-current", label: "Current (A)", required: true },
            { id: "pc-power-factor", label: "Power Factor (0-1)", required: true },
            { id: "pc-connection", label: "Connection Type", type: "select", options: ["Delta", "Wye"] }
        ],
        calculate: (voltage, current, powerFactor, connection) => {
            const sqrt3 = Math.sqrt(3);
            const apparentPower = sqrt3 * voltage * current;
            const realPower = apparentPower * powerFactor;
            const phaseVoltage = connection === "Wye" ? voltage / sqrt3 : voltage;
            return {
                realPower,
                apparentPower,
                phaseVoltage,
                connection,
                details: `Three-Phase ${connection} Connection:\nLine Voltage: ${voltage}V\nLine Current: ${current}A\nApparent Power (S) = ‚àö3 √ó V √ó I = ${sqrt3.toFixed(2)} √ó ${voltage} √ó ${current} = ${apparentPower.toFixed(2)}VA\nReal Power (P) = S √ó PF = ${apparentPower.toFixed(2)}VA √ó ${powerFactor} = ${realPower.toFixed(2)}W`
            };
        }
    },
    appliance: {
        name: "Appliance Power Consumption",
        inputs: [
            { id: "pc-power-rating", label: "Power Rating (W)", required: true },
            { id: "pc-hours-per-day", label: "Hours per Day", required: true },
            { id: "pc-days-per-month", label: "Days per Month", required: true },
            { id: "pc-cost-per-kwh", label: "Cost per kWh ($)", required: true }
        ],
        calculate: (power, hoursPerDay, daysPerMonth, costPerKwh) => {
            const dailyConsumption = (power * hoursPerDay) / 1000; // kWh
            const monthlyConsumption = dailyConsumption * daysPerMonth;
            const monthlyCost = monthlyConsumption * costPerKwh;
            const annualCost = monthlyCost * 12;
            return {
                dailyConsumption,
                monthlyConsumption,
                monthlyCost,
                annualCost,
                details: `Appliance Consumption:\nPower: ${power}W\nDaily: ${power}W √ó ${hoursPerDay}h = ${(power * hoursPerDay / 1000).toFixed(2)} kWh\nMonthly: ${dailyConsumption.toFixed(2)} kWh/day √ó ${daysPerMonth} days = ${monthlyConsumption.toFixed(2)} kWh\nCost: ${monthlyConsumption.toFixed(2)} kWh √ó $${costPerKwh}/kWh = $${monthlyCost.toFixed(2)}/month`
            };
        }
    },
    'wire-sizing': {
        name: "Wire Size Estimation",
        inputs: [
            { id: "pc-current", label: "Current (A)", required: true },
            { id: "pc-distance", label: "Distance (feet)", required: true },
            { id: "pc-voltage-drop", label: "Max Voltage Drop (%)", required: true, value: 3 }
        ],
        calculate: (current, distance, maxDropPercent) => {
            // Simplified wire sizing (based on NEC guidelines)
            const voltage = 120; // Assuming standard voltage for calculation
            const maxDrop = voltage * (maxDropPercent / 100);
            
            // American Wire Gauge chart (simplified)
            const wireSizes = [
                { awg: 14, amps: 15, resistance: 2.525 },
                { awg: 12, amps: 20, resistance: 1.588 },
                { awg: 10, amps: 30, resistance: 0.9989 },
                { awg: 8, amps: 40, resistance: 0.6282 },
                { awg: 6, amps: 55, resistance: 0.3951 },
                { awg: 4, amps: 70, resistance: 0.2485 },
                { awg: 2, amps: 95, resistance: 0.1563 }
            ];
            
            let recommendedSize = wireSizes.find(size => size.amps >= current) || wireSizes[wireSizes.length - 1];
            
            return {
                recommendedAWG: recommendedSize.awg,
                maxCurrent: recommendedSize.amps,
                distance,
                details: `Wire Size Estimation:\nCurrent: ${current}A\nDistance: ${distance} feet\nRecommended: AWG ${recommendedSize.awg} (rated for ${recommendedSize.amps}A)\n‚ö†Ô∏è Always consult NEC tables for exact requirements`
            };
        }
    },
    breaker: {
        name: "Breaker Size Calculation",
        inputs: [
            { id: "pc-current", label: "Load Current (A)", required: true },
            { id: "pc-load-type", label: "Load Type", type: "select", options: ["Continuous", "Non-continuous"] }
        ],
        calculate: (current, loadType) => {
            const isContinuous = loadType === "Continuous";
            const breakerSize = isContinuous ? Math.ceil(current * 1.25) : Math.ceil(current);
            
            // Standard breaker sizes
            const standardSizes = [15, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200];
            const selectedBreaker = standardSizes.find(size => size >= breakerSize) || 200;
            
            return {
                breakerSize: selectedBreaker,
                loadType,
                calculated: breakerSize,
                details: `Breaker Size Calculation:\nLoad Current: ${current}A\nLoad Type: ${loadType}\n${isContinuous ? `Continuous load requires 125%: ${current}A √ó 1.25 = ${breakerSize}A\n` : ''}Recommended Breaker: ${selectedBreaker}A\nStandard sizes: 15, 20, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 175, 200A`
            };
        }
    },
    'energy-cost': {
        name: "Energy Cost Calculator",
        inputs: [
            { id: "pc-wattage", label: "Device Wattage (W)", required: true },
            { id: "pc-hours", label: "Hours Used per Day", required: true },
            { id: "pc-cost", label: "Electricity Cost ($/kWh)", required: true, value: 0.13 }
        ],
        calculate: (wattage, hours, costPerKwh) => {
            const dailyKwh = (wattage * hours) / 1000;
            const monthlyKwh = dailyKwh * 30;
            const yearlyKwh = dailyKwh * 365;
            
            const dailyCost = dailyKwh * costPerKwh;
            const monthlyCost = monthlyKwh * costPerKwh;
            const yearlyCost = yearlyKwh * costPerKwh;
            
            return {
                dailyKwh,
                monthlyKwh,
                yearlyKwh,
                dailyCost,
                monthlyCost,
                yearlyCost,
                details: `Energy Cost Calculation:\nDevice: ${wattage}W\nUsage: ${hours} hours/day\nDaily: ${dailyKwh.toFixed(2)} kWh √ó $${costPerKwh} = $${dailyCost.toFixed(2)}\nMonthly: ${monthlyKwh.toFixed(2)} kWh √ó $${costPerKwh} = $${monthlyCost.toFixed(2)}\nYearly: ${yearlyKwh.toFixed(2)} kWh √ó $${costPerKwh} = $${yearlyCost.toFixed(2)}`
            };
        }
    }
};

// Update input fields based on selected mode
function pcUpdateInputs() {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    const extraInputsContainer = card.querySelector('#pc-extra-inputs');
    const basicInputs = card.querySelector('#pc-inputs');
    
    const mode = modeSelect.value;
    const modeConfig = pcModes[mode];
    
    // Clear extra inputs
    extraInputsContainer.innerHTML = '';
    extraInputsContainer.style.display = 'none';
    
    // Hide/show basic inputs based on mode
    if (mode === 'appliance' || mode === 'energy-cost') {
        basicInputs.style.display = 'none';
    } else {
        basicInputs.style.display = 'grid';
    }
    
    // Create additional inputs for the mode
    const extraInputs = modeConfig.inputs.slice(2); // Skip first two (voltage/current or equivalents)
    
    if (extraInputs.length > 0) {
        extraInputsContainer.style.display = 'grid';
        
        extraInputs.forEach((input, index) => {
            const inputId = input.id;
            const div = document.createElement('div');
            
            if (input.type === 'select') {
                div.innerHTML = `
                    <label for="${inputId}" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                        ${input.label}
                    </label>
                    <select id="${inputId}" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
                        ${input.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                    </select>
                `;
            } else {
                div.innerHTML = `
                    <label for="${inputId}" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                        ${input.label}
                    </label>
                    <input id="${inputId}" type="number" placeholder="${input.label}" 
                           value="${input.value || ''}" step="${input.step || 'any'}"
                           style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                `;
            }
            
            extraInputsContainer.appendChild(div);
        });
    }
    
    // Update description based on mode
    const desc = card.querySelector('#power-calculator-desc');
    desc.innerHTML = `${modeConfig.name}. <span style="color:#ffcc00;">‚ö†Ô∏è Educational purposes only ‚Äî consult licensed electrician for actual installations.</span>`;
}

// Set voltage from quick preset
function pcSetVoltage(voltage) {
    const card = document.currentScript?.closest('.card') || document;
    const voltageInput = card.querySelector('#pc-voltage');
    voltageInput.value = voltage;
    voltageInput.style.borderColor = '#39ff14';
    setTimeout(() => {
        voltageInput.style.borderColor = 'rgba(45,212,255,0.3)';
    }, 1000);
}

// Main calculation function
function pcCalculate() {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    const mode = modeSelect.value;
    const modeConfig = pcModes[mode];
    
    // Get input values
    const inputs = [];
    let allValid = true;
    
    // Get basic inputs
    const voltageInput = card.querySelector('#pc-voltage');
    const currentInput = card.querySelector('#pc-current');
    
    if (voltageInput && voltageInput.style.display !== 'none') {
        const voltage = parseFloat(voltageInput.value);
        if (!voltage || voltage <= 0) allValid = false;
        inputs.push(voltage);
    }
    
    if (currentInput && currentInput.style.display !== 'none') {
        const current = parseFloat(currentInput.value);
        if (!current || current <= 0) allValid = false;
        inputs.push(current);
    }
    
    // Get extra inputs
    const extraInputs = card.querySelectorAll('#pc-extra-inputs input, #pc-extra-inputs select');
    extraInputs.forEach(input => {
        if (input.tagName === 'SELECT') {
            inputs.push(input.value);
        } else {
            const value = parseFloat(input.value);
            if (isNaN(value)) allValid = false;
            inputs.push(value);
        }
    });
    
    // Validate inputs
    if (!allValid) {
        card.querySelector('#pc-output').innerHTML = `
            <div style="text-align:center;padding:20px;color:#ff2d55;">
                <div style="font-size:32px;">‚ö†Ô∏è</div>
                <h3 style="color:#ff2d55;margin-top:8px;">Invalid Input</h3>
                <p>Please enter valid numbers in all required fields.</p>
            </div>
        `;
        card.querySelector('#pc-results-grid').style.display = 'none';
        card.querySelector('#pc-technical-details').style.display = 'none';
        return;
    }
    
    // Perform calculation
    try {
        const result = modeConfig.calculate(...inputs);
        
        // Update results display
        pcUpdateResults(result, mode);
        
    } catch (error) {
        console.error('Calculation error:', error);
        card.querySelector('#pc-output').innerHTML = `
            <div style="text-align:center;padding:20px;color:#ff2d55;">
                <div style="font-size:32px;">‚ùå</div>
                <h3 style="color:#ff2d55;margin-top:8px;">Calculation Error</h3>
                <p>An error occurred during calculation. Please check your inputs.</p>
            </div>
        `;
    }
}

// Update results display
function pcUpdateResults(result, mode) {
    const card = document.currentScript?.closest('.card') || document;
    const output = card.querySelector('#pc-output');
    const resultsGrid = card.querySelector('#pc-results-grid');
    const techDetails = card.querySelector('#pc-technical-details');
    const detailsContent = card.querySelector('#pc-details-content');
    
    // Build output HTML based on mode
    let outputHTML = `<div style="padding:20px;">`;
    outputHTML += `<h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;">${pcModes[mode].name}</h3>`;
    
    // Mode-specific display
    switch (mode) {
        case 'basic':
        case 'ac':
        case 'three-phase':
            outputHTML += `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
                    <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Real Power</div>
                        <div style="font-size:32px;font-weight:700;color:var(--accent);">${result.realPower.toFixed(2)} W</div>
                    </div>
                    <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Apparent Power</div>
                        <div style="font-size:32px;font-weight:700;color:#9d4edd;">${result.apparentPower.toFixed(2)} VA</div>
                    </div>
                </div>
            `;
            
            // Update results grid
            card.querySelector('#pc-real-power').textContent = `${result.realPower.toFixed(2)} W`;
            card.querySelector('#pc-apparent-power').textContent = `${result.apparentPower.toFixed(2)} VA`;
            resultsGrid.style.display = 'grid';
            break;
            
        case 'appliance':
            outputHTML += `
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;margin-bottom:20px;">
                    <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Monthly Consumption</div>
                        <div style="font-size:28px;font-weight:700;color:#39ff14;">${result.monthlyConsumption.toFixed(2)} kWh</div>
                    </div>
                    <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Monthly Cost</div>
                        <div style="font-size:28px;font-weight:700;color:#ffa500;">$${result.monthlyCost.toFixed(2)}</div>
                    </div>
                    <div style="padding:12px;background:rgba(255,77,77,0.1);border-radius:8px;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Annual Cost</div>
                        <div style="font-size:28px;font-weight:700;color:#ff2d55;">$${result.annualCost.toFixed(2)}</div>
                    </div>
                </div>
            `;
            resultsGrid.style.display = 'none';
            break;
            
        case 'wire-sizing':
            outputHTML += `
                <div style="text-align:center;padding:20px;background:rgba(45,212,255,0.1);border-radius:8px;margin-bottom:20px;">
                    <div style="font-size:32px;margin-bottom:8px;">üìè</div>
                    <div style="font-size:24px;font-weight:700;color:var(--accent);">AWG ${result.recommendedAWG}</div>
                    <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-top:4px;">
                        Rated for ${result.maxCurrent}A maximum
                    </div>
                </div>
            `;
            resultsGrid.style.display = 'none';
            break;
            
        case 'breaker':
            outputHTML += `
                <div style="text-align:center;padding:20px;background:rgba(255,165,0,0.1);border-radius:8px;margin-bottom:20px;">
                    <div style="font-size:32px;margin-bottom:8px;">üîß</div>
                    <div style="font-size:24px;font-weight:700;color:#ffa500;">${result.breakerSize}A Breaker</div>
                    <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-top:4px;">
                        ${result.loadType} load ‚Ä¢ Calculated: ${result.calculated}A
                    </div>
                </div>
            `;
            resultsGrid.style.display = 'none';
            break;
            
        case 'energy-cost':
            outputHTML += `
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;margin-bottom:20px;">
                    <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;text-align:center;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Daily</div>
                        <div style="font-size:22px;font-weight:700;color:#39ff14;">$${result.dailyCost.toFixed(2)}</div>
                        <div style="font-size:11px;color:rgba(230,250,255,0.6);">${result.dailyKwh.toFixed(2)} kWh</div>
                    </div>
                    <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;text-align:center;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Monthly</div>
                        <div style="font-size:22px;font-weight:700;color:#ffa500;">$${result.monthlyCost.toFixed(2)}</div>
                        <div style="font-size:11px;color:rgba(230,250,255,0.6);">${result.monthlyKwh.toFixed(2)} kWh</div>
                    </div>
                    <div style="padding:12px;background:rgba(255,77,77,0.1);border-radius:8px;text-align:center;">
                        <div style="font-size:13px;color:rgba(230,250,255,0.8);">Yearly</div>
                        <div style="font-size:22px;font-weight:700;color:#ff2d55;">$${result.yearlyCost.toFixed(2)}</div>
                        <div style="font-size:11px;color:rgba(230,250,255,0.6);">${result.yearlyKwh.toFixed(2)} kWh</div>
                    </div>
                </div>
            `;
            resultsGrid.style.display = 'none';
            break;
    }
    
    outputHTML += `</div>`;
    output.innerHTML = outputHTML;
    
    // Update technical details
    detailsContent.textContent = result.details;
    techDetails.style.display = 'block';
}

// Copy results to clipboard
function pcCopyResults() {
    const card = document.currentScript?.closest('.card') || document;
    const output = card.querySelector('#pc-output').textContent;
    const details = card.querySelector('#pc-details-content')?.textContent || '';
    
    if (!output) return;
    
    const textToCopy = `Power Calculation Results:\n\n${output}\n\n${details}`;
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        const copyBtn = card.querySelector('#pc-copy-btn');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.style.background = 'rgba(57,255,20,0.2)';
        copyBtn.style.borderColor = 'rgba(57,255,20,0.4)';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = 'rgba(57,255,20,0.1)';
            copyBtn.style.borderColor = 'rgba(57,255,20,0.3)';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
    });
}

// Reset function
function pcReset() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Reset all inputs
    card.querySelectorAll('input[type="number"]').forEach(input => {
        input.value = '';
    });
    
    // Reset selects to defaults
    card.querySelector('#pc-mode').value = 'basic';
    card.querySelector('#pc-phase').value = 'single';
    
    // Update inputs for basic mode
    pcUpdateInputs();
    
    // Reset results display
    card.querySelector('#pc-output').innerHTML = `
        <div style="text-align:center;color:rgba(230,250,255,0.6);padding:40px 20px;">
            <div style="font-size:48px;margin-bottom:16px;">‚ö°</div>
            <h3 style="color:var(--accent);margin-bottom:8px;">Power Calculator Ready</h3>
            <p>Select a calculation mode and enter values to begin.</p>
        </div>
    `;
    
    card.querySelector('#pc-results-grid').style.display = 'none';
    card.querySelector('#pc-technical-details').style.display = 'none';
    
    // Reset copy button
    const copyBtn = card.querySelector('#pc-copy-btn');
    copyBtn.textContent = 'üìã Copy';
    copyBtn.style.background = 'rgba(57,255,20,0.1)';
    copyBtn.style.borderColor = 'rgba(57,255,20,0.3)';
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Set up mode change listener
        const modeSelect = card.querySelector('#pc-mode');
        modeSelect.addEventListener('change', pcUpdateInputs);
        
        // Initialize with basic mode
        pcUpdateInputs();
        
        // Add auto-calculation on input change (with debounce)
        let debounceTimer;
        const inputs = card.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    // Only auto-calculate if all required fields have values
                    const voltage = card.querySelector('#pc-voltage')?.value;
                    const current = card.querySelector('#pc-current')?.value;
                    if (voltage && current && parseFloat(voltage) > 0 && parseFloat(current) > 0) {
                        pcCalculate();
                    }
                }, 500);
            });
        });
        
        console.log('Power Calculator ready');
    });
}
</script>

<style>
@keyframes pcPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

#power-calculator-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, #ffcc00, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Responsive design */
@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    #pc-inputs,
    #pc-extra-inputs {
        grid-template-columns: 1fr !important;
    }
}

/* Highlight for safety warnings */
#power-calculator-desc span {
    animation: pcPulse 2s infinite;
}

/* Style for quick voltage buttons */
button[onclick^="pcSetVoltage"]:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}
</style>
