<!-- cards/geometry-calculator.html -->

<h2 id="geometry-calculator-title">Geometry Calculator</h2>

<form aria-describedby="geometry-desc">
  <p id="geometry-desc" class="small">Calculate areas, perimeters, and volumes for common shapes. Choose a shape, enter dimensions, and get results with formulas shown.</p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
    <div>
      <label for="geom-shape" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Shape</label>
      <select id="geom-shape" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="circle" selected>‚óã Circle</option>
        <option value="rectangle">‚ñ≠ Rectangle</option>
        <option value="triangle">‚ñ≥ Triangle</option>
        <option value="sphere">‚óè Sphere</option>
        <option value="cube">‚¨õ Cube</option>
        <option value="cylinder">‚¨§ Cylinder</option>
        <option value="cone">‚ñµ Cone</option>
        <option value="trapezoid">‚è¢ Trapezoid</option>
        <option value="ellipse">‚¨Ø Ellipse</option>
      </select>
    </div>

    <div>
      <label for="geom-show-steps" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Show steps</label>
      <select id="geom-show-steps" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </div>

    <div style="grid-column:1 / -1;">
      <label for="geom-dimensions" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Dimensions <span style="color:rgba(230,250,255,0.6);font-weight:400;font-size:13px;">(e.g., radius=5, height=10)</span>
      </label>
      <input id="geom-dimensions" type="text" placeholder="Enter dimensions as key=value pairs, separated by commas"
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-family:monospace;" />
      
      <div style="margin-top:8px;font-size:12px;color:rgba(230,250,255,0.7);">
        Common parameters: <code style="background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;color:var(--accent);">radius</code>
        <code style="background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;color:var(--accent);">width</code>
        <code style="background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;color:var(--accent);">height</code>
        <code style="background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;color:var(--accent);">base</code>
        <code style="background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;color:var(--accent);">side</code>
      </div>
    </div>
  </div>

  <div style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="geomCalculate(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      üßÆ Calculate
    </button>
    <button type="button" onclick="geomReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="geomCopy(this)"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      Copy Result
    </button>
  </div>
</form>

<div aria-live="polite" style="margin-top:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">Calculation Result</h3>
  <textarea id="geom-output" rows="12" 
            style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-family:monospace;resize:vertical;"></textarea>

  <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
    <div style="display:flex;gap:12px;align-items:center;">
      <div style="font-size:13px;color:rgba(230,250,255,0.8);">
        Steps shown: <span id="geom-steps" style="color:var(--accent);font-weight:600;">‚Äì</span>
      </div>
      <div style="font-size:13px;color:rgba(230,250,255,0.8);">
        Decimal places: 
        <select id="geom-precision" style="margin-left:6px;padding:4px 8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;">
          <option value="2">2</option>
          <option value="4" selected>4</option>
          <option value="6">6</option>
          <option value="8">8</option>
        </select>
      </div>
    </div>
    <div id="geom-hint" style="font-size:13px;color:rgba(230,250,255,0.7);text-align:right;"></div>
  </div>
</div>

<div style="margin-top:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
  <h4 style="color:var(--accent);margin-top:0;margin-bottom:12px;">üìê Geometry Formulas Reference</h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;font-size:13px;">
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">‚óã Circle</div>
      <div style="color:rgba(230,250,255,0.8);">Area = œÄr¬≤</div>
      <div style="color:rgba(230,250,255,0.8);">Circumference = 2œÄr</div>
    </div>
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">‚ñ≠ Rectangle</div>
      <div style="color:rgba(230,250,255,0.8);">Area = w √ó h</div>
      <div style="color:rgba(230,255,230,0.8);">Perimeter = 2(w + h)</div>
    </div>
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">‚ñ≥ Triangle</div>
      <div style="color:rgba(230,250,255,0.8);">Area = ¬Ω √ó b √ó h</div>
      <div style="color:rgba(230,250,255,0.8);">Perimeter = a + b + c</div>
    </div>
  </div>
</div>

<script>
/* geometry-calculator.html
   - Geometry calculator for areas, perimeters, and volumes
   - Scoped with geom- prefix (to avoid conflict with geology)
*/

// Shape definitions with formulas
const shapeFormulas = {
  circle: {
    name: 'Circle',
    emoji: '‚óã',
    params: ['radius'],
    calculations: {
      'Area (A)': (r) => Math.PI * r * r,
      'Circumference (C)': (r) => 2 * Math.PI * r,
      'Diameter (D)': (r) => 2 * r
    },
    formulaDesc: 'A = œÄr¬≤, C = 2œÄr, D = 2r'
  },
  rectangle: {
    name: 'Rectangle',
    emoji: '‚ñ≠',
    params: ['width', 'height'],
    calculations: {
      'Area (A)': (w, h) => w * h,
      'Perimeter (P)': (w, h) => 2 * (w + h),
      'Diagonal (d)': (w, h) => Math.sqrt(w*w + h*h)
    },
    formulaDesc: 'A = w√óh, P = 2(w+h), d = ‚àö(w¬≤+h¬≤)'
  },
  triangle: {
    name: 'Triangle',
    emoji: '‚ñ≥',
    params: ['base', 'height'],
    calculations: {
      'Area (A)': (b, h) => 0.5 * b * h,
      'Perimeter (P)': (a, b, c) => a + b + c
    },
    formulaDesc: 'A = ¬Ωbh, P = a+b+c'
  },
  sphere: {
    name: 'Sphere',
    emoji: '‚óè',
    params: ['radius'],
    calculations: {
      'Surface Area (SA)': (r) => 4 * Math.PI * r * r,
      'Volume (V)': (r) => (4/3) * Math.PI * r * r * r,
      'Diameter (D)': (r) => 2 * r
    },
    formulaDesc: 'SA = 4œÄr¬≤, V = 4/3œÄr¬≥'
  },
  cube: {
    name: 'Cube',
    emoji: '‚¨õ',
    params: ['side'],
    calculations: {
      'Surface Area (SA)': (s) => 6 * s * s,
      'Volume (V)': (s) => s * s * s,
      'Space Diagonal (d)': (s) => s * Math.sqrt(3)
    },
    formulaDesc: 'SA = 6a¬≤, V = a¬≥, d = a‚àö3'
  },
  cylinder: {
    name: 'Cylinder',
    emoji: '‚¨§',
    params: ['radius', 'height'],
    calculations: {
      'Volume (V)': (r, h) => Math.PI * r * r * h,
      'Lateral Surface Area': (r, h) => 2 * Math.PI * r * h,
      'Total Surface Area': (r, h) => 2 * Math.PI * r * (r + h)
    },
    formulaDesc: 'V = œÄr¬≤h, LSA = 2œÄrh, TSA = 2œÄr(r+h)'
  },
  cone: {
    name: 'Cone',
    emoji: '‚ñµ',
    params: ['radius', 'height'],
    calculations: {
      'Volume (V)': (r, h) => (1/3) * Math.PI * r * r * h,
      'Slant Height (l)': (r, h) => Math.sqrt(r*r + h*h),
      'Surface Area (SA)': (r, h) => Math.PI * r * (r + Math.sqrt(r*r + h*h))
    },
    formulaDesc: 'V = ‚ÖìœÄr¬≤h, l = ‚àö(r¬≤+h¬≤), SA = œÄr(r+‚àö(r¬≤+h¬≤))'
  },
  trapezoid: {
    name: 'Trapezoid',
    emoji: '‚è¢',
    params: ['base1', 'base2', 'height'],
    calculations: {
      'Area (A)': (b1, b2, h) => 0.5 * (b1 + b2) * h,
      'Perimeter (P)': (b1, b2, s1, s2) => b1 + b2 + s1 + s2
    },
    formulaDesc: 'A = ¬Ω(b‚ÇÅ+b‚ÇÇ)h, P = a+b+c+d'
  },
  ellipse: {
    name: 'Ellipse',
    emoji: '‚¨Ø',
    params: ['radius_a', 'radius_b'],
    calculations: {
      'Area (A)': (a, b) => Math.PI * a * b,
      'Circumference (approx)': (a, b) => Math.PI * (3*(a+b) - Math.sqrt((3*a+b)*(a+3*b)))
    },
    formulaDesc: 'A = œÄab, C ‚âà œÄ[3(a+b) - ‚àö((3a+b)(a+3b))]'
  }
};

function geomReset(btn) {
  const card = btn.closest('.card') || document;
  card.querySelector('#geom-shape').value = 'circle';
  card.querySelector('#geom-dimensions').value = '';
  card.querySelector('#geom-show-steps').value = 'yes';
  card.querySelector('#geom-precision').value = '4';
  card.querySelector('#geom-output').value = '';
  card.querySelector('#geom-steps').textContent = '‚Äì';
  card.querySelector('#geom-hint').textContent = '';
}

function geomCopy(btn) {
  const card = btn.closest('.card') || document;
  const output = card.querySelector('#geom-output').value;
  if (!output.trim()) {
    geomShowHint(card, 'No results to copy', '#ff4d4d');
    return;
  }
  
  navigator.clipboard.writeText(output).then(() => {
    geomShowHint(card, '‚úÖ Result copied to clipboard!', '#39ff14');
  }).catch(err => {
    console.error('Copy failed:', err);
    geomShowHint(card, 'Copy failed. Try selecting text manually.', '#ff4d4d');
  });
}

function geomCalculate(btn) {
  const card = btn.closest('.card') || document;
  const shapeName = card.querySelector('#geom-shape').value;
  const dimensionsInput = card.querySelector('#geom-dimensions').value.trim();
  const showSteps = card.querySelector('#geom-show-steps').value === 'yes';
  const precision = parseInt(card.querySelector('#geom-precision').value) || 4;
  
  if (!dimensionsInput) {
    geomShowHint(card, 'Please enter dimensions', '#ff4d4d');
    return;
  }
  
  const shape = shapeFormulas[shapeName];
  if (!shape) {
    geomShowHint(card, 'Shape not found', '#ff4d4d');
    return;
  }
  
  // Parse dimensions
  const params = {};
  const dimPairs = dimensionsInput.split(',').map(pair => pair.trim());
  
  try {
    for (const pair of dimPairs) {
      const [key, value] = pair.split('=').map(s => s.trim());
      if (key && value) {
        const numValue = parseFloat(value);
        if (isNaN(numValue)) {
          throw new Error(`Invalid number: ${value}`);
        }
        params[key] = numValue;
      }
    }
    
    // Check if we have all required parameters
    const missingParams = shape.params.filter(p => !(p in params));
    if (missingParams.length > 0) {
      geomShowHint(card, `Missing parameters: ${missingParams.join(', ')}`, '#ff4d4d');
      return;
    }
    
    // Get parameter values in correct order
    const paramValues = shape.params.map(p => params[p]);
    
    // Calculate results
    let output = `${shape.emoji} ${shape.name}\n`;
    output += '='.repeat(shape.name.length + 3) + '\n\n';
    
    output += `Formula: ${shape.formulaDesc}\n\n`;
    output += `Parameters:\n`;
    shape.params.forEach(param => {
      output += `  ${param} = ${params[param]}\n`;
    });
    output += '\n';
    
    output += 'Results:\n';
    for (const [label, calcFunc] of Object.entries(shape.calculations)) {
      try {
        // For functions expecting more parameters than we have (like triangle perimeter)
        const funcParams = shape.params.map(p => params[p]);
        const result = calcFunc(...funcParams);
        
        // Format the result
        const formatted = result.toFixed(precision);
        output += `  ${label} = ${formatted}\n`;
        
        // Add calculation steps if requested
        if (showSteps) {
          // Create a simple step description
          const stepDesc = `${label}: ${calcFunc.toString().replace('function', '')}`;
          // This is a simplified step - in a more advanced version, you could
          // generate more detailed step-by-step calculations
        }
      } catch (calcError) {
        output += `  ${label} = (calculation error)\n`;
      }
    }
    
    // Add unit reminder
    output += '\nNote: All results are in square/linear/cubic units based on input units.';
    
    // Set output
    card.querySelector('#geom-output').value = output;
    card.querySelector('#geom-steps').textContent = showSteps ? 'Yes' : 'No';
    geomShowHint(card, `‚úÖ ${shape.name} calculated successfully!`, '#39ff14');
    
  } catch (error) {
    console.error('Calculation error:', error);
    card.querySelector('#geom-output').value = `Error: ${error.message}\n\nPlease use format: key=value, key=value\nExample: radius=5, height=10`;
    geomShowHint(card, '‚ùå Invalid input format', '#ff4d4d');
  }
}

function geomShowHint(card, message, color = '#2dd4ff') {
  const hint = card.querySelector('#geom-hint');
  hint.textContent = message;
  hint.style.color = color;
  
  // Clear hint after 3 seconds (unless it's a permanent error)
  if (!message.startsWith('‚ùå')) {
    setTimeout(() => {
      if (hint.textContent === message) {
        hint.textContent = '';
      }
    }, 3000);
  }
}

// Auto-fill examples based on selected shape
function updateExample() {
  const card = document.currentScript?.closest('.card') || document;
  const shapeName = card.querySelector('#geom-shape').value;
  const shape = shapeFormulas[shapeName];
  
  if (shape) {
    const examples = {
      'circle': 'radius=5',
      'rectangle': 'width=10, height=6',
      'triangle': 'base=8, height=5',
      'sphere': 'radius=3',
      'cube': 'side=4',
      'cylinder': 'radius=3, height=7',
      'cone': 'radius=4, height=9',
      'trapezoid': 'base1=6, base2=10, height=5',
      'ellipse': 'radius_a=8, radius_b=5'
    };
    
    const dimInput = card.querySelector('#geom-dimensions');
    if (!dimInput.value.trim()) {
      dimInput.placeholder = `e.g., ${examples[shapeName]}`;
    }
  }
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set initial example
    updateExample();
    
    // Update example when shape changes
    card.querySelector('#geom-dimensions').addEventListener('focus', updateExample);
    
    // Auto-calculate on Enter key in dimensions field
    card.querySelector('#geom-dimensions').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        geomCalculate({closest: () => card});
      }
    });
    
    // Auto-calculate on shape change
    card.querySelector('#geom-shape').addEventListener('change', updateExample);
    
    console.log('Geometry Calculator ready');
  });
} else {
  setTimeout(updateExample, 100);
}
</script>

<style>
#geometry-calculator-title {
  color: var(--accent);
  margin-top: 0;
  border-bottom: 1px solid rgba(45,212,255,0.2);
  padding-bottom: 10px;
  margin-bottom: 16px;
}

#geom-output {
  font-family: 'Courier New', Monaco, monospace !important;
  line-height: 1.5;
  white-space: pre;
  overflow-x: auto;
  background: rgba(0, 0, 0, 0.3) !important;
}

#geom-dimensions::placeholder {
  color: rgba(230,250,255,0.4);
  font-family: inherit;
}

code {
  font-family: 'Courier New', Monaco, monospace;
  font-size: 0.9em;
}

@media (max-width: 768px) {
  div[style*="grid-template-columns:1fr 1fr"] {
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin-bottom: 8px;
  }
  
  div[style*="grid-template-columns:repeat(auto-fit"] {
    grid-template-columns: 1fr !important;
  }
}
</style>
