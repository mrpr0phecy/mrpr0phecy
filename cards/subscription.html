<div class="card" id="subscription-card">
  <div class="card-header">
    <div class="header-content">
      <div class="icon-container">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="5" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="2" y1="10" x2="22" y2="10"></line>
        </svg>
      </div>
      <div>
        <h2 id="subscription-title" class="card-title">Subscription Tracker</h2>
        <p id="subscription-desc" class="card-subtitle">
          Track your subscriptions, manage renewals, and optimize spending
        </p>
      </div>
    </div>
    <div class="header-actions">
      <button class="icon-button" onclick="toggleSubscriptionView()" title="Toggle view">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
      </button>
      <button class="icon-button" onclick="exportSubscriptions()" title="Export data">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
    </div>
  </div>

  <div class="card-body">
    <!-- Quick Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Monthly</div>
        <div class="stat-value" id="monthly-total">Â£0.00</div>
        <div class="stat-change" id="monthly-change">+0%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Yearly</div>
        <div class="stat-value" id="yearly-total">Â£0.00</div>
        <div class="stat-subtext" id="yearly-savings">Potential: Â£0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active</div>
        <div class="stat-value" id="active-count">0</div>
        <div class="stat-subtext">Subscriptions</div>
      </div>
      <div class="stat-card alert">
        <div class="stat-label">Next Due</div>
        <div class="stat-value" id="next-renewal">â€“</div>
        <div class="stat-subtext" id="next-days">in 0 days</div>
      </div>
    </div>

    <!-- Add Subscription Form -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">Add Subscription</h3>
        <button class="text-button" onclick="toggleForm()">Hide Form</button>
      </div>
      
      <div id="subscription-form" class="form-container">
        <div class="form-row">
          <div class="form-group">
            <label for="sub-name" class="form-label">Service Name</label>
            <input type="text" id="sub-name" class="form-input" placeholder="Netflix, Spotify..." autocomplete="off">
          </div>
          <div class="form-group">
            <label for="sub-category" class="form-label">Category</label>
            <select id="sub-category" class="form-select">
              <option value="entertainment">Entertainment</option>
              <option value="productivity">Productivity</option>
              <option value="software">Software</option>
              <option value="cloud">Cloud Services</option>
              <option value="fitness">Fitness & Health</option>
              <option value="news">News & Media</option>
              <option value="food">Food Delivery</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sub-cost" class="form-label">Cost</label>
            <div class="input-group">
              <select id="sub-currency" class="form-select currency-select">
                <option value="GBP">Â£</option>
                <option value="USD">$</option>
                <option value="EUR">â‚¬</option>
                <option value="CAD">C$</option>
              </select>
              <input type="number" id="sub-cost" class="form-input" min="0" step="0.01" placeholder="9.99">
              <select id="sub-cycle" class="form-select cycle-select">
                <option value="monthly">/month</option>
                <option value="yearly">/year</option>
                <option value="quarterly">/quarter</option>
                <option value="weekly">/week</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="sub-date" class="form-label">Renewal Date</label>
            <input type="date" id="sub-date" class="form-input">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sub-status" class="form-label">Status</label>
            <div class="status-selector">
              <button type="button" class="status-option active" data-status="active">Active</button>
              <button type="button" class="status-option" data-status="pending">Pending</button>
              <button type="button" class="status-option" data-status="trial">Trial</button>
              <button type="button" class="status-option" data-status="cancelled">Cancelled</button>
            </div>
          </div>
          <div class="form-group">
            <label for="sub-notes" class="form-label">Notes (Optional)</label>
            <input type="text" id="sub-notes" class="form-input" placeholder="Annual plan, shared account...">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-primary" onclick="addSubscription()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Subscription
          </button>
          <button type="button" class="btn btn-secondary" onclick="quickAdd()">Quick Add</button>
          <button type="button" class="btn btn-text" onclick="clearForm()">Clear</button>
        </div>
      </div>
    </div>

    <!-- Subscriptions List -->
    <div class="list-section">
      <div class="section-header">
        <h3 class="section-title">Your Subscriptions</h3>
        <div class="list-controls">
          <div class="filter-group">
            <select id="filter-category" class="form-select small" onchange="filterSubscriptions()">
              <option value="all">All Categories</option>
              <option value="entertainment">Entertainment</option>
              <option value="productivity">Productivity</option>
              <option value="software">Software</option>
            </select>
            <select id="filter-status" class="form-select small" onchange="filterSubscriptions()">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="pending">Pending</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <button class="icon-button small" onclick="sortSubscriptions('cost')" title="Sort by cost">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>

      <div id="subscriptions-list" class="subscriptions-list">
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="5" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="2" y1="10" x2="22" y2="10"></line>
          </svg>
          <h4>No subscriptions yet</h4>
          <p>Add your first subscription to get started</p>
        </div>
      </div>
    </div>

    <!-- Charts & Insights -->
    <div class="insights-section">
      <div class="section-header">
        <h3 class="section-title">Spending Insights</h3>
        <div class="time-selector">
          <button class="time-option active" data-period="monthly">Monthly</button>
          <button class="time-option" data-period="quarterly">Quarterly</button>
          <button class="time-option" data-period="yearly">Yearly</button>
        </div>
      </div>
      
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-header">
            <div class="insight-title">Category Breakdown</div>
            <div class="insight-value" id="breakdown-total">Â£0.00</div>
          </div>
          <div id="category-chart" class="category-chart">
            <!-- Chart will be generated here -->
          </div>
          <div id="category-labels" class="category-labels"></div>
        </div>
        
        <div class="insight-card">
          <div class="insight-header">
            <div class="insight-title">Upcoming Renewals</div>
            <div class="insight-value" id="upcoming-count">0</div>
          </div>
          <div id="upcoming-list" class="upcoming-list">
            <!-- Upcoming renewals will be listed here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Recommendations -->
    <div class="recommendations-section">
      <div class="section-header">
        <h3 class="section-title">Recommendations</h3>
        <button class="text-button small" onclick="refreshRecommendations()">Refresh</button>
      </div>
      <div id="recommendations" class="recommendations-list">
        <div class="recommendation-item">
          <div class="recommendation-icon">ðŸ’¡</div>
          <div class="recommendation-content">
            <div class="recommendation-title">Add your first subscription</div>
            <div class="recommendation-text">Start tracking your monthly expenses</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card-footer">
    <div class="footer-text">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      Data is stored locally in your browser
    </div>
    <div class="footer-actions">
      <button class="btn btn-text small" onclick="importData()">Import</button>
      <button class="btn btn-text small" onclick="resetData()">Reset All</button>
    </div>
  </div>
</div>

<style>
/* Base Variables */
:root {
  --primary-color: #6366f1;
  --primary-light: #818cf8;
  --primary-dark: #4f46e5;
  --secondary-color: #10b981;
  --danger-color: #ef4444;
  --warning-color: #f59e0b;
  --info-color: #3b82f6;
  --surface-color: #1f2937;
  --surface-light: #374151;
  --surface-lighter: #4b5563;
  --text-primary: #f9fafb;
  --text-secondary: #d1d5db;
  --text-tertiary: #9ca3af;
  --border-color: #374151;
  --border-radius: 8px;
  --border-radius-sm: 6px;
  --border-radius-lg: 12px;
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 24px;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Card Container */
.card {
  background: var(--surface-color);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  transition: var(--transition);
}

.card:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

/* Card Header */
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: var(--spacing-xl);
  border-bottom: 1px solid var(--border-color);
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%);
}

.header-content {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
}

.icon-container {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: rgba(99, 102, 241, 0.1);
  border-radius: var(--border-radius);
  color: var(--primary-color);
}

.card-title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.2;
}

.card-subtitle {
  margin: var(--spacing-xs) 0 0;
  font-size: 0.875rem;
  color: var(--text-tertiary);
  line-height: 1.4;
}

.header-actions {
  display: flex;
  gap: var(--spacing-sm);
}

.icon-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
}

.icon-button:hover {
  background: var(--surface-light);
  color: var(--text-primary);
  border-color: var(--primary-light);
}

.icon-button.small {
  width: 32px;
  height: 32px;
}

/* Card Body */
.card-body {
  padding: var(--spacing-xl);
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.stat-card {
  background: var(--surface-light);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: var(--spacing-lg);
  transition: var(--transition);
}

.stat-card:hover {
  transform: translateY(-2px);
  border-color: var(--primary-light);
}

.stat-card.alert {
  border-left: 4px solid var(--warning-color);
}

.stat-label {
  font-size: 0.875rem;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--spacing-xs);
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1;
  margin-bottom: var(--spacing-xs);
}

.stat-change {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--secondary-color);
}

.stat-subtext {
  font-size: 0.75rem;
  color: var(--text-tertiary);
}

/* Form Styles */
.form-section {
  margin-bottom: var(--spacing-xl);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
}

.section-title {
  margin: 0;
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
}

.text-button {
  background: none;
  border: none;
  color: var(--primary-color);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-sm);
  transition: var(--transition);
}

.text-button:hover {
  background: rgba(99, 102, 241, 0.1);
}

.text-button.small {
  font-size: 0.75rem;
}

.form-container {
  background: var(--surface-light);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: var(--spacing-lg);
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-lg);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.form-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-secondary);
}

.form-input {
  padding: var(--spacing-md) var(--spacing-lg);
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  font-size: 0.875rem;
  transition: var(--transition);
}

.form-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-select {
  padding: var(--spacing-md) var(--spacing-lg);
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
}

.form-select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-select.small {
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: 0.75rem;
}

.input-group {
  display: flex;
  gap: var(--spacing-xs);
}

.currency-select {
  width: 80px;
}

.cycle-select {
  width: 120px;
}

.status-selector {
  display: flex;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--border-radius);
}

.status-option {
  flex: 1;
  padding: var(--spacing-sm) var(--spacing-md);
  background: transparent;
  border: none;
  border-radius: var(--border-radius-sm);
  color: var(--text-tertiary);
  font-size: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.status-option:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-secondary);
}

.status-option.active {
  background: var(--primary-color);
  color: white;
}

/* Button Styles */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-xl);
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.btn-primary {
  background: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--surface-lighter);
  color: var(--text-primary);
}

.btn-secondary:hover {
  background: var(--surface-light);
  transform: translateY(-1px);
}

.btn-text {
  background: transparent;
  color: var(--text-tertiary);
}

.btn-text:hover {
  color: var(--text-primary);
  background: rgba(255, 255, 255, 0.05);
}

.form-actions {
  display: flex;
  gap: var(--spacing-md);
  margin-top: var(--spacing-lg);
}

/* List Section */
.list-section {
  margin-bottom: var(--spacing-xl);
}

.list-controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.filter-group {
  display: flex;
  gap: var(--spacing-sm);
}

.subscriptions-list {
  min-height: 200px;
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--surface-light);
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl);
  color: var(--text-tertiary);
  text-align: center;
}

.empty-state svg {
  margin-bottom: var(--spacing-lg);
  color: var(--surface-lighter);
}

.empty-state h4 {
  margin: var(--spacing-sm) 0;
  color: var(--text-secondary);
}

/* Subscription Item */
.subscription-item {
  display: flex;
  align-items: center;
  padding: var(--spacing-lg);
  border-bottom: 1px solid var(--border-color);
  transition: var(--transition);
}

.subscription-item:hover {
  background: rgba(255, 255, 255, 0.02);
}

.subscription-item:last-child {
  border-bottom: none;
}

.subscription-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: rgba(99, 102, 241, 0.1);
  border-radius: var(--border-radius);
  margin-right: var(--spacing-lg);
  color: var(--primary-color);
}

.subscription-content {
  flex: 1;
}

.subscription-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-xs);
}

.subscription-name {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.subscription-badge {
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

.badge-active {
  background: rgba(16, 185, 129, 0.1);
  color: var(--secondary-color);
}

.badge-pending {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning-color);
}

.badge-cancelled {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger-color);
}

.subscription-details {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
  font-size: 0.875rem;
  color: var(--text-tertiary);
}

.subscription-actions {
  display: flex;
  gap: var(--spacing-xs);
}

/* Insights Section */
.insights-section {
  margin-bottom: var(--spacing-xl);
}

.time-selector {
  display: flex;
  gap: var(--spacing-xs);
  background: rgba(0, 0, 0, 0.2);
  padding: var(--spacing-xs);
  border-radius: var(--border-radius);
}

.time-option {
  padding: var(--spacing-xs) var(--spacing-md);
  background: transparent;
  border: none;
  border-radius: var(--border-radius-sm);
  color: var(--text-tertiary);
  font-size: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.time-option:hover {
  color: var(--text-secondary);
}

.time-option.active {
  background: var(--primary-color);
  color: white;
}

.insights-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--spacing-lg);
}

.insight-card {
  background: var(--surface-light);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: var(--spacing-lg);
}

.insight-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
}

.insight-title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.insight-value {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-primary);
}

.category-chart {
  height: 8px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: var(--spacing-md);
  display: flex;
}

.chart-segment {
  height: 100%;
  transition: var(--transition);
}

.chart-segment:hover {
  filter: brightness(1.2);
}

.category-labels {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  font-size: 0.75rem;
}

.category-label {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  color: var(--text-tertiary);
}

.label-color {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.upcoming-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.upcoming-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-md);
  background: rgba(0, 0, 0, 0.1);
  border-radius: var(--border-radius-sm);
  transition: var(--transition);
}

.upcoming-item:hover {
  background: rgba(0, 0, 0, 0.2);
}

.upcoming-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-primary);
}

.upcoming-date {
  font-size: 0.75rem;
  color: var(--text-tertiary);
}

/* Recommendations */
.recommendations-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.recommendation-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: rgba(0, 0, 0, 0.1);
  border-radius: var(--border-radius);
  border-left: 4px solid var(--primary-color);
  transition: var(--transition);
}

.recommendation-item:hover {
  background: rgba(0, 0, 0, 0.2);
  transform: translateX(2px);
}

.recommendation-icon {
  font-size: 1.25rem;
}

.recommendation-content {
  flex: 1;
}

.recommendation-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--spacing-xs);
}

.recommendation-text {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  line-height: 1.4;
}

/* Card Footer */
.card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-lg) var(--spacing-xl);
  border-top: 1px solid var(--border-color);
  background: rgba(0, 0, 0, 0.1);
}

.footer-text {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-size: 0.75rem;
  color: var(--text-tertiary);
}

.footer-actions {
  display: flex;
  gap: var(--spacing-lg);
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--surface-lighter);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-light);
}

/* Responsive Design */
@media (max-width: 768px) {
  .card-header {
    flex-direction: column;
    gap: var(--spacing-lg);
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-md);
  }
  
  .header-actions {
    align-self: flex-end;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .insights-grid {
    grid-template-columns: 1fr;
  }
  
  .list-controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .filter-group {
    flex-direction: column;
  }
  
  .card-footer {
    flex-direction: column;
    gap: var(--spacing-md);
    text-align: center;
  }
}

@media (max-width: 480px) {
  .card-header,
  .card-body {
    padding: var(--spacing-lg);
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .subscription-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-md);
  }
  
  .subscription-actions {
    align-self: flex-end;
  }
}
</style>

<script>
// Application State
let subscriptions = JSON.parse(localStorage.getItem('subscriptions')) || [];
let viewMode = 'list'; // 'list' or 'grid'
let selectedStatus = 'active';

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Set default date to today + 30 days
  const futureDate = new Date();
  futureDate.setDate(futureDate.getDate() + 30);
  document.getElementById('sub-date').value = futureDate.toISOString().split('T')[0];
  
  // Set today's date as min for date input
  document.getElementById('sub-date').min = new Date().toISOString().split('T')[0];
  
  // Load subscriptions
  renderSubscriptions();
  updateStats();
  updateInsights();
  updateRecommendations();
  
  // Set up status selector
  document.querySelectorAll('.status-option').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.status-option').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      selectedStatus = this.dataset.status;
    });
  });
  
  // Set up time period selector
  document.querySelectorAll('.time-option').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.time-option').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      updateInsights(this.dataset.period);
    });
  });
});

// Form Functions
function toggleForm() {
  const form = document.getElementById('subscription-form');
  const btn = event.target;
  const isHidden = form.style.display === 'none';
  
  if (isHidden) {
    form.style.display = 'block';
    btn.textContent = 'Hide Form';
  } else {
    form.style.display = 'none';
    btn.textContent = 'Show Form';
  }
}

function clearForm() {
  document.getElementById('sub-name').value = '';
  document.getElementById('sub-cost').value = '';
  document.getElementById('sub-notes').value = '';
  
  const futureDate = new Date();
  futureDate.setDate(futureDate.getDate() + 30);
  document.getElementById('sub-date').value = futureDate.toISOString().split('T')[0];
}

function addSubscription() {
  const name = document.getElementById('sub-name').value.trim();
  const cost = parseFloat(document.getElementById('sub-cost').value) || 0;
  const date = document.getElementById('sub-date').value;
  const category = document.getElementById('sub-category').value;
  const cycle = document.getElementById('sub-cycle').value;
  const currency = document.getElementById('sub-currency').value;
  const notes = document.getElementById('sub-notes').value.trim();
  
  // Validation
  if (!name) {
    showNotification('Please enter a service name', 'error');
    return;
  }
  
  if (cost <= 0) {
    showNotification('Please enter a valid cost', 'error');
    return;
  }
  
  if (!date) {
    showNotification('Please select a renewal date', 'error');
    return;
  }
  
  // Calculate monthly equivalent
  let monthlyCost = cost;
  switch (cycle) {
    case 'yearly': monthlyCost = cost / 12; break;
    case 'quarterly': monthlyCost = cost / 3; break;
    case 'weekly': monthlyCost = cost * 4.33; break;
  }
  
  // Create subscription
  const subscription = {
    id: Date.now(),
    name,
    cost: parseFloat(cost.toFixed(2)),
    monthlyCost: parseFloat(monthlyCost.toFixed(2)),
    date,
    category,
    status: selectedStatus,
    cycle,
    currency,
    notes,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
  
  // Add to array
  subscriptions.push(subscription);
  
  // Save to localStorage
  localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
  
  // Update UI
  renderSubscriptions();
  updateStats();
  updateInsights();
  updateRecommendations();
  
  // Clear form
  clearForm();
  
  // Show success
  showNotification(`Added ${name} subscription`, 'success');
}

function quickAdd() {
  const presets = [
    { name: 'Netflix', cost: 10.99, category: 'entertainment', cycle: 'monthly' },
    { name: 'Spotify', cost: 9.99, category: 'entertainment', cycle: 'monthly' },
    { name: 'Amazon Prime', cost: 8.99, category: 'entertainment', cycle: 'monthly' },
    { name: 'YouTube Premium', cost: 11.99, category: 'entertainment', cycle: 'monthly' }
  ];
  
  const preset = presets[Math.floor(Math.random() * presets.length)];
  
  document.getElementById('sub-name').value = preset.name;
  document.getElementById('sub-cost').value = preset.cost;
  document.getElementById('sub-category').value = preset.category;
  document.getElementById('sub-cycle').value = preset.cycle;
  document.getElementById('sub-status').value = 'active';
  
  showNotification(`Loaded ${preset.name} preset`, 'info');
}

// Rendering Functions
function renderSubscriptions() {
  const container = document.getElementById('subscriptions-list');
  
  if (subscriptions.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="5" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="2" y1="10" x2="22" y2="10"></line>
        </svg>
        <h4>No subscriptions yet</h4>
        <p>Add your first subscription to get started</p>
      </div>
    `;
    return;
  }
  
  // Filter based on current selections
  const categoryFilter = document.getElementById('filter-category').value;
  const statusFilter = document.getElementById('filter-status').value;
  
  let filteredSubs = subscriptions;
  
  if (categoryFilter !== 'all') {
    filteredSubs = filteredSubs.filter(sub => sub.category === categoryFilter);
  }
  
  if (statusFilter !== 'all') {
    filteredSubs = filteredSubs.filter(sub => sub.status === statusFilter);
  }
  
  // Render items
  if (viewMode === 'grid') {
    renderGridView(filteredSubs, container);
  } else {
    renderListView(filteredSubs, container);
  }
}

function renderListView(subs, container) {
  let html = '';
  
  subs.forEach(sub => {
    const symbol = getCurrencySymbol(sub.currency);
    const daysUntil = getDaysUntil(sub.date);
    
    html += `
      <div class="subscription-item" data-id="${sub.id}">
        <div class="subscription-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="5" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="2" y1="10" x2="22" y2="10"></line>
          </svg>
        </div>
        <div class="subscription-content">
          <div class="subscription-header">
            <div class="subscription-name">${sub.name}</div>
            <div class="subscription-badge badge-${sub.status}">${sub.status}</div>
          </div>
          <div class="subscription-details">
            <span>${symbol}${sub.cost.toFixed(2)} ${sub.cycle}</span>
            <span>â€¢</span>
            <span>Renews: ${formatDate(sub.date)}</span>
            <span>â€¢</span>
            <span>${getCategoryLabel(sub.category)}</span>
            ${sub.notes ? `<span>â€¢</span><span>${sub.notes}</span>` : ''}
          </div>
        </div>
        <div class="subscription-actions">
          <button class="icon-button small" onclick="editSubscription(${sub.id})" title="Edit">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button class="icon-button small" onclick="deleteSubscription(${sub.id})" title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function renderGridView(subs, container) {
  let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px;">';
  
  subs.forEach(sub => {
    const symbol = getCurrencySymbol(sub.currency);
    const daysUntil = getDaysUntil(sub.date);
    
    html += `
      <div class="stat-card" data-id="${sub.id}">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
          <div>
            <div style="font-weight: 600; margin-bottom: 4px;">${sub.name}</div>
            <div style="font-size: 0.75rem; color: var(--text-tertiary);">${getCategoryLabel(sub.category)}</div>
          </div>
          <div class="subscription-badge badge-${sub.status}">${sub.status}</div>
        </div>
        
        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">
          ${symbol}${sub.cost.toFixed(2)}
          <span style="font-size: 0.875rem; color: var(--text-tertiary);">${sub.cycle}</span>
        </div>
        
        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 12px;">
          Renews: ${formatDate(sub.date)}
          ${daysUntil <= 7 ? `<span style="color: var(--warning-color);"> (${daysUntil} days)</span>` : ''}
        </div>
        
        <div style="display: flex; gap: 8px;">
          <button class="btn btn-text small" onclick="editSubscription(${sub.id})">Edit</button>
          <button class="btn btn-text small" onclick="deleteSubscription(${sub.id})">Delete</button>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

function toggleSubscriptionView() {
  viewMode = viewMode === 'list' ? 'grid' : 'list';
  renderSubscriptions();
  showNotification(`Switched to ${viewMode} view`, 'info');
}

function filterSubscriptions() {
  renderSubscriptions();
}

function sortSubscriptions(by) {
  subscriptions.sort((a, b) => {
    if (by === 'cost') return b.monthlyCost - a.monthlyCost;
    if (by === 'date') return new Date(a.date) - new Date(b.date);
    if (by === 'name') return a.name.localeCompare(b.name);
    return 0;
  });
  
  localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
  renderSubscriptions();
  showNotification(`Sorted by ${by}`, 'info');
}

// Stats Functions
function updateStats() {
  const activeSubs = subscriptions.filter(sub => sub.status === 'active');
  
  // Calculate totals
  const monthlyTotal = activeSubs.reduce((sum, sub) => sum + sub.monthlyCost, 0);
  const yearlyTotal = monthlyTotal * 12;
  
  // Find next renewal
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const futureRenewals = activeSubs
    .map(sub => new Date(sub.date))
    .filter(date => date >= today);
  
  let nextRenewal = null;
  if (futureRenewals.length > 0) {
    nextRenewal = futureRenewals.reduce((closest, current) => 
      current < closest ? current : closest
    );
  }
  
  // Get currency (use first subscription's or default)
  const currency = activeSubs.length > 0 ? activeSubs[0].currency : 'GBP';
  const symbol = getCurrencySymbol(currency);
  
  // Update UI
  document.getElementById('monthly-total').textContent = `${symbol}${monthlyTotal.toFixed(2)}`;
  document.getElementById('yearly-total').textContent = `${symbol}${yearlyTotal.toFixed(2)}`;
  document.getElementById('active-count').textContent = activeSubs.length;
  
  if (nextRenewal) {
    const daysUntil = getDaysUntil(nextRenewal.toISOString().split('T')[0]);
    document.getElementById('next-renewal').textContent = formatDate(nextRenewal.toISOString().split('T')[0]);
    document.getElementById('next-days').textContent = `in ${daysUntil} days`;
    
    // Add warning class if within 7 days
    const card = document.querySelector('.stat-card.alert');
    if (daysUntil <= 7) {
      card.style.borderLeftColor = 'var(--warning-color)';
    } else if (daysUntil <= 3) {
      card.style.borderLeftColor = 'var(--danger-color)';
    }
  } else {
    document.getElementById('next-renewal').textContent = 'â€“';
    document.getElementById('next-days').textContent = 'No upcoming';
  }
  
  // Calculate potential savings (annual vs monthly)
  let potentialSavings = 0;
  activeSubs.forEach(sub => {
    if (sub.cycle === 'monthly') {
      potentialSavings += sub.cost * 12 * 0.15; // Assume 15% discount for annual
    }
  });
  
  document.getElementById('yearly-savings').textContent = `Save: ${symbol}${potentialSavings.toFixed(2)}`;
}

// Insights Functions
function updateInsights(period = 'monthly') {
  const activeSubs = subscriptions.filter(sub => sub.status === 'active');
  
  // Calculate category breakdown
  const categoryTotals = {};
  activeSubs.forEach(sub => {
    categoryTotals[sub.category] = (categoryTotals[sub.category] || 0) + sub.monthlyCost;
  });
  
  const total = Object.values(categoryTotals).reduce((a, b) => a + b, 0);
  const currency = activeSubs.length > 0 ? activeSubs[0].currency : 'GBP';
  const symbol = getCurrencySymbol(currency);
  
  // Update total
  document.getElementById('breakdown-total').textContent = `${symbol}${total.toFixed(2)}`;
  
  // Update chart
  const chart = document.getElementById('category-chart');
  const labels = document.getElementById('category-labels');
  
  chart.innerHTML = '';
  labels.innerHTML = '';
  
  const colors = {
    entertainment: '#6366f1',
    productivity: '#10b981',
    software: '#f59e0b',
    cloud: '#3b82f6',
    fitness: '#ec4899',
    news: '#8b5cf6',
    food: '#ef4444',
    other: '#6b7280'
  };
  
  Object.entries(categoryTotals).forEach(([category, amount]) => {
    const percentage = total > 0 ? (amount / total * 100) : 0;
    
    // Add chart segment
    const segment = document.createElement('div');
    segment.className = 'chart-segment';
    segment.style.width = `${percentage}%`;
    segment.style.backgroundColor = colors[category] || colors.other;
    segment.title = `${getCategoryLabel(category)}: ${symbol}${amount.toFixed(2)} (${percentage.toFixed(1)}%)`;
    chart.appendChild(segment);
    
    // Add label
    if (percentage > 5) {
      const label = document.createElement('div');
      label.className = 'category-label';
      label.innerHTML = `
        <div class="label-color" style="background: ${colors[category] || colors.other}"></div>
        ${getCategoryLabel(category)} (${percentage.toFixed(0)}%)
      `;
      labels.appendChild(label);
    }
  });
  
  // Update upcoming renewals
  updateUpcomingList();
}

function updateUpcomingList() {
  const container = document.getElementById('upcoming-list');
  const activeSubs = subscriptions.filter(sub => sub.status === 'active');
  
  // Sort by date
  const upcoming = activeSubs
    .filter(sub => {
      const daysUntil = getDaysUntil(sub.date);
      return daysUntil <= 30 && daysUntil >= 0;
    })
    .sort((a, b) => getDaysUntil(a.date) - getDaysUntil(b.date))
    .slice(0, 5);
  
  document.getElementById('upcoming-count').textContent = upcoming.length;
  
  if (upcoming.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-tertiary);">No upcoming renewals in the next 30 days</div>';
    return;
  }
  
  let html = '';
  upcoming.forEach(sub => {
    const daysUntil = getDaysUntil(sub.date);
    const symbol = getCurrencySymbol(sub.currency);
    
    html += `
      <div class="upcoming-item">
        <div>
          <div class="upcoming-name">${sub.name}</div>
          <div class="upcoming-date">Renews ${formatDate(sub.date)} (${daysUntil} days)</div>
        </div>
        <div style="font-weight: 600;">${symbol}${sub.cost.toFixed(2)}</div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// Recommendations Functions
function updateRecommendations() {
  const container = document.getElementById('recommendations');
  const activeSubs = subscriptions.filter(sub => sub.status === 'active');
  
  if (activeSubs.length === 0) {
    container.innerHTML = `
      <div class="recommendation-item">
        <div class="recommendation-icon">ðŸ’¡</div>
        <div class="recommendation-content">
          <div class="recommendation-title">Add your first subscription</div>
          <div class="recommendation-text">Start tracking your monthly expenses by adding a subscription</div>
        </div>
      </div>
    `;
    return;
  }
  
  // Generate recommendations
  const recommendations = [];
  const monthlyTotal = activeSubs.reduce((sum, sub) => sum + sub.monthlyCost, 0);
  
  // Check for monthly subscriptions that could be annual
  const monthlySubs = activeSubs.filter(sub => sub.cycle === 'monthly' && sub.cost > 5);
  if (monthlySubs.length > 0) {
    recommendations.push({
      icon: 'ðŸ’°',
      title: 'Switch to annual plans',
      text: 'Save up to 20% by switching monthly subscriptions to annual billing'
    });
  }
  
  // Check for upcoming renewals
  const upcomingCount = activeSubs.filter(sub => getDaysUntil(sub.date) <= 7).length;
  if (upcomingCount > 0) {
    recommendations.push({
      icon: 'â°',
      title: `${upcomingCount} renewal${upcomingCount > 1 ? 's' : ''} due soon`,
      text: 'Review and update your payment methods'
    });
  }
  
  // Check for high spending categories
  const categoryTotals = {};
  activeSubs.forEach(sub => {
    categoryTotals[sub.category] = (categoryTotals[sub.category] || 0) + sub.monthlyCost;
  });
  
  const highestCategory = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0];
  if (highestCategory && highestCategory[1] > monthlyTotal * 0.4) {
    recommendations.push({
      icon: 'ðŸ“Š',
      title: 'High spending category',
      text: `${getCategoryLabel(highestCategory[0])} accounts for over 40% of your spending`
    });
  }
  
  // Add default recommendation if none
  if (recommendations.length === 0) {
    recommendations.push({
      icon: 'âœ…',
      title: 'Good job!',
      text: 'Your subscriptions look well managed'
    });
  }
  
  // Render recommendations
  let html = '';
  recommendations.forEach(rec => {
    html += `
      <div class="recommendation-item">
        <div class="recommendation-icon">${rec.icon}</div>
        <div class="recommendation-content">
          <div class="recommendation-title">${rec.title}</div>
          <div class="recommendation-text">${rec.text}</div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function refreshRecommendations() {
  updateRecommendations();
  showNotification('Recommendations updated', 'info');
}

// CRUD Operations
function editSubscription(id) {
  const sub = subscriptions.find(s => s.id === id);
  if (!sub) return;
  
  // Fill form
  document.getElementById('sub-name').value = sub.name;
  document.getElementById('sub-cost').value = sub.cost;
  document.getElementById('sub-date').value = sub.date;
  document.getElementById('sub-category').value = sub.category;
  document.getElementById('sub-cycle').value = sub.cycle;
  document.getElementById('sub-currency').value = sub.currency;
  document.getElementById('sub-notes').value = sub.notes || '';
  
  // Set status
  document.querySelectorAll('.status-option').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.status === sub.status);
  });
  selectedStatus = sub.status;
  
  // Delete old entry
  deleteSubscription(id);
  
  // Scroll to form
  document.getElementById('subscription-form').scrollIntoView({ behavior: 'smooth' });
  showNotification(`Editing ${sub.name}`, 'info');
}

function deleteSubscription(id) {
  subscriptions = subscriptions.filter(sub => sub.id !== id);
  localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
  renderSubscriptions();
  updateStats();
  updateInsights();
  updateRecommendations();
  showNotification('Subscription deleted', 'info');
}

// Utility Functions
function getCurrencySymbol(currency) {
  const symbols = {
    'GBP': 'Â£',
    'USD': '$',
    'EUR': 'â‚¬',
    'CAD': 'C$',
    'AUD': 'A$'
  };
  return symbols[currency] || 'Â£';
}

function getDaysUntil(dateStr) {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const date = new Date(dateStr);
  const diffTime = date - today;
  return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  const today = new Date();
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  
  if (dateStr === today.toISOString().split('T')[0]) {
    return 'Today';
  } else if (dateStr === tomorrow.toISOString().split('T')[0]) {
    return 'Tomorrow';
  } else {
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  }
}

function getCategoryLabel(category) {
  const labels = {
    entertainment: 'Entertainment',
    productivity: 'Productivity',
    software: 'Software',
    cloud: 'Cloud Services',
    fitness: 'Fitness & Health',
    news: 'News & Media',
    food: 'Food Delivery',
    other: 'Other'
  };
  return labels[category] || category;
}

function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
    color: white;
    border-radius: 6px;
    font-size: 0.875rem;
    z-index: 1000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  `;
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);

// Export/Import Functions
function exportSubscriptions() {
  if (subscriptions.length === 0) {
    showNotification('No subscriptions to export', 'error');
    return;
  }
  
  const data = {
    version: '1.0',
    exported: new Date().toISOString(),
    count: subscriptions.length,
    subscriptions: subscriptions
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `subscriptions-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  
  showNotification('Subscriptions exported successfully', 'success');
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    try {
      const text = await file.text();
      const data = JSON.parse(text);
      
      if (data.subscriptions && Array.isArray(data.subscriptions)) {
        if (confirm(`Import ${data.count} subscriptions?`)) {
          subscriptions = data.subscriptions;
          localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
          renderSubscriptions();
          updateStats();
          updateInsights();
          updateRecommendations();
          showNotification(`Imported ${data.count} subscriptions`, 'success');
        }
      } else {
        showNotification('Invalid file format', 'error');
      }
    } catch (error) {
      showNotification('Error importing file', 'error');
    }
  };
  
  input.click();
}

function resetData() {
  if (confirm('Are you sure you want to delete all subscription data? This cannot be undone.')) {
    subscriptions = [];
    localStorage.removeItem('subscriptions');
    renderSubscriptions();
    updateStats();
    updateInsights();
    updateRecommendations();
    showNotification('All data has been reset', 'info');
  }
}
</script>
