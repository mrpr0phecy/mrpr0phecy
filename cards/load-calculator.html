<!-- cards/electrical-load-calculator.html -->
<h2 id="electrical-load-calculator-title" style="margin-top:0;color:var(--accent);font-size:1.4rem;margin-bottom:8px;">‚ö° Electrical Load Calculator</h2>

<form aria-describedby="electrical-load-calculator-desc" style="margin-bottom:20px;">
    <p id="electrical-load-calculator-desc" class="small" style="color:rgba(230,250,255,0.9);margin-bottom:20px;line-height:1.5;">
        <span style="color:var(--accent);font-weight:500;">üîß Professional-grade calculations:</span> Calculate electrical loads for homes, offices, or circuits. Includes NEC compliance tips and safety warnings.
    </p>
    
    <!-- MODE SELECTOR -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
        <button type="button" onclick="elcSetMode('residential')" class="mode-btn active" 
                style="padding:12px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;transition:all 0.2s ease;">
            <span style="font-size:18px;">üè†</span> Residential
        </button>
        <button type="button" onclick="elcSetMode('circuit')" class="mode-btn"
                style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;transition:all 0.2s ease;">
            <span style="font-size:18px;">üîå</span> Circuit Load
        </button>
    </div>
    
    <!-- QUICK APPLIANCE PRESETS -->
    <div style="margin-bottom:16px;">
        <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:8px;">üìã Common Appliances (Click to add):</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="elcAddAppliance('Refrigerator', 150)" class="appliance-btn" style="padding:6px 10px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:12px;">üßä Refrigerator (150W)</button>
            <button type="button" onclick="elcAddAppliance('Microwave', 1200)" class="appliance-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);color:#ff2d55;cursor:pointer;font-size:12px;">üçΩÔ∏è Microwave (1200W)</button>
            <button type="button" onclick="elcAddAppliance('Air Conditioner', 1500)" class="appliance-btn" style="padding:6px 10px;border-radius:6px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;cursor:pointer;font-size:12px;">‚ùÑÔ∏è AC Unit (1500W)</button>
            <button type="button" onclick="elcAddAppliance('LED Lights (10)', 100)" class="appliance-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;cursor:pointer;font-size:12px;">üí° Lights (100W)</button>
            <button type="button" onclick="elcAddAppliance('TV', 150)" class="appliance-btn" style="padding:6px 10px;border-radius:6px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);color:#9d4edd;cursor:pointer;font-size:12px;">üì∫ TV (150W)</button>
        </div>
    </div>
    
    <!-- APPLIANCE TABLE -->
    <div style="margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <label style="display:block;margin-bottom:0;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="display:flex;align-items:center;gap:6px;">
                    <span style="font-size:18px;">üìä</span> Appliance List
                </span>
            </label>
            <button type="button" onclick="elcClearAll()" style="padding:4px 8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);color:#ff2d55;border-radius:4px;cursor:pointer;font-size:11px;">Clear All</button>
        </div>
        
        <div style="overflow-x:auto;">
            <table id="elc-appliance-table" style="width:100%;border-collapse:collapse;">
                <thead>
                    <tr style="background:rgba(45,212,255,0.1);">
                        <th style="padding:8px;text-align:left;font-weight:500;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Appliance</th>
                        <th style="padding:8px;text-align:left;font-weight:500;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Power (W)</th>
                        <th style="padding:8px;text-align:left;font-weight:500;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Quantity</th>
                        <th style="padding:8px;text-align:left;font-weight:500;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Usage Factor</th>
                        <th style="padding:8px;text-align:left;font-weight:500;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Action</th>
                    </tr>
                </thead>
                <tbody id="elc-appliance-tbody">
                    <!-- Rows will be added here -->
                </tbody>
            </table>
        </div>
        
        <!-- ADD NEW APPLIANCE -->
        <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:8px;margin-top:12px;">
            <input id="elc-new-name" type="text" placeholder="Appliance name" style="padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;font-size:13px;">
            <input id="elc-new-watts" type="number" placeholder="Watts" min="0" step="10" style="padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;font-size:13px;">
            <input id="elc-new-qty" type="number" placeholder="Qty" min="1" value="1" style="padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;font-size:13px;">
            <select id="elc-new-factor" style="padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:inherit;font-size:13px;">
                <option value="1.0">100% (Always on)</option>
                <option value="0.8">80% (Frequent)</option>
                <option value="0.5">50% (Occasional)</option>
                <option value="0.3">30% (Rare)</option>
            </select>
            <button type="button" onclick="elcAddNewAppliance()" style="padding:8px 12px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);color:var(--accent);border-radius:6px;cursor:pointer;font-weight:500;white-space:nowrap;">Add</button>
        </div>
    </div>
    
    <!-- CALCULATION SETTINGS -->
    <div id="elc-residential-settings" style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px;">
        <div>
            <label for="elc-diversity" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üìà</span> Diversity Factor
            </label>
            <div style="display:flex;align-items:center;gap:10px;">
                <input id="elc-diversity" type="range" min="50" max="100" value="80" step="5"
                       style="flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,0.1);outline:none;"
                       oninput="document.getElementById('elc-diversity-value').textContent = this.value + '%'">
                <span id="elc-diversity-value" style="min-width:50px;text-align:center;color:var(--accent);font-weight:500;">80%</span>
            </div>
            <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">Accounts for non-simultaneous use</div>
        </div>
        
        <div>
            <label for="elc-voltage" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">‚ö°</span> Voltage (V)
            </label>
            <select id="elc-voltage" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="120">120V (USA/Canada)</option>
                <option value="230">230V (EU/UK/AU)</option>
                <option value="240">240V (USA 2-phase)</option>
                <option value="110">110V (Japan)</option>
                <option value="220">220V (Most countries)</option>
            </select>
        </div>
    </div>
    
    <!-- CIRCUIT SETTINGS (Hidden by default) -->
    <div id="elc-circuit-settings" style="display:none;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px;">
        <div>
            <label for="elc-circuit-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üîß</span> Circuit Type
            </label>
            <select id="elc-circuit-type" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="15">15A General Purpose</option>
                <option value="20">20A Kitchen/Bath</option>
                <option value="30">30A Dryer/Water Heater</option>
                <option value="50">50A Range/Electric Vehicle</option>
            </select>
        </div>
        
        <div>
            <label for="elc-circuit-load-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">‚è±Ô∏è</span> Load Type
            </label>
            <select id="elc-circuit-load-type" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="non-continuous">Non-continuous (< 3h)</option>
                <option value="continuous">Continuous (‚â• 3h)</option>
            </select>
        </div>
    </div>
    
    <!-- SAFETY WARNINGS -->
    <div style="padding:12px;background:rgba(255,45,85,0.1);border-radius:8px;border-left:3px solid #ff2d55;margin-bottom:20px;">
        <div style="display:flex;align-items:flex-start;gap:8px;">
            <span style="font-size:18px;color:#ff2d55;">‚ö†Ô∏è</span>
            <div style="flex:1;">
                <div style="font-weight:600;color:#ff2d55;margin-bottom:4px;">Safety Warning</div>
                <div style="font-size:12px;color:rgba(255,255,255,0.8);line-height:1.4;">
                    This is an educational tool only. Always consult a licensed electrician and comply with local electrical codes (NEC, IEC, etc.) before installation. Electrical work can be dangerous and requires proper training.
                </div>
            </div>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="display:flex;gap:12px;margin-top:20px;">
        <button type="button" onclick="elcCalculate(this)" id="elc-main-btn"
                style="flex:2;padding:14px 20px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.5);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform 0.2s ease;">
            <span style="font-size:18px;">‚ö°</span> Calculate Load
        </button>
        
        <button type="button" onclick="elcCopyReport()" id="elc-copy-btn"
                style="padding:14px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:10px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üìã</span> Copy
        </button>
        
        <button type="button" onclick="elcExportPDF()" id="elc-export-btn"
                style="padding:14px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üìÑ</span> Export
        </button>
        
        <button type="button" onclick="elcResetAll(this)"
                style="padding:14px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üîÑ</span> Reset
        </button>
    </div>
</form>

<!-- RESULTS AREA -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h3 class="small" style="color:var(--accent);font-size:16px;margin:0;display:flex;align-items:center;gap:8px;">
            <span style="font-size:18px;">üìä</span> Calculation Results
        </h3>
        <div id="elc-stats" style="display:flex;gap:12px;font-size:12px;color:rgba(230,250,255,0.7);">
            <span>Appliances: <span id="elc-appliance-count">0</span></span>
            <span>Total Watts: <span id="elc-total-watts">0</span>W</span>
        </div>
    </div>
    
    <div id="elc-output-container" style="padding:16px;border-radius:10px;border:1px solid rgba(45,212,255,0.3);background:linear-gradient(135deg, rgba(20,20,20,0.9), rgba(10,15,20,0.9));min-height:200px;max-height:400px;overflow-y:auto;">
        <div id="elc-output" style="color:inherit;font-family:'Inter', system-ui, sans-serif;font-size:14px;line-height:1.6;">
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
                <div style="font-size:48px;margin-bottom:16px;">‚ö°</div>
                <div style="font-weight:500;margin-bottom:8px;color:var(--accent);">Ready to Calculate</div>
                <div>Add appliances above and click "Calculate Load"</div>
                <div style="font-size:12px;margin-top:12px;color:rgba(230,250,255,0.4);">Try adding common appliances from the presets</div>
            </div>
        </div>
    </div>
    
    <!-- QUICK TIPS -->
    <div id="elc-hint" style="margin-top:12px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:3px solid var(--accent);font-size:13px;color:rgba(230,250,255,0.9);">
        <strong style="color:var(--accent);">üí° Pro Tip:</strong> Use diversity factor (80% typical) to account for appliances not running simultaneously.
    </div>
</div>

<!-- NEC CODE COMPLIANCE -->
<div style="margin-top:20px;padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border-left:3px solid #39ff14;">
    <div style="display:flex;align-items:flex-start;gap:8px;">
        <span style="font-size:18px;color:#39ff14;">üìã</span>
        <div style="flex:1;">
            <div style="font-weight:600;color:#39ff14;margin-bottom:8px;">NEC Code References (USA)</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:12px;">
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Continuous Loads</div>
                    <div style="color:rgba(230,250,255,0.7);">NEC 210.20(A): Multiply by 125%</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Circuit Ratings</div>
                    <div style="color:rgba(230,250,255,0.7);">NEC 210.11: Branch circuit requirements</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Dwelling Units</div>
                    <div style="color:rgba(230,255,255,0.7);">NEC 220: Standard calculation method</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Safety Factor</div>
                    <div style="color:rgba(230,250,255,0.7);">NEC 110.14: Conductor ampacity</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
/* electrical-load-calculator.html
   - Professional electrical load calculator
   - Scoped with elc- prefix
*/

let currentMode = 'residential';
let appliances = [];
let nextId = 1;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('Electrical Load Calculator ready! ‚ö°');
    
    // Load saved data if any
    const savedAppliances = localStorage.getItem('elc-appliances');
    if (savedAppliances) {
        appliances = JSON.parse(savedAppliances);
        nextId = appliances.length > 0 ? Math.max(...appliances.map(a => a.id)) + 1 : 1;
        elcRenderApplianceTable();
    }
    
    // Add some default appliances for demo
    if (appliances.length === 0) {
        elcAddAppliance('Refrigerator', 150);
        elcAddAppliance('LED Lights (10)', 100);
    }
});

// Set mode (Residential vs Circuit)
function elcSetMode(mode) {
    currentMode = mode;
    
    // Update button states
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = document.querySelector(`[onclick="elcSetMode('${mode}')"]`);
    if (activeBtn) {
        activeBtn.style.background = 'rgba(45,212,255,0.2)';
        activeBtn.style.border = '2px solid var(--accent)';
        activeBtn.style.color = 'var(--accent)';
    }
    
    // Show/hide settings
    const residentialSettings = document.getElementById('elc-residential-settings');
    const circuitSettings = document.getElementById('elc-circuit-settings');
    
    if (mode === 'residential') {
        residentialSettings.style.display = 'grid';
        circuitSettings.style.display = 'none';
        document.getElementById('elc-main-btn').innerHTML = '<span style="font-size:18px;">‚ö°</span> Calculate Load';
    } else {
        residentialSettings.style.display = 'none';
        circuitSettings.style.display = 'grid';
        document.getElementById('elc-main-btn').innerHTML = '<span style="font-size:18px;">üîå</span> Check Circuit';
    }
    
    elcShowNotification(`Switched to ${mode === 'residential' ? 'Residential Load' : 'Circuit Load'} mode`, 'info');
}

// Add appliance from preset
function elcAddAppliance(name, watts) {
    const appliance = {
        id: nextId++,
        name: name,
        watts: watts,
        quantity: 1,
        usageFactor: 0.8
    };
    
    appliances.push(appliance);
    elcRenderApplianceTable();
    saveAppliances();
    
    // Visual feedback
    const btn = event?.target || document.querySelector(`[onclick="elcAddAppliance('${name}', ${watts})"]`);
    if (btn) {
        const original = btn.innerHTML;
        btn.innerHTML = '‚úì Added';
        setTimeout(() => btn.innerHTML = original, 1000);
    }
}

// Add new appliance from form
function elcAddNewAppliance() {
    const name = document.getElementById('elc-new-name').value.trim();
    const watts = parseFloat(document.getElementById('elc-new-watts').value);
    const quantity = parseInt(document.getElementById('elc-new-qty').value) || 1;
    const factor = parseFloat(document.getElementById('elc-new-factor').value);
    
    if (!name || isNaN(watts) || watts <= 0) {
        elcShowNotification('Please enter valid appliance name and power', 'warning');
        return;
    }
    
    const appliance = {
        id: nextId++,
        name: name,
        watts: watts,
        quantity: quantity,
        usageFactor: factor
    };
    
    appliances.push(appliance);
    elcRenderApplianceTable();
    saveAppliances();
    
    // Clear form
    document.getElementById('elc-new-name').value = '';
    document.getElementById('elc-new-watts').value = '';
    document.getElementById('elc-new-qty').value = '1';
    
    elcShowNotification(`Added: ${name} (${watts}W)`, 'success');
}

// Remove appliance
function elcRemoveAppliance(id) {
    appliances = appliances.filter(a => a.id !== id);
    elcRenderApplianceTable();
    saveAppliances();
    elcShowNotification('Appliance removed', 'info');
}

// Clear all appliances
function elcClearAll() {
    if (appliances.length === 0) return;
    
    if (confirm('Clear all appliances?')) {
        appliances = [];
        elcRenderApplianceTable();
        saveAppliances();
        elcShowNotification('All appliances cleared', 'info');
    }
}

// Render appliance table
function elcRenderApplianceTable() {
    const tbody = document.getElementById('elc-appliance-tbody');
    if (!tbody) return;
    
    if (appliances.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" style="padding:20px;text-align:center;color:rgba(230,250,255,0.5);">
                    No appliances added yet. Use presets or the form below.
                </td>
            </tr>
        `;
    } else {
        tbody.innerHTML = appliances.map(appliance => `
            <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
                <td style="padding:8px;">${appliance.name}</td>
                <td style="padding:8px;">${appliance.watts} W</td>
                <td style="padding:8px;">
                    <input type="number" value="${appliance.quantity}" min="1" style="width:60px;padding:4px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);color:inherit;border-radius:4px;"
                           onchange="elcUpdateQuantity(${appliance.id}, this.value)">
                </td>
                <td style="padding:8px;">
                    <select style="padding:4px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);color:inherit;border-radius:4px;"
                            onchange="elcUpdateFactor(${appliance.id}, this.value)">
                        <option value="1.0" ${appliance.usageFactor === 1.0 ? 'selected' : ''}>100%</option>
                        <option value="0.8" ${appliance.usageFactor === 0.8 ? 'selected' : ''}>80%</option>
                        <option value="0.5" ${appliance.usageFactor === 0.5 ? 'selected' : ''}>50%</option>
                        <option value="0.3" ${appliance.usageFactor === 0.3 ? 'selected' : ''}>30%</option>
                    </select>
                </td>
                <td style="padding:8px;">
                    <button onclick="elcRemoveAppliance(${appliance.id})" style="padding:4px 8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);color:#ff2d55;border-radius:4px;cursor:pointer;font-size:11px;">Remove</button>
                </td>
            </tr>
        `).join('');
    }
    
    // Update stats
    const totalWatts = appliances.reduce((sum, a) => sum + (a.watts * a.quantity), 0);
    document.getElementById('elc-appliance-count').textContent = appliances.length;
    document.getElementById('elc-total-watts').textContent = totalWatts.toLocaleString();
}

// Update appliance quantity
function elcUpdateQuantity(id, quantity) {
    const appliance = appliances.find(a => a.id === id);
    if (appliance) {
        appliance.quantity = parseInt(quantity) || 1;
        saveAppliances();
        elcRenderApplianceTable();
    }
}

// Update usage factor
function elcUpdateFactor(id, factor) {
    const appliance = appliances.find(a => a.id === id);
    if (appliance) {
        appliance.usageFactor = parseFloat(factor);
        saveAppliances();
    }
}

// Save appliances to localStorage
function saveAppliances() {
    localStorage.setItem('elc-appliances', JSON.stringify(appliances));
}

// Main calculation function
function elcCalculate(btn) {
    if (appliances.length === 0) {
        elcShowNotification('Add at least one appliance first', 'warning');
        return;
    }
    
    // Show loading state
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<span style="font-size:18px;">‚è≥</span> Calculating...';
    btn.disabled = true;
    
    setTimeout(() => {
        let result = '';
        
        if (currentMode === 'residential') {
            result = elcCalculateResidentialLoad();
        } else {
            result = elcCalculateCircuitLoad();
        }
        
        // Display result
        document.getElementById('elc-output').innerHTML = result;
        
        // Reset button
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        
        // Show notification
        elcShowNotification('Calculation complete!', 'success');
        
        // Auto-scroll to results
        document.getElementById('elc-output-container').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
        
    }, 600);
}

// Calculate residential load
function elcCalculateResidentialLoad() {
    const diversity = parseInt(document.getElementById('elc-diversity').value) / 100;
    const voltage = parseInt(document.getElementById('elc-voltage').value);
    
    // Calculate totals
    let connectedLoad = 0;
    let diversifiedLoad = 0;
    let applianceDetails = '';
    
    appliances.forEach((appliance, index) => {
        const applianceLoad = appliance.watts * appliance.quantity;
        const adjustedLoad = applianceLoad * appliance.usageFactor;
        
        connectedLoad += applianceLoad;
        diversifiedLoad += adjustedLoad;
        
        applianceDetails += `
            <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);">
                <span>${index + 1}. ${appliance.name} (${appliance.quantity}x)</span>
                <span style="color:var(--accent);">${applianceLoad.toLocaleString()} W</span>
            </div>
        `;
    });
    
    const finalLoad = diversifiedLoad * diversity;
    const currentAmps = finalLoad / voltage;
    
    // Determine service size recommendation
    let serviceSize = '100A';
    let serviceColor = '#39ff14';
    
    if (finalLoad < 12000) serviceSize = '100A';
    else if (finalLoad < 24000) {
        serviceSize = '200A';
        serviceColor = '#ffcc00';
    } else {
        serviceSize = '400A';
        serviceColor = '#ff2d55';
    }
    
    return `
        <div style="margin-bottom:20px;">
            <div style="font-size:16px;font-weight:600;margin-bottom:12px;color:var(--accent);">üè† Residential Load Analysis</div>
            <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:16px;">Based on ${appliances.length} appliances</div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìä Load Summary</div>
            <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Connected Load:</span>
                    <span style="color:#ffcc00;font-weight:500;">${connectedLoad.toLocaleString()} W</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>After Usage Factors:</span>
                    <span style="color:#39ff14;font-weight:500;">${diversifiedLoad.toLocaleString()} W</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Diversity Factor (${(diversity * 100).toFixed(0)}%):</span>
                    <span style="color:var(--accent);font-weight:500;">${finalLoad.toLocaleString()} W</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Current at ${voltage}V:</span>
                    <span style="color:#ffcc00;font-weight:500;">${currentAmps.toFixed(1)} A</span>
                </div>
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üîß Service Recommendation</div>
            <div style="text-align:center;padding:16px;background:rgba(${serviceColor === '#39ff14' ? '57,255,20' : serviceColor === '#ffcc00' ? '255,204,0' : '255,45,85'},0.1);border-radius:8px;border:2px solid ${serviceColor};">
                <div style="font-size:24px;font-weight:600;color:${serviceColor};margin-bottom:4px;">${serviceSize} Service</div>
                <div style="font-size:12px;color:rgba(230,250,255,0.7);">Recommended minimum electrical service</div>
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìã Appliance Details</div>
            <div style="max-height:150px;overflow-y:auto;">
                ${applianceDetails}
            </div>
        </div>
        
        <div style="padding:12px;background:rgba(255,45,85,0.1);border-radius:8px;border-left:3px solid #ff2d55;margin-top:16px;">
            <div style="font-weight:600;color:#ff2d55;margin-bottom:4px;">‚ö†Ô∏è Important Notice</div>
            <div style="font-size:12px;color:rgba(255,255,255,0.8);">
                This is an educational calculation. Actual service requirements must be determined by a licensed electrician following local codes (NEC Article 220 for USA).
            </div>
        </div>
    `;
}

// Calculate circuit load
function elcCalculateCircuitLoad() {
    const circuitAmps = parseInt(document.getElementById('elc-circuit-type').value);
    const loadType = document.getElementById('elc-circuit-load-type').value;
    const voltage = 120; // Standard for circuit calculations
    
    // Calculate circuit capacity
    let circuitCapacity = circuitAmps * voltage;
    if (loadType === 'continuous') {
        circuitCapacity = circuitCapacity * 0.8; // 80% for continuous loads
    }
    
    // Calculate appliance loads
    let totalLoad = 0;
    let applianceDetails = '';
    
    appliances.forEach((appliance, index) => {
        const applianceLoad = appliance.watts * appliance.quantity;
        totalLoad += applianceLoad;
        
        applianceDetails += `
            <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.05);">
                <span>${index + 1}. ${appliance.name}</span>
                <span style="color:${applianceLoad > 1000 ? '#ff2d55' : applianceLoad > 500 ? '#ffcc00' : '#39ff14'};font-weight:500;">
                    ${applianceLoad.toLocaleString()} W
                </span>
            </div>
        `;
    });
    
    const loadPercentage = (totalLoad / circuitCapacity) * 100;
    const isOverloaded = loadPercentage > 100;
    const loadColor = isOverloaded ? '#ff2d55' : loadPercentage > 80 ? '#ffcc00' : '#39ff14';
    
    return `
        <div style="margin-bottom:20px;">
            <div style="font-size:16px;font-weight:600;margin-bottom:12px;color:var(--accent);">üîå Circuit Load Analysis</div>
            <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:16px;">${circuitAmps}A ${loadType === 'continuous' ? 'Continuous' : 'Non-continuous'} Circuit</div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìä Circuit Capacity</div>
            <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Circuit Rating:</span>
                    <span style="color:#ffcc00;font-weight:500;">${circuitAmps}A (${circuitAmps * voltage}W)</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>${loadType === 'continuous' ? 'Continuous Load (80%):' : 'Available Capacity:'}</span>
                    <span style="color:#39ff14;font-weight:500;">${circuitCapacity.toLocaleString()} W</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Total Appliance Load:</span>
                    <span style="color:${totalLoad > circuitCapacity ? '#ff2d55' : '#ffcc00'};font-weight:500;">${totalLoad.toLocaleString()} W</span>
                </div>
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìà Load Status</div>
            <div style="text-align:center;padding:16px;background:rgba(${loadColor === '#39ff14' ? '57,255,20' : loadColor === '#ffcc00' ? '255,204,0' : '255,45,85'},0.1);border-radius:8px;border:2px solid ${loadColor};">
                <div style="font-size:24px;font-weight:600;color:${loadColor};margin-bottom:4px;">${loadPercentage.toFixed(1)}% Load</div>
                <div style="font-size:14px;color:${loadColor};margin-bottom:8px;">
                    ${isOverloaded ? '‚ö†Ô∏è OVERLOADED' : loadPercentage > 80 ? '‚ö†Ô∏è NEAR CAPACITY' : '‚úÖ WITHIN LIMITS'}
                </div>
                <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:8px;">
                    <div style="height:100%;background:${loadColor};width:${Math.min(loadPercentage, 100)}%;transition:width 0.3s ease;"></div>
                </div>
                <div style="font-size:12px;color:rgba(230,250,255,0.7);">
                    ${isOverloaded ? 'Circuit overloaded! Remove appliances.' : 
                      loadPercentage > 80 ? 'Close to capacity. Consider upgrades.' : 
                      'Circuit has sufficient capacity.'}
                </div>
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-weight:600;margin-bottom:8px;color:var(--accent);">üìã Appliance Loads</div>
            <div style="max-height:120px;overflow-y:auto;">
                ${applianceDetails}
            </div>
        </div>
        
        <div style="padding:12px;background:rgba(255,45,85,0.1);border-radius:8px;border-left:3px solid #ff2d55;margin-top:16px;">
            <div style="font-weight:600;color:#ff2d55;margin-bottom:4px;">‚ö†Ô∏è Safety Warning</div>
            <div style="font-size:12px;color:rgba(255,255,255,0.8);">
                ${isOverloaded ? 
                  'DANGER: This circuit is overloaded. Immediate action required!' :
                  'Never exceed 80% of circuit rating for continuous loads (‚â•3 hours).'}
            </div>
        </div>
    `;
}

// Copy report
function elcCopyReport() {
    const output = document.getElementById('elc-output');
    const text = output.innerText || output.textContent;
    
    if (!text || text.includes('Ready to Calculate')) {
        elcShowNotification('Generate calculation first!', 'warning');
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('elc-copy-btn');
        const original = btn.innerHTML;
        btn.innerHTML = '<span style="font-size:16px;">‚úÖ</span> Copied!';
        btn.style.background = 'rgba(57,255,20,0.2)';
        
        setTimeout(() => {
            btn.innerHTML = original;
            btn.style.background = '';
        }, 2000);
        
        elcShowNotification('Report copied to clipboard! üìã', 'success');
    });
}

// Export as PDF (simulated)
function elcExportPDF() {
    elcShowNotification('Export feature would generate PDF here', 'info');
    // In a real implementation, this would use a library like jsPDF
}

// Reset everything
function elcResetAll(btn) {
    if (appliances.length === 0) return;
    
    if (confirm('Reset all appliances and calculations?')) {
        appliances = [];
        nextId = 1;
        elcRenderApplianceTable();
        saveAppliances();
        
        document.getElementById('elc-output').innerHTML = `
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
                <div style="font-size:48px;margin-bottom:16px;">‚ö°</div>
                <div style="font-weight:500;margin-bottom:8px;color:var(--accent);">Ready to Calculate</div>
                <div>Add appliances above and click "Calculate Load"</div>
                <div style="font-size:12px;margin-top:12px;color:rgba(230,250,255,0.4);">Try adding common appliances from the presets</div>
            </div>
        `;
        
        // Reset form inputs
        document.getElementById('elc-new-name').value = '';
        document.getElementById('elc-new-watts').value = '';
        document.getElementById('elc-new-qty').value = '1';
        
        elcShowNotification('All data reset', 'info');
    }
}

// Notification system
function elcShowNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 16px;
        background: ${type === 'success' ? 'rgba(57,255,20,0.15)' : 
                     type === 'error' ? 'rgba(255,45,85,0.15)' : 
                     type === 'warning' ? 'rgba(255,204,0,0.15)' : 
                     'rgba(45,212,255,0.15)'};
        border: 1px solid ${type === 'success' ? 'rgba(57,255,20,0.3)' : 
                           type === 'error' ? 'rgba(255,45,85,0.3)' : 
                           type === 'warning' ? 'rgba(255,204,0,0.3)' : 
                           'rgba(45,212,255,0.3)'};
        color: ${type === 'success' ? '#39ff14' : 
                type === 'error' ? '#ff2d55' : 
                type === 'warning' ? '#ffcc00' : 
                'var(--accent)'};
        border-radius: 8px;
        z-index: 10000;
        backdrop-filter: blur(10px);
        font-weight: 500;
        animation: elcSlideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'elcSlideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Add CSS animations
if (!document.querySelector('#elc-styles')) {
    const style = document.createElement('style');
    style.id = 'elc-styles';
    style.textContent = `
        @keyframes elcSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes elcSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        button:active {
            transform: translateY(0);
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(45,212,255,0.1);
        }
        .appliance-btn:hover {
            transform: scale(1.05);
        }
        #elc-appliance-table {
            border: 1px solid rgba(255,255,255,0.1);
        }
        #elc-appliance-table th {
            background: rgba(45,212,255,0.1);
        }
        #elc-appliance-table tr:hover {
            background: rgba(255,255,255,0.03);
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
/* Card-specific responsive styles */
#electrical-load-calculator-title {
    animation: elcFadeIn 0.5s ease;
}

@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
        justify-content: center;
    }
    
    .mode-btn {
        font-size: 13px !important;
        padding: 10px !important;
    }
    
    #elc-residential-settings, #elc-circuit-settings {
        grid-template-columns: 1fr !important;
    }
    
    #elc-appliance-table {
        font-size: 12px;
    }
    
    #elc-appliance-table th, #elc-appliance-table td {
        padding: 6px !important;
    }
}

@keyframes elcFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
