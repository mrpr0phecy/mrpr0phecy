<h2 id="lighting-design-title" style="margin-top:0;">Lighting Design Calculator (Professional Tool)</h2>

<form aria-describedby="lighting-design-desc">
  <p id="lighting-design-desc" class="small">
    Professional lighting design calculator with comprehensive room analysis, fixture selection, and energy efficiency recommendations.
    <span style="color:#ffcc00;font-weight:600;">‚ö†Ô∏è Educational tool ‚Äî consult certified lighting designers for actual projects.</span>
  </p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
    <div class="field">
      <label for="light-room-type">üè† Room Type</label>
      <select id="light-room-type" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" onchange="lightUpdateRoomPreset(this)">
        <option value="custom" selected>Custom Room</option>
        <option value="office">üìä Office / Workspace</option>
        <option value="living">üõãÔ∏è Living Room</option>
        <option value="kitchen">üç≥ Kitchen</option>
        <option value="bedroom">üõèÔ∏è Bedroom</option>
        <option value="bathroom">üöΩ Bathroom</option>
        <option value="classroom">üéì Classroom</option>
        <option value="retail">üõçÔ∏è Retail Store</option>
        <option value="hospital">üè• Hospital / Clinic</option>
        <option value="warehouse">üì¶ Warehouse / Storage</option>
        <option value="gym">üèãÔ∏è Gym / Sports Hall</option>
      </select>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Select room type for preset values</div>
    </div>
    
    <div class="field">
      <label for="light-lighting-type">üí° Lighting Type</label>
      <select id="light-lighting-type" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
        <option value="general">General Lighting</option>
        <option value="task">Task Lighting</option>
        <option value="accent">Accent Lighting</option>
        <option value="emergency">Emergency Lighting</option>
        <option value="decorative">Decorative Lighting</option>
      </select>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Primary lighting function</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="light-length">Room Length (m)</label>
      <input id="light-length" type="number" min="1" max="100" step="0.1" value="5" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">1-100 meters</div>
    </div>
    
    <div class="field">
      <label for="light-width">Room Width (m)</label>
      <input id="light-width" type="number" min="1" max="100" step="0.1" value="4" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">1-100 meters</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="light-height">Ceiling Height (m)</label>
      <input id="light-height" type="number" min="2" max="20" step="0.1" value="2.7" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">2-20 meters</div>
    </div>
    
    <div class="field">
      <label for="light-ceiling-reflectance">Ceiling Reflectance (%)</label>
      <div style="display:flex;align-items:center;gap:10px;">
        <input id="light-ceiling-reflectance" type="range" min="10" max="90" value="70" step="5" style="flex:1;" oninput="lightUpdateReflectanceSlider(this)" />
        <input id="light-ceiling-reflectance-value" type="number" min="10" max="90" step="5" value="70" style="width:70px;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
        <span style="color:#ffcc00;">%</span>
      </div>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">White ceiling: 70-90%, Dark ceiling: 10-30%</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="light-wall-reflectance">Wall Reflectance (%)</label>
      <div style="display:flex;align-items:center;gap:10px;">
        <input id="light-wall-reflectance" type="range" min="10" max="90" value="50" step="5" style="flex:1;" oninput="lightUpdateReflectanceSlider(this)" />
        <input id="light-wall-reflectance-value" type="number" min="10" max="90" step="5" value="50" style="width:70px;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
        <span style="color:#ffcc00;">%</span>
      </div>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Light walls: 50-70%, Dark walls: 10-30%</div>
    </div>
    
    <div class="field">
      <label for="light-floor-reflectance">Floor Reflectance (%)</label>
      <div style="display:flex;align-items:center;gap:10px;">
        <input id="light-floor-reflectance" type="range" min="10" max="90" value="20" step="5" style="flex:1;" oninput="lightUpdateReflectanceSlider(this)" />
        <input id="light-floor-reflectance-value" type="number" min="10" max="90" step="5" value="20" style="width:70px;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
        <span style="color:#ffcc00;">%</span>
      </div>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Light floor: 20-40%, Dark floor: 10-20%</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="light-fixture-type">Fixture Type</label>
      <select id="light-fixture-type" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" onchange="lightUpdateFixturePreset(this)">
        <option value="custom" selected>Custom Fixture</option>
        <option value="led_panel">LED Panel</option>
        <option value="led_downlight">LED Downlight</option>
        <option value="fluorescent">Fluorescent Tube</option>
        <option value="incandescent">Incandescent Bulb</option>
        <option value="halogen">Halogen Lamp</option>
        <option value="high_bay">High Bay Fixture</option>
        <option value="track">Track Lighting</option>
        <option value="pendant">Pendant Light</option>
      </select>
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Select fixture type for preset values</div>
    </div>
    
    <div class="field">
      <label for="light-lamp-lumens">Fixture Lumen Output</label>
      <input id="light-lamp-lumens" type="number" min="100" max="50000" step="100" value="800" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Typical: LED downlight 800-1500 lumens</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="light-lamp-wattage">Fixture Wattage (W)</label>
      <input id="light-lamp-wattage" type="number" min="1" max="1000" step="1" value="10" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Electrical power consumption</div>
    </div>
    
    <div class="field">
      <label for="light-lamp-efficacy">Luminous Efficacy (lm/W)</label>
      <input id="light-lamp-efficacy" type="number" min="1" max="200" step="1" value="80" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" readonly />
      <div class="hint" style="font-size:12px;color:#ffcc00;margin-top:4px;">Calculated: Lumens √∑ Watts</div>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
    <button type="button" onclick="lightCalculate(this)" style="flex:1;padding:12px 20px;background:linear-gradient(135deg, #ffcc00, #ff9800);color:#000;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-lightbulb" style="margin-right:8px;"></i>Calculate Lighting
    </button>
    <button type="button" class="secondary" onclick="lightReset(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-redo" style="margin-right:8px;"></i>Reset
    </button>
    <button type="button" onclick="lightCopyReport(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-file-export" style="margin-right:8px;"></i>Export Report
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:25px;padding:20px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h3 class="small" style="margin:0;font-size:16px;font-weight:600;color:#ffcc00;">
      <i class="fas fa-chart-line" style="margin-right:8px;"></i>Lighting Design Analysis
    </h3>
    <div id="light-status" style="font-size:12px;padding:4px 10px;border-radius:12px;background:rgba(255, 204, 0, 0.2);color:#ffcc00;"></div>
  </div>
  
  <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:15px;margin-bottom:20px;">
    <div class="metric-card" style="grid-column:span 2;padding:15px;border-radius:8px;background:linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 152, 0, 0.1));border:1px solid rgba(255, 204, 0, 0.3);text-align:center;">
      <div style="font-size:12px;color:#ffcc00;text-transform:uppercase;letter-spacing:0.5px;">Required Fixtures</div>
      <div style="font-size:32px;font-weight:700;color:#ffcc00;margin:5px 0;"><span id="light-fixtures-required">‚Äì</span></div>
      <div style="font-size:12px;color:#ffcc00;opacity:0.8;" id="light-fixture-distribution">Evenly distributed</div>
    </div>
    
    <div class="metric-card" style="padding:12px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);text-align:center;">
      <div style="font-size:11px;color="#ffd54f";text-transform:uppercase;letter-spacing:0.5px;">Room Area</div>
      <div style="font-size:20px;font-weight:600;color="#ffd54f";margin:5px 0;"><span id="light-room-area">‚Äì</span> m¬≤</div>
      <div style="font-size:11px;color="#ffd54f";opacity:0.8;"><span id="light-room-dimensions">‚Äì</span></div>
    </div>
    
    <div class="metric-card" style="padding:12px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);text-align:center;">
      <div style="font-size:11px;color="#ffb74d";text-transform:uppercase;letter-spacing:0.5px;">Total Power</div>
      <div style="font-size:20px;font-weight:600;color="#ffb74d";margin:5px 0;"><span id="light-total-power">‚Äì</span> W</div>
      <div style="font-size:11px;color="#ffb74d";opacity:0.8;"><span id="light-energy-cost">‚Äì</span>/month</div>
    </div>
  </div>
  
  <div id="light-detailed-results" style="display:none;margin-top:20px;">
    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:15px;margin-bottom:20px;">
      <div class="result-card" style="padding:15px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);">
        <div style="font-size:13px;color:#ffcc00;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
          <i class="fas fa-ruler-combined" style="margin-right:8px;font-size:11px;"></i>Room Analysis
        </div>
        <div style="font-size:12px;color:#ffd54f;line-height:1.6;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Room Index:</span>
            <span id="light-room-index">‚Äì</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Utilization Factor:</span>
            <span id="light-utilization-factor">‚Äì</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Maintenance Factor:</span>
            <span id="light-maintenance-factor">‚Äì</span>
          </div>
          <div style="display:flex;justify-content:space-between;">
            <span>Required Luminous Flux:</span>
            <span id="light-total-lumens">‚Äì</span> lm
          </div>
        </div>
      </div>
      
      <div class="result-card" style="padding:15px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);">
        <div style="font-size:13px;color:#ffcc00;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
          <i class="fas fa-bolt" style="margin-right:8px;font-size:11px;"></i>Energy Analysis
        </div>
        <div style="font-size:12px;color:#ffd54f;line-height:1.6;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Total Power:</span>
            <span id="light-detailed-power">‚Äì</span> W
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span>Daily Energy:</span>
            <span id="light-daily-energy">‚Äì</span> kWh
          </div>
          <div style="display;flex;justify-content:space-between;margin-bottom:4px;">
            <span>Monthly Energy:</span>
            <span id="light-monthly-energy">‚Äì</span> kWh
          </div>
          <div style="display:flex;justify-content:space-between;">
            <span>Annual Energy:</span>
            <span id="light-annual-energy">‚Äì</span> kWh
          </div>
        </div>
      </div>
    </div>
    
    <div id="light-spacing-recommendation" style="margin-top:15px;padding:15px;border-radius:8px;background:rgba(255, 204, 0, 0.05);border:1px solid rgba(255, 204, 0, 0.2);">
      <div style="font-size:13px;color:#ffcc00;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
        <i class="fas fa-th" style="margin-right:8px;"></i>Fixture Layout Recommendations
      </div>
      <div style="font-size:12px;color:#ffd54f;line-height:1.6;" id="light-spacing-details">
        <!-- Spacing recommendations will appear here -->
      </div>
    </div>
  </div>
  
  <div id="light-comparison" style="display:none;margin-top:20px;">
    <div style="font-size:13px;color:#ffcc00;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
      <i class="fas fa-exchange-alt" style="margin-right:8px;"></i>Alternative Fixture Comparison
    </div>
    <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:10px;text-align:center;">
      <div class="fixture-option" data-type="led" style="padding:8px;border-radius:6px;background:rgba(76, 175, 80, 0.1);border:1px solid rgba(76, 175, 80, 0.3);cursor:pointer;">
        <div style="font-size:11px;color:#4caf50;">LED</div>
        <div style="font-size:14px;font-weight:600;color:#4caf50;"><span class="fixture-count">‚Äì</span></div>
        <div style="font-size:10px;color:#4caf50;">High Efficiency</div>
      </div>
      <div class="fixture-option" data-type="fluorescent" style="padding:8px;border-radius:6px;background:rgba(33, 150, 243, 0.1);border:1px solid rgba(33, 150, 243, 0.3);cursor:pointer;">
        <div style="font-size:11px;color:#2196f3;">Fluorescent</div>
        <div style="font-size:14px;font-weight:600;color:#2196f3;"><span class="fixture-count">‚Äì</span></div>
        <div style="font-size:10px;color:#2196f3;">Standard</div>
      </div>
      <div class="fixture-option" data-type="incandescent" style="padding:8px;border-radius:6px;background:rgba(244, 67, 54, 0.1);border:1px solid rgba(244, 67, 54, 0.3);cursor:pointer;">
        <div style="font-size:11px;color:#f44336;">Incandescent</div>
        <div style="font-size:14px;font-weight:600;color:#f44336;"><span class="fixture-count">‚Äì</span></div>
        <div style="font-size:10px;color:#f44336;">Low Efficiency</div>
      </div>
    </div>
  </div>

  <div style="margin-top:15px;display:flex;justify-content:space-between;align-items:center;">
    <div id="light-hint" class="small" style="opacity:0.9;font-size:13px;color:#ffcc00;"></div>
    <div id="light-timestamp" style="font-size:11px;color:#ffcc00;opacity:0.7;"></div>
  </div>
</div>

<details class="small" style="margin-top:12px;padding:15px;border-radius:8px;background:rgba(255, 204, 0, 0.05);border:1px solid rgba(255, 204, 0, 0.2);">
  <summary style="color:#ffcc00;font-weight:600;cursor:pointer;">
    <i class="fas fa-info-circle" style="margin-right:8px;"></i>Professional Lighting Design Principles
  </summary>
  <div style="margin-top:10px;font-size:13px;color:#ffd54f;line-height:1.6;">
    <p><strong>Lighting Design Methodology:</strong> Professional lighting design follows standardized methods to ensure adequate, comfortable, and energy-efficient illumination.</p>
    
    <div style="margin:10px 0;padding:10px;background:rgba(0,0,0,0.1);border-radius:6px;">
      <div style="color:#ffcc00;font-weight:600;margin-bottom:5px;">Lumen Method Formula:</div>
      <div style="font-family:'Courier New',monospace;font-size:12px;">
        <div>N = (E √ó A) √∑ (F √ó UF √ó MF)</div>
        <div style="margin-top:5px;color:#ffd54f;">
          N = Number of luminaires<br>
          E = Required illuminance (lux)<br>
          A = Room area (m¬≤)<br>
          F = Luminous flux per luminaire (lumens)<br>
          UF = Utilization factor (0-1)<br>
          MF = Maintenance factor (0-1)
        </div>
      </div>
    </div>
    
    <p><strong>Standard Illuminance Levels (Lux):</strong></p>
    <ul style="margin:5px 0;padding-left:20px;">
      <li><span style="color:#ffcc00;">Offices:</span> 300-500 lux (general), 500-750 lux (task areas)</li>
      <li><span style="color:#ffcc00;">Living Rooms:</span> 150-300 lux</li>
      <li><span style="color:#ffcc00;">Kitchens:</span> 300-500 lux (general), 500-750 lux (work surfaces)</li>
      <li><span style="color:#ffcc00;">Bedrooms:</span> 100-200 lux</li>
      <li><span style="color:#ffcc00;">Bathrooms:</span> 300-500 lux</li>
      <li><span style="color:#ffcc00;">Retail:</span> 500-1000 lux</li>
      <li><span style="color:#ffcc00;">Warehouses:</span> 150-300 lux</li>
    </ul>
    
    <p style="margin-top:10px;font-size:12px;opacity:0.8;">
      <i class="fas fa-exclamation-triangle" style="margin-right:4px;"></i>
      <strong>Important:</strong> This tool provides educational estimates only. All lighting designs must comply with local building codes, safety standards, and professional engineering requirements. Always consult certified lighting designers and electrical engineers for actual projects.
    </p>
  </div>
</details>

<script>
/* lighting-design-calculator.html
   - Professional lighting design calculator
   - Scoped with light- prefix
*/

// Room type presets (lux requirements)
const lightRoomPresets = {
  'office': { lux: 400, description: 'Office / Workspace', color: '#2196f3' },
  'living': { lux: 200, description: 'Living Room', color: '#4caf50' },
  'kitchen': { lux: 450, description: 'Kitchen', color: '#ff9800' },
  'bedroom': { lux: 150, description: 'Bedroom', color: '#9c27b0' },
  'bathroom': { lux: 350, description: 'Bathroom', color: '#00bcd4' },
  'classroom': { lux: 300, description: 'Classroom', color: '#673ab7' },
  'retail': { lux: 750, description: 'Retail Store', color: '#e91e63' },
  'hospital': { lux: 500, description: 'Hospital / Clinic', color: '#f44336' },
  'warehouse': { lux: 250, description: 'Warehouse', color: '#795548' },
  'gym': { lux: 300, description: 'Gym / Sports Hall', color: '#ff5722' }
};

// Fixture type presets (lumens, watts)
const lightFixturePresets = {
  'led_panel': { lumens: 3200, watts: 40, description: 'LED Panel', efficacy: 80 },
  'led_downlight': { lumens: 800, watts: 10, description: 'LED Downlight', efficacy: 80 },
  'fluorescent': { lumens: 1800, watts: 36, description: 'Fluorescent Tube', efficacy: 50 },
  'incandescent': { lumens: 800, watts: 60, description: 'Incandescent Bulb', efficacy: 13 },
  'halogen': { lumens: 1200, watts: 75, description: 'Halogen Lamp', efficacy: 16 },
  'high_bay': { lumens: 15000, watts: 150, description: 'High Bay Fixture', efficacy: 100 },
  'track': { lumens: 600, watts: 8, description: 'Track Lighting', efficacy: 75 },
  'pendant': { lumens: 1200, watts: 15, description: 'Pendant Light', efficacy: 80 }
};

// Calculate utilization factor based on room reflectance and geometry
function lightCalculateUtilizationFactor(roomIndex, ceilingReflectance, wallReflectance, floorReflectance) {
  // Simplified calculation based on standard lumen method tables
  // In real applications, this would use complex interpolation tables
  const baseUF = 0.65;
  
  // Adjust for reflectance
  const reflectanceFactor = (ceilingReflectance * 0.4 + wallReflectance * 0.5 + floorReflectance * 0.1) / 100;
  
  // Adjust for room index
  let roomIndexFactor;
  if (roomIndex < 1) roomIndexFactor = 0.55;
  else if (roomIndex < 2) roomIndexFactor = 0.65;
  else if (roomIndex < 3) roomIndexFactor = 0.70;
  else if (roomIndex < 4) roomIndexFactor = 0.75;
  else roomIndexFactor = 0.80;
  
  return baseUF * reflectanceFactor * roomIndexFactor;
}

function lightUpdateRoomPreset(select) {
  const preset = lightRoomPresets[select.value];
  if (preset) {
    // Update illuminance recommendation
    document.getElementById('light-lux').value = preset.lux;
    
    // Update room description
    const status = document.getElementById('light-status');
    status.textContent = `Selected: ${preset.description}`;
    status.style.color = preset.color;
  }
}

function lightUpdateFixturePreset(select) {
  const preset = lightFixturePresets[select.value];
  if (preset) {
    document.getElementById('light-lamp-lumens').value = preset.lumens;
    document.getElementById('light-lamp-wattage').value = preset.watts;
    document.getElementById('light-lamp-efficacy').value = preset.efficacy;
  }
}

function lightUpdateReflectanceSlider(slider) {
  const id = slider.id;
  const valueInput = document.getElementById(id + '-value');
  valueInput.value = slider.value;
}

function lightCalculate(btn) {
  const card = btn.closest('.card') || document;
  
  // Get room dimensions
  const length = parseFloat(document.getElementById('light-length').value);
  const width = parseFloat(document.getElementById('light-width').value);
  const height = parseFloat(document.getElementById('light-height').value);
  
  // Get reflectance values
  const ceilingReflectance = parseFloat(document.getElementById('light-ceiling-reflectance-value').value) / 100;
  const wallReflectance = parseFloat(document.getElementById('light-wall-reflectance-value').value) / 100;
  const floorReflectance = parseFloat(document.getElementById('light-floor-reflectance-value').value) / 100;
  
  // Get illuminance requirement
  let requiredLux = parseFloat(document.getElementById('light-lux').value);
  if (!requiredLux || requiredLux <= 0) {
    // Use room type preset
    const roomType = document.getElementById('light-room-type').value;
    requiredLux = lightRoomPresets[roomType]?.lux || 300;
  }
  
  // Get fixture data
  const fixtureLumens = parseFloat(document.getElementById('light-lamp-lumens').value);
  const fixtureWatts = parseFloat(document.getElementById('light-lamp-wattage').value);
  
  // Validation
  if (!length || length <= 0 || !width || width <= 0 || !height || height <= 0) {
    lightShowHint(card, "Please enter valid room dimensions", "error");
    return;
  }
  
  if (!fixtureLumens || fixtureLumens <= 0 || !fixtureWatts || fixtureWatts <= 0) {
    lightShowHint(card, "Please enter valid fixture data", "error");
    return;
  }
  
  // Calculate room area
  const roomArea = length * width;
  const roomVolume = roomArea * height;
  
  // Calculate room index (K)
  const roomIndex = (length * width) / (height * (length + width));
  
  // Calculate utilization factor
  const utilizationFactor = lightCalculateUtilizationFactor(roomIndex, 
    ceilingReflectance * 100, wallReflectance * 100, floorReflectance * 100);
  
  // Standard maintenance factor
  const maintenanceFactor = 0.8; // Standard value for clean environments
  
  // Calculate required number of fixtures using lumen method
  const totalLumensRequired = requiredLux * roomArea;
  const fixturesRequired = Math.ceil(totalLumensRequired / (fixtureLumens * utilizationFactor * maintenanceFactor));
  
  // Calculate energy consumption
  const totalPower = fixturesRequired * fixtureWatts;
  const dailyHours = 10; // Assume 10 hours per day
  const dailyEnergy = (totalPower * dailyHours) / 1000; // kWh
  const monthlyEnergy = dailyEnergy * 30;
  const annualEnergy = monthlyEnergy * 12;
  
  // Calculate energy cost (assuming $0.12 per kWh)
  const costPerKwh = 0.12;
  const monthlyCost = monthlyEnergy * costPerKwh;
  
  // Calculate luminous efficacy
  const efficacy = Math.round(fixtureLumens / fixtureWatts);
  
  // Update UI with results
  document.getElementById('light-room-area').textContent = roomArea.toFixed(1);
  document.getElementById('light-room-dimensions').textContent = `${length}m √ó ${width}m`;
  document.getElementById('light-room-index').textContent = roomIndex.toFixed(2);
  document.getElementById('light-utilization-factor').textContent = utilizationFactor.toFixed(2);
  document.getElementById('light-maintenance-factor').textContent = maintenanceFactor.toFixed(2);
  document.getElementById('light-total-lumens').textContent = Math.round(totalLumensRequired).toLocaleString();
  
  document.getElementById('light-fixtures-required').textContent = fixturesRequired;
  document.getElementById('light-total-power').textContent = totalPower;
  document.getElementById('light-detailed-power').textContent = totalPower;
  document.getElementById('light-energy-cost').textContent = `$${monthlyCost.toFixed(2)}`;
  document.getElementById('light-daily-energy').textContent = dailyEnergy.toFixed(1);
  document.getElementById('light-monthly-energy').textContent = monthlyEnergy.toFixed(0);
  document.getElementById('light-annual-energy').textContent = annualEnergy.toFixed(0);
  
  // Update status
  document.getElementById('light-status').textContent = "Calculation Complete";
  document.getElementById('light-status').style.background = "rgba(76, 175, 80, 0.2)";
  document.getElementById('light-status').style.color = "#81c784";
  
  // Update timestamp
  const now = new Date();
  document.getElementById('light-timestamp').textContent = 
    `Calculated: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
  
  // Show detailed results
  document.getElementById('light-detailed-results').style.display = 'block';
  
  // Generate spacing recommendations
  lightGenerateSpacingRecommendations(fixturesRequired, length, width);
  
  // Generate fixture comparison
  lightGenerateFixtureComparison(roomArea, requiredLux, utilizationFactor, maintenanceFactor);
  
  // Show success message
  lightShowHint(card, `‚úì Calculated: ${fixturesRequired} fixtures required`, "success");
}

function lightGenerateSpacingRecommendations(fixturesCount, length, width) {
  const spacingDiv = document.getElementById('light-spacing-details');
  
  if (fixturesCount <= 1) {
    spacingDiv.innerHTML = `
      <p>For a single fixture, place it centrally in the room.</p>
      <p>Recommended mounting height: 2.1-2.4m above floor level.</p>
    `;
    return;
  }
  
  // Calculate optimal spacing
  const roomArea = length * width;
  const spacingToHeightRatio = 1.5; // Standard ratio for uniform illumination
  
  // Suggest grid layout
  let rows = Math.round(Math.sqrt(fixturesCount * (length / width)));
  let cols = Math.round(fixturesCount / rows);
  
  // Ensure rows * cols >= fixturesCount
  while (rows * cols < fixturesCount) {
    if (length >= width) cols++;
    else rows++;
  }
  
  const spacingX = length / cols;
  const spacingY = width / rows;
  
  spacingDiv.innerHTML = `
    <p><strong>Recommended Grid Layout:</strong> ${rows} rows √ó ${cols} columns (${rows * cols} positions)</p>
    <p><strong>Fixture Spacing:</strong> ${spacingX.toFixed(2)}m (length) √ó ${spacingY.toFixed(2)}m (width)</p>
    <p><strong>Distance from walls:</strong> Approximately half the spacing (${(spacingX/2).toFixed(2)}m)</p>
    <p><strong>Uniformity ratio:</strong> Spacing-to-height ratio = ${(spacingX / 2.4).toFixed(1)}:1 (target: 1.5:1)</p>
    <p style="font-size:11px;color:#ffb74d;margin-top:8px;">
      <i class="fas fa-info-circle"></i> For optimal uniform illumination, maintain consistent spacing between fixtures.
    </p>
  `;
}

function lightGenerateFixtureComparison(roomArea, requiredLux, UF, MF) {
  const totalLumensRequired = requiredLux * roomArea;
  
  // Calculate for different fixture types
  const fixtureTypes = ['led', 'fluorescent', 'incandescent'];
  const fixtureData = {
    'led': { lumens: 800, watts: 10, efficacy: 80, color: '#4caf50' },
    'fluorescent': { lumens: 1800, watts: 36, efficacy: 50, color: '#2196f3' },
    'incandescent': { lumens: 800, watts: 60, efficacy: 13, color: '#f44336' }
  };
  
  fixtureTypes.forEach(type => {
    const data = fixtureData[type];
    const fixturesRequired = Math.ceil(totalLumensRequired / (data.lumens * UF * MF));
    const totalPower = fixturesRequired * data.watts;
    
    const option = document.querySelector(`.fixture-option[data-type="${type}"]`);
    if (option) {
      option.querySelector('.fixture-count').textContent = fixturesRequired;
      
      // Add click handler
      option.onclick = () => {
        document.getElementById('light-lamp-lumens').value = data.lumens;
        document.getElementById('light-lamp-wattage').value = data.watts;
        document.getElementById('light-lamp-efficacy').value = data.efficacy;
        document.getElementById('light-fixture-type').value = 'custom';
        
        // Recalculate
        const btn = document.querySelector('button[onclick*="lightCalculate"]');
        if (btn) lightCalculate(btn);
      };
    }
  });
  
  document.getElementById('light-comparison').style.display = 'block';
}

function lightReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form
  card.querySelector('form').reset();
  
  // Reset sliders
  const sliders = ['ceiling-reflectance', 'wall-reflectance', 'floor-reflectance'];
  sliders.forEach(id => {
    const slider = document.getElementById(`light-${id}`);
    const valueInput = document.getElementById(`light-${id}-value`);
    if (slider && valueInput) {
      slider.value = id === 'floor-reflectance' ? '20' : (id === 'wall-reflectance' ? '50' : '70');
      valueInput.value = slider.value;
    }
  });
  
  // Reset results
  document.getElementById('light-room-area').textContent = '‚Äì';
  document.getElementById('light-room-dimensions').textContent = '‚Äì';
  document.getElementById('light-fixtures-required').textContent = '‚Äì';
  document.getElementById('light-total-power').textContent = '‚Äì';
  document.getElementById('light-detailed-results').style.display = 'none';
  document.getElementById('light-comparison').style.display = 'none';
  document.getElementById('light-status').textContent = '';
  document.getElementById('light-timestamp').textContent = '';
  document.getElementById('light-hint').textContent = '';
  
  // Reset efficacy
  document.getElementById('light-lamp-efficacy').value = '80';
  
  lightShowHint(card, "‚úì Calculator reset to defaults", "success");
}

function lightCopyReport(btn) {
  const card = btn.closest('.card') || document;
  
  const fixtures = document.getElementById('light-fixtures-required').textContent;
  if (fixtures === '‚Äì') {
    lightShowHint(card, "No calculation to export", "warning");
    return;
  }
  
  // Gather all data
  const roomType = document.getElementById('light-room-type').options[document.getElementById('light-room-type').selectedIndex].text;
  const length = document.getElementById('light-length').value;
  const width = document.getElementById('light-width').value;
  const height = document.getElementById('light-height').value;
  const requiredLux = document.getElementById('light-lux').value;
  const fixtureLumens = document.getElementById('light-lamp-lumens').value;
  const fixtureWatts = document.getElementById('light-lamp-wattage').value;
  
  const roomArea = document.getElementById('light-room-area').textContent;
  const fixturesRequired = document.getElementById('light-fixtures-required').textContent;
  const totalPower = document.getElementById('light-total-power').textContent;
  const monthlyCost = document.getElementById('light-energy-cost').textContent;
  
  // Create report
  const report = `=== LIGHTING DESIGN REPORT ===
Generated: ${new Date().toLocaleString()}

=== ROOM SPECIFICATIONS ===
Room Type: ${roomType}
Dimensions: ${length}m √ó ${width}m √ó ${height}m
Area: ${roomArea} m¬≤
Required Illuminance: ${requiredLux} lux

=== FIXTURE SPECIFICATIONS ===
Fixture Type: ${document.getElementById('light-fixture-type').options[document.getElementById('light-fixture-type').selectedIndex].text}
Lumen Output: ${fixtureLumens} lm
Wattage: ${fixtureWatts} W
Luminous Efficacy: ${Math.round(fixtureLumens / fixtureWatts)} lm/W

=== CALCULATION RESULTS ===
Required Fixtures: ${fixturesRequired}
Total Power: ${totalPower} W
Estimated Monthly Energy Cost: ${monthlyCost}

=== REFLECTANCE VALUES ===
Ceiling: ${document.getElementById('light-ceiling-reflectance-value').value}%
Walls: ${document.getElementById('light-wall-reflectance-value').value}%
Floor: ${document.getElementById('light-floor-reflectance-value').value}%

=== IMPORTANT NOTES ===
1. This is an educational calculation only
2. Always consult certified lighting designers
3. Verify compliance with local building codes
4. Consider additional factors: daylight availability, task requirements, glare control
5. Energy calculations based on 10 hours daily usage at $0.12/kWh

=== DISCLAIMER ===
This report provides approximate values for educational purposes only.
Professional lighting design requires comprehensive analysis by qualified experts.`;

  // Copy to clipboard
  navigator.clipboard?.writeText(report).then(() => {
    lightShowHint(card, "‚úì Report copied to clipboard", "success");
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = report;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    lightShowHint(card, "‚úì Report copied to clipboard", "success");
  });
}

function lightShowHint(card, message, type) {
  const hint = card.querySelector('#light-hint');
  if (!hint) return;
  
  hint.textContent = message;
  
  if (type === "success") {
    hint.style.color = "#a5d6a7";
  } else if (type === "error") {
    hint.style.color = "#ef9a9a";
  } else if (type === "warning") {
    hint.style.color = "#ffcc80";
  }
  
  // Clear hint after 3 seconds
  setTimeout(() => {
    if (hint.textContent === message) hint.textContent = "";
  }, 3000);
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
  // Sync reflectance sliders and inputs
  const reflectanceIds = ['ceiling-reflectance', 'wall-reflectance', 'floor-reflectance'];
  reflectanceIds.forEach(id => {
    const slider = document.getElementById(`light-${id}`);
    const input = document.getElementById(`light-${id}-value`);
    
    if (slider && input) {
      slider.addEventListener('input', () => {
        input.value = slider.value;
      });
      
      input.addEventListener('input', () => {
        let value = parseInt(input.value) || 50;
        value = Math.min(90, Math.max(10, value));
        // Round to nearest 5
        value = Math.round(value / 5) * 5;
        input.value = value;
        slider.value = value;
      });
    }
  });
  
  // Update luminous efficacy when lumens or watts change
  const lumensInput = document.getElementById('light-lamp-lumens');
  const wattsInput = document.getElementById('light-lamp-wattage');
  const efficacyInput = document.getElementById('light-lamp-efficacy');
  
  function updateEfficacy() {
    const lumens = parseFloat(lumensInput.value) || 0;
    const watts = parseFloat(wattsInput.value) || 1;
    const efficacy = Math.round(lumens / watts);
    efficacyInput.value = isNaN(efficacy) ? '80' : efficacy;
  }
  
  if (lumensInput && wattsInput && efficacyInput) {
    lumensInput.addEventListener('input', updateEfficacy);
    wattsInput.addEventListener('input', updateEfficacy);
  }
  
  // Auto-calculate when room type or fixture type changes
  document.getElementById('light-room-type').addEventListener('change', function() {
    if (this.value !== 'custom') {
      setTimeout(() => {
        const btn = document.querySelector('button[onclick*="lightCalculate"]');
        if (btn) lightCalculate(btn);
      }, 500);
    }
  });
  
  document.getElementById('light-fixture-type').addEventListener('change', function() {
    if (this.value !== 'custom') {
      setTimeout(() => {
        const btn = document.querySelector('button[onclick*="lightCalculate"]');
        if (btn) lightCalculate(btn);
      }, 500);
    }
  });
});
</script>
