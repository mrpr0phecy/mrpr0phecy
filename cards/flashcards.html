<!-- cards/flashcards-builder.html -->
<h2 id="flashcards-builder-title">üìö Smart Flashcards</h2>

<form aria-describedby="flashcards-description">
    <p id="flashcards-description" class="small" style="color:rgba(230,250,255,0.9);margin-bottom:20px;">
        Create beautiful, interactive flashcards for effective studying. 
        <span style="color:var(--accent);font-weight:500;">Supports rich text, categories, and spaced repetition.</span>
    </p>
    
    <!-- Flashcard Creation -->
    <div style="margin-bottom:24px;">
        <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:1rem;">‚ú® Create New Flashcard</h3>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px;">
            <div>
                <label for="fc-question" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    ‚ùì Question
                </label>
                <textarea id="fc-question" rows="3" placeholder="Enter your question or term..." 
                          style="width:100%;padding:14px;border-radius:10px;border:2px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-family:inherit;resize:vertical;min-height:80px;"></textarea>
            </div>
            
            <div>
                <label for="fc-answer" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    ‚úÖ Answer
                </label>
                <textarea id="fc-answer" rows="3" placeholder="Enter the answer or definition..." 
                          style="width:100%;padding:14px;border-radius:10px;border:2px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-family:inherit;resize:vertical;min-height:80px;"></textarea>
            </div>
        </div>
        
        <!-- Category and Tags -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px;">
            <div>
                <label for="fc-category" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    üìÅ Category
                </label>
                <div style="display:flex;gap:8px;">
                    <select id="fc-category" style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;cursor:pointer;">
                        <option value="general">General</option>
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="language">Language</option>
                        <option value="programming">Programming</option>
                        <option value="medical">Medical</option>
                        <option value="custom">Custom...</option>
                    </select>
                    <input id="fc-custom-category" type="text" placeholder="Custom" 
                           style="display:none;flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;" />
                </div>
            </div>
            
            <div>
                <label for="fc-difficulty" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    ‚öñÔ∏è Difficulty
                </label>
                <div style="display:flex;gap:8px;">
                    <button type="button" onclick="fcSetDifficulty('easy')" id="fc-difficulty-easy"
                            style="flex:1;padding:10px;background:rgba(57,255,20,0.2);border:2px solid #39ff14;border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
                        Easy
                    </button>
                    <button type="button" onclick="fcSetDifficulty('medium')" id="fc-difficulty-medium"
                            style="flex:1;padding:10px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
                        Medium
                    </button>
                    <button type="button" onclick="fcSetDifficulty('hard')" id="fc-difficulty-hard"
                            style="flex:1;padding:10px;background:rgba(255,77,77,0.2);border:1px solid rgba(255,77,77,0.3);border-radius:8px;color:#ff4d4d;cursor:pointer;">
                        Hard
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div style="display:flex;gap:12px;margin-bottom:20px;">
            <button type="button" onclick="fcAddExample()" style="padding:10px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;">
                üìö Add Example
            </button>
            <button type="button" onclick="fcClearFields()" style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;">
                üóëÔ∏è Clear Fields
            </button>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="actions" style="display:flex;gap:12px;">
        <button type="button" onclick="fcAddFlashcard()" 
                style="flex:1;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(157,78,221,0.2));border:2px solid rgba(45,212,255,0.4);border-radius:12px;color:var(--accent);cursor:pointer;font-weight:600;font-size:1.1rem;display:flex;align-items:center;justify-content:center;gap:10px;">
            ‚ûï Add Flashcard
        </button>
        <button type="button" onclick="fcStartPractice()"
                style="padding:16px 24px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:2px solid rgba(57,255,20,0.4);border-radius:12px;color:#39ff14;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;">
            ‚ñ∂Ô∏è Start Practice
        </button>
    </div>
</form>

<!-- Flashcards Display -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 class="small" style="color:var(--accent);margin:0;font-size:1.1rem;">üìö Your Flashcards</h3>
        <div style="display:flex;gap:8px;align-items:center;">
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">
                <span id="fc-count">0</span> cards
            </div>
            <button onclick="fcExportCards()" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;display:flex;align-items:center;gap:6px;">
                üì• Export
            </button>
            <button onclick="fcClearAll()" style="padding:8px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:8px;color:#ff4d4d;cursor:pointer;display:flex;align-items:center;gap:6px;">
                üóëÔ∏è Clear All
            </button>
        </div>
    </div>
    
    <!-- Filter Controls -->
    <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
        <select id="fc-filter-category" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;cursor:pointer;">
            <option value="all">All Categories</option>
        </select>
        
        <select id="fc-filter-difficulty" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;cursor:pointer;">
            <option value="all">All Difficulties</option>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
        
        <button onclick="fcShuffleCards()" style="padding:8px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;display:flex;align-items:center;gap:6px;">
            üîÄ Shuffle
        </button>
        
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px;">
            <span style="font-size:0.9rem;color:rgba(230,250,255,0.7);">View:</span>
            <button onclick="fcToggleView('list')" id="fc-view-list" style="padding:6px 12px;background:rgba(45,212,255,0.2);border:1px solid var(--accent);border-radius:6px;color:var(--accent);cursor:pointer;">
                List
            </button>
            <button onclick="fcToggleView('grid')" id="fc-view-grid" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:rgba(230,250,255,0.8);cursor:pointer;">
                Grid
            </button>
        </div>
    </div>
    
    <!-- Flashcards Container -->
    <div id="fc-container" style="
        min-height:200px;
        border-radius:12px;
        background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04));
        border:2px solid rgba(45,212,255,0.15);
        padding:20px;
        display:grid;
        grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
        gap:16px;
    ">
        <div style="grid-column:1/-1;text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
            <div style="font-size:3rem;margin-bottom:16px;">üìö</div>
            <div style="font-size:1.1rem;margin-bottom:8px;color:var(--accent);">No flashcards yet</div>
            <div>Create your first flashcard using the form above!</div>
        </div>
    </div>
    
    <!-- Stats -->
    <div id="fc-stats" style="display:none;margin-top:20px;">
        <h4 style="color:var(--accent);margin:0 0 12px 0;font-size:1rem;">üìä Statistics</h4>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;text-align:center;">
                <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Total Cards</div>
                <div id="fc-stat-total" style="font-size:1.2rem;color:var(--accent);font-weight:600;">0</div>
            </div>
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;text-align:center;">
                <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Mastered</div>
                <div id="fc-stat-mastered" style="font-size:1.2rem;color:#39ff14;font-weight:600;">0</div>
            </div>
            <div style="padding:12px;background:rgba(255,204,0,0.1);border-radius:8px;text-align:center;">
                <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Learning</div>
                <div id="fc-stat-learning" style="font-size:1.2rem;color:#ffcc00;font-weight:600;">0</div>
            </div>
            <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;text-align:center;">
                <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Categories</div>
                <div id="fc-stat-categories" style="font-size:1.2rem;color:#9d4edd;font-weight:600;">0</div>
            </div>
        </div>
    </div>
</div>

<!-- Practice Mode Modal -->
<div id="fc-practice-modal" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    z-index:10000;
    backdrop-filter:blur(10px);
    align-items:center;
    justify-content:center;
">
    <div style="
        width:90%;
        max-width:600px;
        background:var(--panel);
        border-radius:16px;
        border:2px solid var(--accent);
        overflow:hidden;
        box-shadow:0 20px 60px rgba(0,0,0,0.5);
    ">
        <!-- Modal Header -->
        <div style="padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;justify-content:space-between;align-items:center;">
            <div style="font-size:1.2rem;color:var(--accent);font-weight:600;">üéØ Practice Session</div>
            <button onclick="fcClosePractice()" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">
                ‚úï Close
            </button>
        </div>
        
        <!-- Practice Content -->
        <div style="padding:40px 30px;text-align:center;">
            <div id="fc-practice-card" style="
                min-height:200px;
                padding:30px;
                background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
                border:2px solid rgba(45,212,255,0.2);
                border-radius:12px;
                margin-bottom:30px;
                display:flex;
                align-items:center;
                justify-content:center;
                cursor:pointer;
                font-size:1.2rem;
                line-height:1.6;
            "></div>
            
            <!-- Progress -->
            <div style="margin-bottom:20px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">
                        <span id="fc-practice-current">1</span> of <span id="fc-practice-total">0</span>
                    </div>
                    <div style="font-size:0.9rem;color:var(--accent);" id="fc-practice-category"></div>
                </div>
                <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
                    <div id="fc-practice-progress" style="height:100%;background:var(--accent);width:0%;transition:width 0.3s;"></div>
                </div>
            </div>
            
            <!-- Controls -->
            <div style="display:flex;gap:12px;justify-content:center;">
                <button onclick="fcPreviousCard()" style="padding:12px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;display:flex;align-items:center;gap:6px;">
                    ‚óÄÔ∏è Previous
                </button>
                
                <button onclick="fcFlipCard()" id="fc-flip-btn" style="flex:1;padding:14px 24px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:2px solid rgba(45,212,255,0.4);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;">
                    üîÑ Flip Card
                </button>
                
                <button onclick="fcRateCard('easy')" style="padding:12px 20px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
                    ‚úÖ Easy
                </button>
                
                <button onclick="fcRateCard('hard')" style="padding:12px 20px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;">
                    ‚ö†Ô∏è Hard
                </button>
                
                <button onclick="fcNextCard()" style="padding:12px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;display:flex;align-items:center;gap:6px;">
                    Next ‚ñ∂Ô∏è
                </button>
            </div>
        </div>
    </div>
</div>

<script>
/* flashcards-builder.html
   - Interactive flashcard system with practice mode
   - Prefix: fc
*/

let fcCards = [];
let fcCategories = new Set(['General']);
let fcDifficulty = 'medium';
let fcViewMode = 'grid';
let fcCurrentPracticeIndex = 0;
let fcPracticeCards = [];
let fcIsFlipped = false;

// Load saved flashcards from localStorage
function fcLoadCards() {
    const saved = localStorage.getItem('fcCards');
    if (saved) {
        try {
            fcCards = JSON.parse(saved);
            fcCategories = new Set(fcCards.map(card => card.category || 'General'));
            fcUpdateDisplay();
        } catch (e) {
            console.error('Failed to load flashcards:', e);
            fcCards = [];
        }
    }
}

// Save flashcards to localStorage
function fcSaveCards() {
    localStorage.setItem('fcCards', JSON.stringify(fcCards));
}

function fcSetDifficulty(difficulty) {
    fcDifficulty = difficulty;
    
    const difficulties = ['easy', 'medium', 'hard'];
    difficulties.forEach(diff => {
        const btn = document.getElementById(`fc-difficulty-${diff}`);
        if (diff === difficulty) {
            btn.style.background = diff === 'easy' ? 'rgba(57,255,20,0.2)' : 
                                 diff === 'medium' ? 'rgba(45,212,255,0.2)' : 
                                 'rgba(255,77,77,0.2)';
            btn.style.border = `2px solid ${diff === 'easy' ? '#39ff14' : 
                                          diff === 'medium' ? 'var(--accent)' : 
                                          '#ff4d4d'}`;
            btn.style.color = diff === 'easy' ? '#39ff14' : 
                             diff === 'medium' ? 'var(--accent)' : 
                             '#ff4d4d';
            btn.style.fontWeight = '600';
        } else {
            btn.style.background = 'rgba(255,255,255,0.05)';
            btn.style.border = '1px solid rgba(255,255,255,0.1)';
            btn.style.color = 'rgba(230,250,255,0.8)';
            btn.style.fontWeight = '400';
        }
    });
}

function fcAddFlashcard() {
    const question = document.getElementById('fc-question').value.trim();
    const answer = document.getElementById('fc-answer').value.trim();
    let category = document.getElementById('fc-category').value;
    
    if (category === 'custom') {
        category = document.getElementById('fc-custom-category').value.trim() || 'Custom';
    }
    
    if (!question || !answer) {
        alert('Please enter both question and answer.');
        return;
    }
    
    const card = {
        id: Date.now(),
        question: question,
        answer: answer,
        category: category,
        difficulty: fcDifficulty,
        createdAt: new Date().toISOString(),
        mastered: false,
        reviewCount: 0,
        lastReviewed: null
    };
    
    fcCards.push(card);
    fcCategories.add(category);
    fcSaveCards();
    fcUpdateDisplay();
    fcClearFields();
    
    // Visual feedback
    const button = document.querySelector('[onclick="fcAddFlashcard()"]');
    const original = button.innerHTML;
    button.innerHTML = '‚úÖ Added!';
    setTimeout(() => {
        button.innerHTML = original;
    }, 1000);
}

function fcClearFields() {
    document.getElementById('fc-question').value = '';
    document.getElementById('fc-answer').value = '';
    document.getElementById('fc-question').focus();
}

function fcAddExample() {
    const examples = [
        {
            question: "What is the capital of France?",
            answer: "Paris",
            category: "Geography",
            difficulty: "easy"
        },
        {
            question: "Solve: 2x + 5 = 13",
            answer: "x = 4",
            category: "Mathematics",
            difficulty: "medium"
        },
        {
            question: "What is photosynthesis?",
            answer: "The process by which plants convert sunlight into energy",
            category: "Science",
            difficulty: "hard"
        }
    ];
    
    const example = examples[Math.floor(Math.random() * examples.length)];
    
    document.getElementById('fc-question').value = example.question;
    document.getElementById('fc-answer').value = example.answer;
    document.getElementById('fc-category').value = example.category;
    fcSetDifficulty(example.difficulty);
}

function fcUpdateDisplay() {
    const container = document.getElementById('fc-container');
    const filterCategory = document.getElementById('fc-filter-category').value;
    const filterDifficulty = document.getElementById('fc-filter-difficulty').value;
    
    // Filter cards
    let filteredCards = fcCards;
    if (filterCategory !== 'all') {
        filteredCards = filteredCards.filter(card => card.category === filterCategory);
    }
    if (filterDifficulty !== 'all') {
        filteredCards = filteredCards.filter(card => card.difficulty === filterDifficulty);
    }
    
    // Update count
    document.getElementById('fc-count').textContent = filteredCards.length;
    document.getElementById('fc-stat-total').textContent = fcCards.length;
    
    // Update mastered count
    const masteredCount = fcCards.filter(card => card.mastered).length;
    const learningCount = fcCards.length - masteredCount;
    document.getElementById('fc-stat-mastered').textContent = masteredCount;
    document.getElementById('fc-stat-learning').textContent = learningCount;
    document.getElementById('fc-stat-categories').textContent = fcCategories.size;
    
    // Show/hide stats
    document.getElementById('fc-stats').style.display = fcCards.length > 0 ? 'block' : 'none';
    
    // Clear container
    container.innerHTML = '';
    
    if (filteredCards.length === 0) {
        container.innerHTML = `
            <div style="grid-column:1/-1;text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);">
                <div style="font-size:3rem;margin-bottom:16px;">üîç</div>
                <div style="font-size:1.1rem;margin-bottom:8px;color:var(--accent);">No matching cards</div>
                <div>Try changing your filters or create new flashcards!</div>
            </div>
        `;
        return;
    }
    
    // Display cards based on view mode
    if (fcViewMode === 'grid') {
        container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
        filteredCards.forEach(card => {
            const cardElement = fcCreateCardElement(card);
            container.appendChild(cardElement);
        });
    } else {
        container.style.gridTemplateColumns = '1fr';
        filteredCards.forEach(card => {
            const listElement = fcCreateListElement(card);
            container.appendChild(listElement);
        });
    }
    
    // Update category filter options
    fcUpdateCategoryFilter();
}

function fcCreateCardElement(card) {
    const div = document.createElement('div');
    div.className = 'fc-card';
    div.style.cssText = `
        background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
        border: 2px solid ${fcGetDifficultyColor(card.difficulty)};
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    `;
    
    div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px;">
            <div style="
                padding: 4px 10px;
                background: ${fcGetDifficultyColor(card.difficulty)}33;
                border: 1px solid ${fcGetDifficultyColor(card.difficulty)};
                border-radius: 6px;
                font-size: 0.8rem;
                color: ${fcGetDifficultyColor(card.difficulty)};
            ">
                ${card.difficulty}
            </div>
            <div style="
                padding: 4px 10px;
                background: rgba(45,212,255,0.1);
                border: 1px solid rgba(45,212,255,0.3);
                border-radius: 6px;
                font-size: 0.8rem;
                color: var(--accent);
            ">
                ${card.category}
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Question:</div>
            <div style="font-weight:500;line-height:1.5;">${fcEscapeHtml(card.question)}</div>
        </div>
        
        <div style="
            padding: 12px;
            background: rgba(57,255,20,0.05);
            border: 1px solid rgba(57,255,20,0.2);
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        " class="fc-answer">
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Answer:</div>
            <div style="font-weight:500;line-height:1.5;color:#39ff14;">${fcEscapeHtml(card.answer)}</div>
        </div>
        
        <div style="display:flex;gap:8px;margin-top:auto;">
            <button onclick="fcDeleteCard(${card.id}, event)" style="
                padding: 6px 12px;
                background: rgba(255,77,77,0.1);
                border: 1px solid rgba(255,77,77,0.3);
                border-radius: 6px;
                color: #ff4d4d;
                cursor: pointer;
                font-size: 0.8rem;
            ">
                Delete
            </button>
            <button onclick="fcToggleMastered(${card.id}, event)" style="
                padding: 6px 12px;
                background: ${card.mastered ? 'rgba(57,255,20,0.2)' : 'rgba(255,255,255,0.05)'};
                border: 1px solid ${card.mastered ? 'rgba(57,255,20,0.4)' : 'rgba(255,255,255,0.1)'};
                border-radius: 6px;
                color: ${card.mastered ? '#39ff14' : 'rgba(230,250,255,0.8)'};
                cursor: pointer;
                font-size: 0.8rem;
                margin-left: auto;
            ">
                ${card.mastered ? '‚úÖ Mastered' : 'Mark Mastered'}
            </button>
        </div>
    `;
    
    // Add click event to show/hide answer
    div.addEventListener('click', (e) => {
        if (!e.target.closest('button')) {
            const answer = div.querySelector('.fc-answer');
            answer.style.display = answer.style.display === 'none' ? 'block' : 'none';
            div.style.transform = answer.style.display === 'block' ? 'translateY(-4px)' : 'none';
            div.style.boxShadow = answer.style.display === 'block' ? '0 8px 24px rgba(0,0,0,0.3)' : 'none';
        }
    });
    
    return div;
}

function fcCreateListElement(card) {
    const div = document.createElement('div');
    div.className = 'fc-list-item';
    div.style.cssText = `
        background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-left: 4px solid ${fcGetDifficultyColor(card.difficulty)};
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.3s ease;
    `;
    
    div.innerHTML = `
        <div style="display:flex;align-items:start;gap:12px;">
            <div style="flex:1;">
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
                    <div style="
                        padding: 2px 8px;
                        background: ${fcGetDifficultyColor(card.difficulty)}33;
                        border: 1px solid ${fcGetDifficultyColor(card.difficulty)};
                        border-radius: 4px;
                        font-size: 0.7rem;
                        color: ${fcGetDifficultyColor(card.difficulty)};
                    ">
                        ${card.difficulty}
                    </div>
                    <div style="
                        padding: 2px 8px;
                        background: rgba(45,212,255,0.1);
                        border: 1px solid rgba(45,212,255,0.3);
                        border-radius: 4px;
                        font-size: 0.7rem;
                        color: var(--accent);
                    ">
                        ${card.category}
                    </div>
                    ${card.mastered ? '<span style="color:#39ff14;font-size:0.7rem;">‚úÖ Mastered</span>' : ''}
                </div>
                
                <div style="margin-bottom:8px;">
                    <div style="font-size:0.85rem;color:rgba(230,250,255,0.7);margin-bottom:2px;">Q:</div>
                    <div style="font-weight:500;">${fcEscapeHtml(card.question)}</div>
                </div>
                
                <div style="
                    padding: 10px;
                    background: rgba(57,255,20,0.05);
                    border: 1px solid rgba(57,255,20,0.2);
                    border-radius: 6px;
                    display: none;
                " class="fc-answer">
                    <div style="font-size:0.85rem;color:rgba(230,250,255,0.7);margin-bottom:2px;">A:</div>
                    <div style="color:#39ff14;">${fcEscapeHtml(card.answer)}</div>
                </div>
            </div>
            
            <div style="display:flex;gap:6px;">
                <button onclick="fcDeleteCard(${card.id}, event)" style="
                    padding: 6px 10px;
                    background: rgba(255,77,77,0.1);
                    border: 1px solid rgba(255,77,77,0.3);
                    border-radius: 6px;
                    color: #ff4d4d;
                    cursor: pointer;
                    font-size: 0.8rem;
                ">
                    üóëÔ∏è
                </button>
                <button onclick="fcToggleMastered(${card.id}, event)" style="
                    padding: 6px 10px;
                    background: ${card.mastered ? 'rgba(57,255,20,0.2)' : 'rgba(255,255,255,0.05)'};
                    border: 1px solid ${card.mastered ? 'rgba(57,255,20,0.4)' : 'rgba(255,255,255,0.1)'};
                    border-radius: 6px;
                    color: ${card.mastered ? '#39ff14' : 'rgba(230,250,255,0.8)'};
                    cursor: pointer;
                    font-size: 0.8rem;
                ">
                    ${card.mastered ? '‚úÖ' : '‚òÜ'}
                </button>
            </div>
        </div>
    `;
    
    // Add click event to show/hide answer
    div.addEventListener('click', (e) => {
        if (!e.target.closest('button')) {
            const answer = div.querySelector('.fc-answer');
            answer.style.display = answer.style.display === 'none' ? 'block' : 'none';
        }
    });
    
    return div;
}

function fcGetDifficultyColor(difficulty) {
    switch(difficulty) {
        case 'easy': return '#39ff14';
        case 'medium': return 'var(--accent)';
        case 'hard': return '#ff2d55';
        default: return 'var(--accent)';
    }
}

function fcEscapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function fcUpdateCategoryFilter() {
    const select = document.getElementById('fc-filter-category');
    const currentValue = select.value;
    
    select.innerHTML = '<option value="all">All Categories</option>';
    
    fcCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        if (category === currentValue) option.selected = true;
        select.appendChild(option);
    });
}

function fcDeleteCard(id, event) {
    event.stopPropagation();
    if (confirm('Are you sure you want to delete this flashcard?')) {
        fcCards = fcCards.filter(card => card.id !== id);
        fcSaveCards();
        fcUpdateDisplay();
    }
}

function fcToggleMastered(id, event) {
    event.stopPropagation();
    const card = fcCards.find(c => c.id === id);
    if (card) {
        card.mastered = !card.mastered;
        card.lastReviewed = new Date().toISOString();
        fcSaveCards();
        fcUpdateDisplay();
    }
}

function fcToggleView(mode) {
    fcViewMode = mode;
    
    const listBtn = document.getElementById('fc-view-list');
    const gridBtn = document.getElementById('fc-view-grid');
    
    if (mode === 'list') {
        listBtn.style.background = 'rgba(45,212,255,0.2)';
        listBtn.style.border = '1px solid var(--accent)';
        listBtn.style.color = 'var(--accent)';
        
        gridBtn.style.background = 'rgba(255,255,255,0.05)';
        gridBtn.style.border = '1px solid rgba(255,255,255,0.1)';
        gridBtn.style.color = 'rgba(230,250,255,0.8)';
    } else {
        gridBtn.style.background = 'rgba(45,212,255,0.2)';
        gridBtn.style.border = '1px solid var(--accent)';
        gridBtn.style.color = 'var(--accent)';
        
        listBtn.style.background = 'rgba(255,255,255,0.05)';
        listBtn.style.border = '1px solid rgba(255,255,255,0.1)';
        listBtn.style.color = 'rgba(230,250,255,0.8)';
    }
    
    fcUpdateDisplay();
}

function fcShuffleCards() {
    fcCards.sort(() => Math.random() - 0.5);
    fcSaveCards();
    fcUpdateDisplay();
}

function fcStartPractice() {
    if (fcCards.length === 0) {
        alert('Create some flashcards first!');
        return;
    }
    
    const filterCategory = document.getElementById('fc-filter-category').value;
    const filterDifficulty = document.getElementById('fc-filter-difficulty').value;
    
    // Filter cards for practice
    fcPracticeCards = fcCards;
    if (filterCategory !== 'all') {
        fcPracticeCards = fcPracticeCards.filter(card => card.category === filterCategory);
    }
    if (filterDifficulty !== 'all') {
        fcPracticeCards = fcPracticeCards.filter(card => card.difficulty === filterDifficulty);
    }
    
    if (fcPracticeCards.length === 0) {
        alert('No cards match your current filters.');
        return;
    }
    
    // Shuffle practice cards
    fcPracticeCards = [...fcPracticeCards].sort(() => Math.random() - 0.5);
    fcCurrentPracticeIndex = 0;
    fcIsFlipped = false;
    
    // Update practice modal
    document.getElementById('fc-practice-total').textContent = fcPracticeCards.length;
    document.getElementById('fc-practice-modal').style.display = 'flex';
    
    // Show first card
    fcUpdatePracticeCard();
}

function fcUpdatePracticeCard() {
    if (fcPracticeCards.length === 0) return;
    
    const card = fcPracticeCards[fcCurrentPracticeIndex];
    const practiceCard = document.getElementById('fc-practice-card');
    const flipBtn = document.getElementById('fc-flip-btn');
    
    if (fcIsFlipped) {
        practiceCard.innerHTML = `
            <div style="text-align:left;">
                <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">Answer:</div>
                <div style="font-size:1.3rem;color:#39ff14;font-weight:500;">${fcEscapeHtml(card.answer)}</div>
            </div>
        `;
        flipBtn.textContent = 'üîÅ Show Question';
    } else {
        practiceCard.innerHTML = `
            <div style="text-align:left;">
                <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">Question:</div>
                <div style="font-size:1.3rem;font-weight:500;">${fcEscapeHtml(card.question)}</div>
            </div>
        `;
        flipBtn.textContent = 'üîÑ Show Answer';
    }
    
    // Update progress
    document.getElementById('fc-practice-current').textContent = fcCurrentPracticeIndex + 1;
    document.getElementById('fc-practice-category').textContent = card.category;
    const progress = ((fcCurrentPracticeIndex + 1) / fcPracticeCards.length) * 100;
    document.getElementById('fc-practice-progress').style.width = `${progress}%`;
}

function fcFlipCard() {
    fcIsFlipped = !fcIsFlipped;
    fcUpdatePracticeCard();
}

function fcNextCard() {
    if (fcCurrentPracticeIndex < fcPracticeCards.length - 1) {
        fcCurrentPracticeIndex++;
        fcIsFlipped = false;
        fcUpdatePracticeCard();
    } else {
        fcClosePractice();
        alert('üéâ Practice session completed!');
    }
}

function fcPreviousCard() {
    if (fcCurrentPracticeIndex > 0) {
        fcCurrentPracticeIndex--;
        fcIsFlipped = false;
        fcUpdatePracticeCard();
    }
}

function fcRateCard(difficulty) {
    const card = fcPracticeCards[fcCurrentPracticeIndex];
    card.reviewCount = (card.reviewCount || 0) + 1;
    card.lastReviewed = new Date().toISOString();
    
    if (difficulty === 'easy') {
        card.mastered = true;
    }
    
    fcSaveCards();
    fcNextCard();
}

function fcClosePractice() {
    document.getElementById('fc-practice-modal').style.display = 'none';
    fcUpdateDisplay();
}

function fcExportCards() {
    if (fcCards.length === 0) {
        alert('No flashcards to export.');
        return;
    }
    
    const data = {
        exportedAt: new Date().toISOString(),
        totalCards: fcCards.length,
        categories: Array.from(fcCategories),
        flashcards: fcCards
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    
    const link = document.createElement('a');
    link.download = `flashcards-${new Date().toISOString().split('T')[0]}.json`;
    link.href = dataUri;
    link.click();
}

function fcClearAll() {
    if (fcCards.length === 0) return;
    
    if (confirm(`Are you sure you want to delete all ${fcCards.length} flashcards? This cannot be undone.`)) {
        fcCards = [];
        fcCategories = new Set(['General']);
        fcSaveCards();
        fcUpdateDisplay();
    }
}

// Initialize category selector
document.getElementById('fc-category').addEventListener('change', function() {
    const customInput = document.getElementById('fc-custom-category');
    if (this.value === 'custom') {
        customInput.style.display = 'block';
        customInput.focus();
    } else {
        customInput.style.display = 'none';
    }
});

// Initialize filter change listeners
document.getElementById('fc-filter-category').addEventListener('change', fcUpdateDisplay);
document.getElementById('fc-filter-difficulty').addEventListener('change', fcUpdateDisplay);

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved cards
        fcLoadCards();
        
        // Set default values
        fcSetDifficulty('medium');
        fcToggleView('grid');
        
        // Add example category to filter
        fcCategories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            document.getElementById('fc-filter-category').appendChild(option);
        });
        
        console.log('Flashcards Builder ready');
    });
}
</script>

<style>
@keyframes fcPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

#flashcards-builder-title {
    color: var(--accent);
    margin-top: 0;
    text-align: center;
    position: relative;
    padding-bottom: 12px;
}

#flashcards-builder-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 25%;
    width: 50%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
}

.fc-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

.fc-list-item:hover {
    transform: translateX(4px);
    background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
}

textarea {
    font-family: inherit;
    line-height: 1.5;
}

button {
    transition: all 0.2s ease;
}

button:hover {
    transform: translateY(-2px);
}

@media (max-width: 768px) {
    #fc-container {
        grid-template-columns: 1fr !important;
    }
    
    .actions button {
        padding: 12px !important;
        font-size: 0.9rem !important;
    }
}
</style>
