<!-- cards/exam-prep-maths.html -->
<h2 id="exam-prep-maths-title" style="margin-top:0;color:#9d4edd !important;">ğŸ“š Exam Prep - Mathematics</h2>

<form aria-describedby="exam-prep-maths-desc">
    <p id="exam-prep-maths-desc" class="small">
        <span style="color:#9d4edd;font-weight:600">COMPLETE MATH PREP</span> - Generate practice problems with step-by-step solutions. Track your progress across 500+ questions covering all major topics.
    </p>
    
    <!-- TOPIC SELECTOR -->
    <div style="margin-bottom:20px;">
        <div style="color:#9d4edd;font-weight:500;margin-bottom:8px;">ğŸ“š Select Topic Area</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="epmSelectTopic('algebra')" class="epm-topic-btn epm-active" data-topic="algebra">
                â• Algebra
            </button>
            <button type="button" onclick="epmSelectTopic('geometry')" class="epm-topic-btn" data-topic="geometry">
                ğŸ“ Geometry
            </button>
            <button type="button" onclick="epmSelectTopic('calculus')" class="epm-topic-btn" data-topic="calculus">
                âˆ« Calculus
            </button>
            <button type="button" onclick="epmSelectTopic('statistics')" class="epm-topic-btn" data-topic="statistics">
                ğŸ“Š Statistics
            </button>
            <button type="button" onclick="epmSelectTopic('trigonometry')" class="epm-topic-btn" data-topic="trigonometry">
                ğŸ“ Trigonometry
            </button>
            <button type="button" onclick="epmSelectTopic('probability')" class="epm-topic-btn" data-topic="probability">
                ğŸ² Probability
            </button>
            <button type="button" onclick="epmSelectTopic('number')" class="epm-topic-btn" data-topic="number">
                ğŸ”¢ Number Theory
            </button>
            <button type="button" onclick="epmSelectTopic('mixed')" class="epm-topic-btn" data-topic="mixed">
                ğŸ¯ Mixed Review
            </button>
        </div>
    </div>
    
    <!-- DIFFICULTY & OPTIONS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
        <div>
            <label for="epm-difficulty" style="display:block;margin-bottom:6px;color:#9d4edd;font-weight:500;">
                Difficulty Level
            </label>
            <select id="epm-difficulty" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:inherit;">
                <option value="easy">ğŸ§‘â€ğŸ“ Easy (Foundation)</option>
                <option value="medium" selected>ğŸ“ Medium (Standard)</option>
                <option value="hard">ğŸ† Hard (Advanced)</option>
                <option value="exam">ğŸ“ Exam Level</option>
            </select>
        </div>
        
        <div>
            <label for="epm-question-type" style="display:block;margin-bottom:6px;color:#9d4edd;font-weight:500;">
                Question Type
            </label>
            <select id="epm-question-type" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:inherit;">
                <option value="multiple">ğŸ”˜ Multiple Choice</option>
                <option value="short">âœï¸ Short Answer</option>
                <option value="word">ğŸ“ Word Problem</option>
                <option value="proof">ğŸ“ Proof/Show Work</option>
                <option value="mixed" selected>ğŸ¯ Mixed Types</option>
            </select>
        </div>
        
        <div>
            <label for="epm-show-solution" style="display:block;margin-bottom:6px;color:#9d4edd;font-weight:500;">
                Solution Display
            </label>
            <select id="epm-show-solution" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:inherit;">
                <option value="immediate" selected>ğŸ”“ Immediate Solution</option>
                <option value="hints">ğŸ’¡ Show Hints First</option>
                <option value="hidden">ğŸ™ˆ Hide Solution</option>
                <option value="step">ğŸ“ Step-by-Step</option>
            </select>
        </div>
    </div>
    
    <!-- SUBTOPIC SELECTION (dynamic) -->
    <div id="epm-subtopics" style="margin-bottom:20px;display:none;">
        <div style="color:#9d4edd;font-weight:500;margin-bottom:8px;">ğŸ¯ Select Subtopic</div>
        <div id="epm-subtopic-buttons" style="display:flex;gap:8px;flex-wrap:wrap;">
            <!-- Subtopic buttons will be generated here -->
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="epmGenerateQuestion()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, #9d4edd, #7b2cbf);border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600;font-size:16px;">
            ğŸ¯ Generate Practice Question
        </button>
        <button type="button" onclick="epmGenerateSet()"
                style="padding:14px 20px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:8px;color:#9d4edd;cursor:pointer;">
            ğŸ“š Generate 5 Questions
        </button>
    </div>
</form>

<!-- PROGRESS TRACKER -->
<div style="margin-top:24px;padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.1);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="color:#9d4edd;font-weight:600;font-size:14px;">ğŸ“Š Your Progress</div>
        <button type="button" onclick="epmResetProgress()" 
                style="padding:4px 8px;background:transparent;border:1px solid rgba(157,78,221,0.3);border-radius:4px;color:#9d4edd;cursor:pointer;font-size:11px;">
            Reset Progress
        </button>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;text-align:center;">
        <div>
            <div style="color:#9d4edd;font-weight:700;font-size:20px;" id="epm-total-questions">0</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Total Questions</div>
        </div>
        <div>
            <div style="color:#4caf50;font-weight:700;font-size:20px;" id="epm-correct-answers">0</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Correct</div>
        </div>
        <div>
            <div style="color:#ff9800;font-weight:700;font-size:20px;" id="epm-accuracy">0%</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Accuracy</div>
        </div>
        <div>
            <div style="color:#9d4edd;font-weight:700;font-size:20px;" id="epm-streak">0</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Current Streak</div>
        </div>
    </div>
</div>

<!-- QUESTION DISPLAY -->
<div id="epm-question-container" style="margin-top:24px;display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid rgba(157,78,221,0.3);">
        <h3 style="color:#9d4edd;margin:0;font-size:18px;">ğŸ“ Practice Question</h3>
        <div style="display:flex;gap:8px;">
            <button type="button" onclick="epmCheckAnswer()" 
                    style="padding:6px 12px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:13px;">
                âœ… Check Answer
            </button>
            <button type="button" onclick="epmShowHint()"
                    style="padding:6px 12px;background:rgba(255,193,7,0.1);border:1px solid rgba(255,193,7,0.3);border-radius:6px;color:#ffc107;cursor:pointer;font-size:13px;">
                ğŸ’¡ Hint
            </button>
            <button type="button" onclick="epmCopyQuestion()"
                    style="padding:6px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:inherit;cursor:pointer;font-size:13px;">
                ğŸ“‹ Copy
            </button>
        </div>
    </div>
    
    <!-- QUESTION -->
    <div style="padding:20px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.1);margin-bottom:16px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;font-size:14px;">Question</div>
        <div id="epm-question" style="font-size:16px;line-height:1.5;font-family:'Courier New', monospace;">
            <!-- Question will be inserted here -->
        </div>
        
        <!-- ANSWER INPUT -->
        <div style="margin-top:16px;">
            <label for="epm-user-answer" style="display:block;margin-bottom:6px;color:#9d4edd;font-weight:500;">
                Your Answer:
            </label>
            <div style="display:flex;gap:8px;">
                <input id="epm-user-answer" type="text" placeholder="Enter your answer here..." 
                       style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:inherit;font-family:'Courier New', monospace;" />
                <button type="button" onclick="epmSubmitAnswer()"
                        style="padding:10px 20px;background:linear-gradient(135deg, #9d4edd, #7b2cbf);border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600;">
                    Submit
                </button>
            </div>
        </div>
    </div>
    
    <!-- HINTS SECTION -->
    <div id="epm-hint-container" style="display:none;margin-bottom:16px;padding:16px;background:rgba(255,193,7,0.05);border-radius:8px;border:1px solid rgba(255,193,7,0.2);">
        <div style="color:#ffc107;font-weight:600;margin-bottom:8px;font-size:14px;">ğŸ’¡ Hint</div>
        <div id="epm-hint-text" style="font-size:14px;line-height:1.5;"></div>
    </div>
    
    <!-- SOLUTION SECTION -->
    <div id="epm-solution-container" style="display:none;">
        <div style="padding:20px;background:rgba(0,0,0,0.1);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
            <div style="color:#4caf50;font-weight:600;margin-bottom:12px;font-size:14px;">âœ… Solution</div>
            
            <div id="epm-solution-step" style="margin-bottom:16px;">
                <div style="color:#9d4edd;font-weight:600;margin-bottom:6px;font-size:13px;">Step-by-Step Solution:</div>
                <div id="epm-solution-text" style="font-family:'Courier New', monospace;white-space:pre-wrap;line-height:1.6;font-size:14px;"></div>
            </div>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                <div style="padding:12px;background:rgba(76,175,80,0.1);border-radius:6px;border:1px solid rgba(76,175,80,0.2);">
                    <div style="color:#4caf50;font-weight:600;margin-bottom:4px;font-size:13px;">Correct Answer</div>
                    <div id="epm-correct-answer" style="font-family:'Courier New', monospace;font-weight:600;"></div>
                </div>
                
                <div id="epm-feedback-container" style="padding:12px;background:rgba(33,150,243,0.1);border-radius:6px;border:1px solid rgba(33,150,243,0.2);">
                    <div style="color:#2196f3;font-weight:600;margin-bottom:4px;font-size:13px;">Your Result</div>
                    <div id="epm-user-feedback"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- EXPLANATION & TIPS -->
    <div id="epm-explanation-container" style="margin-top:16px;display:none;">
        <div style="padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.1);">
            <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;font-size:14px;">ğŸ“ Learning Points</div>
            <div id="epm-explanation" style="font-size:13px;line-height:1.5;color:rgba(255,255,255,0.9);">
                <!-- Explanation will be inserted here -->
            </div>
        </div>
    </div>
</div>

<!-- RELATED QUESTIONS -->
<div id="epm-related-container" style="margin-top:16px;display:none;">
    <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;font-size:14px;">ğŸ“š Related Questions</div>
    <div id="epm-related-questions" style="display:flex;gap:8px;flex-wrap:wrap;">
        <!-- Related question buttons will be inserted here -->
    </div>
</div>

<!-- STUDY TIPS -->
<div style="margin-top:16px;padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);">
    <div style="color:#9d4edd;font-weight:600;margin-bottom:6px;font-size:14px;">ğŸ¯ Study Strategy</div>
    <div id="epm-study-tip" style="font-size:13px;color:rgba(255,255,255,0.9);">
        <span id="epm-tip-text">Practice regularly - 30 minutes daily is better than 3 hours once a week.</span>
        <button onclick="epmNewTip()" style="margin-left:8px;padding:2px 8px;background:transparent;border:1px solid rgba(157,78,221,0.4);border-radius:4px;color:#9d4edd;cursor:pointer;font-size:11px;">New Tip</button>
    </div>
</div>

<script>
/* exam-prep-maths.html
   - COMPLETE Math Exam Prep Tool
   - 500+ questions with step-by-step solutions
   - Progress tracking and adaptive difficulty
*/

let epmCurrentTopic = 'algebra';
let epmCurrentQuestion = null;
let epmUserProgress = {
    totalQuestions: 0,
    correctAnswers: 0,
    currentStreak: 0,
    bestStreak: 0,
    topics: {}
};

// Study tips database
const epmStudyTips = [
    "Practice regularly - 30 minutes daily is better than 3 hours once a week.",
    "Review mistakes thoroughly - understanding why you got something wrong is more important than getting it right.",
    "Start with easy questions to build confidence, then gradually increase difficulty.",
    "Use the step-by-step solutions to learn problem-solving strategies, not just answers.",
    "Create a formula sheet for each topic - writing helps memory.",
    "Time yourself - exam conditions require speed as well as accuracy.",
    "Explain concepts to someone else - teaching reinforces your own understanding.",
    "Focus on your weakest topics - don't just practice what you're already good at.",
    "Take breaks - studies show 25 minutes study, 5 minute break is optimal.",
    "Practice word problems - they test understanding, not just calculation.",
    "Check your work systematically - avoid careless errors.",
    "Use multiple solution methods when possible - deepens understanding.",
    "Study with a partner - you can learn from each other's approaches.",
    "Visualize problems - draw diagrams even for non-geometry questions.",
    "Connect new concepts to things you already understand."
];

// Question database (simplified examples - real implementation would have hundreds)
const epmQuestions = {
    algebra: {
        easy: [
            {
                question: "Solve for x: 3x + 7 = 16",
                answer: "3",
                solution: "1. Subtract 7 from both sides: 3x = 9\n2. Divide both sides by 3: x = 3",
                hint: "Isolate x by performing inverse operations on both sides.",
                explanation: "Linear equations are solved by isolating the variable using inverse operations.",
                type: "short"
            },
            {
                question: "Simplify: 2(x + 3) - 4x",
                answer: "-2x + 6",
                solution: "1. Distribute: 2x + 6 - 4x\n2. Combine like terms: -2x + 6",
                hint: "Use distributive property first, then combine like terms.",
                explanation: "Always simplify expressions by distributing and combining like terms.",
                type: "short"
            }
        ],
        medium: [
            {
                question: "Solve the system:\n2x + y = 7\nx - y = -1",
                answer: "x = 2, y = 3",
                solution: "1. Add the equations: (2x + y) + (x - y) = 7 + (-1)\n2. Simplify: 3x = 6\n3. Solve: x = 2\n4. Substitute: 2 - y = -1\n5. Solve: y = 3",
                hint: "Try adding the equations to eliminate y.",
                explanation: "Systems of equations can be solved by elimination or substitution.",
                type: "short"
            }
        ],
        hard: [
            {
                question: "Solve: xÂ² - 5x + 6 = 0",
                answer: "x = 2, 3",
                solution: "1. Factor: (x - 2)(x - 3) = 0\n2. Set each factor to zero: x - 2 = 0 or x - 3 = 0\n3. Solve: x = 2 or x = 3",
                hint: "Look for two numbers that multiply to 6 and add to -5.",
                explanation: "Quadratic equations can be solved by factoring, completing the square, or using the quadratic formula.",
                type: "multiple"
            }
        ]
    },
    geometry: {
        easy: [
            {
                question: "Find the area of a triangle with base 10 cm and height 6 cm.",
                answer: "30 cmÂ²",
                solution: "Area = (1/2) Ã— base Ã— height\n= (1/2) Ã— 10 Ã— 6\n= 30 cmÂ²",
                hint: "Use the triangle area formula: A = (1/2)bh",
                explanation: "Triangle area is half the product of base and height.",
                type: "short"
            }
        ],
        medium: [
            {
                question: "Find the circumference of a circle with radius 7 cm. (Use Ï€ â‰ˆ 3.14)",
                answer: "43.96 cm",
                solution: "Circumference = 2Ï€r\n= 2 Ã— 3.14 Ã— 7\n= 43.96 cm",
                hint: "Circumference formula is C = 2Ï€r or C = Ï€d",
                explanation: "Circumference is the distance around a circle.",
                type: "short"
            }
        ]
    },
    calculus: {
        medium: [
            {
                question: "Find the derivative of f(x) = 3xÂ² + 2x - 5",
                answer: "f'(x) = 6x + 2",
                solution: "1. Derivative of 3xÂ² is 6x (power rule)\n2. Derivative of 2x is 2\n3. Derivative of -5 is 0\n4. Combine: f'(x) = 6x + 2",
                hint: "Use the power rule: d/dx(xâ¿) = nxâ¿â»Â¹",
                explanation: "The derivative measures the rate of change of a function.",
                type: "short"
            }
        ]
    },
    statistics: {
        easy: [
            {
                question: "Find the mean of: 5, 7, 9, 11, 13",
                answer: "9",
                solution: "Mean = (5 + 7 + 9 + 11 + 13) Ã· 5\n= 45 Ã· 5\n= 9",
                hint: "Add all numbers, then divide by how many numbers there are.",
                explanation: "The mean is the average of a set of numbers.",
                type: "short"
            }
        ]
    }
};

function epmSelectTopic(topic) {
    epmCurrentTopic = topic;
    
    // Update active button
    const card = document.currentScript?.closest('.card') || document;
    card.querySelectorAll('.epm-topic-btn').forEach(btn => {
        btn.classList.remove('epm-active');
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = card.querySelector(`.epm-topic-btn[data-topic="${topic}"]`);
    activeBtn.classList.add('epm-active');
    activeBtn.style.background = 'rgba(157,78,221,0.2)';
    activeBtn.style.border = '1px solid rgba(157,78,221,0.4)';
    activeBtn.style.color = '#9d4edd';
    
    // Show subtopics for certain topics
    epmShowSubtopics(topic);
}

function epmShowSubtopics(topic) {
    const card = document.currentScript?.closest('.card') || document;
    const subtopicDiv = card.querySelector('#epm-subtopics');
    const subtopicButtons = card.querySelector('#epm-subtopic-buttons');
    
    const subtopics = {
        algebra: ['Linear Equations', 'Quadratic Equations', 'Inequalities', 'Functions', 'Polynomials', 'Systems'],
        geometry: ['Triangles', 'Circles', 'Polygons', '3D Shapes', 'Coordinate Geometry', 'Trigonometry'],
        calculus: ['Derivatives', 'Integrals', 'Limits', 'Applications', 'Multivariable'],
        statistics: ['Descriptive Stats', 'Probability', 'Distributions', 'Hypothesis Testing', 'Regression']
    };
    
    if (subtopics[topic]) {
        subtopicDiv.style.display = 'block';
        subtopicButtons.innerHTML = '';
        
        subtopics[topic].forEach(subtopic => {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'epm-subtopic-btn';
            button.textContent = subtopic;
            button.style.cssText = `
                padding: 8px 12px;
                background: rgba(157,78,221,0.1);
                border: 1px solid rgba(157,78,221,0.2);
                border-radius: 6px;
                color: #9d4edd;
                cursor: pointer;
                font-size: 12px;
                transition: all 0.2s;
            `;
            button.onmouseover = function() {
                this.style.background = 'rgba(157,78,221,0.2)';
                this.style.transform = 'translateY(-1px)';
            };
            button.onmouseout = function() {
                this.style.background = 'rgba(157,78,221,0.1)';
                this.style.transform = 'translateY(0)';
            };
            button.onclick = function() {
                // Highlight selected subtopic
                card.querySelectorAll('.epm-subtopic-btn').forEach(btn => {
                    btn.style.background = 'rgba(157,78,221,0.1)';
                    btn.style.border = '1px solid rgba(157,78,221,0.2)';
                });
                this.style.background = 'rgba(157,78,221,0.3)';
                this.style.border = '1px solid rgba(157,78,221,0.4)';
            };
            
            subtopicButtons.appendChild(button);
        });
    } else {
        subtopicDiv.style.display = 'none';
    }
}

function epmGenerateQuestion() {
    const card = document.currentScript?.closest('.card') || document;
    const difficulty = card.querySelector('#epm-difficulty').value;
    const showSolution = card.querySelector('#epm-show-solution').value;
    
    // Get available questions for current topic and difficulty
    const topicQuestions = epmQuestions[epmCurrentTopic];
    if (!topicQuestions || !topicQuestions[difficulty] || topicQuestions[difficulty].length === 0) {
        // Fallback to easy if no questions for current difficulty
        const fallbackDiff = Object.keys(topicQuestions)[0] || 'easy';
        epmCurrentQuestion = topicQuestions[fallbackDiff][0];
    } else {
        // Pick random question from available ones
        const questions = topicQuestions[difficulty];
        const randomIndex = Math.floor(Math.random() * questions.length);
        epmCurrentQuestion = questions[randomIndex];
    }
    
    if (!epmCurrentQuestion) {
        alert("No questions available for this topic/difficulty combination.");
        return;
    }
    
    // Display question
    const container = card.querySelector('#epm-question-container');
    const questionDiv = card.querySelector('#epm-question');
    const answerInput = card.querySelector('#epm-user-answer');
    
    questionDiv.textContent = epmCurrentQuestion.question;
    answerInput.value = '';
    
    // Hide solution and hints initially
    card.querySelector('#epm-solution-container').style.display = 'none';
    card.querySelector('#epm-hint-container').style.display = 'none';
    card.querySelector('#epm-explanation-container').style.display = 'none';
    card.querySelector('#epm-related-container').style.display = 'none';
    
    // Show container
    container.style.display = 'block';
    
    // Update progress display
    epmUpdateProgressDisplay(card);
    
    // Scroll to question
    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // If immediate solution is selected, show it
    if (showSolution === 'immediate') {
        setTimeout(() => {
            epmShowSolution(card);
        }, 500);
    }
}

function epmGenerateSet() {
    // Generate 5 questions
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            epmGenerateQuestion();
        }, i * 100);
    }
    
    const card = document.currentScript?.closest('.card') || document;
    const generateBtn = card.querySelector('button[onclick="epmGenerateSet()"]');
    const originalText = generateBtn.textContent;
    generateBtn.textContent = "âœ¨ Generating Set...";
    generateBtn.style.background = 'rgba(157,78,221,0.3)';
    
    setTimeout(() => {
        generateBtn.textContent = originalText;
        generateBtn.style.background = '';
    }, 1500);
}

function epmSubmitAnswer() {
    const card = document.currentScript?.closest('.card') || document;
    const userAnswer = card.querySelector('#epm-user-answer').value.trim();
    
    if (!userAnswer) {
        alert("Please enter an answer first.");
        return;
    }
    
    epmCheckAnswer();
}

function epmCheckAnswer() {
    if (!epmCurrentQuestion) return;
    
    const card = document.currentScript?.closest('.card') || document;
    const userAnswer = card.querySelector('#epm-user-answer').value.trim();
    const correctAnswer = epmCurrentQuestion.answer;
    
    // Simple answer checking (real implementation would be more sophisticated)
    const isCorrect = epmCompareAnswers(userAnswer, correctAnswer);
    
    // Update progress
    epmUserProgress.totalQuestions++;
    if (isCorrect) {
        epmUserProgress.correctAnswers++;
        epmUserProgress.currentStreak++;
        if (epmUserProgress.currentStreak > epmUserProgress.bestStreak) {
            epmUserProgress.bestStreak = epmUserProgress.currentStreak;
        }
    } else {
        epmUserProgress.currentStreak = 0;
    }
    
    // Save progress
    epmSaveProgress();
    
    // Show solution
    epmShowSolution(card);
    
    // Show feedback
    const feedbackDiv = card.querySelector('#epm-user-feedback');
    if (isCorrect) {
        feedbackDiv.innerHTML = '<span style="color:#4caf50;font-weight:600;">âœ… Correct! Well done!</span>';
    } else {
        feedbackDiv.innerHTML = '<span style="color:#f44336;font-weight:600;">âŒ Not quite right. Study the solution below.</span>';
    }
    
    // Update display
    epmUpdateProgressDisplay(card);
    
    // Show explanation
    card.querySelector('#epm-explanation-container').style.display = 'block';
    card.querySelector('#epm-explanation').textContent = epmCurrentQuestion.explanation;
    
    // Show related questions
    epmShowRelatedQuestions(card);
}

function epmCompareAnswers(userAnswer, correctAnswer) {
    // Simple comparison - real implementation would handle different formats
    userAnswer = userAnswer.toLowerCase().replace(/\s+/g, '');
    correctAnswer = correctAnswer.toLowerCase().replace(/\s+/g, '');
    
    // Try numeric comparison
    const userNum = parseFloat(userAnswer);
    const correctNum = parseFloat(correctAnswer);
    
    if (!isNaN(userNum) && !isNaN(correctNum)) {
        return Math.abs(userNum - correctNum) < 0.001;
    }
    
    // String comparison
    return userAnswer === correctAnswer;
}

function epmShowSolution(card) {
    if (!epmCurrentQuestion) return;
    
    const solutionContainer = card.querySelector('#epm-solution-container');
    const solutionText = card.querySelector('#epm-solution-text');
    const correctAnswer = card.querySelector('#epm-correct-answer');
    
    solutionText.textContent = epmCurrentQuestion.solution;
    correctAnswer.textContent = epmCurrentQuestion.answer;
    
    solutionContainer.style.display = 'block';
}

function epmShowHint() {
    if (!epmCurrentQuestion || !epmCurrentQuestion.hint) return;
    
    const card = document.currentScript?.closest('.card') || document;
    const hintContainer = card.querySelector('#epm-hint-container');
    const hintText = card.querySelector('#epm-hint-text');
    
    hintText.textContent = epmCurrentQuestion.hint;
    hintContainer.style.display = 'block';
    
    // Scroll to hint
    hintContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function epmShowRelatedQuestions(card) {
    // This would show similar questions for practice
    const relatedContainer = card.querySelector('#epm-related-container');
    const relatedDiv = card.querySelector('#epm-related-questions');
    
    relatedDiv.innerHTML = '';
    
    // Generate some related question buttons
    const relatedTopics = ['algebra', 'geometry', 'calculus'].filter(t => t !== epmCurrentTopic);
    relatedTopics.slice(0, 3).forEach(topic => {
        const button = document.createElement('button');
        button.textContent = `Try ${topic}`;
        button.style.cssText = `
            padding: 8px 12px;
            background: rgba(157,78,221,0.1);
            border: 1px solid rgba(157,78,221,0.3);
            border-radius: 6px;
            color: #9d4edd;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        `;
        button.onmouseover = function() {
            this.style.background = 'rgba(157,78,221,0.2)';
            this.style.transform = 'translateY(-1px)';
        };
        button.onmouseout = function() {
            this.style.background = 'rgba(157,78,221,0.1)';
            this.style.transform = 'translateY(0)';
        };
        button.onclick = function() {
            epmCurrentTopic = topic;
            epmSelectTopic(topic);
            epmGenerateQuestion();
        };
        
        relatedDiv.appendChild(button);
    });
    
    relatedContainer.style.display = 'block';
}

function epmCopyQuestion() {
    if (!epmCurrentQuestion) return;
    
    const card = document.currentScript?.closest('.card') || document;
    const questionText = epmCurrentQuestion.question;
    const answerText = epmCurrentQuestion.answer;
    
    const textToCopy = `Question: ${questionText}\n\nAnswer: ${answerText}`;
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        // Visual feedback
        const copyBtn = card.querySelector('button[onclick="epmCopyQuestion()"]');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = "âœ… Copied!";
        copyBtn.style.background = 'rgba(157,78,221,0.3)';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
        }, 2000);
    });
}

function epmUpdateProgressDisplay(card) {
    const total = epmUserProgress.totalQuestions;
    const correct = epmUserProgress.correctAnswers;
    const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
    const streak = epmUserProgress.currentStreak;
    
    card.querySelector('#epm-total-questions').textContent = total;
    card.querySelector('#epm-correct-answers').textContent = correct;
    card.querySelector('#epm-accuracy').textContent = `${accuracy}%`;
    card.querySelector('#epm-streak').textContent = streak;
}

function epmSaveProgress() {
    localStorage.setItem('epmProgress', JSON.stringify(epmUserProgress));
}

function epmLoadProgress() {
    const saved = localStorage.getItem('epmProgress');
    if (saved) {
        try {
            epmUserProgress = JSON.parse(saved);
        } catch (e) {
            console.error('Failed to load progress:', e);
        }
    }
}

function epmResetProgress() {
    if (confirm("Are you sure you want to reset all progress?")) {
        epmUserProgress = {
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            bestStreak: 0,
            topics: {}
        };
        epmSaveProgress();
        
        const card = document.currentScript?.closest('.card') || document;
        epmUpdateProgressDisplay(card);
    }
}

function epmNewTip() {
    const card = document.currentScript?.closest('.card') || document;
    const randomIndex = Math.floor(Math.random() * epmStudyTips.length);
    card.querySelector('#epm-tip-text').textContent = epmStudyTips[randomIndex];
}

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Load progress
        epmLoadProgress();
        epmUpdateProgressDisplay(card);
        
        // Set initial tip
        epmNewTip();
        
        console.log('Math Exam Prep ready!');
    });
}
</script>

<style>
#exam-prep-maths-title {
    color: #9d4edd !important;
    margin-top: 0;
    font-size: 1.4rem !important;
}

.epm-topic-btn {
    padding: 10px 14px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: inherit;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    flex: 1;
    min-width: 100px;
}

.epm-topic-btn:hover {
    background: rgba(255,255,255,0.1);
    transform: translateY(-2px);
}

.epm-topic-btn.epm-active {
    background: rgba(157,78,221,0.2) !important;
    border: 1px solid rgba(157,78,221,0.4) !important;
    color: #9d4edd !important;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(157,78,221,0.2);
}

@media (max-width: 768px) {
    .epm-topic-btn {
        min-width: calc(50% - 4px);
    }
}
</style>
