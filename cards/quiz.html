<!-- cards/quiz-generator.html -->
<h2 id="quiz-generator-title">üéØ Smart Quiz Generator</h2>

<form aria-describedby="quiz-generator-desc">
    <p id="quiz-generator-desc" class="small">
        Create custom quizzes, track progress, and test your knowledge. Perfect for studying, training, or self-assessment.
        <span style="color:var(--accent)">Add multiple choice, true/false, or open-ended questions!</span>
    </p>
    
    <!-- QUIZ SETTINGS -->
    <div class="section" style="margin-bottom:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:10px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;">üìù Quiz Settings</h3>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
            <div>
                <label for="qg-quiz-title" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Quiz Title
                </label>
                <input id="qg-quiz-title" type="text" placeholder="e.g., Math Practice Quiz" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            </div>
            
            <div>
                <label for="qg-question-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Question Type
                </label>
                <select id="qg-question-type" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
                    <option value="multiple-choice">Multiple Choice</option>
                    <option value="true-false">True/False</option>
                    <option value="short-answer">Short Answer</option>
                    <option value="open-ended">Open Ended</option>
                </select>
            </div>
        </div>
        
        <div style="margin-top:12px;">
            <label for="qg-category" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Category/Tags
            </label>
            <input id="qg-category" type="text" placeholder="e.g., Math, Science, History" 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        </div>
    </div>
    
    <!-- QUESTION BUILDER -->
    <div class="section" style="margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid rgba(255,255,255,0.1);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;">‚úèÔ∏è Question Builder</h3>
        
        <div style="margin-bottom:16px;">
            <label for="qg-question" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Question
            </label>
            <textarea id="qg-question" rows="3" placeholder="Enter your question here..."
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
        
        <!-- MULTIPLE CHOICE OPTIONS -->
        <div id="qg-multiple-choice" style="display:none;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Options (check correct answer)</div>
            <div id="qg-options-container" style="display:flex;flex-direction:column;gap:8px;">
                <div class="option-item" style="display:flex;align-items:center;gap:10px;">
                    <input type="radio" name="correct-option" value="0" style="accent-color:var(--accent);">
                    <input type="text" class="option-input" placeholder="Option A" 
                           style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;">
                    <button type="button" onclick="qgRemoveOption(this)" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px;font-size:18px;">√ó</button>
                </div>
                <div class="option-item" style="display:flex;align-items:center;gap:10px;">
                    <input type="radio" name="correct-option" value="1" style="accent-color:var(--accent);">
                    <input type="text" class="option-input" placeholder="Option B" 
                           style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;">
                    <button type="button" onclick="qgRemoveOption(this)" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px;font-size:18px;">√ó</button>
                </div>
            </div>
            <button type="button" onclick="qgAddOption()" 
                    style="margin-top:8px;padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
                + Add Option
            </button>
        </div>
        
        <!-- TRUE/FALSE OPTIONS -->
        <div id="qg-true-false" style="display:none;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Select correct answer</div>
            <div style="display:flex;gap:12px;">
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                    <input type="radio" name="true-false" value="true" style="accent-color:var(--accent);">
                    <span style="color:#39ff14;">True</span>
                </label>
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                    <input type="radio" name="true-false" value="false" style="accent-color:var(--accent);">
                    <span style="color:#ff2d55;">False</span>
                </label>
            </div>
        </div>
        
        <!-- SHORT ANSWER -->
        <div id="qg-short-answer" style="display:none;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Correct Answer</div>
            <input id="qg-short-answer-input" type="text" placeholder="Enter correct answer" 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        </div>
        
        <!-- OPEN ENDED -->
        <div id="qg-open-ended" style="display:none;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Expected Answer (optional)</div>
            <textarea id="qg-open-ended-input" rows="2" placeholder="Sample answer or key points..."
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
        
        <!-- DIFFICULTY -->
        <div style="margin-top:16px;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Difficulty Level</div>
            <div style="display:flex;gap:12px;">
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                    <input type="radio" name="difficulty" value="easy" checked style="accent-color:#39ff14;">
                    <span style="color:#39ff14;">Easy</span>
                </label>
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                    <input type="radio" name="difficulty" value="medium" style="accent-color:#ffcc00;">
                    <span style="color:#ffcc00;">Medium</span>
                </label>
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                    <input type="radio" name="difficulty" value="hard" style="accent-color:#ff2d55;">
                    <span style="color:#ff2d55;">Hard</span>
                </label>
            </div>
        </div>
        
        <!-- ADD QUESTION BUTTON -->
        <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
            <button type="button" onclick="qgAddQuestion()" 
                    style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
                ‚úÖ Add Question to Quiz
            </button>
            <button type="button" onclick="qgClearCurrent()"
                    style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
                Clear
            </button>
        </div>
    </div>
</form>

<!-- QUIZ PREVIEW -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 class="small" style="color:var(--accent);margin:0;">üìã Quiz Preview</h3>
        <div style="display:flex;gap:8px;">
            <button type="button" onclick="qgStartQuiz()" 
                    style="padding:8px 16px;background:linear-gradient(135deg, #39ff14, #2dd4ff);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;font-size:12px;">
                ‚ñ∂ Start Quiz
            </button>
            <button type="button" onclick="qgExportQuiz()"
                    style="padding:8px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
                üì• Export
            </button>
        </div>
    </div>
    
    <!-- QUIZ STATS -->
    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:12px;margin-bottom:16px;">
        <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;text-align:center;">
            <div style="font-size:24px;font-weight:bold;color:var(--accent);" id="qg-total-questions">0</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Total Questions</div>
        </div>
        <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;text-align:center;">
            <div style="font-size:24px;font-weight:bold;color:#39ff14;" id="qg-correct-answers">0</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Correct</div>
        </div>
        <div style="padding:12px;background:rgba(255,45,85,0.05);border-radius:8px;text-align:center;">
            <div style="font-size:24px;font-weight:bold;color:#ff2d55;" id="qg-incorrect-answers">0</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Incorrect</div>
        </div>
        <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;text-align:center;">
            <div style="font-size:24px;font-weight:bold;color:#ffcc00;" id="qg-percentage">0%</div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Score</div>
        </div>
    </div>
    
    <!-- QUESTIONS LIST -->
    <div id="qg-questions-list" style="max-height:400px;overflow-y:auto;padding-right:8px;">
        <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
            No questions added yet. Start by adding your first question!
        </div>
    </div>
</div>

<!-- QUIZ MODE -->
<div id="qg-quiz-mode" style="display:none;margin-top:24px;">
    <div style="padding:20px;background:rgba(0,0,0,0.3);border-radius:10px;border:2px solid rgba(45,212,255,0.3);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
            <h3 style="color:var(--accent);margin:0;" id="qg-quiz-title-display">Quiz Mode</h3>
            <div style="display:flex;gap:8px;align-items:center;">
                <div style="color:#ffcc00;font-size:14px;" id="qg-quiz-progress">Question 0/0</div>
                <button type="button" onclick="qgExitQuiz()" 
                        style="padding:6px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">
                    Exit Quiz
                </button>
            </div>
        </div>
        
        <!-- CURRENT QUESTION -->
        <div id="qg-quiz-question-container" style="margin-bottom:24px;">
            <!-- Quiz question will be displayed here -->
        </div>
        
        <!-- ANSWER INPUT -->
        <div id="qg-answer-container" style="margin-bottom:20px;">
            <!-- Answer input based on question type -->
        </div>
        
        <!-- NAVIGATION -->
        <div style="display:flex;justify-content:space-between;">
            <button type="button" onclick="qgPreviousQuestion()" 
                    style="padding:10px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
                ‚Üê Previous
            </button>
            
            <button type="button" onclick="qgCheckAnswer()" 
                    style="padding:10px 20px;background:linear-gradient(135deg, #39ff14, #2dd4ff);border:none;border-radius:8px;color:#000;cursor:pointer;font-weight:600;">
                ‚úÖ Check Answer
            </button>
            
            <button type="button" onclick="qgNextQuestion()" 
                    style="padding:10px 20px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
                Next ‚Üí
            </button>
        </div>
        
        <!-- FEEDBACK -->
        <div id="qg-quiz-feedback" style="margin-top:20px;padding:16px;border-radius:8px;display:none;"></div>
    </div>
</div>

<!-- FINAL SCORE -->
<div id="qg-final-score" style="display:none;margin-top:24px;padding:24px;background:linear-gradient(135deg, rgba(157,78,221,0.1), rgba(45,212,255,0.1));border-radius:10px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
    <h3 style="color:#9d4edd;margin-top:0;">üéâ Quiz Complete!</h3>
    <div style="font-size:48px;font-weight:bold;color:#39ff14;margin:20px 0;" id="qg-final-percentage">0%</div>
    <div style="font-size:18px;color:rgba(230,250,255,0.9);margin-bottom:20px;">
        You got <span id="qg-final-correct" style="color:#39ff14;font-weight:bold;">0</span> out of 
        <span id="qg-final-total" style="color:var(--accent);font-weight:bold;">0</span> questions correct
    </div>
    <div style="display:flex;gap:12px;justify-content:center;">
        <button type="button" onclick="qgReviewQuiz()" 
                style="padding:12px 24px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
            üìñ Review Answers
        </button>
        <button type="button" onclick="qgRestartQuiz()"
                style="padding:12px 24px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;">
            üîÑ Restart Quiz
        </button>
    </div>
</div>

<!-- ACTIONS -->
<div class="actions" style="margin-top:24px;display:flex;gap:10px;">
    <button type="button" onclick="qgResetAll()" 
            style="flex:1;padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:10px;color:#ff4d4d;cursor:pointer;font-weight:600;">
        üîÑ Reset Everything
    </button>
</div>

<script>
/* quiz-generator.html
   - Advanced quiz creation and testing tool
   - Scoped with qg- prefix
*/

let qgQuestions = [];
let qgCurrentQuestionIndex = 0;
let qgQuizMode = false;
let qgQuizTitle = "My Quiz";

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('Quiz Generator ready');
    
    // Load saved quiz if available
    const savedQuiz = localStorage.getItem('qg-saved-quiz');
    if (savedQuiz) {
        try {
            qgQuestions = JSON.parse(savedQuiz);
            qgRenderQuestionsList();
            qgUpdateStats();
        } catch (e) {
            console.error('Failed to load saved quiz:', e);
        }
    }
    
    // Setup question type toggle
    const typeSelect = document.getElementById('qg-question-type');
    typeSelect.addEventListener('change', qgToggleQuestionType);
    
    // Initialize with multiple choice
    qgToggleQuestionType();
});

// Toggle question type UI
function qgToggleQuestionType() {
    const type = document.getElementById('qg-question-type').value;
    
    // Hide all question type sections
    document.getElementById('qg-multiple-choice').style.display = 'none';
    document.getElementById('qg-true-false').style.display = 'none';
    document.getElementById('qg-short-answer').style.display = 'none';
    document.getElementById('qg-open-ended').style.display = 'none';
    
    // Show selected type
    document.getElementById(`qg-${type}`).style.display = 'block';
    
    // If multiple choice, ensure at least 2 options
    if (type === 'multiple-choice') {
        const options = document.querySelectorAll('.option-item');
        if (options.length < 2) {
            // Add default options if needed
            while (document.querySelectorAll('.option-item').length < 2) {
                qgAddOption();
            }
        }
    }
}

// Add multiple choice option
function qgAddOption() {
    const container = document.getElementById('qg-options-container');
    const optionCount = container.querySelectorAll('.option-item').length;
    
    if (optionCount >= 6) {
        alert('Maximum 6 options allowed');
        return;
    }
    
    const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
    const optionDiv = document.createElement('div');
    optionDiv.className = 'option-item';
    optionDiv.style.cssText = 'display:flex;align-items:center;gap:10px;margin-bottom:8px;';
    
    optionDiv.innerHTML = `
        <input type="radio" name="correct-option" value="${optionCount}" style="accent-color:var(--accent);">
        <input type="text" class="option-input" placeholder="Option ${letters[optionCount]}" 
               style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;">
        <button type="button" onclick="qgRemoveOption(this)" 
                style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px;font-size:18px;">√ó</button>
    `;
    
    container.appendChild(optionDiv);
}

// Remove multiple choice option
function qgRemoveOption(btn) {
    const container = document.getElementById('qg-options-container');
    const options = container.querySelectorAll('.option-item');
    
    if (options.length <= 2) {
        alert('Minimum 2 options required');
        return;
    }
    
    btn.closest('.option-item').remove();
    
    // Update radio button values
    container.querySelectorAll('.option-item').forEach((item, index) => {
        item.querySelector('input[type="radio"]').value = index;
    });
}

// Add question to quiz
function qgAddQuestion() {
    const questionText = document.getElementById('qg-question').value.trim();
    const type = document.getElementById('qg-question-type').value;
    const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
    const category = document.getElementById('qg-category').value.trim();
    
    if (!questionText) {
        alert('Please enter a question');
        return;
    }
    
    let correctAnswer = '';
    let options = [];
    
    switch(type) {
        case 'multiple-choice':
            const optionInputs = document.querySelectorAll('.option-input');
            options = Array.from(optionInputs).map(input => input.value.trim()).filter(val => val);
            
            if (options.length < 2) {
                alert('Please enter at least 2 options');
                return;
            }
            
            const correctRadio = document.querySelector('input[name="correct-option"]:checked');
            if (!correctRadio) {
                alert('Please select the correct answer');
                return;
            }
            
            correctAnswer = options[parseInt(correctRadio.value)];
            break;
            
        case 'true-false':
            const tfRadio = document.querySelector('input[name="true-false"]:checked');
            if (!tfRadio) {
                alert('Please select True or False');
                return;
            }
            correctAnswer = tfRadio.value;
            options = ['True', 'False'];
            break;
            
        case 'short-answer':
            const shortAnswer = document.getElementById('qg-short-answer-input').value.trim();
            if (!shortAnswer) {
                alert('Please enter the correct answer');
                return;
            }
            correctAnswer = shortAnswer;
            break;
            
        case 'open-ended':
            const openAnswer = document.getElementById('qg-open-ended-input').value.trim();
            correctAnswer = openAnswer; // Optional
            break;
    }
    
    const newQuestion = {
        id: Date.now(),
        type: type,
        question: questionText,
        correctAnswer: correctAnswer,
        options: options,
        difficulty: difficulty,
        category: category,
        userAnswer: null,
        isCorrect: null,
        attempts: 0
    };
    
    qgQuestions.push(newQuestion);
    qgSaveQuiz();
    qgRenderQuestionsList();
    qgUpdateStats();
    qgClearCurrent();
    
    // Show success message
    const addBtn = document.querySelector('button[onclick="qgAddQuestion()"]');
    const originalText = addBtn.textContent;
    addBtn.textContent = '‚úÖ Added!';
    setTimeout(() => {
        addBtn.textContent = originalText;
    }, 1000);
}

// Clear current question form
function qgClearCurrent() {
    document.getElementById('qg-question').value = '';
    document.getElementById('qg-short-answer-input').value = '';
    document.getElementById('qg-open-ended-input').value = '';
    
    // Reset radio buttons
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.checked = false;
    });
    
    // Reset multiple choice options to 2
    const container = document.getElementById('qg-options-container');
    const options = container.querySelectorAll('.option-item');
    
    // Remove extra options beyond 2
    while (options.length > 2) {
        options[options.length - 1].remove();
    }
    
    // Clear option text
    container.querySelectorAll('.option-input').forEach(input => {
        input.value = '';
    });
}

// Render questions list
function qgRenderQuestionsList() {
    const container = document.getElementById('qg-questions-list');
    
    if (qgQuestions.length === 0) {
        container.innerHTML = `
            <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
                No questions added yet. Start by adding your first question!
            </div>
        `;
        return;
    }
    
    let html = '';
    
    qgQuestions.forEach((q, index) => {
        const difficultyColor = q.difficulty === 'easy' ? '#39ff14' : 
                              q.difficulty === 'medium' ? '#ffcc00' : '#ff2d55';
        
        const statusIcon = q.isCorrect === true ? '‚úÖ' : 
                          q.isCorrect === false ? '‚ùå' : 'üìù';
        
        html += `
            <div class="question-item" style="margin-bottom:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:4px solid ${difficultyColor};">
                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                    <div style="flex:1;">
                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                            <span style="font-weight:bold;color:var(--accent);">Q${index + 1}</span>
                            <span style="font-size:12px;color:${difficultyColor};background:rgba(0,0,0,0.3);padding:2px 8px;border-radius:4px;">${q.difficulty.toUpperCase()}</span>
                            <span style="font-size:12px;color:rgba(230,250,255,0.7);">${q.type.replace('-', ' ')}</span>
                            ${q.category ? `<span style="font-size:11px;color:rgba(45,212,255,0.8);background:rgba(45,212,255,0.1);padding:2px 6px;border-radius:4px;">${q.category}</span>` : ''}
                            ${statusIcon}
                        </div>
                        <div style="color:rgba(230,250,255,0.9);margin-bottom:8px;">${q.question}</div>
                    </div>
                    <div style="display:flex;gap:6px;">
                        <button type="button" onclick="qgEditQuestion(${index})" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;">Edit</button>
                        <button type="button" onclick="qgDeleteQuestion(${index})" style="padding:4px 8px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:4px;color:#ff4d4d;cursor:pointer;font-size:11px;">Delete</button>
                    </div>
                </div>
                
                ${q.options && q.options.length > 0 ? `
                    <div style="margin-top:8px;">
                        <div style="font-size:12px;color:var(--accent);margin-bottom:4px;">Options:</div>
                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                            ${q.options.map((opt, optIndex) => `
                                <div style="padding:4px 8px;background:${opt === q.correctAnswer ? 'rgba(57,255,20,0.2)' : 'rgba(255,255,255,0.05)'};border:1px solid ${opt === q.correctAnswer ? 'rgba(57,255,20,0.4)' : 'rgba(255,255,255,0.1)'};border-radius:4px;font-size:12px;color:${opt === q.correctAnswer ? '#39ff14' : 'rgba(230,250,255,0.8)'};">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${q.correctAnswer && q.type !== 'multiple-choice' ? `
                    <div style="margin-top:8px;">
                        <div style="font-size:12px;color:var(--accent);">Correct Answer:</div>
                        <div style="color:#39ff14;font-size:13px;">${q.correctAnswer}</div>
                    </div>
                ` : ''}
                
                ${q.userAnswer !== null ? `
                    <div style="margin-top:8px;padding:8px;background:${q.isCorrect ? 'rgba(57,255,20,0.1)' : 'rgba(255,45,85,0.1)'};border-radius:6px;">
                        <div style="font-size:12px;color:${q.isCorrect ? '#39ff14' : '#ff2d55'};">Your answer: ${q.userAnswer} ${q.isCorrect ? '‚úì' : '‚úó'}</div>
                    </div>
                ` : ''}
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Delete question
function qgDeleteQuestion(index) {
    if (confirm('Delete this question?')) {
        qgQuestions.splice(index, 1);
        qgSaveQuiz();
        qgRenderQuestionsList();
        qgUpdateStats();
    }
}

// Edit question
function qgEditQuestion(index) {
    // For simplicity, we'll just scroll to the top and pre-fill form
    // In a more advanced version, you might implement proper editing
    const question = qgQuestions[index];
    
    document.getElementById('qg-question').value = question.question;
    document.getElementById('qg-question-type').value = question.type;
    document.getElementById('qg-category').value = question.category || '';
    
    // Set difficulty
    document.querySelectorAll('input[name="difficulty"]').forEach(radio => {
        radio.checked = radio.value === question.difficulty;
    });
    
    qgToggleQuestionType();
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    alert('Question loaded for editing. Note: Editing will replace the question.');
}

// Update statistics
function qgUpdateStats() {
    const total = qgQuestions.length;
    const correct = qgQuestions.filter(q => q.isCorrect === true).length;
    const incorrect = qgQuestions.filter(q => q.isCorrect === false).length;
    const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
    
    document.getElementById('qg-total-questions').textContent = total;
    document.getElementById('qg-correct-answers').textContent = correct;
    document.getElementById('qg-incorrect-answers').textContent = incorrect;
    document.getElementById('qg-percentage').textContent = percentage + '%';
}

// Start quiz mode
function qgStartQuiz() {
    if (qgQuestions.length === 0) {
        alert('Add some questions first!');
        return;
    }
    
    qgQuizMode = true;
    qgCurrentQuestionIndex = 0;
    qgQuizTitle = document.getElementById('qg-quiz-title').value || 'My Quiz';
    
    document.getElementById('qg-quiz-title-display').textContent = qgQuizTitle;
    document.getElementById('qg-quiz-mode').style.display = 'block';
    document.getElementById('qg-final-score').style.display = 'none';
    
    qgShowQuestion(qgCurrentQuestionIndex);
}

// Show question in quiz mode
function qgShowQuestion(index) {
    if (index < 0 || index >= qgQuestions.length) return;
    
    const question = qgQuestions[index];
    const container = document.getElementById('qg-quiz-question-container');
    const answerContainer = document.getElementById('qg-answer-container');
    const progress = document.getElementById('qg-quiz-progress');
    
    // Update progress
    progress.textContent = `Question ${index + 1}/${qgQuestions.length}`;
    
    // Display question
    container.innerHTML = `
        <div style="margin-bottom:12px;">
            <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Question ${index + 1}:</div>
            <div style="font-size:18px;color:rgba(230,250,255,0.95);margin-bottom:16px;">${question.question}</div>
        </div>
    `;
    
    // Display answer input based on type
    let answerHtml = '';
    
    switch(question.type) {
        case 'multiple-choice':
            answerHtml = `
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Select your answer:</div>
                <div style="display:flex;flex-direction:column;gap:8px;">
                    ${question.options.map((option, optIndex) => `
                        <label style="display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;">
                            <input type="radio" name="quiz-answer" value="${option}" style="accent-color:var(--accent);">
                            <span style="color:rgba(230,250,255,0.9);">${option}</span>
                        </label>
                    `).join('')}
                </div>
            `;
            break;
            
        case 'true-false':
            answerHtml = `
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Select your answer:</div>
                <div style="display:flex;gap:16px;">
                    <label style="display:flex;align-items:center;gap:12px;padding:12px 24px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;flex:1;">
                        <input type="radio" name="quiz-answer" value="true" style="accent-color:#39ff14;">
                        <span style="color:#39ff14;font-weight:500;">True</span>
                    </label>
                    <label style="display:flex;align-items:center;gap:12px;padding:12px 24px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;flex:1;">
                        <input type="radio" name="quiz-answer" value="false" style="accent-color:#ff2d55;">
                        <span style="color:#ff2d55;font-weight:500;">False</span>
                    </label>
                </div>
            `;
            break;
            
        case 'short-answer':
            answerHtml = `
                <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Your answer:</div>
                <input type="text" id="qg-user-answer-input" placeholder="Type your answer here..." 
                       style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-size:16px;">
            `;
            break;
            
        case 'open-ended':
            answerHtml = `
                <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">Your answer:</div>
                <textarea id="qg-user-answer-input" rows="4" placeholder="Type your detailed answer here..."
                          style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;"></textarea>
            `;
            break;
    }
    
    answerContainer.innerHTML = answerHtml;
    
    // Pre-select if user already answered
    if (question.userAnswer !== null) {
        if (question.type === 'multiple-choice' || question.type === 'true-false') {
            const radio = document.querySelector(`input[name="quiz-answer"][value="${question.userAnswer}"]`);
            if (radio) radio.checked = true;
        } else {
            const input = document.getElementById('qg-user-answer-input');
            if (input) input.value = question.userAnswer;
        }
    }
    
    // Hide feedback
    document.getElementById('qg-quiz-feedback').style.display = 'none';
}

// Check answer
function qgCheckAnswer() {
    const question = qgQuestions[qgCurrentQuestionIndex];
    let userAnswer = '';
    const feedback = document.getElementById('qg-quiz-feedback');
    
    // Get user answer based on question type
    if (question.type === 'multiple-choice' || question.type === 'true-false') {
        const selected = document.querySelector('input[name="quiz-answer"]:checked');
        if (!selected) {
            alert('Please select an answer');
            return;
        }
        userAnswer = selected.value;
    } else {
        const input = document.getElementById('qg-user-answer-input');
        if (!input || !input.value.trim()) {
            alert('Please enter an answer');
            return;
        }
        userAnswer = input.value.trim();
    }
    
    // Check if correct
    let isCorrect = false;
    
    if (question.type === 'short-answer') {
        // For short answer, compare case-insensitive
        isCorrect = userAnswer.toLowerCase() === question.correctAnswer.toLowerCase();
    } else if (question.type === 'open-ended') {
        // For open-ended, we can't auto-check, so mark as reviewed
        isCorrect = null; // No auto-checking for open-ended
    } else {
        isCorrect = userAnswer === question.correctAnswer;
    }
    
    // Update question
    question.userAnswer = userAnswer;
    question.isCorrect = isCorrect;
    question.attempts = (question.attempts || 0) + 1;
    
    // Show feedback
    if (question.type === 'open-ended') {
        feedback.innerHTML = `
            <div style="color:#ffcc00;font-weight:500;margin-bottom:8px;">Answer submitted for review</div>
            <div style="color:rgba(230,250,255,0.9);">
                Open-ended questions require manual review. Compare your answer with the expected answer.
            </div>
            ${question.correctAnswer ? `
                <div style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.1);border-radius:6px;border-left:3px solid #39ff14;">
                    <div style="color:#39ff14;font-weight:500;margin-bottom:4px;">Expected Answer:</div>
                    <div style="color:#39ff14;">${question.correctAnswer}</div>
                </div>
            ` : ''}
        `;
    } else {
        const color = isCorrect ? '#39ff14' : '#ff2d55';
        const icon = isCorrect ? '‚úÖ' : '‚ùå';
        
        feedback.innerHTML = `
            <div style="color:${color};font-weight:500;margin-bottom:8px;">${icon} ${isCorrect ? 'Correct!' : 'Incorrect'}</div>
            <div style="color:rgba(230,250,255,0.9);">
                ${isCorrect ? 'Well done!' : 'The correct answer is:'}
            </div>
            ${!isCorrect ? `
                <div style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.1);border-radius:6px;border-left:3px solid #39ff14;">
                    <div style="color:#39ff14;">${question.correctAnswer}</div>
                </div>
            ` : ''}
        `;
    }
    
    feedback.style.display = 'block';
    feedback.style.background = isCorrect ? 'rgba(57,255,20,0.1)' : 'rgba(255,45,85,0.1)';
    feedback.style.border = isCorrect ? '1px solid rgba(57,255,20,0.3)' : '1px solid rgba(255,45,85,0.3)';
    
    // Save and update stats
    qgSaveQuiz();
    qgUpdateStats();
    qgRenderQuestionsList();
}

// Navigation in quiz mode
function qgNextQuestion() {
    if (qgCurrentQuestionIndex < qgQuestions.length - 1) {
        qgCurrentQuestionIndex++;
        qgShowQuestion(qgCurrentQuestionIndex);
    } else {
        qgCompleteQuiz();
    }
}

function qgPreviousQuestion() {
    if (qgCurrentQuestionIndex > 0) {
        qgCurrentQuestionIndex--;
        qgShowQuestion(qgCurrentQuestionIndex);
    }
}

// Complete quiz
function qgCompleteQuiz() {
    qgQuizMode = false;
    document.getElementById('qg-quiz-mode').style.display = 'none';
    
    const total = qgQuestions.length;
    const correct = qgQuestions.filter(q => q.isCorrect === true).length;
    const percentage = Math.round((correct / total) * 100);
    
    document.getElementById('qg-final-correct').textContent = correct;
    document.getElementById('qg-final-total').textContent = total;
    document.getElementById('qg-final-percentage').textContent = percentage + '%';
    document.getElementById('qg-final-score').style.display = 'block';
    
    // Color based on score
    const finalScoreDiv = document.getElementById('qg-final-percentage');
    if (percentage >= 80) {
        finalScoreDiv.style.color = '#39ff14';
    } else if (percentage >= 60) {
        finalScoreDiv.style.color = '#ffcc00';
    } else {
        finalScoreDiv.style.color = '#ff2d55';
    }
}

// Exit quiz
function qgExitQuiz() {
    if (confirm('Exit quiz? Your progress will be saved.')) {
        qgQuizMode = false;
        document.getElementById('qg-quiz-mode').style.display = 'none';
        document.getElementById('qg-final-score').style.display = 'none';
    }
}

// Review quiz
function qgReviewQuiz() {
    // Scroll to questions list
    document.getElementById('qg-questions-list').scrollIntoView({ behavior: 'smooth' });
}

// Restart quiz
function qgRestartQuiz() {
    // Reset all answers
    qgQuestions.forEach(q => {
        q.userAnswer = null;
        q.isCorrect = null;
        q.attempts = 0;
    });
    
    qgSaveQuiz();
    qgUpdateStats();
    qgRenderQuestionsList();
    
    document.getElementById('qg-final-score').style.display = 'none';
    alert('Quiz reset! All answers cleared.');
}

// Export quiz
function qgExportQuiz() {
    if (qgQuestions.length === 0) {
        alert('No questions to export');
        return;
    }
    
    const quizTitle = document.getElementById('qg-quiz-title').value || 'My Quiz';
    let exportText = `QUIZ: ${quizTitle}\n`;
    exportText += `Generated: ${new Date().toLocaleDateString()}\n`;
    exportText += `Total Questions: ${qgQuestions.length}\n`;
    exportText += '='.repeat(50) + '\n\n';
    
    qgQuestions.forEach((q, index) => {
        exportText += `QUESTION ${index + 1} (${q.difficulty.toUpperCase()})\n`;
        exportText += `${q.question}\n\n`;
        
        if (q.options && q.options.length > 0) {
            exportText += 'OPTIONS:\n';
            q.options.forEach((opt, optIndex) => {
                exportText += `  ${String.fromCharCode(65 + optIndex)}. ${opt}\n`;
            });
            exportText += `\nCorrect Answer: ${q.correctAnswer}\n`;
        } else if (q.type === 'true-false') {
            exportText += `Correct Answer: ${q.correctAnswer}\n`;
        } else {
            exportText += `Correct Answer: ${q.correctAnswer}\n`;
        }
        
        exportText += '\n' + '-'.repeat(40) + '\n\n';
    });
    
    // Create and download file
    const blob = new Blob([exportText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${quizTitle.toLowerCase().replace(/\s+/g, '-')}-quiz.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Save quiz to localStorage
function qgSaveQuiz() {
    localStorage.setItem('qg-saved-quiz', JSON.stringify(qgQuestions));
}

// Reset everything
function qgResetAll() {
    if (confirm('Reset everything? This will delete all questions and progress.')) {
        qgQuestions = [];
        localStorage.removeItem('qg-saved-quiz');
        
        // Reset form
        document.getElementById('qg-quiz-title').value = '';
        document.getElementById('qg-category').value = '';
        qgClearCurrent();
        
        // Reset displays
        qgRenderQuestionsList();
        qgUpdateStats();
        document.getElementById('qg-quiz-mode').style.display = 'none';
        document.getElementById('qg-final-score').style.display = 'none';
        
        alert('Quiz reset complete!');
    }
}
</script>

<style>
#quiz-generator-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, #2dd4ff, #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.question-item {
    transition: all 0.3s ease;
    animation: slideIn 0.4s ease-out;
}

.question-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Custom scrollbar */
#qg-questions-list::-webkit-scrollbar {
    width: 8px;
}

#qg-questions-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 4px;
}

#qg-questions-list::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 4px;
}

#qg-questions-list::-webkit-scrollbar-thumb:hover {
    background: rgba(45,212,255,0.8);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .section > div > div {
        grid-template-columns: 1fr !important;
    }
    
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
    }
    
    #qg-quiz-mode > div > div {
        flex-direction: column;
        gap: 12px;
    }
}
</style>
