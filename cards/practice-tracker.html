<h2 id="practice-tracker-title">üéØ Practice Tracker</h2>

<form aria-describedby="practice-tracker-desc">
    <p id="practice-tracker-desc" class="small">
        Track and analyze your practice sessions with detailed metrics and progress visualization.
        <span style="color:var(--accent)">Set goals, track habits, and measure improvement.</span>
    </p>
    
    <!-- PRACTICE LOGGING -->
    <div style="margin-bottom:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">üìù Log New Practice Session</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
            <div>
                <label for="pt-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Date
                </label>
                <input id="pt-date" type="date" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;"
                       value="${new Date().toISOString().split('T')[0]}" />
            </div>
            
            <div>
                <label for="pt-duration" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Duration (minutes)
                </label>
                <input id="pt-duration" type="number" placeholder="e.g., 45" min="1" max="480" step="1"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            </div>
        </div>
        
        <div style="margin-bottom:16px;">
            <label for="pt-focus" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Focus Area
            </label>
            <input id="pt-focus" type="text" placeholder="e.g., Scales, Technique, Repertoire, Theory, Ear Training..." 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
        </div>
        
        <div style="margin-bottom:16px;">
            <label for="pt-notes" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                Notes & Progress
            </label>
            <textarea id="pt-notes" rows="3" placeholder="What did you work on? What went well? What needs improvement?"
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
        
        <!-- QUICK DURATION BUTTONS -->
        <div style="margin-bottom:16px;">
            <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Duration:</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="button" onclick="ptSetDuration(15)" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">15 min</button>
                <button type="button" onclick="ptSetDuration(30)" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">30 min</button>
                <button type="button" onclick="ptSetDuration(45)" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">45 min</button>
                <button type="button" onclick="ptSetDuration(60)" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">60 min</button>
                <button type="button" onclick="ptSetDuration(90)" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">90 min</button>
            </div>
        </div>
        
        <!-- QUICK FOCUS BUTTONS -->
        <div style="margin-bottom:20px;">
            <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Common Focus Areas:</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="button" onclick="ptSetFocus('Scales')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">üéµ Scales</button>
                <button type="button" onclick="ptSetFocus('Technique')" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">üí™ Technique</button>
                <button type="button" onclick="ptSetFocus('Repertoire')" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">üìñ Repertoire</button>
                <button type="button" onclick="ptSetFocus('Theory')" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">üß† Theory</button>
                <button type="button" onclick="ptSetFocus('Ear Training')" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">üëÇ Ear Training</button>
            </div>
        </div>
        
        <!-- ACTIONS -->
        <div style="display:flex;gap:10px;">
            <button type="button" onclick="ptLogSession()" 
                    style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
                ‚úÖ Log Practice Session
            </button>
            <button type="button" onclick="ptResetForm()"
                    style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
                Clear
            </button>
        </div>
    </div>
    
    <!-- GOAL SETTING -->
    <div style="margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1.1rem;">üéØ Weekly Goal</h3>
        <div style="display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end;">
            <div>
                <label for="pt-goal" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Target Minutes per Week
                </label>
                <input id="pt-goal" type="number" placeholder="e.g., 300" min="1" step="1"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
            </div>
            <button type="button" onclick="ptSetGoal()"
                    style="padding:10px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
                Set Goal
            </button>
        </div>
        <div id="pt-goal-progress" style="margin-top:12px;"></div>
    </div>
</form>

<!-- STATISTICS DASHBOARD -->
<div class="results" aria-live="polite" style="margin-top:16px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìä Practice Statistics</h3>
    
    <!-- STATS GRID -->
    <div id="pt-stats-grid" style="display:none;margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;">
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Total Practice</div>
                <div id="pt-total-time" style="font-size:28px;font-weight:700;color:var(--accent);">0 min</div>
            </div>
            
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Sessions</div>
                <div id="pt-session-count" style="font-size:28px;font-weight:700;color:#39ff14;">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Avg. Session</div>
                <div id="pt-avg-session" style="font-size:28px;font-weight:700;color:#ffa500;">0 min</div>
            </div>
            
            <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Consistency</div>
                <div id="pt-consistency" style="font-size:28px;font-weight:700;color:#9d4edd;">0%</div>
            </div>
        </div>
    </div>
    
    <!-- PRACTICE LOG -->
    <div id="pt-practice-log" style="margin-top:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 class="small" style="color:var(--accent);margin:0;">üìù Practice History</h3>
            <div style="display:flex;gap:8px;">
                <button type="button" onclick="ptExportData()" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Export</button>
                <button type="button" onclick="ptClearData()" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">Clear All</button>
            </div>
        </div>
        
        <div id="pt-log-entries" style="max-height:300px;overflow-y:auto;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.6);">
                <div style="font-size:48px;margin-bottom:16px;">üéØ</div>
                <h3 style="color:var(--accent);margin-bottom:8px;">No Practice Sessions Yet</h3>
                <p>Log your first practice session to begin tracking your progress!</p>
            </div>
        </div>
    </div>
    
    <!-- FOCUS DISTRIBUTION -->
    <div id="pt-focus-distribution" style="display:none;margin-top:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìà Focus Area Distribution</h3>
        <div id="pt-focus-chart" style="display:flex;height:200px;align-items:flex-end;gap:4px;padding:20px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);"></div>
    </div>
</div>

<!-- PRACTICE TIPS -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(57,255,20,0.05));border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üí° Effective Practice Tips</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
        <div>
            <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üéØ Set Clear Goals</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Define specific, measurable objectives</li>
                <li>Break large goals into smaller milestones</li>
                <li>Focus on process, not just outcome</li>
            </ul>
        </div>
        <div>
            <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">‚è±Ô∏è Optimize Time</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Short, focused sessions beat marathon practice</li>
                <li>Use deliberate practice techniques</li>
                <li>Take regular breaks (Pomodoro technique)</li>
            </ul>
        </div>
        <div>
            <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">üìä Track Progress</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Record what works and what doesn't</li>
                <li>Review progress weekly</li>
                <li>Adjust based on results</li>
            </ul>
        </div>
    </div>
</div>

<script>
/* practice-tracker.html
   - Comprehensive practice tracking and analytics
   - Scoped with pt- prefix
*/

// Practice session storage
let ptSessions = [];
let ptWeeklyGoal = 300; // Default: 5 hours per week

// Load data from localStorage
function ptLoadData() {
    try {
        const savedSessions = localStorage.getItem('pt-practice-sessions');
        if (savedSessions) {
            ptSessions = JSON.parse(savedSessions);
            ptUpdateDisplay();
        }
        
        const savedGoal = localStorage.getItem('pt-weekly-goal');
        if (savedGoal) {
            ptWeeklyGoal = parseInt(savedGoal);
            document.getElementById('pt-goal').value = ptWeeklyGoal;
        }
    } catch (e) {
        console.error('Failed to load practice data:', e);
        ptSessions = [];
    }
}

// Save data to localStorage
function ptSaveData() {
    try {
        localStorage.setItem('pt-practice-sessions', JSON.stringify(ptSessions));
        localStorage.setItem('pt-weekly-goal', ptWeeklyGoal.toString());
    } catch (e) {
        console.error('Failed to save practice data:', e);
    }
}

// Set duration from quick buttons
function ptSetDuration(minutes) {
    const durationInput = document.getElementById('pt-duration');
    durationInput.value = minutes;
    durationInput.style.borderColor = '#39ff14';
    setTimeout(() => {
        durationInput.style.borderColor = 'rgba(45,212,255,0.3)';
    }, 1000);
}

// Set focus from quick buttons
function ptSetFocus(focus) {
    const focusInput = document.getElementById('pt-focus');
    focusInput.value = focus;
    focusInput.style.borderColor = '#9d4edd';
    setTimeout(() => {
        focusInput.style.borderColor = 'rgba(45,212,255,0.3)';
    }, 1000);
}

// Set weekly goal
function ptSetGoal() {
    const goalInput = document.getElementById('pt-goal');
    const goal = parseInt(goalInput.value);
    
    if (goal && goal > 0) {
        ptWeeklyGoal = goal;
        ptSaveData();
        
        // Show confirmation
        goalInput.style.borderColor = '#39ff14';
        setTimeout(() => {
            goalInput.style.borderColor = 'rgba(45,212,255,0.3)';
        }, 1000);
        
        ptUpdateGoalProgress();
    }
}

// Log a new practice session
function ptLogSession() {
    const dateInput = document.getElementById('pt-date');
    const durationInput = document.getElementById('pt-duration');
    const focusInput = document.getElementById('pt-focus');
    const notesInput = document.getElementById('pt-notes');
    
    const date = dateInput.value;
    const duration = parseInt(durationInput.value);
    const focus = focusInput.value.trim();
    const notes = notesInput.value.trim();
    
    // Validation
    if (!date) {
        alert('Please select a date');
        dateInput.focus();
        return;
    }
    
    if (!duration || duration <= 0) {
        alert('Please enter a valid duration (minimum 1 minute)');
        durationInput.focus();
        return;
    }
    
    if (!focus) {
        alert('Please enter a focus area');
        focusInput.focus();
        return;
    }
    
    // Create session object
    const session = {
        id: Date.now(),
        date: date,
        duration: duration,
        focus: focus,
        notes: notes,
        timestamp: new Date().toISOString()
    };
    
    // Add to sessions array
    ptSessions.unshift(session); // Add to beginning for chronological display
    
    // Save and update display
    ptSaveData();
    ptUpdateDisplay();
    ptResetForm();
    
    // Show success message
    const logEntries = document.getElementById('pt-log-entries');
    logEntries.scrollTop = 0;
    
    // Visual feedback
    const logButton = document.querySelector('button[onclick="ptLogSession()"]');
    const originalText = logButton.textContent;
    logButton.textContent = '‚úÖ Logged!';
    logButton.style.background = 'rgba(57,255,20,0.2)';
    logButton.style.borderColor = 'rgba(57,255,20,0.4)';
    
    setTimeout(() => {
        logButton.textContent = originalText;
        logButton.style.background = 'linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1))';
        logButton.style.borderColor = 'rgba(57,255,20,0.4)';
    }, 2000);
}

// Reset form
function ptResetForm() {
    document.getElementById('pt-date').value = new Date().toISOString().split('T')[0];
    document.getElementById('pt-duration').value = '';
    document.getElementById('pt-focus').value = '';
    document.getElementById('pt-notes').value = '';
}

// Update all displays
function ptUpdateDisplay() {
    ptUpdateLogEntries();
    ptUpdateStatistics();
    ptUpdateFocusDistribution();
    ptUpdateGoalProgress();
}

// Update practice log entries
function ptUpdateLogEntries() {
    const logEntries = document.getElementById('pt-log-entries');
    const statsGrid = document.getElementById('pt-stats-grid');
    
    if (ptSessions.length === 0) {
        logEntries.innerHTML = `
            <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.6);">
                <div style="font-size:48px;margin-bottom:16px;">üéØ</div>
                <h3 style="color:var(--accent);margin-bottom:8px;">No Practice Sessions Yet</h3>
                <p>Log your first practice session to begin tracking your progress!</p>
            </div>
        `;
        statsGrid.style.display = 'none';
        return;
    }
    
    statsGrid.style.display = 'grid';
    
    let entriesHTML = '';
    const today = new Date().toISOString().split('T')[0];
    
    ptSessions.forEach((session, index) => {
        const isToday = session.date === today;
        const durationClass = session.duration >= 60 ? 'long-session' : session.duration >= 30 ? 'medium-session' : 'short-session';
        
        entriesHTML += `
            <div style="padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);${isToday ? 'background:rgba(57,255,20,0.05);' : ''}">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;">
                    <div style="flex:1;">
                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                            <div style="color:var(--accent);font-weight:600;">${session.date} ${isToday ? ' (Today)' : ''}</div>
                            <div style="padding:2px 6px;background:rgba(45,212,255,0.1);border-radius:4px;font-size:12px;color:var(--accent);">
                                ${session.duration} min
                            </div>
                        </div>
                        <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">${session.focus}</div>
                        ${session.notes ? `<div style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.4;">${session.notes}</div>` : ''}
                    </div>
                    <button onclick="ptDeleteSession(${session.id})" 
                            style="background:transparent;border:none;color:rgba(255,77,77,0.7);cursor:pointer;font-size:18px;padding:4px;">
                        √ó
                    </button>
                </div>
            </div>
        `;
    });
    
    logEntries.innerHTML = entriesHTML;
}

// Update statistics
function ptUpdateStatistics() {
    if (ptSessions.length === 0) return;
    
    // Calculate statistics
    const totalTime = ptSessions.reduce((sum, session) => sum + session.duration, 0);
    const sessionCount = ptSessions.length;
    const avgSession = Math.round(totalTime / sessionCount);
    
    // Calculate consistency (days with practice in last 7 days)
    const last7Days = [...Array(7)].map((_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - i);
        return date.toISOString().split('T')[0];
    });
    
    const practiceDays = last7Days.filter(date => 
        ptSessions.some(session => session.date === date)
    ).length;
    
    const consistency = Math.round((practiceDays / 7) * 100);
    
    // Update display
    document.getElementById('pt-total-time').textContent = `${totalTime} min`;
    document.getElementById('pt-session-count').textContent = sessionCount;
    document.getElementById('pt-avg-session').textContent = `${avgSession} min`;
    document.getElementById('pt-consistency').textContent = `${consistency}%`;
    
    // Color consistency based on percentage
    const consistencyEl = document.getElementById('pt-consistency');
    if (consistency >= 80) {
        consistencyEl.style.color = '#39ff14';
    } else if (consistency >= 50) {
        consistencyEl.style.color = '#ffa500';
    } else {
        consistencyEl.style.color = '#ff2d55';
    }
}

// Update focus distribution chart
function ptUpdateFocusDistribution() {
    const focusChart = document.getElementById('pt-focus-chart');
    const focusContainer = document.getElementById('pt-focus-distribution');
    
    if (ptSessions.length === 0) {
        focusContainer.style.display = 'none';
        return;
    }
    
    focusContainer.style.display = 'block';
    
    // Calculate focus distribution
    const focusMap = {};
    ptSessions.forEach(session => {
        focusMap[session.focus] = (focusMap[session.focus] || 0) + session.duration;
    });
    
    // Sort by duration
    const sortedFocuses = Object.entries(focusMap).sort((a, b) => b[1] - a[1]);
    
    // Create chart
    const maxDuration = Math.max(...sortedFocuses.map(f => f[1]));
    const chartHeight = 200;
    
    let chartHTML = '';
    let labelsHTML = '';
    
    sortedFocuses.forEach(([focus, duration], index) => {
        const height = (duration / maxDuration) * chartHeight;
        const colors = [
            'rgba(45,212,255,0.7)',
            'rgba(57,255,20,0.7)',
            'rgba(255,165,0,0.7)',
            'rgba(157,78,221,0.7)',
            'rgba(255,77,77,0.7)',
            'rgba(148,0,211,0.7)'
        ];
        const color = colors[index % colors.length];
        
        chartHTML += `
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;">
                <div style="background:${color};width:80%;border-radius:4px 4px 0 0;"
                     style="height:${Math.max(height, 20)}px;"></div>
                <div style="margin-top:4px;color:${color};font-size:11px;font-weight:600;text-align:center;transform:rotate(-45deg);transform-origin:left top;white-space:nowrap;">
                    ${duration}min
                </div>
            </div>
        `;
        
        labelsHTML += `
            <div style="flex:1;text-align:center;font-size:11px;color:rgba(230,250,255,0.8);overflow:hidden;text-overflow:ellipsis;">
                ${focus}
            </div>
        `;
    });
    
    focusChart.innerHTML = chartHTML;
    
    // Add labels container if it doesn't exist
    if (!document.getElementById('pt-focus-labels')) {
        const labelsDiv = document.createElement('div');
        labelsDiv.id = 'pt-focus-labels';
        labelsDiv.style.cssText = 'display:flex;justify-content:space-around;margin-top:8px;';
        focusChart.parentNode.appendChild(labelsDiv);
    }
    document.getElementById('pt-focus-labels').innerHTML = labelsHTML;
}

// Update goal progress
function ptUpdateGoalProgress() {
    const goalProgress = document.getElementById('pt-goal-progress');
    
    if (ptWeeklyGoal <= 0) {
        goalProgress.innerHTML = '<div style="color:rgba(230,250,255,0.6);font-size:13px;">Set a weekly goal above</div>';
        return;
    }
    
    // Calculate this week's practice time
    const today = new Date();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
    const startDate = startOfWeek.toISOString().split('T')[0];
    
    const weekSessions = ptSessions.filter(session => session.date >= startDate);
    const weekTime = weekSessions.reduce((sum, session) => sum + session.duration, 0);
    
    const progress = Math.min(100, Math.round((weekTime / ptWeeklyGoal) * 100));
    const remaining = Math.max(0, ptWeeklyGoal - weekTime);
    
    let progressColor = '#39ff14';
    let status = 'Great progress!';
    
    if (progress < 50) {
        progressColor = '#ff2d55';
        status = 'Keep going!';
    } else if (progress < 80) {
        progressColor = '#ffa500';
        status = 'Good progress';
    }
    
    goalProgress.innerHTML = `
        <div style="margin-bottom:8px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">This Week: ${weekTime} / ${ptWeeklyGoal} min</div>
                <div style="color:${progressColor};font-weight:600;font-size:13px;">${progress}%</div>
            </div>
            <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
                <div style="height:100%;background:${progressColor};width:${progress}%;border-radius:4px;transition:width 0.5s;"></div>
            </div>
        </div>
        <div style="color:${progressColor};font-size:12px;">${status} ‚Ä¢ ${remaining} min remaining</div>
    `;
}

// Delete a session
function ptDeleteSession(sessionId) {
    if (confirm('Delete this practice session?')) {
        ptSessions = ptSessions.filter(session => session.id !== sessionId);
        ptSaveData();
        ptUpdateDisplay();
    }
}

// Export data
function ptExportData() {
    if (ptSessions.length === 0) {
        alert('No practice sessions to export');
        return;
    }
    
    // Create CSV content
    let csv = 'Date,Duration (min),Focus Area,Notes\n';
    ptSessions.forEach(session => {
        csv += `"${session.date}",${session.duration},"${session.focus}","${session.notes.replace(/"/g, '""')}"\n`;
    });
    
    // Create download link
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `practice-sessions-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Clear all data
function ptClearData() {
    if (confirm('Clear ALL practice data? This cannot be undone.')) {
        ptSessions = [];
        ptSaveData();
        ptUpdateDisplay();
    }
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Load saved data
        ptLoadData();
        
        // Set default date to today
        const dateInput = card.querySelector('#pt-date');
        if (dateInput && !dateInput.value) {
            dateInput.value = new Date().toISOString().split('T')[0];
        }
        
        // Auto-update goal progress
        setInterval(ptUpdateGoalProgress, 60000); // Update every minute
        
        console.log('Practice Tracker ready');
    });
}
</script>

<style>
@keyframes ptPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

#practice-tracker-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, #39ff14, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Style for session duration indicators */
.long-session {
    border-left: 4px solid #39ff14 !important;
}

.medium-session {
    border-left: 4px solid #ffa500 !important;
}

.short-session {
    border-left: 4px solid var(--accent) !important;
}

/* Scrollbar styling */
#pt-log-entries::-webkit-scrollbar {
    width: 6px;
}

#pt-log-entries::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 3px;
}

#pt-log-entries::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
}

/* Responsive design */
@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    #pt-stats-grid {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* Hover effects */
button[onclick^="ptSetDuration"]:hover,
button[onclick^="ptSetFocus"]:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}
</style>
