<h2 id="hx-converter-title" style="margin-top:0;color:var(--accent);">üî¢ Advanced Hex/Decimal/Binary Converter</h2>

<form aria-describedby="hx-converter-desc">
  <p id="hx-converter-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Convert between hexadecimal, decimal, binary, octal, and ASCII with bitwise operations.
    <span style="color:var(--accent);font-weight:500;">Essential for developers, modders, and reverse engineering!</span>
  </p>

  <!-- Input Section -->
  <div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
    <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:16px;">üì• Enter Value</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
      <div>
        <label for="hx-hex-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Hexadecimal
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="color:var(--muted);font-family:monospace;">0x</span>
          <input id="hx-hex-input" type="text" placeholder="1A3F" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;font-family:monospace;text-transform:uppercase;"
                 oninput="hxConvertFromHex()" />
        </div>
      </div>
      
      <div>
        <label for="hx-dec-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Decimal
        </label>
        <input id="hx-dec-input" type="number" placeholder="6719" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-family:monospace;"
               oninput="hxConvertFromDec()" />
      </div>
      
      <div>
        <label for="hx-bin-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Binary
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="color:var(--muted);font-family:monospace;">0b</span>
          <input id="hx-bin-input" type="text" placeholder="1101000111111" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-family:monospace;"
                 oninput="hxConvertFromBin()" />
        </div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div>
        <label for="hx-oct-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Octal
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="color:var(--muted);font-family:monospace;">0o</span>
          <input id="hx-oct-input" type="text" placeholder="15077" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;font-family:monospace;"
                 oninput="hxConvertFromOct()" />
        </div>
      </div>
      
      <div>
        <label for="hx-ascii-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ASCII Character
        </label>
        <input id="hx-ascii-input" type="text" placeholder="A" maxlength="1"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:inherit;font-family:monospace;text-align:center;font-size:18px;"
               oninput="hxConvertFromAscii()" />
      </div>
      
      <div>
        <label for="hx-bits" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Bit Size
        </label>
        <select id="hx-bits" onchange="hxUpdateAll()"
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="8">8-bit (Byte)</option>
          <option value="16">16-bit (Word)</option>
          <option value="32" selected>32-bit (DWord)</option>
          <option value="64">64-bit (QWord)</option>
        </select>
      </div>
    </div>
    
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button type="button" onclick="hxConvertAll()" 
              style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
        üîÑ Convert All
      </button>
      <button type="button" onclick="hxClearAll()"
              style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
        Clear
      </button>
    </div>
  </div>
</form>

<!-- Results Display -->
<div id="hx-results-container" style="display:none;margin-bottom:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìä Conversion Results</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
    <div style="background:rgba(255,77,77,0.05);border-radius:8px;padding:12px;border:1px solid rgba(255,77,77,0.2);">
      <div style="font-size:12px;color:#ff4d4d;margin-bottom:4px;">Hexadecimal</div>
      <div id="hx-result-hex" style="font-size:20px;font-weight:600;color:#ff4d4d;font-family:monospace;word-break:break-all;">0x0</div>
    </div>
    <div style="background:rgba(57,255,20,0.05);border-radius:8px;padding:12px;border:1px solid rgba(57,255,20,0.2);">
      <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">Decimal</div>
      <div id="hx-result-dec" style="font-size:20px;font-weight:600;color:#39ff14;font-family:monospace;">0</div>
    </div>
    <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:12px;border:1px solid rgba(45,212,255,0.2);">
      <div style="font-size:12px;color:var(--accent);margin-bottom:4px;">Binary</div>
      <div id="hx-result-bin" style="font-size:20px;font-weight:600;color:var(--accent);font-family:monospace;word-break:break-all;">0b0</div>
    </div>
    <div style="background:rgba(255,204,0,0.05);border-radius:8px;padding:12px;border:1px solid rgba(255,204,0,0.2);">
      <div style="font-size:12px;color:#ffcc00;margin-bottom:4px;">Octal</div>
      <div id="hx-result-oct" style="font-size:20px;font-weight:600;color:#ffcc00;font-family:monospace;">0o0</div>
    </div>
  </div>
  
  <!-- ASCII/Unicode Section -->
  <div style="background:rgba(157,78,221,0.05);border-radius:8px;padding:16px;border:1px solid rgba(157,78,221,0.2);margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="font-size:12px;color:#9d4edd;">ASCII / Unicode Character</div>
      <div style="font-size:11px;color:var(--muted);" id="hx-unicode-info"></div>
    </div>
    <div style="display:flex;align-items:center;gap:16px;">
      <div id="hx-result-char" style="font-size:48px;color:#9d4edd;width:60px;height:60px;display:flex;align-items:center;justify-content:center;background:rgba(157,78,221,0.1);border-radius:8px;"></div>
      <div style="flex:1;">
        <div style="font-family:monospace;font-size:14px;color:white;margin-bottom:4px;" id="hx-result-ascii"></div>
        <div style="font-size:11px;color:var(--muted);" id="hx-char-info">Enter a value to see character information</div>
      </div>
    </div>
  </div>
</div>

<!-- Bitwise Visualization -->
<div id="hx-bits-container" style="display:none;margin-bottom:20px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">üî¨ Bit Visualization</h3>
    <div style="font-size:12px;color:var(--muted);" id="hx-bit-count">0 bits</div>
  </div>
  
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
    <!-- Bit Grid -->
    <div id="hx-bit-grid" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:16px;justify-content:center;">
      <!-- Bits will be generated by JavaScript -->
      <div style="text-align:center;color:var(--muted);font-size:13px;padding:20px;">
        Enter a value to see bit visualization
      </div>
    </div>
    
    <!-- Byte Groups -->
    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <div style="font-size:11px;color:var(--muted);">Byte 3</div>
      <div style="font-size:11px;color:var(--muted);">Byte 2</div>
      <div style="font-size:11px;color:var(--muted);">Byte 1</div>
      <div style="font-size:11px;color:var(--muted);">Byte 0</div>
    </div>
  </div>
</div>

<!-- Bitwise Operations -->
<div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
  <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:16px;">‚ö° Bitwise Operations</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:8px;margin-bottom:12px;">
    <button type="button" onclick="hxBitwiseOp('and')" 
            style="padding:10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-family:monospace;">
      AND (&)
    </button>
    <button type="button" onclick="hxBitwiseOp('or')"
            style="padding:10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-family:monospace;">
      OR (|)
    </button>
    <button type="button" onclick="hxBitwiseOp('xor')"
            style="padding:10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-family:monospace;">
      XOR (^)
    </button>
    <button type="button" onclick="hxBitwiseOp('not')"
            style="padding:10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-family:monospace;">
      NOT (~)
    </button>
  </div>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:8px;">
    <button type="button" onclick="hxBitwiseOp('shiftLeft')" 
            style="padding:10px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-family:monospace;">
      << 1
    </button>
    <button type="button" onclick="hxBitwiseOp('shiftRight')"
            style="padding:10px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-family:monospace;">
      >> 1
    </button>
    <button type="button" onclick="hxBitwiseOp('rotateLeft')"
            style="padding:10px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-family:monospace;">
      ROL
    </button>
    <button type="button" onclick="hxBitwiseOp('rotateRight')"
            style="padding:10px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-family:monospace;">
      ROR
    </button>
  </div>
  
  <!-- Operand Input -->
  <div style="margin-top:16px;">
    <label for="hx-operand" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Operand (Hex)
    </label>
    <div style="display:flex;gap:8px;">
      <input id="hx-operand" type="text" placeholder="0xFF" 
             style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-family:monospace;" />
      <button type="button" onclick="hxApplyBitwise()"
              style="padding:10px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;">
        Apply
      </button>
    </div>
  </div>
</div>

<!-- Color Visualization -->
<div id="hx-color-container" style="display:none;margin-bottom:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üé® Color Representation</h3>
  
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:16px;">
      <div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px;">RGB (24-bit)</div>
        <div id="hx-color-rgb" style="height:60px;border-radius:8px;background:#000000;display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-family:monospace;">
          #000000
        </div>
      </div>
      <div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px;">ARGB (32-bit)</div>
        <div id="hx-color-argb" style="height:60px;border-radius:8px;background:#000000;display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-family:monospace;">
          #00000000
        </div>
      </div>
    </div>
    
    <div style="font-size:12px;color:var(--muted);">
      <div id="hx-color-info">Enter a 24-bit or 32-bit hex value to see color representation</div>
    </div>
  </div>
</div>

<!-- Common Values & Quick Tools -->
<div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
  <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:16px;">‚ö° Quick Tools & Common Values</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;">
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin-bottom:8px;">üî¢ Common Values</h4>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="hxSetValue('0xFF')" 
                style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:4px;color:#ff4d4d;cursor:pointer;font-size:11px;font-family:monospace;">
          0xFF
        </button>
        <button type="button" onclick="hxSetValue('0x100')"
                style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:4px;color:#ff4d4d;cursor:pointer;font-size:11px;font-family:monospace;">
          0x100
        </button>
        <button type="button" onclick="hxSetValue('0xFFFFFFFF')"
                style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:4px;color:#ff4d4d;cursor:pointer;font-size:11px;font-family:monospace;">
          0xFFFFFFFF
        </button>
        <button type="button" onclick="hxSetValue('65535')"
                style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:11px;font-family:monospace;">
          65535
        </button>
      </div>
    </div>
    
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin-bottom:8px;">üîß Quick Tools</h4>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="hxCopyResult('hex')" 
                style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;">
          Copy Hex
        </button>
        <button type="button" onclick="hxCopyResult('dec')"
                style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;">
          Copy Dec
        </button>
        <button type="button" onclick="hxCopyResult('bin')"
                style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;">
          Copy Bin
        </button>
        <button type="button" onclick="hxGenerateRandom()"
                style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:4px;color:#9d4edd;cursor:pointer;font-size:11px;">
          Random
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Action Buttons -->
<div style="display:flex;gap:10px;margin-top:20px;">
  <button type="button" onclick="hxResetAll()" 
          style="flex:1;padding:12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
    üîÑ Reset All
  </button>
  <button type="button" onclick="hxSaveValue()"
          style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;">
    üíæ Save Value
  </button>
  <button type="button" onclick="hxToggleAdvanced()"
          style="padding:12px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:8px;cursor:pointer;">
    ‚öôÔ∏è Advanced
  </button>
</div>

<!-- Information Panel -->
<details style="margin-top:20px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06);">
  <summary style="color:var(--accent);font-weight:500;cursor:pointer;outline:none;">
    üìö Number System Guide
  </summary>
  <div style="margin-top:12px;font-size:13px;color:var(--muted);">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div>
        <strong style="color:#ff4d4d;">Hexadecimal (Base 16):</strong>
        <div style="font-family:monospace;font-size:12px;margin-top:4px;">
          0-9, A-F<br>
          Prefix: 0x or 0X<br>
          Example: 0x1A3F = 6719
        </div>
      </div>
      <div>
        <strong style="color:#39ff14;">Decimal (Base 10):</strong>
        <div style="font-family:monospace;font-size:12px;margin-top:4px;">
          0-9<br>
          Standard number system<br>
          Example: 6719
        </div>
      </div>
      <div>
        <strong style="color:var(--accent);">Binary (Base 2):</strong>
        <div style="font-family:monospace;font-size:12px;margin-top:4px;">
          0-1<br>
          Prefix: 0b or 0B<br>
          Example: 0b1101000111111
        </div>
      </div>
    </div>
    <div style="margin-top:12px;">
      <strong style="color:var(--accent);">Common Uses:</strong>
      <ul style="margin:6px 0;padding-left:20px;">
        <li>Hex: Memory addresses, colors, debugging</li>
        <li>Binary: Bitwise operations, flags, hardware registers</li>
        <li>Octal: Unix permissions, older systems</li>
        <li>Decimal: Everyday calculations, user input</li>
      </ul>
    </div>
  </div>
</details>

<script>
/* hex-converter.html
   - World-class hexadecimal/decimal/binary converter with advanced features
   - Scoped with hx- prefix (hex converter)
*/

// Global state
let hxCurrentValue = 0;
let hxBitSize = 32;
let hxSavedValues = [];

// Initialize when script loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    hxLoadSavedValues();
    hxSetValue('0'); // Initialize with zero
    console.log('Advanced Hex Converter ready');
  });
} else {
  hxLoadSavedValues();
  hxSetValue('0');
}

// Load saved values from localStorage
function hxLoadSavedValues() {
  const saved = localStorage.getItem('hx-saved-values');
  if (saved) {
    try {
      hxSavedValues = JSON.parse(saved);
    } catch (e) {
      console.error('Failed to load saved values:', e);
      hxSavedValues = [];
    }
  }
}

// Save current value
function hxSaveValue() {
  const value = {
    hex: hxFormatHex(hxCurrentValue),
    dec: hxCurrentValue.toString(),
    timestamp: new Date().toISOString()
  };
  
  hxSavedValues.push(value);
  
  // Keep only last 10 values
  if (hxSavedValues.length > 10) {
    hxSavedValues = hxSavedValues.slice(-10);
  }
  
  localStorage.setItem('hx-saved-values', JSON.stringify(hxSavedValues));
  hxShowMessage('Value saved to history', 'success');
}

// Set value from any input
function hxSetValue(valueStr) {
  let num;
  
  // Try to parse the value
  if (valueStr.startsWith('0x') || valueStr.startsWith('0X')) {
    // Hexadecimal
    num = parseInt(valueStr, 16);
  } else if (valueStr.startsWith('0b') || valueStr.startsWith('0B')) {
    // Binary
    num = parseInt(valueStr.substring(2), 2);
  } else if (valueStr.startsWith('0o') || valueStr.startsWith('0O')) {
    // Octal
    num = parseInt(valueStr.substring(2), 8);
  } else {
    // Try decimal
    num = parseInt(valueStr);
  }
  
  if (isNaN(num)) {
    hxShowMessage('Invalid number format', 'error');
    return;
  }
  
  hxCurrentValue = num;
  hxUpdateAll();
}

// Convert from hexadecimal input
function hxConvertFromHex() {
  const input = document.getElementById('hx-hex-input');
  const value = input.value.trim().toUpperCase();
  
  // Remove 0x prefix if present
  const cleanValue = value.replace(/^0x/, '');
  
  if (!cleanValue) {
    hxCurrentValue = 0;
    hxUpdateAll();
    return;
  }
  
  // Validate hex digits
  if (!/^[0-9A-F]+$/.test(cleanValue)) {
    hxShowMessage('Invalid hexadecimal characters', 'error');
    return;
  }
  
  const num = parseInt(cleanValue, 16);
  if (isNaN(num)) {
    hxShowMessage('Invalid hexadecimal number', 'error');
    return;
  }
  
  hxCurrentValue = num;
  hxUpdateAllExcept('hex');
}

// Convert from decimal input
function hxConvertFromDec() {
  const input = document.getElementById('hx-dec-input');
  const value = input.value.trim();
  
  if (!value) {
    hxCurrentValue = 0;
    hxUpdateAll();
    return;
  }
  
  const num = parseInt(value);
  if (isNaN(num)) {
    hxShowMessage('Invalid decimal number', 'error');
    return;
  }
  
  hxCurrentValue = num;
  hxUpdateAllExcept('dec');
}

// Convert from binary input
function hxConvertFromBin() {
  const input = document.getElementById('hx-bin-input');
  const value = input.value.trim();
  
  // Remove 0b prefix if present
  const cleanValue = value.replace(/^0b/, '');
  
  if (!cleanValue) {
    hxCurrentValue = 0;
    hxUpdateAll();
    return;
  }
  
  // Validate binary digits
  if (!/^[01]+$/.test(cleanValue)) {
    hxShowMessage('Invalid binary characters (only 0 and 1 allowed)', 'error');
    return;
  }
  
  const num = parseInt(cleanValue, 2);
  if (isNaN(num)) {
    hxShowMessage('Invalid binary number', 'error');
    return;
  }
  
  hxCurrentValue = num;
  hxUpdateAllExcept('bin');
}

// Convert from octal input
function hxConvertFromOct() {
  const input = document.getElementById('hx-oct-input');
  const value = input.value.trim();
  
  // Remove 0o prefix if present
  const cleanValue = value.replace(/^0o/, '');
  
  if (!cleanValue) {
    hxCurrentValue = 0;
    hxUpdateAll();
    return;
  }
  
  // Validate octal digits
  if (!/^[0-7]+$/.test(cleanValue)) {
    hxShowMessage('Invalid octal characters (only 0-7 allowed)', 'error');
    return;
  }
  
  const num = parseInt(cleanValue, 8);
  if (isNaN(num)) {
    hxShowMessage('Invalid octal number', 'error');
    return;
  }
  
  hxCurrentValue = num;
  hxUpdateAllExcept('oct');
}

// Convert from ASCII input
function hxConvertFromAscii() {
  const input = document.getElementById('hx-ascii-input');
  const value = input.value;
  
  if (!value) {
    return;
  }
  
  // Get character code (first character only)
  const charCode = value.charCodeAt(0);
  hxCurrentValue = charCode;
  hxUpdateAllExcept('ascii');
}

// Convert all formats
function hxConvertAll() {
  hxUpdateAll();
}

// Clear all inputs
function hxClearAll() {
  document.getElementById('hx-hex-input').value = '';
  document.getElementById('hx-dec-input').value = '';
  document.getElementById('hx-bin-input').value = '';
  document.getElementById('hx-oct-input').value = '';
  document.getElementById('hx-ascii-input').value = '';
  
  hxCurrentValue = 0;
  hxUpdateAll();
}

// Update all displays except specified input
function hxUpdateAllExcept(exclude) {
  const hexValue = hxFormatHex(hxCurrentValue);
  const decValue = hxCurrentValue.toString();
  const binValue = hxFormatBin(hxCurrentValue);
  const octValue = hxFormatOct(hxCurrentValue);
  
  if (exclude !== 'hex') {
    document.getElementById('hx-hex-input').value = hexValue.replace(/^0x/, '');
  }
  if (exclude !== 'dec') {
    document.getElementById('hx-dec-input').value = decValue;
  }
  if (exclude !== 'bin') {
    document.getElementById('hx-bin-input').value = binValue.replace(/^0b/, '');
  }
  if (exclude !== 'oct') {
    document.getElementById('hx-oct-input').value = octValue.replace(/^0o/, '');
  }
  if (exclude !== 'ascii') {
    const char = hxCurrentValue >= 32 && hxCurrentValue <= 126 ? String.fromCharCode(hxCurrentValue) : '';
    document.getElementById('hx-ascii-input').value = char;
  }
  
  hxUpdateResults();
  hxUpdateBitVisualization();
  hxUpdateColorVisualization();
}

// Update all displays
function hxUpdateAll() {
  hxUpdateAllExcept('');
}

// Update results display
function hxUpdateResults() {
  // Show results container
  document.getElementById('hx-results-container').style.display = 'block';
  
  // Format values
  const hexValue = hxFormatHex(hxCurrentValue);
  const decValue = hxCurrentValue.toString();
  const binValue = hxFormatBin(hxCurrentValue);
  const octValue = hxFormatOct(hxCurrentValue);
  
  // Update result displays
  document.getElementById('hx-result-hex').textContent = hexValue;
  document.getElementById('hx-result-dec').textContent = decValue;
  document.getElementById('hx-result-bin').textContent = binValue;
  document.getElementById('hx-result-oct').textContent = octValue;
  
  // Update ASCII/Unicode display
  hxUpdateAsciiDisplay();
}

// Update ASCII/Unicode display
function hxUpdateAsciiDisplay() {
  const charContainer = document.getElementById('hx-result-char');
  const asciiText = document.getElementById('hx-result-ascii');
  const charInfo = document.getElementById('hx-char-info');
  const unicodeInfo = document.getElementById('hx-unicode-info');
  
  const charCode = hxCurrentValue;
  
  // Display character if printable
  if (charCode >= 32 && charCode <= 126) {
    // Printable ASCII
    const char = String.fromCharCode(charCode);
    charContainer.textContent = char;
    asciiText.textContent = `ASCII: ${char} (${charCode})`;
    charInfo.textContent = `Printable ASCII character`;
    unicodeInfo.textContent = `U+${charCode.toString(16).toUpperCase().padStart(4, '0')}`;
  } else if (charCode === 0) {
    // Null character
    charContainer.textContent = 'NUL';
    asciiText.textContent = `ASCII: NUL (${charCode})`;
    charInfo.textContent = `Null character`;
    unicodeInfo.textContent = `U+0000`;
  } else if (charCode >= 0 && charCode <= 31) {
    // Control characters
    const controlNames = [
      'NUL', 'SOH', 'STX', 'ETX', 'EOT', 'ENQ', 'ACK', 'BEL',
      'BS', 'HT', 'LF', 'VT', 'FF', 'CR', 'SO', 'SI',
      'DLE', 'DC1', 'DC2', 'DC3', 'DC4', 'NAK', 'SYN', 'ETB',
      'CAN', 'EM', 'SUB', 'ESC', 'FS', 'GS', 'RS', 'US'
    ];
    charContainer.textContent = controlNames[charCode] || 'CTL';
    asciiText.textContent = `ASCII: ${controlNames[charCode] || 'Control'} (${charCode})`;
    charInfo.textContent = `Control character`;
    unicodeInfo.textContent = `U+${charCode.toString(16).toUpperCase().padStart(4, '0')}`;
  } else if (charCode <= 0x10FFFF) {
    // Unicode character
    try {
      const char = String.fromCodePoint(charCode);
      charContainer.textContent = char;
      asciiText.textContent = `Unicode: ${char} (${charCode})`;
      charInfo.textContent = `Unicode character`;
      unicodeInfo.textContent = `U+${charCode.toString(16).toUpperCase().padStart(4, '0')}`;
    } catch (e) {
      charContainer.textContent = 'ÔøΩ';
      asciiText.textContent = `Invalid Unicode: ${charCode}`;
      charInfo.textContent = `Invalid Unicode code point`;
      unicodeInfo.textContent = `Invalid`;
    }
  } else {
    charContainer.textContent = 'ÔøΩ';
    asciiText.textContent = `Out of range: ${charCode}`;
    charInfo.textContent = `Value exceeds Unicode range`;
    unicodeInfo.textContent = `Invalid`;
  }
}

// Update bit visualization
function hxUpdateBitVisualization() {
  const bitSize = parseInt(document.getElementById('hx-bits').value);
  hxBitSize = bitSize;
  
  // Show bit container
  document.getElementById('hx-bits-container').style.display = 'block';
  document.getElementById('hx-bit-count').textContent = `${bitSize} bits`;
  
  // Get binary representation
  const binary = hxCurrentValue.toString(2).padStart(bitSize, '0');
  const bits = binary.split('');
  
  // Create bit grid
  const bitGrid = document.getElementById('hx-bit-grid');
  bitGrid.innerHTML = '';
  
  // Create bits in reverse order (LSB on right)
  for (let i = bits.length - 1; i >= 0; i--) {
    const bit = bits[i];
    const bitIndex = bits.length - 1 - i;
    
    const bitElement = document.createElement('div');
    bitElement.style.cssText = `
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      background: ${bit === '1' ? 'rgba(57,255,20,0.3)' : 'rgba(255,255,255,0.1)'};
      border: 2px solid ${bit === '1' ? 'rgba(57,255,20,0.6)' : 'rgba(255,255,255,0.2)'};
      color: ${bit === '1' ? '#39ff14' : 'var(--muted)'};
      font-family: monospace;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      position: relative;
    `;
    
    bitElement.textContent = bit;
    bitElement.title = `Bit ${bitIndex}: ${bit} (${Math.pow(2, bitIndex)})`;
    
    // Add bit index label
    const indexLabel = document.createElement('div');
    indexLabel.style.cssText = `
      position: absolute;
      top: -18px;
      font-size: 10px;
      color: var(--muted);
      width: 100%;
      text-align: center;
    `;
    indexLabel.textContent = bitIndex;
    bitElement.appendChild(indexLabel);
    
    // Add click handler to toggle bit
    bitElement.addEventListener('click', () => {
      hxToggleBit(bitIndex);
    });
    
    // Add byte separator every 8 bits
    if (bitIndex > 0 && bitIndex % 8 === 0) {
      const separator = document.createElement('div');
      separator.style.cssText = `
        width: 4px;
        height: 32px;
        background: rgba(255,255,255,0.2);
        border-radius: 2px;
      `;
      bitGrid.appendChild(separator);
    }
    
    bitGrid.appendChild(bitElement);
  }
}

// Toggle a bit
function hxToggleBit(bitIndex) {
  const mask = 1 << bitIndex;
  hxCurrentValue ^= mask; // XOR to toggle bit
  
  hxUpdateAll();
  hxShowMessage(`Toggled bit ${bitIndex}`, 'info');
}

// Update color visualization
function hxUpdateColorVisualization() {
  const hexValue = hxCurrentValue;
  
  // Show color container for 24-bit or 32-bit values
  const is24Bit = hexValue >= 0 && hexValue <= 0xFFFFFF;
  const is32Bit = hexValue >= 0 && hexValue <= 0xFFFFFFFF;
  
  if (is24Bit || is32Bit) {
    document.getElementById('hx-color-container').style.display = 'block';
    
    // Format as 6-digit hex (RGB)
    const rgbHex = '#' + (hexValue & 0xFFFFFF).toString(16).padStart(6, '0').toUpperCase();
    const rgbElement = document.getElementById('hx-color-rgb');
    
    // Determine text color based on background brightness
    const r = (hexValue >> 16) & 0xFF;
    const g = (hexValue >> 8) & 0xFF;
    const b = hexValue & 0xFF;
    const brightness = (r * 299 + g * 587 + b * 114) / 1000;
    const textColor = brightness > 128 ? 'black' : 'white';
    
    rgbElement.style.background = rgbHex;
    rgbElement.style.color = textColor;
    rgbElement.textContent = rgbHex;
    
    // Format as 8-digit hex (ARGB)
    const argbHex = '#' + (hexValue & 0xFFFFFFFF).toString(16).padStart(8, '0').toUpperCase();
    const argbElement = document.getElementById('hx-color-argb');
    
    // Extract alpha for ARGB
    const a = (hexValue >> 24) & 0xFF;
    const alpha = a / 255;
    
    // Create semi-transparent version for display
    const alphaBg = `rgba(${r}, ${g}, ${b}, ${alpha})`;
    argbElement.style.background = alphaBg;
    argbElement.style.color = textColor;
    argbElement.textContent = argbHex;
    
    // Update color info
    const colorInfo = document.getElementById('hx-color-info');
    if (is32Bit && a < 255) {
      colorInfo.textContent = `RGB: rgb(${r}, ${g}, ${b}) | Alpha: ${Math.round(alpha * 100)}%`;
    } else {
      colorInfo.textContent = `RGB: rgb(${r}, ${g}, ${b})`;
    }
  } else {
    document.getElementById('hx-color-container').style.display = 'none';
  }
}

// Bitwise operations
function hxBitwiseOp(operation) {
  let result = hxCurrentValue;
  let operandInput = document.getElementById('hx-operand').value.trim();
  let operand = 0;
  
  if (operandInput) {
    // Try to parse operand
    if (operandInput.startsWith('0x')) {
      operand = parseInt(operandInput.substring(2), 16);
    } else if (operandInput.startsWith('0b')) {
      operand = parseInt(operandInput.substring(2), 2);
    } else if (operandInput.startsWith('0o')) {
      operand = parseInt(operandInput.substring(2), 8);
    } else {
      operand = parseInt(operandInput);
    }
    
    if (isNaN(operand)) {
      hxShowMessage('Invalid operand', 'error');
      return;
    }
  }
  
  // Apply operation
  switch(operation) {
    case 'and':
      result = hxCurrentValue & operand;
      hxShowMessage(`AND with 0x${operand.toString(16).toUpperCase()}`, 'info');
      break;
    case 'or':
      result = hxCurrentValue | operand;
      hxShowMessage(`OR with 0x${operand.toString(16).toUpperCase()}`, 'info');
      break;
    case 'xor':
      result = hxCurrentValue ^ operand;
      hxShowMessage(`XOR with 0x${operand.toString(16).toUpperCase()}`, 'info');
      break;
    case 'not':
      result = ~hxCurrentValue;
      // Mask to current bit size
      const mask = (1 << hxBitSize) - 1;
      result &= mask;
      hxShowMessage(`NOT operation`, 'info');
      break;
    case 'shiftLeft':
      result = hxCurrentValue << 1;
      hxShowMessage(`Left shift by 1`, 'info');
      break;
    case 'shiftRight':
      result = hxCurrentValue >> 1;
      hxShowMessage(`Right shift by 1`, 'info');
      break;
    case 'rotateLeft':
      // Rotate left within bit size
      const leftMask = (1 << hxBitSize) - 1;
      const leftHighBit = (hxCurrentValue >> (hxBitSize - 1)) & 1;
      result = ((hxCurrentValue << 1) | leftHighBit) & leftMask;
      hxShowMessage(`Rotate left`, 'info');
      break;
    case 'rotateRight':
      // Rotate right within bit size
      const rightMask = (1 << hxBitSize) - 1;
      const rightLowBit = hxCurrentValue & 1;
      result = (hxCurrentValue >> 1) | (rightLowBit << (hxBitSize - 1));
      hxShowMessage(`Rotate right`, 'info');
      break;
  }
  
  hxCurrentValue = result;
  hxUpdateAll();
}

// Apply bitwise operation with operand
function hxApplyBitwise() {
  const operationSelect = document.createElement('select');
  operationSelect.innerHTML = `
    <option value="and">AND (&)</option>
    <option value="or">OR (|)</option>
    <option value="xor">XOR (^)</option>
  `;
  
  const dialog = document.createElement('div');
  dialog.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  `;
  
  dialog.innerHTML = `
    <div style="background: var(--panel); border-radius: 12px; padding: 24px; max-width: 400px; width: 90%; border: 1px solid var(--border);">
      <div style="font-weight: 600; color: var(--accent); font-size: 18px; margin-bottom: 20px;">
        Apply Bitwise Operation
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 6px; color: var(--accent); font-weight: 500;">
          Operation
        </label>
        <select id="hx-dialog-operation" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: inherit;">
          <option value="and">AND (&)</option>
          <option value="or">OR (|)</option>
          <option value="xor">XOR (^)</option>
        </select>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 6px; color: var(--accent); font-weight: 500;">
          Operand (Hex)
        </label>
        <input type="text" id="hx-dialog-operand" placeholder="0xFF" 
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: inherit; font-family: monospace;" />
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="document.querySelector('.hx-dialog').remove()" 
                style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: inherit; cursor: pointer;">
          Cancel
        </button>
        <button onclick="hxExecuteBitwise()" 
                style="padding: 10px 16px; background: rgba(45,212,255,0.1); border: 1px solid rgba(45,212,255,0.3); border-radius: 6px; color: var(--accent); cursor: pointer;">
          Apply
        </button>
      </div>
    </div>
  `;
  
  dialog.className = 'hx-dialog';
  document.body.appendChild(dialog);
}

function hxExecuteBitwise() {
  const dialog = document.querySelector('.hx-dialog');
  if (!dialog) return;
  
  const operation = dialog.querySelector('#hx-dialog-operation').value;
  const operandInput = dialog.querySelector('#hx-dialog-operand').value.trim();
  
  if (!operandInput) {
    hxShowMessage('Please enter an operand', 'error');
    return;
  }
  
  let operand;
  if (operandInput.startsWith('0x')) {
    operand = parseInt(operandInput.substring(2), 16);
  } else if (operandInput.startsWith('0b')) {
    operand = parseInt(operandInput.substring(2), 2);
  } else {
    operand = parseInt(operandInput);
  }
  
  if (isNaN(operand)) {
    hxShowMessage('Invalid operand', 'error');
    return;
  }
  
  hxBitwiseOp(operation, operand);
  dialog.remove();
}

// Copy result to clipboard
function hxCopyResult(format) {
  let text = '';
  
  switch(format) {
    case 'hex':
      text = hxFormatHex(hxCurrentValue);
      break;
    case 'dec':
      text = hxCurrentValue.toString();
      break;
    case 'bin':
      text = hxFormatBin(hxCurrentValue);
      break;
  }
  
  navigator.clipboard.writeText(text).then(() => {
    hxShowMessage(`${format.toUpperCase()} copied to clipboard`, 'success');
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    hxShowMessage(`${format.toUpperCase()} copied to clipboard`, 'success');
  });
}

// Generate random value
function hxGenerateRandom() {
  const bitSize = parseInt(document.getElementById('hx-bits').value);
  const maxValue = Math.pow(2, bitSize) - 1;
  const randomValue = Math.floor(Math.random() * maxValue);
  
  hxCurrentValue = randomValue;
  hxUpdateAll();
  
  hxShowMessage(`Generated random ${bitSize}-bit value`, 'info');
}

// Reset all
function hxResetAll() {
  hxCurrentValue = 0;
  document.getElementById('hx-operand').value = '';
  hxUpdateAll();
  hxShowMessage('All values reset', 'info');
}

// Toggle advanced features
function hxToggleAdvanced() {
  const advancedSections = [
    document.getElementById('hx-bits-container'),
    document.getElementById('hx-color-container')
  ];
  
  advancedSections.forEach(section => {
    if (section) {
      if (section.style.display === 'none') {
        section.style.display = 'block';
      } else {
        section.style.display = 'none';
      }
    }
  });
}

// Helper formatting functions
function hxFormatHex(value) {
  const bitSize = parseInt(document.getElementById('hx-bits').value);
  const hexDigits = Math.ceil(bitSize / 4);
  return '0x' + (value >>> 0).toString(16).toUpperCase().padStart(hexDigits, '0');
}

function hxFormatBin(value) {
  const bitSize = parseInt(document.getElementById('hx-bits').value);
  const binary = (value >>> 0).toString(2).padStart(bitSize, '0');
  
  // Add spaces every 4 bits for readability
  const spaced = binary.replace(/(.{4})/g, '$1 ').trim();
  return '0b' + spaced;
}

function hxFormatOct(value) {
  const bitSize = parseInt(document.getElementById('hx-bits').value);
  const octalDigits = Math.ceil(bitSize / 3);
  return '0o' + (value >>> 0).toString(8).padStart(octalDigits, '0');
}

// Show message
function hxShowMessage(message, type = 'info') {
  const card = document.currentScript?.closest('.card') || document;
  
  // Remove existing message
  const existingMsg = card.querySelector('.hx-message');
  if (existingMsg) existingMsg.remove();
  
  // Create message element
  const messageEl = document.createElement('div');
  messageEl.className = 'hx-message';
  messageEl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    border-radius: 8px;
    background: ${type === 'error' ? 'rgba(255,77,77,0.9)' : 
                 type === 'success' ? 'rgba(57,255,20,0.9)' : 
                 'rgba(45,212,255,0.9)'};
    color: #ffffff;
    z-index: 10000;
    backdrop-filter: blur(4px);
    animation: hxSlideIn 0.3s ease;
  `;
  
  // Add CSS animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes hxSlideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes hxFadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  `;
  document.head.appendChild(style);
  
  messageEl.textContent = message;
  document.body.appendChild(messageEl);
  
  // Auto-remove after 3 seconds
  setTimeout(() => {
    messageEl.style.animation = 'hxFadeOut 0.3s ease';
    setTimeout(() => messageEl.remove(), 300);
  }, 3000);
}
</script>

<style>
#hx-converter-title {
  color: var(--accent);
  margin-top: 0;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

@media (max-width: 768px) {
  .hx-input-grid {
    grid-template-columns: 1fr !important;
  }
  
  #hx-bit-grid {
    justify-content: flex-start !important;
    overflow-x: auto;
    padding-bottom: 8px;
  }
  
  #hx-bit-grid > div {
    flex-shrink: 0;
  }
  
  .hx-results-grid {
    grid-template-columns: 1fr !important;
  }
}
</style>
