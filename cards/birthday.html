<!-- cards/birthday-reminder.html -->
<h2 id="birthday-reminder-title">Birthday Reminder</h2>

<div class="description">
  Never miss a birthday! Add reminders and get notified of upcoming birthdays.
  <span class="disclaimer">All data is stored locally in your browser only.</span>
</div>

<div class="tool-body">
  <!-- ADD BIRTHDAY FORM -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 1px solid rgba(255,128,171,0.3);">
    <div style="color: #ff4081; font-weight: 600; margin-bottom: 15px;">
      ğŸ‚ Add New Birthday
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
      <div>
        <label for="br-name" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #ff4081;">Name *</span>
        </label>
        <input id="br-name" type="text" placeholder="e.g. Sarah Johnson"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,128,171,0.3); background: rgba(255,128,171,0.05); color: #e6faff;">
      </div>
      
      <div>
        <label for="br-date" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #ff4081;">Date *</span>
        </label>
        <input id="br-date" type="date" 
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,128,171,0.3); background: rgba(255,128,171,0.05); color: #e6faff;">
        <div style="margin-top: 6px; color: rgba(255,128,171,0.7); font-size: 13px;">
          Next birthday: <span id="br-next-display">--</span>
        </div>
      </div>
    </div>
    
    <div style="margin-bottom: 15px;">
      <label for="br-notes" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
        <span style="color: #ff4081;">Notes (Optional)</span>
      </label>
      <input id="br-notes" type="text" placeholder="e.g. Loves chocolate cake, gift ideas, etc."
             style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,128,171,0.3); background: rgba(255,128,171,0.05); color: #e6faff;">
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <button id="br-add-btn" 
              style="padding: 12px; background: linear-gradient(135deg, #e91e63, #ff4081); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
        â• Add Birthday
      </button>
      
      <button id="br-reset-btn" 
              style="padding: 12px; background: rgba(255,255,255,0.08); color: #e6faff; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-weight: 600;">
        ğŸ”„ Reset All
      </button>
    </div>
  </div>
  
  <!-- BIRTHDAY LIST -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 1px solid rgba(57,255,20,0.3);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
      <div style="color: #39ff14; font-weight: 600; font-size: 16px;">
        ğŸ“… Upcoming Birthdays
        <span id="br-upcoming-count" style="background: rgba(57,255,20,0.2); color: #39ff14; padding: 2px 8px; border-radius: 10px; font-size: 0.9em; margin-left: 8px;">0</span>
      </div>
      
      <div style="display: flex; gap: 8px;">
        <button id="br-sort-btn" 
                style="padding: 6px 12px; background: rgba(45,212,255,0.1); color: #2dd4ff; border: 1px solid rgba(45,212,255,0.3); border-radius: 6px; cursor: pointer; font-size: 0.9em;">
          ğŸ”¼ Sort
        </button>
        <button id="br-copy-btn" 
                style="padding: 6px 12px; background: rgba(57,255,20,0.1); color: #39ff14; border: 1px solid rgba(57,255,20,0.3); border-radius: 6px; cursor: pointer; font-size: 0.9em;">
          ğŸ“‹ Copy List
        </button>
      </div>
    </div>
    
    <!-- Search & Filter -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
      <input id="br-search" type="text" placeholder="Search names..." 
             style="padding: 8px; border-radius: 6px; border: 1px solid rgba(45,212,255,0.3); background: rgba(45,212,255,0.05); color: #e6faff;">
      
      <select id="br-filter" 
              style="padding: 8px; border-radius: 6px; border: 1px solid rgba(45,212,255,0.3); background: rgba(45,212,255,0.05); color: #e6faff;">
        <option value="all">All Birthdays</option>
        <option value="upcoming">Upcoming (30 days)</option>
        <option value="past">Past Birthdays</option>
        <option value="this-month">This Month</option>
        <option value="next-month">Next Month</option>
      </select>
    </div>
    
    <!-- Empty State -->
    <div id="br-empty" style="text-align: center; padding: 30px; color: rgba(230,250,255,0.5);">
      <div style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;">ğŸ‚</div>
      <p>No birthdays added yet. Add your first birthday above!</p>
    </div>
    
    <!-- Birthday List -->
    <div id="br-list" style="display: none;"></div>
  </div>
  
  <!-- STATISTICS -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; border: 1px solid rgba(255,165,0,0.3);">
    <div style="color: #ffa500; font-weight: 600; margin-bottom: 15px; font-size: 16px;">
      ğŸ“Š Birthday Statistics
    </div>
    
    <div id="br-stats" style="display: none; color: #e6faff; font-size: 14px;">
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
        <div style="background: rgba(45,212,255,0.1); padding: 10px; border-radius: 6px;">
          <div style="color: #2dd4ff; font-weight: 600;">Total</div>
          <div id="br-total-count" style="font-size: 20px; font-weight: bold; color: #2dd4ff;">0</div>
        </div>
        <div style="background: rgba(57,255,20,0.1); padding: 10px; border-radius: 6px;">
          <div style="color: #39ff14; font-weight: 600;">Upcoming</div>
          <div id="br-upcoming-stats" style="font-size: 20px; font-weight: bold; color: #39ff14;">0</div>
        </div>
        <div style="background: rgba(255,128,171,0.1); padding: 10px; border-radius: 6px;">
          <div style="color: #ff4081; font-weight: 600;">This Month</div>
          <div id="br-month-count" style="font-size: 20px; font-weight: bold; color: #ff4081;">0</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- NOTIFICATION -->
  <div id="br-notification" style="display: none; position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 8px; z-index: 1000;"></div>
</div>

<style>
#birthday-reminder-title { 
  color: #ff4081; 
  margin-top: 0;
  margin-bottom: 10px;
}

.description {
  color: rgba(230,250,255,0.8);
  margin-bottom: 20px;
  font-size: 14px;
}

.disclaimer {
  display: block;
  color: rgba(255,165,0,0.8);
  font-size: 12px;
  margin-top: 5px;
  font-style: italic;
}

/* Birthday card styling */
.br-birthday-card {
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 10px;
  border-left: 4px solid #ff4081;
  transition: all 0.3s;
}

.br-birthday-card.today {
  background: rgba(255,152,0,0.15);
  border-left-color: #ff9800;
  animation: br-pulse 2s infinite;
}

.br-birthday-card.upcoming {
  background: rgba(233,30,99,0.1);
  border-left-color: #e91e63;
}

/* Days badge styling */
.br-days-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.85em;
  min-width: 80px;
  text-align: center;
}

.br-days-badge.today {
  background: #ff9800;
  color: white;
}

.br-days-badge.tomorrow {
  background: #9c27b0;
  color: white;
}

.br-days-badge.this-week {
  background: #e91e63;
  color: white;
}

.br-days-badge.this-month {
  background: #f06292;
  color: white;
}

.br-days-badge.future {
  background: #ad1457;
  color: white;
}

.br-days-badge.past {
  background: #bdbdbd;
  color: #333;
}

/* Animations */
@keyframes br-pulse {
  0% { box-shadow: 0 0 0 0 rgba(255,152,0,0.4); }
  70% { box-shadow: 0 0 0 10px rgba(255,152,0,0); }
  100% { box-shadow: 0 0 0 0 rgba(255,152,0,0); }
}

@keyframes br-slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .tool-body > div > div {
    grid-template-columns: 1fr !important;
  }
  
  #br-stats > div {
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
}
</style>

<script>
// ============================================
// BIRTHDAY REMINDER - PROPERLY SCOPED
// All functions prefixed with "br" (birthday reminder)
// ============================================

// Main state
let brBirthdays = JSON.parse(localStorage.getItem('brBirthdays')) || [];
let brCurrentSort = 'asc';

// Initialize the tool
function brInit() {
  console.log("Birthday Reminder: Initializing...");
  
  // Load saved birthdays
  brRenderBirthdays();
  
  // Set date input to today
  document.getElementById('br-date').valueAsDate = new Date();
  
  // Update next birthday display
  brUpdateNextBirthdayDisplay();
  
  // Add event listeners
  document.getElementById('br-add-btn').addEventListener('click', brAddBirthday);
  document.getElementById('br-reset-btn').addEventListener('click', brResetAll);
  document.getElementById('br-sort-btn').addEventListener('click', brToggleSort);
  document.getElementById('br-copy-btn').addEventListener('click', brCopyList);
  document.getElementById('br-date').addEventListener('change', brUpdateNextBirthdayDisplay);
  document.getElementById('br-search').addEventListener('input', brFilterBirthdays);
  document.getElementById('br-filter').addEventListener('change', brFilterBirthdays);
  
  // Enter key support for adding
  document.getElementById('br-name').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') brAddBirthday();
  });
  document.getElementById('br-notes').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') brAddBirthday();
  });
  
  console.log("âœ… Birthday Reminder ready!");
}

// Calculate next birthday from selected date
function brUpdateNextBirthdayDisplay() {
  const dateInput = document.getElementById('br-date');
  const displaySpan = document.getElementById('br-next-display');
  
  if (!dateInput.value) {
    displaySpan.textContent = '--';
    return;
  }
  
  const selectedDate = new Date(dateInput.value);
  const today = new Date();
  const currentYear = today.getFullYear();
  
  let nextBirthday = new Date(selectedDate);
  nextBirthday.setFullYear(currentYear);
  
  if (nextBirthday < today) {
    nextBirthday.setFullYear(currentYear + 1);
  }
  
  const options = { weekday: 'long', month: 'long', day: 'numeric' };
  displaySpan.textContent = nextBirthday.toLocaleDateString('en-US', options);
}

// Add new birthday
function brAddBirthday() {
  const name = document.getElementById('br-name').value.trim();
  const date = document.getElementById('br-date').value;
  const notes = document.getElementById('br-notes').value.trim();

  if (!name || !date) {
    brShowNotification('Please fill in name and date', 'error');
    return;
  }

  const id = Date.now().toString();
  
  brBirthdays.push({ 
    id, 
    name, 
    date, 
    notes,
    added: new Date().toISOString().split('T')[0]
  });
  
  brSaveBirthdays();
  brShowNotification(`Added birthday for ${name}`, 'success');
  brRenderBirthdays();
  
  // Reset form
  document.getElementById('br-name').value = '';
  document.getElementById('br-date').valueAsDate = new Date();
  document.getElementById('br-notes').value = '';
  document.getElementById('br-name').focus();
}

// Save to localStorage
function brSaveBirthdays() {
  localStorage.setItem('brBirthdays', JSON.stringify(brBirthdays));
}

// Render birthday list
function brRenderBirthdays() {
  const list = document.getElementById('br-list');
  const emptyState = document.getElementById('br-empty');
  const stats = document.getElementById('br-stats');
  
  if (brBirthdays.length === 0) {
    list.style.display = 'none';
    emptyState.style.display = 'block';
    stats.style.display = 'none';
    document.getElementById('br-upcoming-count').textContent = '0';
    return;
  }
  
  // Clear list
  list.innerHTML = '';
  
  // Sort by upcoming
  const sorted = brSortByUpcoming([...brBirthdays]);
  
  // Calculate stats
  const today = new Date();
  const currentMonth = today.getMonth();
  
  let upcomingCount = 0;
  let monthCount = 0;
  
  sorted.forEach(birthday => {
    const nextBday = brGetNextBirthday(new Date(birthday.date));
    const diffDays = Math.ceil((nextBday - today) / (1000 * 60 * 60 * 24));
    
    if (diffDays >= 0 && diffDays <= 30) upcomingCount++;
    
    const bdayMonth = new Date(birthday.date).getMonth();
    if (bdayMonth === currentMonth) monthCount++;
    
    // Create card
    const card = brCreateBirthdayCard(birthday, diffDays, nextBday);
    list.appendChild(card);
  });
  
  // Update stats
  document.getElementById('br-total-count').textContent = brBirthdays.length;
  document.getElementById('br-upcoming-stats').textContent = upcomingCount;
  document.getElementById('br-month-count').textContent = monthCount;
  document.getElementById('br-upcoming-count').textContent = upcomingCount;
  
  // Show list and stats
  list.style.display = 'block';
  emptyState.style.display = 'none';
  stats.style.display = 'block';
  
  // Apply filter
  brFilterBirthdays();
}

// Create birthday card element
function brCreateBirthdayCard(birthday, daysUntil, nextBirthday) {
  const card = document.createElement('div');
  card.className = 'br-birthday-card';
  card.dataset.id = birthday.id;
  
  if (daysUntil === 0) {
    card.classList.add('today');
  } else if (daysUntil > 0 && daysUntil <= 7) {
    card.classList.add('upcoming');
  }
  
  // Format dates
  const dateObj = new Date(birthday.date);
  const formattedDate = dateObj.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric',
    year: 'numeric'
  });
  
  const birthDate = new Date(birthday.date);
  const age = nextBirthday.getFullYear() - birthDate.getFullYear();
  
  // Determine badge
  let badgeClass = 'future';
  let badgeText = `${daysUntil} days`;
  
  if (daysUntil < 0) {
    badgeClass = 'past';
    badgeText = 'Past';
  } else if (daysUntil === 0) {
    badgeClass = 'today';
    badgeText = 'Today!';
  } else if (daysUntil === 1) {
    badgeClass = 'tomorrow';
    badgeText = 'Tomorrow';
  } else if (daysUntil <= 7) {
    badgeClass = 'this-week';
    badgeText = `${daysUntil} days`;
  } else if (daysUntil <= 30) {
    badgeClass = 'this-month';
    badgeText = `${daysUntil} days`;
  }
  
  card.innerHTML = `
    <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 15px;">
      <div style="flex: 1;">
        <div style="font-weight: 600; color: #e6faff; margin-bottom: 5px; font-size: 16px;">
          ${birthday.name} ${daysUntil === 0 ? 'ğŸ' : ''}
        </div>
        <div style="color: rgba(230,250,255,0.7); font-size: 14px; margin-bottom: 5px;">
          ğŸ“… ${formattedDate}
          ${birthday.notes ? ` â€¢ ğŸ“ ${birthday.notes}` : ''}
        </div>
        <div style="color: rgba(230,250,255,0.5); font-size: 13px;">
          ğŸ‚ Turns ${age} in ${nextBirthday.getFullYear()} â€¢ Added: ${new Date(birthday.added).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
        </div>
      </div>
      <div style="text-align: center; min-width: 100px;">
        <div class="br-days-badge ${badgeClass}">
          ${badgeText}
        </div>
        <button onclick="brDeleteBirthday('${birthday.id}')" 
                style="margin-top: 8px; padding: 6px 12px; background: rgba(255,77,77,0.1); color: #ff4d4d; border: 1px solid rgba(255,77,77,0.3); border-radius: 4px; cursor: pointer; font-size: 12px; width: 100%;">
          ğŸ—‘ï¸ Remove
        </button>
      </div>
    </div>
  `;
  
  return card;
}

// Get next birthday
function brGetNextBirthday(birthDate) {
  const today = new Date();
  const currentYear = today.getFullYear();
  
  let nextBirthday = new Date(birthDate);
  nextBirthday.setFullYear(currentYear);
  
  if (nextBirthday < today) {
    nextBirthday.setFullYear(currentYear + 1);
  }
  
  return nextBirthday;
}

// Sort by upcoming
function brSortByUpcoming(birthdays) {
  return birthdays.sort((a, b) => {
    const nextA = brGetNextBirthday(new Date(a.date));
    const nextB = brGetNextBirthday(new Date(b.date));
    return brCurrentSort === 'asc' ? nextA - nextB : nextB - nextA;
  });
}

// Toggle sort
function brToggleSort() {
  brCurrentSort = brCurrentSort === 'asc' ? 'desc' : 'asc';
  const sortBtn = document.getElementById('br-sort-btn');
  sortBtn.textContent = brCurrentSort === 'asc' ? 'ğŸ”¼ Soonest First' : 'ğŸ”½ Latest First';
  brRenderBirthdays();
  brShowNotification(`Sorted ${brCurrentSort === 'asc' ? 'soonest first' : 'latest first'}`, 'info');
}

// Filter birthdays
function brFilterBirthdays() {
  const searchTerm = document.getElementById('br-search').value.toLowerCase();
  const filterValue = document.getElementById('br-filter').value;
  const today = new Date();
  
  const cards = document.querySelectorAll('#br-list .br-birthday-card');
  let visibleCount = 0;
  
  cards.forEach(card => {
    const id = card.dataset.id;
    const birthday = brBirthdays.find(b => b.id === id);
    const name = birthday.name.toLowerCase();
    
    let shouldShow = true;
    
    // Search filter
    if (searchTerm && !name.includes(searchTerm)) {
      shouldShow = false;
    }
    
    // Category filter
    if (shouldShow && filterValue !== 'all') {
      const nextBirthday = brGetNextBirthday(new Date(birthday.date));
      const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
      const birthMonth = new Date(birthday.date).getMonth();
      const currentMonth = today.getMonth();
      
      switch(filterValue) {
        case 'upcoming':
          shouldShow = daysUntil >= 0 && daysUntil <= 30;
          break;
        case 'past':
          shouldShow = daysUntil < 0;
          break;
        case 'this-month':
          shouldShow = birthMonth === currentMonth;
          break;
        case 'next-month':
          const nextMonth = (currentMonth + 1) % 12;
          shouldShow = birthMonth === nextMonth;
          break;
      }
    }
    
    card.style.display = shouldShow ? 'block' : 'none';
    if (shouldShow) visibleCount++;
  });
  
  document.getElementById('br-upcoming-count').textContent = visibleCount;
}

// Delete birthday
function brDeleteBirthday(id) {
  if (confirm('Remove this birthday?')) {
    brBirthdays = brBirthdays.filter(b => b.id !== id);
    brSaveBirthdays();
    brRenderBirthdays();
    brShowNotification('Birthday removed', 'info');
  }
}

// Copy list to clipboard
function brCopyList() {
  if (brBirthdays.length === 0) {
    brShowNotification('No birthdays to copy', 'error');
    return;
  }
  
  let textToCopy = 'ğŸ‚ BIRTHDAY LIST ğŸ‚\n\n';
  const today = new Date();
  const sorted = brSortByUpcoming([...brBirthdays]);
  
  sorted.forEach((b, index) => {
    const nextBirthday = brGetNextBirthday(new Date(b.date));
    const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
    const formattedDate = new Date(b.date).toLocaleDateString('en-US', { 
      month: 'long', 
      day: 'numeric'
    });
    
    const age = nextBirthday.getFullYear() - new Date(b.date).getFullYear();
    
    let status = '';
    if (daysUntil === 0) status = 'ğŸ TODAY!';
    else if (daysUntil === 1) status = 'ğŸ“… Tomorrow';
    else if (daysUntil <= 7) status = `ğŸ“… In ${daysUntil} days`;
    else status = `ğŸ“… In ${daysUntil} days`;
    
    textToCopy += `${index + 1}. ${b.name}\n`;
    textToCopy += `   Date: ${formattedDate}\n`;
    textToCopy += `   Next: ${nextBirthday.getFullYear()} (age ${age})\n`;
    textToCopy += `   Status: ${status}\n`;
    if (b.notes) textToCopy += `   Notes: ${b.notes}\n`;
    textToCopy += '\n';
  });
  
  textToCopy += `\nTotal: ${brBirthdays.length} birthdays`;
  
  navigator.clipboard.writeText(textToCopy).then(() => {
    brShowNotification('Birthday list copied!', 'success');
  }).catch(err => {
    const textArea = document.createElement('textarea');
    textArea.value = textToCopy;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    brShowNotification('Birthday list copied!', 'success');
  });
}

// Reset all
function brResetAll() {
  if (brBirthdays.length === 0) {
    brShowNotification('No birthdays to reset', 'info');
    return;
  }
  
  if (confirm('Clear ALL birthdays? This cannot be undone.')) {
    brBirthdays = [];
    localStorage.removeItem('brBirthdays');
    brRenderBirthdays();
    brShowNotification('All birthdays cleared', 'info');
  }
}

// Show notification
function brShowNotification(message, type) {
  const notification = document.getElementById('br-notification');
  
  // Set style based on type
  const colors = {
    success: '#39ff14',
    error: '#ff4d4d',
    info: '#2dd4ff'
  };
  
  notification.textContent = message;
  notification.style.background = colors[type] || '#2dd4ff';
  notification.style.color = '#000';
  notification.style.border = `1px solid ${colors[type] || '#2dd4ff'}`;
  notification.style.boxShadow = `0 4px 15px rgba(${parseInt(colors[type]?.slice(1,3) || '45')}, ${parseInt(colors[type]?.slice(3,5) || '212')}, ${parseInt(colors[type]?.slice(5,7) || '255')}, 0.3)`;
  
  // Show with animation
  notification.style.display = 'block';
  notification.style.animation = 'br-slideIn 0.3s ease';
  
  // Auto-hide after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'br-slideIn 0.3s ease reverse';
    setTimeout(() => {
      notification.style.display = 'none';
    }, 300);
  }, 3000);
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', brInit);
} else {
  setTimeout(brInit, 100);
}
</script>
