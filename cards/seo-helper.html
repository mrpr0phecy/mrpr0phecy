<h2 id="seo-helper-title">üîç SEO & Content Optimizer</h2>

<form aria-describedby="seo-helper-desc">
  <p id="seo-helper-desc" class="small">
    Professional SEO analysis, optimization, and content planning.
    <span style="color:var(--accent)">Get actionable insights and comprehensive reports.</span>
  </p>
  
  <!-- Input Section -->
  <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(45,212,255,0.1);">
    <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:16px;">üìù Content & Target Analysis</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="sh-content" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Page HTML or Content
        </label>
        <textarea id="sh-content" rows="10" placeholder="Paste your page HTML, article text, or content‚Ä¶" 
                  style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;resize:vertical;font-family:'Courier New', monospace;"></textarea>
      </div>
      
      <div class="field">
        <label for="sh-keywords" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Target Keywords (comma‚Äëseparated)
        </label>
        <input id="sh-keywords" type="text" placeholder="e.g. sonic speedrun, modding tools, gaming tutorial" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;margin-bottom:12px;" />
        
        <label for="sh-competitors" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Competitor URLs (optional)
        </label>
        <textarea id="sh-competitors" rows="2" placeholder="Enter competitor URLs, one per line‚Ä¶" 
                  style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;resize:vertical;margin-bottom:12px;"></textarea>
        
        <label for="sh-url" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Canonical URL
        </label>
        <input id="sh-url" type="url" placeholder="https://example.com/page" 
               style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sh-platform" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Primary Platform
        </label>
        <select id="sh-platform" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="youtube">YouTube</option>
          <option value="twitch">Twitch</option>
          <option value="tiktok">TikTok</option>
          <option value="website">Website/Blog</option>
          <option value="twitter">Twitter/X</option>
          <option value="instagram">Instagram</option>
          <option value="none" selected>General SEO</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sh-content-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Content Type
        </label>
        <select id="sh-content-type" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="blog">Blog Post/Article</option>
          <option value="product">Product Page</option>
          <option value="landing">Landing Page</option>
          <option value="video">Video Content</option>
          <option value="tutorial">Tutorial/Guide</option>
          <option value="news">News/Update</option>
          <option value="review">Review/Analysis</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sh-geo-target" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Geographic Target
        </label>
        <select id="sh-geo-target" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="global" selected>Global</option>
          <option value="us">United States</option>
          <option value="uk">United Kingdom</option>
          <option value="eu">European Union</option>
          <option value="asia">Asia</option>
          <option value="custom">Custom Region</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Advanced Options -->
  <div style="background:rgba(57,255,20,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(57,255,20,0.1);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h3 style="color:#39ff14;margin:0;font-size:16px;">‚ö° Advanced Optimization Settings</h3>
      <label style="display:flex;align-items:center;gap:8px;font-size:14px;color:var(--muted);">
        <input type="checkbox" id="sh-show-advanced" style="accent-color:#39ff14;">
        Show Advanced Options
      </label>
    </div>
    
    <div id="sh-advanced-options" style="display:none;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div class="field">
        <label for="sh-keyword-difficulty" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          Keyword Difficulty
        </label>
        <select id="sh-keyword-difficulty" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
          <option value="low">Low (Easy to Rank)</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High (Competitive)</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sh-target-ranking" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          Target Ranking
        </label>
        <select id="sh-target-ranking" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
          <option value="top3">Top 3 Results</option>
          <option value="top10" selected>Top 10 Results</option>
          <option value="top50">Top 50 Results</option>
        </select>
      </div>
      
      <div class="field">
        <label for="sh-budget-level" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          Budget Level
        </label>
        <select id="sh-budget-level" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
          <option value="low">Low Budget</option>
          <option value="medium" selected>Medium Budget</option>
          <option value="high">High Budget</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;flex-wrap:wrap;">
    <button type="button" onclick="shAnalyze(this)" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;min-width:200px;">
      üîç Full SEO Analysis
    </button>
    <button type="button" onclick="shGenerateMeta(this)"
            style="padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      üè∑Ô∏è Generate Meta Tags
    </button>
    <button type="button" onclick="shCreatorTitles(this)"
            style="padding:14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;">
      üé¨ Creator Titles
    </button>
    <button type="button" onclick="shReset(this)"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
      üîÑ Reset
    </button>
  </div>
</form>

<!-- Results -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <!-- Score Dashboard -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:20px;margin-bottom:20px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:16px;display:flex;align-items:center;gap:8px;">
      üìä SEO Performance Dashboard
    </h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;margin-bottom:20px;">
      <div style="background:rgba(45,212,255,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(45,212,255,0.2);">
        <div id="sh-overall-score" style="font-size:24px;color:#2dd4ff;font-weight:600;">‚Äì</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Overall Score</div>
      </div>
      <div style="background:rgba(57,255,20,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(57,255,20,0.2);">
        <div id="sh-readability" style="font-size:24px;color:#39ff14;font-weight:600;">‚Äì</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Readability</div>
      </div>
      <div style="background:rgba(255,204,0,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(255,204,0,0.2);">
        <div id="sh-word-count" style="font-size:24px;color:#ffcc00;font-weight:600;">‚Äì</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Word Count</div>
      </div>
      <div style="background:rgba(255,77,77,0.1);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(255,77,77,0.2);">
        <div id="sh-keyword-density" style="font-size:24px;color:#ff4d4d;font-weight:600;">‚Äì</div>
        <div style="font-size:12px;color:rgba(230,250,255,0.7);">Keyword Density</div>
      </div>
    </div>
    
    <!-- Progress Bars -->
    <div style="margin-top:16px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <div style="font-size:12px;color:#2dd4ff;">Technical SEO</div>
        <div id="sh-tech-score" style="font-size:12px;color:rgba(230,250,255,0.7);">0%</div>
      </div>
      <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:16px;">
        <div id="sh-tech-progress" style="height:100%;background:linear-gradient(90deg, #2dd4ff, #39ff14);width:0%;transition:width 0.5s;border-radius:4px;"></div>
      </div>
      
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <div style="font-size:12px;color:#39ff14;">Content Quality</div>
        <div id="sh-content-score" style="font-size:12px;color:rgba(230,250,255,0.7);">0%</div>
      </div>
      <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:16px;">
        <div id="sh-content-progress" style="height:100%;background:linear-gradient(90deg, #39ff14, #ffcc00);width:0%;transition:width 0.5s;border-radius:4px;"></div>
      </div>
      
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <div style="font-size:12px;color:#ffcc00;">User Experience</div>
        <div id="sh-ux-score" style="font-size:12px;color:rgba(230,250,255,0.7);">0%</div>
      </div>
      <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
        <div id="sh-ux-progress" style="height:100%;background:linear-gradient(90deg, #ffcc00, #ff4d4d);width:0%;transition:width 0.5s;border-radius:4px;"></div>
      </div>
    </div>
  </div>

  <!-- Results Grid -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <!-- Findings & Fixes -->
    <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.1);padding:16px;">
      <h4 style="color:var(--accent);margin:0 0 12px 0;font-size:14px;">üîß Actionable Fixes & Recommendations</h4>
      <textarea id="sh-findings" rows="14" placeholder="Run analysis to see recommendations‚Ä¶" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;resize:vertical;font-family:'Courier New', monospace;"></textarea>
      <div style="display:flex;gap:8px;margin-top:12px;">
        <button onclick="shCopyToClipboard('findings')" style="flex:1;padding:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
          üìã Copy Fixes
        </button>
      </div>
    </div>
    
    <!-- Generated Meta & Social Tags -->
    <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(57,255,20,0.1);padding:16px;">
      <h4 style="color:#39ff14;margin:0 0 12px 0;font-size:14px;">üè∑Ô∏è Generated Meta & Social Tags</h4>
      <textarea id="sh-meta" rows="14" placeholder="Generate meta tags to see output‚Ä¶" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;resize:vertical;font-family:'Courier New', monospace;"></textarea>
      <div style="display:flex;gap:8px;margin-top:12px;">
        <button onclick="shCopyToClipboard('meta')" style="flex:1;padding:8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
          üìã Copy Tags
        </button>
      </div>
    </div>
  </div>

  <!-- Creator Content -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,204,0,0.1);padding:16px;margin-bottom:20px;">
    <h4 style="color:#ffcc00;margin:0 0 12px 0;font-size:14px;">üé¨ Creator Content Ideas & Tags</h4>
    <textarea id="sh-creator" rows="12" placeholder="Generate creator content to see output‚Ä¶" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;resize:vertical;font-family:'Courier New', monospace;"></textarea>
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button onclick="shCopyToClipboard('creator')" style="flex:1;padding:8px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-size:12px;">
        üìã Copy Ideas
      </button>
    </div>
  </div>
</div>

<script>
/* seo-helper.html
   - Professional SEO analysis and optimization tool
   - Scoped with sh- prefix (SEO Helper)
   - Works within the card system
*/

// Database for SEO analysis
const shDatabase = {
  platforms: {
    'youtube': { name: 'YouTube', idealTitleLength: 50, idealDescriptionLength: 5000 },
    'twitch': { name: 'Twitch', idealTitleLength: 60, idealDescriptionLength: 300 },
    'tiktok': { name: 'TikTok', idealTitleLength: 100, idealDescriptionLength: 150 },
    'website': { name: 'Website/Blog', idealTitleLength: 60, idealDescriptionLength: 160 },
    'twitter': { name: 'Twitter/X', idealTitleLength: 280, idealDescriptionLength: 280 },
    'instagram': { name: 'Instagram', idealTitleLength: 125, idealDescriptionLength: 2200 },
    'none': { name: 'General SEO', idealTitleLength: 60, idealDescriptionLength: 160 }
  },
  
  contentTypes: {
    'blog': { idealWordCount: 1500 },
    'product': { idealWordCount: 800 },
    'landing': { idealWordCount: 500 },
    'video': { idealWordCount: 300 },
    'tutorial': { idealWordCount: 2000 },
    'news': { idealWordCount: 600 },
    'review': { idealWordCount: 1200 }
  }
};

// Initialize on load
function shInitialize() {
    const card = document.currentScript?.closest('.card');
    if (!card) return;
    
    // Advanced options toggle
    const toggle = card.querySelector('#sh-show-advanced');
    const advanced = card.querySelector('#sh-advanced-options');
    if (toggle && advanced) {
        toggle.addEventListener('change', function() {
            advanced.style.display = this.checked ? 'grid' : 'none';
        });
    }
    
    // Add demo content for testing
    const contentInput = card.querySelector('#sh-content');
    if (contentInput && !contentInput.value) {
        contentInput.value = `<html>
<head>
  <title>Ultimate Guide to Speedrunning Games in 2024</title>
  <meta name="description" content="Learn how to master speedruns with our comprehensive guide. Tips, tricks, and strategies for beating records.">
</head>
<body>
  <h1>Mastering Speedruns in 2024</h1>
  <h2>Getting Started with Speedrunning</h2>
  <p>Speedrunning requires precision, knowledge, and practice. This guide covers everything from basic movement to advanced glitches.</p>
  <h2>Essential Techniques</h2>
  <p>Learn the core techniques that every speedrunner needs to know.</p>
  <img src="speedrun.jpg" alt="Speedrunning gameplay">
  <h2>Advanced Strategies</h2>
  <p>Take your speedruns to the next level with these pro strategies.</p>
</body>
</html>`;
        
        card.querySelector('#sh-keywords').value = 'speedrun, gaming tutorial, guide';
        card.querySelector('#sh-url').value = 'https://gamingguides.com/speedrun-2024';
    }
    
    console.log('SEO Helper initialized');
}

// Reset function - FIXED to use .card reference
function shReset(btn) {
    const card = btn.closest('.card');
    const form = card.querySelector('form');
    form.reset();
    
    // Reset advanced options
    const advanced = card.querySelector('#sh-advanced-options');
    if (advanced) advanced.style.display = 'none';
    
    // Clear all output fields
    const outputs = [
        '#sh-overall-score',
        '#sh-readability',
        '#sh-word-count',
        '#sh-keyword-density',
        '#sh-tech-score',
        '#sh-content-score',
        '#sh-ux-score',
        '#sh-findings',
        '#sh-meta',
        '#sh-creator'
    ];
    
    outputs.forEach(selector => {
        const el = card.querySelector(selector);
        if (!el) return;
        
        if (el.tagName === 'TEXTAREA') {
            el.value = '';
        } else if (el.tagName === 'DIV' || el.tagName === 'SPAN') {
            el.textContent = '‚Äì';
        }
    });
    
    // Reset progress bars
    ['#sh-tech-progress', '#sh-content-progress', '#sh-ux-progress'].forEach(selector => {
        const bar = card.querySelector(selector);
        if (bar) bar.style.width = '0%';
    });
    
    shShowNotification(card, '‚úÖ All fields reset successfully', '#39ff14');
}

// Main analysis function - FIXED to use .card reference
function shAnalyze(btn) {
    const card = btn.closest('.card');
    const input = card.querySelector('#sh-content').value.trim();
    const targetStr = card.querySelector('#sh-keywords').value.trim();
    const platform = card.querySelector('#sh-platform').value;
    const contentType = card.querySelector('#sh-content-type').value;
    
    if (!input) {
        shShowNotification(card, '‚ùå Please paste content first', '#ff4d4d');
        return;
    }
    
    const targets = targetStr.split(",").map(s => s.trim()).filter(Boolean);
    const analysis = shAnalyzeContent(input, targets, platform, contentType);
    
    // Update dashboard
    card.querySelector('#sh-overall-score').textContent = analysis.score;
    card.querySelector('#sh-readability').textContent = analysis.readability;
    card.querySelector('#sh-word-count').textContent = analysis.wordCount;
    
    // Calculate average keyword density
    const avgDensity = analysis.keywords.length > 0
        ? (analysis.keywords.reduce((sum, k) => sum + k.density, 0) / analysis.keywords.length).toFixed(1)
        : 0;
    card.querySelector('#sh-keyword-density').textContent = avgDensity + '%';
    
    // Update progress bars
    const techProgress = card.querySelector('#sh-tech-progress');
    const contentProgress = card.querySelector('#sh-content-progress');
    const uxProgress = card.querySelector('#sh-ux-progress');
    
    techProgress.style.width = analysis.technicalScore + '%';
    contentProgress.style.width = analysis.contentScore + '%';
    uxProgress.style.width = analysis.uxScore + '%';
    
    card.querySelector('#sh-tech-score').textContent = analysis.technicalScore + '%';
    card.querySelector('#sh-content-score').textContent = analysis.contentScore + '%';
    card.querySelector('#sh-ux-score').textContent = analysis.uxScore + '%';
    
    // Generate findings
    const findings = shGenerateFindings(analysis, platform, contentType);
    card.querySelector('#sh-findings').value = findings;
    
    shShowNotification(card, `‚úÖ Analysis complete! Score: ${analysis.score}/100`, '#39ff14');
}

// Content analysis function
function shAnalyzeContent(input, targets, platform, contentType) {
    // Parse HTML content
    const parser = new DOMParser();
    const doc = parser.parseFromString(input, 'text/html');
    
    // Extract data
    const title = doc.querySelector('title')?.textContent || '';
    const description = doc.querySelector('meta[name="description"]')?.getAttribute('content') || '';
    const h1s = Array.from(doc.querySelectorAll('h1')).map(h => h.textContent);
    const h2s = Array.from(doc.querySelectorAll('h2')).map(h => h.textContent);
    const paragraphs = Array.from(doc.querySelectorAll('p')).map(p => p.textContent);
    const images = Array.from(doc.querySelectorAll('img'));
    
    // Text analysis
    const fullText = doc.body.textContent || input;
    const wordCount = fullText.trim().split(/\s+/).length;
    const sentences = fullText.split(/[.!?]+/).filter(s => s.trim()).length;
    const readability = Math.min(100, Math.max(0, 206.835 - 1.015 * (wordCount / sentences) - 84.6 * (countSyllables(fullText) / wordCount)));
    
    // Keyword analysis
    const keywords = targets.map(keyword => {
        const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
        const count = (fullText.match(regex) || []).length;
        const density = wordCount > 0 ? ((count / wordCount) * 100).toFixed(2) : 0;
        return { keyword, count, density: parseFloat(density) };
    });
    
    // Validation scores
    const titleLength = title.length;
    const descLength = description.length;
    const platformData = shDatabase.platforms[platform] || shDatabase.platforms.none;
    const contentTypeData = shDatabase.contentTypes[contentType] || shDatabase.contentTypes.blog;
    
    const titleScore = Math.max(0, 100 - Math.abs(titleLength - platformData.idealTitleLength));
    const descScore = Math.max(0, 100 - Math.abs(descLength - platformData.idealDescriptionLength) * 0.5);
    const h1Score = h1s.length === 1 ? 100 : h1s.length === 0 ? 0 : 50;
    const imageAltScore = images.length > 0 
        ? (images.filter(img => img.alt).length / images.length * 100) 
        : 100;
    
    // Calculate scores
    const technicalScore = Math.round((titleScore + descScore + h1Score) / 3);
    const contentScore = Math.round((readability + (keywords.filter(k => k.count > 0).length / targets.length * 100)) / 2);
    const uxScore = Math.round(imageAltScore);
    
    // Overall score
    const overallScore = Math.round((technicalScore * 0.4) + (contentScore * 0.4) + (uxScore * 0.2));
    
    return {
        score: overallScore,
        readability: Math.round(readability),
        wordCount,
        technicalScore,
        contentScore,
        uxScore,
        title,
        description,
        titleLength,
        descLength,
        h1Count: h1s.length,
        h2Count: h2s.length,
        imageCount: images.length,
        imagesMissingAlt: images.filter(img => !img.alt).length,
        keywords,
        fullText,
        platformData,
        contentTypeData
    };
}

// Helper function to count syllables
function countSyllables(text) {
    const words = text.toLowerCase().split(/\s+/);
    let syllableCount = 0;
    
    words.forEach(word => {
        word = word.replace(/[^a-z]/g, '');
        if (word.length <= 3) {
            syllableCount += 1;
            return;
        }
        
        const vowelGroups = word.match(/[aeiouy]+/g);
        syllableCount += vowelGroups ? vowelGroups.length : 1;
    });
    
    return syllableCount;
}

// Generate findings report
function shGenerateFindings(analysis, platform, contentType) {
    const platformData = shDatabase.platforms[platform];
    const contentTypeData = shDatabase.contentTypes[contentType];
    
    let findings = `üìä SEO ANALYSIS REPORT\n`;
    findings += `Platform: ${platformData.name}\n`;
    findings += `Content Type: ${contentTypeData.name}\n`;
    findings += `Overall Score: ${analysis.score}/100\n\n`;
    
    findings += `üîß PRIORITY FIXES:\n`;
    
    if (analysis.titleLength === 0) {
        findings += `‚Ä¢ [HIGH] Add a title tag\n`;
    } else if (Math.abs(analysis.titleLength - platformData.idealTitleLength) > 10) {
        findings += `‚Ä¢ [MEDIUM] Optimize title length (${analysis.titleLength} chars, ideal: ${platformData.idealTitleLength})\n`;
    }
    
    if (analysis.descLength === 0) {
        findings += `‚Ä¢ [HIGH] Add a meta description\n`;
    } else if (Math.abs(analysis.descLength - platformData.idealDescriptionLength) > 20) {
        findings += `‚Ä¢ [MEDIUM] Optimize description length (${analysis.descLength} chars, ideal: ${platformData.idealDescriptionLength})\n`;
    }
    
    if (analysis.h1Count !== 1) {
        findings += `‚Ä¢ [HIGH] Use exactly one H1 tag (currently: ${analysis.h1Count})\n`;
    }
    
    if (analysis.imagesMissingAlt > 0) {
        findings += `‚Ä¢ [MEDIUM] Add alt text to ${analysis.imagesMissingAlt} image(s)\n`;
    }
    
    const wordDiff = analysis.wordCount - contentTypeData.idealWordCount;
    if (wordDiff < -200) {
        findings += `‚Ä¢ [LOW] Consider adding more content (${analysis.wordCount} words, ideal: ${contentTypeData.idealWordCount}+)\n`;
    }
    
    if (analysis.readability < 50) {
        findings += `‚Ä¢ [LOW] Improve readability (score: ${analysis.readability}/100, aim for 50+)\n`;
    }
    
    findings += `\nüéØ KEYWORD ANALYSIS:\n`;
    analysis.keywords.forEach(k => {
        const status = k.count > 0 ? '‚úì' : '‚úó';
        findings += `‚Ä¢ ${status} "${k.keyword}": ${k.count} mentions (${k.density}% density)\n`;
    });
    
    findings += `\nüìà RECOMMENDATIONS:\n`;
    findings += `‚Ä¢ Optimize for ${platformData.name} platform\n`;
    findings += `‚Ä¢ Follow ${contentTypeData.name} best practices\n`;
    findings += `‚Ä¢ Focus on improving ${analysis.score < 70 ? 'technical SEO' : 'content quality'}\n`;
    
    return findings;
}

// Generate meta tags - FIXED to use .card reference
function shGenerateMeta(btn) {
    const card = btn.closest('.card');
    const input = card.querySelector('#sh-content').value.trim();
    const platform = card.querySelector('#sh-platform').value;
    const url = card.querySelector('#sh-url').value.trim();
    
    if (!input) {
        shShowNotification(card, '‚ùå Please paste content first', '#ff4d4d');
        return;
    }
    
    // Parse HTML for title and description
    const parser = new DOMParser();
    const doc = parser.parseFromString(input, 'text/html');
    const title = doc.querySelector('title')?.textContent || 'Your Page Title';
    const description = doc.querySelector('meta[name="description"]')?.getAttribute('content') || 'Your page description';
    
    const metaTags = shGenerateMetaTags(title, description, url, platform);
    card.querySelector('#sh-meta').value = metaTags;
    
    shShowNotification(card, '‚úÖ Generated meta tags', '#39ff14');
}

// Generate meta tags HTML
function shGenerateMetaTags(title, description, url, platform) {
    const platformData = shDatabase.platforms[platform];
    
    let meta = `<!-- ${platformData.name} Optimized Meta Tags -->\n\n`;
    meta += `<title>${escapeHTML(title)}</title>\n`;
    meta += `<meta name="description" content="${escapeHTML(description)}">\n`;
    meta += `<meta name="robots" content="index, follow">\n\n`;
    
    meta += `<!-- Open Graph -->\n`;
    meta += `<meta property="og:title" content="${escapeHTML(title)}">\n`;
    meta += `<meta property="og:description" content="${escapeHTML(description)}">\n`;
    if (url) meta += `<meta property="og:url" content="${escapeAttr(url)}">\n`;
    meta += `<meta property="og:type" content="website">\n\n`;
    
    meta += `<!-- Twitter Card -->\n`;
    meta += `<meta name="twitter:card" content="summary_large_image">\n`;
    meta += `<meta name="twitter:title" content="${escapeHTML(title)}">\n`;
    meta += `<meta name="twitter:description" content="${escapeHTML(description)}">\n\n`;
    
    if (url) meta += `<link rel="canonical" href="${escapeAttr(url)}">\n`;
    
    return meta;
}

// Generate creator titles - FIXED to use .card reference
function shCreatorTitles(btn) {
    const card = btn.closest('.card');
    const platform = card.querySelector('#sh-platform').value;
    const input = card.querySelector('#sh-content').value.trim();
    
    // Try to extract a title from the content
    const parser = new DOMParser();
    const doc = parser.parseFromString(input, 'text/html');
    const title = doc.querySelector('title')?.textContent || 
                  doc.querySelector('h1')?.textContent ||
                  card.querySelector('#sh-keywords').value.split(",")[0]?.trim() ||
                  "Your Content";
    
    if (!title) {
        shShowNotification(card, '‚ùå Provide content or keywords first', '#ff4d4d');
        return;
    }
    
    const titles = shGenerateTitles(title, platform);
    card.querySelector('#sh-creator').value = titles;
    
    shShowNotification(card, '‚úÖ Generated content ideas', '#ffcc00');
}

// Generate creative titles
function shGenerateTitles(baseTitle, platform) {
    const platformData = shDatabase.platforms[platform];
    const base = baseTitle.trim();
    
    let output = `üéØ Platform: ${platformData.name}\n`;
    output += `üìù Based on: ${base}\n\n`;
    output += "üèÜ Top Title Suggestions:\n";
    
    const templates = [
        `How to MASTER ${base} in 2024 (Complete Guide)`,
        `${base} Explained: Everything You Need to Know`,
        `The ULTIMATE ${base} Tutorial for Beginners`,
        `${base} SECRETS Revealed - Pro Tips & Tricks`,
        `Why ${base} is CHANGING Everything in 2024`
    ];
    
    if (platform === 'tiktok' || platform === 'instagram') {
        output += `1. ${base} in 60 seconds! ‚è±Ô∏è\n`;
        output += `2. This ${base} hack will save you HOURS üî•\n`;
        output += `3. You won't believe this ${base} trick!\n`;
        output += `4. How I mastered ${base} FAST üí®\n`;
        output += `5. ${base} made simple! #shorts\n`;
    } else {
        templates.forEach((template, i) => {
            output += `${i + 1}. ${template}\n`;
        });
    }
    
    output += `\nüî• Recommended Hashtags:\n`;
    const keywords = base.toLowerCase().split(/\s+/).filter(w => w.length > 3);
    const hashtags = [...keywords, 'tutorial', 'guide', 'howto', 'tips', '2024'].slice(0, 8);
    output += hashtags.map(tag => `#${tag}`).join(' ');
    
    output += `\n\nüìä Platform Guidelines:\n`;
    output += `‚Ä¢ Ideal title length: ${platformData.idealTitleLength} characters\n`;
    output += `‚Ä¢ Ideal description: ${platformData.idealDescriptionLength} characters\n`;
    
    return output;
}

// Copy to clipboard helper - FIXED to use .card reference
function shCopyToClipboard(type) {
    const btn = event.target;
    const card = btn.closest('.card');
    let selector;
    
    switch(type) {
        case 'findings': selector = '#sh-findings'; break;
        case 'meta': selector = '#sh-meta'; break;
        case 'creator': selector = '#sh-creator'; break;
        default: return;
    }
    
    const element = card.querySelector(selector);
    if (!element || !element.value) {
        shShowNotification(card, '‚ùå Nothing to copy', '#ff4d4d');
        return;
    }
    
    element.select();
    navigator.clipboard.writeText(element.value)
        .then(() => shShowNotification(card, '‚úÖ Copied to clipboard', '#39ff14'))
        .catch(() => {
            // Fallback
            document.execCommand('copy');
            shShowNotification(card, '‚úÖ Copied (fallback)', '#39ff14');
        });
}

// Show notification helper
function shShowNotification(card, message, color) {
    // Create notification element
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: absolute;
        top: 10px;
        right: 10px;
        background: ${color};
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        z-index: 1000;
        animation: fadeInOut 3s ease-in-out;
    `;
    
    // Add CSS animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
    `;
    card.appendChild(style);
    
    card.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
        style.remove();
    }, 3000);
}

// HTML escaping helpers
function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function escapeAttr(text) {
    return text.replace(/"/g, '&quot;');
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const script = document.currentScript;
        if (script) {
            setTimeout(() => shInitialize(), 100);
        }
    });
} else {
    setTimeout(() => shInitialize(), 100);
}
</script>

<style>
/* Card-specific styles */
#seo-helper-title {
    color: var(--accent);
    margin-top: 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .results > div:first-child {
        grid-template-columns: 1fr !important;
        gap: 8px;
    }
    
    /* Stack inputs vertically on mobile */
    .input-grid {
        grid-template-columns: 1fr !important;
    }
    
    /* Adjust button layout */
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    /* Adjust dashboard on mobile */
    .score-dashboard > div {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* Focus styles for better accessibility */
input:focus, select:focus, button:focus, textarea:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Animation for results */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.results > div {
    animation: fadeIn 0.3s ease-out;
}

/* Smooth transitions */
button, input, select, textarea {
    transition: all 0.2s ease;
}

button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Custom checkbox styling */
input[type="checkbox"] {
    accent-color: var(--accent);
}

/* Textarea styling */
textarea {
    resize: vertical;
    scrollbar-width: thin;
    scrollbar-color: rgba(45,212,255,0.3) transparent;
}

textarea::-webkit-scrollbar {
    width: 8px;
}

textarea::-webkit-scrollbar-track {
    background: transparent;
}

textarea::-webkit-scrollbar-thumb {
    background-color: rgba(45,212,255,0.3);
    border-radius: 4px;
}
</style>
