<!-- File: cards/probability-calculator.html -->
<h2 id="pc-title">üé≤ Probability Calculator</h2>
<p id="pc-desc" class="small">Calculate probabilities for dice, cards, distributions, and real-world scenarios. <em>For academic and professional statistics work, consider quality tools from our <a href="/affiliates">trusted partners</a>.</em></p>

<!-- CALCULATION TYPE SELECTOR -->
<form aria-labelledby="pc-title">
    <div class="input-group-compact" style="margin-bottom:12px;">
        <label for="pc-mode">Calculation Type</label>
        <select id="pc-mode" onchange="pcUpdateInputs()" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
            <option value="simple">Simple Probability</option>
            <option value="dice">Dice Probability</option>
            <option value="cards">Card Probability</option>
            <option value="binomial">Binomial Distribution</option>
            <option value="normal">Normal Distribution</option>
            <option value="conditional">Conditional Probability</option>
            <option value="permutations">Permutations & Combinations</option>
        </select>
    </div>

    <!-- DYNAMIC INPUT AREA -->
    <div id="pc-inputs" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-bottom:12px;">
        <!-- Simple Probability Default -->
        <div class="input-group">
            <label for="pc-favorable">Favorable Outcomes</label>
            <input id="pc-favorable" type="number" min="0" placeholder="e.g., 3" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            <div class="input-note" style="font-size:11px;color:rgba(230,250,255,0.6);">Number of successful outcomes</div>
        </div>
        <div class="input-group">
            <label for="pc-total">Total Outcomes</label>
            <input id="pc-total" type="number" min="1" placeholder="e.g., 6" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            <div class="input-note" style="font-size:11px;color:rgba(230,250,255,0.6);">Total possible outcomes</div>
        </div>
    </div>

    <!-- AFFILIATE DISCLOSURE (Hidden by default) -->
    <div class="affiliate-disclosure" style="display:none;border-left:3px solid #9d4edd;padding-left:10px;margin:12px 0;font-size:12px;" id="pc-affiliate">
        <small>üí° For advanced statistical analysis and academic research, professionals use <a href="#affiliate-stats-software" target="_blank" rel="sponsored nofollow">specialized statistics software</a> with hypothesis testing and data visualization.</small>
    </div>

    <!-- QUICK EXAMPLES -->
    <div style="margin-bottom:12px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.1);">
        <div style="color:var(--accent);font-weight:500;margin-bottom:6px;font-size:13px;">Quick Examples:</div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;">
            <button type="button" onclick="pcLoadExample('coin')" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;transition:all 0.2s;">Coin Flip</button>
            <button type="button" onclick="pcLoadExample('dice6')" style="padding:4px 8px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:4px;color:#9d4edd;cursor:pointer;font-size:11px;transition:all 0.2s;">Rolling a 6</button>
            <button type="button" onclick="pcLoadExample('poker')" style="padding:4px 8px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:4px;color:#ff4d4d;cursor:pointer;font-size:11px;transition:all 0.2s;">Poker Hand</button>
            <button type="button" onclick="pcLoadExample('lottery')" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:11px;transition:all 0.2s;">Lottery Odds</button>
        </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="actions-compact" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="pcCalculate()" style="flex:1;min-width:120px;padding:8px;background:linear-gradient(135deg,rgba(157,78,221,0.2),rgba(157,78,221,0.1));border:1px solid rgba(157,78,221,0.4);border-radius:6px;color:#9d4edd;cursor:pointer;font-weight:600;transition:all 0.2s;font-size:13px;">Calculate Probability</button>
        <button type="button" onclick="pcReset()" style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;transition:all 0.2s;flex-shrink:0;font-size:13px;">Reset</button>
        <button type="button" onclick="pcShare()" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;transition:all 0.2s;flex-shrink:0;font-size:13px;">Share</button>
    </div>
</form>

<!-- RESULTS DISPLAY -->
<div class="results" style="margin-top:12px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:6px;font-size:14px;">üìä Probability Results</h3>
    
    <div id="pc-output" style="padding:12px;background:linear-gradient(135deg,rgba(157,78,221,0.05),rgba(45,212,255,0.05));border-radius:8px;border:1px solid rgba(157,78,221,0.2);min-height:120px;">
        <div style="text-align:center;color:rgba(230,250,255,0.6);padding:20px;">
            <div style="font-size:32px;margin-bottom:8px;">üé≤</div>
            <h3 style="color:var(--accent);margin-bottom:6px;font-size:16px;">Ready to Calculate</h3>
            <p style="font-size:13px;">Select a scenario and enter values.</p>
        </div>
    </div>

    <!-- DETAILED RESULTS GRID -->
    <div id="pc-results-grid" style="display:none;margin-top:12px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;">
            <div style="padding:8px;background:rgba(157,78,221,0.1);border-radius:6px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:12px;">Probability</div>
                <div id="pc-result-probability" style="font-size:24px;font-weight:700;color:#9d4edd;">‚Äì</div>
            </div>
            <div style="padding:8px;background:rgba(45,212,255,0.1);border-radius:6px;border:1px solid rgba(45,212,255,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:12px;">Percentage</div>
                <div id="pc-result-percentage" style="font-size:24px;font-weight:700;color:var(--accent);">‚Äì</div>
            </div>
            <div style="padding:8px;background:rgba(57,255,20,0.1);border-radius:6px;border:1px solid rgba(57,255,20,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:12px;">Odds</div>
                <div id="pc-result-odds" style="font-size:24px;font-weight:700;color:#39ff14;">‚Äì</div>
            </div>
            <div style="padding:8px;background:rgba(255,165,0,0.1);border-radius:6px;border:1px solid rgba(255,165,0,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:12px;">1 in X</div>
                <div id="pc-result-one-in" style="font-size:24px;font-weight:700;color:#ffa500;">‚Äì</div>
            </div>
        </div>
    </div>
</div>

<!-- EXPORT OPTIONS -->
<div class="export-options" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
    <button onclick="pcExport('png')" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:12px;">Save as PNG</button>
    <button onclick="pcCopy()" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:12px;">Copy Results</button>
    <button onclick="pcEmbed()" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:4px;color:#9d4edd;cursor:pointer;font-size:12px;">Get Embed Code</button>
</div>

<script>
/* Probability Calculator - pc prefix */
const pcModes = {
    simple: {
        name: "Simple Probability",
        inputs: [
            { id: "pc-favorable", label: "Favorable Outcomes", required: true, min: 0 },
            { id: "pc-total", label: "Total Outcomes", required: true, min: 1 }
        ],
        calculate: (favorable, total) => {
            if (favorable > total) throw new Error("Favorable cannot exceed total");
            const probability = favorable / total;
            return {
                probability,
                percentage: probability * 100,
                odds: `${favorable}:${total - favorable}`,
                oneIn: total / favorable,
                details: `P = ${favorable} / ${total} = ${probability.toFixed(6)}`
            };
        }
    },
    dice: {
        name: "Dice Probability",
        inputs: [
            { id: "pc-dice-count", label: "Number of Dice", required: true, min: 1, max: 10, value: 1 },
            { id: "pc-target-sum", label: "Target Sum", required: true, min: 1, max: 60 }
        ],
        calculate: (diceCount, targetSum) => {
            // Simplified dice probability calculation
            const minSum = diceCount;
            const maxSum = diceCount * 6;
            if (targetSum < minSum || targetSum > maxSum) {
                throw new Error(`Sum must be between ${minSum} and ${maxSum} for ${diceCount} dice`);
            }
            
            // Approximate probability using normal approximation for simplicity
            const mean = diceCount * 3.5;
            const variance = diceCount * (35 / 12);
            const stdDev = Math.sqrt(variance);
            const z = (targetSum - mean) / stdDev;
            
            // Simple normal CDF approximation
            const probability = Math.exp(-z * z / 2) / (stdDev * Math.sqrt(2 * Math.PI));
            
            return {
                probability: Math.max(0.000001, Math.min(1, probability)),
                percentage: probability * 100,
                odds: "Varies by sum",
                oneIn: 1 / probability,
                details: `${diceCount} dice ‚Üí Target sum: ${targetSum}\nMean: ${mean.toFixed(2)}, Std Dev: ${stdDev.toFixed(2)}\nApprox. probability: ${probability.toFixed(6)}`
            };
        }
    },
    binomial: {
        name: "Binomial Distribution",
        inputs: [
            { id: "pc-trials", label: "Trials (n)", required: true, min: 1, value: 10 },
            { id: "pc-successes", label: "Successes (k)", required: true, min: 0 },
            { id: "pc-success-prob", label: "Success Probability (p)", required: true, min: 0, max: 1, step: 0.01, value: 0.5 }
        ],
        calculate: (trials, successes, successProb) => {
            if (successes > trials) throw new Error("Successes cannot exceed trials");
            
            // Binomial coefficient function
            const binom = (n, k) => {
                if (k < 0 || k > n) return 0;
                let coeff = 1;
                for (let i = 1; i <= k; i++) {
                    coeff *= (n - k + i) / i;
                }
                return coeff;
            };
            
            const probability = binom(trials, successes) * 
                               Math.pow(successProb, successes) * 
                               Math.pow(1 - successProb, trials - successes);
            
            return {
                probability,
                percentage: probability * 100,
                odds: `${successes}:${trials - successes}`,
                oneIn: 1 / probability,
                details: `Binomial: C(${trials},${successes}) √ó ${successProb}^${successes} √ó ${(1-successProb).toFixed(3)}^${trials-successes}\n= ${probability.toFixed(6)}`
            };
        }
    }
};

// Update inputs based on selected mode
function pcUpdateInputs() {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    const inputContainer = card.querySelector('#pc-inputs');
    const mode = modeSelect.value;
    const modeConfig = pcModes[mode] || pcModes.simple;
    
    inputContainer.innerHTML = '';
    modeConfig.inputs.forEach(input => {
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = `
            <label for="${input.id}">${input.label}</label>
            <input id="${input.id}" type="number" 
                   ${input.min ? `min="${input.min}"` : ''}
                   ${input.max ? `max="${input.max}"` : ''}
                   ${input.step ? `step="${input.step}"` : 'step="any"'}
                   ${input.value ? `value="${input.value}"` : ''}
                   placeholder="${input.label}"
                   style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            ${input.required ? '<div class="input-note" style="font-size:11px;color:rgba(230,250,255,0.6);">Required</div>' : ''}
        `;
        inputContainer.appendChild(div);
    });
}

// Load example scenarios
function pcLoadExample(example) {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    
    switch(example) {
        case 'coin':
            modeSelect.value = 'simple';
            pcUpdateInputs();
            card.querySelector('#pc-favorable').value = 1;
            card.querySelector('#pc-total').value = 2;
            break;
        case 'dice6':
            modeSelect.value = 'simple';
            pcUpdateInputs();
            card.querySelector('#pc-favorable').value = 1;
            card.querySelector('#pc-total').value = 6;
            break;
        case 'poker':
            modeSelect.value = 'simple';
            pcUpdateInputs();
            card.querySelector('#pc-favorable').value = 4;
            card.querySelector('#pc-total').value = 52;
            break;
        case 'lottery':
            modeSelect.value = 'binomial';
            pcUpdateInputs();
            card.querySelector('#pc-trials').value = 49;
            card.querySelector('#pc-successes').value = 6;
            card.querySelector('#pc-success-prob').value = 0.01;
            break;
    }
    pcCalculate();
}

// Main calculation function
function pcCalculate() {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    const output = card.querySelector('#pc-output');
    const resultsGrid = card.querySelector('#pc-results-grid');
    const affiliateDiv = card.querySelector('#pc-affiliate');
    const mode = modeSelect.value;
    const modeConfig = pcModes[mode] || pcModes.simple;
    
    try {
        // Get input values
        const inputs = [];
        modeConfig.inputs.forEach(input => {
            const element = card.querySelector(`#${input.id}`);
            const value = parseFloat(element.value);
            if (isNaN(value) && input.required) {
                throw new Error(`Please enter a valid number for "${input.label}"`);
            }
            inputs.push(isNaN(value) ? input.value || 0 : value);
        });
        
        // Perform calculation
        const result = modeConfig.calculate(...inputs);
        
        // Display results
        output.innerHTML = `
            <div style="padding:12px;">
                <h3 style="color:var(--accent);margin-top:0;margin-bottom:8px;font-size:16px;">${modeConfig.name} Results</h3>
                <div style="background:rgba(0,0,0,0.2);padding:12px;border-radius:6px;margin-bottom:12px;">
                    <div style="font-size:13px;color:rgba(230,250,255,0.8);line-height:1.5;">${result.details}</div>
                </div>
                <div style="font-size:12px;color:rgba(230,250,255,0.6);">
                    Interpretation: ${result.probability < 0.01 ? 'Very unlikely' : 
                                    result.probability < 0.1 ? 'Unlikely' :
                                    result.probability < 0.5 ? 'Less than even chance' :
                                    result.probability < 0.9 ? 'More than even chance' :
                                    result.probability < 0.99 ? 'Very likely' : 'Almost certain'}
                </div>
            </div>
        `;
        
        // Update results grid
        card.querySelector('#pc-result-probability').textContent = result.probability.toFixed(6);
        card.querySelector('#pc-result-percentage').textContent = result.percentage.toFixed(2) + '%';
        card.querySelector('#pc-result-odds').textContent = result.odds;
        card.querySelector('#pc-result-one-in').textContent = result.oneIn >= 1000000 ? 
            (result.oneIn / 1000000).toFixed(2) + 'M' : 
            result.oneIn >= 1000 ? 
            (result.oneIn / 1000).toFixed(1) + 'K' : 
            result.oneIn.toFixed(1);
        
        resultsGrid.style.display = 'grid';
        
        // Show affiliate disclosure for low-probability results (lottery, rare events)
        if (result.probability < 0.001 || mode === 'binomial') {
            affiliateDiv.style.display = 'block';
        } else {
            affiliateDiv.style.display = 'none';
        }
        
    } catch (error) {
        output.innerHTML = `
            <div style="text-align:center;padding:20px;color:#ff2d55;">
                <div style="font-size:32px;margin-bottom:8px;">‚ö†Ô∏è</div>
                <h3 style="color:#ff2d55;margin-bottom:8px;font-size:16px;">Calculation Error</h3>
                <p style="font-size:13px;">${error.message}</p>
            </div>
        `;
        resultsGrid.style.display = 'none';
        affiliateDiv.style.display = 'none';
    }
}

// Reset function
function pcReset() {
    const card = document.currentScript?.closest('.card') || document;
    card.querySelectorAll('input').forEach(input => input.value = '');
    card.querySelector('#pc-mode').value = 'simple';
    pcUpdateInputs();
    card.querySelector('#pc-output').innerHTML = `
        <div style="text-align:center;color:rgba(230,250,255,0.6);padding:20px;">
            <div style="font-size:32px;margin-bottom:8px;">üé≤</div>
            <h3 style="color:var(--accent);margin-bottom:6px;font-size:16px;">Ready to Calculate</h3>
            <p style="font-size:13px;">Select a scenario and enter values.</p>
        </div>
    `;
    card.querySelector('#pc-results-grid').style.display = 'none';
    card.querySelector('#pc-affiliate').style.display = 'none';
}

// Share function (for virality)
function pcShare() {
    const card = document.currentScript?.closest('.card') || document;
    const modeSelect = card.querySelector('#pc-mode');
    const mode = modeSelect.value;
    
    // Create a shareable URL with current state
    const params = new URLSearchParams();
    params.set('tool', 'probability');
    params.set('mode', mode);
    
    card.querySelectorAll('input').forEach(input => {
        if (input.value) params.set(input.id, input.value);
    });
    
    const shareUrl = `${window.location.origin}?${params.toString()}`;
    const shareText = `Check out this probability calculation on The Most Useful Site!`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Probability Calculator',
            text: shareText,
            url: shareUrl
        });
    } else {
        navigator.clipboard.writeText(`${shareText}\n${shareUrl}`).then(() => {
            alert('Link copied to clipboard! Share it anywhere.');
        });
    }
}

// Export as PNG (simplified version)
function pcExport(format) {
    const card = document.currentScript?.closest('.card') || document;
    const results = card.querySelector('#pc-output').textContent;
    alert(`In a full implementation, this would export the results as ${format.toUpperCase()}.\n\n${results.substring(0, 200)}...`);
}

// Copy results to clipboard
function pcCopy() {
    const card = document.currentScript?.closest('.card') || document;
    const probability = card.querySelector('#pc-result-probability')?.textContent || 'N/A';
    const percentage = card.querySelector('#pc-result-percentage')?.textContent || 'N/A';
    const odds = card.querySelector('#pc-result-odds')?.textContent || 'N/A';
    
    const text = `Probability Results:\nProbability: ${probability}\nPercentage: ${percentage}\nOdds: ${odds}\n\nCalculated on The Most Useful Site`;
    
    navigator.clipboard.writeText(text).then(() => {
        const buttons = card.querySelectorAll('button');
        buttons.forEach(btn => {
            if (btn.textContent.includes('Copy')) {
                const original = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => btn.textContent = original, 2000);
            }
        });
    });
}

// Generate embed code (for SEO backlinks)
function pcEmbed() {
    const embedCode = `<iframe src="https://mostusefulsite.com/cards/probability-calculator.html" width="100%" height="500" style="border:none;border-radius:8px;" title="Probability Calculator"></iframe>`;
    
    navigator.clipboard.writeText(embedCode).then(() => {
        alert('Embed code copied! Paste it into your blog or website.');
    });
}

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        const card = document.currentScript?.closest('.card') || document;
        const modeSelect = card.querySelector('#pc-mode');
        modeSelect.addEventListener('change', pcUpdateInputs);
        pcUpdateInputs();
        console.log('Probability Calculator ready');
    });
}
</script>

<style>
/* Card-specific compact styles */
#pc-title {
    color: #9d4edd;
    margin-top: 0;
    margin-bottom: 8px;
    font-size: 20px;
}

.input-group {
    margin-bottom: 8px;
}

.input-group label {
    display: block;
    margin-bottom: 4px;
    color: var(--accent);
    font-weight: 500;
    font-size: 13px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .actions-compact {
        flex-direction: column;
        gap: 6px;
    }
    
    .actions-compact button {
        width: 100% !important;
        margin: 0 !important;
        min-width: 100% !important;
    }
    
    #pc-results-grid div {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
    }
}

@media (max-width: 480px) {
    #pc-results-grid div {
        grid-template-columns: 1fr !important;
    }
    
    #pc-inputs {
        grid-template-columns: 1fr !important;
    }
}
</style>
