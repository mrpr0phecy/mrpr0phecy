<h2 id="percentage-title" style="margin-top:0;">Percentage Calculator</h2>

<form aria-describedby="percentage-desc">
  <p id="percentage-desc" class="small">Calculate percentages, increases/decreases, or percentage change.</p>

  <div class="row">
    <div class="field">
      <label for="percentage-value">Value</label>
      <input id="percentage-value" type="number" step="any" value="100" />
    </div>
    <div class="field">
      <label for="percentage-rate">Percentage (%)</label>
      <input id="percentage-rate" type="number" step="any" value="20" />
    </div>
  </div>

  <div class="field">
    <label for="percentage-mode">Mode</label>
    <select id="percentage-mode">
      <option value="of" selected>% of value</option>
      <option value="increase">Increase by %</option>
      <option value="decrease">Decrease by %</option>
      <option value="change">Percentage change (vs. new value)</option>
    </select>
  </div>

  <div class="field" id="percentage-newvalue-field" style="display:none;">
    <label for="percentage-newvalue">New value (for % change)</label>
    <input id="percentage-newvalue" type="number" step="any" value="120" />
  </div>

  <div class="actions">
    <button type="button" onclick="percentageCalc(this)">Calculate</button>
    <button type="button" class="secondary" onclick="percentageReset(this)">Reset</button>
  </div>
</form>

<div class="results" aria-live="polite">
  <div class="result">
    <div class="label">Result</div>
    <div class="value" id="percentage-res">–</div>
  </div>
</div>

<script>
function percentageCalc(btn) {
  const card = btn.closest('.card');
  const value = parseFloat(card.querySelector('#percentage-value').value) || 0;
  const rate = parseFloat(card.querySelector('#percentage-rate').value) / 100 || 0;
  const mode = card.querySelector('#percentage-mode').value;
  const newValue = parseFloat(card.querySelector('#percentage-newvalue').value) || 0;

  let result = "–";

  if (mode === "of") {
    result = (value * rate).toFixed(2);
  } else if (mode === "increase") {
    result = (value * (1 + rate)).toFixed(2);
  } else if (mode === "decrease") {
    result = (value * (1 - rate)).toFixed(2);
  } else if (mode === "change") {
    if (value !== 0) {
      result = (((newValue - value) / value) * 100).toFixed(2) + "%";
    } else {
      result = "Invalid base value";
    }
  }

  card.querySelector('#percentage-res').textContent = result;
}

function percentageReset(btn) {
  const card = btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#percentage-res').textContent = '–';
}

// Show/hide new value field depending on mode
document.addEventListener("change", function(e) {
  if (e.target.id === "percentage-mode") {
    const field = document.querySelector('#percentage-newvalue-field');
    field.style.display = (e.target.value === "change") ? "block" : "none";
  }
});
</script>
