<!-- cards/sequences-series-calculator.html -->
<h2 id="sequences-series-calculator-title" style="margin-top:0;color:var(--accent);font-size:1.4rem;margin-bottom:8px;">üî¢ Sequences & Series Calculator</h2>

<form aria-describedby="sequences-series-calculator-desc" style="margin-bottom:20px;">
    <p id="sequences-series-calculator-desc" class="small" style="color:rgba(230,250,255,0.9);margin-bottom:20px;line-height:1.5;">
        <span style="color:var(--accent);font-weight:500;">üéØ Master sequences:</span> Calculate arithmetic, geometric, Fibonacci, and special sequences. Perfect for math students, teachers, and competitive exams.
    </p>
    
    <!-- SEQUENCE TYPE SELECTOR -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px;">
        <button type="button" onclick="ssSetSequenceType('arithmetic')" class="sequence-type-btn active" 
                style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all 0.2s ease;">
            <span style="font-size:20px;">‚ûï</span>
            <span style="font-size:11px;">Arithmetic</span>
        </button>
        <button type="button" onclick="ssSetSequenceType('geometric')" class="sequence-type-btn"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all 0.2s ease;">
            <span style="font-size:20px;">‚úñÔ∏è</span>
            <span style="font-size:11px;">Geometric</span>
        </button>
        <button type="button" onclick="ssSetSequenceType('fibonacci')" class="sequence-type-btn"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all 0.2s ease;">
            <span style="font-size:20px;">üêö</span>
            <span style="font-size:11px;">Fibonacci</span>
        </button>
        <button type="button" onclick="ssSetSequenceType('special')" class="sequence-type-btn"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all 0.2s ease;">
            <span style="font-size:20px;">‚≠ê</span>
            <span style="font-size:11px;">Special</span>
        </button>
    </div>
    
    <!-- QUICK EXAMPLES -->
    <div style="margin-bottom:16px;">
        <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:8px;">üìö Quick Examples:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="ssLoadExample('simpleArithmetic')" class="example-btn" style="padding:6px 10px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:12px;">2, 5, 8, 11...</button>
            <button type="button" onclick="ssLoadExample('simpleGeometric')" class="example-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);color:#ff2d55;cursor:pointer;font-size:12px;">3, 6, 12, 24...</button>
            <button type="button" onclick="ssLoadExample('fibonacciSeq')" class="example-btn" style="padding:6px 10px;border-radius:6px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;cursor:pointer;font-size:12px;">Fibonacci</button>
            <button type="button" onclick="ssLoadExample('triangular')" class="example-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;cursor:pointer;font-size:12px;">Triangular</button>
            <button type="button" onclick="ssLoadExample('square')" class="example-btn" style="padding:6px 10px;border-radius:6px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);color:#9d4edd;cursor:pointer;font-size:12px;">Square</button>
        </div>
    </div>
    
    <!-- MAIN INPUTS -->
    <div id="ss-standard-inputs" style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;">
        <div>
            <label for="ss-first-term" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üî¢</span> First Term (a‚ÇÅ)
            </label>
            <input id="ss-first-term" type="number" step="any" value="2"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;">
        </div>
        
        <div>
            <label for="ss-common-diff" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;" id="ss-diff-label">üìà</span> 
                <span id="ss-diff-text">Common Difference (d)</span>
            </label>
            <input id="ss-common-diff" type="number" step="any" value="3"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;">
        </div>
    </div>
    
    <!-- FIBONACCI INPUTS (Hidden by default) -->
    <div id="ss-fibonacci-inputs" style="display:none;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;">
        <div>
            <label for="ss-fib-first" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üêö</span> First Term (F‚ÇÅ)
            </label>
            <input id="ss-fib-first" type="number" step="any" value="0"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;">
        </div>
        
        <div>
            <label for="ss-fib-second" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üêö</span> Second Term (F‚ÇÇ)
            </label>
            <input id="ss-fib-second" type="number" step="any" value="1"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:15px;">
        </div>
    </div>
    
    <!-- SPECIAL SEQUENCE INPUTS (Hidden by default) -->
    <div id="ss-special-inputs" style="display:none;margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
            <span style="font-size:16px;">‚≠ê</span> Special Sequence
        </label>
        <select id="ss-special-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
            <option value="triangular">Triangular Numbers</option>
            <option value="square">Square Numbers</option>
            <option value="cube">Cube Numbers</option>
            <option value="prime">Prime Numbers</option>
            <option value="factorial">Factorial Sequence</option>
            <option value="harmonic">Harmonic Sequence</option>
        </select>
    </div>
    
    <!-- TERM COUNT AND OPTIONS -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px;">
        <div>
            <label for="ss-term-count" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">#Ô∏è‚É£</span> Number of Terms (n)
            </label>
            <div style="display:flex;align-items:center;gap:10px;">
                <input id="ss-term-count" type="range" min="1" max="50" value="10" step="1"
                       style="flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,0.1);outline:none;"
                       oninput="document.getElementById('ss-term-count-value').textContent = this.value">
                <span id="ss-term-count-value" style="min-width:30px;text-align:center;color:var(--accent);font-weight:500;">10</span>
            </div>
        </div>
        
        <div>
            <label for="ss-output-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üìä</span> Output Type
            </label>
            <select id="ss-output-type" 
                    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
                <option value="sequence">Sequence Only</option>
                <option value="series" selected>Sequence + Series Sum</option>
                <option value="detailed">Detailed Analysis</option>
            </select>
        </div>
    </div>
    
    <!-- VISUALIZATION OPTION -->
    <div style="margin-bottom:20px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <label style="display:block;color:var(--accent);font-weight:500;font-size:14px;">
                <span style="font-size:16px;">üìà</span> Show Visualization
            </label>
            <button type="button" onclick="ssToggleVisualization()" id="ss-visual-toggle" 
                    style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:4px;cursor:pointer;font-size:11px;">
                Enable
            </button>
        </div>
        <div id="ss-visualization-section" style="display:none;">
            <div style="display:flex;gap:8px;margin-bottom:8px;">
                <button type="button" onclick="ssSetVisualType('dots')" class="visual-type-btn active" style="padding:6px 10px;border-radius:6px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:11px;">Dots</button>
                <button type="button" onclick="ssSetVisualType('bars')" class="visual-type-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;font-size:11px;">Bars</button>
                <button type="button" onclick="ssSetVisualType('line')" class="visual-type-btn" style="padding:6px 10px;border-radius:6px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;font-size:11px;">Line</button>
            </div>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="display:flex;gap:12px;margin-top:20px;">
        <button type="button" onclick="ssCalculate()" id="ss-calculate-btn"
                style="flex:2;padding:14px 20px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.5);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform 0.2s ease;">
            <span style="font-size:18px;">üî¢</span> Calculate Sequence
        </button>
        
        <button type="button" onclick="ssCopyResults()" id="ss-copy-btn"
                style="padding:14px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:10px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üìã</span> Copy
        </button>
        
        <button type="button" onclick="ssExportCSV()" id="ss-export-btn"
                style="padding:14px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üìä</span> Export
        </button>
        
        <button type="button" onclick="ssResetAll()"
                style="padding:14px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">üîÑ</span> Reset
        </button>
    </div>
</form>

<!-- RESULTS AREA -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h3 class="small" style="color:var(--accent);font-size:16px;margin:0;display:flex;align-items:center;gap:8px;">
            <span style="font-size:18px;">üìä</span> Sequence Results
        </h3>
        <div id="ss-stats" style="display:flex;gap:12px;font-size:12px;color:rgba(230,250,255,0.7);">
            <span>Type: <span id="ss-type-display">Arithmetic</span></span>
            <span>Terms: <span id="ss-term-display">10</span></span>
        </div>
    </div>
    
    <!-- VISUALIZATION CANVAS -->
    <div id="ss-visualization-canvas" style="display:none;height:120px;margin-bottom:12px;background:rgba(20,20,20,0.5);border-radius:8px;border:1px solid rgba(45,212,255,0.2);padding:12px;position:relative;">
        <div style="position:absolute;top:8px;right:8px;font-size:11px;color:rgba(230,250,255,0.5);">
            <span id="ss-visual-type-display">Dots Plot</span>
        </div>
        <div id="ss-canvas-content" style="height:100%;display:flex;align-items:flex-end;justify-content:space-around;padding:0 20px;">
            <!-- Visualization will be generated here -->
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:10px;color:rgba(230,250,255,0.5);">
            <span>Term 1</span>
            <span>Term <span id="ss-last-term-number">10</span></span>
        </div>
    </div>
    
    <!-- KEY METRICS -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;">
        <div style="text-align:center;padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
            <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Nth Term (a‚Çô)</div>
            <div id="ss-nth-term" style="font-size:18px;font-weight:600;color:var(--accent);">‚Äì</div>
        </div>
        
        <div style="text-align:center;padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);">
            <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Series Sum (S‚Çô)</div>
            <div id="ss-series-sum" style="font-size:18px;font-weight:600;color:#39ff14;">‚Äì</div>
        </div>
        
        <div style="text-align:center;padding:12px;background:rgba(255,204,0,0.1);border-radius:8px;border:1px solid rgba(255,204,0,0.3);">
            <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Growth Rate</div>
            <div id="ss-growth-rate" style="font-size:18px;font-weight:600;color:#ffcc00;">‚Äì</div>
        </div>
    </div>
    
    <!-- SEQUENCE LIST -->
    <div style="margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <div style="font-size:13px;color:var(--accent);font-weight:500;">
                <span style="font-size:16px;">üìã</span> Sequence Terms
            </div>
            <button type="button" onclick="ssToggleSequenceList()" style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;border-radius:4px;cursor:pointer;font-size:11px;">Show All</button>
        </div>
        
        <div id="ss-sequence-list" style="max-height:100px;overflow-y:auto;background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
            <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);">
                Calculate to see sequence terms
            </div>
        </div>
    </div>
    
    <!-- FORMULAS & EXPLANATION -->
    <div id="ss-formula-section" style="display:none;margin-top:12px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:3px solid var(--accent);">
        <div style="font-weight:600;color:var(--accent);margin-bottom:8px;">üßÆ Formula & Explanation</div>
        <div id="ss-formula-content" style="font-size:12px;color:rgba(230,250,255,0.9);">
            <!-- Formula will be generated here -->
        </div>
    </div>
</div>

<!-- MATH TIPS -->
<div style="margin-top:20px;padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border-left:3px solid #39ff14;">
    <div style="display:flex;align-items:flex-start;gap:8px;">
        <span style="font-size:18px;color:#39ff14;">üí°</span>
        <div style="flex:1;">
            <div style="font-weight:600;color:#39ff14;margin-bottom:8px;">Math Tips</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:12px;">
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Arithmetic</div>
                    <div style="color:rgba(230,250,255,0.7);">a‚Çô = a‚ÇÅ + (n-1)d, S‚Çô = n/2[2a‚ÇÅ + (n-1)d]</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Geometric</div>
                    <div style="color:rgba(230,250,255,0.7);">a‚Çô = a‚ÇÅ¬∑r‚Åø‚Åª¬π, S‚Çô = a‚ÇÅ(1-r‚Åø)/(1-r)</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Fibonacci</div>
                    <div style="color:rgba(230,250,255,0.7);">F‚Çô = F‚Çô‚Çã‚ÇÅ + F‚Çô‚Çã‚ÇÇ, F‚ÇÅ = 0, F‚ÇÇ = 1</div>
                </div>
                <div>
                    <div style="font-weight:500;color:rgba(230,250,255,0.9);margin-bottom:4px;">Applications</div>
                    <div style="color:rgba(230,250,255,0.7);">Finance, computer science, nature patterns</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
/* sequences-series-calculator.html
   - Advanced sequences and series calculator
   - Scoped with ss- prefix
*/

let currentSequenceType = 'arithmetic';
let currentVisualType = 'dots';
let sequenceData = [];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('Sequences & Series Calculator ready! üî¢');
    
    // Set up event listeners for auto-calculation
    document.getElementById('ss-first-term').addEventListener('input', () => ssCalculate());
    document.getElementById('ss-common-diff').addEventListener('input', () => ssCalculate());
    document.getElementById('ss-term-count').addEventListener('input', () => {
        document.getElementById('ss-term-count-value').textContent = document.getElementById('ss-term-count').value;
        ssCalculate();
    });
    
    // Initial calculation
    ssCalculate();
});

// Set sequence type
function ssSetSequenceType(type) {
    currentSequenceType = type;
    
    // Update button states
    document.querySelectorAll('.sequence-type-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = document.querySelector(`[onclick="ssSetSequenceType('${type}')"]`);
    if (activeBtn) {
        activeBtn.style.background = 'rgba(45,212,255,0.2)';
        activeBtn.style.border = '2px solid var(--accent)';
        activeBtn.style.color = 'var(--accent)';
    }
    
    // Show/hide appropriate inputs
    const standardInputs = document.getElementById('ss-standard-inputs');
    const fibonacciInputs = document.getElementById('ss-fibonacci-inputs');
    const specialInputs = document.getElementById('ss-special-inputs');
    
    standardInputs.style.display = 'none';
    fibonacciInputs.style.display = 'none';
    specialInputs.style.display = 'none';
    
    switch(type) {
        case 'arithmetic':
            standardInputs.style.display = 'grid';
            document.getElementById('ss-diff-label').textContent = 'üìà';
            document.getElementById('ss-diff-text').textContent = 'Common Difference (d)';
            document.getElementById('ss-common-diff').placeholder = 'e.g., 3';
            document.getElementById('ss-type-display').textContent = 'Arithmetic';
            break;
            
        case 'geometric':
            standardInputs.style.display = 'grid';
            document.getElementById('ss-diff-label').textContent = '‚úñÔ∏è';
            document.getElementById('ss-diff-text').textContent = 'Common Ratio (r)';
            document.getElementById('ss-common-diff').placeholder = 'e.g., 2';
            document.getElementById('ss-type-display').textContent = 'Geometric';
            break;
            
        case 'fibonacci':
            fibonacciInputs.style.display = 'grid';
            document.getElementById('ss-type-display').textContent = 'Fibonacci';
            break;
            
        case 'special':
            specialInputs.style.display = 'block';
            document.getElementById('ss-type-display').textContent = 'Special';
            break;
    }
    
    // Load example for new type
    switch(type) {
        case 'arithmetic': ssLoadExample('simpleArithmetic'); break;
        case 'geometric': ssLoadExample('simpleGeometric'); break;
        case 'fibonacci': ssLoadExample('fibonacciSeq'); break;
        case 'special': ssLoadExample('triangular'); break;
    }
    
    ssShowNotification(`Switched to ${type} sequence`, 'info');
}

// Load example
function ssLoadExample(example) {
    switch(example) {
        case 'simpleArithmetic':
            document.getElementById('ss-first-term').value = '2';
            document.getElementById('ss-common-diff').value = '3';
            break;
            
        case 'simpleGeometric':
            document.getElementById('ss-first-term').value = '3';
            document.getElementById('ss-common-diff').value = '2';
            break;
            
        case 'fibonacciSeq':
            document.getElementById('ss-fib-first').value = '0';
            document.getElementById('ss-fib-second').value = '1';
            break;
            
        case 'triangular':
            document.getElementById('ss-special-type').value = 'triangular';
            break;
            
        case 'square':
            document.getElementById('ss-special-type').value = 'square';
            break;
    }
    
    if (currentSequenceType === 'fibonacci' && example !== 'fibonacciSeq') {
        currentSequenceType = 'arithmetic';
        ssSetSequenceType('arithmetic');
    }
    
    ssCalculate();
    ssShowNotification(`Loaded ${example} example`, 'info');
}

// Toggle visualization
function ssToggleVisualization() {
    const section = document.getElementById('ss-visualization-section');
    const canvas = document.getElementById('ss-visualization-canvas');
    const toggleBtn = document.getElementById('ss-visual-toggle');
    
    if (canvas.style.display === 'none') {
        section.style.display = 'block';
        canvas.style.display = 'block';
        toggleBtn.innerHTML = 'Disable';
        toggleBtn.style.background = 'rgba(255,45,85,0.1)';
        toggleBtn.style.borderColor = 'rgba(255,45,85,0.3)';
        toggleBtn.style.color = '#ff2d55';
    } else {
        section.style.display = 'none';
        canvas.style.display = 'none';
        toggleBtn.innerHTML = 'Enable';
        toggleBtn.style.background = 'rgba(45,212,255,0.1)';
        toggleBtn.style.borderColor = 'rgba(45,212,255,0.3)';
        toggleBtn.style.color = 'var(--accent)';
    }
    
    ssUpdateVisualization();
}

// Set visualization type
function ssSetVisualType(type) {
    currentVisualType = type;
    
    // Update button states
    document.querySelectorAll('.visual-type-btn').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = document.querySelector(`[onclick="ssSetVisualType('${type}')"]`);
    if (activeBtn) {
        activeBtn.style.background = 'rgba(45,212,255,0.2)';
        activeBtn.style.border = '1px solid rgba(45,212,255,0.3)';
        activeBtn.style.color = 'var(--accent)';
    }
    
    document.getElementById('ss-visual-type-display').textContent = 
        type === 'dots' ? 'Dots Plot' : type === 'bars' ? 'Bar Chart' : 'Line Graph';
    
    ssUpdateVisualization();
}

// Main calculation function
function ssCalculate() {
    const n = parseInt(document.getElementById('ss-term-count').value) || 1;
    const outputType = document.getElementById('ss-output-type').value;
    let sequence = [];
    let results = {};
    
    switch(currentSequenceType) {
        case 'arithmetic':
            results = ssCalculateArithmetic(n);
            sequence = results.sequence;
            break;
            
        case 'geometric':
            results = ssCalculateGeometric(n);
            sequence = results.sequence;
            break;
            
        case 'fibonacci':
            results = ssCalculateFibonacci(n);
            sequence = results.sequence;
            break;
            
        case 'special':
            results = ssCalculateSpecial(n);
            sequence = results.sequence;
            break;
    }
    
    sequenceData = sequence;
    
    // Update display
    ssUpdateDisplay(sequence, results, outputType);
    
    // Update visualization
    if (document.getElementById('ss-visualization-canvas').style.display !== 'none') {
        ssUpdateVisualization();
    }
}

// Calculate arithmetic sequence
function ssCalculateArithmetic(n) {
    const a1 = parseFloat(document.getElementById('ss-first-term').value) || 0;
    const d = parseFloat(document.getElementById('ss-common-diff').value) || 0;
    
    let sequence = [];
    let sum = 0;
    
    for (let i = 1; i <= n; i++) {
        const term = a1 + (i - 1) * d;
        sequence.push(term);
        sum += term;
    }
    
    const nthTerm = sequence[sequence.length - 1];
    const growthRate = d;
    
    return {
        sequence: sequence,
        nthTerm: nthTerm,
        sum: sum,
        growthRate: growthRate,
        formula: `a‚Çô = a‚ÇÅ + (n-1)d = ${a1} + (n-1)${d}`
    };
}

// Calculate geometric sequence
function ssCalculateGeometric(n) {
    const a1 = parseFloat(document.getElementById('ss-first-term').value) || 0;
    const r = parseFloat(document.getElementById('ss-common-diff').value) || 1;
    
    let sequence = [];
    let sum = 0;
    
    for (let i = 1; i <= n; i++) {
        const term = a1 * Math.pow(r, i - 1);
        sequence.push(term);
        sum += term;
    }
    
    const nthTerm = sequence[sequence.length - 1];
    const growthRate = r - 1; // As percentage
    
    let sumFormula = '';
    if (r === 1) {
        sumFormula = `S‚Çô = n¬∑a‚ÇÅ = ${n}¬∑${a1}`;
    } else {
        sumFormula = `S‚Çô = a‚ÇÅ(1-r‚Åø)/(1-r) = ${a1}(1-${r}‚Åø)/(1-${r})`;
    }
    
    return {
        sequence: sequence,
        nthTerm: nthTerm,
        sum: sum,
        growthRate: growthRate * 100, // Convert to percentage
        formula: `a‚Çô = a‚ÇÅ¬∑r‚Åø‚Åª¬π = ${a1}¬∑${r}‚Åø‚Åª¬π, ${sumFormula}`
    };
}

// Calculate Fibonacci sequence
function ssCalculateFibonacci(n) {
    const f1 = parseFloat(document.getElementById('ss-fib-first').value) || 0;
    const f2 = parseFloat(document.getElementById('ss-fib-second').value) || 1;
    
    let sequence = [f1, f2];
    let sum = f1 + f2;
    
    for (let i = 3; i <= n; i++) {
        const term = sequence[i-2] + sequence[i-3];
        sequence.push(term);
        sum += term;
    }
    
    const nthTerm = sequence[sequence.length - 1];
    
    // Calculate approximate growth rate (golden ratio for standard Fibonacci)
    let growthRate = 0;
    if (n >= 3) {
        growthRate = (sequence[n-1] / sequence[n-2] - 1) * 100;
    }
    
    return {
        sequence: sequence.slice(0, n),
        nthTerm: nthTerm,
        sum: sum,
        growthRate: growthRate,
        formula: `F‚Çô = F‚Çô‚Çã‚ÇÅ + F‚Çô‚Çã‚ÇÇ, with F‚ÇÅ = ${f1}, F‚ÇÇ = ${f2}`
    };
}

// Calculate special sequence
function ssCalculateSpecial(n) {
    const type = document.getElementById('ss-special-type').value;
    
    let sequence = [];
    let sum = 0;
    let formula = '';
    
    switch(type) {
        case 'triangular':
            for (let i = 1; i <= n; i++) {
                const term = i * (i + 1) / 2;
                sequence.push(term);
                sum += term;
            }
            formula = 'T‚Çô = n(n+1)/2';
            break;
            
        case 'square':
            for (let i = 1; i <= n; i++) {
                const term = i * i;
                sequence.push(term);
                sum += term;
            }
            formula = 'S‚Çô = n¬≤';
            break;
            
        case 'cube':
            for (let i = 1; i <= n; i++) {
                const term = i * i * i;
                sequence.push(term);
                sum += term;
            }
            formula = 'C‚Çô = n¬≥';
            break;
            
        case 'prime':
            let count = 0;
            let num = 2;
            while (count < n) {
                if (ssIsPrime(num)) {
                    sequence.push(num);
                    sum += num;
                    count++;
                }
                num++;
            }
            formula = 'Prime numbers';
            break;
            
        case 'factorial':
            let factorial = 1;
            for (let i = 1; i <= n; i++) {
                factorial *= i;
                sequence.push(factorial);
                sum += factorial;
            }
            formula = 'n! = n¬∑(n-1)¬∑...¬∑1';
            break;
            
        case 'harmonic':
            for (let i = 1; i <= n; i++) {
                const term = 1 / i;
                sequence.push(term);
                sum += term;
            }
            formula = 'H‚Çô = 1/n';
            break;
    }
    
    const nthTerm = sequence[sequence.length - 1];
    const growthRate = n > 1 ? ((sequence[n-1] / sequence[n-2] - 1) * 100) : 0;
    
    return {
        sequence: sequence,
        nthTerm: nthTerm,
        sum: sum,
        growthRate: growthRate,
        formula: formula
    };
}

// Check if a number is prime
function ssIsPrime(num) {
    if (num <= 1) return false;
    if (num <= 3) return true;
    if (num % 2 === 0 || num % 3 === 0) return false;
    
    for (let i = 5; i * i <= num; i += 6) {
        if (num % i === 0 || num % (i + 2) === 0) return false;
    }
    
    return true;
}

// Update display with results
function ssUpdateDisplay(sequence, results, outputType) {
    // Update term display
    document.getElementById('ss-term-display').textContent = sequence.length;
    document.getElementById('ss-last-term-number').textContent = sequence.length;
    
    // Format numbers
    const formatNumber = (num) => {
        if (Math.abs(num) < 0.0001 && num !== 0) return num.toExponential(4);
        if (Math.abs(num) > 1000000) return num.toExponential(4);
        if (Math.abs(num - Math.round(num)) < 0.0001) return Math.round(num);
        return parseFloat(num.toFixed(6));
    };
    
    // Update metrics
    document.getElementById('ss-nth-term').textContent = formatNumber(results.nthTerm);
    document.getElementById('ss-series-sum').textContent = formatNumber(results.sum);
    document.getElementById('ss-growth-rate').textContent = 
        typeof results.growthRate === 'number' ? formatNumber(results.growthRate) + '%' : '‚Äì';
    
    // Update sequence list
    const sequenceList = document.getElementById('ss-sequence-list');
    if (sequence.length > 0) {
        let listHTML = '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        sequence.forEach((term, index) => {
            listHTML += `
                <div style="text-align:center;min-width:60px;">
                    <div style="font-size:10px;color:rgba(230,250,255,0.5);">a${index + 1}</div>
                    <div style="font-size:13px;color:var(--accent);font-weight:500;">${formatNumber(term)}</div>
                </div>
            `;
        });
        listHTML += '</div>';
        sequenceList.innerHTML = listHTML;
    }
    
    // Update formula section
    const formulaSection = document.getElementById('ss-formula-section');
    const formulaContent = document.getElementById('ss-formula-content');
    
    if (outputType === 'detailed' && results.formula) {
        formulaSection.style.display = 'block';
        
        let explanation = '';
        switch(currentSequenceType) {
            case 'arithmetic':
                explanation = `Each term increases by a constant difference. The nth term formula calculates any term directly.`;
                break;
            case 'geometric':
                explanation = `Each term is multiplied by a constant ratio. For |r| < 1, the infinite series converges.`;
                break;
            case 'fibonacci':
                explanation = `Each term is the sum of the two preceding terms. Appears in nature (spiral patterns).`;
                break;
            default:
                explanation = `Special mathematical sequence with unique properties.`;
        }
        
        formulaContent.innerHTML = `
            <div style="margin-bottom:8px;"><strong>Formula:</strong> ${results.formula}</div>
            <div>${explanation}</div>
        `;
    } else {
        formulaSection.style.display = 'none';
    }
}

// Update visualization
function ssUpdateVisualization() {
    if (sequenceData.length === 0) return;
    
    const canvas = document.getElementById('ss-canvas-content');
    const maxValue = Math.max(...sequenceData.map(Math.abs));
    const height = 80; // pixels
    
    let visualHTML = '';
    
    switch(currentVisualType) {
        case 'dots':
            sequenceData.forEach((value, index) => {
                const yPos = height - (Math.abs(value) / (maxValue || 1)) * height;
                const color = value >= 0 ? 'var(--accent)' : '#ff2d55';
                visualHTML += `
                    <div style="position:relative;">
                        <div style="width:8px;height:8px;background:${color};border-radius:50%;position:absolute;bottom:${yPos}px;"></div>
                        <div style="font-size:9px;position:absolute;bottom:-16px;color:rgba(230,250,255,0.5);">${index + 1}</div>
                    </div>
                `;
            });
            break;
            
        case 'bars':
            sequenceData.forEach((value, index) => {
                const barHeight = (Math.abs(value) / (maxValue || 1)) * height;
                const color = value >= 0 ? 'var(--accent)' : '#ff2d55';
                visualHTML += `
                    <div style="display:flex;flex-direction:column;align-items:center;height:100%;">
                        <div style="width:12px;height:${barHeight}px;background:${color};border-radius:3px 3px 0 0;"></div>
                        <div style="font-size:9px;margin-top:4px;color:rgba(230,250,255,0.5);">${index + 1}</div>
                    </div>
                `;
            });
            break;
            
        case 'line':
            const points = [];
            sequenceData.forEach((value, index) => {
                const x = (index / (sequenceData.length - 1)) * 100;
                const y = 100 - (Math.abs(value) / (maxValue || 1)) * 100;
                points.push(`${x}% ${y}%`);
            });
            
            visualHTML = `
                <svg width="100%" height="100%" style="position:absolute;top:0;left:0;">
                    <polyline points="${points.join(', ')}" fill="none" stroke="var(--accent)" stroke-width="2"/>
                </svg>
            `;
            
            // Add point markers
            sequenceData.forEach((value, index) => {
                const x = (index / (sequenceData.length - 1)) * 100;
                const y = 100 - (Math.abs(value) / (maxValue || 1)) * 100;
                visualHTML += `
                    <div style="position:absolute;left:${x}%;top:${y}%;transform:translate(-50%, -50%);">
                        <div style="width:6px;height:6px;background:var(--accent);border-radius:50%;"></div>
                    </div>
                `;
            });
            break;
    }
    
    canvas.innerHTML = visualHTML;
}

// Toggle sequence list view
function ssToggleSequenceList() {
    const list = document.getElementById('ss-sequence-list');
    const toggleBtn = document.querySelector('[onclick="ssToggleSequenceList()"]');
    
    if (list.style.maxHeight === '100px') {
        list.style.maxHeight = '300px';
        toggleBtn.textContent = 'Collapse';
    } else {
        list.style.maxHeight = '100px';
        toggleBtn.textContent = 'Show All';
    }
}

// Copy results
function ssCopyResults() {
    if (sequenceData.length === 0) {
        ssShowNotification('Calculate sequence first!', 'warning');
        return;
    }
    
    const type = document.getElementById('ss-type-display').textContent;
    const nthTerm = document.getElementById('ss-nth-term').textContent;
    const sum = document.getElementById('ss-series-sum').textContent;
    
    let text = `${type} Sequence\n`;
    text += `Nth Term: ${nthTerm}\n`;
    text += `Series Sum: ${sum}\n`;
    text += `Terms: ${sequenceData.join(', ')}`;
    
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('ss-copy-btn');
        const original = btn.innerHTML;
        btn.innerHTML = '<span style="font-size:16px;">‚úÖ</span> Copied!';
        btn.style.background = 'rgba(57,255,20,0.2)';
        
        setTimeout(() => {
            btn.innerHTML = original;
            btn.style.background = '';
        }, 2000);
        
        ssShowNotification('Sequence copied to clipboard! üìã', 'success');
    });
}

// Export as CSV
function ssExportCSV() {
    if (sequenceData.length === 0) {
        ssShowNotification('Calculate sequence first!', 'warning');
        return;
    }
    
    let csv = 'Term Number,Value\n';
    sequenceData.forEach((value, index) => {
        csv += `${index + 1},${value}\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${currentSequenceType}_sequence_${sequenceData.length}_terms.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    ssShowNotification('Exported as CSV! üìä', 'success');
}

// Reset everything
function ssResetAll() {
    if (confirm('Reset all sequence calculations?')) {
        ssSetSequenceType('arithmetic');
        document.getElementById('ss-term-count').value = '10';
        document.getElementById('ss-term-count-value').textContent = '10';
        document.getElementById('ss-output-type').value = 'series';
        
        // Hide visualization
        document.getElementById('ss-visualization-section').style.display = 'none';
        document.getElementById('ss-visualization-canvas').style.display = 'none';
        document.getElementById('ss-visual-toggle').innerHTML = 'Enable';
        document.getElementById('ss-visual-toggle').style.background = 'rgba(45,212,255,0.1)';
        document.getElementById('ss-visual-toggle').style.borderColor = 'rgba(45,212,255,0.3)';
        document.getElementById('ss-visual-toggle').style.color = 'var(--accent)';
        
        // Reset visualization buttons
        document.querySelectorAll('.visual-type-btn').forEach(btn => {
            btn.style.background = 'rgba(255,255,255,0.05)';
            btn.style.border = '1px solid rgba(255,255,255,0.1)';
            btn.style.color = 'inherit';
        });
        document.querySelector('[onclick="ssSetVisualType(\'dots\')"]').style.background = 'rgba(45,212,255,0.2)';
        document.querySelector('[onclick="ssSetVisualType(\'dots\')"]').style.border = '1px solid rgba(45,212,255,0.3)';
        document.querySelector('[onclick="ssSetVisualType(\'dots\')"]').style.color = 'var(--accent)';
        currentVisualType = 'dots';
        
        ssCalculate();
        ssShowNotification('Calculator reset', 'info');
    }
}

// Notification system
function ssShowNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 16px;
        background: ${type === 'success' ? 'rgba(57,255,20,0.15)' : 
                     type === 'error' ? 'rgba(255,45,85,0.15)' : 
                     type === 'warning' ? 'rgba(255,204,0,0.15)' : 
                     'rgba(45,212,255,0.15)'};
        border: 1px solid ${type === 'success' ? 'rgba(57,255,20,0.3)' : 
                           type === 'error' ? 'rgba(255,45,85,0.3)' : 
                           type === 'warning' ? 'rgba(255,204,0,0.3)' : 
                           'rgba(45,212,255,0.3)'};
        color: ${type === 'success' ? '#39ff14' : 
                type === 'error' ? '#ff2d55' : 
                type === 'warning' ? '#ffcc00' : 
                'var(--accent)'};
        border-radius: 8px;
        z-index: 10000;
        backdrop-filter: blur(10px);
        font-weight: 500;
        animation: ssSlideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'ssSlideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Add CSS animations
if (!document.querySelector('#ss-styles')) {
    const style = document.createElement('style');
    style.id = 'ss-styles';
    style.textContent = `
        @keyframes ssSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes ssSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        button:active {
            transform: translateY(0);
        }
        input:focus, select:focus {
            border-color: var(--accent) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(45,212,255,0.1);
        }
        .sequence-type-btn:hover, .example-btn:hover {
            transform: scale(1.05);
        }
        input[type="range"] {
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
/* Card-specific responsive styles */
#sequences-series-calculator-title {
    animation: ssFadeIn 0.5s ease;
}

@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
        justify-content: center;
    }
    
    .sequence-type-btn {
        padding: 8px !important;
        font-size: 10px !important;
    }
    
    .example-btn {
        font-size: 11px !important;
        padding: 5px 8px !important;
    }
    
    #ss-standard-inputs, #ss-fibonacci-inputs {
        grid-template-columns: 1fr !important;
    }
}

@keyframes ssFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
