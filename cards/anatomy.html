<!-- cards/anatomy-tools.html -->
<h2 id="anatomy-tools-title">Anatomy Tools & Facts</h2>

<div class="description">
  Calculate health metrics and discover fascinating facts about the human body.
  <span class="disclaimer">For educational purposes only. Consult healthcare professionals for medical advice.</span>
</div>

<div class="tool-body">
  <!-- ü©∫ TOOL SELECTOR -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
    <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 15px;">Choose a Health Calculator:</div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 20px;">
      <button id="at-bmi-btn" class="at-tool-btn active" data-tool="bmi" 
              style="background: rgba(45,212,255,0.2); border: 2px solid #2dd4ff; padding: 15px; border-radius: 8px; cursor: pointer; text-align: center;">
        <div style="font-weight: 600; color: #2dd4ff;">BMI</div>
        <div style="font-size: 13px; color: rgba(230,250,255,0.8); margin-top: 4px;">Body Mass Index</div>
      </button>
      
      <button id="at-bmr-btn" class="at-tool-btn" data-tool="bmr"
              style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; cursor: pointer; text-align: center;">
        <div style="font-weight: 600; color: #e6faff;">BMR</div>
        <div style="font-size: 13px; color: rgba(230,250,255,0.8); margin-top: 4px;">Basal Metabolic Rate</div>
      </button>
      
      <button id="at-blood-btn" class="at-tool-btn" data-tool="blood"
              style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; cursor: pointer; text-align: center;">
        <div style="font-weight: 600; color: #e6faff;">Blood Volume</div>
        <div style="font-size: 13px; color: rgba(230,250,255,0.8); margin-top: 4px;">Estimated Blood</div>
      </button>
    </div>
    
    <!-- üìù INPUT FIELDS -->
    <div id="at-bmi-inputs" class="at-inputs" style="display: block;">
      <div style="color: #e6faff; margin-bottom: 12px; font-size: 15px;">Enter your details:</div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label for="at-weight" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Weight (kg)</label>
          <input type="number" id="at-weight" placeholder="e.g., 70" 
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
        </div>
        
        <div>
          <label for="at-height" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Height (m)</label>
          <input type="number" id="at-height" placeholder="e.g., 1.75" step="0.01"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
        </div>
      </div>
      
      <div style="margin-top: 10px; color: rgba(230,250,255,0.6); font-size: 13px;">
        Example: 70 kg, 1.75 m (5'9")
      </div>
    </div>
    
    <div id="at-bmr-inputs" class="at-inputs" style="display: none;">
      <div style="color: #e6faff; margin-bottom: 12px; font-size: 15px;">Enter your details:</div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label for="at-bmr-weight" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Weight (kg)</label>
          <input type="number" id="at-bmr-weight" placeholder="e.g., 70"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
        </div>
        
        <div>
          <label for="at-bmr-height" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Height (cm)</label>
          <input type="number" id="at-bmr-height" placeholder="e.g., 175"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
        </div>
        
        <div>
          <label for="at-bmr-age" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Age (years)</label>
          <input type="number" id="at-bmr-age" placeholder="e.g., 30"
                 style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
        </div>
        
        <div>
          <label for="at-bmr-sex" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Sex</label>
          <select id="at-bmr-sex" 
                  style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>
      </div>
    </div>
    
    <div id="at-blood-inputs" class="at-inputs" style="display: none;">
      <div style="color: #e6faff; margin-bottom: 12px; font-size: 15px;">Enter your details:</div>
      
      <div>
        <label for="at-blood-weight" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">Weight (kg)</label>
        <input type="number" id="at-blood-weight" placeholder="e.g., 70"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e6faff;">
      </div>
      
      <div style="margin-top: 10px; color: rgba(230,250,255,0.6); font-size: 13px;">
        Based on average 70-75 ml of blood per kg body weight
      </div>
    </div>
    
    <!-- üîò FACTS TOGGLE -->
    <div style="margin-top: 20px; display: flex; align-items: center; gap: 10px;">
      <label for="at-facts-toggle" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: rgba(230,250,255,0.8);">
        <input type="checkbox" id="at-facts-toggle" checked style="cursor: pointer;">
        <span>Show Amazing Body Facts</span>
      </label>
    </div>
  </div>
  
  <!-- üöÄ CALCULATE BUTTON -->
  <div style="text-align: center; margin: 25px 0;">
    <button id="at-calculate-btn" 
            style="background: #2dd4ff; color: #000; border: none; padding: 14px 32px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 15px rgba(45,212,255,0.3);">
      CALCULATE
    </button>
    
    <button id="at-reset-btn" 
            style="background: rgba(255,255,255,0.08); color: #e6faff; border: 1px solid rgba(255,255,255,0.2); padding: 14px 24px; border-radius: 10px; cursor: pointer; font-size: 16px; margin-left: 12px;">
      Reset
    </button>
  </div>
  
  <!-- üìä RESULTS DISPLAY -->
  <div id="at-results" style="display: none;">
    <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2); margin-bottom: 25px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <div style="color: #39ff14; font-size: 18px; font-weight: 600;">‚úÖ Results</div>
        <button id="at-copy-btn" 
                style="background: rgba(57,255,20,0.1); color: #39ff14; border: 1px solid rgba(57,255,20,0.3); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
          Copy Result
        </button>
      </div>
      
      <div id="at-result-display" style="font-size: 20px; color: #39ff14; text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
        <!-- Results appear here -->
      </div>
      
      <div id="at-interpretation" style="color: #e6faff; font-size: 15px; line-height: 1.6; padding: 15px; background: rgba(30,30,30,0.5); border-radius: 8px;">
        <!-- Interpretation appears here -->
      </div>
    </div>
  </div>
  
  <!-- üß† BODY FACTS - RANDOM VERSION -->
  <div id="at-facts" style="margin-top: 20px; display: block;">
    <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; border: 1px solid rgba(45,212,255,0.2);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <div style="color: #2dd4ff; font-weight: 600; font-size: 16px;">
          üî¨ Amazing Human Body Facts
        </div>
        <button id="at-random-fact-btn" 
                style="background: rgba(45,212,255,0.15); color: #2dd4ff; border: 1px solid #2dd4ff; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">
          üîÑ Show Random Fact
        </button>
      </div>
      
      <!-- Single Fact Display -->
      <div id="at-single-fact-display" style="display: none; margin-bottom: 15px;">
        <div id="at-random-fact-card" 
             style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; border-left: 4px solid #2dd4ff;">
          <div id="at-fact-category" style="color: #2dd4ff; font-weight: 600; margin-bottom: 10px; font-size: 14px; text-transform: uppercase;">
            <!-- Category will appear here -->
          </div>
          <div id="at-fact-text" style="color: #e6faff; font-size: 16px; line-height: 1.5; margin-bottom: 10px;">
            <!-- Fact text will appear here -->
          </div>
          <div id="at-fact-detail" style="color: rgba(230,250,255,0.7); font-size: 14px; font-style: italic;">
            <!-- Additional detail will appear here -->
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
            <div id="at-fact-number" style="color: rgba(45,212,255,0.7); font-size: 12px;">
              <!-- Fact number will appear here -->
            </div>
            <div style="display: flex; gap: 10px;">
              <button id="at-copy-fact-btn" 
                      style="background: rgba(57,255,20,0.1); color: #39ff14; border: 1px solid rgba(57,255,20,0.3); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                üìã Copy Fact
              </button>
              <button id="at-new-fact-btn" 
                      style="background: rgba(45,212,255,0.1); color: #2dd4ff; border: 1px solid rgba(45,212,255,0.3); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                üé≤ New Fact
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Statistics -->
      <div id="at-facts-stats" style="display: none; text-align: center; color: rgba(230,250,255,0.7); font-size: 13px; margin-top: 10px;">
        <span id="at-facts-count">0</span> facts shown from our collection of <span style="color: #2dd4ff;">100+</span> amazing body facts
      </div>
      
      <!-- Original Grid -->
      <div id="at-example-facts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
        <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid #2dd4ff;">
          <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 5px;">206 Bones</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Babies are born with ~300 bones that fuse together</div>
        </div>
        
        <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid #ff2d55;">
          <div style="color: #ff2d55; font-weight: 600; margin-bottom: 5px;">100,000 Beats/Day</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Heart pumps ~7,500 liters of blood daily</div>
        </div>
        
        <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid #00ff99;">
          <div style="color: #00ff99; font-weight: 600; margin-bottom: 5px;">6 Meter Intestine</div>
          <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Small intestine length if stretched out</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- üö® ERROR MESSAGE -->
  <div id="at-error" style="margin-top: 20px; padding: 15px; background: rgba(255,77,77,0.1); border-radius: 8px; border: 1px solid rgba(255,77,77,0.3); display: none;">
    <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 5px;">‚ö†Ô∏è Please check your inputs</div>
    <div id="at-error-text" style="color: rgba(255,77,77,0.9);"></div>
  </div>
</div>

<style>
#anatomy-tools-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

.description {
  color: rgba(230,250,255,0.8);
  margin-bottom: 20px;
  font-size: 14px;
}

.disclaimer {
  display: block;
  color: rgba(255,77,77,0.8);
  font-size: 12px;
  margin-top: 5px;
  font-style: italic;
}

/* Animation styles */
@keyframes at-fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes at-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .at-inputs > div {
    grid-template-columns: 1fr !important;
  }
  
  #at-calculate-btn, #at-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
}
</style>

<script>
// ============================================
// ANATOMY TOOLS - PROPERLY SCOPED
// All functions prefixed with "at" (anatomy tools)
// ============================================

// Database of body facts
const atBodyFacts = [
  // Brain & Nervous System (15 facts)
  { category: "Brain", text: "Your brain generates about 20 watts of electricity", detail: "Enough to power a dim light bulb" },
  { category: "Brain", text: "The brain is 60% fat", detail: "Making it the fattiest organ in the human body" },
  { category: "Brain", text: "Neurons transmit information at 250 mph", detail: "That's faster than Formula 1 race cars" },
  { category: "Brain", text: "Your brain uses 20% of your body's oxygen", detail: "Despite being only 2% of body weight" },
  { category: "Brain", text: "You have about 100 billion neurons", detail: "More than stars in the Milky Way galaxy" },
  
  // Heart & Circulatory System
  { category: "Heart", text: "Your heart beats about 100,000 times per day", detail: "That's 35 million times per year" },
  { category: "Heart", text: "The heart pumps about 7,500 liters of blood daily", detail: "Enough to fill 10 bathtubs" },
  { category: "Blood", text: "Your blood travels 19,000 km per day", detail: "That's halfway around the Earth" },
  
  // Digestive System
  { category: "Stomach", text: "Stomach acid is strong enough to dissolve metal", detail: "But mucus lining protects your stomach" },
  { category: "Intestines", text: "Your small intestine is about 6 meters long", detail: "If stretched out, it's taller than a giraffe" },
  
  // Skeletal System
  { category: "Bones", text: "Babies are born with 300 bones", detail: "They fuse to become 206 in adults" },
  { category: "Bones", text: "The femur is the strongest bone", detail: "Can support 30 times your body weight" },
  
  // Muscular System
  { category: "Muscles", text: "You have about 650 muscles", detail: "Making up 40-50% of body weight" },
  { category: "Facial Muscles", text: "It takes 43 muscles to frown", detail: "But only 17 to smile" },
  
  // Skin & Hair
  { category: "Skin", text: "Skin is your largest organ", detail: "Covers about 2 square meters in adults" },
  { category: "Skin Cells", text: "You shed about 500 million skin cells daily", detail: "That's about 0.5 kg per year" },
  
  // Miscellaneous
  { category: "Body Water", text: "Your body is about 60% water", detail: "Brain and heart are 73%, lungs 83%, bones 31%" },
  { category: "DNA", text: "If uncoiled, your DNA would stretch to the Sun and back 300 times", detail: "About 3 billion base pairs in total" }
];

let atShownFacts = new Set();
let atTotalFactsShown = 0;

// Initialize the entire tool
function atInit() {
  console.log("Anatomy Tools: Initializing...");
  
  // Tool buttons
  const toolBtns = document.querySelectorAll('.at-tool-btn');
  toolBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Update active button
      toolBtns.forEach(b => {
        b.style.background = 'rgba(255,255,255,0.05)';
        b.style.border = '1px solid rgba(255,255,255,0.1)';
        b.style.color = '#e6faff';
        b.querySelector('div:first-child').style.color = '#e6faff';
      });
      
      this.style.background = 'rgba(45,212,255,0.2)';
      this.style.border = '2px solid #2dd4ff';
      this.querySelector('div:first-child').style.color = '#2dd4ff';
      
      // Show corresponding inputs
      const tool = this.dataset.tool;
      document.querySelectorAll('.at-inputs').forEach(input => {
        input.style.display = 'none';
      });
      
      if (tool === 'bmi') {
        document.getElementById('at-bmi-inputs').style.display = 'block';
      } else if (tool === 'bmr') {
        document.getElementById('at-bmr-inputs').style.display = 'block';
      } else if (tool === 'blood') {
        document.getElementById('at-blood-inputs').style.display = 'block';
      }
      
      // Clear results
      atClearResults();
    });
  });
  
  // Calculate button
  document.getElementById('at-calculate-btn').addEventListener('click', atCalculate);
  
  // Reset button
  document.getElementById('at-reset-btn').addEventListener('click', atReset);
  
  // Copy button
  document.getElementById('at-copy-btn').addEventListener('click', atCopyResult);
  
  // Facts toggle
  document.getElementById('at-facts-toggle').addEventListener('change', function() {
    document.getElementById('at-facts').style.display = this.checked ? 'block' : 'none';
  });
  
  // Random fact button
  document.getElementById('at-random-fact-btn').addEventListener('click', atShowRandomFact);
  document.getElementById('at-new-fact-btn').addEventListener('click', atShowRandomFact);
  document.getElementById('at-copy-fact-btn').addEventListener('click', atCopyCurrentFact);
  
  // Enter key support
  const allInputs = document.querySelectorAll('#at-weight, #at-height, #at-bmr-weight, #at-bmr-height, #at-bmr-age, #at-blood-weight');
  allInputs.forEach(input => {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        atCalculate();
      }
    });
  });
  
  // Set default values
  atSetDefaultValues();
  
  // Initialize random facts
  setTimeout(() => {
    atShowRandomFact();
  }, 500);
  
  console.log("‚úÖ Anatomy Tools ready!");
}

// Set default values
function atSetDefaultValues() {
  document.getElementById('at-weight').value = '70';
  document.getElementById('at-height').value = '1.75';
  document.getElementById('at-bmr-weight').value = '70';
  document.getElementById('at-bmr-height').value = '175';
  document.getElementById('at-bmr-age').value = '30';
  document.getElementById('at-blood-weight').value = '70';
}

// Main calculation function
function atCalculate() {
  console.log("Calculating anatomy metrics...");
  
  // Hide previous results/errors
  document.getElementById('at-results').style.display = 'none';
  document.getElementById('at-error').style.display = 'none';
  
  // Get active tool
  const activeTool = document.querySelector('.at-tool-btn.active').dataset.tool;
  let result = '';
  let interpretation = '';
  
  try {
    if (activeTool === 'bmi') {
      const weight = parseFloat(document.getElementById('at-weight').value);
      const height = parseFloat(document.getElementById('at-height').value);
      
      if (!weight || !height || weight <= 0 || height <= 0) {
        atShowError('Please enter valid weight (kg) and height (m)');
        return;
      }
      
      const bmi = weight / (height * height);
      result = `BMI: ${bmi.toFixed(1)}`;
      
      if (bmi < 18.5) {
        interpretation = 'Underweight - Consider consulting a healthcare provider';
      } else if (bmi < 25) {
        interpretation = 'Normal weight - Healthy range';
      } else if (bmi < 30) {
        interpretation = 'Overweight - Consider lifestyle adjustments';
      } else {
        interpretation = 'Obese - Consult healthcare provider for guidance';
      }
      
      interpretation += `\n\nFormula: Weight (${weight} kg) √∑ Height¬≤ (${height} m √ó ${height} m) = ${bmi.toFixed(1)}`;
      
    } else if (activeTool === 'bmr') {
      const weight = parseFloat(document.getElementById('at-bmr-weight').value);
      const height = parseFloat(document.getElementById('at-bmr-height').value);
      const age = parseFloat(document.getElementById('at-bmr-age').value);
      const sex = document.getElementById('at-bmr-sex').value;
      
      if (!weight || !height || !age || weight <= 0 || height <= 0 || age <= 0) {
        atShowError('Please enter valid weight, height, and age');
        return;
      }
      
      let bmr;
      if (sex === 'male') {
        bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
      } else {
        bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
      }
      
      result = `BMR: ${bmr.toFixed(0)} calories/day`;
      interpretation = `Your body burns approximately ${bmr.toFixed(0)} calories daily at rest.\n\n`;
      interpretation += `Activity Level Estimates:\n`;
      interpretation += `‚Ä¢ Sedentary: ${(bmr * 1.2).toFixed(0)} cal/day\n`;
      interpretation += `‚Ä¢ Light exercise: ${(bmr * 1.375).toFixed(0)} cal/day\n`;
      interpretation += `‚Ä¢ Moderate exercise: ${(bmr * 1.55).toFixed(0)} cal/day\n`;
      interpretation += `‚Ä¢ Very active: ${(bmr * 1.725).toFixed(0)} cal/day\n`;
      interpretation += `‚Ä¢ Extra active: ${(bmr * 1.9).toFixed(0)} cal/day`;
      
    } else if (activeTool === 'blood') {
      const weight = parseFloat(document.getElementById('at-blood-weight').value);
      
      if (!weight || weight <= 0) {
        atShowError('Please enter valid weight (kg)');
        return;
      }
      
      const bloodVolumeMl = weight * 72.5;
      const bloodVolumeLiters = bloodVolumeMl / 1000;
      
      result = `Estimated Blood Volume: ${bloodVolumeLiters.toFixed(1)} liters`;
      interpretation = `An average adult has approximately 70-75 ml of blood per kg of body weight.\n\n`;
      interpretation += `Calculation: ${weight} kg √ó 72.5 ml/kg = ${bloodVolumeMl.toFixed(0)} ml\n`;
      interpretation += `Converted: ${bloodVolumeMl.toFixed(0)} ml √∑ 1000 = ${bloodVolumeLiters.toFixed(1)} L\n\n`;
      interpretation += `‚Ä¢ That's about ${(bloodVolumeLiters * 0.264).toFixed(1)} gallons\n`;
      interpretation += `‚Ä¢ Or ${Math.round(bloodVolumeMl / 470)} standard blood donations`;
    }
    
    // Display results
    document.getElementById('at-result-display').textContent = result;
    document.getElementById('at-interpretation').innerHTML = interpretation.replace(/\n/g, '<br>');
    document.getElementById('at-results').style.display = 'block';
    
  } catch (error) {
    console.error('Calculation error:', error);
    atShowError('Unable to calculate. Please check your inputs.');
  }
}

// Reset function
function atReset() {
  atSetDefaultValues();
  
  // Reset to BMI tool
  document.querySelectorAll('.at-tool-btn').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.querySelector('div:first-child').style.color = '#e6faff';
  });
  
  const bmiBtn = document.getElementById('at-bmi-btn');
  bmiBtn.style.background = 'rgba(45,212,255,0.2)';
  bmiBtn.style.border = '2px solid #2dd4ff';
  bmiBtn.querySelector('div:first-child').style.color = '#2dd4ff';
  
  document.querySelectorAll('.at-inputs').forEach(input => {
    input.style.display = 'none';
  });
  document.getElementById('at-bmi-inputs').style.display = 'block';
  
  atClearResults();
  
  console.log("Anatomy tools reset");
}

// Clear results
function atClearResults() {
  document.getElementById('at-results').style.display = 'none';
  document.getElementById('at-error').style.display = 'none';
}

// Copy result
function atCopyResult() {
  const result = document.getElementById('at-result-display').textContent;
  const interpretation = document.getElementById('at-interpretation').textContent;
  const text = `${result}\n\n${interpretation}`;
  
  navigator.clipboard.writeText(text).then(() => {
    const copyBtn = document.getElementById('at-copy-btn');
    const originalText = copyBtn.textContent;
    copyBtn.textContent = '‚úÖ Copied!';
    copyBtn.style.background = 'rgba(57,255,20,0.2)';
    
    setTimeout(() => {
      copyBtn.textContent = originalText;
      copyBtn.style.background = '';
    }, 2000);
  }).catch(err => {
    console.error('Copy failed:', err);
    alert('Failed to copy. Please select and copy manually.');
  });
}

// Show error
function atShowError(message) {
  document.getElementById('at-error-text').textContent = message;
  document.getElementById('at-error').style.display = 'block';
}

// Random fact functions
function atShowRandomFact() {
  const exampleGrid = document.getElementById('at-example-facts-grid');
  if (exampleGrid && exampleGrid.style.display !== 'none') {
    exampleGrid.style.display = 'none';
  }
  
  const factDisplay = document.getElementById('at-single-fact-display');
  const statsDisplay = document.getElementById('at-facts-stats');
  
  factDisplay.style.display = 'block';
  statsDisplay.style.display = 'block';
  
  let randomIndex;
  let attempts = 0;
  
  do {
    randomIndex = Math.floor(Math.random() * atBodyFacts.length);
    attempts++;
  } while (atShownFacts.has(randomIndex) && attempts < 10 && atShownFacts.size < atBodyFacts.length - 10);
  
  if (atShownFacts.size > atBodyFacts.length * 0.7) {
    atShownFacts.clear();
  }
  
  atShownFacts.add(randomIndex);
  atTotalFactsShown++;
  
  const fact = atBodyFacts[randomIndex];
  
  document.getElementById('at-fact-category').textContent = fact.category;
  document.getElementById('at-fact-text').textContent = fact.text;
  document.getElementById('at-fact-detail').textContent = fact.detail;
  document.getElementById('at-fact-number').textContent = `Fact #${randomIndex + 1} of ${atBodyFacts.length}`;
  document.getElementById('at-facts-count').textContent = atTotalFactsShown;
  
  const card = document.getElementById('at-random-fact-card');
  const colors = {
    'Brain': '#2dd4ff',
    'Heart': '#ff2d55',
    'Stomach': '#00ff99',
    'Bones': '#9d4edd',
    'Muscles': '#ffcc00',
    'Skin': '#ff6b35',
    'Blood': '#ff4d6d'
  };
  
  const borderColor = colors[fact.category] || '#2dd4ff';
  card.style.borderLeftColor = borderColor;
  document.getElementById('at-fact-category').style.color = borderColor;
  
  card.style.animation = 'none';
  setTimeout(() => {
    card.style.animation = 'at-fadeIn 0.5s';
  }, 10);
  
  const randomBtn = document.getElementById('at-random-fact-btn');
  const buttonTexts = [
    "üîÑ Show Random Fact",
    "üé≤ Another Fact",
    "üß† Brain Fact",
    "‚ù§Ô∏è Heart Fact",
    "üí™ Muscle Fact",
    "ü¶¥ Bone Fact",
    "üî¨ Science Fact",
    "ü§Ø Mind Blown!"
  ];
  
  if (Math.random() > 0.7) {
    randomBtn.textContent = buttonTexts[Math.floor(Math.random() * buttonTexts.length)];
    randomBtn.style.animation = 'at-pulse 0.5s';
    setTimeout(() => {
      randomBtn.style.animation = '';
    }, 500);
  }
}

function atCopyCurrentFact() {
  const category = document.getElementById('at-fact-category').textContent;
  const text = document.getElementById('at-fact-text').textContent;
  const detail = document.getElementById('at-fact-detail').textContent;
  
  const fullText = `Amazing Body Fact (${category}): ${text} - ${detail}`;
  
  navigator.clipboard.writeText(fullText).then(() => {
    const copyBtn = document.getElementById('at-copy-fact-btn');
    const originalText = copyBtn.textContent;
    copyBtn.textContent = '‚úÖ Copied!';
    copyBtn.style.background = 'rgba(57,255,20,0.2)';
    
    setTimeout(() => {
      copyBtn.textContent = originalText;
      copyBtn.style.background = '';
    }, 2000);
  }).catch(err => {
    console.error('Copy failed:', err);
  });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', atInit);
} else {
  setTimeout(atInit, 100);
}
</script>
