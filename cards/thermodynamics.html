<h2 id="thermodynamics-title" style="margin-top:0;color:var(--accent);">ğŸ”¥ Thermodynamics Calculator & Encyclopedia</h2>

<form aria-describedby="thermodynamics-desc" style="margin-bottom:20px;">
    <p id="thermodynamics-desc" class="small" style="margin-bottom:20px;color:rgba(var(--text-rgb, 230,250,255),0.9);">
        Calculate heat transfer, efficiency, entropy, and explore thermodynamics principles.
        <span style="color:var(--accent);">Essential tool for physics, engineering, and chemistry.</span>
    </p>
    
    <!-- CALCULATOR SELECTOR -->
    <div class="field" style="margin-bottom:24px;">
        <label for="thermo-tool" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
            Select Thermodynamics Calculator
        </label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" id="thermo-btn-heat" onclick="thermSetTool('heat-transfer')"
                    style="flex:1;padding:12px;border-radius:10px;border:2px solid rgba(255,77,77,0.6);background:rgba(255,77,77,0.15);color:#ff4d4d;cursor:pointer;font-weight:600;min-width:120px;">
                ğŸ”¥ Heat Transfer
            </button>
            <button type="button" id="thermo-btn-efficiency" onclick="thermSetTool('efficiency')"
                    style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:#ffcc00;cursor:pointer;min-width:120px;">
                âš¡ Efficiency
            </button>
            <button type="button" id="thermo-btn-entropy" onclick="thermSetTool('entropy')"
                    style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(var(--accent-rgb, 45,212,255),0.3);background:rgba(var(--accent-rgb, 45,212,255),0.05);color:var(--accent);cursor:pointer;min-width:120px;">
                ğŸ”„ Entropy
            </button>
            <button type="button" id="thermo-btn-gas" onclick="thermSetTool('gas-law')"
                    style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#39ff14;cursor:pointer;min-width:120px;">
                ğŸ’¨ Gas Laws
            </button>
        </div>
        
        <!-- HIDDEN SELECT FOR FORM SUBMISSION -->
        <select id="thermo-tool" style="display:none;">
            <option value="heat-transfer" selected>Heat Transfer</option>
            <option value="efficiency">Efficiency</option>
            <option value="entropy">Entropy</option>
            <option value="gas-law">Ideal Gas Law</option>
        </select>
    </div>
    
    <!-- CALCULATOR INPUTS - HEAT TRANSFER -->
    <div id="thermo-heat-inputs" style="display:block;">
        <h4 style="color:#ff4d4d;margin-top:0;margin-bottom:16px;font-size:14px;font-weight:600;">ğŸ”¥ Heat Transfer: Q = mÂ·cÂ·Î”T</h4>
        
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px;">
            <div>
                <label for="thermo-mass" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Mass (m)
                </label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input id="thermo-mass" type="number" min="0" value="1" step="0.1"
                           style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;font-size:16px;" />
                    <select id="thermo-mass-unit" 
                            style="width:80px;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.2);background:rgba(255,77,77,0.1);color:inherit;">
                        <option value="kg" selected>kg</option>
                        <option value="g">g</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label for="thermo-heat-capacity" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Specific Heat (c)
                </label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input id="thermo-heat-capacity" type="number" min="0" value="4.18" step="0.01"
                           style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;font-size:16px;" />
                    <div style="color:rgba(255,77,77,0.8);font-size:14px;">J/gÂ·K</div>
                </div>
            </div>
            
            <div>
                <label for="thermo-temp-change" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Temperature Change (Î”T)
                </label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input id="thermo-temp-change" type="number" min="-1000" max="1000" value="10" step="0.1"
                           style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;font-size:16px;" />
                    <select id="thermo-temp-unit" 
                            style="width:80px;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.2);background:rgba(255,77,77,0.1);color:inherit;">
                        <option value="K" selected>K</option>
                        <option value="C">Â°C</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label for="thermo-material" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Material Presets
                </label>
                <select id="thermo-material" 
                        style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;">
                    <option value="custom" selected>Custom Values</option>
                    <option value="water">Water (4.18 J/gÂ·K)</option>
                    <option value="aluminum">Aluminum (0.897 J/gÂ·K)</option>
                    <option value="iron">Iron (0.449 J/gÂ·K)</option>
                    <option value="copper">Copper (0.385 J/gÂ·K)</option>
                    <option value="air">Air (1.005 J/gÂ·K)</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- CALCULATOR INPUTS - EFFICIENCY -->
    <div id="thermo-efficiency-inputs" style="display:none;">
        <h4 style="color:#ffcc00;margin-top:0;margin-bottom:16px;font-size:14px;font-weight:600;">âš¡ Efficiency: Î· = (W/Qâ‚•) Ã— 100%</h4>
        
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px;">
            <div>
                <label for="thermo-work" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Work Output (W)
                </label>
                <input id="thermo-work" type="number" min="0" value="100" step="10"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;font-size:16px;" />
            </div>
            
            <div>
                <label for="thermo-heat-input" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Heat Input (Qâ‚•)
                </label>
                <input id="thermo-heat-input" type="number" min="0" value="500" step="10"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;font-size:16px;" />
            </div>
        </div>
        
        <!-- EFFICIENCY PRESETS -->
        <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
            <button type="button" onclick="thermSetEfficiency(20, 100)" 
                    style="padding:6px 10px;border-radius:6px;border:1px solid rgba(255,204,0,0.2);background:rgba(255,204,0,0.05);color:#ffcc00;cursor:pointer;font-size:12px;">
                Steam Engine (~20%)
            </button>
            <button type="button" onclick="thermSetEfficiency(35, 100)" 
                    style="padding:6px 10px;border-radius:6px;border:1px solid rgba(255,204,0,0.2);background:rgba(255,204,0,0.05);color:#ffcc00;cursor:pointer;font-size:12px;">
                Gas Engine (~35%)
            </button>
            <button type="button" onclick="thermSetEfficiency(50, 100)" 
                    style="padding:6px 10px;border-radius:6px;border:1px solid var(--accent);background:rgba(var(--accent-rgb, 45,212,255),0.15);color:var(--accent);cursor:pointer;font-weight:600;font-size:12px;">
                Carnot Limit
            </button>
        </div>
    </div>
    
    <!-- CALCULATOR INPUTS - ENTROPY -->
    <div id="thermo-entropy-inputs" style="display:none;">
        <h4 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:14px;font-weight:600;">ğŸ”„ Entropy Change: Î”S = Q/T</h4>
        
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px;">
            <div>
                <label for="thermo-heat-flow" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Heat Flow (Q)
                </label>
                <input id="thermo-heat-flow" type="number" min="-10000" max="10000" value="1000" step="100"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(var(--accent-rgb, 45,212,255),0.3);background:rgba(var(--accent-rgb, 45,212,255),0.05);color:inherit;font-size:16px;" />
            </div>
            
            <div>
                <label for="thermo-temperature" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Temperature (T)
                </label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input id="thermo-temperature" type="number" min="0" value="300" step="1"
                           style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(var(--accent-rgb, 45,212,255),0.3);background:rgba(var(--accent-rgb, 45,212,255),0.05);color:inherit;font-size:16px;" />
                    <select id="thermo-temp-scale" 
                            style="width:80px;padding:12px;border-radius:10px;border:1px solid rgba(var(--accent-rgb, 45,212,255),0.2);background:rgba(var(--accent-rgb, 45,212,255),0.1);color:inherit;">
                        <option value="K" selected>K</option>
                        <option value="C">Â°C</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CALCULATOR INPUTS - GAS LAWS -->
    <div id="thermo-gas-inputs" style="display:none;">
        <h4 style="color:#39ff14;margin-top:0;margin-bottom:16px;font-size:14px;font-weight:600;">ğŸ’¨ Ideal Gas Law: PV = nRT</h4>
        
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px;">
            <div>
                <label for="thermo-pressure" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Pressure (P)
                </label>
                <input id="thermo-pressure" type="number" min="0" value="101.3" step="1"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:16px;" />
            </div>
            
            <div>
                <label for="thermo-volume" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Volume (V)
                </label>
                <input id="thermo-volume" type="number" min="0" value="22.4" step="0.1"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:16px;" />
            </div>
            
            <div>
                <label for="thermo-moles" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Moles (n)
                </label>
                <input id="thermo-moles" type="number" min="0" value="1" step="0.1"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:16px;" />
            </div>
            
            <div>
                <label for="thermo-gas-temp" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Temperature
                </label>
                <input id="thermo-gas-temp" type="number" min="0" value="273.15" step="1"
                       style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:16px;" />
            </div>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="margin-top:24px;display:flex;gap:10px;">
        <button type="button" onclick="thermCalculate(this)" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1));border:1px solid rgba(255,77,77,0.4);border-radius:10px;color:#ff4d4d;cursor:pointer;font-weight:600;font-size:15px;">
            ğŸ”¬ Calculate & Analyze
        </button>
        <button type="button" onclick="thermReset(this)"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:inherit;cursor:pointer;">
            Reset
        </button>
        <button type="button" onclick="thermCopyResults(this)"
                style="padding:14px 20px;background:linear-gradient(135deg, rgba(var(--accent-rgb, 45,212,255),0.1), rgba(var(--accent-rgb, 45,212,255),0.05));border:1px solid rgba(var(--accent-rgb, 45,212,255),0.3);border-radius:10px;color:var(--accent);cursor:pointer;">
            Copy Results
        </button>
    </div>
</form>

<!-- RESULTS SECTION -->
<div class="results" aria-live="polite" style="margin-top:20px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:16px;font-weight:600;">ğŸ“Š Calculation Results & Analysis</h3>
    
    <!-- MAIN RESULTS DISPLAY -->
    <div id="therm-main-results" style="background:linear-gradient(135deg, rgba(255,77,77,0.1), rgba(255,77,77,0.05));border:2px solid rgba(255,77,77,0.3);border-radius:12px;padding:20px;margin-bottom:20px;text-align:center;">
        <div style="font-size:13px;color:rgba(255,255,255,0.8);margin-bottom:6px;">Thermodynamics Calculation</div>
        <div id="therm-result-value" style="font-size:42px;font-weight:700;color:#ff4d4d;line-height:1;margin-bottom:8px;">--</div>
        <div style="font-size:14px;color:rgba(255,255,255,0.7);" id="therm-result-formula">Formula: Q = mÂ·cÂ·Î”T</div>
    </div>
    
    <!-- DETAILED ANALYSIS -->
    <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.05);">
        <h4 style="color:var(--accent);margin:0 0 12px 0;font-size:14px;font-weight:600;">ğŸ“ˆ Detailed Analysis</h4>
        <div id="therm-analysis" style="color:rgba(var(--text-rgb, 230,250,255),0.9);font-size:14px;line-height:1.5;">
            Enter values and click "Calculate & Analyze" to see detailed thermodynamic analysis.
        </div>
    </div>
    
    <!-- THERMODYNAMIC LAWS REFERENCE -->
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px;">
        <div style="background:linear-gradient(135deg, rgba(255,77,77,0.08), rgba(255,77,77,0.04));border:1px solid rgba(255,77,77,0.2);border-radius:10px;padding:12px;">
            <div style="font-size:12px;color:rgba(255,77,77,0.9);margin-bottom:4px;">First Law</div>
            <div style="font-size:15px;font-weight:600;color:#ff4d4d;">Î”U = Q - W</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Energy Conservation</div>
        </div>
        
        <div style="background:linear-gradient(135deg, rgba(255,204,0,0.08), rgba(255,204,0,0.04));border:1px solid rgba(255,204,0,0.2);border-radius:10px;padding:12px;">
            <div style="font-size:12px;color:rgba(255,204,0,0.9);margin-bottom:4px;">Second Law</div>
            <div style="font-size:15px;font-weight:600;color:#ffcc00;">Î”S â‰¥ 0</div>
            <div style="font-size:11px;color:rgba(255,255,255,0.6);">Entropy Increases</div>
        </div>
    </div>
</div>

<!-- THERMODYNAMICS ENCYCLOPEDIA -->
<details style="margin-top:20px;border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:12px;background:rgba(0,0,0,0.15);">
    <summary style="color:var(--accent);font-weight:600;cursor:pointer;outline:none;user-select:none;">ğŸ“š Thermodynamics Encyclopedia</summary>
    <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05);">
        
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:16px;">
            <div>
                <div style="color:#ff4d4d;font-weight:600;margin-bottom:4px;">Fundamental Laws</div>
                <div style="color:rgba(var(--text-rgb, 230,250,255),0.8);font-size:13px;line-height:1.5;">
                    â€¢ <strong>Zeroth Law:</strong> Defines temperature equilibrium<br>
                    â€¢ <strong>First Law:</strong> Energy cannot be created or destroyed<br>
                    â€¢ <strong>Second Law:</strong> Entropy always increases<br>
                    â€¢ <strong>Third Law:</strong> Absolute zero is unattainable
                </div>
            </div>
            <div>
                <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">Key Concepts</div>
                <div style="color:rgba(var(--text-rgb, 230,250,255),0.8);font-size:13px;line-height:1.5;">
                    â€¢ <strong>Enthalpy (H):</strong> Total heat content<br>
                    â€¢ <strong>Entropy (S):</strong> Measure of disorder<br>
                    â€¢ <strong>Gibbs Free Energy:</strong> Predicts spontaneity<br>
                    â€¢ <strong>Heat Capacity:</strong> Temperature change per heat
                </div>
            </div>
        </div>
        
        <div style="background:rgba(var(--accent-rgb, 45,212,255),0.05);border-radius:8px;padding:12px;border-left:3px solid var(--accent);margin-bottom:12px;">
            <strong style="color:var(--accent);">Important Constants:</strong><br>
            <span style="color:rgba(var(--text-rgb, 230,250,255),0.9);font-size:13px;">
                â€¢ <strong>Gas Constant (R):</strong> 8.314 J/molÂ·K<br>
                â€¢ <strong>Boltzmann Constant (k):</strong> 1.381Ã—10â»Â²Â³ J/K<br>
                â€¢ <strong>Avogadro's Number:</strong> 6.022Ã—10Â²Â³ molâ»Â¹<br>
                â€¢ <strong>Stefan-Boltzmann Constant:</strong> 5.67Ã—10â»â¸ W/mÂ²Kâ´
            </span>
        </div>
        
        <div style="background:rgba(255,77,77,0.05);border-radius:8px;padding:12px;margin-bottom:12px;border-left:3px solid #ff4d4d;">
            <strong style="color:#ff4d4d;">Fascinating Thermodynamics Facts:</strong><br>
            <div style="color:rgba(var(--text-rgb, 230,250,255),0.9);font-size:13px;margin-top:8px;">
                1. <strong>Sun's Power:</strong> Outputs ~3.8Ã—10Â²â¶ W (equivalent to 100 billion 1-megaton bombs/sec)<br>
                2. <strong>Absolute Zero:</strong> Theoretical limit of -273.15Â°C where molecular motion stops<br>
                3. <strong>Human Body:</strong> Radiates ~100W of heat at rest (like a bright lightbulb)<br>
                4. <strong>Max Efficiency:</strong> Carnot limit = 1 - (Tâ‚‘/Tâ‚•) sets fundamental efficiency cap<br>
                5. <strong>Black Holes:</strong> Have entropy proportional to their surface area<br>
                6. <strong>Refrigerators:</strong> Violate 2nd Law? No, they use work to move heat "uphill"<br>
                7. <strong>Universe's Fate:</strong> Heat death predicted when maximum entropy is reached<br>
                8. <strong>DNA Replication:</strong> Driven by thermodynamics and entropy changes
            </div>
        </div>
        
        <p style="color:rgba(var(--text-rgb, 230,250,255),0.7);font-size:13px;line-height:1.5;margin-top:12px;">
            <span style="color:#ffcc00;">âš ï¸ Scientific Note:</span> Thermodynamics governs energy flow in all physical systems, 
            from microscopic chemical reactions to stellar fusion. These calculations provide approximate values 
            for educational purposes. Real-world applications require consideration of additional factors 
            like phase changes, non-ideal behavior, and system boundaries.
        </p>
    </div>
</details>

<!-- SCRIPT -->
<script>
/* thermodynamics.html - Thermodynamics Calculator & Encyclopedia
   - Prefix: therm
   - Calculates heat transfer, efficiency, entropy, and gas laws
   - Educational tool with scientific encyclopedia
*/

let thermCurrentTool = 'heat-transfer';

// Set active calculator tool
function thermSetTool(tool) {
    thermCurrentTool = tool;
    const card = document.currentScript?.closest('.card') || document;
    
    // Update hidden select
    const select = card.querySelector('#thermo-tool');
    select.value = tool;
    
    // Update button styles
    const buttons = ['heat-transfer', 'efficiency', 'entropy', 'gas-law'];
    buttons.forEach(btnType => {
        const btn = card.querySelector(`#thermo-btn-${btnType.split('-')[0]}`);
        if (btn) {
            if (btnType === tool) {
                btn.style.border = '2px solid';
                btn.style.fontWeight = '600';
            } else {
                btn.style.border = '1px solid';
                btn.style.fontWeight = '500';
            }
        }
    });
    
    // Show/hide input sections
    const sections = ['heat', 'efficiency', 'entropy', 'gas'];
    sections.forEach(section => {
        const element = card.querySelector(`#thermo-${section}-inputs`);
        if (element) {
            element.style.display = section === tool.split('-')[0] ? 'block' : 'none';
        }
    });
    
    // Update result display formula
    const formulaDisplay = card.querySelector('#therm-result-formula');
    const formulas = {
        'heat-transfer': 'Formula: Q = mÂ·cÂ·Î”T',
        'efficiency': 'Formula: Î· = (W/Qâ‚•) Ã— 100%',
        'entropy': 'Formula: Î”S = Q/T',
        'gas-law': 'Formula: PV = nRT'
    };
    formulaDisplay.textContent = formulas[tool] || 'Select a calculation tool';
    
    console.log(`Thermodynamics tool set to: ${tool}`);
}

// Set material preset for heat transfer
function thermSetMaterialPreset() {
    const card = document.currentScript?.closest('.card') || document;
    const materialSelect = card.querySelector('#thermo-material');
    const capacityInput = card.querySelector('#thermo-heat-capacity');
    
    const presets = {
        'water': 4.18,
        'aluminum': 0.897,
        'iron': 0.449,
        'copper': 0.385,
        'air': 1.005
    };
    
    const presetValue = presets[materialSelect.value];
    if (presetValue) {
        capacityInput.value = presetValue;
    }
}

// Set efficiency preset
function thermSetEfficiency(work, heat) {
    const card = document.currentScript?.closest('.card') || document;
    card.querySelector('#thermo-work').value = work;
    card.querySelector('#thermo-heat-input').value = heat;
}

// Convert temperature units
function thermConvertToKelvin(value, unit) {
    if (unit === 'C') {
        return value + 273.15;
    }
    return value; // Already in Kelvin
}

// Main calculation function
function thermCalculate(btn = null) {
    const card = btn ? btn.closest('.card') : (document.currentScript?.closest('.card') || document);
    
    try {
        let result = 0;
        let unit = '';
        let analysis = '';
        let formula = '';
        
        switch (thermCurrentTool) {
            case 'heat-transfer':
                // Q = mÂ·cÂ·Î”T
                let mass = parseFloat(card.querySelector('#thermo-mass').value) || 0;
                const massUnit = card.querySelector('#thermo-mass-unit').value;
                const specificHeat = parseFloat(card.querySelector('#thermo-heat-capacity').value) || 0;
                const deltaT = parseFloat(card.querySelector('#thermo-temp-change').value) || 0;
                const tempUnit = card.querySelector('#thermo-temp-unit').value;
                
                // Convert mass to kg if in grams
                if (massUnit === 'g') {
                    mass = mass / 1000;
                }
                
                // Convert Î”T to Kelvin if in Celsius
                let deltaTKelvin = deltaT;
                if (tempUnit === 'C') {
                    deltaTKelvin = deltaT; // Î”T in Â°C equals Î”T in K
                }
                
                result = mass * specificHeat * deltaTKelvin;
                unit = 'J';
                formula = `Q = ${mass.toFixed(3)} kg Ã— ${specificHeat} J/gÂ·K Ã— ${deltaT} ${tempUnit}`;
                
                analysis = `Heat Transfer Analysis:\n`;
                analysis += `â€¢ Mass: ${mass.toFixed(3)} kg\n`;
                analysis += `â€¢ Specific Heat: ${specificHeat} J/gÂ·K\n`;
                analysis += `â€¢ Temperature Change: ${deltaT} ${tempUnit}\n`;
                analysis += `â€¢ Energy Required: ${result.toExponential(3)} J\n`;
                analysis += `\nReal-World Context:\n`;
                if (mass > 0.1) {
                    const waterEquivalent = result / 4180; // Heat to boil 1kg water from 20Â°C
                    analysis += `â€¢ Could heat ${(waterEquivalent).toFixed(2)} kg of water from 20Â°C to 100Â°C\n`;
                }
                break;
                
            case 'efficiency':
                // Î· = (W/Qâ‚•) Ã— 100%
                const work = parseFloat(card.querySelector('#thermo-work').value) || 0;
                const heatInput = parseFloat(card.querySelector('#thermo-heat-input').value) || 0;
                
                if (heatInput === 0) {
                    throw new Error('Heat input cannot be zero for efficiency calculation');
                }
                
                result = (work / heatInput) * 100;
                unit = '%';
                formula = `Î· = (${work} J / ${heatInput} J) Ã— 100%`;
                
                analysis = `Efficiency Analysis:\n`;
                analysis += `â€¢ Work Output: ${work} J\n`;
                analysis += `â€¢ Heat Input: ${heatInput} J\n`;
                analysis += `â€¢ Efficiency: ${result.toFixed(2)}%\n`;
                analysis += `â€¢ Energy Loss: ${(heatInput - work).toFixed(2)} J\n`;
                analysis += `\nComparison:\n`;
                if (result < 20) analysis += `â€¢ Typical steam engine range\n`;
                else if (result < 40) analysis += `â€¢ Modern internal combustion engine\n`;
                else if (result < 50) analysis += `â€¢ High-performance engine\n`;
                else analysis += `â€¢ Exceeds Carnot limit for typical temperatures\n`;
                break;
                
            case 'entropy':
                // Î”S = Q/T
                const heatFlow = parseFloat(card.querySelector('#thermo-heat-flow').value) || 0;
                const temperature = parseFloat(card.querySelector('#thermo-temperature').value) || 0;
                const tempScale = card.querySelector('#thermo-temp-scale').value;
                
                if (temperature === 0) {
                    throw new Error('Temperature cannot be zero for entropy calculation');
                }
                
                const tempKelvin = thermConvertToKelvin(temperature, tempScale);
                result = heatFlow / tempKelvin;
                unit = 'J/K';
                formula = `Î”S = ${heatFlow} J / ${tempKelvin.toFixed(2)} K`;
                
                analysis = `Entropy Change Analysis:\n`;
                analysis += `â€¢ Heat Flow: ${heatFlow} J\n`;
                analysis += `â€¢ Temperature: ${temperature} ${tempScale} (${tempKelvin.toFixed(2)} K)\n`;
                analysis += `â€¢ Entropy Change: ${result.toExponential(3)} J/K\n`;
                analysis += `\nInterpretation:\n`;
                if (result > 0) analysis += `â€¢ Entropy increases (spontaneous process)\n`;
                else if (result < 0) analysis += `â€¢ Entropy decreases (requires work input)\n`;
                else analysis += `â€¢ No entropy change (reversible process)\n`;
                break;
                
            case 'gas-law':
                // PV = nRT
                const pressure = parseFloat(card.querySelector('#thermo-pressure').value) || 0;
                const volume = parseFloat(card.querySelector('#thermo-volume').value) || 0;
                const moles = parseFloat(card.querySelector('#thermo-moles').value) || 0;
                const gasTemp = parseFloat(card.querySelector('#thermo-gas-temp').value) || 0;
                
                const R = 8.314; // J/molÂ·K
                result = (pressure * volume) / (moles * gasTemp);
                unit = 'J/molÂ·K';
                formula = `R = (${pressure} kPa Ã— ${volume} L) / (${moles} mol Ã— ${gasTemp} K)`;
                
                analysis = `Ideal Gas Law Analysis:\n`;
                analysis += `â€¢ Pressure: ${pressure} kPa\n`;
                analysis += `â€¢ Volume: ${volume} L\n`;
                analysis += `â€¢ Moles: ${moles} mol\n`;
                analysis += `â€¢ Temperature: ${gasTemp} K\n`;
                analysis += `â€¢ Calculated R: ${result.toFixed(3)} J/molÂ·K\n`;
                analysis += `â€¢ Actual R: 8.314 J/molÂ·K\n`;
                analysis += `â€¢ Deviation: ${((result - R) / R * 100).toFixed(2)}%\n`;
                analysis += `\nGas Properties:\n`;
                if (moles === 1 && gasTemp === 273.15 && pressure === 101.3 && Math.abs(volume - 22.4) < 0.1) {
                    analysis += `â€¢ Standard Temperature and Pressure (STP)\n`;
                    analysis += `â€¢ Molar volume: 22.4 L/mol\n`;
                }
                break;
                
            default:
                throw new Error('Please select a valid calculation tool');
        }
        
        // Update displays
        const resultDisplay = card.querySelector('#therm-result-value');
        const analysisDisplay = card.querySelector('#therm-analysis');
        
        if (thermCurrentTool === 'efficiency') {
            resultDisplay.textContent = result.toFixed(2) + unit;
        } else {
            if (Math.abs(result) >= 1000) {
                resultDisplay.textContent = result.toExponential(3) + ' ' + unit;
            } else {
                resultDisplay.textContent = result.toFixed(3) + ' ' + unit;
            }
        }
        
        analysisDisplay.textContent = analysis;
        
        // Update formula display
        card.querySelector('#therm-result-formula').textContent = formula;
        
        // Visual feedback
        const mainResults = card.querySelector('#therm-main-results');
        if (mainResults) {
            mainResults.style.animation = 'pulse 0.5s ease';
            setTimeout(() => {
                mainResults.style.animation = '';
            }, 500);
        }
        
        console.log(`Thermodynamics calculation complete: ${result} ${unit}`);
        
    } catch (error) {
        // Show error to user
        const resultDisplay = card.querySelector('#therm-result-value');
        resultDisplay.textContent = 'Error';
        resultDisplay.style.color = '#ff2d55';
        
        const analysisDisplay = card.querySelector('#therm-analysis');
        analysisDisplay.textContent = `Error: ${error.message}\n\nPlease check your inputs and try again.`;
        analysisDisplay.style.color = '#ff4d4d';
        
        console.error('Thermodynamics Calculator Error:', error.message);
        
        // Optional: Show alert for user
        if (btn) {
            alert('Calculation Error: ' + error.message);
        }
    }
}

// Copy results to clipboard
function thermCopyResults(btn) {
    const card = btn.closest('.card') || document;
    const resultValue = card.querySelector('#therm-result-value').textContent;
    const analysis = card.querySelector('#therm-analysis').textContent;
    
    if (resultValue === '--') {
        alert('No results to copy. Please calculate first.');
        return;
    }
    
    const textToCopy = `Thermodynamics Calculation Result:\n` +
                      `================\n` +
                      `Result: ${resultValue}\n` +
                      `================\n` +
                      `Analysis:\n${analysis}\n` +
                      `\nCalculated using The Most Useful Site in the World`;
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        // Visual feedback
        const originalText = btn.textContent;
        btn.textContent = 'âœ“ Copied!';
        btn.style.background = 'rgba(57,255,20,0.2)';
        btn.style.borderColor = 'rgba(57,255,20,0.4)';
        btn.style.color = '#39ff14';
        
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = 'linear-gradient(135deg, rgba(var(--accent-rgb, 45,212,255),0.1), rgba(var(--accent-rgb, 45,212,255),0.05))';
            btn.style.borderColor = 'rgba(var(--accent-rgb, 45,212,255),0.3)';
            btn.style.color = 'var(--accent)';
        }, 2000);
        
        console.log('Thermodynamics results copied to clipboard');
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('Copy failed. Please select and copy manually.');
    });
}

// Reset all inputs
function thermReset(btn) {
    const card = btn.closest('.card') || document;
    
    // Reset heat transfer inputs
    card.querySelector('#thermo-mass').value = 1;
    card.querySelector('#thermo-heat-capacity').value = 4.18;
    card.querySelector('#thermo-temp-change').value = 10;
    card.querySelector('#thermo-material').value = 'custom';
    
    // Reset efficiency inputs
    card.querySelector('#thermo-work').value = 100;
    card.querySelector('#thermo-heat-input').value = 500;
    
    // Reset entropy inputs
    card.querySelector('#thermo-heat-flow').value = 1000;
    card.querySelector('#thermo-temperature').value = 300;
    
    // Reset gas law inputs
    card.querySelector('#thermo-pressure').value = 101.3;
    card.querySelector('#thermo-volume').value = 22.4;
    card.querySelector('#thermo-moles').value = 1;
    card.querySelector('#thermo-gas-temp').value = 273.15;
    
    // Reset displays
    card.querySelector('#therm-result-value').textContent = '--';
    card.querySelector('#therm-result-value').style.color = '#ff4d4d';
    card.querySelector('#therm-analysis').textContent = 'Enter values and click "Calculate & Analyze" to see detailed thermodynamic analysis.';
    card.querySelector('#therm-analysis').style.color = 'rgba(var(--text-rgb, 230,250,255),0.9)';
    card.querySelector('#therm-result-formula').textContent = 'Formula: Q = mÂ·cÂ·Î”T';
    
    // Reset to heat transfer calculator
    thermSetTool('heat-transfer');
    
    console.log('Thermodynamics Calculator reset');
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Set up material preset listener
        const materialSelect = card.querySelector('#thermo-material');
        if (materialSelect) {
            materialSelect.addEventListener('change', thermSetMaterialPreset);
        }
        
        // Set up auto-calculation on some inputs
        const autoCalcInputs = card.querySelectorAll('input[type="number"]');
        autoCalcInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (thermCurrentTool === 'heat-transfer' || thermCurrentTool === 'gas-law') {
                    setTimeout(thermCalculate, 300); // Debounced calculation
                }
            });
        });
        
        // Initial state
        thermSetTool('heat-transfer');
        
        console.log('Thermodynamics Calculator initialized');
    });
} else {
    // Run immediately if already loaded
    setTimeout(() => {
        thermSetTool('heat-transfer');
    }, 100);
}
</script>

<!-- CARD-SPECIFIC STYLES -->
<style>
/* Pulse animation for results */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

/* Calculator button hover effects */
button[onclick*="thermSetTool"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    transition: all 0.2s ease;
}

/* Input focus effects */
input[type="number"]:focus, select:focus {
    outline: none;
    border-color: var(--accent) !important;
    box-shadow: 0 0 0 2px rgba(var(--accent-rgb, 45,212,255),0.2);
    transition: all 0.2s ease;
}

/* Preset button styling */
button[onclick*="thermSetEfficiency"] {
    transition: all 0.2s ease;
}

button[onclick*="thermSetEfficiency"]:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    #thermodynamics-title {
        font-size: 1.3rem !important;
    }
    
    #therm-result-value {
        font-size: 36px !important;
    }
    
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
        margin: 4px 0 !important;
    }
    
    /* Stack calculator buttons */
    .field > div[style*="display:flex;gap:8px;flex-wrap:wrap;"] {
        flex-direction: column;
    }
    
    /* Stack grids on mobile */
    form > div[style*="grid-template-columns:repeat(2,1fr)"] {
        grid-template-columns: 1fr !important;
    }
    
    /* Stack encyclopedia grid */
    details > div > div[style*="grid-template-columns:repeat(2,1fr)"] {
        grid-template-columns: 1fr !important;
    }
}

/* Small screen adjustments */
@media (max-width: 480px) {
    #thermodynamics-title {
        font-size: 1.1rem !important;
    }
    
    #therm-result-value {
        font-size: 32px !important;
    }
    
    /* Adjust button sizes */
    button[style*="padding:12px;"] {
        padding: 10px !important;
        font-size: 14px !important;
    }
    
    /* Stack laws reference */
    .results > div[style*="grid-template-columns:repeat(2,1fr)"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
