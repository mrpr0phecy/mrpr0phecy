<h2 id="travel-planner-title">‚úàÔ∏è Travel Trip Planner</h2>

<form aria-describedby="travel-planner-desc">
  <p id="travel-planner-desc" class="small">
    Plan your perfect trip with detailed itineraries, budget tracking, and smart recommendations.
    <span style="color:var(--accent)">Get personalized suggestions based on your preferences!</span>
  </p>
  
  <!-- Trip Details -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;margin-bottom:20px;">
    <!-- Destination -->
    <div class="field">
      <label for="tp-destination" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Destination
      </label>
      <div style="position:relative;">
        <input id="tp-destination" type="text" placeholder="e.g. Paris, France" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
    </div>
    
    <!-- Start Date -->
    <div class="field">
      <label for="tp-start-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Start Date
      </label>
      <input id="tp-start-date" type="date" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
    </div>
    
    <!-- End Date -->
    <div class="field">
      <label for="tp-end-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        End Date
      </label>
      <input id="tp-end-date" type="date" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
    </div>
  </div>
  
  <!-- Travel Party -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üë• Travel Party</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div>
        <label for="tp-adults" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">
          Adults
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <button type="button" onclick="tpAdjustTravelers('adults', -1)" 
                  style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
            ‚àí
          </button>
          <input id="tp-adults" type="number" min="1" max="10" value="2" 
                 style="width:60px;padding:8px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <button type="button" onclick="tpAdjustTravelers('adults', 1)" 
                  style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
            +
          </button>
        </div>
      </div>
      
      <div>
        <label for="tp-children" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">
          Children
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <button type="button" onclick="tpAdjustTravelers('children', -1)" 
                  style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
            ‚àí
          </button>
          <input id="tp-children" type="number" min="0" max="10" value="0" 
                 style="width:60px;padding:8px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <button type="button" onclick="tpAdjustTravelers('children', 1)" 
                  style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
            +
          </button>
        </div>
      </div>
      
      <div>
        <label for="tp-trip-style" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">
          Trip Style
        </label>
        <select id="tp-trip-style" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;">
          <option value="budget">Budget</option>
          <option value="midrange" selected>Mid-Range</option>
          <option value="luxury">Luxury</option>
          <option value="backpacker">Backpacker</option>
          <option value="family">Family</option>
          <option value="romantic">Romantic</option>
        </select>
      </div>
      
      <div>
        <label for="tp-accommodation" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">
          Accommodation
        </label>
        <select id="tp-accommodation" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:13px;">
          <option value="hotel" selected>Hotel</option>
          <option value="hostel">Hostel</option>
          <option value="airbnb">Airbnb/Apartment</option>
          <option value="resort">Resort</option>
          <option value="camping">Camping</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- Budget -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üí∞ Budget Planning</div>
    
    <!-- Total Budget -->
    <div style="margin-bottom:16px;">
      <label for="tp-budget" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-weight:500;font-size:13px;">
        Total Budget
      </label>
      <div style="display:flex;align-items:center;gap:12px;">
        <select id="tp-currency" 
                style="padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
          <option value="GBP">¬£ GBP</option>
          <option value="USD">$ USD</option>
          <option value="EUR">‚Ç¨ EUR</option>
          <option value="JPY">¬• JPY</option>
        </select>
        <input id="tp-budget" type="number" min="0" step="10" value="1500" 
               style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
    </div>
    
    <!-- Budget Breakdown -->
    <div>
      <div style="font-size:13px;color:rgba(230,250,255,0.9);margin-bottom:8px;">Budget Breakdown (Auto-calculated)</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:8px;">
        <div style="padding:8px;background:rgba(45,212,255,0.05);border-radius:6px;text-align:center;">
          <div id="tp-budget-accommodation" style="font-size:14px;color:#2dd4ff;font-weight:600;">¬£450</div>
          <div style="font-size:10px;color:rgba(230,250,255,0.7);">Accommodation</div>
        </div>
        <div style="padding:8px;background:rgba(57,255,20,0.05);border-radius:6px;text-align:center;">
          <div id="tp-budget-food" style="font-size:14px;color:#39ff14;font-weight:600;">¬£450</div>
          <div style="font-size:10px;color:rgba(230,250,255,0.7);">Food & Dining</div>
        </div>
        <div style="padding:8px;background:rgba(255,204,0,0.05);border-radius:6px;text-align:center;">
          <div id="tp-budget-activities" style="font-size:14px;color:#ffcc00;font-weight:600;">¬£300</div>
          <div style="font-size:10px;color:rgba(230,250,255,0.7);">Activities</div>
        </div>
        <div style="padding:8px;background:rgba(255,77,77,0.05);border-radius:6px;text-align:center;">
          <div id="tp-budget-transport" style="font-size:14px;color:#ff4d4d;font-weight:600;">¬£300</div>
          <div style="font-size:10px;color:rgba(230,250,255,0.7);">Transport</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Quick Destinations -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üåç Quick Destinations</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:8px;">
      <button type="button" onclick="tpLoadDestination('paris')" 
              style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">üá´üá∑ Paris</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">5 days, ¬£1200</div>
      </button>
      <button type="button" onclick="tpLoadDestination('tokyo')" 
              style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">üáØüáµ Tokyo</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">7 days, ¬£1800</div>
      </button>
      <button type="button" onclick="tpLoadDestination('bali')" 
              style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">üáÆüá© Bali</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">10 days, ¬£1500</div>
      </button>
      <button type="button" onclick="tpLoadDestination('nyc')" 
              style="padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">üá∫üá∏ New York</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">6 days, ¬£2000</div>
      </button>
    </div>
  </div>
  
  <!-- Actions -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
    <button type="button" onclick="tpPlanTrip()" 
            style="flex:1;min-width:200px;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ‚úàÔ∏è Plan My Trip
    </button>
    <button type="button" onclick="tpSavePlan()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      üíæ Save Plan
    </button>
    <button type="button" onclick="tpReset()"
            style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
      üîÑ Reset
    </button>
  </div>
</form>

<!-- Results -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìã Trip Plan & Itinerary</h3>
  
  <!-- Trip Summary -->
  <div id="tp-output" style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);font-family:monospace;white-space:pre-line;max-height:400px;overflow-y:auto;">
    Enter your trip details to generate a personalized travel plan.
  </div>
  
  <!-- Detailed Itinerary -->
  <div id="tp-itinerary" style="display:none;margin-top:16px;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(57,255,20,0.2);">
      <div style="color:#39ff14;font-weight:500;margin-bottom:12px;">üìÖ Daily Itinerary</div>
      <div id="tp-itinerary-content" style="font-size:14px;line-height:1.5;color:rgba(230,250,255,0.9);">
        Daily itinerary will appear here...
      </div>
    </div>
  </div>
  
  <!-- Packing List -->
  <div id="tp-packing" style="display:none;margin-top:16px;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,204,0,0.2);">
      <div style="color:#ffcc00;font-weight:500;margin-bottom:12px;">üéí Smart Packing List</div>
      <div id="tp-packing-content" style="font-size:14px;line-height:1.5;color:rgba(230,250,255,0.9);">
        Packing list will appear here...
      </div>
    </div>
  </div>
  
  <!-- Travel Tips -->
  <div style="margin-top:16px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üí° Travel Planning Tips</div>
    <ul style="list-style:disc;padding-left:20px;margin:0;font-size:13px;color:rgba(230,250,255,0.8);line-height:1.5;">
      <li>Book flights 6-8 weeks in advance for best prices</li>
      <li>Check visa requirements for your destination</li>
      <li>Notify your bank about international travel</li>
      <li>Purchase travel insurance for unexpected events</li>
      <li>Learn basic phrases in the local language</li>
      <li>Check weather forecasts before packing</li>
    </ul>
    <div style="margin-top:12px;padding:10px;background:rgba(255,204,0,0.1);border-radius:6px;border:1px solid rgba(255,204,0,0.3);">
      <span style="color:#ffcc00;font-weight:500;">‚ö†Ô∏è Important:</span>
      <span style="font-size:12px;"> Always check official government travel advisories and local restrictions before finalizing your trip.</span>
    </div>
  </div>
</div>

<script>
/* travel-planner.html - Enhanced Travel Trip Planner
   - Comprehensive travel planning with itinerary generation
   - Budget allocation and packing list generator
   - Scoped with tp- prefix (Travel Planner)
*/

// Currency symbols for display
const tpCurrencySymbols = {
    'GBP': '¬£',
    'USD': '$',
    'EUR': '‚Ç¨',
    'JPY': '¬•'
};

// Destination database
const tpDestinations = {
    'paris': {
        name: 'Paris, France',
        days: 5,
        budget: 1200,
        style: 'romantic',
        currency: 'GBP',
        season: 'Spring/Fall',
        highlights: ['Eiffel Tower', 'Louvre Museum', 'Montmartre', 'Seine River Cruise']
    },
    'tokyo': {
        name: 'Tokyo, Japan',
        days: 7,
        budget: 1800,
        style: 'urban',
        currency: 'GBP',
        season: 'Spring/Fall',
        highlights: ['Shibuya Crossing', 'Tsukiji Market', 'Meiji Shrine', 'Akihabara']
    },
    'bali': {
        name: 'Bali, Indonesia',
        days: 10,
        budget: 1500,
        style: 'beach',
        currency: 'GBP',
        season: 'Dry Season (Apr-Oct)',
        highlights: ['Ubud Rice Terraces', 'Uluwatu Temple', 'Seminyak Beach', 'Mount Batur']
    },
    'nyc': {
        name: 'New York City, USA',
        days: 6,
        budget: 2000,
        style: 'urban',
        currency: 'GBP',
        season: 'Spring/Fall',
        highlights: ['Times Square', 'Central Park', 'Statue of Liberty', 'Broadway Show']
    }
};

// Budget allocation percentages by trip style
const tpBudgetAllocations = {
    'budget': { accommodation: 30, food: 25, activities: 20, transport: 25 },
    'midrange': { accommodation: 35, food: 30, activities: 20, transport: 15 },
    'luxury': { accommodation: 45, food: 25, activities: 20, transport: 10 },
    'backpacker': { accommodation: 20, food: 30, activities: 25, transport: 25 },
    'family': { accommodation: 40, food: 30, activities: 20, transport: 10 },
    'romantic': { accommodation: 45, food: 30, activities: 20, transport: 5 }
};

// Initialize on load
function tpInitialize() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set default dates
    const today = new Date();
    const oneWeekLater = new Date(today);
    oneWeekLater.setDate(today.getDate() + 7);
    
    const formatDate = (date) => date.toISOString().split('T')[0];
    
    const startInput = card.querySelector('#tp-start-date');
    const endInput = card.querySelector('#tp-end-date');
    
    if (startInput && !startInput.value) {
        startInput.value = formatDate(today);
    }
    if (endInput && !endInput.value) {
        endInput.value = formatDate(oneWeekLater);
    }
    
    // Update budget breakdown when budget changes
    const budgetInput = card.querySelector('#tp-budget');
    if (budgetInput) {
        budgetInput.addEventListener('input', tpUpdateBudgetBreakdown);
    }
    
    // Update on style change
    const styleSelect = card.querySelector('#tp-trip-style');
    if (styleSelect) {
        styleSelect.addEventListener('change', tpUpdateBudgetBreakdown);
    }
    
    // Initial budget update
    tpUpdateBudgetBreakdown();
    
    console.log('Travel Planner initialized');
}

// Adjust number of travelers
function tpAdjustTravelers(type, change) {
    const card = document.currentScript?.closest('.card') || document;
    const input = card.querySelector(`#tp-${type}`);
    if (!input) return;
    
    let current = parseInt(input.value) || 0;
    if (type === 'adults') {
        current = Math.max(1, Math.min(10, current + change));
    } else {
        current = Math.max(0, Math.min(10, current + change));
    }
    
    input.value = current;
    tpUpdateBudgetBreakdown();
}

// Load destination preset
function tpLoadDestination(destKey) {
    const card = document.currentScript?.closest('.card') || document;
    const dest = tpDestinations[destKey];
    if (!dest) return;
    
    // Set destination
    const destInput = card.querySelector('#tp-destination');
    if (destInput) destInput.value = dest.name;
    
    // Set dates
    const today = new Date();
    const endDate = new Date(today);
    endDate.setDate(today.getDate() + dest.days);
    
    const startInput = card.querySelector('#tp-start-date');
    const endInput = card.querySelector('#tp-end-date');
    
    if (startInput) startInput.value = today.toISOString().split('T')[0];
    if (endInput) endInput.value = endDate.toISOString().split('T')[0];
    
    // Set budget
    const budgetInput = card.querySelector('#tp-budget');
    if (budgetInput) budgetInput.value = dest.budget;
    
    // Set style
    const styleSelect = card.querySelector('#tp-trip-style');
    if (styleSelect) styleSelect.value = dest.style;
    
    // Set currency
    const currencySelect = card.querySelector('#tp-currency');
    if (currencySelect) currencySelect.value = dest.currency;
    
    // Update budget breakdown
    tpUpdateBudgetBreakdown();
}

// Update budget breakdown
function tpUpdateBudgetBreakdown() {
    const card = document.currentScript?.closest('.card') || document;
    const budget = parseFloat(card.querySelector('#tp-budget').value) || 0;
    const style = card.querySelector('#tp-trip-style').value;
    const currency = card.querySelector('#tp-currency').value;
    
    const allocations = tpBudgetAllocations[style] || tpBudgetAllocations.midrange;
    
    // Calculate amounts
    const accommodation = budget * (allocations.accommodation / 100);
    const food = budget * (allocations.food / 100);
    const activities = budget * (allocations.activities / 100);
    const transport = budget * (allocations.transport / 100);
    
    // Format currency
    const symbol = tpCurrencySymbols[currency] || currency;
    
    // Update displays
    card.querySelector('#tp-budget-accommodation').textContent = 
        `${symbol}${accommodation.toFixed(0)}`;
    card.querySelector('#tp-budget-food').textContent = 
        `${symbol}${food.toFixed(0)}`;
    card.querySelector('#tp-budget-activities').textContent = 
        `${symbol}${activities.toFixed(0)}`;
    card.querySelector('#tp-budget-transport').textContent = 
        `${symbol}${transport.toFixed(0)}`;
}

// Calculate trip duration
function tpCalculateDuration(startDate, endDate) {
    const start = new Date(startDate);
    const end = new Date(endDate);
    const diffTime = Math.abs(end - start);
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}

// Main planning function
function tpPlanTrip() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Get inputs
    const destination = card.querySelector('#tp-destination').value.trim();
    const startDate = card.querySelector('#tp-start-date').value;
    const endDate = card.querySelector('#tp-end-date').value;
    const adults = parseInt(card.querySelector('#tp-adults').value) || 1;
    const children = parseInt(card.querySelector('#tp-children').value) || 0;
    const budget = parseFloat(card.querySelector('#tp-budget').value) || 0;
    const currency = card.querySelector('#tp-currency').value;
    const tripStyle = card.querySelector('#tp-trip-style').value;
    const accommodation = card.querySelector('#tp-accommodation').value;
    
    if (!destination) {
        card.querySelector('#tp-output').textContent = 'Please enter a destination to plan your trip.';
        return;
    }
    
    if (!startDate || !endDate) {
        card.querySelector('#tp-output').textContent = 'Please select both start and end dates.';
        return;
    }
    
    // Calculate duration
    const duration = tpCalculateDuration(startDate, endDate);
    if (duration <= 0) {
        card.querySelector('#tp-output').textContent = 'End date must be after start date.';
        return;
    }
    
    if (budget <= 0) {
        card.querySelector('#tp-output').textContent = 'Please enter a valid budget amount.';
        return;
    }
    
    // Get budget breakdown
    const allocations = tpBudgetAllocations[tripStyle] || tpBudgetAllocations.midrange;
    const dailyBudget = budget / duration;
    const totalTravelers = adults + children;
    
    // Currency formatting
    const symbol = tpCurrencySymbols[currency] || currency;
    
    // Generate trip summary
    let summary = `‚úàÔ∏è TRAVEL PLAN: ${destination.toUpperCase()}\n`;
    summary += '‚ïê'.repeat(40) + '\n\n';
    
    summary += `üìÖ TRIP DETAILS:\n`;
    summary += `  ‚Ä¢ Destination: ${destination}\n`;
    summary += `  ‚Ä¢ Dates: ${startDate} to ${endDate} (${duration} days)\n`;
    summary += `  ‚Ä¢ Travelers: ${adults} adult${adults !== 1 ? 's' : ''}`;
    if (children > 0) summary += `, ${children} child${children !== 1 ? 'ren' : ''}`;
    summary += `\n  ‚Ä¢ Style: ${tripStyle.charAt(0).toUpperCase() + tripStyle.slice(1)}\n`;
    summary += `  ‚Ä¢ Accommodation: ${accommodation.charAt(0).toUpperCase() + accommodation.slice(1)}\n\n`;
    
    summary += `üí∞ BUDGET SUMMARY:\n`;
    summary += `  ‚Ä¢ Total Budget: ${symbol}${budget.toFixed(2)}\n`;
    summary += `  ‚Ä¢ Daily Budget: ${symbol}${dailyBudget.toFixed(2)}/day\n`;
    if (totalTravelers > 1) {
        summary += `  ‚Ä¢ Per Person: ${symbol}${(budget / totalTravelers).toFixed(2)}\n`;
    }
    summary += `\n`;
    
    summary += `üìä BUDGET BREAKDOWN:\n`;
    summary += `  ‚Ä¢ Accommodation (${allocations.accommodation}%): ${symbol}${(budget * allocations.accommodation / 100).toFixed(2)}\n`;
    summary += `  ‚Ä¢ Food & Dining (${allocations.food}%): ${symbol}${(budget * allocations.food / 100).toFixed(2)}\n`;
    summary += `  ‚Ä¢ Activities (${allocations.activities}%): ${symbol}${(budget * allocations.activities / 100).toFixed(2)}\n`;
    summary += `  ‚Ä¢ Transport (${allocations.transport}%): ${symbol}${(budget * allocations.transport / 100).toFixed(2)}\n\n`;
    
    summary += `üéØ RECOMMENDATIONS:\n`;
    summary += `  ‚Ä¢ Book ${accommodation} 2-3 months in advance\n`;
    summary += `  ‚Ä¢ Use public transport to save ${symbol}${(budget * allocations.transport / 100 * 0.3).toFixed(2)}\n`;
    summary += `  ‚Ä¢ Research free activities to maximize budget\n`;
    summary += `  ‚Ä¢ Consider travel insurance (${symbol}${(budget * 0.05).toFixed(2)})\n`;
    
    // Update output
    card.querySelector('#tp-output').textContent = summary;
    
    // Generate and show itinerary
    const itinerary = tpGenerateItinerary(destination, duration, tripStyle);
    card.querySelector('#tp-itinerary-content').innerHTML = itinerary;
    card.querySelector('#tp-itinerary').style.display = 'block';
    
    // Generate and show packing list
    const packingList = tpGeneratePackingList(duration, tripStyle, accommodation);
    card.querySelector('#tp-packing-content').innerHTML = packingList;
    card.querySelector('#tp-packing').style.display = 'block';
}

// Generate daily itinerary
function tpGenerateItinerary(destination, duration, style) {
    const days = Math.min(duration, 7);
    const itineraryNames = {
        'romantic': 'Romantic Getaway',
        'urban': 'City Exploration',
        'beach': 'Beach Vacation',
        'budget': 'Budget Adventure',
        'family': 'Family Trip',
        'luxury': 'Luxury Experience',
        'backpacker': 'Backpacking Journey',
        'midrange': 'Balanced Vacation'
    };
    
    let itinerary = `<div style="margin-bottom:12px;color:#39ff14;font-weight:500;">${itineraryNames[style] || 'Custom Trip'}</div>`;
    
    for (let i = 1; i <= days; i++) {
        itinerary += `<div style="margin-bottom:10px;padding:10px;background:rgba(255,255,255,0.03);border-radius:6px;">`;
        itinerary += `<strong style="color:var(--accent);">Day ${i}:</strong> `;
        
        switch(style) {
            case 'romantic':
                itinerary += `Romantic breakfast, scenic walk, fine dining`;
                break;
            case 'urban':
                itinerary += `City landmarks, local markets, evening entertainment`;
                break;
            case 'beach':
                itinerary += `Beach time, water sports, sunset dinner`;
                break;
            case 'family':
                itinerary += `Kid-friendly attractions, parks, family dining`;
                break;
            default:
                itinerary += `Local exploration, cultural activities, relaxation`;
        }
        itinerary += `</div>`;
    }
    
    if (duration > 7) {
        itinerary += `<div style="color:rgba(57,255,20,0.7);font-size:12px;margin-top:8px;">`;
        itinerary += `+ ${duration - 7} more days of exploration planned`;
        itinerary += `</div>`;
    }
    
    return itinerary;
}

// Generate packing list
function tpGeneratePackingList(duration, style, accommodation) {
    let packing = '';
    
    // Essentials
    packing += `<div style="margin-bottom:10px;padding:8px;background:rgba(255,255,255,0.02);border-radius:6px;">`;
    packing += `<strong style="color:#ffcc00;">üì¶ Essentials:</strong><br>`;
    packing += `‚Ä¢ Passport & travel documents<br>`;
    packing += `‚Ä¢ Credit/debit cards & some cash<br>`;
    packing += `‚Ä¢ Phone charger & power bank<br>`;
    packing += `‚Ä¢ Travel adapter<br>`;
    packing += `‚Ä¢ Medications & first aid kit<br>`;
    packing += `‚Ä¢ Travel insurance details<br>`;
    packing += `</div>`;
    
    // Clothing
    const clothingItems = [];
    if (style === 'beach') {
        clothingItems.push('Swimwear (2-3 sets)', 'Beach cover-up', 'Sunglasses', 'Sun hat');
    } else if (style === 'urban' || style === 'romantic') {
        clothingItems.push('Smart casual outfits', 'Comfortable walking shoes', 'Evening wear');
    } else if (style === 'backpacker') {
        clothingItems.push('Quick-dry clothing', 'Hiking shoes', 'Lightweight layers');
    }
    
    clothingItems.push(`Underwear (${duration} sets)`, 'Socks', 'Sleepwear', 'Light jacket');
    
    packing += `<div style="margin-bottom:10px;padding:8px;background:rgba(255,255,255,0.02);border-radius:6px;">`;
    packing += `<strong style="color:#ffcc00;">üëï Clothing (${duration} days):</strong><br>`;
    clothingItems.forEach(item => packing += `‚Ä¢ ${item}<br>`);
    packing += `</div>`;
    
    // Toiletries
    packing += `<div style="padding:8px;background:rgba(255,255,255,0.02);border-radius:6px;">`;
    packing += `<strong style="color:#ffcc00;">üß¥ Toiletries:</strong><br>`;
    packing += `‚Ä¢ Toothbrush & toothpaste<br>`;
    packing += `‚Ä¢ Shampoo & conditioner<br>`;
    packing += `‚Ä¢ Sunscreen SPF 30+<br>`;
    packing += `‚Ä¢ Deodorant<br>`;
    if (accommodation === 'camping' || accommodation === 'hostel') {
        packing += `‚Ä¢ Quick-dry towel<br>`;
        packing += `‚Ä¢ Shower shoes<br>`;
    }
    packing += `</div>`;
    
    return packing;
}

// Save plan to localStorage
function tpSavePlan() {
    const card = document.currentScript?.closest('.card') || document;
    const destination = card.querySelector('#tp-destination').value;
    
    if (!destination) {
        alert('Please plan a trip before saving.');
        return;
    }
    
    const planData = {
        destination: destination,
        startDate: card.querySelector('#tp-start-date').value,
        endDate: card.querySelector('#tp-end-date').value,
        budget: card.querySelector('#tp-budget').value,
        timestamp: new Date().toISOString()
    };
    
    const savedPlans = JSON.parse(localStorage.getItem('tp_saved_plans') || '[]');
    savedPlans.push(planData);
    localStorage.setItem('tp_saved_plans', JSON.stringify(savedPlans));
    
    // Show confirmation
    const saveBtn = card.querySelector('button[onclick="tpSavePlan()"]');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = '‚úÖ Saved!';
    saveBtn.style.color = '#39ff14';
    
    setTimeout(() => {
        saveBtn.textContent = originalText;
        saveBtn.style.color = '';
    }, 2000);
}

// Reset form
function tpReset() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Reset inputs
    card.querySelector('#tp-destination').value = '';
    card.querySelector('#tp-adults').value = 2;
    card.querySelector('#tp-children').value = 0;
    card.querySelector('#tp-budget').value = 1500;
    card.querySelector('#tp-trip-style').value = 'midrange';
    card.querySelector('#tp-accommodation').value = 'hotel';
    card.querySelector('#tp-currency').value = 'GBP';
    
    // Set default dates
    const today = new Date();
    const oneWeekLater = new Date(today);
    oneWeekLater.setDate(today.getDate() + 7);
    
    card.querySelector('#tp-start-date').value = today.toISOString().split('T')[0];
    card.querySelector('#tp-end-date').value = oneWeekLater.toISOString().split('T')[0];
    
    // Reset outputs
    card.querySelector('#tp-output').textContent = 'Enter your trip details to generate a personalized travel plan.';
    card.querySelector('#tp-itinerary').style.display = 'none';
    card.querySelector('#tp-packing').style.display = 'none';
    
    // Update budget breakdown
    tpUpdateBudgetBreakdown();
}

// Initialize when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', tpInitialize);
} else {
    tpInitialize();
}

// Auto-update budget breakdown on input
document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    const budgetInput = card.querySelector('#tp-budget');
    if (budgetInput) {
        budgetInput.addEventListener('input', tpUpdateBudgetBreakdown);
    }
});
</script>

<style>
#travel-planner-title {
    color: var(--accent);
    margin-top: 0;
    font-size: 1.2rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .actions button {
        min-width: 100% !important;
        margin-bottom: 8px;
    }
    
    #tp-output {
        max-height: 300px;
        font-size: 14px;
    }
}

/* Scrollbar styling */
#tp-output::-webkit-scrollbar {
    width: 8px;
}

#tp-output::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 4px;
}

#tp-output::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 4px;
}
</style>
