<!-- cards/gpa-calculator-international.html -->

<h2 id="gpa-calculator-international-title">ğŸŒ International GPA Calculator</h2>

<form aria-describedby="gpa-desc">
  <p id="gpa-desc" class="small">Calculate GPA for universities worldwide. Supports multiple grading systems and conversions.</p>

  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
    <div>
      <label for="gpa-country" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Country/System</label>
      <select id="gpa-country" onchange="gpaUpdateGradeOptions()"
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <option value="us">ğŸ‡ºğŸ‡¸ United States (4.0 scale)</option>
        <option value="uk">ğŸ‡¬ğŸ‡§ United Kingdom (Classification)</option>
        <option value="eu">ğŸ‡ªğŸ‡º Europe (ECTS)</option>
        <option value="canada">ğŸ‡¨ğŸ‡¦ Canada (4.0/4.33)</option>
        <option value="australia">ğŸ‡¦ğŸ‡º Australia (7.0 scale)</option>
        <option value="india">ğŸ‡®ğŸ‡³ India (10.0 scale)</option>
        <option value="germany">ğŸ‡©ğŸ‡ª Germany (1.0-6.0)</option>
        <option value="france">ğŸ‡«ğŸ‡· France (20-point)</option>
        <option value="china">ğŸ‡¨ğŸ‡³ China (100-point)</option>
        <option value="japan">ğŸ‡¯ğŸ‡µ Japan (S/A/B/C/F)</option>
        <option value="brazil">ğŸ‡§ğŸ‡· Brazil (0-10)</option>
        <option value="southafrica">ğŸ‡¿ğŸ‡¦ South Africa (0-100%)</option>
      </select>
    </div>
    
    <div>
      <label for="gpa-grade" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Grade</label>
      <select id="gpa-grade" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        <!-- Options will be populated by JavaScript -->
      </select>
    </div>
    
    <div>
      <label for="gpa-credits" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Credits/ECTS</label>
      <input id="gpa-credits" type="number" min="0" step="0.5" placeholder="e.g. 3" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
    
    <div>
      <label for="gpa-course-name" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Course Name</label>
      <input id="gpa-course-name" type="text" placeholder="e.g. Calculus I" 
             style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
  </div>

  <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
    <button type="button" onclick="gpaAddCourse(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      â• Add Course
    </button>
    <button type="button" onclick="gpaCalculateAll(this)"
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
      ğŸ§® Calculate GPA
    </button>
    <button type="button" onclick="gpaResetForm(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset Form
    </button>
    <button type="button" onclick="gpaClearAll()"
            style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:8px;color:#ff4d4d;cursor:pointer;">
      Clear All
    </button>
  </div>
</form>

<div aria-live="polite" style="margin-top:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">ğŸ“š Course List</h3>
  <div id="gpa-courses-list" style="max-height:300px;overflow-y:auto;padding-right:8px;">
    <!-- Courses will appear here -->
    <div style="padding:30px;text-align:center;color:rgba(230,250,255,0.5);font-style:italic;">
      No courses added yet. Add your first course above!
    </div>
  </div>
</div>

<div style="margin-top:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
  <h4 style="color:var(--accent);margin-top:0;margin-bottom:12px;">ğŸ“Š GPA Results</h4>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
    <!-- Current System GPA -->
    <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;">
      <div style="color:var(--accent);font-size:13px;margin-bottom:4px;">Current System GPA</div>
      <div style="display:flex;align-items:baseline;gap:8px;">
        <div style="font-size:28px;font-weight:600;color:#39ff14;" id="gpa-current-system">0.00</div>
        <div style="color:rgba(230,250,255,0.7);font-size:12px;" id="gpa-current-scale">/4.0</div>
      </div>
    </div>
    
    <!-- Converted to 4.0 Scale -->
    <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;">
      <div style="color:#9d4edd;font-size:13px;margin-bottom:4px;">Converted to 4.0 Scale</div>
      <div style="display:flex;align-items:baseline;gap:8px;">
        <div style="font-size:28px;font-weight:600;color:#9d4edd;" id="gpa-converted-4">0.00</div>
        <div style="color:rgba(230,250,255,0.7);font-size:12px;">/4.0</div>
      </div>
    </div>
    
    <!-- Total Credits -->
    <div style="padding:12px;background:rgba(255,204,0,0.1);border-radius:8px;">
      <div style="color:#ffcc00;font-size:13px;margin-bottom:4px;">Total Credits</div>
      <div style="font-size:28px;font-weight:600;color:#ffcc00;" id="gpa-total-credits">0</div>
    </div>
    
    <!-- Grade Points -->
    <div style="padding:12px;background:rgba(255,107,157,0.1);border-radius:8px;">
      <div style="color:#ff6b9d;font-size:13px;margin-bottom:4px;">Total Grade Points</div>
      <div style="font-size:28px;font-weight:600;color:#ff6b9d;" id="gpa-total-points">0.00</div>
    </div>
  </div>
  
  <!-- International Conversions -->
  <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.1);">
    <div style="color:rgba(230,250,255,0.8);font-size:13px;margin-bottom:8px;">ğŸŒ International Equivalents:</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:8px;font-size:12px;">
      <div>
        <span style="color:var(--accent);">ğŸ‡¬ğŸ‡§ UK:</span>
        <span id="gpa-uk-grade" style="color:rgba(230,250,255,0.8);">N/A</span>
      </div>
      <div>
        <span style="color:var(--accent);">ğŸ‡ªğŸ‡º ECTS:</span>
        <span id="gpa-ects-grade" style="color:rgba(230,250,255,0.8);">N/A</span>
      </div>
      <div>
        <span style="color:var(--accent);">ğŸ‡¦ğŸ‡º AU:</span>
        <span id="gpa-au-grade" style="color:rgba(230,250,255,0.8);">N/A</span>
      </div>
      <div>
        <span style="color:var(--accent);">ğŸ‡®ğŸ‡³ IN:</span>
        <span id="gpa-in-grade" style="color:rgba(230,250,255,0.8);">N/A</span>
      </div>
    </div>
  </div>
</div>

<div style="margin-top:20px;padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.2);">
  <h4 style="color:#39ff14;margin-top:0;margin-bottom:12px;">ğŸ“– International Grading Systems Reference</h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;font-size:13px;">
    <div>
      <div style="color:#2dd4ff;font-weight:600;margin-bottom:4px;">ğŸ‡ºğŸ‡¸ USA (4.0 scale)</div>
      <div style="color:rgba(230,250,255,0.8);">A = 4.0, B = 3.0, C = 2.0, D = 1.0, F = 0.0</div>
    </div>
    <div>
      <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">ğŸ‡¬ğŸ‡§ UK (Honours)</div>
      <div style="color:rgba(230,250,255,0.8);">First (70+), Upper Second (60-69), Lower Second (50-59), Third (40-49)</div>
    </div>
    <div>
      <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">ğŸ‡ªğŸ‡º Europe (ECTS)</div>
      <div style="color:rgba(230,250,255,0.8);">A (10%), B (25%), C (30%), D (25%), E/F (10%)</div>
    </div>
    <div>
      <div style="color:#ff6b9d;font-weight:600;margin-bottom:4px;">ğŸ‡©ğŸ‡ª Germany (1.0-6.0)</div>
      <div style="color:rgba(230,250,255,0.8);">1.0-1.5 = Excellent, 1.6-2.5 = Good, 2.6-3.5 = Satisfactory, 3.6-4.0 = Sufficient, 4.1-6.0 = Fail</div>
    </div>
  </div>
</div>

<script>
/* gpa-calculator-international.html
   - International GPA calculator with multiple grading systems
   - Scoped with gpa- prefix
*/

// International grading systems database
const gradingSystems = {
  'us': {
    name: 'United States (4.0 scale)',
    flag: 'ğŸ‡ºğŸ‡¸',
    scale: 4.0,
    grades: [
      { label: 'A+ (4.0)', value: 4.0 },
      { label: 'A (4.0)', value: 4.0 },
      { label: 'A- (3.7)', value: 3.7 },
      { label: 'B+ (3.3)', value: 3.3 },
      { label: 'B (3.0)', value: 3.0 },
      { label: 'B- (2.7)', value: 2.7 },
      { label: 'C+ (2.3)', value: 2.3 },
      { label: 'C (2.0)', value: 2.0 },
      { label: 'C- (1.7)', value: 1.7 },
      { label: 'D+ (1.3)', value: 1.3 },
      { label: 'D (1.0)', value: 1.0 },
      { label: 'F (0.0)', value: 0.0 }
    ],
    to4Scale: (gpa) => gpa
  },
  'uk': {
    name: 'United Kingdom',
    flag: 'ğŸ‡¬ğŸ‡§',
    scale: 100,
    grades: [
      { label: 'First Class (70-100%)', value: 85 },
      { label: 'Upper Second (60-69%)', value: 65 },
      { label: 'Lower Second (50-59%)', value: 55 },
      { label: 'Third Class (40-49%)', value: 45 },
      { label: 'Fail (0-39%)', value: 20 }
    ],
    to4Scale: (score) => {
      if (score >= 70) return 4.0;    // First Class
      if (score >= 60) return 3.3;    // Upper Second
      if (score >= 50) return 2.7;    // Lower Second
      if (score >= 40) return 2.0;    // Third Class
      return 0.0;                     // Fail
    }
  },
  'eu': {
    name: 'Europe (ECTS)',
    flag: 'ğŸ‡ªğŸ‡º',
    scale: 'ECTS',
    grades: [
      { label: 'A - Excellent', value: 'A' },
      { label: 'B - Very Good', value: 'B' },
      { label: 'C - Good', value: 'C' },
      { label: 'D - Satisfactory', value: 'D' },
      { label: 'E - Sufficient', value: 'E' },
      { label: 'F - Fail', value: 'F' }
    ],
    to4Scale: (grade) => {
      switch(grade) {
        case 'A': return 4.0;
        case 'B': return 3.3;
        case 'C': return 2.7;
        case 'D': return 2.0;
        case 'E': return 1.0;
        case 'F': return 0.0;
        default: return 0.0;
      }
    }
  },
  'canada': {
    name: 'Canada',
    flag: 'ğŸ‡¨ğŸ‡¦',
    scale: 4.33,
    grades: [
      { label: 'A+ (4.33)', value: 4.33 },
      { label: 'A (4.0)', value: 4.0 },
      { label: 'A- (3.67)', value: 3.67 },
      { label: 'B+ (3.33)', value: 3.33 },
      { label: 'B (3.0)', value: 3.0 },
      { label: 'B- (2.67)', value: 2.67 },
      { label: 'C+ (2.33)', value: 2.33 },
      { label: 'C (2.0)', value: 2.0 },
      { label: 'C- (1.67)', value: 1.67 },
      { label: 'D+ (1.33)', value: 1.33 },
      { label: 'D (1.0)', value: 1.0 },
      { label: 'F (0.0)', value: 0.0 }
    ],
    to4Scale: (gpa) => Math.min(4.0, gpa) // Cap at 4.0 for US comparison
  },
  'australia': {
    name: 'Australia',
    flag: 'ğŸ‡¦ğŸ‡º',
    scale: 7.0,
    grades: [
      { label: 'HD (7.0)', value: 7.0 },
      { label: 'D (6.0)', value: 6.0 },
      { label: 'C (5.0)', value: 5.0 },
      { label: 'P (4.0)', value: 4.0 },
      { label: 'F (0.0)', value: 0.0 }
    ],
    to4Scale: (gpa) => (gpa / 7.0) * 4.0
  },
  'india': {
    name: 'India',
    flag: 'ğŸ‡®ğŸ‡³',
    scale: 10.0,
    grades: [
      { label: 'O (10.0)', value: 10.0 },
      { label: 'A+ (9.0)', value: 9.0 },
      { label: 'A (8.0)', value: 8.0 },
      { label: 'B+ (7.0)', value: 7.0 },
      { label: 'B (6.0)', value: 6.0 },
      { label: 'C (5.0)', value: 5.0 },
      { label: 'P (4.0)', value: 4.0 },
      { label: 'F (0.0)', value: 0.0 }
    ],
    to4Scale: (gpa) => (gpa / 10.0) * 4.0
  },
  'germany': {
    name: 'Germany',
    flag: 'ğŸ‡©ğŸ‡ª',
    scale: 6.0, // Note: 1.0 is best, 6.0 is worst
    grades: [
      { label: '1.0 - Excellent', value: 1.0 },
      { label: '1.3 - Very Good', value: 1.3 },
      { label: '1.7 - Good', value: 1.7 },
      { label: '2.0 - Good', value: 2.0 },
      { label: '2.3 - Satisfactory', value: 2.3 },
      { label: '2.7 - Satisfactory', value: 2.7 },
      { label: '3.0 - Satisfactory', value: 3.0 },
      { label: '3.3 - Sufficient', value: 3.3 },
      { label: '3.7 - Sufficient', value: 3.7 },
      { label: '4.0 - Sufficient', value: 4.0 },
      { label: '5.0 - Fail', value: 5.0 }
    ],
    to4Scale: (gpa) => {
      // Convert German grade to US 4.0 scale (inverse relationship)
      if (gpa <= 1.5) return 4.0;      // 1.0-1.5 = Excellent â‰ˆ A
      if (gpa <= 2.5) return 3.0;      // 1.6-2.5 = Good â‰ˆ B
      if (gpa <= 3.5) return 2.0;      // 2.6-3.5 = Satisfactory â‰ˆ C
      if (gpa <= 4.0) return 1.0;      // 3.6-4.0 = Sufficient â‰ˆ D
      return 0.0;                      // 4.1-6.0 = Fail
    }
  },
  'france': {
    name: 'France',
    flag: 'ğŸ‡«ğŸ‡·',
    scale: 20,
    grades: [
      { label: '16-20: TrÃ¨s Bien', value: 18 },
      { label: '14-15.9: Bien', value: 15 },
      { label: '12-13.9: Assez Bien', value: 13 },
      { label: '10-11.9: Passable', value: 11 },
      { label: '0-9.9: Insuffisant', value: 5 }
    ],
    to4Scale: (score) => {
      if (score >= 16) return 4.0;    // TrÃ¨s Bien
      if (score >= 14) return 3.3;    // Bien
      if (score >= 12) return 2.7;    // Assez Bien
      if (score >= 10) return 2.0;    // Passable
      return 0.0;                     // Insuffisant
    }
  },
  'china': {
    name: 'China',
    flag: 'ğŸ‡¨ğŸ‡³',
    scale: 100,
    grades: [
      { label: '90-100: Excellent', value: 95 },
      { label: '80-89: Good', value: 85 },
      { label: '70-79: Average', value: 75 },
      { label: '60-69: Pass', value: 65 },
      { label: '0-59: Fail', value: 30 }
    ],
    to4Scale: (score) => {
      if (score >= 90) return 4.0;
      if (score >= 80) return 3.0;
      if (score >= 70) return 2.0;
      if (score >= 60) return 1.0;
      return 0.0;
    }
  },
  'japan': {
    name: 'Japan',
    flag: 'ğŸ‡¯ğŸ‡µ',
    scale: 'SABCD',
    grades: [
      { label: 'S (Excellent)', value: 'S' },
      { label: 'A (Very Good)', value: 'A' },
      { label: 'B (Good)', value: 'B' },
      { label: 'C (Fair)', value: 'C' },
      { label: 'D (Fail)', value: 'D' }
    ],
    to4Scale: (grade) => {
      switch(grade) {
        case 'S': return 4.0;
        case 'A': return 3.7;
        case 'B': return 3.0;
        case 'C': return 2.0;
        case 'D': return 0.0;
        default: return 0.0;
      }
    }
  },
  'brazil': {
    name: 'Brazil',
    flag: 'ğŸ‡§ğŸ‡·',
    scale: 10,
    grades: [
      { label: '9-10: Excellent', value: 9.5 },
      { label: '7-8.9: Good', value: 8.0 },
      { label: '5-6.9: Average', value: 6.0 },
      { label: '0-4.9: Fail', value: 2.5 }
    ],
    to4Scale: (score) => {
      if (score >= 9) return 4.0;
      if (score >= 7) return 3.0;
      if (score >= 5) return 2.0;
      return 0.0;
    }
  },
  'southafrica': {
    name: 'South Africa',
    flag: 'ğŸ‡¿ğŸ‡¦',
    scale: 100,
    grades: [
      { label: '75-100: Distinction', value: 87 },
      { label: '65-74: Good', value: 70 },
      { label: '50-64: Pass', value: 57 },
      { label: '0-49: Fail', value: 25 }
    ],
    to4Scale: (score) => {
      if (score >= 75) return 4.0;
      if (score >= 65) return 3.0;
      if (score >= 50) return 2.0;
      return 0.0;
    }
  }
};

// International grade descriptions for display
const internationalGradeDescriptions = {
  'uk': (gpa4) => {
    if (gpa4 >= 3.7) return 'First Class Honours';
    if (gpa4 >= 3.3) return 'Upper Second Class';
    if (gpa4 >= 2.7) return 'Lower Second Class';
    if (gpa4 >= 2.0) return 'Third Class';
    return 'Fail';
  },
  'eu': (gpa4) => {
    if (gpa4 >= 3.7) return 'A - Excellent';
    if (gpa4 >= 3.0) return 'B - Very Good';
    if (gpa4 >= 2.3) return 'C - Good';
    if (gpa4 >= 1.7) return 'D - Satisfactory';
    if (gpa4 >= 1.0) return 'E - Sufficient';
    return 'F - Fail';
  },
  'au': (gpa4) => {
    const gpa7 = (gpa4 / 4.0) * 7.0;
    if (gpa7 >= 6.0) return 'HD - High Distinction';
    if (gpa7 >= 5.0) return 'D - Distinction';
    if (gpa7 >= 4.0) return 'C - Credit';
    if (gpa7 >= 3.0) return 'P - Pass';
    return 'F - Fail';
  },
  'in': (gpa4) => {
    const gpa10 = (gpa4 / 4.0) * 10.0;
    if (gpa10 >= 9.0) return 'O - Outstanding';
    if (gpa10 >= 8.0) return 'A+ - Excellent';
    if (gpa10 >= 7.0) return 'A - Very Good';
    if (gpa10 >= 6.0) return 'B+ - Good';
    if (gpa10 >= 5.0) return 'B - Above Average';
    if (gpa10 >= 4.0) return 'C - Average';
    return 'F - Fail';
  }
};

let courses = [];
const STORAGE_KEY = 'gpa-calculator-courses';

// Load saved courses
function gpaLoad() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      courses = JSON.parse(saved);
      gpaRender();
    }
  } catch (e) {
    console.error('Failed to load courses:', e);
  }
}

// Save courses
function gpaSave() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(courses));
  } catch (e) {
    console.error('Failed to save courses:', e);
  }
}

// Update grade options based on selected country
function gpaUpdateGradeOptions() {
  const card = document.currentScript?.closest('.card') || document;
  const countrySelect = card.querySelector('#gpa-country');
  const gradeSelect = card.querySelector('#gpa-grade');
  const country = countrySelect.value;
  const system = gradingSystems[country];
  
  if (!system) return;
  
  // Clear existing options
  gradeSelect.innerHTML = '';
  
  // Add new options
  system.grades.forEach(grade => {
    const option = document.createElement('option');
    option.value = grade.value;
    option.textContent = grade.label;
    gradeSelect.appendChild(option);
  });
}

// Add a course
function gpaAddCourse(btn) {
  const card = btn.closest('.card') || document;
  const courseName = card.querySelector('#gpa-course-name').value.trim();
  const credits = parseFloat(card.querySelector('#gpa-credits').value);
  const country = card.querySelector('#gpa-country').value;
  const gradeSelect = card.querySelector('#gpa-grade');
  const gradeValue = gradeSelect.value;
  
  if (!courseName || !credits || !gradeValue) {
    gpaShowMessage(card, 'Please fill all fields', '#ff4d4d');
    return;
  }
  
  const system = gradingSystems[country];
  const numericGrade = typeof gradeValue === 'string' ? gradeValue : parseFloat(gradeValue);
  const grade4Scale = system.to4Scale(numericGrade);
  
  const courseId = Date.now();
  courses.push({
    id: courseId,
    name: courseName,
    credits: credits,
    country: country,
    originalGrade: gradeValue,
    grade4Scale: grade4Scale,
    systemName: system.name,
    flag: system.flag
  });
  
  gpaRender();
  gpaSave();
  
  // Reset form (keep country selection)
  card.querySelector('#gpa-course-name').value = '';
  card.querySelector('#gpa-credits').value = '';
  card.querySelector('#gpa-course-name').focus();
  
  gpaShowMessage(card, `âœ… Course "${courseName}" added`, '#39ff14');
}

// Render courses list
function gpaRender() {
  const card = document.currentScript?.closest('.card') || document;
  const list = card.querySelector('#gpa-courses-list');
  
  if (courses.length === 0) {
    list.innerHTML = `
      <div style="padding:30px;text-align:center;color:rgba(230,250,255,0.5);font-style:italic;">
        No courses added yet. Add your first course above!
      </div>
    `;
    return;
  }
  
  let html = '';
  courses.forEach((course, index) => {
    const system = gradingSystems[course.country];
    const scale = typeof system.scale === 'number' ? system.scale : system.scale;
    
    html += `
      <div class="course-item" data-id="${course.id}" 
           style="background:rgba(255,255,255,0.03);border-left:3px solid var(--accent);margin-bottom:8px;padding:12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
        <div style="flex:1;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
            <span style="font-size:16px;">${course.flag}</span>
            <div style="font-weight:600;color:var(--accent);">${course.name}</div>
          </div>
          <div style="display:flex;gap:12px;font-size:13px;">
            <span style="color:rgba(230,250,255,0.8);">Credits: ${course.credits}</span>
            <span style="color:rgba(230,250,255,0.8);">Grade: ${course.originalGrade}</span>
            <span style="color:#39ff14;">4.0 Scale: ${course.grade4Scale.toFixed(2)}</span>
          </div>
        </div>
        <div>
          <button onclick="gpaRemoveCourse('${course.id}')" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px 8px;border-radius:4px;font-size:12px;">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  });
  
  list.innerHTML = html;
}

// Calculate GPA
function gpaCalculateAll(btn) {
  if (courses.length === 0) {
    const card = btn.closest('.card') || document;
    gpaShowMessage(card, 'No courses to calculate', '#ff4d4d');
    return;
  }
  
  let totalCredits = 0;
  let totalPoints = 0;
  let totalPoints4Scale = 0;
  
  courses.forEach(course => {
    totalCredits += course.credits;
    totalPoints += course.grade4Scale * course.credits;
  });
  
  const gpa = totalCredits > 0 ? totalPoints / totalCredits : 0;
  const currentSystem = document.querySelector('#gpa-country').value;
  const system = gradingSystems[currentSystem];
  
  // Calculate weighted average in current system
  let currentSystemGPA = 0;
  if (currentSystem === 'us' || currentSystem === 'canada') {
    currentSystemGPA = gpa; // Already in correct scale
  } else {
    // Convert each course back to current system for display
    let currentSystemTotal = 0;
    courses.forEach(course => {
      if (course.country === currentSystem) {
        const numericGrade = typeof course.originalGrade === 'string' ? course.originalGrade : parseFloat(course.originalGrade);
        currentSystemTotal += numericGrade * course.credits;
      }
    });
    currentSystemGPA = totalCredits > 0 ? currentSystemTotal / totalCredits : 0;
  }
  
  // Update displays
  document.getElementById('gpa-current-system').textContent = currentSystemGPA.toFixed(2);
  document.getElementById('gpa-current-scale').textContent = typeof system.scale === 'number' ? `/${system.scale}` : `(${system.scale})`;
  document.getElementById('gpa-converted-4').textContent = gpa.toFixed(2);
  document.getElementById('gpa-total-credits').textContent = totalCredits;
  document.getElementById('gpa-total-points').textContent = totalPoints.toFixed(2);
  
  // Update international equivalents
  updateInternationalEquivalents(gpa);
  
  const card = btn.closest('.card') || document;
  gpaShowMessage(card, `âœ… GPA calculated: ${gpa.toFixed(2)}/4.0`, '#39ff14');
}

function updateInternationalEquivalents(gpa4) {
  // UK
  const ukDesc = internationalGradeDescriptions['uk'](gpa4);
  document.getElementById('gpa-uk-grade').textContent = ukDesc;
  
  // EU ECTS
  const euDesc = internationalGradeDescriptions['eu'](gpa4);
  document.getElementById('gpa-ects-grade').textContent = euDesc;
  
  // Australia
  const auDesc = internationalGradeDescriptions['au'](gpa4);
  document.getElementById('gpa-au-grade').textContent = auDesc;
  
  // India
  const inDesc = internationalGradeDescriptions['in'](gpa4);
  document.getElementById('gpa-in-grade').textContent = inDesc;
}

// Remove a course
function gpaRemoveCourse(courseId) {
  courses = courses.filter(c => c.id != courseId);
  gpaRender();
  gpaSave();
  gpaCalculateAll({closest: () => document});
}

// Reset form
function gpaResetForm(btn) {
  const card = btn.closest('.card') || document;
  card.querySelector('#gpa-course-name').value = '';
  card.querySelector('#gpa-credits').value = '';
  card.querySelector('#gpa-course-name').focus();
}

// Clear all courses
function gpaClearAll() {
  if (courses.length === 0) return;
  
  if (confirm('Are you sure you want to clear all courses?')) {
    courses = [];
    gpaRender();
    gpaSave();
    
    // Reset results
    document.getElementById('gpa-current-system').textContent = '0.00';
    document.getElementById('gpa-converted-4').textContent = '0.00';
    document.getElementById('gpa-total-credits').textContent = '0';
    document.getElementById('gpa-total-points').textContent = '0.00';
    document.getElementById('gpa-uk-grade').textContent = 'N/A';
    document.getElementById('gpa-ects-grade').textContent = 'N/A';
    document.getElementById('gpa-au-grade').textContent = 'N/A';
    document.getElementById('gpa-in-grade').textContent = 'N/A';
    
    const card = document.currentScript?.closest('.card') || document;
    gpaShowMessage(card, 'âœ… All courses cleared', '#39ff14');
  }
}

function gpaShowMessage(card, message, color = '#2dd4ff') {
  const messageDiv = document.createElement('div');
  messageDiv.textContent = message;
  messageDiv.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(20,20,20,0.95);
    color: ${color};
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid ${color}40;
    z-index: 10000;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `;
  
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.style.opacity = '0';
    messageDiv.style.transform = 'translateX(20px)';
    setTimeout(() => {
      if (messageDiv.parentNode) {
        document.body.removeChild(messageDiv);
      }
    }, 300);
  }, 2000);
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
      gpaLoad();
      gpaUpdateGradeOptions();
    }, 100);
  });
} else {
  setTimeout(() => {
    gpaLoad();
    gpaUpdateGradeOptions();
  }, 100);
}
</script>

<style>
#gpa-calculator-international-title {
  color: var(--accent);
  margin-top: 0;
  border-bottom: 1px solid rgba(45,212,255,0.2);
  padding-bottom: 10px;
  margin-bottom: 16px;
}

.course-item {
  transition: all 0.2s ease;
}

.course-item:hover {
  background: rgba(45,212,255,0.05) !important;
  transform: translateX(2px);
}

#gpa-courses-list::-webkit-scrollbar {
  width: 6px;
}

#gpa-courses-list::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#gpa-courses-list::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}

@media (max-width: 768px) {
  div[style*="grid-template-columns:repeat(auto-fit"] {
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  
  .actions {
    flex-direction: column !important;
  }
  
  .actions button {
    width: 100% !important;
    margin-bottom: 8px;
  }
  
  .course-item {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 8px;
  }
  
  .course-item > div:last-child {
    align-self: flex-end;
  }
}
</style>
