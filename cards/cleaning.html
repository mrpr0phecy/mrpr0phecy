<h2 id="cleaning-title" style="margin-top:0;">üßπ Cleaning Schedule</h2>

<form aria-describedby="cleaning-desc">
  <p id="cleaning-desc" class="small">
    Plan, track, and manage cleaning tasks with smart scheduling. Never forget a chore again!
  </p>

  <!-- INPUT SECTION -->
  <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;margin-bottom:20px;">
    <div style="color:#2dd4ff;font-weight:600;margin-bottom:15px;">üìã Add New Task:</div>
    
    <!-- TASK & ROOM -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cleaning-task" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#ffa500;">Task Description</span>
        </label>
        <input id="cleaning-task" type="text" placeholder="e.g. Vacuum living room" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:#e6faff;font-size:16px;" />
      </div>
      
      <div>
        <label for="cleaning-room" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#2dd4ff;">Room/Area</span>
        </label>
        <input id="cleaning-room" type="text" placeholder="e.g. Kitchen" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:#e6faff;font-size:16px;" />
      </div>
    </div>
    
    <!-- DATE & PRIORITY -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
      <div>
        <label for="cleaning-date" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#39ff14;">Due Date</span>
        </label>
        <input id="cleaning-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#e6faff;font-size:16px;" />
        <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
          Leave blank for no deadline
        </div>
      </div>
      
      <div>
        <label for="cleaning-priority" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
          <span style="color:#9d4edd;">Priority</span>
        </label>
        <select id="cleaning-priority" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(157,78,221,0.3);background:rgba(157,78,221,0.05);color:#e6faff;font-size:16px;">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="urgent">Urgent</option>
        </select>
      </div>
    </div>
    
    <!-- RECURRENCE -->
    <div>
      <label for="cleaning-recurrence" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:14px;">
        <span style="color:#ffcc00;">Recurrence</span>
      </label>
      <select id="cleaning-recurrence" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:#e6faff;font-size:16px;">
        <option value="once" selected>Once (single task)</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="biweekly">Bi-weekly</option>
        <option value="monthly">Monthly</option>
      </select>
    </div>
  </div>
  
  <!-- QUICK TASKS -->
  <div style="margin-bottom:25px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:10px;font-size:14px;">Quick Add Common Tasks:</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button type="button" class="cl-quick-task" data-task="Vacuum floors" data-room="Living Room" data-priority="medium" data-recurrence="weekly"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üßπ Vacuum Floors
      </button>
      <button type="button" class="cl-quick-task" data-task="Clean bathroom" data-room="Bathroom" data-priority="high" data-recurrence="weekly"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üöΩ Clean Bathroom
      </button>
      <button type="button" class="cl-quick-task" data-task="Wash dishes" data-room="Kitchen" data-priority="medium" data-recurrence="daily"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üçΩÔ∏è Wash Dishes
      </button>
      <button type="button" class="cl-quick-task" data-task="Laundry" data-room="Laundry Room" data-priority="medium" data-recurrence="biweekly"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        üëï Laundry
      </button>
      <button type="button" class="cl-quick-task" data-task="Dust surfaces" data-room="All Rooms" data-priority="low" data-recurrence="weekly"
              style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;cursor:pointer;color:#e6faff;font-size:13px;">
        ü™£ Dust Surfaces
      </button>
    </div>
  </div>
  
  <!-- ACTIONS -->
  <div style="text-align:center;margin:25px 0;">
    <button id="cl-add-btn" 
            style="background:#2dd4ff;color:#000;border:none;padding:14px 32px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;box-shadow:0 4px 15px rgba(45,212,255,0.3);">
      ‚ûï ADD TASK
    </button>
    
    <button id="cl-reset-btn" 
            style="background:rgba(255,255,255,0.08);color:#e6faff;border:1px solid rgba(255,255,255,0.2);padding:14px 24px;border-radius:10px;cursor:pointer;font-size:16px;margin-left:12px;">
      Reset All
    </button>
  </div>
  
  <!-- TASK LIST -->
  <div id="cl-results" style="display:none;">
    <div style="background:rgba(20,20,20,0.7);border-radius:10px;padding:25px;border:1px solid rgba(57,255,20,0.2);margin-bottom:25px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div style="color:#39ff14;font-size:18px;font-weight:600;">üìã Cleaning Schedule</div>
        <div>
          <button id="cl-save-btn" 
                  style="background:rgba(57,255,20,0.1);color:#39ff14;border:1px solid rgba(57,255,20,0.3);padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;">
            üíæ Save Schedule
          </button>
          <button id="cl-clear-completed" 
                  style="background:rgba(255,77,77,0.1);color:#ff4d4d;border:1px solid rgba(255,77,77,0.3);padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;margin-left:8px;">
            üóëÔ∏è Clear Completed
          </button>
        </div>
      </div>
      
      <!-- STATS -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px;">
        <div style="background:rgba(45,212,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);text-align:center;">
          <div style="color:#2dd4ff;font-size:12px;">Total Tasks</div>
          <div style="font-size:20px;font-weight:600;color:#e6faff;" id="cl-total-tasks">0</div>
        </div>
        <div style="background:rgba(57,255,20,0.1);padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.2);text-align:center;">
          <div style="color:#39ff14;font-size:12px;">Pending</div>
          <div style="font-size:20px;font-weight:600;color:#e6faff;" id="cl-pending-tasks">0</div>
        </div>
        <div style="background:rgba(255,165,0,0.1);padding:12px;border-radius:8px;border:1px solid rgba(255,165,0,0.2);text-align:center;">
          <div style="color:#ffa500;font-size:12px;">Completed</div>
          <div style="font-size:20px;font-weight:600;color:#e6faff;" id="cl-completed-tasks">0</div>
        </div>
        <div style="background:rgba(157,78,221,0.1);padding:12px;border-radius:8px;border:1px solid rgba(157,78,221,0.2);text-align:center;">
          <div style="color:#9d4edd;font-size:12px;">Urgent</div>
          <div style="font-size:20px;font-weight:600;color:#e6faff;" id="cl-urgent-tasks">0</div>
        </div>
      </div>
      
      <!-- FILTERS -->
      <div style="margin-bottom:20px;">
        <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Filter Tasks:</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button class="cl-filter-btn active" data-filter="all"
                  style="padding:6px 12px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);border-radius:4px;color:#2dd4ff;cursor:pointer;font-size:12px;">
            All Tasks
          </button>
          <button class="cl-filter-btn" data-filter="pending"
                  style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:4px;color:#e6faff;cursor:pointer;font-size:12px;">
            Pending Only
          </button>
          <button class="cl-filter-btn" data-filter="completed"
                  style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:4px;color:#e6faff;cursor:pointer;font-size:12px;">
            Completed
          </button>
          <button class="cl-filter-btn" data-filter="urgent"
                  style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:4px;color:#e6faff;cursor:pointer;font-size:12px;">
            Urgent
          </button>
          <button class="cl-filter-btn" data-filter="today"
                  style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:4px;color:#e6faff;cursor:pointer;font-size:12px;">
            Due Today
          </button>
        </div>
      </div>
      
      <!-- TASK LIST -->
      <div id="cl-task-list" style="max-height:400px;overflow-y:auto;">
        <!-- Tasks will appear here -->
        <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
          No tasks added yet. Start by adding your first cleaning task!
        </div>
      </div>
    </div>
  </div>
  
  <!-- CLEANING TIPS -->
  <div id="cl-tips" style="margin-top:25px;display:block;">
    <div style="background:rgba(30,30,30,0.5);border-radius:10px;padding:20px;border:1px solid rgba(255,165,0,0.2);">
      <div style="color:#ffa500;font-weight:600;margin-bottom:15px;font-size:16px;">
        üí° Cleaning Tips & Best Practices
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;">
        <div style="background:rgba(255,165,0,0.05);padding:12px;border-radius:8px;border-left:3px solid #ffa500;">
          <div style="color:#ffa500;font-weight:600;margin-bottom:5px;">Room-by-Room</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Start from top to bottom<br>
            ‚Ä¢ Clean from left to right<br>
            ‚Ä¢ Finish one room before moving on<br>
            ‚Ä¢ Keep supplies in each room
          </div>
        </div>
        
        <div style="background:rgba(45,212,255,0.05);padding:12px;border-radius:8px;border-left:3px solid #2dd4ff;">
          <div style="color:#2dd4ff;font-weight:600;margin-bottom:5px;">Frequency Guide</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Daily: Dishes, counters<br>
            ‚Ä¢ Weekly: Vacuum, bathrooms<br>
            ‚Ä¢ Monthly: Windows, appliances<br>
            ‚Ä¢ Seasonally: Deep cleaning
          </div>
        </div>
        
        <div style="background:rgba(157,78,221,0.05);padding:12px;border-radius:8px;border-left:3px solid #9d4edd;">
          <div style="color:#9d4edd;font-weight:600;margin-bottom:5px;">Time Management</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ 15-minute daily tidy<br>
            ‚Ä¢ 30-minute weekly clean<br>
            ‚Ä¢ Schedule deep cleaning<br>
            ‚Ä¢ Use timers for focus
          </div>
        </div>
        
        <div style="background:rgba(57,255,20,0.05);padding:12px;border-radius:8px;border-left:3px solid #39ff14;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:5px;">Productivity Tips</div>
          <div style="color:rgba(230,250,255,0.8);font-size:14px;">
            ‚Ä¢ Create a cleaning caddy<br>
            ‚Ä¢ Listen to music/podcasts<br>
            ‚Ä¢ Involve household members<br>
            ‚Ä¢ Reward completed tasks
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ERROR MESSAGE -->
  <div id="cl-error" style="margin-top:20px;padding:15px;background:rgba(255,77,77,0.1);border-radius:8px;border:1px solid rgba(255,77,77,0.3);display:none;">
    <div style="color:#ff4d4d;font-weight:600;margin-bottom:5px;">‚ö†Ô∏è Please check your input</div>
    <div id="cl-error-text" style="color:rgba(255,77,77,0.9);"></div>
  </div>
</form>

<style>
#cleaning-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .cl-quick-task, .cl-filter-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
  
  #cl-add-btn, #cl-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
}
</style>

<script>
/* cleaning-schedule.html
   - Complete cleaning schedule with task management
   - Scoped with cl- prefix
*/

let clTasks = JSON.parse(localStorage.getItem('clTasks') || '[]');
let clCurrentFilter = 'all';

// Initialize
function clInit() {
    console.log("Cleaning Schedule: Initializing...");
    
    // Set today's date as default
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('cleaning-date').value = today;
    
    // Quick task buttons
    const quickTaskBtns = document.querySelectorAll('.cl-quick-task');
    quickTaskBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById('cleaning-task').value = this.dataset.task || '';
            document.getElementById('cleaning-room').value = this.dataset.room || '';
            document.getElementById('cleaning-priority').value = this.dataset.priority || 'medium';
            document.getElementById('cleaning-recurrence').value = this.dataset.recurrence || 'once';
            
            // Visual feedback
            quickTaskBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
            });
            this.style.background = 'rgba(45,212,255,0.15)';
            this.style.border = '1px solid #2dd4ff';
            
            // Focus on task input
            document.getElementById('cleaning-task').focus();
        });
    });
    
    // Add button
    document.getElementById('cl-add-btn').addEventListener('click', clAddTask);
    
    // Reset button
    document.getElementById('cl-reset-btn').addEventListener('click', clResetAll);
    
    // Save button
    document.getElementById('cl-save-btn').addEventListener('click', clSaveSchedule);
    
    // Clear completed button
    document.getElementById('cl-clear-completed').addEventListener('click', clClearCompleted);
    
    // Filter buttons
    const filterBtns = document.querySelectorAll('.cl-filter-btn');
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            clCurrentFilter = filter;
            
            // Update active state
            filterBtns.forEach(b => {
                b.style.background = 'rgba(255,255,255,0.05)';
                b.style.border = '1px solid rgba(255,255,255,0.1)';
                b.style.color = '#e6faff';
            });
            this.style.background = 'rgba(45,212,255,0.2)';
            this.style.border = '1px solid rgba(45,212,255,0.4)';
            this.style.color = '#2dd4ff';
            
            clRenderTasks();
        });
    });
    
    // Enter key support
    document.getElementById('cleaning-task').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            clAddTask();
        }
    });
    
    // Load saved tasks
    clLoadTasks();
    
    console.log("‚úÖ Cleaning Schedule ready!");
}

// Add new task
function clAddTask() {
    const task = document.getElementById('cleaning-task').value.trim();
    const room = document.getElementById('cleaning-room').value.trim();
    const date = document.getElementById('cleaning-date').value;
    const priority = document.getElementById('cleaning-priority').value;
    const recurrence = document.getElementById('cleaning-recurrence').value;
    
    if (!task) {
        clShowError("Please enter a task description");
        return;
    }
    
    const newTask = {
        id: Date.now(),
        task: task,
        room: room || 'General',
        date: date || null,
        priority: priority,
        recurrence: recurrence,
        done: false,
        created: new Date().toISOString(),
        completed: null
    };
    
    clTasks.push(newTask);
    clSaveToStorage();
    clRenderTasks();
    
    // Reset form
    document.getElementById('cleaning-task').value = '';
    document.getElementById('cleaning-room').value = '';
    document.getElementById('cleaning-task').focus();
    
    // Show results
    document.getElementById('cl-results').style.display = 'block';
    document.getElementById('cl-error').style.display = 'none';
    
    console.log("Task added:", newTask);
}

// Render tasks
function clRenderTasks() {
    const container = document.getElementById('cl-task-list');
    if (!container) return;
    
    // Filter tasks
    let filteredTasks = clTasks;
    switch(clCurrentFilter) {
        case 'pending':
            filteredTasks = clTasks.filter(t => !t.done);
            break;
        case 'completed':
            filteredTasks = clTasks.filter(t => t.done);
            break;
        case 'urgent':
            filteredTasks = clTasks.filter(t => t.priority === 'urgent' && !t.done);
            break;
        case 'today':
            const today = new Date().toISOString().split('T')[0];
            filteredTasks = clTasks.filter(t => t.date === today && !t.done);
            break;
    }
    
    if (filteredTasks.length === 0) {
        container.innerHTML = `
            <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
                No tasks match the current filter. Try a different filter or add new tasks!
            </div>
        `;
    } else {
        container.innerHTML = '';
        
        filteredTasks.forEach(task => {
            const taskElement = document.createElement('div');
            taskElement.className = 'cl-task-item';
            taskElement.style.cssText = `
                background: ${task.done ? 'rgba(57,255,20,0.05)' : 'rgba(0,0,0,0.2)'};
                border: 1px solid ${task.done ? 'rgba(57,255,20,0.2)' : 'rgba(255,255,255,0.1)'};
                border-left: 4px solid ${clGetPriorityColor(task.priority)};
                border-radius: 6px;
                padding: 12px;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                transition: all 0.2s;
            `;
            
            // Task info
            const taskInfo = document.createElement('div');
            taskInfo.style.flex = '1';
            
            const taskText = document.createElement('div');
            taskText.style.cssText = `
                font-weight: ${task.done ? 'normal' : '600'};
                color: ${task.done ? 'rgba(230,250,255,0.6)' : '#e6faff'};
                text-decoration: ${task.done ? 'line-through' : 'none'};
                margin-bottom: 4px;
            `;
            taskText.textContent = task.task;
            
            const taskMeta = document.createElement('div');
            taskMeta.style.cssText = `
                font-size: 12px;
                color: rgba(230,250,255,0.6);
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
            `;
            
            let metaHTML = '';
            if (task.room) {
                metaHTML += `<span>üìç ${task.room}</span>`;
            }
            if (task.date) {
                const dateStr = new Date(task.date).toLocaleDateString();
                const isOverdue = !task.done && task.date && new Date(task.date) < new Date();
                metaHTML += `<span style="color:${isOverdue ? '#ff4d4d' : 'inherit'}">üìÖ ${dateStr}${isOverdue ? ' (Overdue!)' : ''}</span>`;
            }
            metaHTML += `<span style="color:${clGetPriorityColor(task.priority)}">${clGetPriorityIcon(task.priority)} ${task.priority.toUpperCase()}</span>`;
            metaHTML += `<span>üîÑ ${task.recurrence}</span>`;
            
            taskMeta.innerHTML = metaHTML;
            
            taskInfo.appendChild(taskText);
            taskInfo.appendChild(taskMeta);
            
            // Task actions
            const taskActions = document.createElement('div');
            taskActions.style.cssText = `
                display: flex;
                gap: 8px;
                align-items: center;
            `;
            
            // Toggle button
            const toggleBtn = document.createElement('button');
            toggleBtn.textContent = task.done ? '‚Ü©Ô∏è Undo' : '‚úÖ Done';
            toggleBtn.style.cssText = `
                background: ${task.done ? 'rgba(255,165,0,0.1)' : 'rgba(57,255,20,0.1)'};
                border: 1px solid ${task.done ? 'rgba(255,165,0,0.3)' : 'rgba(57,255,20,0.3)'};
                color: ${task.done ? '#ffa500' : '#39ff14'};
                padding: 4px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            toggleBtn.addEventListener('click', () => clToggleTask(task.id));
            
            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'üóëÔ∏è';
            deleteBtn.title = 'Delete task';
            deleteBtn.style.cssText = `
                background: rgba(255,77,77,0.1);
                border: 1px solid rgba(255,77,77,0.3);
                color: #ff4d4d;
                padding: 4px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            deleteBtn.addEventListener('click', () => clDeleteTask(task.id));
            
            taskActions.appendChild(toggleBtn);
            taskActions.appendChild(deleteBtn);
            
            taskElement.appendChild(taskInfo);
            taskElement.appendChild(taskActions);
            container.appendChild(taskElement);
        });
    }
    
    // Update stats
    clUpdateStats();
}

// Get priority color
function clGetPriorityColor(priority) {
    const colors = {
        'low': '#9d4edd',
        'medium': '#2dd4ff',
        'high': '#ffa500',
        'urgent': '#ff4d4d'
    };
    return colors[priority] || '#2dd4ff';
}

// Get priority icon
function clGetPriorityIcon(priority) {
    const icons = {
        'low': '‚ö™',
        'medium': 'üü°',
        'high': 'üî¥',
        'urgent': 'üö®'
    };
    return icons[priority] || 'üü°';
}

// Toggle task completion
function clToggleTask(taskId) {
    const taskIndex = clTasks.findIndex(t => t.id === taskId);
    if (taskIndex === -1) return;
    
    clTasks[taskIndex].done = !clTasks[taskIndex].done;
    clTasks[taskIndex].completed = clTasks[taskIndex].done ? new Date().toISOString() : null;
    
    // If task is recurring and completed, create next occurrence
    if (clTasks[taskIndex].done && clTasks[taskIndex].recurrence !== 'once') {
        clCreateNextRecurrence(clTasks[taskIndex]);
    }
    
    clSaveToStorage();
    clRenderTasks();
}

// Delete task
function clDeleteTask(taskId) {
    if (confirm('Are you sure you want to delete this task?')) {
        clTasks = clTasks.filter(t => t.id !== taskId);
        clSaveToStorage();
        clRenderTasks();
    }
}

// Create next recurrence
function clCreateNextRecurrence(task) {
    const newTask = { ...task };
    newTask.id = Date.now();
    newTask.done = false;
    newTask.completed = null;
    newTask.created = new Date().toISOString();
    
    // Calculate next date based on recurrence
    if (task.date) {
        const currentDate = new Date(task.date);
        switch(task.recurrence) {
            case 'daily':
                currentDate.setDate(currentDate.getDate() + 1);
                break;
            case 'weekly':
                currentDate.setDate(currentDate.getDate() + 7);
                break;
            case 'biweekly':
                currentDate.setDate(currentDate.getDate() + 14);
                break;
            case 'monthly':
                currentDate.setMonth(currentDate.getMonth() + 1);
                break;
        }
        newTask.date = currentDate.toISOString().split('T')[0];
    }
    
    clTasks.push(newTask);
}

// Update statistics
function clUpdateStats() {
    const total = clTasks.length;
    const pending = clTasks.filter(t => !t.done).length;
    const completed = clTasks.filter(t => t.done).length;
    const urgent = clTasks.filter(t => t.priority === 'urgent' && !t.done).length;
    
    document.getElementById('cl-total-tasks').textContent = total;
    document.getElementById('cl-pending-tasks').textContent = pending;
    document.getElementById('cl-completed-tasks').textContent = completed;
    document.getElementById('cl-urgent-tasks').textContent = urgent;
    
    // Show/hide results section
    document.getElementById('cl-results').style.display = total > 0 ? 'block' : 'none';
}

// Save to localStorage
function clSaveToStorage() {
    try {
        localStorage.setItem('clTasks', JSON.stringify(clTasks));
    } catch (e) {
        console.error('Failed to save tasks:', e);
    }
}

// Load tasks from localStorage
function clLoadTasks() {
    try {
        const saved = localStorage.getItem('clTasks');
        if (saved) {
            clTasks = JSON.parse(saved);
            clRenderTasks();
        }
    } catch (e) {
        console.error('Failed to load tasks:', e);
        clTasks = [];
    }
}

// Save schedule (export)
function clSaveSchedule() {
    const data = {
        tasks: clTasks,
        exported: new Date().toISOString(),
        totalTasks: clTasks.length,
        pendingTasks: clTasks.filter(t => !t.done).length
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `cleaning-schedule-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    const hint = document.getElementById('cl-hint') || document.createElement('div');
    hint.textContent = 'Schedule saved to file!';
    hint.style.color = '#39ff14';
    hint.id = 'cl-hint';
    document.querySelector('#cl-results > div').appendChild(hint);
    
    setTimeout(() => {
        hint.textContent = '';
    }, 2000);
}

// Clear completed tasks
function clClearCompleted() {
    if (confirm('Are you sure you want to clear all completed tasks?')) {
        clTasks = clTasks.filter(t => !t.done);
        clSaveToStorage();
        clRenderTasks();
    }
}

// Reset all
function clResetAll() {
    if (confirm('Are you sure you want to reset everything? This will delete all tasks.')) {
        clTasks = [];
        clSaveToStorage();
        clRenderTasks();
        document.getElementById('cleaning-task').focus();
    }
}

// Show error
function clShowError(message) {
    document.getElementById('cl-error-text').textContent = message;
    document.getElementById('cl-error').style.display = 'block';
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', clInit);
} else {
    setTimeout(clInit, 100);
}
</script>
