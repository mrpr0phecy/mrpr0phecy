<h2 id="project-deadline-title">üìÖ Project Deadline Calculator</h2>

<form aria-describedby="project-deadline-desc">
    <p id="project-deadline-desc" class="small">
        Calculate project timelines with buffer days, weekend exclusions, and milestone planning.
        <span style="color:var(--accent)">Plan realistically and track progress.</span>
    </p>
    
    <!-- BASIC CALCULATION -->
    <div style="margin-bottom:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">üìù Project Details</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:16px;">
            <div>
                <label for="pd-start" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Start Date
                </label>
                <input id="pd-start" type="date" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;"
                       value="${new Date().toISOString().split('T')[0]}" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    When work begins
                </div>
            </div>
            
            <div>
                <label for="pd-duration" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Duration (Days)
                </label>
                <input id="pd-duration" type="number" min="1" max="365" step="1" value="30"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Working days required
                </div>
            </div>
        </div>
        
        <!-- QUICK DURATION PRESETS -->
        <div style="margin-bottom:16px;">
            <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">Quick Durations:</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="button" onclick="pdSetDuration(7)" style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">1 Week</button>
                <button type="button" onclick="pdSetDuration(14)" style="padding:6px 10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">2 Weeks</button>
                <button type="button" onclick="pdSetDuration(30)" style="padding:6px 10px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">1 Month</button>
                <button type="button" onclick="pdSetDuration(60)" style="padding:6px 10px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;">2 Months</button>
                <button type="button" onclick="pdSetDuration(90)" style="padding:6px 10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:12px;">3 Months</button>
            </div>
        </div>
    </div>
    
    <!-- ADVANCED SETTINGS -->
    <div style="margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1.1rem;">‚öôÔ∏è Advanced Settings</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
            <div>
                <label for="pd-buffer" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Buffer (%)
                </label>
                <input id="pd-buffer" type="number" min="0" max="100" step="5" value="20"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Safety margin for delays
                </div>
            </div>
            
            <div>
                <label for="pd-workdays" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Workdays/Week
                </label>
                <select id="pd-workdays" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
                    <option value="5">5 days (Mon-Fri)</option>
                    <option value="6">6 days (Mon-Sat)</option>
                    <option value="7" selected>7 days (Every day)</option>
                </select>
                <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;">
                    Project work schedule
                </div>
            </div>
        </div>
        
        <div style="margin-top:12px;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="pd-exclude-weekends" style="accent-color:var(--accent);">
                <span style="color:rgba(230,250,255,0.9);">Exclude weekends from timeline</span>
            </label>
        </div>
        
        <div style="margin-top:12px;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="pd-show-milestones" checked style="accent-color:var(--accent);">
                <span style="color:rgba(230,250,255,0.9);">Generate milestone dates</span>
            </label>
        </div>
    </div>
    
    <!-- MILESTONE SETTINGS -->
    <div id="pd-milestone-settings" style="display:none;margin-bottom:20px;padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);">
        <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1.1rem;">üéØ Milestone Settings</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="pd-milestone-count" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Number of Milestones
                </label>
                <input id="pd-milestone-count" type="number" min="1" max="10" step="1" value="4"
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
            </div>
            
            <div>
                <label for="pd-milestone-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
                    Distribution
                </label>
                <select id="pd-milestone-type" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
                    <option value="equal">Equal intervals</option>
                    <option value="weighted">Weighted (more at start)</option>
                    <option value="custom">Custom percentages</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- ACTIONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="pdCalculateDeadline()" 
                style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üìÖ Calculate Deadline
        </button>
        <button type="button" onclick="pdResetForm()"
                style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            Reset
        </button>
        <button type="button" onclick="pdSaveProject()" id="pd-save-btn"
                style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;display:none;">
            üíæ Save Project
        </button>
    </div>
</form>

<!-- MAIN RESULTS -->
<div class="results" aria-live="polite" style="margin-top:16px;">
    <!-- TIMELINE SUMMARY -->
    <div id="pd-timeline-summary" style="display:none;margin-bottom:20px;">
        <div style="text-align:center;padding:20px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(157,78,221,0.05));border-radius:12px;border:1px solid rgba(45,212,255,0.2);">
            <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-bottom:4px;">Project Completion</div>
            <div id="pd-deadline-date" style="font-size:36px;font-weight:700;color:var(--accent);margin-bottom:8px;">‚Äì</div>
            <div id="pd-total-days" style="color:rgba(230,250,255,0.8);margin-bottom:12px;">‚Äì</div>
            
            <div style="display:flex;justify-content:center;gap:16px;margin-top:12px;">
                <div style="text-align:center;">
                    <div style="font-size:12px;color:rgba(230,250,255,0.6);">Start</div>
                    <div id="pd-start-display" style="font-size:16px;font-weight:600;color:#39ff14;">‚Äì</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:12px;color:rgba(230,250,255,0.6);">Duration</div>
                    <div id="pd-duration-display" style="font-size:16px;font-weight:600;color:#ffa500;">‚Äì days</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:12px;color:rgba(230,250,255,0.6);">Buffer</div>
                    <div id="pd-buffer-display" style="font-size:16px;font-weight:600;color:#9d4edd;">‚Äì days</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- TIMELINE VISUALIZATION -->
    <div id="pd-timeline-visual" style="display:none;margin-bottom:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìä Timeline Visualization</h3>
        <div id="pd-timeline-bar" style="height:40px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);position:relative;overflow:hidden;">
            <!-- Timeline will be drawn here -->
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:rgba(230,250,255,0.7);">
            <div id="pd-timeline-start">Start</div>
            <div id="pd-timeline-end">Deadline</div>
        </div>
    </div>
    
    <!-- MILESTONES -->
    <div id="pd-milestones-section" style="display:none;margin-bottom:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üéØ Project Milestones</h3>
        <div id="pd-milestones-list" style="max-height:300px;overflow-y:auto;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
            <!-- Milestones will be added here -->
        </div>
    </div>
    
    <!-- PROGRESS TRACKING -->
    <div id="pd-progress-tracking" style="display:none;">
        <h3 class="small" style="color:var(--accent);margin-bottom:12px;">üìà Progress Tracking</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;margin-bottom:20px;">
            <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Days Elapsed</div>
                <div id="pd-days-elapsed" style="font-size:28px;font-weight:700;color:var(--accent);">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Days Remaining</div>
                <div id="pd-days-remaining" style="font-size:28px;font-weight:700;color:#39ff14;">0</div>
            </div>
            
            <div style="padding:12px;background:rgba(255,165,0,0.1);border-radius:8px;border:1px solid rgba(255,165,0,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Progress</div>
                <div id="pd-progress-percent" style="font-size:28px;font-weight:700;color:#ffa500;">0%</div>
            </div>
            
            <div style="padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);text-align:center;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Buffer Used</div>
                <div id="pd-buffer-used" style="font-size:28px;font-weight:700;color:#9d4edd;">0%</div>
            </div>
        </div>
        
        <!-- PROGRESS BAR -->
        <div style="margin-bottom:20px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
                <div style="color:rgba(230,250,255,0.8);font-size:13px;">Project Progress</div>
                <div id="pd-progress-text" style="color:var(--accent);font-size:13px;font-weight:600;">0%</div>
            </div>
            <div style="height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;">
                <div id="pd-progress-bar" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:0%;border-radius:6px;transition:width 0.5s;"></div>
            </div>
        </div>
    </div>
</div>

<!-- PROJECT PLANNING TIPS -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(255,165,0,0.05));border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üí° Project Planning Tips</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
        <div>
            <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">üìÖ Realistic Scheduling</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Always include buffer time (20-30%)</li>
                <li>Account for weekends and holidays</li>
                <li>Break projects into milestones</li>
            </ul>
        </div>
        <div>
            <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">üéØ Milestone Planning</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Set clear checkpoints</li>
                <li>Track progress regularly</li>
                <li>Adjust timeline as needed</li>
            </ul>
        </div>
        <div>
            <div style="color:#ffa500;font-weight:600;margin-bottom:4px;">‚ö†Ô∏è Risk Management</div>
            <ul style="margin:0;padding-left:18px;color:rgba(230,250,255,0.9);font-size:13px;line-height:1.5;">
                <li>Identify potential delays early</li>
                <li>Have contingency plans</li>
                <li>Communicate timeline changes</li>
            </ul>
        </div>
    </div>
</div>

<script>
/* project-deadline.html
   - Advanced project deadline calculator with milestones
   - Scoped with pd- prefix
*/

// Project data storage
let pdProjects = [];
let pdCurrentProject = null;

// Load data from localStorage
function pdLoadData() {
    try {
        const savedProjects = localStorage.getItem('pd-projects');
        if (savedProjects) {
            pdProjects = JSON.parse(savedProjects);
        }
    } catch (e) {
        console.error('Failed to load project data:', e);
        pdProjects = [];
    }
}

// Save data to localStorage
function pdSaveData() {
    try {
        localStorage.setItem('pd-projects', JSON.stringify(pdProjects));
    } catch (e) {
        console.error('Failed to save project data:', e);
    }
}

// Set duration from quick buttons
function pdSetDuration(days) {
    const durationInput = document.getElementById('pd-duration');
    durationInput.value = days;
    durationInput.style.borderColor = '#39ff14';
    setTimeout(() => {
        durationInput.style.borderColor = 'rgba(45,212,255,0.3)';
    }, 1000);
    
    // Auto-calculate if start date is set
    const startDate = document.getElementById('pd-start').value;
    if (startDate) {
        pdCalculateDeadline();
    }
}

// Toggle milestone settings visibility
function pdToggleMilestoneSettings() {
    const showMilestones = document.getElementById('pd-show-milestones').checked;
    const milestoneSettings = document.getElementById('pd-milestone-settings');
    milestoneSettings.style.display = showMilestones ? 'block' : 'none';
}

// Calculate working days (excluding weekends if enabled)
function pdCalculateWorkingDays(startDate, totalDays, excludeWeekends) {
    if (!excludeWeekends) return totalDays;
    
    let workingDays = 0;
    let currentDate = new Date(startDate);
    
    for (let i = 0; i < totalDays; i++) {
        const dayOfWeek = currentDate.getDay();
        // Skip Saturday (6) and Sunday (0) if excludeWeekends is true
        if (dayOfWeek !== 0 && dayOfWeek !== 6) {
            workingDays++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    return workingDays;
}

// Calculate end date from start date and duration
function pdCalculateEndDate(startDate, durationDays, excludeWeekends) {
    const endDate = new Date(startDate);
    let daysAdded = 0;
    
    while (daysAdded < durationDays) {
        endDate.setDate(endDate.getDate() + 1);
        const dayOfWeek = endDate.getDay();
        
        if (!excludeWeekends || (dayOfWeek !== 0 && dayOfWeek !== 6)) {
            daysAdded++;
        }
    }
    
    return endDate;
}

// Format date for display
function pdFormatDate(date) {
    return date.toLocaleDateString('en-US', { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
}

// Calculate project deadline
function pdCalculateDeadline() {
    // Get input values
    const startDateStr = document.getElementById('pd-start').value;
    const duration = parseInt(document.getElementById('pd-duration').value) || 0;
    const bufferPercent = parseInt(document.getElementById('pd-buffer').value) || 0;
    const excludeWeekends = document.getElementById('pd-exclude-weekends').checked;
    const showMilestones = document.getElementById('pd-show-milestones').checked;
    
    // Validation
    if (!startDateStr) {
        alert('Please select a start date');
        return;
    }
    
    if (!duration || duration <= 0) {
        alert('Please enter a valid duration (minimum 1 day)');
        return;
    }
    
    const startDate = new Date(startDateStr);
    const bufferDays = Math.ceil(duration * (bufferPercent / 100));
    const totalDays = duration + bufferDays;
    
    // Calculate end date
    const endDate = pdCalculateEndDate(startDate, totalDays, excludeWeekends);
    const actualDuration = pdCalculateWorkingDays(startDate, totalDays, excludeWeekends);
    
    // Store current project data
    pdCurrentProject = {
        startDate: startDateStr,
        duration: duration,
        bufferPercent: bufferPercent,
        bufferDays: bufferDays,
        totalDays: totalDays,
        endDate: endDate.toISOString().split('T')[0],
        excludeWeekends: excludeWeekends,
        actualDuration: actualDuration
    };
    
    // Update display
    pdUpdateDisplay();
    
    // Generate milestones if enabled
    if (showMilestones) {
        pdGenerateMilestones(startDate, endDate, totalDays);
    }
    
    // Show save button
    document.getElementById('pd-save-btn').style.display = 'block';
}

// Update all display elements
function pdUpdateDisplay() {
    if (!pdCurrentProject) return;
    
    const startDate = new Date(pdCurrentProject.startDate);
    const endDate = new Date(pdCurrentProject.endDate);
    const today = new Date();
    
    // Calculate days elapsed and remaining
    const timeDiff = today.getTime() - startDate.getTime();
    const daysElapsed = Math.max(0, Math.floor(timeDiff / (1000 * 3600 * 24)));
    const totalDuration = pdCurrentProject.actualDuration;
    const daysRemaining = Math.max(0, totalDuration - daysElapsed);
    const progressPercent = Math.min(100, Math.round((daysElapsed / totalDuration) * 100));
    
    // Update timeline summary
    document.getElementById('pd-timeline-summary').style.display = 'block';
    document.getElementById('pd-deadline-date').textContent = pdFormatDate(endDate);
    document.getElementById('pd-total-days').textContent = `${pdCurrentProject.actualDuration} working days`;
    document.getElementById('pd-start-display').textContent = pdFormatDate(startDate);
    document.getElementById('pd-duration-display').textContent = `${pdCurrentProject.duration} days`;
    document.getElementById('pd-buffer-display').textContent = `${pdCurrentProject.bufferDays} days (${pdCurrentProject.bufferPercent}%)`;
    
    // Update timeline visualization
    document.getElementById('pd-timeline-visual').style.display = 'block';
    pdUpdateTimelineVisual();
    
    // Update progress tracking
    document.getElementById('pd-progress-tracking').style.display = 'block';
    document.getElementById('pd-days-elapsed').textContent = daysElapsed;
    document.getElementById('pd-days-remaining').textContent = daysRemaining;
    document.getElementById('pd-progress-percent').textContent = `${progressPercent}%`;
    document.getElementById('pd-progress-text').textContent = `${progressPercent}%`;
    
    // Update progress bar
    const progressBar = document.getElementById('pd-progress-bar');
    progressBar.style.width = `${progressPercent}%`;
    
    // Color progress bar based on progress
    if (progressPercent >= 100) {
        progressBar.style.background = 'linear-gradient(90deg, #39ff14, #2dd4ff)';
    } else if (progressPercent >= 75) {
        progressBar.style.background = 'linear-gradient(90deg, #ffa500, #39ff14)';
    } else if (progressPercent >= 50) {
        progressBar.style.background = 'linear-gradient(90deg, #ffcc00, #ffa500)';
    } else {
        progressBar.style.background = 'linear-gradient(90deg, var(--accent), #ffcc00)';
    }
    
    // Update buffer usage
    const bufferUsedPercent = Math.min(100, Math.round((daysElapsed - pdCurrentProject.duration) / pdCurrentProject.bufferDays * 100));
    document.getElementById('pd-buffer-used').textContent = `${Math.max(0, bufferUsedPercent)}%`;
}

// Update timeline visualization
function pdUpdateTimelineVisual() {
    if (!pdCurrentProject) return;
    
    const timelineBar = document.getElementById('pd-timeline-bar');
    const startDate = new Date(pdCurrentProject.startDate);
    const endDate = new Date(pdCurrentProject.endDate);
    const today = new Date();
    
    // Calculate positions
    const totalMs = endDate.getTime() - startDate.getTime();
    const elapsedMs = Math.max(0, today.getTime() - startDate.getTime());
    const progressPercent = Math.min(100, (elapsedMs / totalMs) * 100);
    
    // Create timeline visualization
    const durationPercent = (pdCurrentProject.duration / pdCurrentProject.totalDays) * 100;
    const bufferPercent = (pdCurrentProject.bufferDays / pdCurrentProject.totalDays) * 100;
    
    timelineBar.innerHTML = `
        <div style="position:absolute;top:0;left:0;width:100%;height:100%;display:flex;">
            <div style="width:${durationPercent}%;background:linear-gradient(90deg, rgba(45,212,255,0.5), rgba(45,212,255,0.8));border-radius:8px 0 0 8px;"></div>
            <div style="width:${bufferPercent}%;background:linear-gradient(90deg, rgba(157,78,221,0.5), rgba(157,78,221,0.8));border-radius:0 8px 8px 0;"></div>
        </div>
        <div style="position:absolute;top:0;left:${progressPercent}%;width:3px;height:100%;background:#ff2d55;"></div>
        <div style="position:absolute;top:-10px;left:${progressPercent}%;transform:translateX(-50%);color:#ff2d55;font-weight:600;font-size:12px;">Today</div>
    `;
    
    // Update timeline labels
    document.getElementById('pd-timeline-start').textContent = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    document.getElementById('pd-timeline-end').textContent = endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Generate milestones
function pdGenerateMilestones(startDate, endDate, totalDays) {
    const milestoneCount = parseInt(document.getElementById('pd-milestone-count').value) || 4;
    const milestoneType = document.getElementById('pd-milestone-type').value;
    const excludeWeekends = document.getElementById('pd-exclude-weekends').checked;
    
    const milestonesList = document.getElementById('pd-milestones-list');
    const milestonesSection = document.getElementById('pd-milestones-section');
    
    milestonesSection.style.display = 'block';
    milestonesList.innerHTML = '';
    
    // Calculate milestone dates
    const milestoneDates = [];
    
    if (milestoneType === 'equal') {
        // Equal intervals
        const interval = totalDays / (milestoneCount + 1);
        for (let i = 1; i <= milestoneCount; i++) {
            const milestoneDay = Math.round(interval * i);
            const milestoneDate = pdCalculateEndDate(startDate, milestoneDay, excludeWeekends);
            milestoneDates.push({
                number: i,
                day: milestoneDay,
                date: milestoneDate,
                percent: Math.round((milestoneDay / totalDays) * 100)
            });
        }
    } else if (milestoneType === 'weighted') {
        // Weighted toward start (more milestones early)
        const weights = [0.4, 0.25, 0.2, 0.15]; // Example weights for 4 milestones
        let cumulative = 0;
        for (let i = 0; i < milestoneCount; i++) {
            const weight = weights[i] || (1 / (milestoneCount * 2));
            cumulative += weight;
            const milestoneDay = Math.round(totalDays * cumulative);
            const milestoneDate = pdCalculateEndDate(startDate, milestoneDay, excludeWeekends);
            milestoneDates.push({
                number: i + 1,
                day: milestoneDay,
                date: milestoneDate,
                percent: Math.round(cumulative * 100)
            });
        }
    } else {
        // Custom percentages (simplified)
        const percentages = [25, 50, 75, 100]; // Default percentages
        for (let i = 0; i < milestoneCount; i++) {
            const percent = percentages[i] || Math.round(100 / milestoneCount * (i + 1));
            const milestoneDay = Math.round(totalDays * (percent / 100));
            const milestoneDate = pdCalculateEndDate(startDate, milestoneDay, excludeWeekends);
            milestoneDates.push({
                number: i + 1,
                day: milestoneDay,
                date: milestoneDate,
                percent: percent
            });
        }
    }
    
    // Display milestones
    milestoneDates.forEach(milestone => {
        const milestoneDiv = document.createElement('div');
        milestoneDiv.className = 'milestone-item';
        milestoneDiv.style.cssText = `
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 12px;
        `;
        
        milestoneDiv.innerHTML = `
            <div style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #9d4edd); 
                        display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                M${milestone.number}
            </div>
            <div style="flex: 1;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <div style="font-weight: 600; color: var(--accent);">Milestone ${milestone.number}</div>
                    <div style="padding: 2px 8px; background: rgba(57,255,20,0.1); border-radius: 4px; font-size: 12px; color: #39ff14;">
                        Day ${milestone.day}
                    </div>
                </div>
                <div style="color: rgba(230,250,255,0.9); font-size: 13px;">
                    ${pdFormatDate(milestone.date)} ‚Ä¢ ${milestone.percent}% complete
                </div>
            </div>
        `;
        
        milestonesList.appendChild(milestoneDiv);
    });
}

// Save current project
function pdSaveProject() {
    if (!pdCurrentProject) {
        alert('Calculate a deadline first!');
        return;
    }
    
    const projectName = prompt('Enter project name:', `Project ${pdProjects.length + 1}`);
    if (!projectName) return;
    
    const project = {
        id: Date.now(),
        name: projectName,
        ...pdCurrentProject,
        created: new Date().toISOString()
    };
    
    pdProjects.push(project);
    pdSaveData();
    
    // Show success message
    const saveBtn = document.getElementById('pd-save-btn');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = '‚úÖ Saved!';
    saveBtn.style.background = 'rgba(57,255,20,0.2)';
    saveBtn.style.borderColor = 'rgba(57,255,20,0.4)';
    saveBtn.style.color = '#39ff14';
    
    setTimeout(() => {
        saveBtn.textContent = originalText;
        saveBtn.style.background = 'rgba(57,255,20,0.1)';
        saveBtn.style.borderColor = 'rgba(57,255,20,0.3)';
        saveBtn.style.color = '#39ff14';
    }, 2000);
}

// Reset form
function pdResetForm() {
    document.getElementById('pd-start').value = new Date().toISOString().split('T')[0];
    document.getElementById('pd-duration').value = '30';
    document.getElementById('pd-buffer').value = '20';
    document.getElementById('pd-workdays').value = '7';
    document.getElementById('pd-exclude-weekends').checked = false;
    document.getElementById('pd-show-milestones').checked = true;
    document.getElementById('pd-milestone-count').value = '4';
    document.getElementById('pd-milestone-type').value = 'equal';
    
    // Hide all result sections
    document.getElementById('pd-timeline-summary').style.display = 'none';
    document.getElementById('pd-timeline-visual').style.display = 'none';
    document.getElementById('pd-milestones-section').style.display = 'none';
    document.getElementById('pd-progress-tracking').style.display = 'none';
    document.getElementById('pd-save-btn').style.display = 'none';
    
    // Reset current project
    pdCurrentProject = null;
    
    // Update milestone settings visibility
    pdToggleMilestoneSettings();
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Load saved data
        pdLoadData();
        
        // Set up event listeners
        const showMilestonesCheckbox = document.getElementById('pd-show-milestones');
        showMilestonesCheckbox.addEventListener('change', pdToggleMilestoneSettings);
        
        // Initialize milestone settings visibility
        pdToggleMilestoneSettings();
        
        // Set default date to today
        const startDateInput = card.querySelector('#pd-start');
        if (startDateInput && !startDateInput.value) {
            startDateInput.value = new Date().toISOString().split('T')[0];
        }
        
        console.log('Project Deadline Calculator ready');
    });
}
</script>

<style>
@keyframes pdPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

#project-deadline-title {
    color: var(--accent);
    margin-top: 0;
    background: linear-gradient(135deg, var(--accent), #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

#pd-timeline-summary {
    animation: pdPulse 2s ease-in-out infinite;
}

/* Milestone item hover effect */
.milestone-item:hover {
    background: rgba(45,212,255,0.05);
    border-radius: 8px;
    transition: background 0.2s;
}

/* Scrollbar styling */
#pd-milestones-list::-webkit-scrollbar {
    width: 6px;
}

#pd-milestones-list::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 3px;
}

#pd-milestones-list::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
}

/* Responsive design */
@media (max-width: 768px) {
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100% !important;
        margin: 4px 0 !important;
    }
    
    #pd-progress-tracking > div:first-child {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* Hover effects for duration buttons */
button[onclick^="pdSetDuration"]:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}
</style>
