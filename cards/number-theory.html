<h2 id="number-theory-title" style="margin-top:0;">üßÆ Advanced Number Theory Toolkit</h2>

<!-- Manifest metadata -->
<!--
  id: number-theory-tools
  title: Advanced Number Theory Toolkit
  path: cards/number-theory-tools.html
  category: Math & Science
  version: 2.0
  viral_tags: [math, number_theory, primes, cryptography, mathematics, education]
  accessibility: [keyboard_nav, screen_reader, mathml_support]
  languages: [en, es, fr, de, zh, ja, pt, ru]
  features: [prime_generation, factorization, gcd_lcm, modular_arithmetic, sequences, visualizations]
-->

<div style="margin-bottom:20px;">
  <div id="number-theory-desc" style="margin-bottom:16px;">
    <p style="margin:0 0 12px 0;color:var(--muted);font-size:14px;line-height:1.5;">
      <span style="color:var(--accent);font-weight:600;">Comprehensive number theory laboratory</span>: 
      Explore prime numbers, factorization, modular arithmetic, sequences, and advanced mathematical properties. 
      Perfect for students, educators, cryptography enthusiasts, and math lovers.
    </p>
    
    <!-- Quick Stats & Examples -->
    <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px;">
      <div style="flex:1;min-width:200px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="color:var(--muted);font-size:13px;">Largest Known Prime</span>
          <span style="color:var(--accent);font-weight:600;font-size:14px;">2‚Å∏¬≤À¢‚Å∏‚Åπ‚Åπ‚Åπ¬≥¬≥ - 1</span>
        </div>
        <div style="height:6px;background:var(--glass);border-radius:3px;overflow:hidden;">
          <div style="height:100%;background:linear-gradient(90deg, #9d4edd, #2dd4ff);width:100%;"></div>
        </div>
      </div>
      
      <div style="display:flex;gap:12px;">
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Digits of œÄ</div>
          <div id="nt-stats-pi" style="color:#39ff14;font-size:16px;font-weight:600;">3.14159...</div>
        </div>
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Primes ‚â§ 100</div>
          <div id="nt-stats-primes" style="color:#ff2d55;font-size:16px;font-weight:600;">25</div>
        </div>
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Perfect Numbers</div>
          <div id="nt-stats-perfect" style="color:#ffcc00;font-size:16px;font-weight:600;">4</div>
        </div>
      </div>
    </div>
    
    <!-- Quick Navigation -->
    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="display:flex;gap:6px;align-items:center;">
        <span style="color:var(--muted);font-size:12px;">üîç Quick Tools:</span>
        <button onclick="ntQuickTool('prime-check')" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">Prime Check</button>
        <button onclick="ntQuickTool('factorize')" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">Factorize</button>
        <button onclick="ntQuickTool('gcd-lcm')" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">GCD/LCM</button>
        <button onclick="ntQuickTool('modular')" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">Modular Math</button>
      </div>
      
      <div style="display:flex;gap:8px;">
        <button onclick="ntShareResults()" style="padding:6px 12px;background:linear-gradient(135deg, #1da1f2, #0d8bd9);color:white;border:none;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;">
          üì§ Share
        </button>
        <button onclick="ntToggleAdvanced()" style="padding:6px 12px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;">
          ‚öôÔ∏è Advanced
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Main Calculator Interface -->
<div style="display:grid;grid-template-columns:1fr 300px;gap:20px;margin-bottom:20px;">
  
  <!-- Left Column: Input & Operations -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:20px;background:var(--panel);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="color:var(--accent);font-size:16px;margin:0;">üî¢ Input Numbers & Operations</h3>
      <div style="display:flex;gap:8px;">
        <button onclick="ntLoadExample()" style="padding:6px 12px;font-size:12px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">
          Load Example
        </button>
        <button onclick="ntClearAll()" style="padding:6px 12px;font-size:12px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">
          Clear All
        </button>
      </div>
    </div>
    
    <!-- Number Inputs -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
      <div>
        <label for="nt-number" style="display:block;font-size:13px;color:var(--accent);margin-bottom:8px;">
          First Number (n)
          <button onclick="ntGeneratePrime()" style="margin-left:8px;padding:2px 6px;font-size:10px;background:var(--glass);border:1px solid var(--border);border-radius:3px;color:var(--accent);cursor:pointer;">
            Generate Prime
          </button>
        </label>
        <input id="nt-number" type="number" placeholder="Enter integer" 
               style="width:100%;padding:12px;border-radius:8px;border:2px solid var(--border);background:var(--glass);color:var(--text);font-size:16px;font-family:monospace;"
               min="0" max="1000000000" />
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button onclick="ntQuickInput(42)" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--text);cursor:pointer;">42</button>
          <button onclick="ntQuickInput(100)" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--text);cursor:pointer;">100</button>
          <button onclick="ntQuickInput(1729)" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--text);cursor:pointer;">1729</button>
          <button onclick="ntQuickInput(8128)" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--text);cursor:pointer;">8128</button>
        </div>
      </div>
      
      <div>
        <label for="nt-second" style="display:block;font-size:13px;color:var(--accent);margin-bottom:8px;">
          Second Number (m) <span style="color:var(--muted);font-size:11px;">(optional for some operations)</span>
        </label>
        <input id="nt-second" type="number" placeholder="Optional second integer" 
               style="width:100%;padding:12px;border-radius:8px;border:2px solid var(--border);background:var(--glass);color:var(--text);font-size:16px;font-family:monospace;"
               min="0" max="1000000000" />
      </div>
    </div>
    
    <!-- Operation Selection -->
    <div style="margin-bottom:24px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h4 style="color:var(--accent);font-size:14px;margin:0;display:flex;align-items:center;gap:6px;">
          ‚ö° Select Operation
        </h4>
        <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);">
          <input id="nt-show-steps" type="checkbox" checked />
          Show Detailed Steps
        </label>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:10px;">
        <button onclick="ntSelectOperation('prime-check')" class="nt-operation-btn active" data-operation="prime-check">
          <div style="font-size:20px;">üîç</div>
          <div style="font-size:12px;font-weight:600;">Prime Check</div>
        </button>
        
        <button onclick="ntSelectOperation('factorization')" class="nt-operation-btn" data-operation="factorization">
          <div style="font-size:20px;">üß©</div>
          <div style="font-size:12px;font-weight:600;">Factorization</div>
        </button>
        
        <button onclick="ntSelectOperation('gcd-lcm')" class="nt-operation-btn" data-operation="gcd-lcm">
          <div style="font-size:20px;">‚ÜîÔ∏è</div>
          <div style="font-size:12px;font-weight:600;">GCD/LCM</div>
        </button>
        
        <button onclick="ntSelectOperation('modular')" class="nt-operation-btn" data-operation="modular">
          <div style="font-size:20px;">‚è±Ô∏è</div>
          <div style="font-size:12px;font-weight:600;">Modular Math</div>
        </button>
        
        <button onclick="ntSelectOperation('sequences')" class="nt-operation-btn" data-operation="sequences">
          <div style="font-size:20px;">üìà</div>
          <div style="font-size:12px;font-weight:600;">Sequences</div>
        </button>
        
        <button onclick="ntSelectOperation('properties')" class="nt-operation-btn" data-operation="properties">
          <div style="font-size:20px;">üìä</div>
          <div style="font-size:12px;font-weight:600;">Properties</div>
        </button>
      </div>
      
      <!-- Operation Configuration -->
      <div id="nt-operation-config" style="margin-top:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid var(--border);">
        <div id="nt-prime-config" style="display:block;">
          <div style="font-size:13px;color:var(--accent);margin-bottom:8px;">Prime Check Options</div>
          <div style="display:flex;gap:12px;align-items:center;">
            <label style="display:flex;align-items:center;gap:6px;font-size:12px;">
              <input type="checkbox" id="nt-prime-probabilistic" />
              Use probabilistic test (faster for large numbers)
            </label>
            <button onclick="ntGeneratePrimes()" style="padding:6px 12px;font-size:12px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--accent);cursor:pointer;">
              Generate Primes
            </button>
          </div>
        </div>
        
        <div id="nt-factor-config" style="display:none;">
          <div style="font-size:13px;color:var(--accent);margin-bottom:8px;">Factorization Options</div>
          <div style="display:flex;gap:12px;align-items:center;">
            <label style="display:flex;align-items:center;gap:6px;font-size:12px;">
              <input type="radio" name="factor-method" value="trial-division" checked />
              Trial Division
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:12px;">
              <input type="radio" name="factor-method" value="pollard-rho" />
              Pollard's Rho (for larger numbers)
            </label>
          </div>
        </div>
        
        <div id="nt-modular-config" style="display:none;">
          <div style="font-size:13px;color:var(--accent);margin-bottom:8px;">Modular Arithmetic</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div>
              <label style="display:block;font-size:12px;color:var(--muted);margin-bottom:4px;">Modulus</label>
              <input id="nt-modulus" type="number" placeholder="e.g., 13" min="2" 
                     style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
            </div>
            <div>
              <label style="display:block;font-size:12px;color:var(--muted);margin-bottom:4px;">Operation</label>
              <select id="nt-modular-op" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);">
                <option value="addition">Addition</option>
                <option value="multiplication">Multiplication</option>
                <option value="exponentiation">Exponentiation</option>
                <option value="inverse">Modular Inverse</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div style="display:flex;gap:10px;">
      <button onclick="ntCalculate()" style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid var(--accent);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;">
        üöÄ Calculate
      </button>
      <button onclick="ntCopyResults()" style="padding:14px 20px;background:var(--glass);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;">
        üìã Copy Results
      </button>
      <button onclick="ntSaveSession()" style="padding:14px 20px;background:var(--glass);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;">
        üíæ Save
      </button>
    </div>
  </div>
  
  <!-- Right Column: Results & Visualizations -->
  <div style="display:flex;flex-direction:column;gap:20px;">
    
    <!-- Results Display -->
    <div style="border:2px solid var(--border);border-radius:12px;padding:20px;background:var(--panel);flex:1;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="color:var(--accent);font-size:16px;margin:0;">üìä Results & Analysis</h3>
        <div style="display:flex;gap:6px;">
          <button onclick="ntClearResults()" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
            Clear
          </button>
          <button onclick="ntExportResults()" style="padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
            Export
          </button>
        </div>
      </div>
      
      <div id="nt-output" style="height:400px;overflow-y:auto;padding-right:8px;">
        <div style="text-align:center;padding:60px 20px;color:var(--muted);font-style:italic;">
          <div style="font-size:20px;margin-bottom:8px;">üßÆ</div>
          <div>Enter numbers and select an operation</div>
          <div style="font-size:12px;margin-top:4px;">Results will appear here with detailed explanations</div>
        </div>
      </div>
      
      <div id="nt-performance" style="margin-top:12px;padding:10px;background:rgba(45,212,255,0.05);border-radius:6px;border:1px solid rgba(45,212,255,0.1);display:none;">
        <div style="display:flex;justify-content:space-between;font-size:12px;">
          <span style="color:var(--muted);">Computation Time</span>
          <span id="nt-computation-time" style="color:var(--accent);font-weight:600;">0.000ms</span>
        </div>
      </div>
    </div>
    
    <!-- Number Properties Summary -->
    <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
      <h4 style="color:#ffcc00;font-size:14px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
        ‚≠ê Number Properties
        <button onclick="ntAnalyzeProperties()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:#ffcc00;cursor:pointer;">
          Analyze
        </button>
      </h4>
      
      <div id="nt-properties-summary">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;">
          <div>
            <div style="color:var(--muted);">Type</div>
            <div id="nt-property-type" style="color:var(--text);font-weight:500;">-</div>
          </div>
          <div>
            <div style="color:var(--muted);">Divisor Count</div>
            <div id="nt-divisor-count" style="color:#39ff14;font-weight:600;">-</div>
          </div>
          <div>
            <div style="color:var(--muted);">Digital Root</div>
            <div id="nt-digital-root" style="color:#2dd4ff;font-weight:600;">-</div>
          </div>
          <div>
            <div style="color:var(--muted);">Base Conversions</div>
            <div id="nt-base-conversions" style="color:#9d4edd;font-weight:600;">-</div>
          </div>
        </div>
      </div>
      
      <button onclick="ntQuickProperties()" style="width:100%;padding:8px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;font-size:12px;margin-top:12px;">
        üîç Quick Properties Analysis
      </button>
    </div>
  </div>
</div>

<!-- Visualizations & Advanced Tools -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
  
  <!-- Factorization Visualization -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
    <h3 style="color:var(--accent);font-size:15px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
      üéØ Factorization Tree
      <button onclick="ntVisualizeFactorization()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
        Visualize
      </button>
    </h3>
    
    <div id="nt-factorization-tree" style="height:180px;display:flex;align-items:center;justify-content:center;">
      <div style="text-align:center;color:var(--muted);font-style:italic;padding:40px;">
        <div style="font-size:20px;margin-bottom:8px;">üå≥</div>
        <div>Enter a number and run factorization</div>
      </div>
    </div>
  </div>
  
  <!-- Prime Number Distribution -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
    <h3 style="color:var(--accent);font-size:15px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
      üìà Prime Distribution
      <button onclick="ntShowPrimeDistribution()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
        Generate Chart
      </button>
    </h3>
    
    <div id="nt-prime-distribution" style="height:180px;display:flex;align-items:center;justify-content:center;">
      <div style="text-align:center;color:var(--muted);font-style:italic;padding:40px;">
        <div style="font-size:20px;margin-bottom:8px;">üî¢</div>
        <div>Visualize prime number patterns</div>
      </div>
    </div>
  </div>
</div>

<!-- Advanced Features Section -->
<div id="nt-advanced-section" style="display:none;margin-bottom:20px;">
  <div style="border:2px solid var(--accent);border-radius:12px;padding:24px;background:var(--panel);">
    
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="color:var(--accent);font-size:16px;margin:0;">‚ö° Advanced Number Theory Tools</h3>
      <button onclick="ntToggleAdvanced()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">
        Hide Advanced
      </button>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;margin-bottom:20px;">
      
      <!-- Cryptography Tools -->
      <div>
        <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">üîê Cryptography & RSA</h4>
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Generate RSA Keys</div>
          <button onclick="ntGenerateRSA()" style="width:100%;padding:10px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">
            Generate RSA Key Pair
          </button>
        </div>
        
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Modular Exponentiation</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
            <input id="nt-mod-exp-base" type="number" placeholder="Base" 
                   style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
            <input id="nt-mod-exp-exp" type="number" placeholder="Exponent" 
                   style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
            <input id="nt-mod-exp-mod" type="number" placeholder="Modulus" 
                   style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
          </div>
          <button onclick="ntCalculateModExp()" style="width:100%;padding:8px;background:var(--accent);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;margin-top:8px;">
            Calculate a·µá mod n
          </button>
        </div>
      </div>
      
      <!-- Number Sequences -->
      <div>
        <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">üìä Number Sequences</h4>
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Sequence Type</div>
          <select id="nt-sequence-type" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);">
            <option value="primes">Prime Numbers</option>
            <option value="fibonacci">Fibonacci Numbers</option>
            <option value="triangular">Triangular Numbers</option>
            <option value="perfect">Perfect Numbers</option>
            <option value="armstrong">Armstrong Numbers</option>
            <option value="catalan">Catalan Numbers</option>
          </select>
        </div>
        
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Generate up to</div>
          <input id="nt-sequence-limit" type="number" min="1" max="1000" value="20" 
                 style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
        </div>
        
        <button onclick="ntGenerateSequence()" style="width:100%;padding:10px;background:var(--accent);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;">
          Generate Sequence
        </button>
      </div>
      
      <!-- Number Base Converter -->
      <div>
        <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">üîÑ Base Conversion</h4>
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Number to Convert</div>
          <input id="nt-base-number" type="text" placeholder="Enter number" 
                 style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
          <div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">From Base</div>
            <select id="nt-from-base" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);">
              <option value="2">Binary (2)</option>
              <option value="8">Octal (8)</option>
              <option value="10" selected>Decimal (10)</option>
              <option value="16">Hexadecimal (16)</option>
              <option value="32">Base32 (32)</option>
              <option value="64">Base64 (64)</option>
            </select>
          </div>
          
          <div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">To Base</div>
            <select id="nt-to-base" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);">
              <option value="2">Binary (2)</option>
              <option value="8">Octal (8)</option>
              <option value="10" selected>Decimal (10)</option>
              <option value="16">Hexadecimal (16)</option>
              <option value="32">Base32 (32)</option>
              <option value="64">Base64 (64)</option>
            </select>
          </div>
        </div>
        
        <button onclick="ntConvertBase()" style="width:100%;padding:10px;background:var(--accent);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;">
          Convert Base
        </button>
        
        <div id="nt-base-result" style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.05);border-radius:6px;border:1px solid rgba(57,255,20,0.1);display:none;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">Conversion Result</div>
          <div id="nt-base-result-value" style="font-size:16px;font-weight:700;color:var(--accent);"></div>
        </div>
      </div>
    </div>
    
    <!-- Export & Educational Tools -->
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">üíæ Export & Educational Resources</h4>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button onclick="ntExportCSV()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          üìä Export Results CSV
        </button>
        <button onclick="ntExportLaTeX()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          üìù Export LaTeX
        </button>
        <button onclick="ntGenerateWorksheet()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          üìö Generate Worksheet
        </button>
        <button onclick="ntPrintReport()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          üñ®Ô∏è Print Report
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Mathematical Insights & Examples -->
<div style="padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
  <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px;">
    <h3 style="color:var(--accent);font-size:14px;margin:0;">üìö Number Theory Insights</h3>
    <button onclick="ntToggleInsights()" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">
      Hide
    </button>
  </div>
  
  <div id="nt-insights-content" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Prime Number Theorem</div>
      <div style="color:var(--muted);font-size:12px;">œÄ(x) ‚âà x/ln(x) where œÄ(x) is the prime-counting function.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Euclid's Algorithm</div>
      <div style="color:var(--muted);font-size:12px;">For finding GCD: gcd(a,b) = gcd(b, a mod b). Efficient for large numbers.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Fermat's Little Theorem</div>
      <div style="color:var(--muted);font-size:12px;">If p is prime and a not divisible by p, then a^(p-1) ‚â° 1 mod p.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Perfect Numbers</div>
      <div style="color:var(--muted);font-size:12px;">Numbers equal to sum of proper divisors (6, 28, 496, 8128...).</div>
    </div>
  </div>
</div>

<script>
/* Advanced Number Theory Toolkit
   Features:
   - Prime number generation and testing
   - Integer factorization with multiple algorithms
   - GCD/LCM with extended Euclidean algorithm
   - Modular arithmetic and cryptography tools
   - Number sequences generation
   - Base conversion
   - Mathematical visualization
   - Educational resources
*/

// ========== GLOBAL STATE ==========
const nt = {
  // Current state
  currentOperation: 'prime-check',
  showSteps: true,
  history: [],
  sessionData: {},
  
  // Prime number cache
  primeCache: new Set([2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]),
  
  // Mathematical constants
  constants: {
    pi: '3.141592653589793',
    e: '2.718281828459045',
    phi: '1.618033988749895',
    sqrt2: '1.414213562373095'
  },
  
  // Number type classifications
  numberTypes: {
    prime: { name: 'Prime', color: '#ff2d55', description: 'Divisible only by 1 and itself' },
    composite: { name: 'Composite', color: '#39ff14', description: 'Has divisors other than 1 and itself' },
    perfect: { name: 'Perfect', color: '#ffcc00', description: 'Equals sum of its proper divisors' },
    abundant: { name: 'Abundant', color: '#2dd4ff', description: 'Sum of divisors > number' },
    deficient: { name: 'Deficient', color: '#9d4edd', description: 'Sum of divisors < number' },
    square: { name: 'Square', color: '#ff9500', description: 'Perfect square number' },
    triangular: { name: 'Triangular', color: '#5ac8fa', description: 'Can form equilateral triangle' },
    fibonacci: { name: 'Fibonacci', color: '#ff6b6b', description: 'In Fibonacci sequence' },
    armstrong: { name: 'Armstrong', color: '#4cd964', description: 'Equals sum of its digits raised to power of digit count' }
  },
  
  // Sequence generators
  sequences: {
    primes: [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71],
    fibonacci: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181],
    triangular: [1, 3, 6, 10, 15, 21, 28, 36, 45, 55, 66, 78, 91, 105, 120, 136, 153, 171, 190, 210],
    perfect: [6, 28, 496, 8128, 33550336, 8589869056, 137438691328],
    armstrong: [1, 2, 3, 4, 5, 6, 7, 8, 9, 153, 370, 371, 407, 1634, 8208, 9474],
    catalan: [1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, 16796, 58786, 208012, 742900, 2674440]
  }
};

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', function() {
  // Load saved session
  ntLoadSession();
  
  // Set up event listeners
  setupEventListeners();
  
  // Initialize UI
  updateOperationConfig();
  
  // Set initial example
  document.getElementById('nt-number').value = '42';
  document.getElementById('nt-second').value = '56';
  
  // Update statistics
  updateStatistics();
  
  // Announce to screen reader
  announceToScreenReader('Advanced Number Theory Toolkit loaded. Enter numbers and select operations to explore mathematical properties.');
});

function setupEventListeners() {
  // Auto-calculate on Enter key
  document.getElementById('nt-number').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      ntCalculate();
    }
  });
  
  // Update operation config when operation changes
  document.querySelectorAll('.nt-operation-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      updateOperationConfig();
    });
  });
  
  // Update show steps checkbox
  document.getElementById('nt-show-steps').addEventListener('change', function() {
    nt.showSteps = this.checked;
  });
}

// ========== CORE OPERATIONS ==========
function ntCalculate() {
  const startTime = performance.now();
  
  const nInput = document.getElementById('nt-number').value.trim();
  const mInput = document.getElementById('nt-second').value.trim();
  
  if (!nInput) {
    showNotification('Please enter at least one number', 'warning');
    return;
  }
  
  const n = parseBigInt(nInput);
  const m = mInput ? parseBigInt(mInput) : null;
  
  if (n === null) {
    showNotification('Invalid number format', 'error');
    return;
  }
  
  if (m !== null && isNaN(m)) {
    showNotification('Invalid second number', 'error');
    return;
  }
  
  let result;
  let steps = [];
  
  switch (nt.currentOperation) {
    case 'prime-check':
      result = performPrimeCheck(n, steps);
      break;
    case 'factorization':
      result = performFactorization(n, steps);
      break;
    case 'gcd-lcm':
      if (m === null) {
        showNotification('Second number required for GCD/LCM', 'warning');
        return;
      }
      result = performGcdLcm(n, m, steps);
      break;
    case 'modular':
      result = performModularArithmetic(n, m, steps);
      break;
    case 'sequences':
      result = performSequenceGeneration(n, steps);
      break;
    case 'properties':
      result = performPropertyAnalysis(n, steps);
      break;
    default:
      result = { error: 'Unknown operation' };
  }
  
  const endTime = performance.now();
  const computationTime = (endTime - startTime).toFixed(3);
  
  // Display results
  displayResults(result, steps);
  
  // Update performance
  document.getElementById('nt-performance').style.display = 'block';
  document.getElementById('nt-computation-time').textContent = computationTime + 'ms';
  
  // Update properties summary
  updatePropertiesSummary(n, m);
  
  // Add to history
  addToHistory(n, m, nt.currentOperation, result);
  
  // Save session
  ntSaveSession();
  
  // Announce completion
  announceToScreenReader(`Calculation completed in ${computationTime} milliseconds`);
}

function performPrimeCheck(n, steps) {
  steps.push(`Checking if ${n} is prime...`);
  
  if (n < 2) {
    steps.push(`Number is less than 2, therefore not prime.`);
    return {
      isPrime: false,
      type: n < 0 ? 'negative' : n === 0 ? 'zero' : 'one',
      message: `${n} is not prime (${n < 0 ? 'negative numbers are not prime' : n === 0 ? 'zero is not prime' : '1 is not prime'})`
    };
  }
  
  if (n === 2) {
    steps.push(`2 is the smallest and only even prime number.`);
    return {
      isPrime: true,
      type: 'prime',
      message: `${n} is prime (smallest prime)`
    };
  }
  
  if (n % 2 === 0) {
    steps.push(`Even number greater than 2 cannot be prime.`);
    return {
      isPrime: false,
      divisor: 2,
      message: `${n} is not prime (divisible by 2)`
    };
  }
  
  // Check small primes first
  const smallPrimes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
  for (const p of smallPrimes) {
    if (n % p === 0) {
      steps.push(`Divisible by ${p}.`);
      return {
        isPrime: false,
        divisor: p,
        message: `${n} is not prime (divisible by ${p})`
      };
    }
  }
  
  // Trial division up to sqrt(n)
  const limit = Math.floor(Math.sqrt(n));
  steps.push(`Testing divisibility up to ‚àö${n} ‚âà ${limit.toFixed(2)}`);
  
  for (let i = 3; i <= limit; i += 2) {
    if (n % i === 0) {
      steps.push(`Found divisor: ${i}`);
      return {
        isPrime: false,
        divisor: i,
        message: `${n} is not prime (divisible by ${i})`
      };
    }
  }
  
  steps.push(`No divisors found up to ‚àö${n}.`);
  steps.push(`${n} is prime!`);
  
  return {
    isPrime: true,
    type: 'prime',
    message: `${n} is prime`,
    nextPrime: findNextPrime(n),
    prevPrime: findPreviousPrime(n)
  };
}

function performFactorization(n, steps) {
  steps.push(`Factorizing ${n}...`);
  
  if (n < 2) {
    steps.push(`Numbers less than 2 have no prime factors.`);
    return {
      factors: [],
      primeFactors: [],
      message: `${n} has no prime factors`
    };
  }
  
  let original = n;
  let factors = [];
  let primeFactors = [];
  let current = n;
  
  // Check for 2
  while (current % 2 === 0) {
    factors.push(2);
    primeFactors.push(2);
    current /= 2;
    steps.push(`Divided by 2: ${current}`);
  }
  
  // Check odd numbers
  let divisor = 3;
  while (divisor * divisor <= current) {
    while (current % divisor === 0) {
      factors.push(divisor);
      if (isPrime(divisor)) {
        primeFactors.push(divisor);
      }
      current /= divisor;
      steps.push(`Divided by ${divisor}: ${current}`);
    }
    divisor += 2;
  }
  
  // If anything remains
  if (current > 1) {
    factors.push(current);
    if (isPrime(current)) {
      primeFactors.push(current);
    }
    steps.push(`Remaining factor: ${current}`);
  }
  
  // Calculate prime factorization string
  const factorGroups = {};
  factors.forEach(f => {
    factorGroups[f] = (factorGroups[f] || 0) + 1;
  });
  
  const primeFactorization = Object.entries(factorGroups)
    .map(([factor, count]) => count > 1 ? `${factor}^${count}` : factor)
    .join(' √ó ');
  
  steps.push(`Prime factorization: ${primeFactorization}`);
  
  return {
    factors: [...new Set(factors.sort((a, b) => a - b))],
    primeFactors: [...new Set(primeFactors.sort((a, b) => a - b))],
    factorization: factors,
    primeFactorization: primeFactorization,
    message: `${n} = ${primeFactorization}`,
    isPrime: factors.length === 1
  };
}

function performGcdLcm(a, b, steps) {
  steps.push(`Calculating GCD and LCM of ${a} and ${b}...`);
  
  const originalA = a;
  const originalB = b;
  
  // Euclidean algorithm with steps
  let stepsText = [];
  while (b !== 0) {
    const remainder = a % b;
    stepsText.push(`${a} = ${Math.floor(a / b)} √ó ${b} + ${remainder}`);
    a = b;
    b = remainder;
  }
  
  const gcd = Math.abs(a);
  steps.push(...stepsText);
  steps.push(`GCD = ${gcd}`);
  
  // Calculate LCM
  const lcm = Math.abs(originalA * originalB) / gcd;
  steps.push(`LCM = (${originalA} √ó ${originalB}) / ${gcd} = ${lcm}`);
  
  return {
    gcd: gcd,
    lcm: lcm,
    message: `GCD(${originalA}, ${originalB}) = ${gcd}, LCM(${originalA}, ${originalB}) = ${lcm}`,
    extended: performExtendedEuclidean(originalA, originalB)
  };
}

function performModularArithmetic(a, b, steps) {
  const modulusInput = document.getElementById('nt-modulus').value;
  const operation = document.getElementById('nt-modular-op').value;
  
  if (!modulusInput) {
    showNotification('Please enter a modulus', 'warning');
    return { error: 'Modulus required' };
  }
  
  const modulus = parseInt(modulusInput);
  if (modulus <= 0) {
    showNotification('Modulus must be positive', 'error');
    return { error: 'Invalid modulus' };
  }
  
  steps.push(`Performing modular arithmetic with modulus ${modulus}...`);
  
  let result;
  let message;
  
  switch (operation) {
    case 'addition':
      result = (a + b) % modulus;
      steps.push(`(${a} + ${b}) mod ${modulus} = ${result}`);
      message = `(${a} + ${b}) mod ${modulus} = ${result}`;
      break;
      
    case 'multiplication':
      result = (a * b) % modulus;
      steps.push(`(${a} √ó ${b}) mod ${modulus} = ${result}`);
      message = `(${a} √ó ${b}) mod ${modulus} = ${result}`;
      break;
      
    case 'exponentiation':
      if (!b && b !== 0) {
        showNotification('Exponent required for exponentiation', 'warning');
        return { error: 'Exponent required' };
      }
      result = modularExponentiation(a, b, modulus);
      steps.push(`${a}^${b} mod ${modulus} = ${result}`);
      message = `${a}^${b} mod ${modulus} = ${result}`;
      break;
      
    case 'inverse':
      if (!b) {
        // Find modular inverse of a
        const inverse = findModularInverse(a, modulus);
        if (inverse === null) {
          message = `${a} has no modular inverse modulo ${modulus}`;
        } else {
          message = `Modular inverse of ${a} modulo ${modulus} is ${inverse}`;
        }
      } else {
        // Check if a and b are inverses
        if ((a * b) % modulus === 1) {
          message = `${a} and ${b} are modular inverses modulo ${modulus}`;
        } else {
          message = `${a} and ${b} are NOT modular inverses modulo ${modulus}`;
        }
      }
      break;
  }
  
  return {
    result: result,
    modulus: modulus,
    operation: operation,
    message: message
  };
}

// ========== HELPER FUNCTIONS ==========
function parseBigInt(str) {
  // Handle large integers and scientific notation
  if (!str) return null;
  
  // Remove commas and spaces
  str = str.replace(/[, ]/g, '');
  
  // Check if it's a valid number
  if (!/^-?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(str)) {
    return null;
  }
  
  // Parse as float first to handle scientific notation
  const num = parseFloat(str);
  
  // Check if it's an integer
  if (!Number.isInteger(num)) {
    return null;
  }
  
  return num;
}

function isPrime(n) {
  if (n < 2) return false;
  if (n === 2) return true;
  if (n % 2 === 0) return false;
  
  // Check cache
  if (nt.primeCache.has(n)) return true;
  
  const limit = Math.floor(Math.sqrt(n));
  for (let i = 3; i <= limit; i += 2) {
    if (n % i === 0) return false;
  }
  
  // Add to cache
  if (n < 1000) {
    nt.primeCache.add(n);
  }
  
  return true;
}

function findNextPrime(n) {
  if (n < 2) return 2;
  
  let candidate = n + (n % 2 === 0 ? 1 : 2);
  while (!isPrime(candidate)) {
    candidate += 2;
  }
  return candidate;
}

function findPreviousPrime(n) {
  if (n <= 2) return null;
  
  let candidate = n - (n % 2 === 0 ? 1 : 2);
  while (candidate > 2 && !isPrime(candidate)) {
    candidate -= 2;
  }
  return candidate > 2 ? candidate : 2;
}

function modularExponentiation(base, exponent, modulus) {
  if (modulus === 1) return 0;
  
  let result = 1;
  base = base % modulus;
  
  while (exponent > 0) {
    if (exponent % 2 === 1) {
      result = (result * base) % modulus;
    }
    exponent = Math.floor(exponent / 2);
    base = (base * base) % modulus;
  }
  
  return result;
}

function findModularInverse(a, m) {
  // Extended Euclidean algorithm
  let [old_r, r] = [a, m];
  let [old_s, s] = [1, 0];
  let [old_t, t] = [0, 1];
  
  while (r !== 0) {
    const quotient = Math.floor(old_r / r);
    [old_r, r] = [r, old_r - quotient * r];
    [old_s, s] = [s, old_s - quotient * s];
    [old_t, t] = [t, old_t - quotient * t];
  }
  
  if (old_r > 1) return null; // No inverse exists
  if (old_s < 0) old_s += m;
  
  return old_s;
}

function performExtendedEuclidean(a, b) {
  let [old_r, r] = [a, b];
  let [old_s, s] = [1, 0];
  let [old_t, t] = [0, 1];
  
  const steps = [];
  
  while (r !== 0) {
    const quotient = Math.floor(old_r / r);
    steps.push(`${old_r} = ${quotient} √ó ${r} + ${old_r - quotient * r}`);
    
    [old_r, r] = [r, old_r - quotient * r];
    [old_s, s] = [s, old_s - quotient * s];
    [old_t, t] = [t, old_t - quotient * t];
  }
  
  return {
    gcd: old_r,
    coefficients: { x: old_s, y: old_t },
    equation: `${old_s} √ó ${a} + ${old_t} √ó ${b} = ${old_r}`,
    steps: steps
  };
}

// ========== UI UPDATES ==========
function displayResults(result, steps) {
  const output = document.getElementById('nt-output');
  
  let html = '';
  
  // Header
  html += `<div style="margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border);">`;
  html += `<div style="color:var(--accent);font-weight:600;font-size:16px;">üìã Results</div>`;
  html += `<div style="color:var(--muted);font-size:13px;margin-top:4px;">${new Date().toLocaleTimeString()}</div>`;
  html += `</div>`;
  
  // Main result
  if (result.message) {
    html += `<div style="margin-bottom:16px;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">`;
    html += `<div style="color:var(--text);font-size:18px;font-weight:700;">${result.message}</div>`;
    html += `</div>`;
  }
  
  // Detailed results
  if (result.gcd !== undefined) {
    html += `<div style="margin-bottom:12px;">`;
    html += `<div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Extended Results:</div>`;
    html += `<div style="color:var(--text);font-size:14px;">GCD = ${result.gcd}, LCM = ${result.lcm}</div>`;
    if (result.extended) {
      html += `<div style="color:var(--muted);font-size:13px;margin-top:4px;">${result.extended.equation}</div>`;
    }
    html += `</div>`;
  }
  
  if (result.factors) {
    html += `<div style="margin-bottom:12px;">`;
    html += `<div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Factorization:</div>`;
    html += `<div style="color:var(--text);font-size:14px;">${result.primeFactorization || result.factors.join(' √ó ')}</div>`;
    html += `</div>`;
  }
  
  // Steps
  if (nt.showSteps && steps.length > 0) {
    html += `<div style="margin-top:20px;">`;
    html += `<div style="color:var(--accent);font-weight:600;margin-bottom:8px;">üîç Calculation Steps:</div>`;
    html += `<div style="background:var(--glass);padding:12px;border-radius:8px;border:1px solid var(--border);">`;
    steps.forEach((step, i) => {
      html += `<div style="margin-bottom:${i === steps.length - 1 ? '0' : '6px'};color:var(--text);font-size:13px;font-family:'Courier New',monospace;">${i + 1}. ${step}</div>`;
    });
    html += `</div>`;
    html += `</div>`;
  }
  
  // Additional info
  html += `<div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">`;
  html += `<div style="color:var(--muted);font-size:12px;">Operation: ${getOperationName(nt.currentOperation)}</div>`;
  html += `</div>`;
  
  output.innerHTML = html;
  output.scrollTop = 0;
}

function updatePropertiesSummary(n, m) {
  // Analyze number properties
  const properties = analyzeNumberProperties(n);
  
  document.getElementById('nt-property-type').textContent = properties.type.name;
  document.getElementById('nt-property-type').style.color = properties.type.color;
  
  document.getElementById('nt-divisor-count').textContent = properties.divisors.length;
  
  document.getElementById('nt-digital-root').textContent = calculateDigitalRoot(n);
  
  // Base conversions
  const bases = [2, 8, 16];
  const conversions = bases.map(base => `${n.toString(base)}‚Çç${base}‚Çé`).join(', ');
  document.getElementById('nt-base-conversions').textContent = conversions.substring(0, 20) + (conversions.length > 20 ? '...' : '');
}

function analyzeNumberProperties(n) {
  const properties = {
    type: nt.numberTypes.composite,
    divisors: [],
    isPrime: isPrime(n),
    isPerfect: false,
    isSquare: Math.sqrt(n) % 1 === 0,
    isTriangular: isTriangular(n),
    isFibonacci: isFibonacci(n),
    isArmstrong: isArmstrong(n)
  };
  
  // Find divisors
  for (let i = 1; i <= Math.sqrt(n); i++) {
    if (n % i === 0) {
      properties.divisors.push(i);
      if (i !== n / i) {
        properties.divisors.push(n / i);
      }
    }
  }
  properties.divisors.sort((a, b) => a - b);
  
  // Determine number type
  if (properties.isPrime) {
    properties.type = nt.numberTypes.prime;
  } else if (properties.isPerfect) {
    properties.type = nt.numberTypes.perfect;
  } else if (properties.isSquare) {
    properties.type = nt.numberTypes.square;
  } else if (properties.isTriangular) {
    properties.type = nt.numberTypes.triangular;
  } else if (properties.isFibonacci) {
    properties.type = nt.numberTypes.fibonacci;
  } else if (properties.isArmstrong) {
    properties.type = nt.numberTypes.armstrong;
  }
  
  return properties;
}

function calculateDigitalRoot(n) {
  while (n >= 10) {
    n = n.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
  }
  return n;
}

function isTriangular(n) {
  // n = k(k+1)/2
  const k = Math.floor(Math.sqrt(2 * n));
  return k * (k + 1) / 2 === n;
}

function isFibonacci(n) {
  // n is Fibonacci if and only if 5n¬≤ ¬± 4 is perfect square
  const x = 5 * n * n;
  return isPerfectSquare(x + 4) || isPerfectSquare(x - 4);
}

function isPerfectSquare(n) {
  const root = Math.floor(Math.sqrt(n));
  return root * root === n;
}

function isArmstrong(n) {
  const digits = n.toString().split('').map(Number);
  const power = digits.length;
  const sum = digits.reduce((acc, digit) => acc + Math.pow(digit, power), 0);
  return sum === n;
}

// ========== UI INTERACTIONS ==========
function ntSelectOperation(operation) {
  nt.currentOperation = operation;
  
  // Update button states
  document.querySelectorAll('.nt-operation-btn').forEach(btn => {
    if (btn.dataset.operation === operation) {
      btn.classList.add('active');
      btn.style.background = 'rgba(45,212,255,0.1)';
      btn.style.borderColor = 'var(--accent)';
    } else {
      btn.classList.remove('active');
      btn.style.background = 'var(--glass)';
      btn.style.borderColor = 'var(--border)';
    }
  });
  
  updateOperationConfig();
}

function updateOperationConfig() {
  // Hide all config sections
  document.querySelectorAll('#nt-operation-config > div').forEach(div => {
    div.style.display = 'none';
  });
  
  // Show relevant config
  const configId = `nt-${nt.currentOperation}-config`;
  const configDiv = document.getElementById(configId);
  if (configDiv) {
    configDiv.style.display = 'block';
  }
}

function ntQuickTool(tool) {
  switch (tool) {
    case 'prime-check':
      ntSelectOperation('prime-check');
      document.getElementById('nt-number').value = '7919';
      document.getElementById('nt-second').value = '';
      break;
    case 'factorize':
      ntSelectOperation('factorization');
      document.getElementById('nt-number').value = '123456';
      document.getElementById('nt-second').value = '';
      break;
    case 'gcd-lcm':
      ntSelectOperation('gcd-lcm');
      document.getElementById('nt-number').value = '48';
      document.getElementById('nt-second').value = '180';
      break;
    case 'modular':
      ntSelectOperation('modular');
      document.getElementById('nt-number').value = '7';
      document.getElementById('nt-second').value = '3';
      document.getElementById('nt-modulus').value = '13';
      break;
  }
  
  ntCalculate();
}

function ntQuickInput(value) {
  document.getElementById('nt-number').value = value;
  document.getElementById('nt-number').focus();
}

function ntGeneratePrime() {
  // Generate a random prime in reasonable range
  const min = 100;
  const max = 10000;
  
  let candidate;
  do {
    candidate = Math.floor(Math.random() * (max - min + 1)) + min;
    // Make it odd
    if (candidate % 2 === 0) candidate++;
  } while (!isPrime(candidate));
  
  document.getElementById('nt-number').value = candidate;
  document.getElementById('nt-number').focus();
  showNotification(`Generated prime number: ${candidate}`, 'success');
}

// ========== ADVANCED FEATURES ==========
function ntGeneratePrimes() {
  const limit = prompt('Generate primes up to:', '100');
  if (!limit) return;
  
  const max = parseInt(limit);
  if (isNaN(max) || max < 2 || max > 100000) {
    showNotification('Please enter a number between 2 and 100,000', 'error');
    return;
  }
  
  const primes = [];
  for (let i = 2; i <= max; i++) {
    if (isPrime(i)) primes.push(i);
  }
  
  const output = document.getElementById('nt-output');
  output.innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">Prime Numbers ‚â§ ${max}</div>
      <div style="color:var(--muted);font-size:13px;">Total: ${primes.length} primes</div>
    </div>
    <div style="max-height:300px;overflow-y:auto;">
      <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(60px, 1fr));gap:6px;">
        ${primes.map(p => `
          <div style="padding:6px;background:${p === 2 ? '#ff2d55' : 'rgba(255,45,85,0.1)'};border:1px solid rgba(255,45,85,0.3);border-radius:4px;color:#ff2d55;text-align:center;font-family:monospace;">
            ${p}
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function ntVisualizeFactorization() {
  const nInput = document.getElementById('nt-number').value.trim();
  if (!nInput) {
    showNotification('Please enter a number to visualize', 'warning');
    return;
  }
  
  const n = parseBigInt(nInput);
  if (n === null || n < 2) {
    showNotification('Please enter a positive integer ‚â• 2', 'error');
    return;
  }
  
  const result = performFactorization(n, []);
  
  const treeDiv = document.getElementById('nt-factorization-tree');
  treeDiv.innerHTML = `
    <div style="text-align:center;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">Factorization Tree of ${n}</div>
      <div style="font-size:24px;color:var(--text);margin-bottom:12px;">${result.primeFactorization}</div>
      <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-top:12px;">
        ${result.factors.map(factor => `
          <div style="padding:8px 12px;background:${isPrime(factor) ? 'rgba(255,45,85,0.1)' : 'rgba(45,212,255,0.1)'};border:1px solid ${isPrime(factor) ? 'rgba(255,45,85,0.3)' : 'rgba(45,212,255,0.3)'};border-radius:6px;color:${isPrime(factor) ? '#ff2d55' : 'var(--accent)'};font-weight:600;">
            ${factor}
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function ntShowPrimeDistribution() {
  const limit = 100;
  const primes = [];
  for (let i = 2; i <= limit; i++) {
    if (isPrime(i)) primes.push(i);
  }
  
  const distributionDiv = document.getElementById('nt-prime-distribution');
  distributionDiv.innerHTML = `
    <div style="width:100%;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">Prime Distribution ‚â§ ${limit}</div>
      <div style="display:grid;grid-template-columns:repeat(10, 1fr);gap:2px;">
        ${Array.from({length: limit}, (_, i) => i + 1).map(num => `
          <div style="aspect-ratio:1;display:flex;align-items:center;justify-content:center;background:${isPrime(num) ? '#ff2d55' : 'var(--glass)'};border-radius:2px;color:${isPrime(num) ? 'white' : 'var(--muted)'};font-size:10px;">
            ${num}
          </div>
        `).join('')}
      </div>
      <div style="color:var(--muted);font-size:11px;text-align:center;margin-top:8px;">
        ${primes.length} primes out of ${limit} numbers (${(primes.length/limit*100).toFixed(1)}%)
      </div>
    </div>
  `;
}

function ntGenerateSequence() {
  const type = document.getElementById('nt-sequence-type').value;
  const limit = parseInt(document.getElementById('nt-sequence-limit').value) || 20;
  
  let sequence;
  let description;
  
  switch (type) {
    case 'primes':
      sequence = generatePrimes(limit);
      description = 'Prime Numbers';
      break;
    case 'fibonacci':
      sequence = generateFibonacci(limit);
      description = 'Fibonacci Numbers';
      break;
    case 'triangular':
      sequence = generateTriangular(limit);
      description = 'Triangular Numbers';
      break;
    case 'perfect':
      sequence = nt.sequences.perfect.filter((_, i) => i < limit);
      description = 'Perfect Numbers';
      break;
    case 'armstrong':
      sequence = generateArmstrong(limit);
      description = 'Armstrong Numbers';
      break;
    case 'catalan':
      sequence = generateCatalan(limit);
      description = 'Catalan Numbers';
      break;
  }
  
  const output = document.getElementById('nt-output');
  output.innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">${description}</div>
      <div style="color:var(--muted);font-size:13px;">First ${limit} numbers</div>
    </div>
    <div style="max-height:300px;overflow-y:auto;">
      <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(80px, 1fr));gap:8px;">
        ${sequence.map((num, i) => `
          <div style="padding:10px;background:var(--glass);border:1px solid var(--border);border-radius:6px;text-align:center;">
            <div style="color:var(--muted);font-size:11px;">${i + 1}.</div>
            <div style="color:var(--text);font-weight:600;font-size:14px;">${formatLargeNumber(num)}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function generatePrimes(limit) {
  const primes = [];
  let num = 2;
  while (primes.length < limit) {
    if (isPrime(num)) primes.push(num);
    num++;
  }
  return primes;
}

function generateFibonacci(limit) {
  const fib = [0, 1];
  for (let i = 2; i < limit; i++) {
    fib.push(fib[i-1] + fib[i-2]);
  }
  return fib.slice(0, limit);
}

function generateTriangular(limit) {
  const triangular = [];
  for (let i = 1; i <= limit; i++) {
    triangular.push(i * (i + 1) / 2);
  }
  return triangular;
}

function generateArmstrong(limit) {
  const armstrong = [];
  let num = 1;
  while (armstrong.length < limit && num < 100000) {
    if (isArmstrong(num)) armstrong.push(num);
    num++;
  }
  return armstrong.slice(0, limit);
}

function generateCatalan(limit) {
  const catalan = [1];
  for (let n = 1; n < limit; n++) {
    let c = 0;
    for (let i = 0; i < n; i++) {
      c += catalan[i] * catalan[n - 1 - i];
    }
    catalan.push(c);
  }
  return catalan.slice(0, limit);
}

function ntConvertBase() {
  const number = document.getElementById('nt-base-number').value.trim();
  const fromBase = parseInt(document.getElementById('nt-from-base').value);
  const toBase = parseInt(document.getElementById('nt-to-base').value);
  
  if (!number) {
    showNotification('Please enter a number', 'warning');
    return;
  }
  
  // Convert from source base to decimal
  let decimal;
  try {
    decimal = parseInt(number, fromBase);
    if (isNaN(decimal)) throw new Error('Invalid number for base');
  } catch (error) {
    showNotification(`Invalid number for base ${fromBase}`, 'error');
    return;
  }
  
  // Convert decimal to target base
  const result = decimal.toString(toBase).toUpperCase();
  
  // Display result
  const resultDiv = document.getElementById('nt-base-result');
  const valueDiv = document.getElementById('nt-base-result-value');
  
  valueDiv.textContent = `${result}‚Çç${toBase}‚Çé`;
  resultDiv.style.display = 'block';
  
  // Also update output
  const output = document.getElementById('nt-output');
  output.innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="color:var(--accent);font-weight:600;font-size:16px;">Base Conversion</div>
    </div>
    <div style="padding:16px;background:var(--glass);border-radius:8px;border:1px solid var(--border);">
      <div style="color:var(--text);font-size:18px;text-align:center;margin-bottom:12px;">
        ${number}‚Çç${fromBase}‚Çé = ${result}‚Çç${toBase}‚Çé
      </div>
      <div style="color:var(--muted);font-size:13px;text-align:center;">
        Decimal: ${decimal}
      </div>
    </div>
  `;
}

// ========== UTILITY FUNCTIONS ==========
function getOperationName(op) {
  const names = {
    'prime-check': 'Prime Number Check',
    'factorization': 'Integer Factorization',
    'gcd-lcm': 'Greatest Common Divisor / Least Common Multiple',
    'modular': 'Modular Arithmetic',
    'sequences': 'Number Sequences',
    'properties': 'Number Properties Analysis'
  };
  return names[op] || op;
}

function formatLargeNumber(n) {
  if (n < 1000) return n.toString();
  if (n < 1000000) return (n / 1000).toFixed(1) + 'K';
  if (n < 1000000000) return (n / 1000000).toFixed(1) + 'M';
  if (n < 1000000000000) return (n / 1000000000).toFixed(1) + 'B';
  return n.toExponential(2);
}

function addToHistory(n, m, operation, result) {
  const entry = {
    timestamp: new Date().toISOString(),
    n: n,
    m: m,
    operation: operation,
    result: result.message || 'Calculation completed'
  };
  
  nt.history.unshift(entry);
  
  // Keep only last 20 entries
  if (nt.history.length > 20) {
    nt.history = nt.history.slice(0, 20);
  }
}

function updateStatistics() {
  // Update prime count
  const primesUnder100 = Array.from({length: 99}, (_, i) => i + 2)
    .filter(n => isPrime(n)).length;
  document.getElementById('nt-stats-primes').textContent = primesUnder100;
  
  // Update perfect number count
  const knownPerfect = nt.sequences.perfect.length;
  document.getElementById('nt-stats-perfect').textContent = knownPerfect;
}

// ========== UI ACTIONS ==========
function ntClearAll() {
  if (confirm('Clear all inputs and results?')) {
    document.getElementById('nt-number').value = '';
    document.getElementById('nt-second').value = '';
    document.getElementById('nt-output').innerHTML = `
      <div style="text-align:center;padding:60px 20px;color:var(--muted);font-style:italic;">
        <div style="font-size:20px;margin-bottom:8px;">üßÆ</div>
        <div>Enter numbers and select an operation</div>
      </div>
    `;
    document.getElementById('nt-performance').style.display = 'none';
    
    showNotification('All inputs cleared', 'info');
  }
}

function ntClearResults() {
  document.getElementById('nt-output').innerHTML = `
    <div style="text-align:center;padding:60px 20px;color:var(--muted);font-style:italic;">
      <div style="font-size:20px;margin-bottom:8px;">üßÆ</div>
      <div>Enter numbers and select an operation</div>
    </div>
  `;
  document.getElementById('nt-performance').style.display = 'none';
}

function ntCopyResults() {
  const output = document.getElementById('nt-output').textContent;
  if (!output || output.includes('Enter numbers')) {
    showNotification('No results to copy', 'warning');
    return;
  }
  
  navigator.clipboard.writeText(output)
    .then(() => {
      showNotification('Results copied to clipboard', 'success');
    })
    .catch(() => {
      showNotification('Failed to copy results', 'error');
    });
}

function ntSaveSession() {
  const session = {
    n: document.getElementById('nt-number').value,
    m: document.getElementById('nt-second').value,
    operation: nt.currentOperation,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem('numberTheorySession', JSON.stringify(session));
}

function ntLoadSession() {
  try {
    const saved = localStorage.getItem('numberTheorySession');
    if (saved) {
      const session = JSON.parse(saved);
      document.getElementById('nt-number').value = session.n || '';
      document.getElementById('nt-second').value = session.m || '';
      if (session.operation) {
        ntSelectOperation(session.operation);
      }
    }
  } catch (error) {
    console.error('Failed to load session:', error);
  }
}

function ntToggleAdvanced() {
  const section = document.getElementById('nt-advanced-section');
  const btn = document.querySelector('button[onclick="ntToggleAdvanced()"]');
  
  if (section.style.display === 'none' || !section.style.display) {
    section.style.display = 'block';
    btn.textContent = 'Hide Advanced';
  } else {
    section.style.display = 'none';
    btn.textContent = 'Show Advanced';
  }
}

function ntToggleInsights() {
  const insights = document.getElementById('nt-insights-content');
  const btn = document.querySelector('button[onclick="ntToggleInsights()"]');
  
  if (insights.style.display === 'none') {
    insights.style.display = 'grid';
    btn.textContent = 'Hide';
  } else {
    insights.style.display = 'none';
    btn.textContent = 'Show';
  }
}

function ntShareResults() {
  const n = document.getElementById('nt-number').value;
  const operation = getOperationName(nt.currentOperation);
  
  let shareText = `üî¢ Number Theory Calculation\n\n`;
  shareText += `Operation: ${operation}\n`;
  shareText += `Input: ${n}`;
  
  const second = document.getElementById('nt-second').value;
  if (second) shareText += `, ${second}\n`;
  else shareText += `\n`;
  
  const outputText = document.getElementById('nt-output').textContent;
  if (outputText && !outputText.includes('Enter numbers')) {
    const lines = outputText.split('\n').slice(0, 3).filter(line => line.trim());
    shareText += `Result: ${lines.join(' ')}\n\n`;
  }
  
  shareText += `Calculated with The Most Useful Site in the World`;
  
  // Try Web Share API
  if (navigator.share) {
    navigator.share({
      title: 'Number Theory Calculation',
      text: shareText,
      url: window.location.href
    }).catch(console.error);
  } else {
    // Fallback to clipboard
    navigator.clipboard.writeText(shareText)
      .then(() => {
        showNotification('Results copied to clipboard!', 'success');
      })
      .catch(() => {
        // Show share dialog
        const shareDiv = document.createElement('div');
        shareDiv.innerHTML = `
          <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);padding:20px;border-radius:12px;border:2px solid var(--accent);z-index:10000;max-width:500px;">
            <h3 style="color:var(--accent);margin:0 0 10px 0;">Share Calculation</h3>
            <textarea style="width:100%;height:200px;padding:10px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);margin-bottom:15px;font-family:monospace;font-size:12px;">${shareText}</textarea>
            <div style="display:flex;gap:10px;justify-content:flex-end;">
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">Close</button>
            </div>
          </div>
        `;
        document.body.appendChild(shareDiv);
      });
  }
}

function ntExportResults() {
  const outputText = document.getElementById('nt-output').textContent;
  if (!outputText || outputText.includes('Enter numbers')) {
    showNotification('No results to export', 'warning');
    return;
  }
  
  const blob = new Blob([outputText], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `number-theory-results-${new Date().toISOString().split('T')[0]}.txt`;
  link.click();
  URL.revokeObjectURL(url);
  
  showNotification('Results exported as text file', 'success');
}

function ntExportCSV() {
  // Export history as CSV
  if (nt.history.length === 0) {
    showNotification('No calculation history to export', 'info');
    return;
  }
  
  const headers = ['Timestamp', 'Operation', 'Number 1', 'Number 2', 'Result'];
  const rows = nt.history.map(entry => [
    new Date(entry.timestamp).toLocaleString(),
    getOperationName(entry.operation),
    entry.n,
    entry.m || '',
    entry.result.substring(0, 100) // Truncate long results
  ]);
  
  const csv = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `number-theory-history-${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  URL.revokeObjectURL(url);
  
  showNotification('History exported as CSV', 'success');
}

function ntExportLaTeX() {
  const n = document.getElementById('nt-number').value;
  const m = document.getElementById('nt-second').value;
  const operation = nt.currentOperation;
  
  let latex = '';
  
  switch (operation) {
    case 'prime-check':
      latex = `\\textbf{Prime Check:} \\\\\n`;
      latex += `Is ${n} prime? \\\\\n`;
      if (isPrime(parseInt(n))) {
        latex += `\\text{Yes, } ${n} \\text{ is prime.}`;
      } else {
        latex += `\\text{No, } ${n} \\text{ is composite.}`;
      }
      break;
      
    case 'factorization':
      const factors = performFactorization(parseInt(n), []).primeFactorization;
      latex = `\\textbf{Factorization:} \\\\\n`;
      latex += `${n} = ${factors}`;
      break;
      
    case 'gcd-lcm':
      const gcd = performGcdLcm(parseInt(n), parseInt(m), []).gcd;
      const lcm = performGcdLcm(parseInt(n), parseInt(m), []).lcm;
      latex = `\\textbf{GCD and LCM:} \\\\\n`;
      latex += `\\gcd(${n}, ${m}) = ${gcd} \\\\\n`;
      latex += `\\operatorname{lcm}(${n}, ${m}) = ${lcm}`;
      break;
  }
  
  const blob = new Blob([latex], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `number-theory-${new Date().toISOString().split('T')[0]}.tex`;
  link.click();
  URL.revokeObjectURL(url);
  
  showNotification('LaTeX code exported', 'success');
}

function ntPrintReport() {
  const printWindow = window.open('', '_blank');
  const n = document.getElementById('nt-number').value;
  const m = document.getElementById('nt-second').value;
  const operation = getOperationName(nt.currentOperation);
  const outputText = document.getElementById('nt-output').textContent;
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Number Theory Report</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
          h1 { color: #2dd4ff; border-bottom: 2px solid #2dd4ff; padding-bottom: 10px; }
          .info { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
          .info-item { margin: 5px 0; }
          .results { background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0; white-space: pre-wrap; font-family: monospace; }
          .footer { margin-top: 40px; color: #666; font-size: 12px; text-align: center; }
        </style>
      </head>
      <body>
        <h1>Number Theory Report</h1>
        <div class="info">
          <div class="info-item"><strong>Date:</strong> ${new Date().toLocaleDateString()}</div>
          <div class="info-item"><strong>Operation:</strong> ${operation}</div>
          <div class="info-item"><strong>Input 1:</strong> ${n}</div>
          ${m ? `<div class="info-item"><strong>Input 2:</strong> ${m}</div>` : ''}
        </div>
        
        <h2>Results</h2>
        <div class="results">${outputText}</div>
        
        <div class="footer">
          Generated by The Most Useful Site in the World - Number Theory Toolkit
        </div>
        
        <script>
          window.onload = function() {
            window.print();
            setTimeout(function() {
              window.close();
            }, 1000);
          }
        <\/script>
      </body>
    </html>
  `);
  printWindow.document.close();
}

function showNotification(message, type = 'info') {
  // Remove existing notifications
  document.querySelectorAll('.nt-notification').forEach(el => el.remove());
  
  const notification = document.createElement('div');
  notification.className = 'nt-notification';
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    border-radius: 8px;
    background: ${type === 'error' ? '#ff2d55' : type === 'warning' ? '#ff9500' : type === 'success' ? '#39ff14' : 'var(--accent)'};
    color: #000;
    font-weight: 600;
    z-index: 10001;
    animation: slideIn 0.3s ease;
    max-width: 300px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  `;
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Auto-remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

function announceToScreenReader(message) {
  const liveRegion = document.getElementById('nt-screen-reader') || (() => {
    const region = document.createElement('div');
    region.id = 'nt-screen-reader';
    region.setAttribute('aria-live', 'polite');
    region.setAttribute('aria-atomic', 'true');
    region.style.cssText = 'position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;';
    document.body.appendChild(region);
    return region;
  })();
  
  liveRegion.textContent = message;
  setTimeout(() => { liveRegion.textContent = ''; }, 1000);
}

// ========== GLOBAL EXPORTS ==========
window.ntCalculate = ntCalculate;
window.ntSelectOperation = ntSelectOperation;
window.ntQuickTool = ntQuickTool;
window.ntQuickInput = ntQuickInput;
window.ntGeneratePrime = ntGeneratePrime;
window.ntGeneratePrimes = ntGeneratePrimes;
window.ntVisualizeFactorization = ntVisualizeFactorization;
window.ntShowPrimeDistribution = ntShowPrimeDistribution;
window.ntClearAll = ntClearAll;
window.ntClearResults = ntClearResults;
window.ntCopyResults = ntCopyResults;
window.ntSaveSession = ntSaveSession;
window.ntToggleAdvanced = ntToggleAdvanced;
window.ntToggleInsights = ntToggleInsights;
window.ntShareResults = ntShareResults;
window.ntExportResults = ntExportResults;
window.ntExportCSV = ntExportCSV;
window.ntExportLaTeX = ntExportLaTeX;
window.ntPrintReport = ntPrintReport;
window.ntGenerateSequence = ntGenerateSequence;
window.ntConvertBase = ntConvertBase;
window.ntAnalyzeProperties = function() {
  const nInput = document.getElementById('nt-number').value.trim();
  if (!nInput) {
    showNotification('Please enter a number first', 'warning');
    return;
  }
  
  const n = parseBigInt(nInput);
  if (n === null) {
    showNotification('Invalid number', 'error');
    return;
  }
  
  ntSelectOperation('properties');
  ntCalculate();
};

window.ntQuickProperties = function() {
  document.getElementById('nt-number').value = '28';
  ntSelectOperation('properties');
  ntCalculate();
};

window.ntLoadExample = function() {
  document.getElementById('nt-number').value = '1729';
  document.getElementById('nt-second').value = '4104';
  ntSelectOperation('gcd-lcm');
  showNotification('Loaded Ramanujan\'s taxicab numbers example', 'info');
};

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  .nt-operation-btn {
    padding: 16px 8px;
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }
  
  .nt-operation-btn:hover {
    background: rgba(45,212,255,0.1);
    transform: translateY(-2px);
  }
  
  .nt-operation-btn.active {
    background: rgba(45,212,255,0.1);
    border-color: var(--accent);
  }
  
  #nt-output::-webkit-scrollbar {
    width: 6px;
  }
  
  #nt-output::-webkit-scrollbar-track {
    background: var(--glass);
    border-radius: 3px;
  }
  
  #nt-output::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
  }
  
  @media (max-width: 768px) {
    .dashboard .card {
      grid-template-columns: 1fr;
    }
    
    .row {
      grid-template-columns: 1fr !important;
    }
  }
`;
document.head.appendChild(style);

console.log('Advanced Number Theory Toolkit loaded successfully!');
</script>
