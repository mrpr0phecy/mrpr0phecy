<!-- cards/geography-helper.html -->

<h2 id="geography-helper-title">Geography Helper</h2>

<form aria-describedby="geography-desc">
  <p id="geography-desc" class="small">Add countries, capitals, and notes to build your geography study list.</p>
  
  <div class="row">
    <div class="field">
      <label for="geography-country">Country</label>
      <input id="geography-country" type="text" placeholder="e.g. France" 
             style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
    <div class="field">
      <label for="geography-capital">Capital</label>
      <input id="geography-capital" type="text" placeholder="e.g. Paris" 
             style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
    <div class="field" style="flex:2;">
      <label for="geography-notes">Notes</label>
      <input id="geography-notes" type="text" placeholder="e.g. Known for the Eiffel Tower" 
             style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="geoAdd(this)" 
            style="flex:1;padding:10px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:500;">
      Add Entry
    </button>
    <button type="button" onclick="geoReset(this)"
            style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">Geography List</h3>
  <div id="geography-list" class="small" 
       style="max-height:300px;overflow-y:auto;padding-right:8px;">
    <!-- Entries will be added here -->
  </div>
</div>

<div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;">
  <button onclick="geoExport()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Export CSV</button>
  <button onclick="geoClearAll()" style="padding:6px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">Clear All</button>
  <button onclick="geoQuiz()" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">Start Quiz</button>
</div>

<script>
/* geography-helper.html
   - Geography study list builder
   - Scoped with geo- prefix
*/

let geographyItems = [];
const STORAGE_KEY = 'geography-helper-data';

// Load saved data
function geoLoad() {
  const card = document.currentScript?.closest('.card') || document;
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      geographyItems = JSON.parse(saved);
      geoRender();
    }
  } catch (e) {
    console.error('Failed to load geography data:', e);
  }
}

// Save data
function geoSave() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(geographyItems));
  } catch (e) {
    console.error('Failed to save geography data:', e);
  }
}

function geoAdd(btn) {
  const card = btn.closest('.card') || document;
  const country = card.querySelector('#geography-country').value.trim();
  const capital = card.querySelector('#geography-capital').value.trim();
  const notes = card.querySelector('#geography-notes').value.trim();

  if (!country) {
    alert("Please enter a country name");
    return;
  }

  geographyItems.push({ 
    id: Date.now(), 
    country, 
    capital, 
    notes,
    date: new Date().toLocaleDateString()
  });
  
  geoRender();
  geoSave();
  
  // Reset form
  card.querySelector('#geography-country').value = '';
  card.querySelector('#geography-capital').value = '';
  card.querySelector('#geography-notes').value = '';
  card.querySelector('#geography-country').focus();
}

function geoRender() {
  const card = document.currentScript?.closest('.card') || document;
  const list = card.querySelector('#geography-list');
  
  if (geographyItems.length === 0) {
    list.innerHTML = '<div style="padding:20px;text-align:center;color:rgba(230,250,255,0.5);font-style:italic;">No geography entries yet. Add your first country above!</div>';
    return;
  }
  
  let html = '';
  geographyItems.forEach((g, index) => {
    html += `
      <div class="geo-entry" data-id="${g.id}" 
           style="background:rgba(255,255,255,0.03);border-left:3px solid rgba(45,212,255,0.5);margin-bottom:8px;padding:10px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-weight:600;color:var(--accent);">${g.country}</div>
          ${g.capital ? `<div style="color:rgba(230,250,255,0.8);font-size:13px;">Capital: ${g.capital}</div>` : ''}
          ${g.notes ? `<div style="color:rgba(230,250,255,0.6);font-size:12px;margin-top:4px;">${g.notes}</div>` : ''}
          <div style="color:rgba(230,250,255,0.4);font-size:11px;margin-top:4px;">Added: ${g.date}</div>
        </div>
        <div>
          <button onclick="geoEdit('${g.id}')" style="background:transparent;border:none;color:var(--accent);cursor:pointer;padding:4px 8px;border-radius:4px;">‚úèÔ∏è</button>
          <button onclick="geoDelete('${g.id}')" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;padding:4px 8px;border-radius:4px;">üóëÔ∏è</button>
        </div>
      </div>
    `;
  });
  
  // Add stats
  const countryCount = geographyItems.length;
  const capitalCount = geographyItems.filter(g => g.capital.trim()).length;
  const noteCount = geographyItems.filter(g => g.notes.trim()).length;
  
  html += `
    <div style="margin-top:12px;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border:1px solid rgba(45,212,255,0.2);">
      <div style="display:flex;justify-content:space-between;font-size:12px;">
        <span style="color:var(--accent);">Countries: ${countryCount}</span>
        <span style="color:rgba(57,255,20,0.8);">Capitals: ${capitalCount}</span>
        <span style="color:rgba(230,250,255,0.8);">Notes: ${noteCount}</span>
      </div>
    </div>
  `;
  
  list.innerHTML = html;
}

function geoEdit(id) {
  const card = document.currentScript?.closest('.card') || document;
  const item = geographyItems.find(g => g.id === id);
  if (!item) return;
  
  card.querySelector('#geography-country').value = item.country;
  card.querySelector('#geography-capital').value = item.capital;
  card.querySelector('#geography-notes').value = item.notes;
  
  // Change add button to update
  const addBtn = card.querySelector('button[onclick="geoAdd(this)"]');
  addBtn.textContent = 'Update Entry';
  addBtn.setAttribute('onclick', `geoUpdate('${id}')`);
  
  card.querySelector('#geography-country').focus();
}

function geoUpdate(id) {
  const card = document.currentScript?.closest('.card') || document;
  const country = card.querySelector('#geography-country').value.trim();
  const capital = card.querySelector('#geography-capital').value.trim();
  const notes = card.querySelector('#geography-notes').value.trim();

  if (!country) {
    alert("Please enter a country name");
    return;
  }

  const index = geographyItems.findIndex(g => g.id === id);
  if (index !== -1) {
    geographyItems[index] = {
      ...geographyItems[index],
      country,
      capital,
      notes
    };
  }
  
  geoRender();
  geoSave();
  geoReset();
}

function geoDelete(id) {
  if (!confirm('Delete this entry?')) return;
  
  geographyItems = geographyItems.filter(g => g.id !== id);
  geoRender();
  geoSave();
}

function geoReset(btn) {
  const card = btn ? btn.closest('.card') || document : document;
  
  // Reset form
  card.querySelector('#geography-country').value = '';
  card.querySelector('#geography-capital').value = '';
  card.querySelector('#geography-notes').value = '';
  
  // Reset add button
  const addBtn = card.querySelector('button[onclick^="geoAdd"], button[onclick^="geoUpdate"]');
  if (addBtn) {
    addBtn.textContent = 'Add Entry';
    addBtn.setAttribute('onclick', 'geoAdd(this)');
  }
  
  card.querySelector('#geography-country').focus();
}

function geoClearAll() {
  if (geographyItems.length === 0) {
    alert("The list is already empty.");
    return;
  }
  
  if (confirm("Are you sure you want to delete ALL entries? This cannot be undone.")) {
    geographyItems = [];
    geoRender();
    geoSave();
  }
}

function geoExport() {
  if (geographyItems.length === 0) {
    alert("No entries to export.");
    return;
  }
  
  let csv = "Country,Capital,Notes,Date Added\n";
  geographyItems.forEach(g => {
    csv += `"${g.country}","${g.capital}","${g.notes}","${g.date}"\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'geography-list.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function geoQuiz() {
  if (geographyItems.length === 0) {
    alert("Please add some countries first.");
    return;
  }
  
  const withCapitals = geographyItems.filter(g => g.capital.trim());
  if (withCapitals.length === 0) {
    alert("Please add capitals to at least one entry to start a quiz.");
    return;
  }
  
  const randomItem = withCapitals[Math.floor(Math.random() * withCapitals.length)];
  const userAnswer = prompt(`What is the capital of ${randomItem.country}?`);
  
  if (userAnswer === null) return;
  
  if (userAnswer.trim().toLowerCase() === randomItem.capital.toLowerCase()) {
    alert(`‚úÖ Correct! The capital of ${randomItem.country} is ${randomItem.capital}.`);
  } else {
    alert(`‚ùå Incorrect. The capital of ${randomItem.country} is ${randomItem.capital}.`);
  }
}

// Auto-load on startup
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(geoLoad, 100);
  });
} else {
  setTimeout(geoLoad, 100);
}
</script>

<style>
#geography-helper-title {
  color: var(--accent);
  margin-top: 0;
  border-bottom: 1px solid rgba(45,212,255,0.2);
  padding-bottom: 10px;
  margin-bottom: 16px;
}

.row {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.field {
  flex: 1;
  min-width: 150px;
}

.field label {
  display: block;
  margin-bottom: 6px;
  color: var(--accent);
  font-weight: 500;
  font-size: 14px;
}

#geography-list::-webkit-scrollbar {
  width: 6px;
}

#geography-list::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#geography-list::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}

.geo-entry:hover {
  background: rgba(45,212,255,0.05) !important;
  transform: translateX(2px);
  transition: all 0.2s;
}

@media (max-width: 768px) {
  .row {
    flex-direction: column;
    gap: 10px;
  }
  
  .field {
    min-width: 100%;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
  }
}
</style>
