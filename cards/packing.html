<h2 id="packing-title" style="margin-top:0;color:var(--accent);">ğŸ§³ Smart Packing List</h2>

<form aria-describedby="packing-desc">
  <p id="packing-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:20px;">
    Create intelligent packing lists with categories, trip types, weather considerations, and shareable checklists.
    <span style="color:var(--accent);font-weight:500;">Never forget an essential item!</span>
  </p>

  <!-- TRIP SETTINGS SECTION -->
  <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(45,212,255,0.2);">
    <h4 class="small" style="color:var(--accent);margin-bottom:16px;">âœˆï¸ Trip Settings</h4>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="packing-trip-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Trip Type</label>
        <select id="packing-trip-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="business">ğŸ’¼ Business Trip</option>
          <option value="vacation" selected>ğŸ–ï¸ Vacation/Holiday</option>
          <option value="beach">ğŸ–ï¸ Beach Holiday</option>
          <option value="camping">â›º Camping/Hiking</option>
          <option value="ski">â›·ï¸ Ski/Snow Trip</option>
          <option value="city">ğŸ™ï¸ City Break</option>
          <option value="roadtrip">ğŸš— Road Trip</option>
          <option value="weekend">ğŸŒ‡ Weekend Getaway</option>
          <option value="cruise">ğŸš¢ Cruise</option>
          <option value="backpacking">ğŸ’ Backpacking</option>
        </select>
      </div>
      
      <div class="field">
        <label for="packing-duration" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Trip Duration</label>
        <select id="packing-duration" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="weekend">2-3 days (Weekend)</option>
          <option value="week" selected>4-7 days (Week)</option>
          <option value="fortnight">8-14 days (Fortnight)</option>
          <option value="month">15-30 days (Month)</option>
          <option value="extended">30+ days (Extended)</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="packing-climate" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Climate</label>
        <select id="packing-climate" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="hot">ğŸ”¥ Hot/Tropical</option>
          <option value="warm" selected>â˜€ï¸ Warm/Mediterranean</option>
          <option value="temperate">ğŸŒ¤ï¸ Temperate</option>
          <option value="cool">ğŸ‚ Cool/Autumn</option>
          <option value="cold">â„ï¸ Cold/Winter</option>
          <option value="variable">ğŸŒ¦ï¸ Variable/Mixed</option>
        </select>
      </div>
      
      <div class="field">
        <label for="packing-travelers" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Travelers</label>
        <input id="packing-travelers" type="number" min="1" max="10" value="1" step="1"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
      </div>
    </div>
    
    <div style="margin-top:12px;">
      <button onclick="packingLoadPreset()" class="small-btn" style="font-size:12px;">ğŸ“‹ Load Smart Preset</button>
    </div>
  </div>

  <!-- ADD ITEM SECTION -->
  <div style="background:rgba(57,255,20,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(57,255,20,0.2);">
    <h4 class="small" style="color:#39ff14;margin-bottom:16px;">â• Add Custom Items</h4>
    
    <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="packing-item" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Item Name</label>
        <input id="packing-item" type="text" placeholder="e.g. Passport, Charger, Swimsuit..." 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="packing-category" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Category</label>
        <select id="packing-category" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="essentials">ğŸ« Essentials</option>
          <option value="clothing">ğŸ‘• Clothing</option>
          <option value="toiletries">ğŸ§´ Toiletries</option>
          <option value="electronics">ğŸ“± Electronics</option>
          <option value="documents">ğŸ“„ Documents</option>
          <option value="medications">ğŸ’Š Medications</option>
          <option value="misc">ğŸ’ Miscellaneous</option>
        </select>
      </div>
    </div>
    
    <div style="display:flex;gap:8px;margin-top:8px;">
      <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
        <input type="checkbox" id="packing-essential" style="width:16px;height:16px;cursor:pointer;" />
        <span style="color:var(--accent);font-size:13px;">Essential Item</span>
      </label>
      
      <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
        <input type="checkbox" id="packing-quantity" style="width:16px;height:16px;cursor:pointer;" />
        <span style="color:var(--accent);font-size:13px;">Add Quantity</span>
      </label>
    </div>
    
    <div id="packing-quantity-input" style="display:none;margin-top:12px;">
      <label for="packing-quantity-value" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Quantity</label>
      <input id="packing-quantity-value" type="number" min="1" max="20" value="1" step="1"
             style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
    </div>
  </div>

  <!-- QUICK ADD BUTTONS -->
  <div style="margin-bottom:20px;">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">âš¡ Quick Add Essentials:</div>
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;">
      <button onclick="packingQuickAdd('Passport', 'documents', true)" class="quick-btn">ğŸ« Passport</button>
      <button onclick="packingQuickAdd('Phone Charger', 'electronics', true)" class="quick-btn">ğŸ”Œ Charger</button>
      <button onclick="packingQuickAdd('Toothbrush', 'toiletries', true)" class="quick-btn">ğŸ¦· Toothbrush</button>
      <button onclick="packingQuickAdd('Medications', 'medications', true)" class="quick-btn">ğŸ’Š Meds</button>
      <button onclick="packingQuickAdd('Sunglasses', 'essentials', false)" class="quick-btn">ğŸ•¶ï¸ Sunglasses</button>
      <button onclick="packingQuickAdd('Travel Adapter', 'electronics', false)" class="quick-btn">ğŸ”Œ Adapter</button>
      <button onclick="packingQuickAdd('First Aid Kit', 'medications', false)" class="quick-btn">ğŸ©¹ First Aid</button>
      <button onclick="packingQuickAdd('Water Bottle', 'misc', false)" class="quick-btn">ğŸ’§ Water Bottle</button>
    </div>
  </div>

  <div class="actions" style="display:flex;gap:10px;">
    <button type="button" onclick="packingAddItem()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      â• Add Item to List
    </button>
    <button type="button" onclick="packingResetAll()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset All
    </button>
    <button type="button" onclick="packingSmartSuggest()"
            style="padding:12px 16px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:8px;color:#9d4edd;cursor:pointer;">
      ğŸ¤– Smart Suggest
    </button>
  </div>
</form>

<div id="packing-results" aria-live="polite" style="margin-top:20px;display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:var(--accent);margin:0;">ğŸ§³ Your Packing List</h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="packing-stats" class="small" style="color:rgba(230,250,255,0.7);"></div>
      <div style="display:flex;gap:6px;">
        <button onclick="packingCheckAll()" class="small-btn" style="font-size:11px;">âœ“ Check All</button>
        <button onclick="packingUncheckAll()" class="small-btn" style="font-size:11px;">âœ— Uncheck All</button>
      </div>
    </div>
  </div>

  <!-- CATEGORY FILTERS -->
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
    <button onclick="packingFilterCategory('all')" class="filter-btn active">All Items</button>
    <button onclick="packingFilterCategory('essentials')" class="filter-btn">ğŸ« Essentials</button>
    <button onclick="packingFilterCategory('clothing')" class="filter-btn">ğŸ‘• Clothing</button>
    <button onclick="packingFilterCategory('toiletries')" class="filter-btn">ğŸ§´ Toiletries</button>
    <button onclick="packingFilterCategory('electronics')" class="filter-btn">ğŸ“± Electronics</button>
    <button onclick="packingFilterCategory('documents')" class="filter-btn">ğŸ“„ Documents</button>
    <button onclick="packingFilterCategory('medications')" class="filter-btn">ğŸ’Š Medications</button>
    <button onclick="packingFilterCategory('misc')" class="filter-btn">ğŸ’ Miscellaneous</button>
  </div>

  <!-- PACKING LIST DISPLAY -->
  <div id="packing-list-container" style="min-height:200px;">
    <!-- List items will be rendered here -->
  </div>

  <!-- PROGRESS AND SUMMARY -->
  <div style="margin-top:20px;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
      <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;border:1px solid rgba(45,212,255,0.2);">
        <div class="small" style="color:var(--accent);margin-bottom:8px;">ğŸ“Š Packing Progress</div>
        <div id="packing-progress-bar" style="height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden;margin-bottom:8px;">
          <div id="packing-progress-fill" style="height:100%;background:linear-gradient(90deg, #2dd4ff, #39ff14);width:0%;transition:width 0.3s;"></div>
        </div>
        <div id="packing-progress-text" style="text-align:center;font-size:12px;color:rgba(230,250,255,0.7);">0% complete</div>
      </div>
      
      <div style="background:rgba(57,255,20,0.05);border-radius:10px;padding:16px;border:1px solid rgba(57,255,20,0.2);">
        <div class="small" style="color:#39ff14;margin-bottom:8px;">ğŸ“‹ List Summary</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
          <div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Total Items</div>
            <div id="packing-total-items" style="font-weight:600;font-size:18px;">0</div>
          </div>
          <div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Packed</div>
            <div id="packing-packed-items" style="font-weight:600;font-size:18px;color:#39ff14;">0</div>
          </div>
          <div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Essentials</div>
            <div id="packing-essential-items" style="font-weight:600;font-size:18px;color:#ff2d55;">0</div>
          </div>
          <div>
            <div style="font-size:12px;color:rgba(230,250,255,0.7);">Categories</div>
            <div id="packing-categories-count" style="font-weight:600;font-size:18px;">0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ACTIONS AND EXPORT -->
    <div style="background:rgba(20,20,20,0.5);border-radius:10px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px;">
        <button onclick="packingCopyList()" 
                style="padding:10px;background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.2);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;">
          ğŸ“‹ Copy List
        </button>
        <button onclick="packingPrintList()" 
                style="padding:10px;background:rgba(57,255,20,0.05);border:1px solid rgba(57,255,20,0.2);border-radius:8px;color:#39ff14;cursor:pointer;font-size:12px;">
          ğŸ–¨ï¸ Print List
        </button>
        <button onclick="packingShareList()" 
                style="padding:10px;background:rgba(255,165,0,0.05);border:1px solid rgba(255,165,0,0.2);border-radius:8px;color:#ffa500;cursor:pointer;font-size:12px;">
          ğŸ“± Share List
        </button>
        <button onclick="packingSaveList()" 
                style="padding:10px;background:rgba(157,78,221,0.05);border:1px solid rgba(157,78,221,0.2);border-radius:8px;color:#9d4edd;cursor:pointer;font-size:12px;">
          ğŸ’¾ Save List
        </button>
        <button onclick="packingLoadSaved()" 
                style="padding:10px;background:rgba(255,77,77,0.05);border:1px solid rgba(255,77,77,0.2);border-radius:8px;color:#ff4d4d;cursor:pointer;font-size:12px;">
          ğŸ“‚ Load Saved
        </button>
        <button onclick="packingGenerateChecklist()" 
                style="padding:10px;background:rgba(255,204,0,0.05);border:1px solid rgba(255,204,0,0.2);border-radius:8px;color:#ffcc00;cursor:pointer;font-size:12px;">
          ğŸ“ Checklist PDF
        </button>
      </div>

      <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center;">
        <div id="packing-hint" class="small" style="color:#39ff14;"></div>
        <button onclick="packingExportCSV()" 
                style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
          ğŸ“Š Export CSV
        </button>
      </div>
    </div>
  </div>
</div>

<!-- SMART SUGGESTIONS PANEL -->
<div id="packing-suggestions" style="margin-top:20px;display:none;background:rgba(20,20,20,0.5);border-radius:10px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h4 class="small" style="color:var(--accent);margin:0;">ğŸ¤– Smart Suggestions</h4>
    <button onclick="document.getElementById('packing-suggestions').style.display='none'" 
            style="background:transparent;border:none;color:rgba(230,250,255,0.6);cursor:pointer;">âœ•</button>
  </div>
  <div id="packing-suggestions-content"></div>
</div>

<script>
/* packing-list.html
   - Smart Packing List with categories, trip types, and intelligent suggestions
   - Scoped with packing- prefix
*/

// Packing list data structure
let packingItems = [];
let currentFilter = 'all';

// Category emojis and colors
const packingCategories = {
  'essentials': { name: 'Essentials', emoji: 'ğŸ«', color: '#ff2d55' },
  'clothing': { name: 'Clothing', emoji: 'ğŸ‘•', color: '#2dd4ff' },
  'toiletries': { name: 'Toiletries', emoji: 'ğŸ§´', color: '#39ff14' },
  'electronics': { name: 'Electronics', emoji: 'ğŸ“±', color: '#ffa500' },
  'documents': { name: 'Documents', emoji: 'ğŸ“„', color: '#9d4edd' },
  'medications': { name: 'Medications', emoji: 'ğŸ’Š', color: '#ffcc00' },
  'misc': { name: 'Miscellaneous', emoji: 'ğŸ’', color: '#ff4d4d' }
};

// Trip type presets
const packingPresets = {
  'business': {
    name: 'Business Trip',
    suggestions: [
      { name: 'Business Attire', category: 'clothing', essential: true },
      { name: 'Laptop', category: 'electronics', essential: true },
      { name: 'Business Cards', category: 'documents', essential: false },
      { name: 'Portfolio', category: 'documents', essential: false },
      { name: 'Formal Shoes', category: 'clothing', essential: true },
      { name: 'Travel Iron', category: 'misc', essential: false }
    ]
  },
  'vacation': {
    name: 'Vacation',
    suggestions: [
      { name: 'Swimsuit', category: 'clothing', essential: true },
      { name: 'Sunscreen', category: 'toiletries', essential: true },
      { name: 'Camera', category: 'electronics', essential: false },
      { name: 'Beach Towel', category: 'misc', essential: false },
      { name: 'Hat', category: 'clothing', essential: false },
      { name: 'Sunglasses', category: 'essentials', essential: true }
    ]
  },
  'beach': {
    name: 'Beach Holiday',
    suggestions: [
      { name: 'Swimsuit', category: 'clothing', essential: true },
      { name: 'Beach Towel', category: 'misc', essential: true },
      { name: 'Sunscreen SPF 30+', category: 'toiletries', essential: true },
      { name: 'Beach Bag', category: 'misc', essential: false },
      { name: 'Flip Flops', category: 'clothing', essential: true },
      { name: 'Waterproof Phone Case', category: 'electronics', essential: false },
      { name: 'Beach Mat', category: 'misc', essential: false }
    ]
  },
  'camping': {
    name: 'Camping/Hiking',
    suggestions: [
      { name: 'Tent', category: 'misc', essential: true },
      { name: 'Sleeping Bag', category: 'misc', essential: true },
      { name: 'Flashlight', category: 'electronics', essential: true },
      { name: 'First Aid Kit', category: 'medications', essential: true },
      { name: 'Hiking Boots', category: 'clothing', essential: true },
      { name: 'Multi-tool', category: 'misc', essential: false },
      { name: 'Water Filter', category: 'misc', essential: false }
    ]
  },
  'ski': {
    name: 'Ski/Snow Trip',
    suggestions: [
      { name: 'Ski Jacket', category: 'clothing', essential: true },
      { name: 'Thermal Underwear', category: 'clothing', essential: true },
      { name: 'Ski Goggles', category: 'essentials', essential: true },
      { name: 'Gloves', category: 'clothing', essential: true },
      { name: 'Lip Balm', category: 'toiletries', essential: true },
      { name: 'Hand Warmers', category: 'misc', essential: false }
    ]
  },
  'city': {
    name: 'City Break',
    suggestions: [
      { name: 'Comfortable Shoes', category: 'clothing', essential: true },
      { name: 'City Map/Guide', category: 'documents', essential: false },
      { name: 'Power Bank', category: 'electronics', essential: true },
      { name: 'Day Bag', category: 'misc', essential: false },
      { name: 'Museum Passes', category: 'documents', essential: false }
    ]
  }
};

// Initialize the packing list
function packingInit() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Setup quantity toggle
  const quantityCheckbox = card.querySelector('#packing-quantity');
  const quantityInput = card.querySelector('#packing-quantity-input');
  
  quantityCheckbox.addEventListener('change', function() {
    quantityInput.style.display = this.checked ? 'block' : 'none';
  });
  
  // Load saved list if exists
  packingLoadSaved();
  
  // Set up enter key to add items
  const itemInput = card.querySelector('#packing-item');
  itemInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      packingAddItem();
    }
  });
  
  console.log('Smart Packing List initialized');
}

// Add item to packing list
function packingAddItem() {
  const card = document.currentScript?.closest('.card') || document;
  const itemName = card.querySelector('#packing-item').value.trim();
  const category = card.querySelector('#packing-category').value;
  const isEssential = card.querySelector('#packing-essential').checked;
  const addQuantity = card.querySelector('#packing-quantity').checked;
  
  if (!itemName) {
    packingShowMessage('Please enter an item name', '#ff2d55');
    return;
  }
  
  let quantity = 1;
  if (addQuantity) {
    quantity = parseInt(card.querySelector('#packing-quantity-value').value) || 1;
  }
  
  // Create item object
  const newItem = {
    id: Date.now() + Math.random(),
    name: itemName,
    category: category,
    essential: isEssential,
    packed: false,
    quantity: quantity,
    added: new Date().toISOString()
  };
  
  packingItems.push(newItem);
  
  // Clear form
  card.querySelector('#packing-item').value = '';
  card.querySelector('#packing-essential').checked = false;
  card.querySelector('#packing-quantity').checked = false;
  card.querySelector('#packing-quantity-input').style.display = 'none';
  card.querySelector('#packing-quantity-value').value = '1';
  
  // Render list
  packingRenderList();
  
  // Show results section
  const resultsDiv = card.querySelector('#packing-results');
  resultsDiv.style.display = 'block';
  
  packingShowMessage(`Added "${itemName}" to ${packingCategories[category].name}`, '#39ff14');
}

// Quick add function
function packingQuickAdd(itemName, category, isEssential) {
  const card = document.currentScript?.closest('.card') || document;
  
  const newItem = {
    id: Date.now() + Math.random(),
    name: itemName,
    category: category,
    essential: isEssential,
    packed: false,
    quantity: 1,
    added: new Date().toISOString()
  };
  
  packingItems.push(newItem);
  packingRenderList();
  
  // Show results section
  const resultsDiv = card.querySelector('#packing-results');
  resultsDiv.style.display = 'block';
  
  packingShowMessage(`Added "${itemName}"`, '#39ff14');
}

// Load preset based on trip type
function packingLoadPreset() {
  const card = document.currentScript?.closest('.card') || document;
  const tripType = card.querySelector('#packing-trip-type').value;
  const duration = card.querySelector('#packing-duration').value;
  const climate = card.querySelector('#packing-climate').value;
  
  if (!packingPresets[tripType]) {
    packingShowMessage('No preset available for this trip type', '#ffa500');
    return;
  }
  
  const preset = packingPresets[tripType];
  
  // Clear existing items
  packingItems = [];
  
  // Add preset items
  preset.suggestions.forEach(item => {
    packingItems.push({
      id: Date.now() + Math.random(),
      name: item.name,
      category: item.category,
      essential: item.essential,
      packed: false,
      quantity: 1,
      added: new Date().toISOString()
    });
  });
  
  // Add climate-specific items
  const climateItems = packingGetClimateItems(climate);
  climateItems.forEach(item => {
    packingItems.push({
      id: Date.now() + Math.random(),
      name: item.name,
      category: item.category,
      essential: item.essential,
      packed: false,
      quantity: 1,
      added: new Date().toISOString()
    });
  });
  
  // Add duration-specific items
  const durationItems = packingGetDurationItems(duration);
  durationItems.forEach(item => {
    packingItems.push({
      id: Date.now() + Math.random(),
      name: item.name,
      category: item.category,
      essential: item.essential,
      packed: false,
      quantity: item.quantity || 1,
      added: new Date().toISOString()
    });
  });
  
  // Render list
  packingRenderList();
  
  // Show results section
  const resultsDiv = card.querySelector('#packing-results');
  resultsDiv.style.display = 'block';
  
  packingShowMessage(`Loaded ${preset.name} preset with ${packingItems.length} items`, '#2dd4ff');
}

// Get climate-specific items
function packingGetClimateItems(climate) {
  const items = {
    'hot': [
      { name: 'Sunscreen SPF 50+', category: 'toiletries', essential: true },
      { name: 'Hat/Cap', category: 'clothing', essential: true },
      { name: 'Light Clothing', category: 'clothing', essential: true },
      { name: 'Reusable Water Bottle', category: 'misc', essential: true },
      { name: 'Aloe Vera Gel', category: 'medications', essential: false }
    ],
    'cold': [
      { name: 'Warm Jacket', category: 'clothing', essential: true },
      { name: 'Thermals', category: 'clothing', essential: true },
      { name: 'Beanie/Gloves', category: 'clothing', essential: true },
      { name: 'Lip Balm', category: 'toiletries', essential: true },
      { name: 'Hand Warmers', category: 'misc', essential: false }
    ],
    'warm': [
      { name: 'Light Jacket', category: 'clothing', essential: true },
      { name: 'Sunglasses', category: 'essentials', essential: true },
      { name: 'Light Layers', category: 'clothing', essential: true }
    ],
    'variable': [
      { name: 'Layers', category: 'clothing', essential: true },
      { name: 'Rain Jacket', category: 'clothing', essential: true },
      { name: 'Umbrella', category: 'misc', essential: false }
    ]
  };
  
  return items[climate] || [];
}

// Get duration-specific items
function packingGetDurationItems(duration) {
  const multipliers = {
    'weekend': 1,
    'week': 3,
    'fortnight': 5,
    'month': 10,
    'extended': 15
  };
  
  const multiplier = multipliers[duration] || 1;
  
  return [
    { name: 'Underwear', category: 'clothing', essential: true, quantity: Math.min(7, multiplier) },
    { name: 'Socks', category: 'clothing', essential: true, quantity: Math.min(7, multiplier) },
    { name: 'T-Shirts', category: 'clothing', essential: true, quantity: Math.min(5, multiplier) },
    { name: 'Pants/Shorts', category: 'clothing', essential: true, quantity: Math.min(3, multiplier - 1) }
  ];
}

// Smart suggestions based on current list
function packingSmartSuggest() {
  const card = document.currentScript?.closest('.card') || document;
  const suggestionsDiv = card.querySelector('#packing-suggestions');
  const contentDiv = card.querySelector('#packing-suggestions-content');
  
  // Analyze current list
  const categoriesPresent = new Set(packingItems.map(item => item.category));
  const essentialCategories = ['documents', 'medications', 'electronics'];
  
  let suggestions = [];
  
  // Check for missing essential categories
  essentialCategories.forEach(category => {
    if (!categoriesPresent.has(category)) {
      const categoryItems = {
        'documents': ['Passport/ID', 'Travel Insurance', 'Boarding Passes'],
        'medications': ['Prescription Meds', 'Pain Relievers', 'Band-Aids'],
        'electronics': ['Phone Charger', 'Power Bank', 'Headphones']
      };
      
      if (categoryItems[category]) {
        suggestions.push({
          category: packingCategories[category].name,
          items: categoryItems[category].slice(0, 2)
        });
      }
    }
  });
  
  // Generate suggestions HTML
  if (suggestions.length === 0) {
    suggestions = [{
      category: 'General',
      items: ['Travel Pillow', 'Ear Plugs', 'Travel Lock', 'Snacks']
    }];
  }
  
  let html = `<div style="display:grid;gap:12px;">`;
  
  suggestions.forEach(suggestion => {
    html += `<div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;">`;
    html += `<div style="color:var(--accent);font-weight:500;margin-bottom:8px;">${suggestion.category}</div>`;
    html += `<div style="display:flex;flex-wrap:wrap;gap:6px;">`;
    
    suggestion.items.forEach(item => {
      html += `<button onclick="packingQuickAdd('${item}', '${Object.keys(packingCategories).find(key => packingCategories[key].name === suggestion.category) || 'misc'}', false)" 
              style="padding:6px 10px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
              + ${item}</button>`;
    });
    
    html += `</div>`;
    html += `</div>`;
  });
  
  html += `</div>`;
  contentDiv.innerHTML = html;
  suggestionsDiv.style.display = 'block';
  suggestionsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Render the packing list
function packingRenderList() {
  const card = document.currentScript?.closest('.card') || document;
  const container = card.querySelector('#packing-list-container');
  
  if (packingItems.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:40px 20px;color:rgba(230,250,255,0.7);">
        <div style="font-size:48px;margin-bottom:12px;">ğŸ§³</div>
        <div>Your packing list is empty</div>
        <div style="font-size:13px;margin-top:8px;color:rgba(230,250,255,0.5);">
          Add items or load a preset to get started
        </div>
      </div>
    `;
    
    // Hide stats if no items
    card.querySelector('#packing-results').style.display = 'none';
    return;
  }
  
  // Filter items based on current filter
  const filteredItems = currentFilter === 'all' 
    ? packingItems 
    : packingItems.filter(item => item.category === currentFilter);
  
  // Group by category
  const itemsByCategory = {};
  filteredItems.forEach(item => {
    if (!itemsByCategory[item.category]) {
      itemsByCategory[item.category] = [];
    }
    itemsByCategory[item.category].push(item);
  });
  
  // Render HTML
  let html = '';
  
  Object.keys(itemsByCategory).forEach(category => {
    const categoryInfo = packingCategories[category];
    const items = itemsByCategory[category];
    
    html += `<div style="margin-bottom:20px;">`;
    html += `<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.1);">`;
    html += `<div style="font-size:20px;">${categoryInfo.emoji}</div>`;
    html += `<div style="color:${categoryInfo.color};font-weight:500;">${categoryInfo.name}</div>`;
    html += `<div style="margin-left:auto;font-size:12px;color:rgba(230,250,255,0.6);">${items.length} item${items.length !== 1 ? 's' : ''}</div>`;
    html += `</div>`;
    
    html += `<div style="display:grid;gap:8px;">`;
    
    items.forEach(item => {
      const essentialBadge = item.essential ? `<span style="color:#ff2d55;font-size:11px;margin-left:6px;">âš ï¸</span>` : '';
      const quantityBadge = item.quantity > 1 ? `<span style="background:rgba(45,212,255,0.2);color:var(--accent);font-size:11px;padding:2px 6px;border-radius:10px;margin-left:6px;">x${item.quantity}</span>` : '';
      
      html += `<div style="display:flex;align-items:center;padding:10px;background:${item.packed ? 'rgba(57,255,20,0.05)' : 'rgba(255,255,255,0.03)'};border-radius:8px;border-left:3px solid ${item.packed ? '#39ff14' : categoryInfo.color};transition:all 0.2s;">`;
      html += `<div style="flex:1;display:flex;align-items:center;">`;
      html += `<input type="checkbox" ${item.packed ? 'checked' : ''} onchange="packingToggleItem('${item.id}')" 
              style="width:18px;height:18px;margin-right:10px;cursor:pointer;" />`;
      html += `<div style="${item.packed ? 'text-decoration:line-through;color:rgba(230,250,255,0.5);' : 'color:rgba(230,250,255,0.9);'}">`;
      html += `${item.name}${essentialBadge}${quantityBadge}</div>`;
      html += `</div>`;
      html += `<button onclick="packingRemoveItem('${item.id}')" 
              style="background:transparent;border:none;color:rgba(255,77,77,0.7);cursor:pointer;padding:4px 8px;border-radius:4px;">âœ•</button>`;
      html += `</div>`;
    });
    
    html += `</div>`;
    html += `</div>`;
  });
  
  container.innerHTML = html;
  
  // Update statistics
  packingUpdateStats();
}

// Toggle item packed status
function packingToggleItem(itemId) {
  const item = packingItems.find(i => i.id === itemId);
  if (item) {
    item.packed = !item.packed;
    packingRenderList();
    
    // Show message for essential items
    if (item.essential && item.packed) {
      packingShowMessage(`âœ“ Packed essential: ${item.name}`, '#39ff14', 2000);
    }
  }
}

// Remove item from list
function packingRemoveItem(itemId) {
  packingItems = packingItems.filter(i => i.id !== itemId);
  packingRenderList();
  
  if (packingItems.length === 0) {
    const card = document.currentScript?.closest('.card') || document;
    card.querySelector('#packing-results').style.display = 'none';
  }
}

// Filter by category
function packingFilterCategory(category) {
  currentFilter = category;
  
  // Update active button
  const card = document.currentScript?.closest('.card') || document;
  const filterButtons = card.querySelectorAll('.filter-btn');
  filterButtons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.textContent.includes(category === 'all' ? 'All Items' : packingCategories[category].emoji)) {
      btn.classList.add('active');
    }
  });
  
  packingRenderList();
}

// Update statistics
function packingUpdateStats() {
  const card = document.currentScript?.closest('.card') || document;
  
  const totalItems = packingItems.reduce((sum, item) => sum + item.quantity, 0);
  const packedItems = packingItems.filter(item => item.packed).length;
  const essentialItems = packingItems.filter(item => item.essential).length;
  const categories = new Set(packingItems.map(item => item.category)).size;
  
  // Calculate progress percentage
  const progress = packingItems.length > 0 ? Math.round((packedItems / packingItems.length) * 100) : 0;
  
  // Update display
  card.querySelector('#packing-total-items').textContent = totalItems;
  card.querySelector('#packing-packed-items').textContent = packedItems;
  card.querySelector('#packing-essential-items').textContent = essentialItems;
  card.querySelector('#packing-categories-count').textContent = categories;
  
  // Update progress bar
  card.querySelector('#packing-progress-fill').style.width = `${progress}%`;
  card.querySelector('#packing-progress-text').textContent = `${progress}% complete`;
  
  // Update stats text
  const statsText = `${packedItems}/${packingItems.length} packed â€¢ ${essentialItems} essentials`;
  card.querySelector('#packing-stats').textContent = statsText;
  
  // Color code progress
  const progressFill = card.querySelector('#packing-progress-fill');
  if (progress === 100) {
    progressFill.style.background = 'linear-gradient(90deg, #39ff14, #2dd4ff)';
  } else if (progress >= 75) {
    progressFill.style.background = 'linear-gradient(90deg, #ffcc00, #39ff14)';
  } else {
    progressFill.style.background = 'linear-gradient(90deg, #ff2d55, #ffcc00)';
  }
}

// Check all items
function packingCheckAll() {
  packingItems.forEach(item => item.packed = true);
  packingRenderList();
  packingShowMessage('All items marked as packed', '#39ff14');
}

// Uncheck all items
function packingUncheckAll() {
  packingItems.forEach(item => item.packed = false);
  packingRenderList();
  packingShowMessage('All items unchecked', '#ffa500');
}

// Copy list to clipboard
function packingCopyList() {
  if (packingItems.length === 0) {
    packingShowMessage('No items to copy', '#ff2d55');
    return;
  }
  
  let text = 'ğŸ§³ PACKING LIST\n';
  text += 'Generated: ' + new Date().toLocaleString() + '\n\n';
  
  // Group by category
  const itemsByCategory = {};
  packingItems.forEach(item => {
    if (!itemsByCategory[item.category]) {
      itemsByCategory[item.category] = [];
    }
    itemsByCategory[item.category].push(item);
  });
  
  Object.keys(itemsByCategory).forEach(category => {
    const categoryInfo = packingCategories[category];
    text += `${categoryInfo.emoji} ${categoryInfo.name}:\n`;
    
    itemsByCategory[category].forEach(item => {
      const status = item.packed ? 'âœ…' : 'â¬œ';
      const essential = item.essential ? ' âš ï¸' : '';
      const quantity = item.quantity > 1 ? ` (x${item.quantity})` : '';
      text += `${status} ${item.name}${quantity}${essential}\n`;
    });
    
    text += '\n';
  });
  
  // Add summary
  const packedCount = packingItems.filter(item => item.packed).length;
  text += `ğŸ“Š SUMMARY: ${packedCount}/${packingItems.length} packed (${Math.round(packedCount/packingItems.length*100)}%)\n`;
  
  navigator.clipboard.writeText(text).then(() => {
    packingShowMessage('âœ… List copied to clipboard!', '#39ff14');
  }).catch(err => {
    console.error('Copy failed:', err);
    packingShowMessage('âŒ Copy failed', '#ff2d55');
  });
}

// Print list
function packingPrintList() {
  window.print();
}

// Share list
function packingShareList() {
  if (packingItems.length === 0) {
    packingShowMessage('No items to share', '#ff2d55');
    return;
  }
  
  const packedCount = packingItems.filter(item => item.packed).length;
  const progress = Math.round(packedCount / packingItems.length * 100);
  
  const shareText = `My packing list: ${packedCount}/${packingItems.length} packed (${progress}% complete). Created with The Most Useful Site!`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Packing List',
      text: shareText,
      url: window.location.href
    }).catch(console.error);
  } else {
    navigator.clipboard.writeText(shareText).then(() => {
      packingShowMessage('âœ… List link copied to share!', '#39ff14');
    });
  }
}

// Save list to localStorage
function packingSaveList() {
  try {
    const listData = {
      items: packingItems,
      timestamp: new Date().toISOString(),
      tripType: document.querySelector('#packing-trip-type').value,
      duration: document.querySelector('#packing-duration').value,
      climate: document.querySelector('#packing-climate').value
    };
    
    localStorage.setItem('packing_list_saved', JSON.stringify(listData));
    packingShowMessage('âœ… List saved locally', '#39ff14');
  } catch (e) {
    packingShowMessage('âŒ Save failed', '#ff2d55');
  }
}

// Load saved list
function packingLoadSaved() {
  try {
    const saved = localStorage.getItem('packing_list_saved');
    if (saved) {
      const listData = JSON.parse(saved);
      packingItems = listData.items || [];
      
      // Restore form values
      const card = document.currentScript?.closest('.card') || document;
      if (listData.tripType) card.querySelector('#packing-trip-type').value = listData.tripType;
      if (listData.duration) card.querySelector('#packing-duration').value = listData.duration;
      if (listData.climate) card.querySelector('#packing-climate').value = listData.climate;
      
      if (packingItems.length > 0) {
        packingRenderList();
        card.querySelector('#packing-results').style.display = 'block';
        packingShowMessage(`Loaded saved list with ${packingItems.length} items`, '#2dd4ff');
      }
    }
  } catch (e) {
    console.log('No saved list found');
  }
}

// Export to CSV
function packingExportCSV() {
  if (packingItems.length === 0) {
    packingShowMessage('No items to export', '#ff2d55');
    return;
  }
  
  let csv = 'Category,Item,Essential,Quantity,Packed\n';
  
  packingItems.forEach(item => {
    const category = packingCategories[item.category].name;
    const essential = item.essential ? 'Yes' : 'No';
    const packed = item.packed ? 'Yes' : 'No';
    csv += `"${category}","${item.name}","${essential}","${item.quantity}","${packed}"\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `packing-list-${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  packingShowMessage('âœ… CSV exported!', '#39ff14');
}

// Generate printable checklist
function packingGenerateChecklist() {
  if (packingItems.length === 0) {
    packingShowMessage('No items for checklist', '#ff2d55');
    return;
  }
  
  // Create printable HTML
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Packing Checklist</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .category { margin-bottom: 20px; }
        .category-title { font-weight: bold; color: #555; margin-bottom: 10px; }
        .item { margin-bottom: 5px; }
        .checkbox { display: inline-block; width: 20px; height: 20px; border: 1px solid #ccc; margin-right: 10px; }
        .essential { color: #d00; }
      </style>
    </head>
    <body>
      <h1>ğŸ§³ Packing Checklist</h1>
      <p>Generated: ${new Date().toLocaleString()}</p>
      <hr>
  `);
  
  // Group by category
  const itemsByCategory = {};
  packingItems.forEach(item => {
    if (!itemsByCategory[item.category]) {
      itemsByCategory[item.category] = [];
    }
    itemsByCategory[item.category].push(item);
  });
  
  Object.keys(itemsByCategory).forEach(category => {
    const categoryInfo = packingCategories[category];
    printWindow.document.write(`
      <div class="category">
        <div class="category-title">${categoryInfo.emoji} ${categoryInfo.name}</div>
    `);
    
    itemsByCategory[category].forEach(item => {
      const essential = item.essential ? ' <span class="essential">âš ï¸</span>' : '';
      const quantity = item.quantity > 1 ? ` (x${item.quantity})` : '';
      printWindow.document.write(`
        <div class="item">
          <span class="checkbox"></span>
          ${item.name}${quantity}${essential}
        </div>
      `);
    });
    
    printWindow.document.write(`</div>`);
  });
  
  printWindow.document.write(`
      <hr>
      <p>Total items: ${packingItems.length}</p>
    </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.print();
}

// Reset all items
function packingResetAll() {
  packingItems = [];
  
  const card = document.currentScript?.closest('.card') || document;
  card.querySelector('#packing-results').style.display = 'none';
  card.querySelector('form').reset();
  card.querySelector('#packing-quantity-input').style.display = 'none';
  
  packingShowMessage('List cleared', '#ffa500');
}

// Helper function to show messages
function packingShowMessage(message, color, duration = 3000) {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#packing-hint');
  hint.textContent = message;
  hint.style.color = color;
  setTimeout(() => {
    if (hint.textContent === message) hint.textContent = '';
  }, duration);
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', packingInit);
} else {
  packingInit();
}

// Add keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    packingAddItem();
  }
  if (e.key === 'Escape') {
    packingResetAll();
  }
});
</script>

<style>
#packing-title {
  color: var(--accent);
  margin-top: 0;
  font-size: 1.3rem;
  margin-bottom: 4px;
}

.small-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: inherit;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 12px;
  padding: 4px 8px;
}

.small-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
  transform: translateY(-1px);
}

.quick-btn {
  padding: 8px 12px;
  background: rgba(45,212,255,0.05);
  border: 1px solid rgba(45,212,255,0.2);
  border-radius: 6px;
  color: var(--accent);
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
}

.quick-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
  transform: translateY(-1px);
}

.filter-btn {
  padding: 6px 12px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: rgba(230,250,255,0.7);
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s;
}

.filter-btn.active {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
  color: var(--accent);
}

.filter-btn:hover:not(.active) {
  background: rgba(255,255,255,0.05);
  border-color: rgba(255,255,255,0.15);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .field {
    grid-column: 1 / -1 !important;
  }
  
  .actions {
    flex-direction: column;
    gap: 8px !important;
  }
  
  .actions button {
    width: 100%;
    margin: 0 !important;
  }
  
  .quick-btn {
    padding: 10px 14px;
    font-size: 14px;
  }
  
  .filter-btn {
    padding: 8px 10px;
    font-size: 11px;
  }
}

@media (max-width: 480px) {
  .packing-section > div {
    grid-template-columns: 1fr !important;
  }
  
  #packing-results > div > div {
    grid-template-columns: 1fr !important;
  }
  
  .actions-grid {
    grid-template-columns: 1fr 1fr !important;
  }
}

/* Print styles */
@media print {
  #packing-results {
    display: block !important;
  }
  
  button, .actions, .small-btn, .quick-btn, .filter-btn {
    display: none !important;
  }
  
  #packing-list-container > div {
    break-inside: avoid;
  }
}
</style>
