<h2 id="credit-card-payoff-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸ’³ Credit Card Payoff Calculator
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    Financial Tool
  </span>
</h2>

<form aria-describedby="credit-card-payoff-desc">
  <p id="credit-card-payoff-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Calculate how long it will take to pay off your credit card and save money with different strategies.
  </p>

  <!-- Main Inputs with Visual Indicators -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
    <div class="field" style="position:relative;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <label for="cc-balance" style="color:var(--accent);font-weight:500;">ğŸ¦ Current Balance</label>
        <span id="cc-balance-slider-val" style="font-size:0.9rem;color:#39ff14;">Â£3,000</span>
      </div>
      <input id="cc-balance" type="range" min="100" max="50000" step="100" value="3000" 
             style="width:100%;margin-bottom:8px;accent-color:var(--accent);" />
      <input id="cc-balance-input" type="number" min="100" max="100000" value="3000" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:1rem;" />
      <div class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
        <span>Â£100</span>
        <span>Â£50,000</span>
      </div>
    </div>

    <div class="field" style="position:relative;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <label for="cc-rate" style="color:var(--accent);font-weight:500;">ğŸ“ˆ Interest Rate</label>
        <span id="cc-rate-slider-val" style="font-size:0.9rem;color:#ffcc00;">18%</span>
      </div>
      <input id="cc-rate" type="range" min="0" max="40" step="0.5" value="18" 
             style="width:100%;margin-bottom:8px;accent-color:#ffcc00;" />
      <input id="cc-rate-input" type="number" min="0" max="50" step="0.1" value="18" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;font-size:1rem;" />
      <div class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
        <span>0%</span>
        <span>40%</span>
      </div>
    </div>

    <div class="field" style="position:relative;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <label for="cc-payment" style="color:var(--accent);font-weight:500;">ğŸ’° Monthly Payment</label>
        <span id="cc-payment-slider-val" style="font-size:0.9rem;color:#39ff14;">Â£150</span>
      </div>
      <input id="cc-payment" type="range" min="10" max="2000" step="10" value="150" 
             style="width:100%;margin-bottom:8px;accent-color:#39ff14;" />
      <input id="cc-payment-input" type="number" min="10" max="5000" step="10" value="150" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:1rem;" />
      <div class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
        <span>Â£10</span>
        <span>Â£2,000</span>
      </div>
    </div>
  </div>

  <!-- Strategy Selector -->
  <div style="margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <label style="color:var(--accent);font-weight:500;">ğŸ¯ Payoff Strategy</label>
      <span id="cc-strategy-indicator" style="font-size:0.85rem;color:#9d4edd;font-weight:500;">Standard Payoff</span>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:8px;">
      <button type="button" onclick="ccSetStrategy('standard')" 
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;font-weight:500;">
        ğŸ’³ Standard
      </button>
      <button type="button" onclick="ccSetStrategy('snowball')"
              style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        â„ï¸ Snowball
      </button>
      <button type="button" onclick="ccSetStrategy('avalanche')"
              style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        ğŸ”ï¸ Avalanche
      </button>
      <button type="button" onclick="ccSetStrategy('extra')"
              style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        âš¡ Extra Payment
      </button>
    </div>
  </div>

  <!-- Extra Payment Controls (Hidden by Default) -->
  <div id="cc-extra-payment-section" style="display:none;margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <span style="color:var(--accent);font-weight:500;">ğŸ’ Extra Payment Strategy</span>
      <button onclick="ccApplyExtraPayment()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;">
        Apply
      </button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:12px;">
      <div>
        <label for="cc-extra-amount" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9rem;">Extra Amount</label>
        <input id="cc-extra-amount" type="number" min="0" value="50" 
               style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
      <div>
        <label for="cc-extra-start" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9rem;">Start Month</label>
        <input id="cc-extra-start" type="number" min="1" value="1" 
               style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
      <div>
        <label for="cc-extra-months" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.8);font-size:0.9rem;">For Months</label>
        <input id="cc-extra-months" type="number" min="1" value="12" 
               style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;" />
      </div>
    </div>
  </div>

  <!-- Quick Payment Presets -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">ğŸš€ Quick Payment Suggestions:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="ccSetPaymentPreset('min')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">Minimum (2%)</button>
      <button type="button" onclick="ccSetPaymentPreset('recommended')" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">Recommended (5%)</button>
      <button type="button" onclick="ccSetPaymentPreset('aggressive')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">Aggressive (10%)</button>
      <button type="button" onclick="ccSetPaymentPreset('double')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">Double Payment</button>
      <button type="button" onclick="ccSetPaymentPreset('triple')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">Triple Payment</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="ccCalculate(this)" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ§® Calculate
    </button>
    <button type="button" onclick="ccOptimizePayment()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ’¡ Optimize
    </button>
    <button type="button" onclick="ccCompareStrategies()"
            style="padding:14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ“Š Compare
    </button>
    <button type="button" onclick="ccReset(this)"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Reset
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Primary Results Card -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:20px;border:1px solid rgba(45,212,255,0.1);margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">ğŸ“Š Payoff Summary</h3>
      <button onclick="ccCopyResults()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        ğŸ“‹ Copy
      </button>
    </div>
    
    <!-- Key Metrics -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">â±ï¸ Time to Payoff</div>
        <div id="cc-months" style="font-size:1.8rem;font-weight:700;color:#39ff14;">â€“</div>
        <div id="cc-years" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;"></div>
      </div>
      
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ’° Total Interest</div>
        <div id="cc-total-interest" style="font-size:1.8rem;font-weight:700;color:#ff2d55;">â€“</div>
        <div id="cc-interest-percent" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;"></div>
      </div>
      
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ¦ Total Payment</div>
        <div id="cc-total-payment" style="font-size:1.8rem;font-weight:700;color:#ffcc00;">â€“</div>
        <div id="cc-total-savings" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;"></div>
      </div>
      
      <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ’¸ Interest Saved vs Min</div>
        <div id="cc-interest-saved" style="font-size:1.4rem;font-weight:700;color:#9d4edd;">â€“</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">with current payment</div>
      </div>
    </div>
    
    <!-- Progress Visualization -->
    <div style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span style="color:var(--accent);font-weight:500;">ğŸ“ˆ Payoff Progress</span>
        <span id="cc-progress-text" style="font-size:0.9rem;color:rgba(230,250,255,0.7);">No data</span>
      </div>
      <div style="height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;margin-bottom:8px;">
        <div id="cc-progress-bar" style="height:100%;background:linear-gradient(90deg, #2dd4ff, #39ff14);width:0%;transition:width 1s ease;"></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:rgba(230,250,255,0.6);">
        <span>Month 0</span>
        <span id="cc-progress-end">Month 0</span>
      </div>
    </div>
    
    <!-- Detailed Breakdown -->
    <div id="cc-details" style="color:rgba(230,250,255,0.9);font-size:0.95rem;line-height:1.5;padding:12px;background:rgba(0,0,0,0.1);border-radius:6px;">
      Enter your credit card details to see payoff calculations.
    </div>
  </div>

  <!-- Strategy Comparison -->
  <div id="cc-comparison-section" style="display:none;background:rgba(0,0,0,0.1);border-radius:8px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:16px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">ğŸ“Š Strategy Comparison</h3>
    <div style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:0.9rem;">
        <thead>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
            <th style="text-align:left;padding:8px;color:var(--accent);">Strategy</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Months</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Total Interest</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Interest Saved</th>
          </tr>
        </thead>
        <tbody id="cc-comparison-body">
          <!-- Will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Financial Tips -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:20px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">ğŸ’¡ Financial Tips</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
      <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:6px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">ğŸ¯ Pay More Than Minimum</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Even Â£20 extra per month can save thousands in interest</div>
      </div>
      <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:6px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">âš¡ Consider Balance Transfer</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">0% APR cards can help pay down principal faster</div>
      </div>
      <div style="padding:12px;background:rgba(157,78,221,0.05);border-radius:6px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">âš ï¸ Avoid New Purchases</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Stop using the card while paying it off</div>
      </div>
    </div>
    
    <!-- Warning Message -->
    <div style="padding:12px;background:rgba(255,45,85,0.1);border-radius:6px;border-left:4px solid #ff2d55;">
      <div style="color:#ff2d55;font-weight:600;margin-bottom:4px;">âš ï¸ Important Disclaimer</div>
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">
        This calculator provides estimates only. For personalized financial advice, consult with a certified financial advisor. 
        Actual results may vary based on your specific credit card terms and conditions.
      </div>
    </div>
  </div>
</div>

<script>
/* credit-card-payoff.html - Enhanced version
   - Advanced credit card payoff calculator
   - Scoped with cc- prefix
*/

let currentStrategy = 'standard';
let extraPayment = { amount: 50, start: 1, months: 12 };

// Sync sliders with number inputs
function ccSyncInputs() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Balance sync
  const balanceSlider = card.querySelector('#cc-balance');
  const balanceInput = card.querySelector('#cc-balance-input');
  const balanceDisplay = card.querySelector('#cc-balance-slider-val');
  
  balanceSlider.addEventListener('input', function() {
    const value = parseInt(this.value);
    balanceInput.value = value;
    balanceDisplay.textContent = 'Â£' + value.toLocaleString();
  });
  
  balanceInput.addEventListener('input', function() {
    const value = Math.min(100000, Math.max(100, parseInt(this.value) || 100));
    balanceSlider.value = value;
    balanceDisplay.textContent = 'Â£' + value.toLocaleString();
  });
  
  // Rate sync
  const rateSlider = card.querySelector('#cc-rate');
  const rateInput = card.querySelector('#cc-rate-input');
  const rateDisplay = card.querySelector('#cc-rate-slider-val');
  
  rateSlider.addEventListener('input', function() {
    const value = parseFloat(this.value);
    rateInput.value = value;
    rateDisplay.textContent = value + '%';
  });
  
  rateInput.addEventListener('input', function() {
    const value = Math.min(50, Math.max(0, parseFloat(this.value) || 0));
    rateSlider.value = value;
    rateDisplay.textContent = value + '%';
  });
  
  // Payment sync
  const paymentSlider = card.querySelector('#cc-payment');
  const paymentInput = card.querySelector('#cc-payment-input');
  const paymentDisplay = card.querySelector('#cc-payment-slider-val');
  
  paymentSlider.addEventListener('input', function() {
    const value = parseInt(this.value);
    paymentInput.value = value;
    paymentDisplay.textContent = 'Â£' + value.toLocaleString();
  });
  
  paymentInput.addEventListener('input', function() {
    const value = Math.min(5000, Math.max(10, parseInt(this.value) || 10));
    paymentSlider.value = value;
    paymentDisplay.textContent = 'Â£' + value.toLocaleString();
  });
  
  // Initialize displays
  balanceDisplay.textContent = 'Â£' + balanceInput.value.toLocaleString();
  rateDisplay.textContent = rateInput.value + '%';
  paymentDisplay.textContent = 'Â£' + paymentInput.value.toLocaleString();
}

function ccSetStrategy(strategy) {
  const card = document.currentScript?.closest('.card') || document;
  currentStrategy = strategy;
  
  // Update strategy buttons
  card.querySelectorAll('[onclick*="ccSetStrategy"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  const activeBtn = card.querySelector(`[onclick="ccSetStrategy('${strategy}')"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(45,212,255,0.2)';
    activeBtn.style.border = '2px solid var(--accent)';
    activeBtn.style.color = 'var(--accent)';
  }
  
  // Update strategy indicator
  const strategyNames = {
    'standard': 'Standard Payoff',
    'snowball': 'Snowball Method', 
    'avalanche': 'Avalanche Method',
    'extra': 'Extra Payment'
  };
  card.querySelector('#cc-strategy-indicator').textContent = strategyNames[strategy] || 'Custom Strategy';
  
  // Show/hide extra payment section
  const extraSection = card.querySelector('#cc-extra-payment-section');
  if (strategy === 'extra') {
    extraSection.style.display = 'block';
  } else {
    extraSection.style.display = 'none';
  }
  
  // Auto-calculate if we have data
  if (card.querySelector('#cc-balance-input').value) {
    setTimeout(() => ccCalculate(), 100);
  }
}

function ccSetPaymentPreset(preset) {
  const card = document.currentScript?.closest('.card') || document;
  const balance = parseFloat(card.querySelector('#cc-balance-input').value) || 3000;
  
  let payment = 150; // default
  
  switch(preset) {
    case 'min':
      payment = Math.max(10, balance * 0.02); // 2% minimum
      break;
    case 'recommended':
      payment = Math.max(10, balance * 0.05); // 5% recommended
      break;
    case 'aggressive':
      payment = Math.max(10, balance * 0.10); // 10% aggressive
      break;
    case 'double':
      const current = parseFloat(card.querySelector('#cc-payment-input').value) || 150;
      payment = current * 2;
      break;
    case 'triple':
      const current2 = parseFloat(card.querySelector('#cc-payment-input').value) || 150;
      payment = current2 * 3;
      break;
  }
  
  payment = Math.round(payment / 10) * 10; // Round to nearest Â£10
  card.querySelector('#cc-payment-input').value = payment;
  card.querySelector('#cc-payment').value = payment;
  card.querySelector('#cc-payment-slider-val').textContent = 'Â£' + payment.toLocaleString();
  
  // Highlight preset button
  card.querySelectorAll('[onclick*="ccSetPaymentPreset"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = '#e6faff';
  });
  
  const presetBtn = card.querySelector(`[onclick="ccSetPaymentPreset('${preset}')"]`);
  if (presetBtn) {
    presetBtn.style.background = 'rgba(45,212,255,0.1)';
    presetBtn.style.border = '1px solid rgba(45,212,255,0.3)';
    presetBtn.style.color = 'var(--accent)';
  }
  
  // Auto-calculate
  setTimeout(() => ccCalculate(), 100);
}

function ccApplyExtraPayment() {
  const card = document.currentScript?.closest('.card') || document;
  
  extraPayment.amount = parseFloat(card.querySelector('#cc-extra-amount').value) || 50;
  extraPayment.start = parseInt(card.querySelector('#cc-extra-start').value) || 1;
  extraPayment.months = parseInt(card.querySelector('#cc-extra-months').value) || 12;
  
  // Visual feedback
  const btn = card.querySelector('[onclick="ccApplyExtraPayment()"]');
  btn.textContent = 'âœ… Applied';
  btn.style.background = 'rgba(57,255,20,0.1)';
  btn.style.borderColor = 'rgba(57,255,20,0.3)';
  btn.style.color = '#39ff14';
  
  setTimeout(() => {
    btn.textContent = 'Apply';
    btn.style.background = 'rgba(45,212,255,0.1)';
    btn.style.borderColor = 'rgba(45,212,255,0.3)';
    btn.style.color = 'var(--accent)';
  }, 1500);
  
  // Auto-calculate
  setTimeout(() => ccCalculate(), 200);
}

function ccCalculate(btn = null) {
  const card = document.currentScript?.closest('.card') || document;
  let balance = parseFloat(card.querySelector('#cc-balance-input').value) || 0;
  const rate = parseFloat(card.querySelector('#cc-rate-input').value) / 100 || 0;
  let payment = parseFloat(card.querySelector('#cc-payment-input').value) || 0;
  
  const monthlyRate = rate / 12;
  let months = 0;
  let totalInterest = 0;
  let totalPayment = 0;
  
  // Calculate minimum payment for comparison
  const minPayment = Math.max(10, balance * 0.02);
  let minMonths = 0;
  let minTotalInterest = 0;
  
  // Calculate with minimum payment for comparison
  let minBalance = balance;
  while (minBalance > 0 && minMonths < 600) {
    const interest = minBalance * monthlyRate;
    minTotalInterest += interest;
    minBalance = minBalance + interest - minPayment;
    minMonths++;
  }
  
  // Visual feedback
  if (btn) {
    btn.innerHTML = 'â³ Calculating...';
    btn.disabled = true;
  }
  
  setTimeout(() => {
    // Check if payment is sufficient
    if (payment <= balance * monthlyRate) {
      card.querySelector('#cc-months').textContent = "Payment too low";
      card.querySelector('#cc-years').textContent = "";
      card.querySelector('#cc-total-interest').textContent = "â€“";
      card.querySelector('#cc-total-payment').textContent = "â€“";
      card.querySelector('#cc-interest-percent').textContent = "";
      card.querySelector('#cc-total-savings').textContent = "";
      card.querySelector('#cc-interest-saved').textContent = "â€“";
      card.querySelector('#cc-progress-bar').style.width = "0%";
      card.querySelector('#cc-progress-text').textContent = "Payment insufficient to cover interest";
      card.querySelector('#cc-progress-end').textContent = "Infinite";
      card.querySelector('#cc-details').innerHTML = 
        "âš ï¸ Your monthly payment is less than the monthly interest. You need to increase your payment to at least Â£" + 
        (balance * monthlyRate).toFixed(2) + " to start paying down the principal.";
      
      if (btn) {
        btn.innerHTML = 'âš ï¸ Insufficient';
        setTimeout(() => {
          btn.innerHTML = 'ğŸ§® Calculate';
          btn.disabled = false;
        }, 1000);
      }
      return;
    }
    
    // Calculate with current payment and strategy
    let calcBalance = balance;
    const payments = [];
    
    while (calcBalance > 0 && months < 600) {
      const interest = calcBalance * monthlyRate;
      totalInterest += interest;
      
      let thisPayment = payment;
      
      // Apply strategy adjustments
      if (currentStrategy === 'extra') {
        // Apply extra payment for specified period
        if (months >= extraPayment.start - 1 && months < extraPayment.start - 1 + extraPayment.months) {
          thisPayment += extraPayment.amount;
        }
      }
      
      // Ensure we don't overpay
      thisPayment = Math.min(thisPayment, calcBalance + interest);
      
      calcBalance = calcBalance + interest - thisPayment;
      totalPayment += thisPayment;
      months++;
      
      // Record payment details for progress
      if (months % 6 === 0 || months === 1 || calcBalance <= 0) {
        payments.push({
          month: months,
          balance: Math.max(0, calcBalance),
          interestPaid: totalInterest,
          totalPaid: totalPayment
        });
      }
      
      if (calcBalance <= 0) break;
    }
    
    // Format results
    const years = months / 12;
    const yearsText = years >= 1 ? `(${years.toFixed(1)} years)` : "";
    
    const interestPercent = (totalInterest / balance * 100).toFixed(1);
    const interestSaved = minTotalInterest - totalInterest;
    
    // Update displays
    card.querySelector('#cc-months').textContent = months + " months";
    card.querySelector('#cc-years').textContent = yearsText;
    card.querySelector('#cc-total-interest').textContent = "Â£" + totalInterest.toFixed(2);
    card.querySelector('#cc-total-payment').textContent = "Â£" + (balance + totalInterest).toFixed(2);
    card.querySelector('#cc-interest-percent').textContent = interestPercent + "% of balance";
    card.querySelector('#cc-total-savings').textContent = "Â£" + balance.toLocaleString() + " principal + interest";
    card.querySelector('#cc-interest-saved').textContent = "Â£" + interestSaved.toFixed(2);
    
    // Update progress visualization
    const progressPercent = Math.min(100, months > 0 ? (payments[0]?.month / months * 100) : 0);
    card.querySelector('#cc-progress-bar').style.width = progressPercent + "%";
    card.querySelector('#cc-progress-text').textContent = 
      `Month ${payments[0]?.month || 0} of ${months} (${progressPercent.toFixed(0)}%)`;
    card.querySelector('#cc-progress-end').textContent = "Month " + months;
    
    // Generate detailed breakdown
    let details = `<strong>ğŸ“… Payoff Timeline:</strong><br>`;
    if (years >= 5) {
      details += `This will take ${years.toFixed(1)} years to pay off.<br>`;
    }
    
    details += `<br><strong>ğŸ’° Payment Breakdown:</strong><br>`;
    details += `â€¢ Monthly payment: <strong>Â£${payment.toFixed(2)}</strong><br>`;
    details += `â€¢ Total interest paid: <strong>Â£${totalInterest.toFixed(2)}</strong><br>`;
    details += `â€¢ Total amount paid: <strong>Â£${(balance + totalInterest).toFixed(2)}</strong><br><br>`;
    
    details += `<strong>ğŸ¯ Tips to Pay Off Faster:</strong><br>`;
    if (payment < balance * 0.05) {
      details += `â€¢ Increase payment to 5% of balance (Â£${(balance * 0.05).toFixed(2)})<br>`;
    }
    if (rate > 0.15) {
      details += `â€¢ Consider a balance transfer to lower rate<br>`;
    }
    if (months > 24) {
      details += `â€¢ Add Â£${(payment * 0.1).toFixed(0)} extra per month to cut payoff time<br>`;
    }
    
    card.querySelector('#cc-details').innerHTML = details;
    
    // Reset button if clicked
    if (btn) {
      btn.innerHTML = 'âœ… Calculated';
      setTimeout(() => {
        btn.innerHTML = 'ğŸ§® Calculate';
        btn.disabled = false;
      }, 1000);
    }
  }, 300);
}

function ccOptimizePayment() {
  const card = document.currentScript?.closest('.card') || document;
  const balance = parseFloat(card.querySelector('#cc-balance-input').value) || 3000;
  const rate = parseFloat(card.querySelector('#cc-rate-input').value) / 100 || 0;
  
  // Calculate optimized payment (pay off in 3 years)
  const monthlyRate = rate / 12;
  const months = 36; // 3 years
  const optimizedPayment = balance * monthlyRate * Math.pow(1 + monthlyRate, months) / 
                           (Math.pow(1 + monthlyRate, months) - 1);
  
  const roundedPayment = Math.ceil(optimizedPayment / 10) * 10; // Round up to nearest Â£10
  
  card.querySelector('#cc-payment-input').value = roundedPayment;
  card.querySelector('#cc-payment').value = roundedPayment;
  card.querySelector('#cc-payment-slider-val').textContent = 'Â£' + roundedPayment.toLocaleString();
  
  // Visual feedback
  const btn = card.querySelector('[onclick="ccOptimizePayment()"]');
  btn.innerHTML = 'âœ… Optimized';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ’¡ Optimize';
  }, 1500);
  
  // Auto-calculate
  setTimeout(() => ccCalculate(), 200);
}

function ccCompareStrategies() {
  const card = document.currentScript?.closest('.card') || document;
  const comparisonSection = card.querySelector('#cc-comparison-section');
  const comparisonBody = card.querySelector('#cc-comparison-body');
  
  if (comparisonSection.style.display === 'none') {
    // Show comparison and calculate
    comparisonSection.style.display = 'block';
    
    const balance = parseFloat(card.querySelector('#cc-balance-input').value) || 3000;
    const rate = parseFloat(card.querySelector('#cc-rate-input').value) / 100 || 0;
    const currentPayment = parseFloat(card.querySelector('#cc-payment-input').value) || 150;
    
    const strategies = [
      { name: 'Minimum Payment', payment: Math.max(10, balance * 0.02) },
      { name: 'Current Payment', payment: currentPayment },
      { name: '+Â£50 Extra', payment: currentPayment + 50 },
      { name: '+Â£100 Extra', payment: currentPayment + 100 },
      { name: 'Payoff in 1 Year', payment: balance / 12 + (balance * rate / 12) }
    ];
    
    let html = '';
    const monthlyRate = rate / 12;
    
    strategies.forEach((strategy, index) => {
      let months = 0;
      let calcBalance = balance;
      let totalInterest = 0;
      
      while (calcBalance > 0 && months < 600) {
        const interest = calcBalance * monthlyRate;
        totalInterest += interest;
        calcBalance = calcBalance + interest - strategy.payment;
        months++;
        if (calcBalance <= 0) break;
      }
      
      const interestSaved = strategies[0].totalInterest - totalInterest;
      
      html += `<tr style="border-bottom:1px solid rgba(255,255,255,0.05);${index === 1 ? 'background:rgba(45,212,255,0.05);' : ''}">`;
      html += `<td style="padding:8px;${index === 1 ? 'color:var(--accent);font-weight:600;' : ''}">${strategy.name}</td>`;
      html += `<td style="padding:8px;text-align:right;${index === 1 ? 'color:#39ff14;font-weight:600;' : ''}">${months} mo</td>`;
      html += `<td style="padding:8px;text-align:right;${index === 1 ? 'color:#ff2d55;font-weight:600;' : ''}">Â£${totalInterest.toFixed(2)}</td>`;
      html += `<td style="padding:8px;text-align:right;${index === 1 ? 'color:#9d4edd;font-weight:600;' : ''}">Â£${interestSaved.toFixed(2)}</td>`;
      html += `</tr>`;
    });
    
    comparisonBody.innerHTML = html;
    
    // Update button
    const compareBtn = card.querySelector('[onclick="ccCompareStrategies()"]');
    compareBtn.innerHTML = 'ğŸ“Š Hide Comparison';
  } else {
    // Hide comparison
    comparisonSection.style.display = 'none';
    const compareBtn = card.querySelector('[onclick="ccCompareStrategies()"]');
    compareBtn.innerHTML = 'ğŸ“Š Compare';
  }
}

function ccCopyResults() {
  const card = document.currentScript?.closest('.card') || document;
  const months = card.querySelector('#cc-months').textContent;
  const interest = card.querySelector('#cc-total-interest').textContent;
  const total = card.querySelector('#cc-total-payment').textContent;
  
  const text = `ğŸ’³ Credit Card Payoff Results:\nTime to Payoff: ${months}\nTotal Interest: ${interest}\nTotal Payment: ${total}`;
  
  navigator.clipboard?.writeText(text).then(() => {
    const btn = card.querySelector('[onclick="ccCopyResults()"]');
    btn.innerHTML = 'âœ… Copied!';
    setTimeout(() => {
      btn.innerHTML = 'ğŸ“‹ Copy';
    }, 2000);
  });
}

function ccReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form inputs
  card.querySelector('#cc-balance-input').value = 3000;
  card.querySelector('#cc-balance').value = 3000;
  card.querySelector('#cc-balance-slider-val').textContent = 'Â£3,000';
  
  card.querySelector('#cc-rate-input').value = 18;
  card.querySelector('#cc-rate').value = 18;
  card.querySelector('#cc-rate-slider-val').textContent = '18%';
  
  card.querySelector('#cc-payment-input').value = 150;
  card.querySelector('#cc-payment').value = 150;
  card.querySelector('#cc-payment-slider-val').textContent = 'Â£150';
  
  // Reset extra payments
  card.querySelector('#cc-extra-amount').value = 50;
  card.querySelector('#cc-extra-start').value = 1;
  card.querySelector('#cc-extra-months').value = 12;
  
  // Reset strategy
  ccSetStrategy('standard');
  
  // Reset results
  card.querySelector('#cc-months').textContent = 'â€“';
  card.querySelector('#cc-years').textContent = '';
  card.querySelector('#cc-total-interest').textContent = 'â€“';
  card.querySelector('#cc-total-payment').textContent = 'â€“';
  card.querySelector('#cc-interest-percent').textContent = '';
  card.querySelector('#cc-total-savings').textContent = '';
  card.querySelector('#cc-interest-saved').textContent = 'â€“';
  card.querySelector('#cc-progress-bar').style.width = '0%';
  card.querySelector('#cc-progress-text').textContent = 'No data';
  card.querySelector('#cc-progress-end').textContent = 'Month 0';
  card.querySelector('#cc-details').innerHTML = 'Enter your credit card details to see payoff calculations.';
  
  // Hide comparison section
  card.querySelector('#cc-comparison-section').style.display = 'none';
  const compareBtn = card.querySelector('[onclick="ccCompareStrategies()"]');
  compareBtn.innerHTML = 'ğŸ“Š Compare';
  
  // Visual feedback
  btn.innerHTML = 'âœ… Reset Complete';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ”„ Reset';
  }, 1000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set up input synchronization
    ccSyncInputs();
    
    // Set default strategy
    ccSetStrategy('standard');
    
    // Auto-calculate when inputs change
    const inputs = card.querySelectorAll('#cc-balance-input, #cc-rate-input, #cc-payment-input');
    inputs.forEach(input => {
      input.addEventListener('input', () => setTimeout(() => ccCalculate(), 500));
    });
    
    // Initial calculation
    setTimeout(() => ccCalculate(), 300);
    
    console.log('Enhanced Credit Card Payoff Calculator ready');
  });
} else {
  // Run immediately if already loaded
  const card = document.currentScript?.closest('.card') || document;
  if (card) {
    setTimeout(() => {
      ccSyncInputs();
      ccSetStrategy('standard');
      setTimeout(() => ccCalculate(), 300);
    }, 100);
  }
}
</script>

<style>
/* Card-specific styles */
#credit-card-payoff-title {
  color: var(--accent);
  margin-top: 0;
  position: relative;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(45,212,255,0.2);
}

/* Range slider styling */
input[type="range"] {
  height: 6px;
  border-radius: 3px;
  background: rgba(255,255,255,0.1);
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid rgba(255,255,255,0.2);
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* Interactive elements */
button:hover {
  transform: translateY(-1px);
  transition: all 0.2s;
}

/* Table styling */
table {
  background: rgba(255,255,255,0.02);
}

th, td {
  padding: 12px 8px;
}

tr:hover {
  background: rgba(255,255,255,0.03);
}

/* Mobile adjustments */
@media (max-width: 768px) {
  .actions {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(auto-fit, minmax(140px, 1fr))"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))"] {
    grid-template-columns: 1fr !important;
  }
  
  table {
    font-size: 0.8rem;
  }
}

/* Progress animation */
@keyframes progress-glow {
  0% { box-shadow: 0 0 5px rgba(45,212,255,0.5); }
  50% { box-shadow: 0 0 10px rgba(45,212,255,0.8); }
  100% { box-shadow: 0 0 5px rgba(45,212,255,0.5); }
}

#cc-progress-bar {
  animation: progress-glow 2s infinite;
}
</style>
