<!-- cards/discount-calculator.html -->
<h2 id="discount-calculator-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸ›ï¸ Discount Calculator
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    Smart Shopping Tool
  </span>
</h2>

<form aria-describedby="discount-calculator-desc">
  <p id="discount-calculator-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Calculate final prices after discounts, taxes, and compare savings. Perfect for shopping decisions!
  </p>

  <!-- Price Input Section -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:12px;padding:20px;border:1px solid rgba(45,212,255,0.1);margin-bottom:20px;">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
      <!-- Original Price -->
      <div class="field" style="position:relative;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label for="dc-price" style="color:var(--accent);font-weight:500;">ğŸ’° Original Price</label>
          <span id="dc-price-display" style="font-size:0.9rem;color:#ffcc00;">Â£100.00</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="dc-price" type="number" min="0" step="0.01" value="100"
                 style="flex:1;padding:14px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;font-size:1.1rem;" />
          <div style="display:flex;flex-direction:column;gap:4px;">
            <button type="button" onclick="dcAdjustValue('price', 10)" style="padding:6px 12px;border-radius:6px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;cursor:pointer;">+10</button>
            <button type="button" onclick="dcAdjustValue('price', -10)" style="padding:6px 12px;border-radius:6px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;cursor:pointer;">-10</button>
          </div>
        </div>
        <div class="small" style="margin-top:6px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
          <span>Â£0.00</span>
          <span>Â£10,000</span>
        </div>
      </div>

      <!-- Discount Percentage -->
      <div class="field" style="position:relative;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label for="dc-discount" style="color:var(--accent);font-weight:500;">ğŸ·ï¸ Discount %</label>
          <span id="dc-discount-display" style="font-size:0.9rem;color:#39ff14;">20%</span>
        </div>
        <input id="dc-discount" type="range" min="0" max="100" step="1" value="20"
               style="width:100%;margin-bottom:8px;accent-color:#39ff14;" />
        <input id="dc-discount-input" type="number" min="0" max="100" step="1" value="20"
               style="width:100%;padding:14px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;font-size:1.1rem;" />
        <div class="small" style="margin-top:6px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
          <span>0%</span>
          <span>100%</span>
        </div>
      </div>

      <!-- Tax Percentage -->
      <div class="field" style="position:relative;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label for="dc-tax" style="color:var(--accent);font-weight:500;">ğŸ“Š Tax %</label>
          <span id="dc-tax-display" style="font-size:0.9rem;color:#ff2d55;">0%</span>
        </div>
        <input id="dc-tax" type="range" min="0" max="30" step="0.5" value="0"
               style="width:100%;margin-bottom:8px;accent-color:#ff2d55;" />
        <input id="dc-tax-input" type="number" min="0" max="50" step="0.1" value="0"
               style="width:100%;padding:14px;border-radius:8px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:inherit;font-size:1.1rem;" />
        <div class="small" style="margin-top:6px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
          <span>0%</span>
          <span>30%</span>
        </div>
      </div>
    </div>

    <!-- Quick Discount Presets -->
    <div>
      <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">âš¡ Common Discounts:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="dcSetDiscount(10)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">10% Off</button>
        <button type="button" onclick="dcSetDiscount(15)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">15% Off</button>
        <button type="button" onclick="dcSetDiscount(20)" style="padding:8px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:14px;">20% Off</button>
        <button type="button" onclick="dcSetDiscount(25)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">25% Off</button>
        <button type="button" onclick="dcSetDiscount(30)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">30% Off</button>
        <button type="button" onclick="dcSetDiscount(50)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">50% Off</button>
        <button type="button" onclick="dcSetDiscount(75)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">75% Off</button>
        <button type="button" onclick="dcSetDiscount(100)" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">100% Off</button>
      </div>
    </div>
  </div>

  <!-- Common Price Presets -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">ğŸ’¸ Common Price Points:</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:8px;">
      <button type="button" onclick="dcSetPrice(9.99)" style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;font-size:0.9rem;">
        <div>Â£9.99</div>
        <div class="small" style="color:rgba(230,250,255,0.7);">Common price</div>
      </button>
      <button type="button" onclick="dcSetPrice(19.99)" style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;font-size:0.9rem;">
        <div>Â£19.99</div>
        <div class="small" style="color:rgba(230,250,255,0.7);">Mid-range</div>
      </button>
      <button type="button" onclick="dcSetPrice(49.99)" style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;font-size:0.9rem;">
        <div>Â£49.99</div>
        <div class="small" style="color:rgba(230,250,255,0.7);">Premium item</div>
      </button>
      <button type="button" onclick="dcSetPrice(99.99)" style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:0.9rem;">
        <div>Â£99.99</div>
        <div class="small" style="color:rgba(230,250,255,0.7);">Default</div>
      </button>
    </div>
  </div>

  <!-- Tax Presets -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">ğŸ›ï¸ Common Tax Rates:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="dcSetTax(0)" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">0% (Tax-free)</button>
      <button type="button" onclick="dcSetTax(5)" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">5% (Reduced)</button>
      <button type="button" onclick="dcSetTax(10)" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">10% (Standard)</button>
      <button type="button" onclick="dcSetTax(20)" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">20% (VAT UK)</button>
      <button type="button" onclick="dcSetTax(25)" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">25% (High VAT)</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="dcCalculate(this)" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ§® Calculate Now
    </button>
    <button type="button" onclick="dcCompareDiscounts()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ“Š Compare Deals
    </button>
    <button type="button" onclick="dcCopyResults()"
            style="padding:14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ“‹ Copy Results
    </button>
    <button type="button" onclick="dcReset(this)"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Reset All
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Main Results Card -->
  <div id="dc-results-section" style="display:none;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:24px;border:1px solid rgba(45,212,255,0.1);margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">ğŸ“Š Price Breakdown</h3>
      <button onclick="dcSaveDeal()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        ğŸ’¾ Save Deal
      </button>
    </div>
    
    <!-- Price Comparison Visual -->
    <div style="margin-bottom:24px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div>
          <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Original Price</div>
          <div id="dc-original-price" style="font-size:1.5rem;font-weight:700;color:#ffcc00;">Â£100.00</div>
        </div>
        <div style="font-size:1.5rem;color:var(--accent);">â†’</div>
        <div>
          <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Final Price</div>
          <div id="dc-final-price" style="font-size:2.2rem;font-weight:800;color:#39ff14;">Â£80.00</div>
        </div>
      </div>
      
      <!-- Savings Bar -->
      <div style="height:8px;background:linear-gradient(90deg, #ffcc00, #39ff14);border-radius:4px;margin-bottom:8px;position:relative;">
        <div style="position:absolute;top:-4px;left:50%;width:2px;height:16px;background:white;border-radius:1px;box-shadow:0 0 4px rgba(255,255,255,0.8);"></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:rgba(230,250,255,0.6);">
        <span>Original</span>
        <span>You Save</span>
        <span>Final</span>
      </div>
    </div>
    
    <!-- Detailed Breakdown -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));gap:16px;margin-bottom:24px;">
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ’¸ You Save</div>
        <div id="dc-you-save" style="font-size:1.8rem;font-weight:700;color:#39ff14;">Â£20.00</div>
        <div id="dc-save-percent" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">20% off</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ·ï¸ Discounted Price</div>
        <div id="dc-discounted-price" style="font-size:1.8rem;font-weight:700;color:#ffcc00;">Â£80.00</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">Before tax</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ“Š Tax Amount</div>
        <div id="dc-tax-amount" style="font-size:1.8rem;font-weight:700;color:#ff2d55;">Â£0.00</div>
        <div id="dc-tax-rate" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">0% tax rate</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ’° Total Savings</div>
        <div id="dc-total-savings" style="font-size:1.4rem;font-weight:700;color:#9d4edd;">Â£20.00</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">Including tax effect</div>
      </div>
    </div>
    
    <!-- Savings Information -->
    <div>
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">ğŸ’¡ Shopping Insights</div>
      <div id="dc-insights" style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:4px solid var(--accent);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);line-height:1.5;">
          Enter your price details to see shopping insights and savings tips.
        </div>
      </div>
    </div>
  </div>

  <!-- Multiple Discount Comparison -->
  <div id="dc-comparison-section" style="display:none;background:rgba(0,0,0,0.1);border-radius:8px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">ğŸ“Š Compare Different Discounts</h3>
    <div style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:0.9rem;">
        <thead>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
            <th style="text-align:left;padding:8px;color:var(--accent);">Discount</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Discounted Price</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">You Save</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Final Price</th>
            <th style="text-align:right;padding:8px;color:var(--accent);">Total Savings</th>
          </tr>
        </thead>
        <tbody id="dc-comparison-body">
          <!-- Will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Shopping Tips -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:24px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:20px;font-size:1.1rem;">ğŸ’¡ Smart Shopping Tips</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:8px;">ğŸ¯ Calculate Real Discounts</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Always calculate the final price including tax to know the real discount</div>
      </div>
      <div style="padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:8px;">ğŸ•’ Wait for Better Deals</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Many items go on deeper discount during clearance sales</div>
      </div>
      <div style="padding:16px;background:rgba(255,204,0,0.05);border-radius:8px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;">ğŸ“¦ Consider Bulk Buying</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Sometimes bulk discounts offer better value per unit</div>
      </div>
      <div style="padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;">
        <div style="color:#2dd4ff;font-weight:600;margin-bottom:8px;">âš¡ Stack Discounts</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Combine coupons, sales, and cashback for maximum savings</div>
      </div>
    </div>
    
    <!-- Discount Rule of Thumb -->
    <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:4px solid var(--accent);">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ğŸ“ Quick Calculation Rules</div>
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);line-height:1.5;">
        â€¢ <strong>10% off:</strong> Move decimal one place left (Â£100 â†’ Â£90)<br>
        â€¢ <strong>20% off:</strong> Divide by 5 (Â£100 â†’ Â£80)<br>
        â€¢ <strong>25% off:</strong> Divide by 4 (Â£100 â†’ Â£75)<br>
        â€¢ <strong>50% off:</strong> Half the price (Â£100 â†’ Â£50)<br>
        â€¢ <strong>75% off:</strong> Quarter the price (Â£100 â†’ Â£25)
      </div>
    </div>
  </div>
</div>

<script>
/* discount-calculator.html - Enhanced version
   - Advanced discount calculator with visual comparisons
   - Scoped with dc- prefix
*/

let dealHistory = [];

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    dcInitializeInputs();
    dcAutoCalculate();
    
    // Load history from localStorage
    const savedHistory = localStorage.getItem('dc-deal-history');
    if (savedHistory) {
      dealHistory = JSON.parse(savedHistory);
    }
  });
}

function dcInitializeInputs() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Price sync
  const priceInput = card.querySelector('#dc-price');
  const priceDisplay = card.querySelector('#dc-price-display');
  
  priceInput.addEventListener('input', function() {
    const value = parseFloat(this.value) || 0;
    priceDisplay.textContent = 'Â£' + value.toFixed(2);
    dcAutoCalculate();
  });
  
  // Discount sync
  const discountSlider = card.querySelector('#dc-discount');
  const discountInput = card.querySelector('#dc-discount-input');
  const discountDisplay = card.querySelector('#dc-discount-display');
  
  discountSlider.addEventListener('input', function() {
    const value = parseInt(this.value);
    discountInput.value = value;
    discountDisplay.textContent = value + '%';
    dcAutoCalculate();
  });
  
  discountInput.addEventListener('input', function() {
    const value = Math.min(100, Math.max(0, parseInt(this.value) || 0));
    discountSlider.value = value;
    discountDisplay.textContent = value + '%';
    dcAutoCalculate();
  });
  
  // Tax sync
  const taxSlider = card.querySelector('#dc-tax');
  const taxInput = card.querySelector('#dc-tax-input');
  const taxDisplay = card.querySelector('#dc-tax-display');
  
  taxSlider.addEventListener('input', function() {
    const value = parseFloat(this.value);
    taxInput.value = value;
    taxDisplay.textContent = value + '%';
    dcAutoCalculate();
  });
  
  taxInput.addEventListener('input', function() {
    const value = Math.min(50, Math.max(0, parseFloat(this.value) || 0));
    taxSlider.value = value;
    taxDisplay.textContent = value + '%';
    dcAutoCalculate();
  });
}

function dcAdjustValue(type, amount) {
  const card = document.currentScript?.closest('.card') || document;
  
  if (type === 'price') {
    const input = card.querySelector('#dc-price');
    const current = parseFloat(input.value) || 0;
    const newValue = Math.max(0, current + amount);
    input.value = newValue;
    card.querySelector('#dc-price-display').textContent = 'Â£' + newValue.toFixed(2);
    dcAutoCalculate();
  }
}

function dcSetPrice(price) {
  const card = document.currentScript?.closest('.card') || document;
  
  card.querySelector('#dc-price').value = price;
  card.querySelector('#dc-price-display').textContent = 'Â£' + price.toFixed(2);
  
  // Highlight the selected button
  card.querySelectorAll('[onclick*="dcSetPrice"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  const priceBtn = Array.from(card.querySelectorAll('[onclick*="dcSetPrice"]')).find(btn => 
    btn.getAttribute('onclick')?.includes(`(${price})`)
  );
  
  if (priceBtn) {
    priceBtn.style.background = 'rgba(45,212,255,0.1)';
    priceBtn.style.border = '1px solid rgba(45,212,255,0.3)';
    priceBtn.style.color = 'var(--accent)';
  }
  
  dcAutoCalculate();
}

function dcSetDiscount(discount) {
  const card = document.currentScript?.closest('.card') || document;
  
  card.querySelector('#dc-discount').value = discount;
  card.querySelector('#dc-discount-input').value = discount;
  card.querySelector('#dc-discount-display').textContent = discount + '%';
  
  // Highlight the selected button
  card.querySelectorAll('[onclick*="dcSetDiscount"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = '#e6faff';
  });
  
  const discountBtn = card.querySelector(`[onclick="dcSetDiscount(${discount})"]`);
  if (discountBtn) {
    discountBtn.style.background = 'rgba(57,255,20,0.1)';
    discountBtn.style.border = '1px solid rgba(57,255,20,0.3)';
    discountBtn.style.color = '#39ff14';
  }
  
  dcAutoCalculate();
}

function dcSetTax(tax) {
  const card = document.currentScript?.closest('.card') || document;
  
  card.querySelector('#dc-tax').value = tax;
  card.querySelector('#dc-tax-input').value = tax;
  card.querySelector('#dc-tax-display').textContent = tax + '%';
  
  // Highlight the selected button
  card.querySelectorAll('[onclick*="dcSetTax"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = '#e6faff';
  });
  
  const taxBtn = card.querySelector(`[onclick="dcSetTax(${tax})"]`);
  if (taxBtn) {
    taxBtn.style.background = 'rgba(255,45,85,0.1)';
    taxBtn.style.border = '1px solid rgba(255,45,85,0.3)';
    taxBtn.style.color = '#ff2d55';
  }
  
  dcAutoCalculate();
}

function dcCalculate(btn = null) {
  const card = document.currentScript?.closest('.card') || document;
  const price = parseFloat(card.querySelector('#dc-price').value) || 0;
  const discount = parseFloat(card.querySelector('#dc-discount-input').value) / 100 || 0;
  const tax = parseFloat(card.querySelector('#dc-tax-input').value) / 100 || 0;
  
  // Visual feedback
  if (btn) {
    btn.innerHTML = 'â³ Calculating...';
    btn.disabled = true;
  }
  
  setTimeout(() => {
    // Calculate all values
    const discountAmount = price * discount;
    const discountedPrice = price - discountAmount;
    const taxAmount = discountedPrice * tax;
    const finalPrice = discountedPrice + taxAmount;
    const totalSavings = discountAmount - taxAmount;
    
    // Show results section
    card.querySelector('#dc-results-section').style.display = 'block';
    
    // Update displays with animation
    dcAnimateValue('dc-original-price', 'Â£' + price.toFixed(2));
    dcAnimateValue('dc-final-price', 'Â£' + finalPrice.toFixed(2));
    dcAnimateValue('dc-you-save', 'Â£' + discountAmount.toFixed(2));
    dcAnimateValue('dc-discounted-price', 'Â£' + discountedPrice.toFixed(2));
    dcAnimateValue('
