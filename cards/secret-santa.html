<h2 id="secret-santa-title" style="margin-top:0;color:#ff4d4d;">ğŸ Secret Santa Generator</h2>

<form aria-describedby="secret-santa-desc" style="margin-bottom:20px;">
  <p id="secret-santa-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:16px;">
    Organize a perfect Secret Santa gift exchange with automatic matching, restrictions, and wish lists!
    <span style="color:#39ff14;display:block;margin-top:4px;">
      âœ… Supports: Family restrictions, wish lists, budget tracking, email notifications
    </span>
  </p>

  <!-- Participants Management -->
  <div style="background:rgba(255,77,77,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,77,77,0.1);">
    <h3 style="color:#ff4d4d;margin:0 0 12px 0;font-size:16px;">ğŸ‘¥ Add Participants</h3>
    
    <div style="display:grid;grid-template-columns:1fr auto;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="ss-name" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ‘¤ Participant Name
        </label>
        <input id="ss-name" type="text" placeholder="e.g., John Smith" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="ss-email" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ“§ Email (optional)
        </label>
        <input id="ss-email" type="email" placeholder="email@example.com" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;" />
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="ss-wishlist" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ Wish List (optional)
        </label>
        <textarea id="ss-wishlist" rows="2" placeholder="e.g., Books, Coffee Mug, Gift Card" 
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;resize:vertical;"></textarea>
      </div>
      
      <div class="field">
        <label for="ss-group" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family/Group
        </label>
        <select id="ss-group" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;">
          <option value="none">No group</option>
          <option value="family1">Smith Family</option>
          <option value="family2">Johnson Family</option>
          <option value="family3">Office Team A</option>
          <option value="family4">Friends Group</option>
        </select>
      </div>
    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;">
      <button type="button" onclick="ssAddParticipant()" 
              style="padding:10px 20px;background:linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1));border:1px solid rgba(255,77,77,0.4);border-radius:8px;color:#ff4d4d;cursor:pointer;font-weight:600;">
        â• Add Participant
      </button>
    </div>
  </div>

  <!-- Current Participants -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.1);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h3 style="color:#ff4d4d;margin:0;font-size:16px;">ğŸ“‹ Participants List (<span id="ss-count">0</span>)</h3>
      <button type="button" onclick="ssClearAll()" style="font-size:12px;padding:6px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">
        ğŸ—‘ï¸ Clear All
      </button>
    </div>
    
    <div id="ss-participants-list" style="max-height:200px;overflow-y:auto;background:rgba(0,0,0,0.3);border-radius:8px;padding:12px;margin-bottom:12px;">
      <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);">
        No participants added yet. Add names above to start!
      </div>
    </div>
  </div>

  <!-- Exchange Settings -->
  <div style="background:rgba(39,255,20,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(39,255,20,0.1);">
    <h3 style="color:#39ff14;margin:0 0 12px 0;font-size:16px;">âš™ï¸ Exchange Settings</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="ss-budget" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ’° Gift Budget ($)
        </label>
        <input id="ss-budget" type="number" min="5" max="500" value="25"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="ss-date" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ“… Gift Exchange Date
        </label>
        <input id="ss-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;" />
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ”„ Matching Rules
        </label>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-no-self" checked style="accent-color:#39ff14;">
            Prevent self-matching
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-no-family" checked style="accent-color:#39ff14;">
            Prevent family matching
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-allow-rematch" style="accent-color:#39ff14;">
            Allow re-matching from last year
          </label>
        </div>
      </div>
      
      <div class="field">
        <label style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ“¤ Notification Options
        </label>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-show-all" style="accent-color:#39ff14;">
            Show all matches to organizer
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-send-emails" style="accent-color:#39ff14;">
            Email matches to participants
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:13px;">
            <input type="checkbox" id="ss-reminder" checked style="accent-color:#39ff14;">
            Send reminder before event
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="ssGenerateMatches()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1));border:1px solid rgba(255,77,77,0.4);border-radius:8px;color:#ff4d4d;cursor:pointer;font-weight:600;">
      ğŸ² Generate Secret Santa Matches
    </button>
    <button type="button" onclick="ssReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset
    </button>
    <button type="button" onclick="ssExport()"
            style="padding:12px 16px;background:rgba(39,255,20,0.1);border:1px solid rgba(39,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      ğŸ“Š Export Results
    </button>
  </div>
</form>

<!-- Results Section -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:#ff4d4d;margin:0;">ğŸ… Secret Santa Assignments</h3>
    <div id="ss-status" style="font-size:12px;color:rgba(230,250,255,0.7);"></div>
  </div>

  <!-- Matches Display -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:16px;margin-bottom:16px;">
    <div id="ss-results-container" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <h4 style="color:#39ff14;margin:0;font-size:14px;">ğŸ¤« Your Secret Assignment</h4>
        <button onclick="ssRevealAll()" style="font-size:12px;padding:6px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">
          ğŸ‘ï¸ Reveal All (Organizer)
        </button>
      </div>
      
      <div id="ss-individual-result" style="background:rgba(0,0,0,0.4);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(39,255,20,0.2);">
        <div style="text-align:center;color:rgba(230,250,255,0.6);">
          Select your name to see your Secret Santa assignment
        </div>
      </div>
      
      <div id="ss-all-results" style="display:none;">
        <h4 style="color:#ff4d4d;margin:0 0 12px 0;font-size:14px;">ğŸ“‹ All Assignments (Organizer View)</h4>
        <div id="ss-all-matches" style="max-height:300px;overflow-y:auto;"></div>
      </div>
    </div>
    
    <div id="ss-no-results" style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
      <div style="font-size:48px;margin-bottom:12px;">ğŸ</div>
      <div>Generate Secret Santa matches to see assignments here!</div>
    </div>
  </div>

  <!-- Gift Suggestions -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;margin-bottom:16px;">
    <h4 style="color:#ff4d4d;margin:0 0 8px 0;font-size:14px;">ğŸ’¡ Gift Ideas by Category</h4>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;font-size:11px;">
      <div style="background:rgba(255,77,77,0.1);border-radius:6px;padding:8px;text-align:center;">
        <div style="color:#ff4d4d;margin-bottom:4px;">ğŸ®</div>
        <div>Tech & Games</div>
      </div>
      <div style="background:rgba(255,165,0,0.1);border-radius:6px;padding:8px;text-align:center;">
        <div style="color:#ffa500;margin-bottom:4px;">ğŸ“š</div>
        <div>Books & Learning</div>
      </div>
      <div style="background:rgba(39,255,20,0.1);border-radius:6px;padding:8px;text-align:center;">
        <div style="color:#39ff14;margin-bottom:4px;">â˜•</div>
        <div>Food & Drink</div>
      </div>
      <div style="background:rgba(45,212,255,0.1);border-radius:6px;padding:8px;text-align:center;">
        <div style="color:var(--accent);margin-bottom:4px;">ğŸ§£</div>
        <div>Clothing & Accessories</div>
      </div>
    </div>
  </div>

  <!-- Budget Tracker -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <h4 style="color:#39ff14;margin:0;font-size:14px;">ğŸ’° Budget Tracker</h4>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Budget: $<span id="ss-budget-display">25</span></div>
    </div>
    
    <div style="display:flex;align-items:center;gap:12px;">
      <div style="flex:1;height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;">
        <div id="ss-budget-progress" style="height:100%;background:linear-gradient(90deg, #39ff14, #ffcc00);width:0%;transition:width 0.5s;border-radius:6px;"></div>
      </div>
      <div id="ss-budget-status" style="font-size:12px;color:#39ff14;">$0 spent</div>
    </div>
    
    <div style="display:flex;justify-content:space-between;margin-top:4px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">$0</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">Budget Limit</div>
    </div>
  </div>
</div>

<!-- Printable Labels -->
<div style="margin-top:24px;background:rgba(255,77,77,0.05);border-radius:8px;border:1px solid rgba(255,77,77,0.1);padding:16px;">
  <h3 class="small" style="color:#ff4d4d;margin:0 0 12px 0;">ğŸ–¨ï¸ Printable Gift Tags</h3>
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
    <button onclick="ssPrintTags('christmas')" style="padding:10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">
      ğŸ„ Christmas Theme
    </button>
    <button onclick="ssPrintTags('modern')" style="padding:10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">
      ğŸ¨ Modern Theme
    </button>
    <button onclick="ssPrintTags('funny')" style="padding:10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">
      ğŸ˜„ Funny Theme
    </button>
    <button onclick="ssPrintTags('elegant')" style="padding:10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">
      ğŸ‘‘ Elegant Theme
    </button>
  </div>
</div>

<script>
/* secret-santa.html
   - Secret Santa organizer with matching algorithm
   - Scoped with "ss" prefix
*/

let ssParticipants = [];
let ssMatches = [];
let ssLastYearMatches = [];

function ssAddParticipant() {
  const name = document.querySelector('#ss-name').value.trim();
  const email = document.querySelector('#ss-email').value.trim();
  const wishlist = document.querySelector('#ss-wishlist').value.trim();
  const group = document.querySelector('#ss-group').value;
  
  if (!name) {
    alert('Please enter a name');
    return;
  }
  
  // Check for duplicate names
  if (ssParticipants.some(p => p.name.toLowerCase() === name.toLowerCase())) {
    alert('This name is already in the list!');
    return;
  }
  
  const participant = {
    id: Date.now() + Math.random(),
    name,
    email,
    wishlist,
    group,
    assignedTo: null,
    assignedFrom: null
  };
  
  ssParticipants.push(participant);
  
  // Clear inputs
  document.querySelector('#ss-name').value = '';
  document.querySelector('#ss-email').value = '';
  document.querySelector('#ss-wishlist').value = '';
  
  // Update UI
  ssUpdateParticipantsList();
  ssUpdateCount();
  
  // Show success message
  const status = document.querySelector('#ss-status');
  status.textContent = `âœ… Added ${name}`;
  status.style.color = '#39ff14';
  setTimeout(() => {
    status.textContent = '';
  }, 2000);
}

function ssUpdateParticipantsList() {
  const container = document.querySelector('#ss-participants-list');
  
  if (ssParticipants.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:20px;color:rgba(230,250,255,0.5);">
        No participants added yet. Add names above to start!
      </div>
    `;
    return;
  }
  
  let html = '<div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(250px, 1fr));gap:10px;">';
  
  ssParticipants.forEach((p, index) => {
    const groupColor = p.group === 'family1' ? '#ff4d4d' : 
                      p.group === 'family2' ? '#ffa500' :
                      p.group === 'family3' ? '#39ff14' :
                      p.group === 'family4' ? 'var(--accent)' : 'rgba(230,250,255,0.7)';
    
    html += `
      <div style="background:rgba(0,0,0,0.4);border-radius:8px;padding:12px;border-left:4px solid ${groupColor};">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;">
          <div>
            <strong style="color:${groupColor};">${p.name}</strong>
            ${p.email ? `<div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:2px;">${p.email}</div>` : ''}
          </div>
          <button onclick="ssRemoveParticipant(${p.id})" style="background:transparent;border:none;color:rgba(255,77,77,0.7);cursor:pointer;font-size:14px;" title="Remove">
            ğŸ—‘ï¸
          </button>
        </div>
        ${p.wishlist ? `
          <div style="font-size:11px;color:rgba(230,250,255,0.8);margin-top:6px;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;">
            <strong style="color:#39ff14;">ğŸ Wishlist:</strong> ${p.wishlist}
          </div>
        ` : ''}
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

function ssRemoveParticipant(id) {
  if (!confirm('Remove this participant?')) return;
  
  ssParticipants = ssParticipants.filter(p => p.id !== id);
  ssUpdateParticipantsList();
  ssUpdateCount();
}

function ssClearAll() {
  if (ssParticipants.length === 0) return;
  if (!confirm('Remove all participants?')) return;
  
  ssParticipants = [];
  ssMatches = [];
  ssUpdateParticipantsList();
  ssUpdateCount();
  ssHideResults();
}

function ssUpdateCount() {
  document.querySelector('#ss-count').textContent = ssParticipants.length;
}

function ssGenerateMatches() {
  if (ssParticipants.length < 3) {
    alert('Need at least 3 participants for Secret Santa!');
    return;
  }
  
  const preventSelf = document.querySelector('#ss-no-self').checked;
  const preventFamily = document.querySelector('#ss-no-family').checked;
  const allowRematch = document.querySelector('#ss-allow-rematch').checked;
  const budget = parseFloat(document.querySelector('#ss-budget').value) || 25;
  
  // Reset previous matches
  ssParticipants.forEach(p => {
    p.assignedTo = null;
    p.assignedFrom = null;
  });
  
  // Create a copy of participants to assign
  let receivers = [...ssParticipants];
  let senders = [...ssParticipants];
  
  // Shuffle arrays
  receivers = ssShuffleArray(receivers);
  senders = ssShuffleArray(senders);
  
  // Try to create valid matches
  let attempts = 0;
  const maxAttempts = 1000;
  
  while (attempts < maxAttempts) {
    // Reset
    ssParticipants.forEach(p => {
      p.assignedTo = null;
      p.assignedFrom = null;
    });
    
    let success = true;
    
    for (let sender of senders) {
      // Find available receivers
      let availableReceivers = receivers.filter(r => {
        // Can't be assigned to themselves
        if (preventSelf && r.id === sender.id) return false;
        
        // Can't be in same family group
        if (preventFamily && r.group !== 'none' && r.group === sender.group) return false;
        
        // Check if already assigned from this sender
        if (r.assignedFrom && r.assignedFrom.id === sender.id) return false;
        
        // Check if already assigned to this receiver
        if (r.assignedTo && r.assignedTo.id === sender.id) return false;
        
        return true;
      });
      
      if (availableReceivers.length === 0) {
        success = false;
        break;
      }
      
      // Pick random receiver
      const receiver = availableReceivers[Math.floor(Math.random() * availableReceivers.length)];
      
      // Assign
      sender.assignedTo = receiver;
      receiver.assignedFrom = sender;
      
      // Remove from available receivers
      receivers = receivers.filter(r => r.id !== receiver.id);
    }
    
    if (success) {
      break;
    }
    
    attempts++;
  }
  
  if (attempts >= maxAttempts) {
    alert('Could not create valid matches. Try relaxing some restrictions.');
    return;
  }
  
  // Store matches
  ssMatches = ssParticipants.map(p => ({
    from: p.name,
    to: p.assignedTo ? p.assignedTo.name : 'Not assigned',
    wishlist: p.assignedTo ? p.assignedTo.wishlist : '',
    email: p.email
  }));
  
  // Update budget display
  document.querySelector('#ss-budget-display').textContent = budget;
  
  // Show results
  ssShowResults();
  
  // Update status
  const status = document.querySelector('#ss-status');
  status.textContent = `âœ… Matches generated for ${ssParticipants.length} people!`;
  status.style.color = '#39ff14';
}

function ssShuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

function ssShowResults() {
  document.querySelector('#ss-no-results').style.display = 'none';
  document.querySelector('#ss-results-container').style.display = 'block';
  
  // Create participant selector
  const selector = document.createElement('select');
  selector.id = 'ss-select-participant';
  selector.style.cssText = 'width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;margin-bottom:12px;';
  selector.innerHTML = '<option value="">Select your name to see your assignment...</option>';
  
  ssParticipants.forEach(p => {
    selector.innerHTML += `<option value="${p.id}">${p.name}</option>`;
  });
  
  selector.addEventListener('change', function() {
    const id = parseInt(this.value);
    const participant = ssParticipants.find(p => p.id === id);
    
    if (participant && participant.assignedTo) {
      const budget = parseFloat(document.querySelector('#ss-budget').value) || 25;
      
      const html = `
        <div style="text-align:center;">
          <div style="font-size:36px;margin-bottom:12px;">ğŸ…</div>
          <div style="font-size:20px;color:#39ff14;margin-bottom:8px;">${participant.name}</div>
          <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-bottom:16px;">
            You are Secret Santa for:
          </div>
          <div style="font-size:24px;color:#ff4d4d;font-weight:600;margin-bottom:16px;padding:12px;background:rgba(255,77,77,0.1);border-radius:8px;">
            ${participant.assignedTo.name}
          </div>
          ${participant.assignedTo.wishlist ? `
            <div style="margin-bottom:16px;">
              <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">ğŸ Their Wishlist:</div>
              <div style="font-size:14px;color:rgba(230,250,255,0.9);padding:10px;background:rgba(39,255,20,0.1);border-radius:6px;">
                ${participant.assignedTo.wishlist}
              </div>
            </div>
          ` : ''}
          <div style="font-size:12px;color:rgba(230,250,255,0.7);padding:10px;background:rgba(0,0,0,0.3);border-radius:6px;">
            ğŸ’° Gift Budget: $${budget}<br>
            ğŸ¯ Remember: Keep it secret until the exchange!
          </div>
        </div>
      `;
      
      document.querySelector('#ss-individual-result').innerHTML = html;
      
      // Update budget progress (random for demo)
      const spent = Math.random() * budget;
      const progress = (spent / budget) * 100;
      document.querySelector('#ss-budget-progress').style.width = `${Math.min(100, progress)}%`;
      document.querySelector('#ss-budget-status').textContent = `$${spent.toFixed(2)} spent`;
      document.querySelector('#ss-budget-status').style.color = spent > budget * 0.8 ? '#ff4d4d' : '#39ff14';
    }
  });
  
  const resultContainer = document.querySelector('#ss-individual-result');
  resultContainer.innerHTML = '';
  resultContainer.appendChild(selector);
  
  // Build organizer view
  let allMatchesHtml = '<div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:12px;">';
  
  ssParticipants.forEach(p => {
    if (p.assignedTo) {
      allMatchesHtml += `
        <div style="background:rgba(0,0,0,0.4);border-radius:8px;padding:12px;border-left:4px solid #ff4d4d;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
            <div style="font-weight:600;color:#ff4d4d;">${p.name}</div>
            <div style="font-size:20px;">ğŸ</div>
          </div>
          <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-bottom:4px;">
            â†’ Gifts for: <strong style="color:#39ff14;">${p.assignedTo.name}</strong>
          </div>
          ${p.assignedTo.wishlist ? `
            <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:6px;padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;">
              ${p.assignedTo.wishlist}
            </div>
          ` : ''}
        </div>
      `;
    }
  });
  
  allMatchesHtml += '</div>';
  document.querySelector('#ss-all-matches').innerHTML = allMatchesHtml;
}

function ssHideResults() {
  document.querySelector('#ss-no-results').style.display = 'block';
  document.querySelector('#ss-results-container').style.display = 'none';
}

function ssRevealAll() {
  const allResults = document.querySelector('#ss-all-results');
  if (allResults.style.display === 'none') {
    allResults.style.display = 'block';
    document.querySelector('#ss-status').textContent = 'ğŸ‘ï¸ All matches revealed (organizer view)';
  } else {
    allResults.style.display = 'none';
    document.querySelector('#ss-status').textContent = '';
  }
}

function ssReset() {
  if (!confirm('Reset everything and start over?')) return;
  
  ssParticipants = [];
  ssMatches = [];
  ssUpdateParticipantsList();
  ssUpdateCount();
  ssHideResults();
  
  // Reset form
  document.querySelector('#ss-name').value = '';
  document.querySelector('#ss-email').value = '';
  document.querySelector('#ss-wishlist').value = '';
  document.querySelector('#ss-budget').value = 25;
  
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  document.querySelector('#ss-date').valueAsDate = tomorrow;
  
  document.querySelector('#ss-status').textContent = 'âœ… Reset complete';
  setTimeout(() => {
    document.querySelector('#ss-status').textContent = '';
  }, 2000);
}

function ssExport() {
  if (ssMatches.length === 0) {
    alert('Generate matches first!');
    return;
  }
  
  const budget = document.querySelector('#ss-budget').value;
  const date = document.querySelector('#ss-date').value;
  
  const exportData = {
    exportDate: new Date().toISOString(),
    eventDate: date,
    budget: budget,
    totalParticipants: ssParticipants.length,
    matches: ssMatches,
    participants: ssParticipants.map(p => ({
      name: p.name,
      email: p.email,
      wishlist: p.wishlist,
      group: p.group
    }))
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const fileName = `secret-santa-${new Date().toISOString().split('T')[0]}.json`;
  
  const link = document.createElement('a');
  link.download = fileName;
  link.href = dataUri;
  link.click();
  
  document.querySelector('#ss-status').textContent = 'âœ… Data exported';
  document.querySelector('#ss-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#ss-status').textContent = '';
  }, 2000);
}

function ssPrintTags(theme) {
  if (ssMatches.length === 0) {
    alert('Generate matches first!');
    return;
  }
  
  const printWindow = window.open('', '_blank');
  const styles = {
    christmas: 'background: linear-gradient(45deg, #ff4d4d, #39ff14); color: white;',
    modern: 'background: linear-gradient(45deg, #2dd4ff, #9d4edd); color: white;',
    funny: 'background: linear-gradient(45deg, #ffcc00, #ff2d55); color: black;',
    elegant: 'background: linear-gradient(45deg, #333333, #666666); color: #ffcc00;'
  };
  
  const themeStyle = styles[theme] || styles.christmas;
  
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Secret Santa Gift Tags</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tag { 
          ${themeStyle}
          width: 3in; 
          height: 2in; 
          padding: 15px; 
          margin: 10px; 
          border-radius: 10px; 
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          display: inline-block;
          text-align: center;
          vertical-align: top;
          break-inside: avoid;
        }
        .to { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .from { font-size: 14px; opacity: 0.8; }
        .message { font-size: 12px; margin-top: 10px; }
        @media print {
          body { margin: 0; }
          .tag { margin: 5mm; }
        }
      </style>
    </head>
    <body>
      <h1>ğŸ Secret Santa Gift Tags</h1>
      <div>
  `);
  
  ssMatches.forEach(match => {
    printWindow.document.write(`
      <div class="tag">
        <div style="font-size: 36px;">ğŸ…</div>
        <div class="to">To: ${match.to}</div>
        <div class="from">From: Your Secret Santa</div>
        <div class="message">Have a wonderful Christmas! ğŸ„</div>
      </div>
    `);
  });
  
  printWindow.document.write(`
      </div>
      <script>
        setTimeout(() => { window.print(); }, 500);
      <\/script>
    </body>
    </html>
  `);
  
  printWindow.document.close();
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    // Set default date to next Christmas or 2 weeks from now
    const today = new Date();
    const defaultDate = new Date(today);
    defaultDate.setDate(today.getDate() + 14);
    document.querySelector('#ss-date').valueAsDate = defaultDate;
    
    // Add sample participants for demo
    if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
      setTimeout(() => {
        const sampleParticipants = [
          { name: 'John Smith', email: 'john@example.com', wishlist: 'Coffee mug, Book, Chocolate', group: 'family1' },
          { name: 'Sarah Johnson', email: 'sarah@example.com', wishlist: 'Scarf, Tea, Candles', group: 'family1' },
          { name: 'Mike Brown', email: 'mike@example.com', wishlist: 'Tools, Beer, Socks', group: 'family2' },
          { name: 'Emma Wilson', email: 'emma@example.com', wishlist: 'Perfume, Notebook, Gift card', group: 'family2' },
          { name: 'David Lee', email: 'david@example.com', wishlist: 'Video game, Headphones, Snacks', group: 'none' }
        ];
        
        sampleParticipants.forEach(p => {
          // Simulate adding participants
          setTimeout(() => {
            document.querySelector('#ss-name').value = p.name;
            document.querySelector('#ss-email').value = p.email;
            document.querySelector('#ss-wishlist').value = p.wishlist;
            document.querySelector('#ss-group').value = p.group;
            ssAddParticipant();
          }, 100);
        });
      }, 1000);
    }
  });
}
</script>

<style>
/* Secret Santa styles */
#secret-santa-title {
  background: linear-gradient(45deg, #ff4d4d, #39ff14);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-top: 0;
  margin-bottom: 4px;
}

/* Gift tag animation */
@keyframes giftShake {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}

.gift-icon {
  display: inline-block;
  animation: giftShake 2s infinite;
}

/* Santa hat cursor */
.santa-cursor {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cpath fill='%23ff4d4d' d='M16 4l-4 8 4-8 4 8z'/%3E%3Cpath fill='%23fff' d='M16 4l12 20H4z'/%3E%3C/svg%3E"), auto;
}

/* Responsive design */
@media (max-width: 768px) {
  .participant-grid {
    grid-template-columns: 1fr !important;
  }
  
  .gift-ideas {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .print-buttons {
    grid-template-columns: 1fr !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
}

/* Secret reveal animation */
@keyframes secretReveal {
  0% { opacity: 0; transform: scale(0.8); }
  100% { opacity: 1; transform: scale(1); }
}

.secret-reveal {
  animation: secretReveal 0.5s ease-out;
}

/* Festive background pattern */
.secret-santa-bg {
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(255,77,77,0.1) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(57,255,20,0.1) 0%, transparent 20%);
}
</style>
