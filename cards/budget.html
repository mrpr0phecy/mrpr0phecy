<!-- cards/budget-planner.html -->
<div class="card-content">
<h2 id="budget-planner-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸ’° Financial Wellness Dashboard
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    Finance & Lifestyle
  </span>
</h2>

<form aria-describedby="budget-planner-desc">
  <p id="budget-planner-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Smart budgeting with predictive analytics, financial health scoring, and personalized optimization strategies.
  </p>

  <!-- Financial Overview -->
  <div style="margin-bottom:20px;padding:20px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:12px;border:1px solid rgba(45,212,255,0.1);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1rem;">ğŸ“Š Financial Snapshot</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;">
      <!-- Monthly Income -->
      <div class="field">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label for="budget-income" style="color:var(--accent);font-weight:500;">ğŸ’µ Monthly Income</label>
          <span id="income-per-hour" style="font-size:0.85rem;color:rgba(230,250,255,0.7);">$18.75/hour</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="budget-income" type="number" min="500" max="50000" value="3000" 
                 style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <div style="display:flex;flex-direction:column;gap:4px;">
            <button type="button" onclick="bpAdjustValue('budget-income', 100)" style="padding:6px 12px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;">+100</button>
            <button type="button" onclick="bpAdjustValue('budget-income', -100)" style="padding:6px 12px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;">-100</button>
          </div>
        </div>
        <div class="small" style="margin-top:6px;color:rgba(230,250,255,0.7);display:flex;justify-content:space-between;">
          <span>Basic needs: $1,500</span>
          <span>Comfortable: $4,500</span>
        </div>
      </div>
      
      <!-- Savings Goal -->
      <div class="field">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label for="budget-savings" style="color:var(--accent);font-weight:500;">ğŸ¯ Savings Goal</label>
          <span id="savings-display" style="font-size:0.9rem;color:#39ff14;">20% ($600)</span>
        </div>
        <input type="range" id="budget-savings" min="5" max="50" step="5" value="20" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(45,212,255,0.1);outline:none;"
               oninput="bpUpdateSavingsDisplay(this.value)">
        <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:0.85rem;color:rgba(230,250,255,0.7);">
          <span>Minimum (5%)</span>
          <span>Aggressive (50%)</span>
        </div>
      </div>
    </div>
    
    <!-- Financial Goals -->
    <div style="margin-top:16px;">
      <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">ğŸ† Financial Goals</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;">
        <label class="goal-radio" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="radio" name="financial-goal" value="emergency" checked>
          <span style="color:rgba(230,250,255,0.9);">Emergency Fund</span>
        </label>
        <label class="goal-radio" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="radio" name="financial-goal" value="debt">
          <span style="color:rgba(230,250,255,0.9);">Debt Freedom</span>
        </label>
        <label class="goal-radio" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="radio" name="financial-goal" value="investment">
          <span style="color:rgba(230,250,255,0.9);">Investing</span>
        </label>
        <label class="goal-radio" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="radio" name="financial-goal" value="retirement">
          <span style="color:rgba(230,250,255,0.9);">Retirement</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Smart Expense Categories -->
  <div style="margin-bottom:20px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1rem;">ğŸ“ˆ Smart Expense Tracking</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;">
      <!-- Essentials -->
      <div style="padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
        <div style="color:#39ff14;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          <span>ğŸ  Essentials</span>
          <span style="margin-left:auto;font-size:0.9rem;color:rgba(230,250,255,0.7);">50% ideal</span>
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-rent" style="color:rgba(230,250,255,0.9);">Rent/Mortgage</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">33%</span>
          </div>
          <input id="budget-rent" type="number" min="0" value="1000" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-bills" style="color:rgba(230,250,255,0.9);">Bills & Utilities</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">10%</span>
          </div>
          <input id="budget-bills" type="number" min="0" value="300" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-food" style="color:rgba(230,250,255,0.9);">Food & Groceries</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">13%</span>
          </div>
          <input id="budget-food" type="number" min="0" value="400" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
      </div>
      
      <!-- Lifestyle -->
      <div style="padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
        <div style="color:#2dd4ff;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          <span>ğŸš— Lifestyle</span>
          <span style="margin-left:auto;font-size:0.9rem;color:rgba(230,250,255,0.7);">30% ideal</span>
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-transport" style="color:rgba(230,250,255,0.9);">Transport</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">7%</span>
          </div>
          <input id="budget-transport" type="number" min="0" value="200" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-entertainment" style="color:rgba(230,250,255,0.9);">Entertainment</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">5%</span>
          </div>
          <input id="budget-entertainment" type="number" min="0" value="150" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-health" style="color:rgba(230,250,255,0.9);">Health & Wellness</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">3%</span>
          </div>
          <input id="budget-health" type="number" min="0" value="100" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
      </div>
      
      <!-- Future & Debt -->
      <div style="padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          <span>ğŸ“ˆ Future & Debt</span>
          <span style="margin-left:auto;font-size:0.9rem;color:rgba(230,250,255,0.7);">20% ideal</span>
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-debt" style="color:rgba(230,250,255,0.9);">Debt Payments</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">5%</span>
          </div>
          <input id="budget-debt" type="number" min="0" value="150" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-investment" style="color:rgba(230,250,255,0.9);">Investments</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">0%</span>
          </div>
          <input id="budget-investment" type="number" min="0" value="0" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
        
        <div class="field">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <label for="budget-other" style="color:rgba(230,250,255,0.9);">Other/Misc</label>
            <span class="expense-percentage" style="font-size:0.8rem;color:rgba(230,250,255,0.7);">10%</span>
          </div>
          <input id="budget-other" type="number" min="0" value="300" 
                 style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="bpCalculate()" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ§® Analyze Budget
    </button>
    <button type="button" onclick="bpOptimizeBudget()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      âš¡ Auto-Optimize
    </button>
    <button type="button" onclick="bpGeneratePlan()"
            style="padding:14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ“‹ Action Plan
    </button>
    <button type="button" onclick="bpReset()"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Reset All
    </button>
  </div>
</form>

<!-- Results Dashboard -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Financial Health Score -->
  <div id="bp-results-section" style="display:none;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:24px;border:1px solid rgba(45,212,255,0.1);margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">ğŸ“Š Financial Health Dashboard</h3>
      <div style="display:flex;gap:8px;">
        <button onclick="bpSaveBudget()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
          ğŸ’¾ Save Budget
        </button>
        <button onclick="bpExportReport()" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:0.9rem;">
          ğŸ“ˆ Export Report
        </button>
      </div>
    </div>
    
    <!-- Health Score & Metrics -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:24px;">
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ† Financial Health</div>
        <div id="bp-health-score" style="font-size:2.5rem;font-weight:800;color:#39ff14;line-height:1;">0/100</div>
        <div id="bp-health-category" style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">Category</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ’µ Cash Flow</div>
        <div id="bp-cash-flow" style="font-size:1.8rem;font-weight:700;color:#2dd4ff;">$0</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">Monthly surplus/deficit</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ¯ Savings Rate</div>
        <div id="bp-savings-rate" style="font-size:1.8rem;font-weight:700;color:#ffcc00;">0%</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">Of income saved</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">â±ï¸ Freedom Timeline</div>
        <div id="bp-freedom-timeline" style="font-size:1.8rem;font-weight:700;color:#9d4edd;">0 years</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:4px;">To financial independence</div>
      </div>
    </div>
    
    <!-- Expense Breakdown -->
    <div style="margin-bottom:24px;">
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">ğŸ“ˆ Expense Allocation</div>
      <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;">
        <!-- Category Bars -->
        <div id="bp-category-bars">
          <!-- Generated bars will appear here -->
        </div>
      </div>
    </div>
    
    <!-- Smart Recommendations -->
    <div id="bp-recommendations" style="display:none;">
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">ğŸ’¡ Smart Recommendations</div>
      <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:20px;">
        <div id="bp-rec-content">
          <!-- Generated recommendations will appear here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Budget Visualization -->
  <div id="bp-chart-section" style="display:none;background:rgba(0,0,0,0.1);border-radius:8px;padding:24px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:20px;font-size:1.1rem;">ğŸ“Š Budget Visualization</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;">
      <div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">ğŸ¥§ Expense Distribution</div>
        <canvas id="bp-pie-chart" width="300" height="200"></canvas>
      </div>
      
      <div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:12px;">ğŸ“ˆ Monthly Cash Flow</div>
        <canvas id="bp-cash-flow-chart" width="300" height="200"></canvas>
      </div>
    </div>
  </div>

  <!-- Financial Education -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:24px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:20px;font-size:1.1rem;">ğŸ“ Financial Wisdom</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:8px;">50/30/20 Rule</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">
          Essentials: 50%<br>
          Lifestyle: 30%<br>
          Future: 20%
        </div>
      </div>
      <div style="padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:8px;">ğŸ’° Emergency Fund</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">
          3-6 months expenses<br>
          High-yield savings<br>
          Liquid & accessible
        </div>
      </div>
      <div style="padding:16px;background:rgba(255,204,0,0.05);border-radius:8px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;">ğŸ“ˆ Compound Growth</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">
          $300/month at 7%<br>
          10 years: $52,000<br>
          30 years: $340,000
        </div>
      </div>
      <div style="padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;">
        <div style="color:#2dd4ff;font-weight:600;margin-bottom:8px;">ğŸ¯ Goal Setting</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">
          Specific<br>
          Measurable<br>
          Achievable<br>
          Relevant<br>
          Time-bound
        </div>
      </div>
    </div>
    
    <!-- Success Milestones -->
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;">ğŸ† Financial Milestones</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;">
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
          <div style="color:#39ff14;font-size:0.9rem;margin-bottom:4px;">ğŸ’° $1,000</div>
          <div style="font-size:0.85rem;color:rgba(230,250,255,0.9);">Initial emergency fund</div>
        </div>
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
          <div style="color:#2dd4ff;font-size:0.9rem;margin-bottom:4px;">ğŸ¯ 3 Months</div>
          <div style="font-size:0.85rem;color:rgba(230,250,255,0.9);">Full emergency fund</div>
        </div>
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
          <div style="color:#ffcc00;font-size:0.9rem;margin-bottom:4px;">ğŸ“ˆ $10,000</div>
          <div style="font-size:0.85rem;color:rgba(230,250,255,0.9);">Investment starter</div>
        </div>
        <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
          <div style="color:#9d4edd;font-size:0.9rem;margin-bottom:4px;">ğŸ  20% Down</div>
          <div style="font-size:0.85rem;color:rgba(230,250,255,0.9);">Home purchase ready</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Financial Wellness Dashboard - Complete Implementation

// Ideal budget allocations (percentage of income)
const idealAllocations = {
    essentials: { min: 0.45, max: 0.55, color: '#39ff14' }, // Rent, bills, food
    lifestyle: { min: 0.25, max: 0.35, color: '#2dd4ff' }, // Transport, entertainment, health
    future: { min: 0.15, max: 0.25, color: '#ffcc00' }    // Savings, investments, debt
};

// Financial health scoring weights
const healthWeights = {
    savingsRate: 0.3,
    expenseRatio: 0.25,
    cashFlow: 0.2,
    debtRatio: 0.15,
    emergencyFund: 0.1
};

// Initialize calculator
function bpInitialize() {
    // Set up event listeners for all inputs
    const inputs = [
        'budget-income', 'budget-savings', 'budget-rent', 'budget-bills',
        'budget-food', 'budget-transport', 'budget-entertainment',
        'budget-health', 'budget-debt', 'budget-investment', 'budget-other'
    ];
    
    inputs.forEach(id => {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('input', () => {
                bpUpdatePercentages();
                bpCalculate();
            });
        }
    });
    
    // Add listeners for radio buttons
    document.querySelectorAll('input[name="financial-goal"]').forEach(rb => {
        rb.addEventListener('change', bpCalculate);
    });
    
    // Initialize savings display
    bpUpdateSavingsDisplay(document.getElementById('budget-savings').value);
    
    // Calculate initial state
    setTimeout(() => {
        bpUpdatePercentages();
        bpCalculate();
    }, 500);
}

// Update savings display
function bpUpdateSavingsDisplay(value) {
    const income = parseFloat(document.getElementById('budget-income').value) || 0;
    const savingsAmount = income * (value / 100);
    const display = document.getElementById('savings-display');
    display.textContent = `${value}% (${bpFormatCurrency(savingsAmount)})`;
    display.style.color = value >= 20 ? '#39ff14' : value >= 10 ? '#ffcc00' : '#ff2d55';
}

// Update expense percentages
function bpUpdatePercentages() {
    const income = parseFloat(document.getElementById('budget-income').value) || 1;
    
    // Update all expense percentages
    const expenseIds = [
        'budget-rent', 'budget-bills', 'budget-food', 'budget-transport',
        'budget-entertainment', 'budget-health', 'budget-debt',
        'budget-investment', 'budget-other'
    ];
    
    expenseIds.forEach(id => {
        const input = document.getElementById(id);
        const percentageSpan = input.parentElement.querySelector('.expense-percentage');
        if (percentageSpan && input.value) {
            const percentage = ((parseFloat(input.value) || 0) / income * 100).toFixed(1);
            percentageSpan.textContent = `${percentage}%`;
            
            // Color code based on ideal ranges
            const expenseType = bpGetExpenseType(id);
            const idealRange = idealAllocations[expenseType];
            const pct = parseFloat(percentage);
            
            if (idealRange) {
                const idealMin = idealRange.min * 100;
                const idealMax = idealRange.max * 100;
                percentageSpan.style.color = 
                    pct >= idealMin && pct <= idealMax ? '#39ff14' :
                    pct < idealMin ? '#ffcc00' : '#ff2d55';
            }
        }
    });
    
    // Update hourly rate
    const hourlyRate = (income / 160).toFixed(2); // Assuming 160 working hours/month
    document.getElementById('income-per-hour').textContent = `$${hourlyRate}/hour`;
}

// Get expense type for categorization
function bpGetExpenseType(id) {
    const essentials = ['budget-rent', 'budget-bills', 'budget-food'];
    const lifestyle = ['budget-transport', 'budget-entertainment', 'budget-health'];
    const future = ['budget-savings', 'budget-debt', 'budget-investment'];
    
    if (essentials.includes(id)) return 'essentials';
    if (lifestyle.includes(id)) return 'lifestyle';
    if (future.includes(id)) return 'future';
    return 'future'; // 'other' goes to future category
}

// Format currency
function bpFormatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Main calculation function
function bpCalculate() {
    try {
        // Get all input values
        const income = parseFloat(document.getElementById('budget-income').value) || 0;
        const savingsGoal = parseFloat(document.getElementById('budget-savings').value) || 0;
        
        const expenses = {
            rent: parseFloat(document.getElementById('budget-rent').value) || 0,
            bills: parseFloat(document.getElementById('budget-bills').value) || 0,
            food: parseFloat(document.getElementById('budget-food').value) || 0,
            transport: parseFloat(document.getElementById('budget-transport').value) || 0,
            entertainment: parseFloat(document.getElementById('budget-entertainment').value) || 0,
            health: parseFloat(document.getElementById('budget-health').value) || 0,
            debt: parseFloat(document.getElementById('budget-debt').value) || 0,
            investment: parseFloat(document.getElementById('budget-investment').value) || 0,
            other: parseFloat(document.getElementById('budget-other').value) || 0
        };
        
        // Calculate totals
        const totalExpenses = Object.values(expenses).reduce((a, b) => a + b, 0);
        const savingsAmount = income * (savingsGoal / 100);
        const cashFlow = income - totalExpenses - savingsAmount;
        const actualSavingsRate = (savingsAmount / income) * 100;
        
        // Calculate financial health score
        const healthScore = bpCalculateHealthScore(income, expenses, savingsAmount, cashFlow);
        
        // Calculate financial independence timeline
        const freedomYears = bpCalculateFreedomTimeline(income, expenses, savingsAmount);
        
        // Update results
        bpUpdateResults(healthScore, cashFlow, actualSavingsRate, freedomYears, income, expenses, savingsAmount);
        
        // Generate recommendations
        bpGenerateRecommendations(income, expenses, savingsAmount, cashFlow, healthScore);
        
        // Update charts
        bpUpdateCharts(income, expenses, savingsAmount);
        
        // Show results section
        document.getElementById('bp-results-section').style.display = 'block';
        document.getElementById('bp-chart-section').style.display = 'block';
        
    } catch (error) {
        console.error('Budget calculation error:', error);
    }
}

// Calculate financial health score (0-100)
function bpCalculateHealthScore(income, expenses, savingsAmount, cashFlow) {
    let score = 50; // Start at average
    
    // 1. Savings rate score (30% weight)
    const savingsRate = (savingsAmount / income) * 100;
    if (savingsRate >= 20) score += 30;
    else if (savingsRate >= 15) score += 20;
    else if (savingsRate >= 10) score += 10;
    else if (savingsRate >= 5) score += 5;
    
    // 2. Expense ratio score (25% weight)
    const expenseRatio = (Object.values(expenses).reduce((a, b) => a + b, 0) / income) * 100;
    if (expenseRatio <= 70) score += 25;
    else if (expenseRatio <= 80) score += 15;
    else if (expenseRatio <= 90) score += 5;
    
    // 3. Cash flow score (20% weight)
    if (cashFlow > 0) score += 20;
    else if (cashFlow > -100) score += 10;
    else if (cashFlow > -300) score += 5;
    
    // 4. Debt ratio score (15% weight)
    const debtRatio = (expenses.debt / income) * 100;
    if (debtRatio <= 10) score += 15;
    else if (debtRatio <= 20) score += 10;
    else if (debtRatio <= 30) score += 5;
    
    // 5. Emergency fund coverage (10% weight)
    const monthlyEssentials = expenses.rent + expenses.bills + expenses.food;
    const emergencyMonths = savingsAmount / monthlyEssentials;
    if (emergencyMonths >= 6) score += 10;
    else if (emergencyMonths >= 3) score += 7;
    else if (emergencyMonths >= 1) score += 3;
    
    return Math.min(Math.max(Math.round(score), 0), 100);
}

// Calculate financial independence timeline
function bpCalculateFreedomTimeline(income, expenses, savingsAmount) {
    if (savingsAmount <= 0) return Infinity;
    
    // Rule of 25 for financial independence
    const annualExpenses = Object.values(expenses).reduce((a, b) => a + b, 0) * 12;
    const fiNumber = annualExpenses * 25;
    const annualSavings = savingsAmount * 12;
    
    // Account for compound growth (7% average return)
    const growthRate = 0.07;
    let years = 0;
    let portfolio = 0;
    
    while (portfolio < fiNumber && years < 60) {
        portfolio = (portfolio + annualSavings) * (1 + growthRate);
        years++;
    }
    
    return Math.round(years);
}

// Update results display
function bpUpdateResults(healthScore, cashFlow, savingsRate, freedomYears, income, expenses, savingsAmount) {
    // Update health score
    const healthScoreEl = document.getElementById('bp-health-score');
    healthScoreEl.textContent = `${healthScore}/100`;
    
    // Color code health score
    if (healthScore >= 80) {
        healthScoreEl.style.color = '#39ff14';
        document.getElementById('bp-health-category').textContent = 'Excellent';
        document.getElementById('bp-health-category').style.color = '#39ff14';
    } else if (healthScore >= 60) {
        healthScoreEl.style.color = '#ffcc00';
        document.getElementById('bp-health-category').textContent = 'Good';
        document.getElementById('bp-health-category').style.color = '#ffcc00';
    } else if (healthScore >= 40) {
        healthScoreEl.style.color = '#ffa500';
        document.getElementById('bp-health-category').textContent = 'Fair';
        document.getElementById('bp-health-category').style.color = '#ffa500';
    } else {
        healthScoreEl.style.color = '#ff2d55';
        document.getElementById('bp-health-category').textContent = 'Needs Improvement';
        document.getElementById('bp-health-category').style.color = '#ff2d55';
    }
    
    // Update other metrics
    document.getElementById('bp-cash-flow').textContent = bpFormatCurrency(cashFlow);
    document.getElementById('bp-cash-flow').style.color = cashFlow >= 0 ? '#39ff14' : '#ff2d55';
    
    document.getElementById('bp-savings-rate').textContent = `${savingsRate.toFixed(1)}%`;
    document.getElementById('bp-savings-rate').style.color = savingsRate >= 20 ? '#39ff14' : savingsRate >= 10 ? '#ffcc00' : '#ff2d55';
    
    const freedomEl = document.getElementById('bp-freedom-timeline');
    if (freedomYears >= 60 || freedomYears === Infinity) {
        freedomEl.textContent = 'âˆ years';
        freedomEl.style.color = '#ff2d55';
    } else {
        freedomEl.textContent = `${freedomYears} years`;
        freedomEl.style.color = freedomYears <= 15 ? '#39ff14' : freedomYears <= 30 ? '#ffcc00' : '#ffa500';
    }
    
    // Update category bars
    bpUpdateCategoryBars(income, expenses, savingsAmount);
}

// Update category visualization bars
function bpUpdateCategoryBars(income, expenses, savingsAmount) {
    const categories = {
        'Essentials': expenses.rent + expenses.bills + expenses.food,
        'Lifestyle': expenses.transport + expenses.entertainment + expenses.health,
        'Future & Debt': expenses.debt + expenses.investment + expenses.other,
        'Savings': savingsAmount
    };
    
    const barsContainer = document.getElementById('bp-category-bars');
    let barsHTML = '';
    
    Object.entries(categories).forEach(([category, amount]) => {
        const percentage = (amount / income * 100).toFixed(1);
        const barWidth = Math.min(percentage * 2, 100); // Scale for visualization
        
        // Get color for category
        let color;
        switch(category) {
            case 'Essentials': color = '#39ff14'; break;
            case 'Lifestyle': color = '#2dd4ff'; break;
            case 'Future & Debt': color = '#ffcc00'; break;
            case 'Savings': color = '#9d4edd'; break;
            default: color = '#ffffff';
        }
        
        barsHTML += `
            <div style="margin-bottom:12px;">
                <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                    <span style="color:${color};font-weight:500;">${category}</span>
                    <span style="color:rgba(230,250,255,0.9);">${bpFormatCurrency(amount)} (${percentage}%)</span>
                </div>
                <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
                    <div style="height:100%;width:${barWidth}%;background:${color};border-radius:4px;"></div>
                </div>
            </div>
        `;
    });
    
    barsContainer.innerHTML = barsHTML;
}

// Generate smart recommendations
function bpGenerateRecommendations(income, expenses, savingsAmount, cashFlow, healthScore) {
    const recommendations = [];
    const totalExpenses = Object.values(expenses).reduce((a, b) => a + b, 0);
    
    // Savings recommendations
    if (savingsAmount < income * 0.2) {
        recommendations.push({
            priority: 'high',
            title: 'Increase Savings Rate',
            message: `Try to save at least 20% of your income (${bpFormatCurrency(income * 0.2)}). Current: ${((savingsAmount/income)*100).toFixed(1)}%`,
            action: 'Increase savings goal slider'
        });
    }
    
    // Housing cost check
    if (expenses.rent > income * 0.3) {
        recommendations.push({
            priority: 'high',
            title: 'High Housing Costs',
            message: `Rent (${((expenses.rent/income)*100).toFixed(1)}%) exceeds recommended 30% of income`,
            action: 'Consider downsizing or finding roommates'
        });
    }
    
    // Debt management
    if (expenses.debt > income * 0.15) {
        recommendations.push({
            priority: 'medium',
            title: 'High Debt Payments',
            message: `Debt payments (${((expenses.debt/income)*100).toFixed(1)}%) should be under 15% of income`,
            action: 'Look into debt consolidation or refinancing'
        });
    }
    
    // Positive cash flow
    if (cashFlow > 300) {
        recommendations.push({
            priority: 'low',
            title: 'Strong Cash Flow',
            message: `Great! You have ${bpFormatCurrency(cashFlow)} monthly surplus`,
            action: 'Consider increasing investments or extra debt payments'
        });
    } else if (cashFlow < 0) {
        recommendations.push({
            priority: 'high',
            title: 'Negative Cash Flow',
            message: `You're spending ${bpFormatCurrency(Math.abs(cashFlow))} more than you earn`,
            action: 'Review discretionary spending and reduce expenses'
        });
    }
    
    // Investment opportunity
    if (expenses.investment < income * 0.1) {
        recommendations.push({
            priority: 'medium',
            title: 'Low Investment Rate',
            message: 'Consider investing at least 10% of income for long-term growth',
            action: 'Start with low-cost index funds or retirement accounts'
        });
    }
    
    // Sort by priority and display
    recommendations.sort((a, b) => {
        const priorityOrder = { high: 0, medium: 1, low: 2 };
        return priorityOrder[a.priority] - priorityOrder[b.priority];
    });
    
    const recContent = document.getElementById('bp-rec-content');
    const recSection = document.getElementById('bp-recommendations');
    
    if (recommendations.length > 0) {
        let recHTML = '<div style="display:flex;flex-direction:column;gap:12px;">';
        
        recommendations.forEach(rec => {
            const priorityColor = rec.priority === 'high' ? '#ff2d55' : 
                                rec.priority === 'medium' ? '#ffcc00' : '#39ff14';
            
            recHTML += `
                <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:4px solid ${priorityColor};">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                        <div style="color:${priorityColor};font-weight:600;">${rec.title}</div>
                        <div style="padding:2px 8px;background:${priorityColor}20;color:${priorityColor};border-radius:10px;font-size:0.8rem;">
                            ${rec.priority.toUpperCase()}
                        </div>
                    </div>
                    <div style="color:rgba(230,250,255,0.9);font-size:0.9rem;margin-bottom:6px;">${rec.message}</div>
                    <div style="color:var(--accent);font-size:0.85rem;">ğŸ’¡ ${rec.action}</div>
                </div>
            `;
        });
        
        recHTML += '</div>';
        recContent.innerHTML = recHTML;
        recSection.style.display = 'block';
    }
}

// Update charts
function bpUpdateCharts(income, expenses, savingsAmount) {
    // Pie chart for expense distribution
    const pieCtx = document.getElementById('bp-pie-chart').getContext('2d');
    const pieData = {
        labels: ['Rent', 'Bills', 'Food', 'Transport', 'Entertainment', 'Health', 'Debt', 'Investment', 'Other', 'Savings'],
        datasets: [{
            data: [
                expenses.rent,
                expenses.bills,
                expenses.food,
                expenses.transport,
                expenses.entertainment,
                expenses.health,
                expenses.debt,
                expenses.investment,
                expenses.other,
                savingsAmount
            ],
            backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#28a745'
            ]
        }]
    };
    
    // Destroy existing chart if it exists
    if (window.bpPieChart) {
        window.bpPieChart.destroy();
    }
    
    window.bpPieChart = new Chart(pieCtx, {
        type: 'pie',
        data: pieData,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'right' },
                tooltip: {
                    callbacks: {
                        label: (context) => {
                            const value = context.raw;
                            const percentage = ((value / income) * 100).toFixed(1);
                            return `${context.label}: ${bpFormatCurrency(value)} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
    
    // Cash flow projection chart
    const flowCtx = document.getElementById('bp-cash-flow-chart').getContext('2d');
    const months = ['Now', '3mo', '6mo', '1yr', '2yr'];
    const cashFlowData = [];
    let currentSavings = savingsAmount;
    
    for (let i = 0; i < 5; i++) {
        if (i > 0) currentSavings *= 1.07; // 7% annual growth assumption
        cashFlowData.push(currentSavings * (i + 1));
    }
    
    // Destroy existing chart if it exists
    if (window.bpFlowChart) {
        window.bpFlowChart.destroy();
    }
    
    window.bpFlowChart = new Chart(flowCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Savings Growth',
                data: cashFlowData,
                borderColor: '#39ff14',
                backgroundColor: 'rgba(57, 255, 20, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: (context) => `Savings: ${bpFormatCurrency(context.raw)}`
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: value => bpFormatCurrency(value)
                    }
                }
            }
        }
    });
}

// Auto-optimize budget
function bpOptimizeBudget() {
    const income = parseFloat(document.getElementById('budget-income').value) || 3000;
    
    // Set optimal values based on 50/30/20 rule
    const optimal = {
        rent: income * 0.3,           // 30% for housing
        bills: income * 0.1,          // 10% for utilities
        food: income * 0.15,          // 15% for food
        transport: income * 0.05,     // 5% for transport
        entertainment: income * 0.05, // 5% for entertainment
        health: income * 0.03,        // 3% for health
        debt: income * 0.07,          // 7% for debt
        investment: income * 0.1,     // 10% for investments
        other: income * 0.05          // 5% misc
    };
    
    // Apply optimal values
    Object.keys(optimal).forEach(key => {
        const input = document.getElementById(`budget-${key}`);
        if (input) {
            input.value = Math.round(optimal[key]);
        }
    });
    
    // Set savings to 20%
    document.getElementById('budget-savings').value = 20;
    bpUpdateSavingsDisplay(20);
    
    // Recalculate
    bpUpdatePercentages();
    bpCalculate();
    
    alert('âœ… Budget optimized using the 50/30/20 rule!');
}

// Generate action plan
function bpGeneratePlan() {
    const income = parseFloat(document.getElementById('budget-income').value) || 0;
    const savingsGoal = parseFloat(document.getElementById('budget-savings').value) || 0;
    const selectedGoal = document.querySelector('input[name="financial-goal"]:checked').value;
    
    let planHTML = `
        <div style="margin-bottom:16px;">
            <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ğŸ“‹ Your Financial Action Plan</div>
            <div style="color:rgba(230,250,255,0.9);font-size:0.9rem;">
                Based on ${bpFormatCurrency(income)} monthly income and ${savingsGoal}% savings goal
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:16px;">
    `;
    
    // Week 1: Foundation
    planHTML += `
        <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;">
            <div style="color:#39ff14;font-weight:600;margin-bottom:8px;">ğŸ“… Week 1-2: Foundation</div>
            <ul style="margin:0;padding-left:16px;font-size:0.9rem;color:rgba(230,250,255,0.9);">
                <li>Set up automatic savings transfer</li>
                <li>Cancel 1 unnecessary subscription</li>
                <li>Review and optimize utility bills</li>
                <li>Create emergency fund category</li>
            </ul>
        </div>
    `;
    
    // Month 1: Optimization
    planHTML += `
        <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;">
            <div style="color:#ffcc00;font-weight:600;margin-bottom:8px;">ğŸ“… Month 1: Optimization</div>
            <ul style="margin:0;padding-left:16px;font-size:0.9rem;color:rgba(230,250,255,0.9);">
                <li>Meal plan to reduce food costs by 15%</li>
                <li>Review insurance policies for better rates</li>
                <li>Start tracking every expense for 30 days</li>
                <li>Set up debt snowball/avalanche plan</li>
            </ul>
        </div>
    `;
    
    // Quarter 1: Growth
    planHTML += `
        <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;">
            <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;">ğŸ“… Quarter 1: Growth</div>
            <ul style="margin:0;padding-left:16px;font-size:0.9rem;color:rgba(230,250,255,0.9);">
                <li>Open investment account with $100</li>
                <li>Increase income through side hustle</li>
                <li>Build 3-month emergency fund</li>
                <li>Review and rebalance budget</li>
            </ul>
        </div>
    `;
    
    // Goal-specific actions
    planHTML += `
        <div style="padding:12px;background:rgba(157,78,221,0.05);border-radius:8px;">
            <div style="color:#2dd4ff;font-weight:600;margin-bottom:8px;">ğŸ¯ ${selectedGoal.charAt(0).toUpperCase() + selectedGoal.slice(1)} Focus</div>
            <ul style="margin:0;padding-left:16px;font-size:0.9rem;color:rgba(230,250,255,0.9);">
    `;
    
    switch(selectedGoal) {
        case 'emergency':
            planHTML += `
                <li>Save $1,000 in 30 days</li>
                <li>Open high-yield savings account</li>
                <li>Reduce expenses by 10%</li>
                <li>Create emergency budget plan</li>
            `;
            break;
        case 'debt':
            planHTML += `
                <li>List all debts smallest to largest</li>
                <li>Apply extra $${Math.round(income * 0.05)}/month to smallest debt</li>
                <li>Contact creditors for lower rates</li>
                <li>Celebrate each debt paid off</li>
            `;
            break;
        case 'investment':
            planHTML += `
                <li>Open Roth IRA or 401k</li>
                <li>Start with low-cost index funds</li>
                <li>Automate monthly contributions</li>
                <li>Learn about compound interest</li>
            `;
            break;
        case 'retirement':
            planHTML += `
                <li>Calculate retirement number</li>
                <li>Maximize employer match</li>
                <li>Increase contribution by 1% each month</li>
                <li>Diversify investment portfolio</li>
            `;
            break;
    }
    
    planHTML += `
            </ul>
        </div>
    </div>
    
    <div style="margin-top:16px;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ğŸ“Š Expected Progress</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;font-size:0.9rem;">
            <div>
                <div style="color:#39ff14;">30 Days</div>
                <div style="color:rgba(230,250,255,0.9);">${bpFormatCurrency(savingsGoal * income / 100 * 1)} saved</div>
            </div>
            <div>
                <div style="color:#2dd4ff;">90 Days</div>
                <div style="color:rgba(230,250,255,0.9);">${bpFormatCurrency(savingsGoal * income / 100 * 3)} saved</div>
            </div>
            <div>
                <div style="color:#ffcc00;">1 Year</div>
                <div style="color:rgba(230,250,255,0.9);">${bpFormatCurrency(savingsGoal * income / 100 * 12)} saved</div>
            </div>
            <div>
                <div style="color:#9d4edd;">5 Years</div>
                <div style="color:rgba(230,250,255,0.9);">${bpFormatCurrency(savingsGoal * income / 100 * 12 * 5 * 1.4)}* with growth</div>
            </div>
        </div>
        <div style="margin-top:8px;font-size:0.8rem;color:rgba(230,250,255,0.7);">
            *Assumes 7% annual investment return
        </div>
    </div>
    `;
    
    // Show in recommendations section
    document.getElementById('bp-rec-content').innerHTML = planHTML;
    document.getElementById('bp-recommendations').style.display = 'block';
    
    // Scroll to recommendations
    document.getElementById('bp-recommendations').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'nearest' 
    });
}

// Adjust input values
function bpAdjustValue(field, amount) {
    const input = document.getElementById(field);
    if (input) {
        let value = parseFloat(input.value) + amount;
        const min = parseFloat(input.min) || 0;
        const max = parseFloat(input.max) || Infinity;
        value = Math.max(min, Math.min(max, value));
        input.value = value;
        bpUpdatePercentages();
        bpCalculate();
    }
}

// Save budget
function bpSaveBudget() {
    const budgetData = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        income: document.getElementById('budget-income').value,
        savingsGoal: document.getElementById('budget-savings').value,
        expenses: {
            rent: document.getElementById('budget-rent').value,
            bills: document.getElementById('budget-bills').value,
            food: document.getElementById('budget-food').value,
            transport: document.getElementById('budget-transport').value,
            entertainment: document.getElementById('budget-entertainment').value,
            health: document.getElementById('budget-health').value,
            debt: document.getElementById('budget-debt').value,
            investment: document.getElementById('budget-investment').value,
            other: document.getElementById('budget-other').value
        }
    };
    
    // Save to localStorage
    const savedBudgets = JSON.parse(localStorage.getItem('bp-saved-budgets') || '[]');
    savedBudgets.push(budgetData);
    
    // Keep only last 5 budgets
    if (savedBudgets.length > 5) {
        savedBudgets.shift();
    }
    
    localStorage.setItem('bp-saved-budgets', JSON.stringify(savedBudgets));
    
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'âœ… Saved!';
    setTimeout(() => {
        button.textContent = originalText;
    }, 2000);
}

// Export report
function bpExportReport() {
    const income = document.getElementById('budget-income').value;
    const savingsRate = document.getElementById('bp-savings-rate').textContent;
    const cashFlow = document.getElementById('bp-cash-flow').textContent;
    const healthScore = document.getElementById('bp-health-score').textContent;
    
    const report = `
FINANCIAL WELLNESS REPORT
=========================

ğŸ“Š FINANCIAL SNAPSHOT
â€¢ Monthly Income: ${bpFormatCurrency(parseFloat(income))}
â€¢ Savings Rate: ${savingsRate}
â€¢ Monthly Cash Flow: ${cashFlow}
â€¢ Financial Health Score: ${healthScore}

ğŸ  EXPENSE BREAKDOWN
â€¢ Rent/Mortgage: ${bpFormatCurrency(parseFloat(document.getElementById('budget-rent').value))}
â€¢ Bills & Utilities: ${bpFormatCurrency(parseFloat(document.getElementById('budget-bills').value))}
â€¢ Food & Groceries: ${bpFormatCurrency(parseFloat(document.getElementById('budget-food').value))}
â€¢ Transport: ${bpFormatCurrency(parseFloat(document.getElementById('budget-transport').value))}
â€¢ Entertainment: ${bpFormatCurrency(parseFloat(document.getElementById('budget-entertainment').value))}
â€¢ Health & Wellness: ${bpFormatCurrency(parseFloat(document.getElementById('budget-health').value))}
â€¢ Debt Payments: ${bpFormatCurrency(parseFloat(document.getElementById('budget-debt').value))}
â€¢ Investments: ${bpFormatCurrency(parseFloat(document.getElementById('budget-investment').value))}

ğŸ¯ RECOMMENDATIONS
â€¢ Savings Goal: ${document.getElementById('budget-savings').value}% of income
â€¢ Primary Goal: ${document.querySelector('input[name="financial-goal"]:checked').value}
â€¢ Freedom Timeline: ${document.getElementById('bp-freedom-timeline').textContent}

Generated by The Most Useful Site in the World - Financial Wellness Dashboard
    `.trim();
    
    // Create download
    const blob = new Blob([report], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'financial-wellness-report.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Reset all inputs
function bpReset() {
    if (confirm('Reset all values to defaults?')) {
        document.getElementById('budget-income').value = 3000;
        document.getElementById('budget-savings').value = 20;
        document.getElementById('budget-rent').value = 1000;
        document.getElementById('budget-bills').value = 300;
        document.getElementById('budget-food').value = 400;
        document.getElementById('budget-transport').value = 200;
        document.getElementById('budget-entertainment').value = 150;
        document.getElementById('budget-health').value = 100;
        document.getElementById('budget-debt').value = 150;
        document.getElementById('budget-investment').value = 0;
        document.getElementById('budget-other').value = 300;
        
        document.querySelector('input[name="financial-goal"][value="emergency"]').checked = true;
        
        bpUpdatePercentages();
        bpCalculate();
    }
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', bpInitialize);
} else {
    bpInitialize();
}

// Load Chart.js if needed
if (typeof Chart === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
    script.onload = bpInitialize;
    document.head.appendChild(script);
}
</script>
</div>
