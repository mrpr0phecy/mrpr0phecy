<!-- 
===========================================
FILE: cards/statistics-calculator.html
RULE: Sacred Tool Template structure
===========================================
-->

<!-- ===== 1. TITLE & DESCRIPTION ===== -->
<h2 id="tt-title">üìä Statistics Calculator</h2>
<p id="tt-desc" class="small">
    Comprehensive statistical analysis tool with descriptive statistics, probability distributions, hypothesis testing, and data visualization.
    <em>This tool is supported by 
        <a href="#contributionsPanel" onclick="showContributionsPanel()">
            user contributions
        </a>.
    </em>
</p>

<!-- ===== 2. MAIN CONTENT AREA ===== -->
<div class="glass glass-lg" style="border-radius:var(--radius-lg);padding:var(--space-lg);margin-bottom:var(--space-lg);">

    <!-- Data Input Section -->
    <div style="margin-bottom:var(--space-xl);">
        <h3 style="font-size:var(--text-sm);font-weight:var(--weight-semibold);color:var(--text-secondary);margin-bottom:var(--space-md);">
            üì• Data Input
        </h3>
        
        <div class="glass glass-md" style="border-radius:var(--radius-md);padding:var(--space-md);margin-bottom:var(--space-lg);">
            <div style="display:grid;grid-template-columns:1fr auto;gap:var(--space-sm);margin-bottom:var(--space-sm);">
                <textarea id="tt-data-input" 
                    placeholder="Enter numbers separated by commas, spaces, or new lines:
Example: 12, 15, 18, 21, 24
Or: 12 15 18 21 24
Or: 12
15
18
21
24"
                    class="glass glass-dark"
                    style="width:100%;min-height:120px;padding:var(--space-md);border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);font-family:var(--font-mono);resize:vertical;"></textarea>
                
                <div style="display:flex;flex-direction:column;gap:var(--space-sm);">
                    <button onclick="ttParseData()" class="btn btn-primary" style="white-space:nowrap;">
                        üìä Analyze
                    </button>
                    <button onclick="ttClearData()" class="btn btn-secondary" style="white-space:nowrap;">
                        üóëÔ∏è Clear
                    </button>
                    <button onclick="ttGenerateRandomData()" class="btn btn-secondary" style="white-space:nowrap;">
                        üé≤ Random
                    </button>
                </div>
            </div>
            
            <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);margin-top:var(--space-sm);">
                <button onclick="ttLoadExample('normal')" class="btn btn-secondary btn-sm">
                    üìà Normal Dist.
                </button>
                <button onclick="ttLoadExample('uniform')" class="btn btn-secondary btn-sm">
                    üìä Uniform Dist.
                </button>
                <button onclick="ttLoadExample('skewed')" class="btn btn-secondary btn-sm">
                    ‚Ü™Ô∏è Skewed Data
                </button>
                <button onclick="ttLoadExample('outliers')" class="btn btn-secondary btn-sm">
                    ‚ö†Ô∏è With Outliers
                </button>
                <button onclick="ttLoadExample('small')" class="btn btn-secondary btn-sm">
                    üî¨ Small Sample
                </button>
            </div>
        </div>
        
        <!-- Data Stats Preview -->
        <div id="tt-data-preview" style="display:none;">
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:var(--space-sm);margin-bottom:var(--space-lg);">
                <div class="glass glass-sm" style="padding:var(--space-sm);border-radius:var(--radius-sm);text-align:center;">
                    <div class="small" style="color:var(--text-tertiary);">Count (n)</div>
                    <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:var(--accent);" id="tt-count">0</div>
                </div>
                <div class="glass glass-sm" style="padding:var(--space-sm);border-radius:var(--radius-sm);text-align:center;">
                    <div class="small" style="color:var(--text-tertiary);">Sum</div>
                    <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:var(--text);" id="tt-sum">0</div>
                </div>
                <div class="glass glass-sm" style="padding:var(--space-sm);border-radius:var(--radius-sm);text-align:center;">
                    <div class="small" style="color:var(--text-tertiary);">Min</div>
                    <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:#4caf50;" id="tt-min">0</div>
                </div>
                <div class="glass glass-sm" style="padding:var(--space-sm);border-radius:var(--radius-sm);text-align:center;">
                    <div class="small" style="color:var(--text-tertiary);">Max</div>
                    <div style="font-size:var(--text-lg);font-weight:var(--weight-bold);color:#f44336;" id="tt-max">0</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tab Navigation -->
    <div class="tab-navigation" style="margin-bottom:var(--space-lg);">
        <div class="tab-buttons glass glass-md" style="display:grid;grid-template-columns:repeat(5, 1fr);border-radius:var(--radius-md) var(--radius-md) 0 0;overflow:hidden;">
            <button class="tab-button active" onclick="ttShowTab('descriptive')">
                üìã Descriptive
            </button>
            <button class="tab-button" onclick="ttShowTab('distributions')">
                üìà Distributions
            </button>
            <button class="tab-button" onclick="ttShowTab('testing')">
                üß™ Testing
            </button>
            <button class="tab-button" onclick="ttShowTab('regression')">
                üìê Regression
            </button>
            <button class="tab-button" onclick="ttShowTab('visualization')">
                üìä Visualize
            </button>
        </div>
        
        <!-- Tab Content Container -->
        <div id="tt-tab-content" class="glass glass-dark" style="border-radius:0 0 var(--radius-md) var(--radius-md);padding:var(--space-xl);min-height:400px;">
            <!-- Content will be loaded here -->
            <div id="tt-descriptive" class="tab-content active">
                <div style="text-align:center;color:var(--text-tertiary);">
                    <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üìä</div>
                    <div>Enter data above to see descriptive statistics</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== 3. SHARING & INFO ===== -->
<div style="margin-top:var(--space-xl);">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-sm);margin-bottom:var(--space-lg);">
        <button onclick="ttShareResults()" class="btn btn-secondary">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üì§ Share Results
            </span>
        </button>
        <button onclick="ttEmbedTool()" class="btn btn-secondary">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üîó Embed Tool
            </span>
        </button>
    </div>
    
    <details class="glass glass-md" style="border-radius:var(--radius-md);overflow:hidden;">
        <summary style="cursor:pointer;padding:var(--space-md);color:var(--text-secondary);font-weight:var(--weight-semibold);list-style:none;display:flex;align-items:center;justify-content:space-between;">
            <span style="display:inline-flex;align-items:center;gap:var(--space-xs);">
                üìö Statistical Methods & Formulas
            </span>
            <span style="font-size:0.9em;">‚ñº</span>
        </summary>
        <div style="padding:var(--space-md);border-top:1px solid var(--border-light);">
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:var(--space-lg);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-sm);font-size:var(--text-sm);">Descriptive Statistics</h4>
                    <ul style="margin:0;padding-left:0;">
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Mean:</strong> Œ£x / n
                            </span>
                        </li>
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Variance:</strong> Œ£(x - Œº)¬≤ / (n-1)
                            </span>
                        </li>
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Skewness:</strong> (n/((n-1)(n-2))) Œ£((x-Œº)/œÉ)¬≥
                            </span>
                        </li>
                        <li>
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Kurtosis:</strong> (n(n+1)/((n-1)(n-2)(n-3))) Œ£((x-Œº)/œÉ)‚Å¥ - (3(n-1)¬≤/((n-2)(n-3)))
                            </span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-sm);font-size:var(--text-sm);">Distributions</h4>
                    <ul style="margin:0;padding-left:0;">
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Normal:</strong> (1/œÉ‚àö(2œÄ)) e^(-(x-Œº)¬≤/(2œÉ¬≤))
                            </span>
                        </li>
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Binomial:</strong> C(n,k) p^k (1-p)^(n-k)
                            </span>
                        </li>
                        <li style="margin-bottom:var(--space-xs);">
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Poisson:</strong> (Œª^k e^-Œª) / k!
                            </span>
                        </li>
                        <li>
                            <span class="small" style="color:var(--text-secondary);">
                                <strong>Exponential:</strong> Œª e^(-Œªx)
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </details>
</div>

<!-- ===== 4. JAVASCRIPT ===== -->
<script>
// TOOL-SPECIFIC FUNCTIONS
const ttState = {
    currentTab: 'descriptive',
    data: [],
    stats: null,
    
    // Example datasets
    examples: {
        normal: [12.3, 14.1, 15.8, 16.2, 17.5, 18.1, 18.9, 19.2, 20.1, 20.5, 21.3, 22.0],
        uniform: [10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32],
        skewed: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 30, 35, 40],
        outliers: [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 100],
        small: [45, 52, 48, 55, 50]
    }
};

// Data parsing and validation
function ttParseData() {
    const input = document.getElementById('tt-data-input').value;
    
    // Parse numbers from various formats
    const numbers = input
        .replace(/[^\d\s.,\-]/g, ' ') // Remove non-numeric characters except spaces, dots, commas, hyphens
        .split(/[\s,]+/) // Split by spaces or commas
        .map(str => str.trim())
        .filter(str => str !== '')
        .map(str => parseFloat(str))
        .filter(num => !isNaN(num));
    
    if (numbers.length === 0) {
        showNotification('Please enter valid numbers', 'error');
        return;
    }
    
    if (numbers.length < 2) {
        showNotification('Enter at least 2 numbers for statistical analysis', 'warning');
    }
    
    ttState.data = numbers;
    ttCalculateStatistics();
    ttShowTab('descriptive');
    
    showNotification(`Analyzed ${numbers.length} data points`, 'success');
}

function ttCalculateStatistics() {
    const data = ttState.data;
    const n = data.length;
    
    if (n === 0) return;
    
    // Basic calculations
    const sum = data.reduce((a, b) => a + b, 0);
    const mean = sum / n;
    const sorted = [...data].sort((a, b) => a - b);
    const min = sorted[0];
    const max = sorted[n - 1];
    const range = max - min;
    
    // Median
    const mid = Math.floor(n / 2);
    const median = n % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
    
    // Variance and Standard Deviation
    const variance = data.reduce((sum, x) => sum + Math.pow(x - mean, 2), 0) / (n - 1);
    const stdDev = Math.sqrt(variance);
    
    // Quartiles
    const q1 = ttCalculatePercentile(sorted, 25);
    const q3 = ttCalculatePercentile(sorted, 75);
    const iqr = q3 - q1;
    
    // Skewness
    const skewness = ttCalculateSkewness(data, mean, stdDev, n);
    
    // Kurtosis
    const kurtosis = ttCalculateKurtosis(data, mean, stdDev, n);
    
    // Mode (simplified - most frequent value)
    const mode = ttCalculateMode(data);
    
    // Store results
    ttState.stats = {
        n, sum, mean, median, min, max, range,
        variance, stdDev, q1, q3, iqr,
        skewness, kurtosis, mode
    };
    
    // Update preview
    updateDataPreview();
    
    // Update tab content
    updateTabContent();
}

function ttCalculatePercentile(sorted, percentile) {
    const index = (percentile / 100) * (sorted.length - 1);
    const lower = Math.floor(index);
    const upper = Math.ceil(index);
    
    if (lower === upper) return sorted[lower];
    
    const weight = index - lower;
    return sorted[lower] * (1 - weight) + sorted[upper] * weight;
}

function ttCalculateSkewness(data, mean, stdDev, n) {
    if (stdDev === 0) return 0;
    
    const m3 = data.reduce((sum, x) => sum + Math.pow(x - mean, 3), 0) / n;
    return (m3 / Math.pow(stdDev, 3)) * (Math.sqrt(n * (n - 1)) / (n - 2));
}

function ttCalculateKurtosis(data, mean, stdDev, n) {
    if (stdDev === 0) return 0;
    
    const m4 = data.reduce((sum, x) => sum + Math.pow(x - mean, 4), 0) / n;
    const kurt = m4 / Math.pow(stdDev, 4);
    
    // Excess kurtosis (subtract 3 for normal distribution)
    return kurt - 3;
}

function ttCalculateMode(data) {
    const frequency = {};
    let maxFreq = 0;
    let modes = [];
    
    data.forEach(num => {
        frequency[num] = (frequency[num] || 0) + 1;
        if (frequency[num] > maxFreq) {
            maxFreq = frequency[num];
            modes = [num];
        } else if (frequency[num] === maxFreq) {
            modes.push(num);
        }
    });
    
    return modes.length === data.length ? 'No mode (all values unique)' : 
           modes.length > 5 ? 'Multiple modes' : modes.join(', ');
}

function updateDataPreview() {
    const stats = ttState.stats;
    if (!stats) return;
    
    document.getElementById('tt-data-preview').style.display = 'block';
    document.getElementById('tt-count').textContent = stats.n;
    document.getElementById('tt-sum').textContent = stats.sum.toFixed(2);
    document.getElementById('tt-min').textContent = stats.min.toFixed(2);
    document.getElementById('tt-max').textContent = stats.max.toFixed(2);
}

function updateTabContent() {
    const tabId = ttState.currentTab;
    const container = document.getElementById('tt-tab-content');
    
    switch(tabId) {
        case 'descriptive':
            container.innerHTML = getDescriptiveTab();
            break;
        case 'distributions':
            container.innerHTML = getDistributionsTab();
            break;
        case 'testing':
            container.innerHTML = getTestingTab();
            break;
        case 'regression':
            container.innerHTML = getRegressionTab();
            break;
        case 'visualization':
            container.innerHTML = getVisualizationTab();
            break;
    }
}

// Tab management
function ttShowTab(tabId) {
    ttState.currentTab = tabId;
    
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    updateTabContent();
}

// Tab content generators
function getDescriptiveTab() {
    const stats = ttState.stats;
    if (!stats) {
        return `
            <div style="text-align:center;color:var(--text-tertiary);">
                <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üìä</div>
                <div>Enter data above to see descriptive statistics</div>
            </div>
        `;
    }
    
    return `
        <div>
            <h3 style="color:var(--text-secondary);margin-bottom:var(--space-lg);">Descriptive Statistics</h3>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:var(--space-lg);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Central Tendency</h4>
                    <div style="display:grid;gap:var(--space-sm);">
                        <div class="stat-item">
                            <span class="stat-label">Mean (Œº)</span>
                            <span class="stat-value">${stats.mean.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Median</span>
                            <span class="stat-value">${stats.median.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Mode</span>
                            <span class="stat-value">${stats.mode}</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Dispersion</h4>
                    <div style="display:grid;gap:var(--space-sm);">
                        <div class="stat-item">
                            <span class="stat-label">Variance (s¬≤)</span>
                            <span class="stat-value">${stats.variance.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Std Dev (œÉ)</span>
                            <span class="stat-value">${stats.stdDev.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Range</span>
                            <span class="stat-value">${stats.range.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">IQR</span>
                            <span class="stat-value">${stats.iqr.toFixed(4)}</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Shape</h4>
                    <div style="display:grid;gap:var(--space-sm);">
                        <div class="stat-item">
                            <span class="stat-label">Skewness</span>
                            <span class="stat-value" style="color:${Math.abs(stats.skewness) > 1 ? '#ff9800' : '#4caf50'}">
                                ${stats.skewness.toFixed(4)}
                                ${Math.abs(stats.skewness) > 1 ? ' (Skewed)' : ' (Symmetric)'}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Kurtosis</span>
                            <span class="stat-value" style="color:${Math.abs(stats.kurtosis) > 1 ? '#ff9800' : '#4caf50'}">
                                ${stats.kurtosis.toFixed(4)}
                                ${stats.kurtosis > 1 ? ' (Heavy-tailed)' : stats.kurtosis < -1 ? ' (Light-tailed)' : ' (Normal)'}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Q1 (25%)</span>
                            <span class="stat-value">${stats.q1.toFixed(4)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Q3 (75%)</span>
                            <span class="stat-value">${stats.q3.toFixed(4)}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:var(--space-xl);">
                <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Five-Number Summary</h4>
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div class="summary-item" style="color:#f44336;">
                            <div class="small">Min</div>
                            <div style="font-weight:var(--weight-bold);">${stats.min.toFixed(4)}</div>
                        </div>
                        <div class="summary-item" style="color:#ff9800;">
                            <div class="small">Q1</div>
                            <div style="font-weight:var(--weight-bold);">${stats.q1.toFixed(4)}</div>
                        </div>
                        <div class="summary-item" style="color:var(--accent);">
                            <div class="small">Median</div>
                            <div style="font-weight:var(--weight-bold);">${stats.median.toFixed(4)}</div>
                        </div>
                        <div class="summary-item" style="color:#4caf50;">
                            <div class="small">Q3</div>
                            <div style="font-weight:var(--weight-bold);">${stats.q3.toFixed(4)}</div>
                        </div>
                        <div class="summary-item" style="color:#2196f3;">
                            <div class="small">Max</div>
                            <div style="font-weight:var(--weight-bold);">${stats.max.toFixed(4)}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function getDistributionsTab() {
    const stats = ttState.stats;
    if (!stats) {
        return `
            <div style="text-align:center;color:var(--text-tertiary);">
                <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üìà</div>
                <div>Enter data to analyze probability distributions</div>
            </div>
        `;
    }
    
    return `
        <div>
            <h3 style="color:var(--text-secondary);margin-bottom:var(--space-lg);">Probability Distributions</h3>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:var(--space-lg);margin-bottom:var(--space-lg);">
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Normal Distribution</h4>
                    <div class="distribution-info">
                        <div>N(${stats.mean.toFixed(2)}, ${stats.stdDev.toFixed(2)}¬≤)</div>
                        <div class="small" style="color:var(--text-secondary);margin-top:var(--space-xs);">
                            68% within ¬±${stats.stdDev.toFixed(2)}<br>
                            95% within ¬±${(2*stats.stdDev).toFixed(2)}<br>
                            99.7% within ¬±${(3*stats.stdDev).toFixed(2)}
                        </div>
                    </div>
                </div>
                
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Distribution Fit</h4>
                    <div class="distribution-info">
                        ${ttGetDistributionFit()}
                    </div>
                </div>
                
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Probability Calculator</h4>
                    <div style="display:grid;gap:var(--space-sm);">
                        <div style="display:grid;grid-template-columns:1fr auto;gap:var(--space-sm);">
                            <input type="number" id="tt-prob-x" placeholder="Value" class="glass glass-dark small-input" value="${stats.mean.toFixed(2)}">
                            <button onclick="ttCalculateProbability()" class="btn btn-secondary btn-sm">
                                Calculate
                            </button>
                        </div>
                        <div id="tt-prob-result" class="small" style="color:var(--text-secondary);">
                            Enter a value to calculate probability
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="tt-distribution-chart" style="height:200px;background:rgba(255,255,255,0.03);border-radius:var(--radius-md);margin-top:var(--space-lg);display:flex;align-items:flex-end;padding:var(--space-md);gap:2px;">
                <!-- Histogram bars will be inserted here -->
                <div style="text-align:center;color:var(--text-tertiary);flex:1;">
                    Histogram visualization
                </div>
            </div>
        </div>
    `;
}

function ttGetDistributionFit() {
    const stats = ttState.stats;
    if (!stats) return '';
    
    const skew = Math.abs(stats.skewness);
    const kurt = Math.abs(stats.kurtosis);
    
    if (skew < 0.5 && kurt < 0.5) {
        return '<div style="color:#4caf50;">‚úì Good fit with Normal distribution</div>';
    } else if (skew > 1) {
        return '<div style="color:#ff9800;">‚Ü™Ô∏è Consider log-normal or skewed distribution</div>';
    } else if (kurt > 1) {
        return '<div style="color:#ff9800;">üìà Heavy-tailed distribution</div>';
    }
    
    return '<div style="color:var(--text-secondary);">Distribution requires further analysis</div>';
}

function ttCalculateProbability() {
    const x = parseFloat(document.getElementById('tt-prob-x').value);
    const stats = ttState.stats;
    
    if (isNaN(x) || !stats) return;
    
    // Calculate z-score
    const z = (x - stats.mean) / stats.stdDev;
    
    // Approximate CDF using error function
    const probability = 0.5 * (1 + ttErf(z / Math.sqrt(2)));
    const percentile = probability * 100;
    
    let interpretation = '';
    if (percentile < 5) interpretation = 'Very low probability';
    else if (percentile < 25) interpretation = 'Low probability';
    else if (percentile < 75) interpretation = 'Moderate probability';
    else if (percentile < 95) interpretation = 'High probability';
    else interpretation = 'Very high probability';
    
    document.getElementById('tt-prob-result').innerHTML = `
        <div>P(X ‚â§ ${x.toFixed(2)}) = ${probability.toFixed(4)}</div>
        <div>Z-score: ${z.toFixed(2)}</div>
        <div>Percentile: ${percentile.toFixed(1)}% (${interpretation})</div>
    `;
}

// Error function approximation
function ttErf(x) {
    // Abramowitz and Stegun approximation
    const a1 = 0.254829592;
    const a2 = -0.284496736;
    const a3 = 1.421413741;
    const a4 = -1.453152027;
    const a5 = 1.061405429;
    const p = 0.3275911;
    
    const sign = x < 0 ? -1 : 1;
    x = Math.abs(x);
    
    const t = 1.0 / (1.0 + p * x);
    const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
    
    return sign * y;
}

function getTestingTab() {
    return `
        <div>
            <h3 style="color:var(--text-secondary);margin-bottom:var(--space-lg);">Hypothesis Testing</h3>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:var(--space-xl);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">One-Sample T-Test</h4>
                    <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                        <div style="display:grid;gap:var(--space-sm);">
                            <div>
                                <label class="small" style="color:var(--text-secondary);">Test Mean (Œº‚ÇÄ)</label>
                                <input type="number" id="tt-test-mean" value="0" class="glass glass-dark small-input">
                            </div>
                            <div>
                                <label class="small" style="color:var(--text-secondary);">Significance Level (Œ±)</label>
                                <select id="tt-alpha" class="glass glass-dark small-input">
                                    <option value="0.01">0.01 (99% confidence)</option>
                                    <option value="0.05" selected>0.05 (95% confidence)</option>
                                    <option value="0.10">0.10 (90% confidence)</option>
                                </select>
                            </div>
                            <button onclick="ttRunTTest()" class="btn btn-secondary">
                                Run T-Test
                            </button>
                        </div>
                        <div id="tt-test-results" class="small" style="color:var(--text-secondary);margin-top:var(--space-md);">
                                    </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Test Types</h4>
                    <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                        <div style="display:grid;gap:var(--space-sm);">
                            <div class="test-type" onclick="ttSelectTest('one-tailed')">
                                <div style="font-weight:var(--weight-semibold);">One-Tailed Test</div>
                                <div class="small" style="color:var(--text-secondary);">
                                    Tests if mean is greater or less than Œº‚ÇÄ
                                </div>
                            </div>
                            <div class="test-type active" onclick="ttSelectTest('two-tailed')">
                                <div style="font-weight:var(--weight-semibold);">Two-Tailed Test</div>
                                <div class="small" style="color:var(--text-secondary);">
                                    Tests if mean is different from Œº‚ÇÄ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:var(--space-xl);">
                <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Interpretation Guide</h4>
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:var(--space-md);">
                        <div>
                            <div style="color:#4caf50;font-weight:var(--weight-semibold);">p > 0.05</div>
                            <div class="small" style="color:var(--text-secondary);">
                                Fail to reject H‚ÇÄ<br>No significant difference
                            </div>
                        </div>
                        <div>
                            <div style="color:#ff9800;font-weight:var(--weight-semibold);">0.01 < p ‚â§ 0.05</div>
                            <div class="small" style="color:var(--text-secondary);">
                                Significant at Œ±=0.05<br>Weak evidence
                            </div>
                        </div>
                        <div>
                            <div style="color:#f44336;font-weight:var(--weight-semibold);">p ‚â§ 0.01</div>
                            <div class="small" style="color:var(--text-secondary);">
                                Highly significant<br>Strong evidence
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function ttRunTTest() {
    const stats = ttState.stats;
    if (!stats || stats.n < 2) {
        showNotification('Need at least 2 data points for t-test', 'error');
        return;
    }
    
    const mu0 = parseFloat(document.getElementById('tt-test-mean').value);
    const alpha = parseFloat(document.getElementById('tt-alpha').value);
    
    // Calculate t-statistic
    const t = (stats.mean - mu0) / (stats.stdDev / Math.sqrt(stats.n));
    const df = stats.n - 1;
    
    // Calculate p-value (two-tailed)
    const p = 2 * (1 - ttTCDF(Math.abs(t), df));
    
    // Critical t-value
    const tCritical = ttInvT(1 - alpha/2, df);
    
    // Decision
    const reject = p < alpha;
    
    let results = `
        <div style="margin-bottom:var(--space-sm);">
            <strong>H‚ÇÄ:</strong> Œº = ${mu0.toFixed(2)}<br>
            <strong>H‚ÇÅ:</strong> Œº ‚â† ${mu0.toFixed(2)} (two-tailed)
        </div>
        <div style="margin-bottom:var(--space-sm);">
            <strong>t(${df}) =</strong> ${t.toFixed(4)}
        </div>
        <div style="margin-bottom:var(--space-sm);">
            <strong>p-value =</strong> ${p.toFixed(6)}
        </div>
        <div style="margin-bottom:var(--space-sm);">
            <strong>Œ± =</strong> ${alpha} (t‚Çç${df},${1-alpha/2}‚Çé = ${tCritical.toFixed(4)})
        </div>
        <div style="color:${reject ? '#4caf50' : '#f44336'};font-weight:var(--weight-semibold);">
            ${reject ? '‚úì Reject H‚ÇÄ: Significant difference' : '‚úó Fail to reject H‚ÇÄ: No significant difference'}
        </div>
    `;
    
    document.getElementById('tt-test-results').innerHTML = results;
}

// Student's t CDF approximation
function ttTCDF(t, df) {
    // Simple approximation for common cases
    if (df > 30) {
        // Use normal approximation for large df
        return 0.5 * (1 + ttErf(t / Math.sqrt(2)));
    }
    
    // For small df, use approximation
    const x = df / (df + t * t);
    const ibeta = ttIBeta(x, df/2, 0.5);
    return t > 0 ? 1 - 0.5 * ibeta : 0.5 * ibeta;
}

function ttIBeta(x, a, b) {
    // Incomplete beta function approximation
    let bt = Math.exp(lgamma(a + b) - lgamma(a) - lgamma(b) + a * Math.log(x) + b * Math.log(1 - x));
    
    if (x < (a + 1) / (a + b + 2)) {
        return bt * ttBetaCF(x, a, b) / a;
    } else {
        return 1 - bt * ttBetaCF(1 - x, b, a) / b;
    }
}

function ttBetaCF(x, a, b) {
    // Continued fraction for beta function
    const maxIter = 100;
    const eps = 1e-10;
    
    let qab = a + b;
    let qap = a + 1;
    let qam = a - 1;
    let c = 1;
    let d = 1 - qab * x / qap;
    
    if (Math.abs(d) < eps) d = eps;
    d = 1 / d;
    let h = d;
    
    for (let m = 1; m <= maxIter; m++) {
        const m2 = 2 * m;
        let aa = m * (b - m) * x / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < eps) d = eps;
        c = 1 + aa / c;
        if (Math.abs(c) < eps) c = eps;
        d = 1 / d;
        h *= d * c;
        
        aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < eps) d = eps;
        c = 1 + aa / c;
        if (Math.abs(c) < eps) c = eps;
        d = 1 / d;
        const del = d * c;
        h *= del;
        
        if (Math.abs(del - 1) < eps) break;
    }
    
    return h;
}

function lgamma(x) {
    // Log gamma function approximation
    const cof = [
        76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5
    ];
    
    let y = x;
    let tmp = x + 5.5;
    tmp -= (x + 0.5) * Math.log(tmp);
    let ser = 1.000000000190015;
    
    for (let j = 0; j < 6; j++) {
        y += 1;
        ser += cof[j] / y;
    }
    
    return -tmp + Math.log(2.5066282746310005 * ser / x);
}

function ttInvT(p, df) {
    // Inverse t-distribution approximation
    // For common values, return approximation
    const commonValues = {
        '0.95_10': 1.812, '0.975_10': 2.228,
        '0.95_20': 1.725, '0.975_20': 2.086,
        '0.95_30': 1.697, '0.975_30': 2.042,
        '0.95_inf': 1.645, '0.975_inf': 1.960
    };
    
    const key = `${p}_${df}`;
    if (commonValues[key]) return commonValues[key];
    if (df > 30) return commonValues[`${p}_inf`];
    
    // Simple linear interpolation for other values
    return 1.96; // Conservative estimate
}

function getRegressionTab() {
    return `
        <div>
            <h3 style="color:var(--text-secondary);margin-bottom:var(--space-lg);">Regression Analysis</h3>
            
            <div class="glass glass-sm" style="padding:var(--space-lg);border-radius:var(--radius-md);margin-bottom:var(--space-lg);">
                <div style="text-align:center;color:var(--text-tertiary);">
                    <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üìê</div>
                    <div>Enter paired data (x,y values) for regression analysis</div>
                    <div class="small" style="margin-top:var(--space-xs);">
                        Format: x1 y1, x2 y2, x3 y3, ...
                    </div>
                </div>
            </div>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:var(--space-lg);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Simple Linear Regression</h4>
                    <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                        <div style="color:var(--text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-sm);">
                            ≈∑ = a + bx
                        </div>
                        <div style="display:grid;gap:var(--space-sm);">
                            <div class="regression-param">
                                <span>Slope (b):</span>
                                <span style="color:var(--accent);">‚Äì</span>
                            </div>
                            <div class="regression-param">
                                <span>Intercept (a):</span>
                                <span style="color:var(--accent);">‚Äì</span>
                            </div>
                            <div class="regression-param">
                                <span>R¬≤:</span>
                                <span style="color:var(--accent);">‚Äì</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Correlation</h4>
                    <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                        <div style="display:grid;gap:var(--space-sm);">
                            <div class="regression-param">
                                <span>Pearson's r:</span>
                                <span style="color:var(--accent);">‚Äì</span>
                            </div>
                            <div class="regression-param">
                                <span>Strength:</span>
                                <span style="color:var(--text-secondary);">‚Äì</span>
                            </div>
                            <div class="regression-param">
                                <span>Direction:</span>
                                <span style="color:var(--text-secondary);">‚Äì</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function getVisualizationTab() {
    const stats = ttState.stats;
    if (!stats) {
        return `
            <div style="text-align:center;color:var(--text-tertiary);">
                <div style="font-size:var(--text-xl);margin-bottom:var(--space-sm);">üìä</div>
                <div>Enter data to visualize distributions and patterns</div>
            </div>
        `;
    }
    
    return `
        <div>
            <h3 style="color:var(--text-secondary);margin-bottom:var(--space-lg);">Data Visualization</h3>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:var(--space-xl);">
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Histogram</h4>
                    <div id="tt-histogram" style="height:200px;background:rgba(255,255,255,0.03);border-radius:var(--radius-md);padding:var(--space-md);display:flex;align-items:flex-end;gap:2px;">
                        ${generateHistogram()}
                    </div>
                </div>
                
                <div>
                    <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Box Plot</h4>
                    <div id="tt-boxplot" style="height:200px;background:rgba(255,255,255,0.03);border-radius:var(--radius-md);padding:var(--space-md);position:relative;">
                        ${generateBoxPlot()}
                    </div>
                </div>
            </div>
            
            <div style="margin-top:var(--space-xl);">
                <h4 style="color:var(--text);margin-bottom:var(--space-md);font-size:var(--text-sm);">Distribution Shape</h4>
                <div class="glass glass-sm" style="padding:var(--space-md);border-radius:var(--radius-md);">
                    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:var(--space-md);">
                        <div>
                            <div style="font-weight:var(--weight-semibold);color:var(--text);">Bell Curve</div>
                            <div class="small" style="color:var(--text-secondary);">
                                ${Math.abs(stats.skewness) < 0.5 ? '‚úì Approximately normal' : '‚úó Not normal'}
                            </div>
                        </div>
                        <div>
                            <div style="font-weight:var(--weight-semibold);color:var(--text);">Outliers</div>
                            <div class="small" style="color:var(--text-secondary);">
                                ${detectOutliers().count > 0 ? `‚ö†Ô∏è ${detectOutliers().count} potential outliers` : '‚úì No outliers detected'}
                            </div>
                        </div>
                        <div>
                            <div style="font-weight:var(--weight-semibold);color:var(--text);">Spread</div>
                            <div class="small" style="color:var(--text-secondary);">
                                CV = ${(stats.stdDev / stats.mean * 100).toFixed(1)}%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateHistogram() {
    const data = ttState.data;
    if (!data || data.length === 0) return '<div>No data</div>';
    
    // Create histogram bins
    const bins = 10;
    const min = Math.min(...data);
    const max = Math.max(...data);
    const binWidth = (max - min) / bins;
    
    const histogram = Array(bins).fill(0);
    data.forEach(value => {
        const bin = Math.min(Math.floor((value - min) / binWidth), bins - 1);
        histogram[bin]++;
    });
    
    const maxCount = Math.max(...histogram);
    
    // Generate bars
    return histogram.map((count, i) => {
        const height = (count / maxCount) * 180;
        return `
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;">
                <div style="width:90%;background:var(--accent);border-radius:2px 2px 0 0;height:${height}px;" title="Bin ${i+1}: ${count} values"></div>
            </div>
        `;
    }).join('');
}

function generateBoxPlot() {
    const stats = ttState.stats;
    if (!stats) return '<div>No data</div>';
    
    const width = 400;
    const height = 150;
    const scale = width / (stats.max - stats.min);
    
    const q1Pos = (stats.q1 - stats.min) * scale;
    const medianPos = (stats.median - stats.min) * scale;
    const q3Pos = (stats.q3 - stats.min) * scale;
    
    const outliers = detectOutliers().values;
    
    return `
        <div style="position:relative;height:100%;">
            <!-- Whiskers -->
            <div style="position:absolute;left:${q1Pos}px;top:50%;width:${q3Pos - q1Pos}px;height:20px;border:2px solid var(--accent);border-radius:4px;"></div>
            
            <!-- Median line -->
            <div style="position:absolute;left:${medianPos}px;top:40%;width:2px;height:40px;background:white;"></div>
            
            <!-- Min/Max lines -->
            <div style="position:absolute;left:0;top:50%;width:${q1Pos}px;height:2px;background:var(--text-secondary);"></div>
            <div style="position:absolute;left:${q3Pos}px;top:50%;width:${width - q3Pos}px;height:2px;background:var(--text-secondary);"></div>
            
            <!-- Outliers -->
            ${outliers.map(val => {
                const pos = (val - stats.min) * scale;
                return `<div style="position:absolute;left:${pos}px;top:50%;width:8px;height:8px;background:#f44336;border-radius:50%;transform:translate(-50%, -50%);"></div>`;
            }).join('')}
        </div>
    `;
}

function detectOutliers() {
    const stats = ttState.stats;
    if (!stats) return { count: 0, values: [] };
    
    const lowerBound = stats.q1 - 1.5 * stats.iqr;
    const upperBound = stats.q3 + 1.5 * stats.iqr;
    
    const outliers = ttState.data.filter(x => x < lowerBound || x > upperBound);
    
    return {
        count: outliers.length,
        values: outliers
    };
}

// Utility functions
function ttClearData() {
    document.getElementById('tt-data-input').value = '';
    ttState.data = [];
    ttState.stats = null;
    document.getElementById('tt-data-preview').style.display = 'none';
    updateTabContent();
    showNotification('Data cleared', 'info');
}

function ttGenerateRandomData() {
    const n = Math.floor(Math.random() * 20) + 10; // 10-30 points
    const mean = Math.random() * 50 + 25; // 25-75
    const stdDev = Math.random() * 15 + 5; // 5-20
    
    const data = Array.from({length: n}, () => {
        // Generate normally distributed random numbers
        let u = 0, v = 0;
        while(u === 0) u = Math.random();
        while(v === 0) v = Math.random();
        const normal = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        return mean + normal * stdDev;
    });
    
    document.getElementById('tt-data-input').value = data.map(x => x.toFixed(2)).join(', ');
    ttParseData();
    showNotification(`Generated ${n} random data points`, 'success');
}

function ttLoadExample(type) {
    const examples = {
        normal: "12.3, 14.1, 15.8, 16.2, 17.5, 18.1, 18.9, 19.2, 20.1, 20.5, 21.3, 22.0",
        uniform: "10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32",
        skewed: "5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 30, 35, 40",
        outliers: "10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 100",
        small: "45, 52, 48, 55, 50"
    };
    
    document.getElementById('tt-data-input').value = examples[type];
    ttParseData();
    showNotification(`Loaded ${type} distribution example`, 'info');
}

function ttShareResults() {
    const stats = ttState.stats;
    if (!stats) {
        showNotification('No results to share', 'warning');
        return;
    }
    
    const shareText = `Statistics Results:\n` +
                     `‚Ä¢ Data points: ${stats.n}\n` +
                     `‚Ä¢ Mean: ${stats.mean.toFixed(2)}\n` +
                     `‚Ä¢ Median: ${stats.median.toFixed(2)}\n` +
                     `‚Ä¢ Std Dev: ${stats.stdDev.toFixed(2)}\n` +
                     `‚Ä¢ Using The Most Useful Site's Statistics Calculator`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Statistics Results',
            text: shareText,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(shareText);
        showNotification('Results copied to clipboard!', 'success');
    }
}

function ttEmbedTool() {
    const embedCode = `<iframe src="${window.location.origin}/cards/statistics-calculator.html" width="100%" height="800" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="Statistics Calculator - The Most Useful Site"></iframe>`;
    
    navigator.clipboard.writeText(embedCode);
    showNotification('Embed code copied to clipboard!', 'success');
    
    if (window.plausible) {
        window.plausible('Embed Generated', { props: { tool: 'statistics-calculator' } });
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    console.log('üìä Statistics Calculator loaded');
    
    // Load initial example
    setTimeout(() => {
        ttLoadExample('normal');
    }, 100);
    
    // Auto-parse on paste
    document.getElementById('tt-data-input').addEventListener('paste', () => {
        setTimeout(ttParseData, 100);
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            ttParseData();
        }
        if (e.key === '1' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            ttShowTab('descriptive');
        }
        if (e.key === '2' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            ttShowTab('distributions');
        }
        if (e.key === '3' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            ttShowTab('testing');
        }
    });
});
</script>

<!-- ===== 5. CARD-SCOPED STYLES ===== -->
<style>
#tt-title {
    color: var(--accent);
    margin-bottom: var(--space-sm);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.tab-button {
    padding: var(--space-md);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-base);
    border-bottom: 3px solid transparent;
    font-size: var(--text-sm);
    font-weight: var(--weight-semibold);
}

.tab-button:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
}

.tab-button.active {
    background: rgba(45, 212, 255, 0.1);
    color: var(--accent);
    border-bottom: 3px solid var(--accent);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    color: var(--text-secondary);
    font-size: var(--text-sm);
}

.stat-value {
    color: var(--text);
    font-weight: var(--weight-semibold);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
}

.summary-item {
    text-align: center;
    flex: 1;
}

.small-input {
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: rgba(255, 255, 255, 0.03);
    color: var(--text);
    font-size: var(--text-sm);
    width: 100%;
}

.test-type {
    padding: var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid transparent;
    cursor: pointer;
    transition: var(--transition-base);
}

.test-type:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--border);
}

.test-type.active {
    background: rgba(45, 212, 255, 0.1);
    border-color: var(--accent);
}

.regression-param {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xs) 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.regression-param:last-child {
    border-bottom: none;
}

.distribution-info {
    color: var(--text);
    font-size: var(--text-sm);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .tab-buttons {
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    .summary-item {
        font-size: var(--text-xs);
    }
}

@media (max-width: 480px) {
    .tab-buttons {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    
    .summary-item {
        flex: none;
        width: 20%;
    }
}
</style>
