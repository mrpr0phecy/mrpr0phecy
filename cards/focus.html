<h2 id="focus-timer-title">‚è±Ô∏è Deep Focus Timer</h2>

<form aria-describedby="focus-description">
    <p id="focus-description" class="small" style="color:rgba(230,250,255,0.9);margin-bottom:20px;">
        Advanced Pomodoro timer with productivity tracking, ambient sounds, and progress visualization.
        <span style="color:var(--accent);font-weight:500;">Stay focused, maximize productivity!</span>
    </p>
    
    <!-- Timer Settings -->
    <div style="margin-bottom:24px;">
        <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:1rem;">‚öôÔ∏è Timer Settings</h3>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px;">
            <div>
                <label for="ft-work-duration" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    üéØ Focus Session
                </label>
                <div style="position:relative;">
                    <input id="ft-work-duration" type="range" min="5" max="60" step="5" value="25" 
                           style="width:100%;margin-bottom:8px;" />
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div id="ft-work-value" style="color:#fff;font-weight:600;font-size:1.1rem;">25</div>
                        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">minutes</div>
                    </div>
                </div>
                <div style="margin-top:8px;display:flex;gap:6px;justify-content:space-between;">
                    <button type="button" onclick="ftSetWork(15)" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:4px;color:var(--accent);cursor:pointer;font-size:0.8rem;">15m</button>
                    <button type="button" onclick="ftSetWork(25)" style="padding:4px 8px;background:rgba(45,212,255,0.2);border:1px solid var(--accent);border-radius:4px;color:var(--accent);cursor:pointer;font-size:0.8rem;">25m</button>
                    <button type="button" onclick="ftSetWork(50)" style="padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:4px;color:var(--accent);cursor:pointer;font-size:0.8rem;">50m</button>
                </div>
            </div>
            
            <div>
                <label for="ft-break-duration" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                    ‚òï Break Session
                </label>
                <div style="position:relative;">
                    <input id="ft-break-duration" type="range" min="1" max="30" step="1" value="5" 
                           style="width:100%;margin-bottom:8px;" />
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div id="ft-break-value" style="color:#fff;font-weight:600;font-size:1.1rem;">5</div>
                        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">minutes</div>
                    </div>
                </div>
                <div style="margin-top:8px;display:flex;gap:6px;justify-content:space-between;">
                    <button type="button" onclick="ftSetBreak(5)" style="padding:4px 8px;background:rgba(57,255,20,0.2);border:1px solid #39ff14;border-radius:4px;color:#39ff14;cursor:pointer;font-size:0.8rem;">5m</button>
                    <button type="button" onclick="ftSetBreak(10)" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:4px;color:#39ff14;cursor:pointer;font-size:0.8rem;">10m</button>
                    <button type="button" onclick="ftSetBreak(15)" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:4px;color:#39ff14;cursor:pointer;font-size:0.8rem;">15m</button>
                </div>
            </div>
        </div>
        
        <!-- Sessions Setting -->
        <div style="margin-bottom:20px;">
            <label for="ft-sessions" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                üîÑ Sessions per Cycle
            </label>
            <div style="position:relative;">
                <input id="ft-sessions" type="range" min="1" max="8" step="1" value="4" 
                       style="width:100%;margin-bottom:8px;" />
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div id="ft-sessions-value" style="color:#fff;font-weight:600;font-size:1.1rem;">4</div>
                    <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">sessions</div>
                </div>
            </div>
        </div>
        
        <!-- Ambient Sounds -->
        <div style="margin-bottom:20px;">
            <label style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
                üéµ Ambient Sounds
            </label>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <button type="button" onclick="ftSetSound('none')" id="ft-sound-none"
                        style="padding:10px 16px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
                    üîá None
                </button>
                <button type="button" onclick="ftSetSound('rain')" id="ft-sound-rain"
                        style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;">
                    üåßÔ∏è Rain
                </button>
                <button type="button" onclick="ftSetSound('forest')" id="ft-sound-forest"
                        style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;">
                    üå≤ Forest
                </button>
                <button type="button" onclick="ftSetSound('coffee')" id="ft-sound-coffee"
                        style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;">
                    ‚òï Caf√©
                </button>
                <button type="button" onclick="ftSetSound('waves')" id="ft-sound-waves"
                        style="padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(230,250,255,0.8);cursor:pointer;">
                    üåä Waves
                </button>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="actions" style="display:flex;gap:12px;">
        <button type="button" onclick="ftStartTimer()" id="ft-start-btn"
                style="flex:1;padding:16px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:2px solid rgba(57,255,20,0.4);border-radius:12px;color:#39ff14;cursor:pointer;font-weight:600;font-size:1.1rem;display:flex;align-items:center;justify-content:center;gap:10px;">
            ‚ñ∂Ô∏è Start Focus Session
        </button>
        <button type="button" onclick="ftPauseTimer()" id="ft-pause-btn" disabled
                style="padding:16px 24px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:12px;color:#ffcc00;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;">
            ‚è∏Ô∏è Pause
        </button>
        <button type="button" onclick="ftResetTimer()"
                style="padding:16px 24px;background:rgba(255,77,77,0.1);border:2px solid rgba(255,77,77,0.3);border-radius:12px;color:#ff4d4d;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;">
            üîÑ Reset
        </button>
    </div>
</form>

<!-- Timer Display -->
<div class="results" aria-live="polite" style="margin-top:24px;">
    <!-- Main Timer -->
    <div style="text-align:center;margin-bottom:24px;">
        <div id="ft-timer-display" style="
            font-size:4rem;
            font-weight:800;
            color:#fff;
            text-shadow:0 0 20px rgba(45,212,255,0.5);
            margin-bottom:12px;
            font-family:'Courier New',monospace;
            letter-spacing:2px;
        ">25:00</div>
        
        <div id="ft-phase-indicator" style="
            display:inline-block;
            padding:8px 20px;
            background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));
            border:2px solid rgba(45,212,255,0.4);
            border-radius:20px;
            color:var(--accent);
            font-weight:600;
            font-size:1.1rem;
            margin-bottom:16px;
        ">Ready to Focus</div>
    </div>
    
    <!-- Progress Visualization -->
    <div style="margin-bottom:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div style="color:var(--accent);font-weight:500;">üìä Progress</div>
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">
                Session <span id="ft-current-session">0</span>/<span id="ft-total-sessions">4</span>
            </div>
        </div>
        
        <!-- Progress Bars -->
        <div style="margin-bottom:16px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Session Progress</div>
                <div id="ft-session-progress-text" style="font-size:0.9rem;color:var(--accent);">0%</div>
            </div>
            <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:12px;">
                <div id="ft-session-progress-bar" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:0%;transition:width 0.3s;"></div>
            </div>
        </div>
        
        <div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Cycle Progress</div>
                <div id="ft-cycle-progress-text" style="font-size:0.9rem;color:#39ff14;">0%</div>
            </div>
            <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
                <div id="ft-cycle-progress-bar" style="height:100%;background:linear-gradient(90deg, #39ff14, #ffcc00);width:0%;transition:width 0.3s;"></div>
            </div>
        </div>
    </div>
    
    <!-- Stats & Controls -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;">
        <div style="padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;text-align:center;">
            <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Focus Time</div>
            <div id="ft-focus-time" style="font-size:1.2rem;color:var(--accent);font-weight:600;">0m</div>
        </div>
        <div style="padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;text-align:center;">
            <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Break Time</div>
            <div id="ft-break-time" style="font-size:1.2rem;color:#39ff14;font-weight:600;">0m</div>
        </div>
        <div style="padding:12px;background:rgba(255,204,0,0.1);border-radius:8px;text-align:center;">
            <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">Productivity</div>
            <div id="ft-productivity" style="font-size:1.2rem;color:#ffcc00;font-weight:600;">0%</div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div>
        <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">‚ö° Quick Actions:</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button onclick="ftSkipBreak()" style="padding:10px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;">
                ‚è≠Ô∏è Skip Break
            </button>
            <button onclick="ftAddMinute()" style="padding:10px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
                ‚è±Ô∏è +1 Minute
            </button>
            <button onclick="ftToggleFullscreen()" style="padding:10px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;">
                üì∫ Fullscreen
            </button>
            <button onclick="ftNotify()" style="padding:10px 16px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:8px;color:#9d4edd;cursor:pointer;">
                üîî Test Alert
            </button>
        </div>
    </div>
</div>

<!-- Fullscreen Mode -->
<div id="ft-fullscreen" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background:linear-gradient(135deg, #0a0f14, #141e28);
    z-index:10000;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    backdrop-filter:blur(10px);
">
    <div style="font-size:8rem;font-weight:800;color:#fff;text-shadow:0 0 40px rgba(45,212,255,0.7);margin-bottom:20px;font-family:'Courier New',monospace;" id="ft-fullscreen-timer"></div>
    <div style="font-size:2rem;color:var(--accent);font-weight:600;margin-bottom:40px;" id="ft-fullscreen-phase"></div>
    <button onclick="ftToggleFullscreen()" style="
        padding:16px 32px;
        background:rgba(255,255,255,0.1);
        border:2px solid rgba(255,255,255,0.2);
        border-radius:12px;
        color:#fff;
        cursor:pointer;
        font-size:1.2rem;
        backdrop-filter:blur(10px);
    ">
        Exit Fullscreen
    </button>
</div>

<script>
/* focus-timer.html
   - Advanced Pomodoro timer with productivity features
   - Prefix: ft
*/

let ftTimerInterval = null;
let ftTimeRemaining = 0;
let ftCurrentPhase = 'work'; // 'work', 'break', 'longBreak'
let ftCurrentSession = 1;
let ftTotalSessions = 4;
let ftIsRunning = false;
let ftSound = 'none';
let ftAudioContext = null;
let ftAudioSource = null;

// Timer statistics
let ftFocusTime = 0; // in seconds
let ftBreakTime = 0; // in seconds
let ftSessionsCompleted = 0;

// Initialize range sliders
function ftInitializeSliders() {
    const workSlider = document.getElementById('ft-work-duration');
    const breakSlider = document.getElementById('ft-break-duration');
    const sessionsSlider = document.getElementById('ft-sessions');
    
    const workValue = document.getElementById('ft-work-value');
    const breakValue = document.getElementById('ft-break-value');
    const sessionsValue = document.getElementById('ft-sessions-value');
    
    // Work duration slider
    workSlider.addEventListener('input', function() {
        workValue.textContent = this.value;
        if (!ftIsRunning) {
            ftUpdateTimerDisplay(parseInt(this.value) * 60);
        }
    });
    
    // Break duration slider
    breakSlider.addEventListener('input', function() {
        breakValue.textContent = this.value;
    });
    
    // Sessions slider
    sessionsSlider.addEventListener('input', function() {
        sessionsValue.textContent = this.value;
        ftTotalSessions = parseInt(this.value);
        document.getElementById('ft-total-sessions').textContent = this.value;
    });
    
    // Trigger initial updates
    workSlider.dispatchEvent(new Event('input'));
    breakSlider.dispatchEvent(new Event('input'));
    sessionsSlider.dispatchEvent(new Event('input'));
}

function ftSetWork(minutes) {
    const slider = document.getElementById('ft-work-duration');
    slider.value = minutes;
    slider.dispatchEvent(new Event('input'));
}

function ftSetBreak(minutes) {
    const slider = document.getElementById('ft-break-duration');
    slider.value = minutes;
    slider.dispatchEvent(new Event('input'));
}

function ftSetSound(sound) {
    ftSound = sound;
    
    // Update button styles
    const sounds = ['none', 'rain', 'forest', 'coffee', 'waves'];
    sounds.forEach(s => {
        const btn = document.getElementById(`ft-sound-${s}`);
        if (s === sound) {
            btn.style.background = 'rgba(45,212,255,0.2)';
            btn.style.border = '2px solid var(--accent)';
            btn.style.color = 'var(--accent)';
            btn.style.fontWeight = '600';
        } else {
            btn.style.background = 'rgba(255,255,255,0.05)';
            btn.style.border = '1px solid rgba(255,255,255,0.1)';
            btn.style.color = 'rgba(230,250,255,0.8)';
            btn.style.fontWeight = '400';
        }
    });
    
    // Stop any current sound
    ftStopSound();
    
    // Start new sound if not 'none'
    if (sound !== 'none') {
        ftPlaySound(sound);
    }
}

function ftPlaySound(type) {
    // Create audio context if needed
    if (!ftAudioContext) {
        ftAudioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    // Stop any existing sound
    ftStopSound();
    
    // Create oscillator for sound
    ftAudioSource = ftAudioContext.createOscillator();
    const gainNode = ftAudioContext.createGain();
    
    // Configure based on sound type
    switch(type) {
        case 'rain':
            ftAudioSource.type = 'sine';
            ftAudioSource.frequency.value = 200;
            gainNode.gain.value = 0.02;
            break;
        case 'forest':
            ftAudioSource.type = 'sine';
            ftAudioSource.frequency.value = 150;
            gainNode.gain.value = 0.01;
            break;
        case 'coffee':
            ftAudioSource.type = 'sawtooth';
            ftAudioSource.frequency.value = 300;
            gainNode.gain.value = 0.015;
            break;
        case 'waves':
            ftAudioSource.type = 'sine';
            ftAudioSource.frequency.value = 100;
            gainNode.gain.value = 0.03;
            break;
    }
    
    // Connect and start
    ftAudioSource.connect(gainNode);
    gainNode.connect(ftAudioContext.destination);
    ftAudioSource.start();
}

function ftStopSound() {
    if (ftAudioSource) {
        ftAudioSource.stop();
        ftAudioSource = null;
    }
}

function ftStartTimer() {
    if (ftIsRunning) return;
    
    const workMinutes = parseInt(document.getElementById('ft-work-duration').value);
    const breakMinutes = parseInt(document.getElementById('ft-break-duration').value);
    
    // Set initial values
    ftTimeRemaining = workMinutes * 60;
    ftCurrentPhase = 'work';
    ftCurrentSession = 1;
    ftTotalSessions = parseInt(document.getElementById('ft-sessions').value);
    ftIsRunning = true;
    
    // Update UI
    document.getElementById('ft-start-btn').disabled = true;
    document.getElementById('ft-start-btn').style.opacity = '0.5';
    document.getElementById('ft-pause-btn').disabled = false;
    document.getElementById('ft-pause-btn').style.opacity = '1';
    
    const startBtn = document.getElementById('ft-start-btn');
    startBtn.innerHTML = '‚è≥ Running...';
    
    // Update display
    ftUpdateTimerDisplay(ftTimeRemaining);
    ftUpdatePhaseIndicator();
    ftUpdateSessionDisplay();
    
    // Start the timer
    ftTimerInterval = setInterval(ftTimerTick, 1000);
    
    // Play sound if enabled
    if (ftSound !== 'none') {
        ftPlaySound(ftSound);
    }
}

function ftTimerTick() {
    ftTimeRemaining--;
    
    // Update statistics
    if (ftCurrentPhase === 'work') {
        ftFocusTime++;
    } else {
        ftBreakTime++;
    }
    
    // Update display
    ftUpdateTimerDisplay(ftTimeRemaining);
    ftUpdateProgress();
    ftUpdateStatistics();
    
    // Check if timer finished
    if (ftTimeRemaining <= 0) {
        ftTimerFinished();
    }
    
    // Visual effects when time is low
    if (ftTimeRemaining <= 10 && ftTimeRemaining > 0) {
        ftPulseTimer();
    }
}

function ftUpdateTimerDisplay(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    const timeString = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    
    document.getElementById('ft-timer-display').textContent = timeString;
    document.getElementById('ft-fullscreen-timer').textContent = timeString;
}

function ftUpdatePhaseIndicator() {
    const indicator = document.getElementById('ft-phase-indicator');
    const fullscreenIndicator = document.getElementById('ft-fullscreen-phase');
    
    let text, color, bgColor, borderColor;
    
    switch(ftCurrentPhase) {
        case 'work':
            text = 'üéØ Focus Session';
            color = 'var(--accent)';
            bgColor = 'linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1))';
            borderColor = 'rgba(45,212,255,0.4)';
            break;
        case 'break':
            text = '‚òï Break Time';
            color = '#39ff14';
            bgColor = 'linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1))';
            borderColor = 'rgba(57,255,20,0.4)';
            break;
        case 'longBreak':
            text = 'üå¥ Long Break';
            color = '#ffcc00';
            bgColor = 'linear-gradient(135deg, rgba(255,204,0,0.2), rgba(255,204,0,0.1))';
            borderColor = 'rgba(255,204,0,0.4)';
            break;
    }
    
    indicator.textContent = text;
    indicator.style.background = bgColor;
    indicator.style.borderColor = borderColor;
    indicator.style.color = color;
    
    fullscreenIndicator.textContent = text;
    fullscreenIndicator.style.color = color;
}

function ftUpdateSessionDisplay() {
    document.getElementById('ft-current-session').textContent = ftCurrentSession;
    document.getElementById('ft-total-sessions').textContent = ftTotalSessions;
}

function ftUpdateProgress() {
    const workMinutes = parseInt(document.getElementById('ft-work-duration').value);
    const breakMinutes = parseInt(document.getElementById('ft-break-duration').value);
    
    let sessionDuration, progressPercent;
    
    if (ftCurrentPhase === 'work') {
        sessionDuration = workMinutes * 60;
        progressPercent = 100 - ((ftTimeRemaining / sessionDuration) * 100);
        
        // Session progress
        document.getElementById('ft-session-progress-text').textContent = Math.round(progressPercent) + '%';
        document.getElementById('ft-session-progress-bar').style.width = progressPercent + '%';
        
        // Cycle progress
        const cycleProgress = ((ftCurrentSession - 1) / ftTotalSessions) * 100 + (progressPercent / ftTotalSessions);
        document.getElementById('ft-cycle-progress-text').textContent = Math.round(cycleProgress) + '%';
        document.getElementById('ft-cycle-progress-bar').style.width = cycleProgress + '%';
    }
}

function ftUpdateStatistics() {
    // Update focus time
    const focusMinutes = Math.floor(ftFocusTime / 60);
    document.getElementById('ft-focus-time').textContent = focusMinutes + 'm';
    
    // Update break time
    const breakMinutes = Math.floor(ftBreakTime / 60);
    document.getElementById('ft-break-time').textContent = breakMinutes + 'm';
    
    // Update productivity (focus time / total time)
    const totalTime = ftFocusTime + ftBreakTime;
    const productivity = totalTime > 0 ? Math.round((ftFocusTime / totalTime) * 100) : 0;
    document.getElementById('ft-productivity').textContent = productivity + '%';
}

function ftTimerFinished() {
    // Play completion sound
    ftPlayNotification();
    
    // Update statistics
    ftSessionsCompleted++;
    
    // Determine next phase
    if (ftCurrentPhase === 'work') {
        // Check if we need a long break
        if (ftCurrentSession >= ftTotalSessions) {
            // Cycle completed
            ftCurrentSession = 1;
            ftCurrentPhase = 'longBreak';
            ftTimeRemaining = parseInt(document.getElementById('ft-break-duration').value) * 2 * 60; // Double break time
            
            // Show completion message
            ftShowNotification('üéâ Cycle Complete!', 'Take a longer break. Well done!');
        } else {
            // Regular break
            ftCurrentSession++;
            ftCurrentPhase = 'break';
            ftTimeRemaining = parseInt(document.getElementById('ft-break-duration').value) * 60;
            
            ftShowNotification('‚òï Break Time!', 'Great work! Time for a short break.');
        }
    } else {
        // Break finished, start next work session
        ftCurrentPhase = 'work';
        ftTimeRemaining = parseInt(document.getElementById('ft-work-duration').value) * 60;
        
        ftShowNotification('üéØ Focus Time!', 'Break is over. Time to focus!');
    }
    
    // Update UI
    ftUpdatePhaseIndicator();
    ftUpdateSessionDisplay();
    ftUpdateTimerDisplay(ftTimeRemaining);
}

function ftPauseTimer() {
    if (!ftIsRunning) return;
    
    ftIsRunning = false;
    clearInterval(ftTimerInterval);
    
    // Update UI
    document.getElementById('ft-start-btn').disabled = false;
    document.getElementById('ft-start-btn').style.opacity = '1';
    document.getElementById('ft-pause-btn').disabled = true;
    document.getElementById('ft-pause-btn').style.opacity = '0.5';
    
    const startBtn = document.getElementById('ft-start-btn');
    startBtn.innerHTML = '‚ñ∂Ô∏è Resume';
    
    // Stop sound
    ftStopSound();
}

function ftResetTimer() {
    ftPauseTimer();
    
    // Reset all values
    ftTimeRemaining = parseInt(document.getElementById('ft-work-duration').value) * 60;
    ftCurrentPhase = 'work';
    ftCurrentSession = 1;
    ftFocusTime = 0;
    ftBreakTime = 0;
    ftSessionsCompleted = 0;
    
    // Update UI
    ftUpdateTimerDisplay(ftTimeRemaining);
    ftUpdatePhaseIndicator();
    ftUpdateSessionDisplay();
    ftUpdateStatistics();
    
    // Reset progress bars
    document.getElementById('ft-session-progress-text').textContent = '0%';
    document.getElementById('ft-session-progress-bar').style.width = '0%';
    document.getElementById('ft-cycle-progress-text').textContent = '0%';
    document.getElementById('ft-cycle-progress-bar').style.width = '0%';
    
    const startBtn = document.getElementById('ft-start-btn');
    startBtn.innerHTML = '‚ñ∂Ô∏è Start Focus Session';
    startBtn.disabled = false;
    startBtn.style.opacity = '1';
}

function ftSkipBreak() {
    if (ftCurrentPhase === 'break' || ftCurrentPhase === 'longBreak') {
        ftTimerFinished();
    }
}

function ftAddMinute() {
    ftTimeRemaining += 60;
    ftUpdateTimerDisplay(ftTimeRemaining);
}

function ftToggleFullscreen() {
    const fullscreen = document.getElementById('ft-fullscreen');
    
    if (fullscreen.style.display === 'flex') {
        fullscreen.style.display = 'none';
        document.body.style.overflow = 'auto';
    } else {
        fullscreen.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // Update fullscreen display
        ftUpdateTimerDisplay(ftTimeRemaining);
        ftUpdatePhaseIndicator();
    }
}

function ftNotify() {
    ftShowNotification('üîî Test Notification', 'This is a test notification for the timer.');
}

function ftShowNotification(title, message) {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 20px;
        background: var(--panel);
        border: 2px solid var(--accent);
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        z-index: 10001;
        max-width: 300px;
        animation: slideIn 0.3s ease;
        backdrop-filter: blur(10px);
    `;
    
    notification.innerHTML = `
        <div style="font-weight:600;color:var(--accent);margin-bottom:8px;">${title}</div>
        <div style="color:rgba(230,250,255,0.9);font-size:0.9rem;">${message}</div>
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

function ftPlayNotification() {
    // Play a short notification sound
    if (!ftAudioContext) {
        ftAudioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    const oscillator = ftAudioContext.createOscillator();
    const gainNode = ftAudioContext.createGain();
    
    oscillator.type = 'sine';
    oscillator.frequency.value = 800;
    gainNode.gain.value = 0.1;
    
    oscillator.connect(gainNode);
    gainNode.connect(ftAudioContext.destination);
    
    oscillator.start();
    setTimeout(() => oscillator.stop(), 300);
}

function ftPulseTimer() {
    const timer = document.getElementById('ft-timer-display');
    timer.style.animation = 'pulse 0.5s ease';
    setTimeout(() => {
        timer.style.animation = '';
    }, 500);
}

// Add keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === ' ') { // Spacebar
        e.preventDefault();
        if (ftIsRunning) {
            ftPauseTimer();
        } else {
            ftStartTimer();
        }
    } else if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        ftResetTimer();
    } else if (e.key === 'f' || e.key === 'F') {
        e.preventDefault();
        ftToggleFullscreen();
    }
});

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        ftInitializeSliders();
        ftSetSound('none');
        
        // Set initial timer display
        const workMinutes = parseInt(document.getElementById('ft-work-duration').value);
        ftUpdateTimerDisplay(workMinutes * 60);
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            
            input[type="range"] {
                -webkit-appearance: none;
                appearance: none;
                height: 8px;
                background: rgba(255,255,255,0.1);
                border-radius: 4px;
                outline: none;
            }
            
            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--accent);
                cursor: pointer;
                border: 2px solid rgba(255,255,255,0.3);
                box-shadow: 0 0 10px rgba(45,212,255,0.5);
            }
        `;
        document.head.appendChild(style);
        
        console.log('Focus Timer ready');
    });
}
</script>

<style>
#focus-timer-title {
    color: var(--accent);
    margin-top: 0;
    text-align: center;
    position: relative;
    padding-bottom: 12px;
}

#focus-timer-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 25%;
    width: 50%;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--accent), #39ff14, transparent);
    border-radius: 2px;
}

button {
    transition: all 0.2s ease;
}

button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#ft-timer-display {
    transition: all 0.3s ease;
}

@media (max-width: 768px) {
    #ft-timer-display {
        font-size: 3rem !important;
    }
    
    .actions button {
        padding: 12px !important;
        font-size: 0.9rem !important;
    }
}
</style>
