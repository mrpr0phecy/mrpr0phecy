<div class="card" id="viral-time-machine-card">
  <div style="text-align:center;padding:20px 0 0;">
    <h2 id="viral-title" style="margin:0;color:#ff6b9d;font-size:2.2rem;background:linear-gradient(90deg, #ff6b9d, #ff9a6b, #ffdc6b, #6bff97);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 4px 15px rgba(255,107,157,0.3);">Which Year Are You? ğŸ•°ï¸</h2>
    <p class="small" style="margin:8px auto 16px;max-width:400px;color:#aaa;font-size:0.95rem;">
      Discover your internet personality era based on your tastes, habits, and vibes.
      <span style="display:inline-block;background:rgba(255,107,157,0.1);padding:2px 8px;border-radius:12px;margin-top:4px;font-size:0.8rem;">â† Share your result!</span>
    </p>
  </div>

  <!-- Loading Animation -->
  <div id="viral-loader" style="display:none;text-align:center;padding:40px 20px;">
    <div style="width:60px;height:60px;margin:0 auto 20px;position:relative;">
      <div style="position:absolute;width:100%;height:100%;border:4px solid transparent;border-top-color:#ff6b9d;border-radius:50%;animation:spin 1s linear infinite;"></div>
      <div style="position:absolute;width:70%;height:70%;top:15%;left:15%;border:3px solid transparent;border-bottom-color:#6bff97;border-radius:50%;animation:spinReverse 1.2s linear infinite;"></div>
    </div>
    <p style="color:#aaa;font-size:0.95rem;">Analyzing your digital DNA...</p>
    <div style="display:flex;justify-content:center;gap:6px;margin-top:12px;">
      <div style="width:8px;height:8px;background:#ff6b9d;border-radius:50%;animation:bounce 1.4s infinite;"></div>
      <div style="width:8px;height:8px;background:#ffdc6b;border-radius:50%;animation:bounce 1.4s infinite 0.2s;"></div>
      <div style="width:8px;height:8px;background:#6bff97;border-radius:50%;animation:bounce 1.4s infinite 0.4s;"></div>
      <div style="width:8px;height:8px;background:#6b9dff;border-radius:50%;animation:bounce 1.4s infinite 0.6s;"></div>
    </div>
  </div>

  <!-- Quiz Section -->
  <div id="viral-quiz" style="max-width:600px;margin:0 auto;">
    <div id="quiz-question" style="background:linear-gradient(135deg, rgba(255,107,157,0.1), rgba(107,157,255,0.1));border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,107,157,0.2);">
      <h3 style="margin:0 0 16px 0;color:#ffdc6b;font-size:1.3rem;">Question <span id="question-number">1</span>/10</h3>
      <p id="question-text" style="margin:0;color:#fff;font-size:1.1rem;line-height:1.4;">
        Your go-to social media platform is...
      </p>
    </div>

    <div id="quiz-options" style="display:grid;grid-template-columns:1fr;gap:10px;">
      <button class="quiz-option" data-points="2012,2014,2016" onclick="selectOption(this)">
        <span style="font-size:1.5rem;">ğŸ“±</span>
        <span style="flex:1;text-align:left;">Instagram (Aesthetic grids & stories)</span>
      </button>
      <button class="quiz-option" data-points="2018,2020,2022" onclick="selectOption(this)">
        <span style="font-size:1.5rem;">ğŸµ</span>
        <span style="flex:1;text-align:left;">TikTok (Endless scrolling & trends)</span>
      </button>
      <button class="quiz-option" data-points="2010,2012,2014" onclick="selectOption(this)">
        <span style="font-size:1.5rem;">ğŸ¦</span>
        <span style="flex:1;text-align:left;">Twitter/X (Hot takes & memes)</span>
      </button>
      <button class="quiz-option" data-points="2008,2010,2012" onclick="selectOption(this)">
        <span style="font-size:1.5rem;">ğŸ“˜</span>
        <span style="flex:1;text-align:left;">Facebook (Classic connection)</span>
      </button>
      <button class="quiz-option" data-points="2022,2024,2026" onclick="selectOption(this)">
        <span style="font-size:1.5rem;">ğŸ§µ</span>
        <span style="flex:1;text-align:left;">Threads/Bluesky (New wave)</span>
      </button>
    </div>

    <!-- Progress Bar -->
    <div style="margin:20px 0;">
      <div style="display:flex;justify-content:space-between;margin-bottom:6px;font-size:0.85rem;color:#aaa;">
        <span>Quiz Progress</span>
        <span id="progress-percent">10%</span>
      </div>
      <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
        <div id="progress-bar" style="height:100%;background:linear-gradient(90deg, #ff6b9d, #ffdc6b);width:10%;transition:width 0.5s ease;"></div>
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:0.75rem;color:#666;">
        <span>2008</span>
        <span>2012</span>
        <span>2016</span>
        <span>2020</span>
        <span>2024+</span>
      </div>
    </div>

    <!-- Navigation -->
    <div style="display:flex;justify-content:space-between;gap:12px;margin-top:20px;">
      <button onclick="prevQuestion()" class="quiz-nav" style="flex:1;">
        <span style="font-size:1.2rem;">â†</span> Back
      </button>
      <button onclick="nextQuestion()" class="quiz-nav primary" style="flex:1;">
        Next <span style="font-size:1.2rem;">â†’</span>
      </button>
    </div>
  </div>

  <!-- Result Section (Hidden Initially) -->
  <div id="viral-result" style="display:none;text-align:center;padding:20px;">
    <div style="background:linear-gradient(135deg, rgba(255,107,157,0.1), rgba(107,157,255,0.1));border-radius:20px;padding:30px;margin-bottom:20px;border:2px solid rgba(255,107,157,0.3);position:relative;overflow:hidden;">
      <div style="position:absolute;top:0;right:0;width:100px;height:100px;background:radial-gradient(circle, rgba(255,107,157,0.2) 0%, transparent 70%);"></div>
      <div style="position:absolute;bottom:0;left:0;width:150px;height:150px;background:radial-gradient(circle, rgba(107,157,255,0.2) 0%, transparent 70%);"></div>
      
      <h3 id="result-year" style="margin:0 0 16px 0;font-size:4rem;font-weight:800;background:linear-gradient(90deg, #ff6b9d, #ffdc6b, #6bff97);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">2016</h3>
      <div id="result-title" style="font-size:1.8rem;font-weight:700;margin-bottom:12px;color:#ffdc6b;">The Vine & Snapchat Era ğŸ­</div>
      <div id="result-emoji" style="font-size:3rem;margin-bottom:16px;">ğŸ˜‚ğŸ“±</div>
      
      <div style="display:flex;justify-content:center;gap:8px;margin-bottom:20px;flex-wrap:wrap;">
        <span class="result-tag" style="background:rgba(255,107,157,0.2);color:#ff6b9d;">#6SecondVideos</span>
        <span class="result-tag" style="background:rgba(255,220,107,0.2);color:#ffdc6b;">#SquadGoals</span>
        <span class="result-tag" style="background:rgba(107,255,151,0.2);color:#6bff97;">#FaceFilters</span>
        <span class="result-tag" style="background:rgba(107,157,255,0.2);color:#6b9dff;">#DoItForTheVine</span>
      </div>
      
      <div id="result-description" style="color:#ccc;line-height:1.6;max-width:500px;margin:0 auto 20px;">
        You're living in the golden age of short-form video! Your humor is perfectly timed, your aesthetic is on point, and you never miss a trend. You're the friend who knows all the dances and has the best group chat.
      </div>
      
      <!-- Compatibility -->
      <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-top:20px;">
        <div style="font-size:0.9rem;color:#aaa;margin-bottom:8px;">Best Match With:</div>
        <div style="display:flex;justify-content:center;gap:12px;">
          <div style="text-align:center;">
            <div style="font-size:2rem;">ğŸ“º</div>
            <div style="font-size:0.9rem;color:#fff;">2012 Tumblr</div>
            <div style="font-size:0.8rem;color:#6bff97;">92% Match</div>
          </div>
          <div style="text-align:center;">
            <div style="font-size:2rem;">ğŸ®</div>
            <div style="font-size:0.9rem;color:#fff;">2020 TikTok</div>
            <div style="font-size:0.8rem;color:#ffdc6b;">88% Match</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Share Section -->
    <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:20px;margin-bottom:20px;">
      <h4 style="margin:0 0 16px 0;color:#fff;">Share Your Result!</h4>
      <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;">
        <button onclick="shareResult('twitter')" class="share-btn" style="background:rgba(29,161,242,0.2);color:#1da1f2;">
          <span>ğŸ¦</span> Twitter
        </button>
        <button onclick="shareResult('instagram')" class="share-btn" style="background:linear-gradient(45deg, rgba(225,48,108,0.2), rgba(253,29,29,0.2), rgba(255,159,0,0.2));color:#fff;">
          <span>ğŸ“·</span> Instagram
        </button>
        <button onclick="shareResult('copy')" class="share-btn" style="background:rgba(107,157,255,0.2);color:#6b9dff;">
          <span>ğŸ“‹</span> Copy Link
        </button>
        <button onclick="shareResult('tiktok')" class="share-btn" style="background:rgba(0,0,0,0.2);color:#fff;border:1px solid rgba(255,255,255,0.2);">
          <span>ğŸµ</span> TikTok
        </button>
      </div>
      <div style="margin-top:12px;position:relative;">
        <input id="share-link" type="text" readonly style="width:100%;padding:10px 40px 10px 12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:0.9rem;" value="https://whichyear.me/results/2016-vine-era" />
        <button onclick="copyShareLink()" style="position:absolute;right:4px;top:4px;bottom:4px;background:#6bff97;color:#000;border:none;border-radius:6px;padding:0 12px;font-weight:600;cursor:pointer;">Copy</button>
      </div>
    </div>

    <!-- Retake Button -->
    <button onclick="resetQuiz()" class="quiz-nav primary" style="width:200px;margin:0 auto;">
      <span style="font-size:1.2rem;">ğŸ”„</span> Take Quiz Again
    </button>
  </div>

  <!-- Stats -->
  <div style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;">
      <div style="text-align:center;">
        <div style="font-size:2rem;color:#ff6b9d;">ğŸ®</div>
        <div style="font-size:0.9rem;color:#fff;">Most Common Result</div>
        <div style="font-size:1.2rem;font-weight:700;color:#ffdc6b;">2018</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:2rem;color:#6bff97;">ğŸ‘¥</div>
        <div style="font-size:0.9rem;color:#fff;">Total Participants</div>
        <div style="font-size:1.2rem;font-weight:700;color:#6bff97;" id="participant-count">1,234,567</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:2rem;color:#6b9dff;">ğŸ“ˆ</div>
        <div style="font-size:0.9rem;color:#fff;">Viral Score</div>
        <div style="font-size:1.2rem;font-weight:700;color:#6b9dff;">98/100</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:2rem;color:#ffdc6b;">ğŸ”„</div>
        <div style="font-size:0.9rem;color:#fff;">Avg. Retakes</div>
        <div style="font-size:1.2rem;font-weight:700;color:#ffdc6b;">2.3</div>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes spinReverse {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(-360deg); }
    }
    
    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .card {
      background: #1a1a1a;
      border-radius: 20px;
      padding: 20px;
      border: 1px solid #333;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,107,157,0.05) 0%, transparent 70%);
      z-index: 0;
    }
    
    .quiz-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    
    .quiz-option:hover {
      background: rgba(255,107,157,0.1);
      border-color: rgba(255,107,157,0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255,107,157,0.2);
    }
    
    .quiz-option.selected {
      background: linear-gradient(135deg, rgba(255,107,157,0.2), rgba(107,157,255,0.2));
      border-color: #ff6b9d;
      box-shadow: 0 4px 20px rgba(255,107,157,0.3);
    }
    
    .quiz-nav {
      padding: 14px 20px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .quiz-nav:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-1px);
    }
    
    .quiz-nav.primary {
      background: linear-gradient(90deg, #ff6b9d, #ffdc6b);
      color: #000;
      border: none;
    }
    
    .quiz-nav.primary:hover {
      background: linear-gradient(90deg, #ff5b8d, #ffcc5b);
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(255,107,157,0.4);
    }
    
    .share-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .result-tag {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .glitch {
      animation: glitch 0.3s linear infinite;
    }
    
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
  </style>
</div>

<script>
// Viral Quiz - Which Year Are You?

const quizQuestions = [
  {
    question: "Your go-to social media platform is...",
    options: [
      { text: "Instagram (Aesthetic grids & stories)", emoji: "ğŸ“±", points: [2012, 2014, 2016] },
      { text: "TikTok (Endless scrolling & trends)", emoji: "ğŸµ", points: [2018, 2020, 2022] },
      { text: "Twitter/X (Hot takes & memes)", emoji: "ğŸ¦", points: [2010, 2012, 2014] },
      { text: "Facebook (Classic connection)", emoji: "ğŸ“˜", points: [2008, 2010, 2012] },
      { text: "Threads/Bluesky (New wave)", emoji: "ğŸ§µ", points: [2022, 2024, 2026] }
    ]
  },
  {
    question: "Your meme format of choice...",
    options: [
      { text: "Impact font on random images", emoji: "ğŸ’¥", points: [2008, 2010, 2012] },
      { text: "Vine compilations & 6-second humor", emoji: "ğŸ˜‚", points: [2014, 2016, 2018] },
      { text: "Dank memes & surreal humor", emoji: "ğŸ¤¡", points: [2016, 2018, 2020] },
      { text: "TikTok trends & audio memes", emoji: "ğŸµ", points: [2020, 2022, 2024] },
      { text: "AI-generated absurdity", emoji: "ğŸ¤–", points: [2022, 2024, 2026] }
    ]
  },
  {
    question: "Your streaming service is...",
    options: [
      { text: "Netflix DVDs in the mail", emoji: "ğŸ“€", points: [2008, 2010] },
      { text: "Netflix streaming (OG)", emoji: "ğŸ“º", points: [2012, 2014] },
      { text: "Too many subscriptions", emoji: "ğŸ¬", points: [2016, 2018] },
      { text: "YouTube Premium & TikTok", emoji: "ğŸ“±", points: [2020, 2022] },
      { text: "Pirate everything (ğŸ´â€â˜ ï¸)", emoji: "ğŸ´â€â˜ ï¸", points: [2008, 2024] }
    ]
  },
  {
    question: "Your phone looks like...",
    options: [
      { text: "BlackBerry with physical keyboard", emoji: "ğŸ“±", points: [2008, 2010] },
      { text: "iPhone 4/5 (Retina display!)", emoji: "ğŸ“±", points: [2012, 2014] },
      { text: "iPhone X (bye home button)", emoji: "ğŸ“±", points: [2016, 2018] },
      { text: "Foldable phone with cracks", emoji: "ğŸ“±", points: [2020, 2022] },
      { text: "Still using iPhone 6 (it works!)", emoji: "ğŸ“±", points: [2014, 2024] }
    ]
  },
  {
    question: "Your music streaming is...",
    options: [
      { text: "iTunes downloads", emoji: "ğŸµ", points: [2008, 2010] },
      { text: "YouTube to MP3 converter", emoji: "ğŸµ", points: [2012, 2014] },
      { text: "Spotify Free (with ads)", emoji: "ğŸµ", points: [2016, 2018] },
      { text: "Spotify Premium (student discount)", emoji: "ğŸµ", points: [2020, 2022] },
      { text: "Apple Music (for Lossless)", emoji: "ğŸµ", points: [2022, 2024] }
    ]
  },
  {
    question: "Your fashion vibe is...",
    options: [
      { text: "Scene/emo hair & skinny jeans", emoji: "ğŸ‘–", points: [2008, 2010] },
      { text: "Hipster glasses & mustaches", emoji: "ğŸ‘“", points: [2012, 2014] },
      { text: "Normcore & minimalism", emoji: "ğŸ‘•", points: [2016, 2018] },
      { text: "Y2K revival & cottagecore", emoji: "ğŸŒ¸", points: [2020, 2022] },
      { text: "Whatever's clean & comfy", emoji: "ğŸ˜´", points: [2010, 2024] }
    ]
  },
  {
    question: "Your gaming setup...",
    options: [
      { text: "Wii Sports & Guitar Hero", emoji: "ğŸ®", points: [2008, 2010] },
      { text: "Minecraft & Call of Duty", emoji: "ğŸ®", points: [2012, 2014] },
      { text: "Fortnite & Among Us", emoji: "ğŸ®", points: [2016, 2018] },
      { text: "Valorant & Genshin Impact", emoji: "ğŸ®", points: [2020, 2022] },
      { text: "VR headset & cloud gaming", emoji: "ğŸ®", points: [2022, 2024] }
    ]
  },
  {
    question: "Your internet speed was...",
    options: [
      { text: "Dial-up noises (EEEE-AHHH)", emoji: "ğŸ“", points: [2000, 2004] },
      { text: "DSL (faster than dial-up!)", emoji: "ğŸŒ", points: [2008, 2010] },
      { text: "Cable broadband", emoji: "âš¡", points: [2012, 2014] },
      { text: "Fiber optic (finally!)", emoji: "ğŸ’", points: [2016, 2018] },
      { text: "5G mobile hotspot", emoji: "ğŸ“¶", points: [2020, 2024] }
    ]
  },
  {
    question: "Your reaction to new tech...",
    options: [
      { text: "Wait for reviews & price drop", emoji: "â³", points: [2008, 2014] },
      { text: "Pre-order & camp outside store", emoji: "ğŸ•ï¸", points: [2010, 2016] },
      { text: "Watch unboxing videos first", emoji: "ğŸ“¦", points: [2012, 2018] },
      { text: "Check Reddit & Twitter opinions", emoji: "ğŸ—£ï¸", points: [2016, 2020] },
      { text: "Too expensive, I'll wait", emoji: "ğŸ’°", points: [2014, 2024] }
    ]
  },
  {
    question: "Your digital communication...",
    options: [
      { text: "MSN Messenger & AIM", emoji: "ğŸ’¬", points: [2004, 2008] },
      { text: "Facebook Chat & BBM", emoji: "ğŸ’¬", points: [2010, 2012] },
      { text: "WhatsApp & iMessage", emoji: "ğŸ’¬", points: [2014, 2016] },
      { text: "Discord & Snapchat", emoji: "ğŸ’¬", points: [2018, 2020] },
      { text: "Signal & Telegram (privacy!)", emoji: "ğŸ”’", points: [2022, 2024] }
    ]
  }
];

const yearResults = {
  2008: {
    title: "The MySpace & Early YouTube Era ğŸ¸",
    emoji: "ğŸµğŸ‘¨â€ğŸ¤",
    tags: ["#SceneHair", "#ProfileSong", "#Top8Friends", "#YouTubePioneer"],
    description: "You remember when YouTube had a 10-minute limit and MySpace profiles were an art form. Your internet was dial-up to DSL, and you had strong opinions about which social network was superior (MySpace vs Facebook).",
    match: { "2012 Tumblr": 85, "2016 Vine": 70 }
  },
  2012: {
    title: "The Tumblr & Instagram OG Era ğŸ“¸",
    emoji: "ğŸ“·ğŸŒ¸",
    tags: ["#Aesthetic", "#VintageFilter", "#IndieMusic", "#ArtisticVibes"],
    description: "You curated the perfect Tumblr aesthetic and your Instagram feed was color-coordinated before it was cool. You remember when filters were the height of photo editing and Vine was just starting.",
    match: { "2008 MySpace": 75, "2016 Snapchat": 88 }
  },
  2016: {
    title: "The Vine & Snapchat Era ğŸ­",
    emoji: "ğŸ˜‚ğŸ“±",
    tags: ["#6SecondVideos", "#SquadGoals", "#FaceFilters", "#DoItForTheVine"],
    description: "You're living in the golden age of short-form video! Your humor is perfectly timed, your aesthetic is on point, and you never miss a trend. You're the friend who knows all the dances and has the best group chat.",
    match: { "2012 Tumblr": 92, "2020 TikTok": 88 }
  },
  2020: {
    title: "The TikTok & Pandemic Era ğŸ¦ ",
    emoji: "ğŸ•ºğŸ ",
    tags: ["#QuarantineLife", "#TikTokDances", "#WFH", "#DalgonaCoffee"],
    description: "You mastered TikTok dances while in lockdown and turned your living room into a content studio. You remember when Zoom was just for meetings and now it's for everything. You're adaptable and creative!",
    match: { "2016 Vine": 85, "2024 AI": 78 }
  },
  2024: {
    title: "The AI & Future Era ğŸ¤–",
    emoji: "ğŸš€ğŸ¤–",
    tags: ["#AIArt", "#Metaverse", "#Web3", "#FutureVibes"],
    description: "You're living in the future! AI creates your content, you might own digital art, and your reality blends digital and physical. You're early to every new platform and tech trend.",
    match: { "2020 TikTok": 82, "2012 OG": 65 }
  }
};

// Quiz State
let currentQuestion = 0;
let userAnswers = [];
let scorePoints = [];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateQuestion();
  updateParticipantCount();
});

function updateParticipantCount() {
  const countEl = document.getElementById('participant-count');
  const base = 1234567;
  const random = Math.floor(Math.random() * 1000);
  countEl.textContent = (base + random).toLocaleString();
}

function updateQuestion() {
  const question = quizQuestions[currentQuestion];
  const quizEl = document.getElementById('viral-quiz');
  const optionsEl = document.getElementById('quiz-options');
  
  document.getElementById('question-number').textContent = currentQuestion + 1;
  document.getElementById('question-text').textContent = question.question;
  
  optionsEl.innerHTML = '';
  question.options.forEach((option, index) => {
    const isSelected = userAnswers[currentQuestion] === index;
    const button = document.createElement('button');
    button.className = `quiz-option ${isSelected ? 'selected' : ''}`;
    button.innerHTML = `
      <span style="font-size:1.5rem;">${option.emoji}</span>
      <span style="flex:1;text-align:left;">${option.text}</span>
    `;
    button.dataset.points = option.points.join(',');
    button.onclick = () => selectOption(button, index);
    optionsEl.appendChild(button);
  });
  
  // Update progress
  const progress = ((currentQuestion + 1) / quizQuestions.length) * 100;
  document.getElementById('progress-bar').style.width = `${progress}%`;
  document.getElementById('progress-percent').textContent = `${Math.round(progress)}%`;
}

function selectOption(button, index) {
  // Remove selection from all buttons
  document.querySelectorAll('.quiz-option').forEach(btn => {
    btn.classList.remove('selected');
  });
  
  // Select clicked button
  button.classList.add('selected');
  userAnswers[currentQuestion] = index;
  
  // Add animation effect
  button.style.animation = 'none';
  setTimeout(() => {
    button.style.animation = 'pulse 0.3s';
  }, 10);
}

function nextQuestion() {
  if (userAnswers[currentQuestion] === undefined) {
    // Add shake animation to indicate selection needed
    const options = document.querySelectorAll('.quiz-option');
    options.forEach(option => {
      option.style.animation = 'none';
      setTimeout(() => {
        option.style.animation = 'glitch 0.3s linear infinite';
        setTimeout(() => {
          option.style.animation = '';
        }, 300);
      }, 10);
    });
    return;
  }
  
  if (currentQuestion < quizQuestions.length - 1) {
    currentQuestion++;
    updateQuestion();
  } else {
    calculateResult();
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    updateQuestion();
  }
}

function calculateResult() {
  // Show loading animation
  document.getElementById('viral-quiz').style.display = 'none';
  document.getElementById('viral-loader').style.display = 'block';
  
  // Calculate average year from selected options
  const allPoints = [];
  
  userAnswers.forEach((answerIndex, questionIndex) => {
    if (answerIndex !== undefined) {
      const points = quizQuestions[questionIndex].options[answerIndex].points;
      allPoints.push(...points);
    }
  });
  
  // Calculate average year
  const averageYear = Math.round(allPoints.reduce((a, b) => a + b, 0) / allPoints.length);
  
  // Find closest result year
  const resultYears = Object.keys(yearResults).map(Number);
  const closestYear = resultYears.reduce((prev, curr) => {
    return Math.abs(curr - averageYear) < Math.abs(prev - averageYear) ? curr : prev;
  });
  
  // Simulate loading time
  setTimeout(() => {
    showResult(closestYear);
  }, 2000 + Math.random() * 1000);
}

function showResult(year) {
  document.getElementById('viral-loader').style.display = 'none';
  document.getElementById('viral-result').style.display = 'block';
  
  const result = yearResults[year];
  
  // Animate year display
  const yearEl = document.getElementById('result-year');
  yearEl.textContent = '???';
  yearEl.style.opacity = '0.5';
  
  let count = 2008;
  const interval = setInterval(() => {
    yearEl.textContent = count;
    count += Math.floor(Math.random() * 5) + 1;
    
    if (count >= year) {
      clearInterval(interval);
      yearEl.textContent = year;
      yearEl.style.opacity = '1';
      
      // Add celebration effects
      celebrateResult();
    }
  }, 50);
  
  document.getElementById('result-title').textContent = result.title;
  document.getElementById('result-emoji').textContent = result.emoji;
  document.getElementById('result-description').textContent = result.description;
  
  // Update share link
  document.getElementById('share-link').value = `https://whichyear.me/results/${year}-${result.title.toLowerCase().replace(/[^a-z0-9]/g, '-')}`;
  
  // Update participant count with +1
  const countEl = document.getElementById('participant-count');
  const current = parseInt(countEl.textContent.replace(/,/g, ''));
  countEl.textContent = (current + 1).toLocaleString();
}

function celebrateResult() {
  const resultEl = document.getElementById('viral-result');
  
  // Add confetti effect
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.style.position = 'absolute';
    confetti.style.width = '8px';
    confetti.style.height = '8px';
    confetti.style.background = ['#ff6b9d', '#ffdc6b', '#6bff97', '#6b9dff'][Math.floor(Math.random() * 4)];
    confetti.style.borderRadius = '50%';
    confetti.style.left = `${Math.random() * 100}%`;
    confetti.style.top = '-20px';
    confetti.style.zIndex = '1000';
    confetti.style.animation = `fall ${1 + Math.random() * 2}s linear forwards`;
    
    document.querySelector('.card').appendChild(confetti);
    
    setTimeout(() => {
      confetti.remove();
    }, 3000);
  }
  
  // Add fall animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
    }
  `;
  document.head.appendChild(style);
}

function shareResult(platform) {
  const year = document.getElementById('result-year').textContent;
  const title = document.getElementById('result-title').textContent;
  const url = document.getElementById('share-link').value;
  const text = `I got ${year} - "${title}" on the Which Year Are You? quiz! Find your internet era: ${url}`;
  
  switch(platform) {
    case 'twitter':
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
      break;
    case 'instagram':
      alert('ğŸ“· Screenshot your result and share it on Instagram! Don\'t forget to tag #WhichYearAreYou');
      break;
    case 'tiktok':
      alert('ğŸµ Share your result on TikTok with the sound #WhichYearQuiz');
      break;
    case 'copy':
      copyShareLink();
      break;
  }
  
  // Track share
  console.log(`Shared on ${platform}: ${year}`);
}

function copyShareLink() {
  const linkInput = document.getElementById('share-link');
  linkInput.select();
  document.execCommand('copy');
  
  // Show copied feedback
  const copyBtn = linkInput.nextElementSibling;
  const originalText = copyBtn.textContent;
  copyBtn.textContent = 'âœ… Copied!';
  copyBtn.style.background = '#4caf50';
  
  setTimeout(() => {
    copyBtn.textContent = originalText;
    copyBtn.style.background = '#6bff97';
  }, 2000);
}

function resetQuiz() {
  currentQuestion = 0;
  userAnswers = [];
  scorePoints = [];
  
  document.getElementById('viral-result').style.display = 'none';
  document.getElementById('viral-quiz').style.display = 'block';
  
  updateQuestion();
  
  // Add visual reset effect
  document.querySelector('.card').classList.add('glitch');
  setTimeout(() => {
    document.querySelector('.card').classList.remove('glitch');
  }, 300);
}
</script>
