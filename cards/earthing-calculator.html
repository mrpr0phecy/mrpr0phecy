<h2 id="earthing-calculator-title" style="margin-top:0;color:var(--accent);">
  ‚ö° Professional Earthing Conductor Calculator
  <span style="display:block;font-size:0.8em;color:rgba(230,250,255,0.7);font-weight:400;margin-top:4px;">
    IEC 60364, AS/NZS 3000, BS 7671 Compliant Calculations
  </span>
</h2>

<div class="warning-banner" style="
  background:linear-gradient(90deg, rgba(255,45,85,0.1), rgba(255,45,85,0.05));
  border-left:4px solid #ff2d55;
  padding:12px 16px;
  margin-bottom:20px;
  border-radius:0 8px 8px 0;
">
  <div style="display:flex;align-items:center;gap:12px;">
    <div style="font-size:1.5em;color:#ff2d55;">‚ö†Ô∏è</div>
    <div>
      <strong style="color:#ff2d55;">Professional Use Only</strong>
      <div style="font-size:0.9em;color:rgba(230,250,255,0.9);margin-top:2px;">
        For qualified electricians. Always verify with local regulations and manufacturer specifications.
      </div>
    </div>
  </div>
</div>

<!-- MAIN CALCULATION SECTION -->
<div class="calc-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px;">

  <!-- LEFT: INPUT PARAMETERS -->
  <div class="input-section" style="
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:12px;
    padding:24px;
  ">
    <h3 style="margin-top:0;color:var(--accent);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">
      üìã Calculation Parameters
    </h3>

    <!-- FAULT CHARACTERISTICS -->
    <div style="margin-bottom:20px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>‚ö°</span> Fault Characteristics
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
        <div>
          <label for="earth-current" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
            Prospective Fault Current (I<sub>pf</sub>)
          </label>
          <div style="position:relative;">
            <input id="earth-current" type="number" min="1" max="100000" step="1" value="5000"
                   style="width:100%;padding:10px 40px 10px 12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-family:monospace;">
            <span style="position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(--accent);">A</span>
          </div>
        </div>
        
        <div>
          <label for="earth-time" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
            Disconnection Time (t)
          </label>
          <div style="position:relative;">
            <input id="earth-time" type="number" min="0.01" max="5" step="0.01" value="0.2"
                   style="width:100%;padding:10px 40px 10px 12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-family:monospace;">
            <span style="position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(--accent);">s</span>
          </div>
        </div>
      </div>
      
      <div style="font-size:0.85em;color:rgba(230,250,255,0.7);background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:6px;">
        <strong>Note:</strong> Use actual measured PFC or calculated based on transformer impedance and circuit length
      </div>
    </div>

    <!-- CONDUCTOR SPECIFICATIONS -->
    <div style="margin-bottom:20px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üî©</span> Conductor Specifications
      </div>
      
      <div style="margin-bottom:16px;">
        <label for="earth-material" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
          Conductor Material
        </label>
        <select id="earth-material" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="copper" selected>Copper (Cu) - IEC k=115, AS/NZS k=115</option>
          <option value="aluminium">Aluminium (Al) - IEC k=76, AS/NZS k=76</option>
          <option value="steel">Steel (Fe) - IEC k=58</option>
          <option value="lead">Lead (Pb) - IEC k=33</option>
        </select>
      </div>
      
      <div>
        <label for="earth-k" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
          Material Constant (k)
          <span style="color:var(--accent);margin-left:4px;" id="k-factor-info">(115 - Copper to BS 7671)</span>
        </label>
        <div style="position:relative;">
          <input id="earth-k" type="number" min="1" max="200" step="0.1" value="115"
                 style="width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-family:monospace;">
          <div style="position:absolute;right:12px;top:50%;transform:translateY(-50%);font-size:0.9em;color:rgba(230,250,255,0.7);">
            k-factor
          </div>
        </div>
        <div style="font-size:0.85em;color:rgba(230,250,255,0.7);margin-top:6px;">
          Based on: Initial temp=30¬∞C, Final temp=160¬∞C (Cu) or 140¬∞C (Al)
        </div>
      </div>
    </div>

    <!-- INSTALLATION FACTORS -->
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üèóÔ∏è</span> Installation Factors
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label for="earth-insulation" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
            Insulation Type
          </label>
          <select id="earth-insulation" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
            <option value="pvc" selected>PVC (70¬∞C)</option>
            <option value="xlpe">XLPE (90¬∞C)</option>
            <option value="epr">EPR (90¬∞C)</option>
            <option value="micc">MICC (70¬∞C)</option>
          </select>
        </div>
        
        <div>
          <label for="earth-grouping" style="display:block;margin-bottom:6px;color:rgba(230,250,255,0.9);font-size:0.95em;">
            Grouping Factor (C<sub>g</sub>)
          </label>
          <select id="earth-grouping" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
            <option value="1.0" selected>Single circuit (1.0)</option>
            <option value="0.8">2 circuits (0.8)</option>
            <option value="0.7">3 circuits (0.7)</option>
            <option value="0.65">4 circuits (0.65)</option>
            <option value="0.6">5-6 circuits (0.6)</option>
          </select>
        </div>
      </div>
    </div>

  </div>

  <!-- RIGHT: RESULTS & STANDARDS -->
  <div class="results-section" style="
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:12px;
    padding:24px;
  ">
    <h3 style="margin-top:0;color:var(--accent);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">
      üìä Calculation Results
    </h3>

    <!-- MAIN RESULT -->
    <div style="
      background:linear-gradient(135deg, rgba(45,212,255,0.1), rgba(45,212,255,0.05));
      border:1px solid rgba(45,212,255,0.2);
      border-radius:10px;
      padding:20px;
      margin-bottom:20px;
      text-align:center;
    ">
      <div style="font-size:0.9em;color:rgba(230,250,255,0.8);margin-bottom:8px;">
        Minimum Cross-Sectional Area
      </div>
      <div id="main-result" style="
        font-size:2.5em;
        font-weight:700;
        color:#39ff14;
        font-family:'Courier New', monospace;
        margin:8px 0;
      ">0.00 mm¬≤</div>
      <div style="font-size:0.9em;color:rgba(230,250,255,0.8);">
        <span id="result-material">Copper</span> conductor at <span id="result-k">k=115</span>
      </div>
    </div>

    <!-- STANDARD SIZES -->
    <div style="margin-bottom:20px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üìè</span> IEC Standard Sizes
      </div>
      
      <div id="standard-sizes" style="
        display:grid;
        grid-template-columns:repeat(4, 1fr);
        gap:8px;
        font-family:monospace;
        font-size:0.9em;
      ">
        <!-- Will be populated by JS -->
      </div>
      
      <div style="margin-top:12px;font-size:0.85em;color:rgba(230,250,255,0.7);">
        <span id="selected-size" style="color:#39ff14;">Select nearest standard size above</span>
      </div>
    </div>

    <!-- CALCULATION DETAILS -->
    <div>
      <div style="color:var(--accent);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
        <span>üßÆ</span> Calculation Details
      </div>
      
      <div style="
        background:rgba(0,0,0,0.2);
        border-radius:8px;
        padding:16px;
        font-family:'Courier New', monospace;
        font-size:0.9em;
        line-height:1.6;
      ">
        <div id="calc-steps">
          S = I √ó ‚àöt √∑ k<br>
          Enter values to see calculation
        </div>
      </div>
    </div>

  </div>
</div>

<!-- STANDARDS COMPARISON TABLE -->
<div style="
  background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:12px;
  padding:24px;
  margin-bottom:24px;
">
  <h3 style="margin-top:0;color:var(--accent);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">
    üìö Standards Comparison
  </h3>
  
  <div style="overflow-x:auto;">
    <table style="width:100%;border-collapse:collapse;font-size:0.9em;">
      <thead>
        <tr style="background:rgba(45,212,255,0.1);">
          <th style="padding:12px;text-align:left;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Standard</th>
          <th style="padding:12px;text-align:left;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Formula</th>
          <th style="padding:12px;text-align:left;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">k (Copper)</th>
          <th style="padding:12px;text-align:left;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">k (Aluminium)</th>
          <th style="padding:12px;text-align:left;color:var(--accent);border:1px solid rgba(255,255,255,0.1);">Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">IEC 60364-5-54</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">S = I √ó ‚àöt √∑ k</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">115</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">76</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">PVC insulated, 30‚Üí160¬∞C</td>
        </tr>
        <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">BS 7671 (UK)</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">S = I √ó ‚àöt √∑ k</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">115</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">76</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">Table 54.3</td>
        </tr>
        <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">AS/NZS 3000 (AUS/NZ)</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">S = I √ó ‚àöt √∑ k</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">115</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">76</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">Table 5.1</td>
        </tr>
        <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">NEC 250 (USA)</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">Table 250.66</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">-</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);font-family:monospace;">-</td>
          <td style="padding:12px;border:1px solid rgba(255,255,255,0.1);">Based on service conductors</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- PROFESSIONAL NOTES SECTION -->
<div style="
  background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:12px;
  padding:24px;
  margin-bottom:24px;
">
  <h3 style="margin-top:0;color:var(--accent);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">
    üìù Professional Notes & Considerations
  </h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:16px;margin-top:16px;">
    
    <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:3px solid var(--accent);">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px;">
        <span>‚ö°</span> Fault Current Source
      </div>
      <ul style="margin:0;padding-left:20px;font-size:0.9em;line-height:1.6;color:rgba(230,250,255,0.9);">
        <li>Measure prospective fault current at origin</li>
        <li>Consider transformer impedance and cable length</li>
        <li>For motors, include contribution during fault</li>
        <li>Maximum fault level = transformer PFC + motor contribution</li>
      </ul>
    </div>
    
    <div style="padding:16px;background:rgba(255,45,85,0.05);border-radius:8px;border-left:3px solid #ff2d55;">
      <div style="color:#ff2d55;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px;">
        <span>üîß</span> Installation Factors
      </div>
      <ul style="margin:0;padding-left:20px;font-size:0.9em;line-height:1.6;color:rgba(230,250,255,0.9);">
        <li>Apply grouping factors for multiple circuits</li>
        <li>Consider thermal insulation derating</li>
        <li>Check termination temperature ratings</li>
        <li>Verify mechanical strength requirements</li>
      </ul>
    </div>
    
    <div style="padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;border-left:3px solid #39ff14;">
      <div style="color:#39ff14;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px;">
        <span>üìã</span> Verification Checklist
      </div>
      <ul style="margin:0;padding-left:20px;font-size:0.9em;line-height:1.6;color:rgba(230,250,255,0.9);">
        <li>Compare with local regulations</li>
        <li>Check equipment manufacturer requirements</li>
        <li>Verify conductor withstand rating</li>
        <li>Document calculations for inspection</li>
      </ul>
    </div>
    
  </div>
</div>

<!-- ACTION BUTTONS -->
<div style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap;">
  <button onclick="calculateEarthing()" style="
    flex:1;
    min-width:200px;
    padding:16px 24px;
    background:linear-gradient(90deg, var(--accent), #0077cc);
    border:none;
    border-radius:10px;
    color:white;
    font-weight:600;
    font-size:1.1em;
    cursor:pointer;
    transition:all 0.2s;
  " onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(45,212,255,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
    ‚ö° Calculate Earthing Size
  </button>
  
  <button onclick="generateReport()" style="
    padding:16px 24px;
    background:rgba(57,255,20,0.15);
    border:1px solid rgba(57,255,20,0.4);
    border-radius:10px;
    color:#39ff14;
    font-weight:600;
    cursor:pointer;
    transition:all 0.2s;
  " onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(57,255,20,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
    üìÑ Generate Professional Report
  </button>
  
  <button onclick="resetCalculator()" style="
    padding:16px 24px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:10px;
    color:inherit;
    font-weight:600;
    cursor:pointer;
    transition:all 0.2s;
  " onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(255,255,255,0.1)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
    üîÑ Reset All
  </button>
</div>

<!-- OUTPUT AREA -->
<div id="report-output" style="
  background:rgba(0,0,0,0.3);
  border:1px solid rgba(45,212,255,0.2);
  border-radius:12px;
  padding:24px;
  display:none;
  margin-top:24px;
">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h3 style="margin:0;color:var(--accent);">üìã Earthing Calculation Report</h3>
    <div style="font-size:0.9em;color:rgba(230,250,255,0.7);">
      Generated: <span id="report-date"></span>
    </div>
  </div>
  
  <pre id="earth-output" style="
    background:rgba(0,0,0,0.5);
    padding:20px;
    border-radius:8px;
    font-family:'Courier New', monospace;
    font-size:0.9em;
    line-height:1.6;
    white-space:pre-wrap;
    margin:0;
    overflow-x:auto;
  "></pre>
  
  <div style="display:flex;gap:12px;margin-top:20px;">
    <button onclick="copyReport()" style="
      padding:12px 24px;
      background:rgba(45,212,255,0.15);
      border:1px solid var(--accent);
      border-radius:8px;
      color:var(--accent);
      font-weight:600;
      cursor:pointer;
    ">
      üìã Copy to Clipboard
    </button>
    
    <button onclick="printReport()" style="
      padding:12px 24px;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:8px;
      color:inherit;
      font-weight:600;
      cursor:pointer;
    ">
      üñ®Ô∏è Print Report
    </button>
    
    <button onclick="saveReport()" style="
      padding:12px 24px;
      background:rgba(57,255,20,0.15);
      border:1px solid #39ff14;
      border-radius:8px;
      color:#39ff14;
      font-weight:600;
      cursor:pointer;
    ">
      üíæ Save as PDF
    </button>
  </div>
</div>

<script>
// Professional Earthing Calculator for Electricians

const standardSizes = [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70, 95, 120, 150, 185, 240, 300];
const materialConstants = {
  copper: { k: 115, description: "Copper, PVC insulated (30‚Üí160¬∞C)" },
  aluminium: { k: 76, description: "Aluminium, PVC insulated (30‚Üí140¬∞C)" },
  steel: { k: 58, description: "Steel, bare (30‚Üí200¬∞C)" },
  lead: { k: 33, description: "Lead sheathed (30‚Üí160¬∞C)" }
};

// Initialize calculator
document.addEventListener('DOMContentLoaded', function() {
  updateStandardSizes();
  updateKFactor();
  
  // Add event listeners
  document.getElementById('earth-material').addEventListener('change', updateKFactor);
  document.getElementById('earth-k').addEventListener('input', updateMaterialFromK);
  
  // Auto-calculate on input change
  const inputs = ['earth-current', 'earth-time', 'earth-k', 'earth-grouping'];
  inputs.forEach(id => {
    document.getElementById(id).addEventListener('input', calculateEarthing);
  });
  
  // Initial calculation
  calculateEarthing();
});

function updateStandardSizes() {
  const container = document.getElementById('standard-sizes');
  container.innerHTML = '';
  
  standardSizes.forEach(size => {
    const button = document.createElement('button');
    button.textContent = size + ' mm¬≤';
    button.style.cssText = `
      padding: 8px 4px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
      color: rgba(230,250,255,0.7);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.2s;
    `;
    
    button.onclick = function() {
      document.querySelectorAll('#standard-sizes button').forEach(btn => {
        btn.style.background = 'rgba(255,255,255,0.03)';
        btn.style.borderColor = 'rgba(255,255,255,0.1)';
        btn.style.color = 'rgba(230,250,255,0.7)';
      });
      
      this.style.background = 'rgba(57,255,20,0.2)';
      this.style.borderColor = '#39ff14';
      this.style.color = '#39ff14';
      
      document.getElementById('selected-size').textContent = 
        `Selected: ${size} mm¬≤ (IEC 60228 standard size)`;
    };
    
    container.appendChild(button);
  });
}

function updateKFactor() {
  const material = document.getElementById('earth-material').value;
  const k = materialConstants[material]?.k || 115;
  const desc = materialConstants[material]?.description || '';
  
  document.getElementById('earth-k').value = k;
  document.getElementById('k-factor-info').textContent = `(${k} - ${desc})`;
}

function updateMaterialFromK() {
  const kValue = parseFloat(document.getElementById('earth-k').value);
  let closestMaterial = 'copper';
  let closestDiff = Math.abs(kValue - 115);
  
  for (const [material, data] of Object.entries(materialConstants)) {
    const diff = Math.abs(kValue - data.k);
    if (diff < closestDiff) {
      closestDiff = diff;
      closestMaterial = material;
    }
  }
  
  document.getElementById('earth-material').value = closestMaterial;
  document.getElementById('k-factor-info').textContent = 
    `(${kValue} - Custom k-factor, closest to ${closestMaterial})`;
}

function calculateEarthing() {
  const I = parseFloat(document.getElementById('earth-current').value) || 0;
  const t = parseFloat(document.getElementById('earth-time').value) || 0;
  const k = parseFloat(document.getElementById('earth-k').value) || 115;
  const material = document.getElementById('earth-material').value;
  const grouping = parseFloat(document.getElementById('earth-grouping').value) || 1;
  
  if (I <= 0 || t <= 0 || k <= 0) {
    return;
  }
  
  // Basic formula: S = I √ó ‚àöt √∑ k
  const sqrt_t = Math.sqrt(t);
  const S_basic = (I * sqrt_t) / k;
  
  // Apply grouping factor
  const S_adjusted = S_basic / grouping;
  
  // Find nearest standard size
  const nearestStandard = standardSizes.find(size => size >= S_adjusted * 1.1) || 
                         standardSizes[standardSizes.length - 1];
  
  // Update results
  document.getElementById('main-result').textContent = S_adjusted.toFixed(2) + ' mm¬≤';
  document.getElementById('result-material').textContent = 
    material.charAt(0).toUpperCase() + material.slice(1);
  document.getElementById('result-k').textContent = `k=${k}`;
  
  // Update calculation steps
  const steps = `
    S = I √ó ‚àöt √∑ k
    = ${I} √ó ‚àö${t.toFixed(3)} √∑ ${k}
    = ${I} √ó ${sqrt_t.toFixed(3)} √∑ ${k}
    = ${(I * sqrt_t).toFixed(1)} √∑ ${k}
    = ${S_basic.toFixed(2)} mm¬≤ (basic)
    
    With grouping factor Cg = ${grouping}:
    S_adjusted = ${S_basic.toFixed(2)} √∑ ${grouping}
    = ${S_adjusted.toFixed(2)} mm¬≤
    
    Nearest standard size: ${nearestStandard} mm¬≤
  `;
  
  document.getElementById('calc-steps').textContent = steps;
  
  // Update standard sizes selection
  document.querySelectorAll('#standard-sizes button').forEach(btn => {
    const size = parseFloat(btn.textContent);
    btn.style.background = 'rgba(255,255,255,0.03)';
    btn.style.borderColor = 'rgba(255,255,255,0.1)';
    btn.style.color = 'rgba(230,250,255,0.7)';
    
    if (size === nearestStandard) {
      btn.style.background = 'rgba(57,255,20,0.2)';
      btn.style.borderColor = '#39ff14';
      btn.style.color = '#39ff14';
    }
  });
  
  document.getElementById('selected-size').textContent = 
    `Recommended: ${nearestStandard} mm¬≤ (includes 10% safety margin)`;
}

function generateReport() {
  const I = parseFloat(document.getElementById('earth-current').value);
  const t = parseFloat(document.getElementById('earth-time').value);
  const k = parseFloat(document.getElementById('earth-k').value);
  const material = document.getElementById('earth-material').value;
  const insulation = document.getElementById('earth-insulation').value;
  const grouping = parseFloat(document.getElementById('earth-grouping').value);
  
  const sqrt_t = Math.sqrt(t);
  const S_basic = (I * sqrt_t) / k;
  const S_adjusted = S_basic / grouping;
  const nearestStandard = standardSizes.find(size => size >= S_adjusted * 1.1) || 
                         standardSizes[standardSizes.length - 1];
  
  const now = new Date();
  document.getElementById('report-date').textContent = now.toLocaleString();
  
  const report = `
================================================================
              EARTHING CONDUCTOR CALCULATION REPORT
================================================================

PROJECT INFORMATION:
-------------------
Date: ${now.toLocaleDateString()}
Time: ${now.toLocaleTimeString()}
Calculator: The Most Useful Site in the World - Professional Edition

INPUT PARAMETERS:
----------------
1. Fault Characteristics:
   - Prospective Fault Current (I): ${I.toLocaleString()} A
   - Disconnection Time (t): ${t} seconds
   - ‚àöt = ${sqrt_t.toFixed(3)}

2. Conductor Specifications:
   - Material: ${material.toUpperCase()}
   - Material Constant (k): ${k}
   - Temperature Range: 30¬∞C ‚Üí ${material === 'copper' ? '160¬∞C' : '140¬∞C'}

3. Installation Factors:
   - Insulation Type: ${insulation.toUpperCase()}
   - Grouping Factor (Cg): ${grouping}
   - Circuits Grouped: ${getCircuitCount(grouping)}

CALCULATION PROCESS:
-------------------
Formula: S = I √ó ‚àöt √∑ k

Step 1: Basic Calculation
   S = ${I} √ó ${sqrt_t.toFixed(3)} √∑ ${k}
     = ${(I * sqrt_t).toFixed(1)} √∑ ${k}
     = ${S_basic.toFixed(2)} mm¬≤

Step 2: Apply Installation Factors
   S_adjusted = S √∑ Cg
              = ${S_basic.toFixed(2)} √∑ ${grouping}
              = ${S_adjusted.toFixed(2)} mm¬≤

RESULTS:
--------
1. Minimum Required Size: ${S_adjusted.toFixed(2)} mm¬≤
2. Recommended with Safety Margin: ${nearestStandard} mm¬≤ (+10%)
3. IEC 60228 Standard Size: ${nearestStandard} mm¬≤

STANDARDS COMPLIANCE:
--------------------
- IEC 60364-5-54: Compliant (Formula: S = I √ó ‚àöt √∑ k)
- BS 7671 (UK): Table 54.3 reference
- AS/NZS 3000: Table 5.1 reference
- Local regulations may vary - ALWAYS VERIFY

PROFESSIONAL VERIFICATION CHECKLIST:
-----------------------------------
[ ] Verify with local electrical regulations
[ ] Check equipment manufacturer requirements
[ ] Consider soil resistivity for electrodes
[ ] Verify conductor termination ratings
[ ] Document for inspection purposes
[ ] Include in electrical certification

SAFETY NOTES:
------------
‚ö†Ô∏è This calculation is for guidance only.
‚ö†Ô∏è Actual installation must be designed by a qualified electrician.
‚ö†Ô∏è Consider all installation conditions and derating factors.
‚ö†Ô∏è Always perform on-site testing of earth resistance.

CALCULATED BY:
--------------
Professional Earthing Calculator
The Most Useful Site in the World
================================================================
  `;
  
  document.getElementById('earth-output').textContent = report;
  document.getElementById('report-output').style.display = 'block';
  
  // Scroll to report
  document.getElementById('report-output').scrollIntoView({ behavior: 'smooth' });
}

function getCircuitCount(grouping) {
  const mapping = {
    1.0: "Single circuit",
    0.8: "2 circuits",
    0.7: "3 circuits",
    0.65: "4 circuits",
    0.6: "5-6 circuits"
  };
  return mapping[grouping] || "Custom grouping";
}

function copyReport() {
  const report = document.getElementById('earth-output').textContent;
  navigator.clipboard.writeText(report).then(() => {
    const btn = event.target;
    const original = btn.innerHTML;
    btn.innerHTML = '‚úÖ Copied!';
    setTimeout(() => { btn.innerHTML = original; }, 2000);
  });
}

function printReport() {
  const report = document.getElementById('earth-output').textContent;
  const printWindow = window.open('', '_blank');
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Earthing Calculation Report</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
          h1 { color: #2a2a2a; border-bottom: 2px solid #0077cc; padding-bottom: 10px; }
          pre { background: #f5f5f5; padding: 20px; border-radius: 5px; overflow-x: auto; }
          .warning { background: #fff0f0; padding: 15px; border-left: 5px solid #ff2d55; margin: 20px 0; }
          @media print { body { margin: 20px; } }
        </style>
      </head>
      <body>
        <h1>‚ö° Earthing Conductor Calculation Report</h1>
        <div style="color: #666; margin-bottom: 20px;">
          Generated: ${new Date().toLocaleString()} | Professional Edition
        </div>
        <pre>${report}</pre>
        <div class="warning">
          <strong>IMPORTANT:</strong> This report is for professional guidance only. 
          Final design must comply with local regulations and be verified by a qualified electrician.
        </div>
      </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => { printWindow.print(); }, 500);
}

function saveReport() {
  const report = document.getElementById('earth-output').textContent;
  const blob = new Blob([report], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().split('T')[0];
  
  a.href = url;
  a.download = `Earthing_Calculation_${date}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function resetCalculator() {
  document.getElementById('earth-current').value = 5000;
  document.getElementById('earth-time').value = 0.2;
  document.getElementById('earth-material').value = 'copper';
  document.getElementById('earth-k').value = 115;
  document.getElementById('earth-insulation').value = 'pvc';
  document.getElementById('earth-grouping').value = '1.0';
  
  updateKFactor();
  calculateEarthing();
  document.getElementById('report-output').style.display = 'none';
}
</script>

<style>
/* Professional styling */
select, input {
  font-size: 0.95em;
}

select:focus, input:focus {
  outline: none;
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px rgba(45,212,255,0.2);
}

table {
  font-size: 0.9em;
}

th {
  font-weight: 600;
  white-space: nowrap;
}

td {
  vertical-align: top;
}

/* Responsive design */
@media (max-width: 1024px) {
  .calc-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .input-section, .results-section {
    padding: 16px !important;
  }
  
  #standard-sizes {
    grid-template-columns: repeat(3, 1fr) !important;
  }
}

/* Print styles */
@media print {
  .warning-banner, button {
    display: none !important;
  }
  
  #report-output {
    display: block !important;
    border: none !important;
    padding: 0 !important;
  }
}

/* Professional tooltip style */
[title] {
  border-bottom: 1px dotted rgba(45,212,255,0.5);
  cursor: help;
}
</style>
