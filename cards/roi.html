<h2 id="roi-calculator-title">üìà ROI Calculator</h2>

<form aria-describedby="roi-calculator-desc">
    <p id="roi-calculator-desc" class="small" style="margin-bottom:20px;color:var(--muted)">
        Calculate Return on Investment with advanced metrics and comparisons.
        <span style="color:var(--accent)">Supports annualized returns and multiple currencies.</span>
    </p>
    
    <!-- BASIC INVESTMENT -->
    <div style="margin-bottom:20px;">
        <h3 style="color:var(--accent);margin-bottom:12px;font-size:16px;">üí∞ Investment Details</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
            <div>
                <label for="rc-initial" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Initial Investment
                </label>
                <div style="display:flex;gap:8px;">
                    <select id="rc-currency" style="width:80px;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;">
                        <option value="$">$ USD</option>
                        <option value="¬£" selected>¬£ GBP</option>
                        <option value="‚Ç¨">‚Ç¨ EUR</option>
                        <option value="¬•">¬• JPY</option>
                    </select>
                    <input id="rc-initial" type="number" min="0" step="100" placeholder="10000" value="10000" 
                           style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                </div>
            </div>
            
            <div>
                <label for="rc-final" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Final Value
                </label>
                <input id="rc-final" type="number" min="0" step="100" placeholder="12000" value="12000" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="rc-period" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Investment Period (Years)
                </label>
                <input id="rc-period" type="number" min="0.1" max="100" step="0.5" placeholder="1" value="1" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
            
            <div>
                <label for="rc-fees" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                    Fees/Taxes (%)
                </label>
                <input id="rc-fees" type="number" min="0" max="50" step="0.5" placeholder="1.5" value="1.5" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- ADDITIONAL CONTRIBUTIONS -->
    <div style="margin-bottom:20px;">
        <details>
            <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
                ‚öôÔ∏è Additional Contributions
            </summary>
            <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Regular Contributions</div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
                    <div>
                        <label for="rc-monthly-contrib" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Monthly Contribution
                        </label>
                        <input id="rc-monthly-contrib" type="number" min="0" step="50" placeholder="0" value="0" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                    
                    <div>
                        <label for="rc-contrib-increase" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Annual Increase (%)
                        </label>
                        <input id="rc-contrib-increase" type="number" min="0" max="20" step="1" placeholder="0" value="0" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                </div>
            </div>
        </details>
    </div>
    
    <!-- COMPARISON SETTINGS -->
    <div style="margin-bottom:20px;">
        <details>
            <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.1);">
                üîç Comparison Settings
            </summary>
            <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">Compare Against Benchmarks</div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
                    <div>
                        <label for="rc-inflation" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Annual Inflation (%)
                        </label>
                        <input id="rc-inflation" type="number" min="0" max="20" step="0.1" placeholder="2.5" value="2.5" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                    
                    <div>
                        <label for="rc-benchmark" style="display:block;margin-bottom:6px;color:var(--accent);font-size:14px;">
                            Benchmark Return (%)
                        </label>
                        <input id="rc-benchmark" type="number" min="0" max="50" step="0.1" placeholder="7" value="7" 
                               style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--glass);color:inherit;" />
                    </div>
                </div>
                
                <div style="margin-top:8px;font-size:12px;color:#ffcc00;">
                    üí° Compare against inflation (2-3%) and market benchmarks (7-10%)
                </div>
            </div>
        </details>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div style="display:flex;gap:10px;">
        <button type="button" onclick="rcCalculate()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.3), rgba(45,212,255,0.2));border:1px solid rgba(45,212,255,0.6);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üìä Calculate ROI
        </button>
        <button type="button" onclick="rcReset()"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            üîÑ Reset
        </button>
    </div>
</form>

<!-- RESULTS -->
<div id="rc-results" style="margin-top:24px;display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="color:var(--accent);margin:0;font-size:16px;">üí∞ Investment Performance</h3>
        <div style="display:flex;gap:8px;">
            <button type="button" onclick="rcSave()" 
                    style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
                üíæ Save
            </button>
            <button type="button" onclick="rcExport()"
                    style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
                üì• Export
            </button>
        </div>
    </div>
    
    <!-- QUICK SUMMARY -->
    <div style="margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:bold;color:#39ff14;" id="rc-roi-percent">0%</div>
                <div style="font-size:11px;color:var(--muted);">Total ROI</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:bold;color:var(--accent);" id="rc-profit">$0</div>
                <div style="font-size:11px;color:var(--muted);">Total Profit</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#ffcc00;" id="rc-annual-roi">0%</div>
                <div style="font-size:11px;color:var(--muted);">Annual ROI</div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;text-align:center;">
                <div style="font-size:20px;font-weight:bold;color:#9d4edd;" id="rc-net-value">$0</div>
                <div style="font-size:11px;color:var(--muted);">Net After Fees</div>
            </div>
        </div>
    </div>
    
    <!-- COMPARISON CHART -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìà Performance Comparison</div>
        <div style="position:relative;height:200px;background:rgba(0,0,0,0.2);border-radius:8px;padding:12px;">
            <canvas id="rc-chart" width="400" height="200"></canvas>
        </div>
    </div>
    
    <!-- DETAILED BREAKDOWN -->
    <div style="margin-bottom:20px;">
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìä Detailed Analysis</div>
        <div id="rc-analysis" style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;font-family:monospace;white-space:pre-line;max-height:300px;overflow-y:auto;">
            <!-- Analysis will appear here -->
        </div>
    </div>
    
    <!-- BENCHMARK COMPARISON -->
    <div id="rc-comparison" style="margin-bottom:20px;">
        <!-- Comparison analysis will appear here -->
    </div>
    
    <!-- EXPORT OPTIONS -->
    <div style="display:flex;gap:8px;">
        <button type="button" onclick="rcCopy()" 
                style="flex:1;padding:10px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:13px;">
            üìã Copy Analysis
        </button>
        <button type="button" onclick="rcPrint()"
                style="padding:10px 14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-size:13px;">
            üñ®Ô∏è Print
        </button>
    </div>
</div>

<!-- FORMULA DETAILS -->
<details style="margin-top:20px;">
    <summary style="color:var(--accent);cursor:pointer;font-weight:500;padding:10px;background:rgba(0,0,0,0.2);border-radius:8px;">
        üìö ROI Formulas & Methods
    </summary>
    <div style="margin-top:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;">
        <div style="font-family:monospace;font-size:13px;color:var(--muted);">
            <div><strong>Basic ROI:</strong> ROI = ((Final - Initial) / Initial) √ó 100%</div>
            <div><strong>Annualized ROI:</strong> ((1 + ROI)^(1/Years) - 1) √ó 100%</div>
            <div><strong>Net ROI:</strong> ROI - Fees% - Inflation%</div>
            <div><strong>CAGR (Compound Annual Growth Rate):</strong> ((Final/Initial)^(1/Years) - 1) √ó 100%</div>
            <div style="margin-top:8px;color:#ffcc00;">‚ö†Ô∏è ROI calculations don't account for risk. Past performance ‚â† future results.</div>
        </div>
    </div>
</details>

<script>
/* roi-calculator.html
   - Advanced ROI calculator with comparison tools
   - Scoped with rc- prefix (ROI Calculator)
*/

let rcChart = null;

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rcInit);
} else {
    rcInit();
}

function rcInit() {
    console.log('ROI Calculator initialized');
    
    // Load saved data if any
    const saved = localStorage.getItem('rc-data');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            
            // Load all inputs
            for (const [key, value] of Object.entries(data)) {
                const input = document.getElementById(`rc-${key}`);
                if (input) input.value = value;
            }
        } catch (e) {
            console.error('Failed to load saved data:', e);
        }
    }
    
    // Set up chart if available
    if (typeof Chart !== 'undefined') {
        rcInitializeChart();
    }
}

// Save data
function rcSaveData() {
    const data = {
        'initial': document.getElementById('rc-initial').value,
        'final': document.getElementById('rc-final').value,
        'period': document.getElementById('rc-period').value,
        'fees': document.getElementById('rc-fees').value,
        'currency': document.getElementById('rc-currency').value,
        'monthly-contrib': document.getElementById('rc-monthly-contrib').value,
        'contrib-increase': document.getElementById('rc-contrib-increase').value,
        'inflation': document.getElementById('rc-inflation').value,
        'benchmark': document.getElementById('rc-benchmark').value
    };
    
    localStorage.setItem('rc-data', JSON.stringify(data));
}

// Format currency
function rcFormatCurrency(amount, currency = '$') {
    if (amount >= 1000000) {
        return `${currency}${(amount / 1000000).toFixed(2)}M`;
    } else if (amount >= 1000) {
        return `${currency}${(amount / 1000).toFixed(1)}K`;
    } else {
        return `${currency}${amount.toFixed(0)}`;
    }
}

// Initialize chart
function rcInitializeChart() {
    const ctx = document.getElementById('rc-chart').getContext('2d');
    
    rcChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Your ROI', 'Benchmark', 'Inflation'],
            datasets: [{
                label: 'Return %',
                data: [0, 0, 0],
                backgroundColor: [
                    'rgba(45, 212, 255, 0.7)',
                    'rgba(57, 255, 20, 0.7)',
                    'rgba(255, 204, 0, 0.7)'
                ],
                borderColor: [
                    'rgba(45, 212, 255, 1)',
                    'rgba(57, 255, 20, 1)',
                    'rgba(255, 204, 0, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Return %'
                    },
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.raw.toFixed(2) + '%';
                        }
                    }
                }
            }
        }
    });
}

// Main calculation function
function rcCalculate() {
    // Get inputs
    const initial = parseFloat(document.getElementById('rc-initial').value) || 0;
    const final = parseFloat(document.getElementById('rc-final').value) || 0;
    const period = parseFloat(document.getElementById('rc-period').value) || 1;
    const fees = parseFloat(document.getElementById('rc-fees').value) / 100 || 0;
    const currency = document.getElementById('rc-currency').value;
    const monthlyContrib = parseFloat(document.getElementById('rc-monthly-contrib').value) || 0;
    const contribIncrease = parseFloat(document.getElementById('rc-contrib-increase').value) / 100 || 0;
    const inflation = parseFloat(document.getElementById('rc-inflation').value) / 100 || 0;
    const benchmark = parseFloat(document.getElementById('rc-benchmark').value) / 100 || 0;
    
    if (initial <= 0) {
        rcShowMessage('Enter a valid initial investment', 'warning');
        return;
    }
    
    if (final <= 0) {
        rcShowMessage('Enter a valid final value', 'warning');
        return;
    }
    
    if (period <= 0) {
        rcShowMessage('Enter a valid investment period', 'warning');
        return;
    }
    
    // Calculate with regular contributions if specified
    let totalContributions = initial;
    let currentMonthly = monthlyContrib;
    let totalValueWithContribs = initial;
    
    if (monthlyContrib > 0) {
        for (let year = 0; year < period; year++) {
            for (let month = 0; month < 12; month++) {
                totalContributions += currentMonthly;
                // Simplified growth calculation for contributions
                totalValueWithContribs += currentMonthly;
            }
            // Increase monthly contribution for next year
            currentMonthly *= (1 + contribIncrease);
        }
        
        // Adjust final value for contributions
        final = final * (totalValueWithContribs / initial);
    }
    
    // Calculate basic ROI
    const profit = final - initial;
    const roiPercent = (profit / initial) * 100;
    
    // Calculate annualized ROI (CAGR)
    const annualizedROI = (Math.pow(final / initial, 1 / period) - 1) * 100;
    
    // Calculate net after fees
    const feeAmount = final * fees;
    const netAfterFees = final - feeAmount;
    const netProfit = netAfterFees - initial;
    const netROI = (netProfit / initial) * 100;
    
    // Calculate real ROI (adjusted for inflation)
    const inflationFactor = Math.pow(1 + inflation, period);
    const realFinal = final / inflationFactor;
    const realProfit = realFinal - initial;
    const realROI = (realProfit / initial) * 100;
    
    // Calculate benchmark comparison
    const benchmarkValue = initial * Math.pow(1 + benchmark, period);
    const benchmarkProfit = benchmarkValue - initial;
    const benchmarkROI = (benchmarkProfit / initial) * 100;
    
    // Display results
    rcDisplayResults(
        roiPercent, annualizedROI, profit, netAfterFees, 
        realROI, benchmarkROI, currency, initial, final, period
    );
    
    // Draw chart
    rcDrawChart(annualizedROI, benchmark, inflation * 100);
    
    // Show comparison analysis
    rcShowComparison(roiPercent, benchmarkROI, inflation * 100, profit, benchmarkProfit, currency);
    
    // Save data
    rcSaveData();
    
    // Show results section
    document.getElementById('rc-results').style.display = 'block';
    
    rcShowMessage('ROI calculated!', 'success');
}

// Display results
function rcDisplayResults(roiPercent, annualizedROI, profit, netAfterFees, realROI, benchmarkROI, currency, initial, final, period) {
    // Update quick stats
    document.getElementById('rc-roi-percent').textContent = roiPercent.toFixed(2) + '%';
    document.getElementById('rc-profit').textContent = rcFormatCurrency(profit, currency);
    document.getElementById('rc-annual-roi').textContent = annualizedROI.toFixed(2) + '%';
    document.getElementById('rc-net-value').textContent = rcFormatCurrency(netAfterFees, currency);
    
    // Generate detailed analysis
    let analysis = 'INVESTMENT PERFORMANCE ANALYSIS\n';
    analysis += '='.repeat(50) + '\n\n';
    
    analysis += `Initial Investment: ${currency}${initial.toFixed(2)}\n`;
    analysis += `Final Value: ${currency}${final.toFixed(2)}\n`;
    analysis += `Investment Period: ${period.toFixed(1)} years\n`;
    analysis += '\n' + '='.repeat(50) + '\n\n';
    
    analysis += 'BASIC METRICS:\n';
    analysis += `Total Profit: ${currency}${profit.toFixed(2)}\n`;
    analysis += `Total ROI: ${roiPercent.toFixed(2)}%\n`;
    analysis += `Annualized ROI (CAGR): ${annualizedROI.toFixed(2)}%\n`;
    analysis += `Net After Fees: ${currency}${netAfterFees.toFixed(2)}\n`;
    analysis += '\n' + '='.repeat(50) + '\n\n';
    
    analysis += 'ADJUSTED METRICS:\n';
    analysis += `Real ROI (inflation-adjusted): ${realROI.toFixed(2)}%\n`;
    analysis += `Benchmark ROI: ${benchmarkROI.toFixed(2)}%\n`;
    analysis += `Variance vs Benchmark: ${(roiPercent - benchmarkROI).toFixed(2)}%\n`;
    
    analysis += '\n' + '='.repeat(50) + '\n';
    analysis += '‚ö†Ô∏è ROI calculations are estimates. Past performance ‚â† future results.';
    
    document.getElementById('rc-analysis').textContent = analysis;
}

// Draw comparison chart
function rcDrawChart(yourROI, benchmark, inflation) {
    if (!rcChart && typeof Chart !== 'undefined') {
        rcInitializeChart();
    }
    
    if (rcChart) {
        rcChart.data.datasets[0].data = [yourROI, benchmark, inflation];
        rcChart.update();
    } else {
        // Fallback to manual chart if Chart.js not available
        const canvas = document.getElementById('rc-chart');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Simple bar chart
        const maxValue = Math.max(yourROI, benchmark, inflation) * 1.2;
        const barWidth = 40;
        const spacing = 60;
        
        // Draw bars
        const bars = [
            { value: yourROI, color: '#2dd4ff', label: 'Your ROI' },
            { value: benchmark, color: '#39ff14', label: 'Benchmark' },
            { value: inflation, color: '#ffcc00', label: 'Inflation' }
        ];
        
        bars.forEach((bar, index) => {
            const x = 50 + (spacing * index);
            const height = (bar.value / maxValue) * 150;
            const y = 180 - height;
            
            // Draw bar
            ctx.fillStyle = bar.color;
            ctx.fillRect(x, y, barWidth, height);
            
            // Draw label
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(bar.label, x + barWidth / 2, 195);
            ctx.fillText(bar.value.toFixed(1) + '%', x + barWidth / 2, y - 5);
        });
    }
}

// Show comparison analysis
function rcShowComparison(yourROI, benchmarkROI, inflation, profit, benchmarkProfit, currency) {
    const container = document.getElementById('rc-comparison');
    let html = '';
    
    const difference = yourROI - benchmarkROI;
    let performance = '';
    let performanceColor = '';
    
    if (difference > 10) {
        performance = 'Outstanding';
        performanceColor = '#39ff14';
    } else if (difference > 5) {
        performance = 'Excellent';
        performanceColor = '#2dd4ff';
    } else if (difference > 0) {
        performance = 'Good';
        performanceColor = '#ffcc00';
    } else if (difference > -5) {
        performance = 'Below Benchmark';
        performanceColor = '#ff9955';
    } else {
        performance = 'Underperforming';
        performanceColor = '#ff2d55';
    }
    
    const realReturn = yourROI - inflation;
    const realReturnText = realReturn > 0 ? 'positive' : 'negative';
    const realReturnColor = realReturn > 0 ? '#39ff14' : '#ff2d55';
    
    html += `
        <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">üìà Performance Comparison</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:${performanceColor};font-weight:600;margin-bottom:4px;">${performance}</div>
                <div style="font-size:12px;color:var(--muted);">
                    ${difference >= 0 ? '+' : ''}${difference.toFixed(2)}% vs benchmark
                </div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:${realReturnColor};font-weight:600;margin-bottom:4px;">${realReturn.toFixed(2)}% Real Return</div>
                <div style="font-size:12px;color:var(--muted);">
                    ${realReturnText} after inflation
                </div>
            </div>
            
            <div style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;">
                <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">${currency}${Math.abs(profit - benchmarkProfit).toFixed(2)}</div>
                <div style="font-size:12px;color:var(--muted);">
                    ${profit >= benchmarkProfit ? 'Extra' : 'Less'} vs benchmark
                </div>
            </div>
        </div>
    `;
    
    // Add recommendations based on performance
    html += `
        <div style="margin-top:12px;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid ${performanceColor};">
            <div style="color:${performanceColor};font-weight:500;font-size:13px;">üí° Recommendations:</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px;">
                ${rcGetRecommendations(difference, realReturn)}
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

// Get recommendations based on performance
function rcGetRecommendations(difference, realReturn) {
    let recommendations = [];
    
    if (difference > 5) {
        recommendations.push('Consider increasing investment in this asset class');
        recommendations.push('Review if risk level is appropriate for returns');
        recommendations.push('Diversify to lock in gains');
    } else if (difference > 0) {
        recommendations.push('Continue current strategy with regular reviews');
        recommendations.push('Consider slight increases in contributions');
    } else if (difference > -5) {
        recommendations.push('Review investment strategy and allocations');
        recommendations.push('Consider rebalancing portfolio');
        recommendations.push('Look for lower-cost investment options');
    } else {
        recommendations.push('Conduct thorough portfolio review');
        recommendations.push('Consider professional financial advice');
        recommendations.push('Explore alternative investment options');
    }
    
    if (realReturn < 0) {
        recommendations.push('Focus on investments that outpace inflation');
    }
    
    return recommendations.map(rec => `‚Ä¢ ${rec}`).join('<br>');
}

// Copy analysis to clipboard
function rcCopy() {
    const analysis = document.getElementById('rc-analysis').textContent;
    if (!analysis || analysis.includes('Detailed Analysis')) {
        rcShowMessage('No analysis to copy', 'warning');
        return;
    }
    
    navigator.clipboard.writeText(analysis).then(() => {
        rcShowMessage('Analysis copied!', 'success');
    }).catch(err => {
        console.error('Copy failed:', err);
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = analysis;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        rcShowMessage('Copied!', 'success');
    });
}

// Export analysis
function rcExport() {
    const analysis = document.getElementById('rc-analysis').textContent;
    if (!analysis || analysis.includes('Detailed Analysis')) {
        rcShowMessage('No analysis to export', 'warning');
        return;
    }
    
    const currency = document.getElementById('rc-currency').value;
    const initial = document.getElementById('rc-initial').value;
    const final = document.getElementById('rc-final').value;
    
    let text = `ROI ANALYSIS REPORT\n`;
    text += `Date: ${new Date().toLocaleDateString()}\n`;
    text += `Investment: ${currency}${initial} ‚Üí ${currency}${final}\n`;
    text += '='.repeat(50) + '\n\n';
    text += analysis;
    
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `roi-analysis-${new Date().toISOString().slice(0,10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    rcShowMessage('Report exported!', 'success');
}

// Print results
function rcPrint() {
    const printContent = document.getElementById('rc-results').innerHTML;
    const originalContent = document.body.innerHTML;
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>ROI Analysis</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                h3 { color: #2dd4ff; }
                .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }
                .stat { padding: 10px; background: #f5f5f5; border-radius: 8px; text-align: center; }
                .stat-value { font-size: 20px; font-weight: bold; color: #2dd4ff; }
                .stat-label { font-size: 12px; color: #666; }
            </style>
        </head>
        <body>
            ${printContent}
            <div style="text-align:center;margin-top:30px;color:#999;font-size:12px;">
                Generated with ROI Calculator ‚Ä¢ Past performance ‚â† future results
            </div>
            <script>
                window.onload = () => window.print();
            <\/script>
        </body>
        </html>
    `);
    printWindow.document.close();
}

// Reset calculator
function rcReset() {
    if (confirm('Reset all inputs?')) {
        document.querySelector('form').reset();
        document.getElementById('rc-results').style.display = 'none';
        
        // Clear chart if exists
        if (rcChart) {
            rcChart.destroy();
            rcChart = null;
        } else {
            const canvas = document.getElementById('rc-chart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        localStorage.removeItem('rc-data');
        rcShowMessage('Calculator reset', 'info');
    }
}

// Save current settings
function rcSave() {
    rcSaveData();
    rcShowMessage('Settings saved!', 'success');
}

// Show message
function rcShowMessage(msg, type) {
    const colors = { success: '#39ff14', warning: '#ffcc00', error: '#ff2d55', info: '#2dd4ff' };
    
    // Remove existing
    const existing = document.querySelector('.rc-msg');
    if (existing) existing.remove();
    
    // Create new
    const div = document.createElement('div');
    div.className = 'rc-msg';
    div.textContent = msg;
    div.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background: rgba(0,0,0,0.9);
        border: 1px solid ${colors[type]};
        border-radius: 8px;
        color: ${colors[type]};
        z-index: 10000;
        font-weight: 500;
        animation: rcSlideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(div);
    
    setTimeout(() => {
        div.style.animation = 'rcSlideOut 0.3s ease-out';
        setTimeout(() => div.remove(), 300);
    }, 3000);
}

// Add animation styles
if (!document.querySelector('#rc-styles')) {
    const style = document.createElement('style');
    style.id = 'rc-styles';
    style.textContent = `
        @keyframes rcSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes rcSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        #rc-analysis::-webkit-scrollbar {
            width: 8px;
        }
        
        #rc-analysis::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        
        #rc-analysis::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        
        details[open] summary {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        details[open] summary ~ div {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border: 1px solid rgba(45,212,255,0.1);
            border-top: none;
        }
    `;
    document.head.appendChild(style);
}
</script>

<style>
#roi-calculator-title {
    color: var(--accent);
    margin-top: 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    #rc-chart {
        height: 180px !important;
    }
    
    #rc-analysis {
        font-size: 12px !important;
        max-height: 250px !important;
    }
    
    .grid-stats {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    
    input, button, select {
        font-size: 16px !important; /* Prevents iOS zoom */
        min-height: 44px; /* Better touch target */
    }
    
    button {
        padding: 12px !important;
    }
}
</style>
