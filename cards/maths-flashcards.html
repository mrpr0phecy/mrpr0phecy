<h2 id="maths-flashcards-title" style="margin-top:0;color:var(--accent);">üßÆ Maths Flashcards</h2>

<form aria-describedby="maths-flashcards-desc">
  <p id="maths-flashcards-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Generate random maths flashcards for quick practice. Perfect for studying, teaching, or mental math warm-ups.
    <span style="color:var(--accent);display:block;margin-top:4px;">üéØ Interactive ‚Ä¢ Timed practice ‚Ä¢ Multiple topics ‚Ä¢ Progress tracking</span>
  </p>

  <!-- CONTROL PANEL -->
  <div style="background:rgba(255,255,255,0.02);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <!-- Topic Selection -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px;">
      <div>
        <label for="mf-topic" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          üìö Topic
        </label>
        <select id="mf-topic" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;font-size:14px;">
          <option value="arithmetic" selected>‚ûï Arithmetic</option>
          <option value="algebra">‚úñÔ∏è Algebra</option>
          <option value="geometry">üìê Geometry</option>
          <option value="fractions">¬Ω Fractions</option>
          <option value="percentages">% Percentages</option>
          <option value="exponents">‚ö° Exponents</option>
          <option value="word-problems">üìù Word Problems</option>
          <option value="mental-math">üß† Mental Math</option>
          <option value="order-ops">üî¢ Order of Operations</option>
          <option value="decimals">‚®â Decimals</option>
          <option value="all">üé≤ All Topics (Mixed)</option>
        </select>
      </div>

      <div>
        <label for="mf-difficulty" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          üéØ Difficulty
        </label>
        <select id="mf-difficulty" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;font-size:14px;">
          <option value="easy" selected>Easy (Grades 1-3)</option>
          <option value="medium">Medium (Grades 4-6)</option>
          <option value="hard">Hard (Grades 7-9)</option>
          <option value="advanced">Advanced (Grades 10+)</option>
        </select>
      </div>

      <div>
        <label for="mf-count" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;font-size:14px;">
          üÉè Number of Cards
        </label>
        <select id="mf-count" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;cursor:pointer;font-size:14px;">
          <option value="3">3 Cards</option>
          <option value="5" selected>5 Cards</option>
          <option value="10">10 Cards</option>
          <option value="15">15 Cards</option>
          <option value="20">20 Cards</option>
        </select>
      </div>
    </div>

    <!-- Quick Topics Bar -->
    <div style="margin-bottom:16px;">
      <div style="color:rgba(230,250,255,0.7);margin-bottom:8px;font-size:13px;">Quick Topics:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="mfQuickTopic('arithmetic')" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;font-weight:500;">‚ûï Arithmetic</button>
        <button type="button" onclick="mfQuickTopic('algebra')" style="padding:6px 12px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:8px;color:#ff2d55;cursor:pointer;font-size:12px;font-weight:500;">‚úñÔ∏è Algebra</button>
        <button type="button" onclick="mfQuickTopic('geometry')" style="padding:6px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-size:12px;font-weight:500;">üìê Geometry</button>
        <button type="button" onclick="mfQuickTopic('fractions')" style="padding:6px 12px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;font-size:12px;font-weight:500;">¬Ω Fractions</button>
        <button type="button" onclick="mfQuickTopic('all')" style="padding:6px 12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(157,78,221,0.2));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;font-weight:600;">üé≤ Mixed All</button>
      </div>
    </div>

    <!-- Study Mode Options -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;">
      <label style="display:flex;align-items:center;gap:8px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;">
        <input type="checkbox" id="mf-show-answer" checked style="cursor:pointer;width:18px;height:18px;">
        <div>
          <div style="color:var(--accent);font-size:13px;font-weight:500;">Show Answers</div>
          <div style="color:rgba(230,250,255,0.6);font-size:11px;">Reveal immediately</div>
        </div>
      </label>

      <label style="display:flex;align-items:center;gap:8px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;">
        <input type="checkbox" id="mf-show-steps" checked style="cursor:pointer;width:18px;height:18px;">
        <div>
          <div style="color:var(--accent);font-size:13px;font-weight:500;">Show Steps</div>
          <div style="color:rgba(230,250,255,0.6);font-size:11px;">Solution steps</div>
        </div>
      </label>

      <label style="display:flex;align-items:center;gap:8px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;">
        <input type="checkbox" id="mf-random-order" style="cursor:pointer;width:18px;height:18px;">
        <div>
          <div style="color:var(--accent);font-size:13px;font-weight:500;">Random Order</div>
          <div style="color:rgba(230,250,255,0.6);font-size:11px;">Shuffle cards</div>
        </div>
      </label>

      <label style="display:flex;align-items:center;gap:8px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;">
        <input type="checkbox" id="mf-timed-mode" style="cursor:pointer;width:18px;height:18px;">
        <div>
          <div style="color:var(--accent);font-size:13px;font-weight:500;">Timed Mode</div>
          <div style="color:rgba(230,250,255,0.6);font-size:11px;">Practice with timer</div>
        </div>
      </label>
    </div>
  </div>

  <!-- ACTION BUTTONS -->
  <div style="display:flex;gap:12px;margin-bottom:20px;">
    <button type="button" onclick="mfGenerate(this)" 
            style="flex:2;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:16px;transition:all 0.2s;">
      üîÑ Generate New Flashcard Set
    </button>
    <button type="button" onclick="mfPracticeMode(this)"
            style="flex:1;padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:500;font-size:14px;">
      üèÉ Practice Mode
    </button>
    <button type="button" onclick="mfReset(this)"
            style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;">
      üîÑ Reset
    </button>
  </div>

  <!-- STATS AND TIMER -->
  <div style="display:flex;gap:16px;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <div style="display:flex;gap:16px;">
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="color:rgba(230,250,255,0.7);font-size:13px;">Cards:</div>
        <div id="mf-progress" style="color:var(--accent);font-weight:600;font-size:15px;">0</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="color:rgba(230,250,255,0.7);font-size:13px;">Time:</div>
        <div id="mf-timer" style="color:#39ff14;font-weight:600;font-size:15px;font-family:monospace;">00:00</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="color:rgba(230,250,255,0.7);font-size:13px;">Score:</div>
        <div id="mf-score" style="color:#ffcc00;font-weight:600;font-size:15px;">0/0</div>
      </div>
    </div>
    
    <div id="mf-hint" style="color:var(--accent);font-size:13px;font-weight:500;text-align:right;"></div>
  </div>
</form>

<!-- FLASHCARDS DISPLAY -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Navigation for Practice Mode -->
  <div id="mf-practice-nav" style="display:none;justify-content:space-between;align-items:center;margin-bottom:16px;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
    <button onclick="mfPrevCard()" style="padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:14px;">
      ‚èÆ Previous
    </button>
    <div style="color:var(--accent);font-weight:500;font-size:14px;">
      Card <span id="mf-current-card">1</span> of <span id="mf-total-cards">0</span>
    </div>
    <button onclick="mfNextCard()" style="padding:8px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;">
      Next ‚è≠
    </button>
  </div>

  <!-- FLASHCARDS CONTAINER -->
  <div id="mf-flashcards-container" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:16px;min-height:200px;">
    <!-- Empty State -->
    <div id="mf-empty-state" style="grid-column:1/-1;text-align:center;padding:40px 20px;color:rgba(230,250,255,0.5);border:2px dashed rgba(255,255,255,0.1);border-radius:10px;">
      <div style="font-size:48px;margin-bottom:16px;">üßÆ</div>
      <div style="font-weight:500;margin-bottom:8px;color:var(--accent);">No flashcards yet</div>
      <div style="font-size:14px;color:rgba(230,250,255,0.7);">Click "Generate New Set" to create your first flashcards!</div>
    </div>
  </div>

  <!-- USER INPUT FOR ANSWERS -->
  <div id="mf-answer-input-container" style="display:none;margin-top:20px;padding:20px;background:rgba(0,0,0,0.2);border-radius:10px;border:1px solid rgba(45,212,255,0.1);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;font-size:15px;">‚úçÔ∏è Enter your answer:</div>
    <div style="display:flex;gap:12px;align-items:center;">
      <input type="text" id="mf-user-answer" placeholder="Type your answer here..." 
             style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:16px;"
             onkeypress="if(event.key === 'Enter') mfCheckAnswer()">
      <button onclick="mfCheckAnswer()" style="padding:12px 24px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;font-size:15px;">
        ‚úÖ Check Answer
      </button>
      <button onclick="mfSkipCard()" style="padding:12px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#e6faff;cursor:pointer;font-size:14px;">
        ‚è≠ Skip
      </button>
    </div>
    <div id="mf-answer-feedback" style="margin-top:12px;padding:12px;border-radius:6px;font-size:14px;display:none;"></div>
  </div>
</div>

<!-- STUDY STATISTICS -->
<div id="mf-stats-container" style="display:none;margin-top:20px;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.05);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <div style="color:var(--accent);font-weight:600;font-size:16px;">üìä Study Statistics</div>
    <div style="display:flex;gap:8px;">
      <button onclick="mfExportStats()" style="padding:6px 12px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:12px;font-weight:500;">
        üíæ Export
      </button>
      <button onclick="mfResetStats()" style="padding:6px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;font-weight:500;">
        üîÑ Reset Stats
      </button>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px;">
    <div style="text-align:center;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
      <div style="font-size:24px;color:var(--accent);font-weight:700;" id="mf-stat-total">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Total Cards</div>
    </div>
    <div style="text-align:center;padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.1);">
      <div style="font-size:24px;color:#39ff14;font-weight:700;" id="mf-stat-correct">0</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Correct</div>
    </div>
    <div style="text-align:center;padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.1);">
      <div style="font-size:24px;color:#ffcc00;font-weight:700;" id="mf-stat-accuracy">0%</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Accuracy</div>
    </div>
    <div style="text-align:center;padding:12px;background:rgba(157,78,221,0.05);border-radius:8px;border:1px solid rgba(157,78,221,0.1);">
      <div style="font-size:24px;color:#9d4edd;font-weight:700;" id="mf-stat-avg-time">0s</div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">Avg. Time</div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
    <div>
      <div style="color:rgba(230,250,255,0.9);font-size:14px;margin-bottom:8px;">Topic Breakdown:</div>
      <div id="mf-topic-stats" style="font-size:13px;color:rgba(230,250,255,0.8);">
        No data yet
      </div>
    </div>
    <div>
      <div style="color:rgba(230,250,255,0.9);font-size:14px;margin-bottom:8px;">Performance:</div>
      <div id="mf-performance" style="font-size:13px;color:rgba(230,250,255,0.8);">
        Start practicing to see your performance!
      </div>
    </div>
  </div>
</div>

<!-- PRACTICE MODE MODAL -->
<div id="mf-practice-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10000;align-items:center;justify-content:center;backdrop-filter:blur(5px);">
  <div style="background:var(--panel);border-radius:12px;padding:24px;max-width:600px;width:90%;border:1px solid var(--border);box-shadow:0 20px 60px rgba(0,0,0,0.5);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <h3 style="color:var(--accent);margin:0;font-size:18px;">üèÉ Practice Mode</h3>
      <button onclick="mfClosePracticeModal()" style="background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:20px;">‚úï</button>
    </div>
    
    <div style="text-align:center;margin-bottom:24px;">
      <div style="font-size:64px;margin-bottom:16px;">‚è±Ô∏è</div>
      <div style="font-size:24px;color:var(--text);margin-bottom:16px;font-weight:600;">How many cards would you like to practice?</div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;">
      <button onclick="mfStartPractice(5)" style="padding:16px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;">
        5 Cards<br><span style="font-size:12px;opacity:0.8;">Quick Session</span>
      </button>
      <button onclick="mfStartPractice(10)" style="padding:16px;background:rgba(57,255,20,0.1);border:2px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;font-size:15px;">
        10 Cards<br><span style="font-size:12px;opacity:0.8;">Standard</span>
      </button>
      <button onclick="mfStartPractice(20)" style="padding:16px;background:rgba(255,204,0,0.1);border:2px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;font-weight:600;font-size:15px;">
        20 Cards<br><span style="font-size:12px;opacity:0.8;">Full Practice</span>
      </button>
    </div>
    
    <div style="text-align:center;color:rgba(230,250,255,0.7);font-size:14px;">
      <div>üèÜ Complete the set to improve your score</div>
      <div>‚è∞ Timer will start when you begin</div>
    </div>
  </div>
</div>

<script>
/* maths-flashcards.html
   Enhanced interactive maths flashcards with practice mode and statistics
   Scoped with 'mf' prefix (maths flashcards)
*/

// ENHANCED FLASHCARD GENERATOR
class FlashcardGenerator {
  static generateArithmetic(difficulty) {
    const ops = ['+', '-', '√ó', '√∑'];
    let maxNum, decimals, allowNegative;
    
    switch(difficulty) {
      case 'easy':
        maxNum = 20;
        decimals = 0;
        allowNegative = false;
        break;
      case 'medium':
        maxNum = 100;
        decimals = Math.random() > 0.8 ? 1 : 0;
        allowNegative = false;
        break;
      case 'hard':
        maxNum = 500;
        decimals = Math.random() > 0.6 ? 1 : 0;
        allowNegative = true;
        break;
      case 'advanced':
        maxNum = 1000;
        decimals = Math.random() > 0.4 ? 1 : 0;
        allowNegative = true;
        break;
    }
    
    const op = ops[Math.floor(Math.random() * ops.length)];
    let num1 = this.randomNumber(maxNum, decimals);
    let num2 = this.randomNumber(maxNum, decimals);
    
    // Adjust for division
    if (op === '√∑' && difficulty !== 'hard' && difficulty !== 'advanced') {
      num1 = Math.round(num1 * num2 * 10) / 10; // Ensure it divides cleanly
      if (num1 === 0) num1 = 1;
    }
    
    // Adjust for subtraction (avoid negative in easy mode)
    if (op === '-' && !allowNegative && num1 < num2) {
      [num1, num2] = [num2, num1];
    }
    
    const question = `${num1} ${op} ${num2} = ?`;
    let answer;
    switch(op) {
      case '+': answer = num1 + num2; break;
      case '-': answer = num1 - num2; break;
      case '√ó': answer = num1 * num2; break;
      case '√∑': answer = num1 / num2; break;
    }
    
    // Format answer
    answer = this.formatAnswer(answer);
    
    const steps = this.getArithmeticSteps(num1, num2, op, answer);
    
    return {
      question,
      answer,
      steps,
      topic: 'arithmetic',
      difficulty,
      type: 'arithmetic'
    };
  }
  
  static generateAlgebra(difficulty) {
    let question, answer, steps;
    
    switch(difficulty) {
      case 'easy':
        // x + a = b
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 15) + a + 1;
        question = `x + ${a} = ${b}`;
        answer = b - a;
        steps = `x = ${b} - ${a} = ${answer}`;
        break;
        
      case 'medium':
        // ax + b = c
        const coef = Math.floor(Math.random() * 5) + 2;
        const const1 = Math.floor(Math.random() * 20) + 5;
        const result = coef * 3 + const1;
        question = `${coef}x + ${const1} = ${result}`;
        answer = 3;
        steps = `${coef}x = ${result} - ${const1} = ${result - const1}<br>x = ${result - const1} √∑ ${coef} = 3`;
        break;
        
      case 'hard':
        // Quadratic
        const root1 = Math.floor(Math.random() * 5) + 1;
        const root2 = Math.floor(Math.random() * 5) + 1;
        const sum = root1 + root2;
        const product = root1 * root2;
        question = `Solve: x¬≤ - ${sum}x + ${product} = 0`;
        answer = `x = ${root1}, ${root2}`;
        steps = `Factor: (x - ${root1})(x - ${root2}) = 0<br>Solutions: x = ${root1}, x = ${root2}`;
        break;
        
      case 'advanced':
        // System of equations
        const x1 = Math.floor(Math.random() * 4) + 2;
        const y1 = Math.floor(Math.random() * 4) + 2;
        const eq1 = `2x + 3y = ${2*x1 + 3*y1}`;
        const eq2 = `x - y = ${x1 - y1}`;
        question = `Solve: ${eq1}<br>${eq2}`;
        answer = `x = ${x1}, y = ${y1}`;
        steps = `From equation 2: x = y + ${x1 - y1}<br>Substitute into equation 1: 2(y + ${x1 - y1}) + 3y = ${2*x1 + 3*y1}<br>Solve for y: y = ${y1}, then x = ${x1}`;
        break;
    }
    
    return {
      question,
      answer,
      steps,
      topic: 'algebra',
      difficulty,
      type: 'algebra'
    };
  }
  
  static generateGeometry(difficulty) {
    const shapes = ['rectangle', 'triangle', 'circle', 'square', 'cube', 'sphere'];
    const shape = shapes[Math.floor(Math.random() * shapes.length)];
    let question, answer, steps;
    
    switch(difficulty) {
      case 'easy':
        // Area of rectangle
        const l = Math.floor(Math.random() * 12) + 3;
        const w = Math.floor(Math.random() * 10) + 2;
        question = `Area of ${l}√ó${w} rectangle?`;
        answer = l * w;
        steps = `Area = length √ó width = ${l} √ó ${w} = ${l * w}`;
        break;
        
      case 'medium':
        // Area of circle
        const r = Math.floor(Math.random() * 10) + 2;
        question = `Area of circle with radius ${r}?`;
        answer = (Math.PI * r * r).toFixed(2);
        steps = `Area = œÄr¬≤ = 3.14 √ó ${r}¬≤ = ${answer}`;
        break;
        
      case 'hard':
        // Volume of cylinder
        const radius = Math.floor(Math.random() * 8) + 2;
        const height = Math.floor(Math.random() * 12) + 3;
        question = `Volume of cylinder: r = ${radius}, h = ${height}`;
        answer = (Math.PI * radius * radius * height).toFixed(2);
        steps = `Volume = œÄr¬≤h = 3.14 √ó ${radius}¬≤ √ó ${height} = ${answer}`;
        break;
        
      case 'advanced':
        // Pythagorean theorem
        const a = Math.floor(Math.random() * 8) + 3;
        const b = Math.floor(Math.random() * 8) + 3;
        question = `Hypotenuse of right triangle: legs = ${a}, ${b}`;
        answer = Math.sqrt(a*a + b*b).toFixed(2);
        steps = `c = ‚àö(a¬≤ + b¬≤) = ‚àö(${a}¬≤ + ${b}¬≤) = ‚àö(${a*a} + ${b*b}) = ${answer}`;
        break;
    }
    
    return {
      question,
      answer,
      steps,
      topic: 'geometry',
      difficulty,
      type: 'geometry'
    };
  }
  
  static generateFractions(difficulty) {
    let question, answer, steps;
    
    switch(difficulty) {
      case 'easy':
        // Simplify fraction
        const num = Math.floor(Math.random() * 6) + 2;
        const den = num * (Math.floor(Math.random() * 4) + 2);
        question = `Simplify ${den}/${num}`;
        answer = `${den/num}`;
        steps = `Divide numerator and denominator by ${num}: ${den}/${num} = ${den/num}`;
        break;
        
      case 'medium':
        // Add fractions
        const f1_num = Math.floor(Math.random() * 5) + 1;
        const f1_den = Math.floor(Math.random() * 6) + 3;
        const f2_num = Math.floor(Math.random() * 5) + 1;
        const f2_den = Math.floor(Math.random() * 6) + 3;
        question = `Add: ${f1_num}/${f1_den} + ${f2_num}/${f2_den}`;
        const lcd = f1_den * f2_den;
        const sumNum = f1_num * f2_den + f2_num * f1_den;
        answer = `${sumNum}/${lcd}`;
        steps = `LCD = ${lcd}<br>${f1_num}/${f1_den} = ${f1_num * f2_den}/${lcd}<br>${f2_num}/${f2_den} = ${f2_num * f1_den}/${lcd}<br>Sum = ${answer}`;
        break;
        
      case 'hard':
        // Multiply fractions
        const f3_num = Math.floor(Math.random() * 7) + 2;
        const f3_den = Math.floor(Math.random() * 7) + 3;
        const f4_num = Math.floor(Math.random() * 7) + 2;
        const f4_den = Math.floor(Math.random() * 7) + 3;
        question = `Multiply: ${f3_num}/${f3_den} √ó ${f4_num}/${f4_den}`;
        const prodNum = f3_num * f4_num;
        const prodDen = f3_den * f4_den;
        answer = `${prodNum}/${prodDen}`;
        steps = `Multiply numerators: ${f3_num} √ó ${f4_num} = ${prodNum}<br>Multiply denominators: ${f3_den} √ó ${f4_den} = ${prodDen}`;
        break;
    }
    
    return {
      question,
      answer,
      steps,
      topic: 'fractions',
      difficulty,
      type: 'fractions'
    };
  }
  
  static randomNumber(max, decimals = 0) {
    const num = Math.random() * max;
    return decimals === 0 ? Math.floor(num) + 1 : parseFloat(num.toFixed(decimals)) + 0.1;
  }
  
  static formatAnswer(answer) {
    if (typeof answer === 'number') {
      return Number.isInteger(answer) ? answer.toString() : answer.toFixed(2);
    }
    return answer;
  }
  
  static getArithmeticSteps(num1, num2, op, answer) {
    switch(op) {
      case '+': return `${num1} + ${num2} = ${answer}`;
      case '-': return `${num1} - ${num2} = ${answer}`;
      case '√ó': return `${num1} √ó ${num2} = ${answer}`;
      case '√∑': return `${num1} √∑ ${num2} = ${answer}<br>Check: ${num2} √ó ${answer} = ${num1}`;
      default: return `Calculate: ${num1} ${op} ${num2} = ${answer}`;
    }
  }
  
  static generate(topic, difficulty) {
    const generators = {
      'arithmetic': this.generateArithmetic,
      'algebra': this.generateAlgebra,
      'geometry': this.generateGeometry,
      'fractions': this.generateFractions,
      'percentages': this.generatePercentage,
      'exponents': this.generateExponents,
      'word-problems': this.generateWordProblem,
      'mental-math': this.generateMentalMath,
      'order-ops': this.generateOrderOps,
      'decimals': this.generateDecimals
    };
    
    // If topic is 'all', pick random topic
    const actualTopic = topic === 'all' 
      ? Object.keys(generators)[Math.floor(Math.random() * (Object.keys(generators).length - 1))]
      : topic;
    
    const generator = generators[actualTopic];
    return generator ? generator.call(this, difficulty) : this.generateArithmetic(difficulty);
  }
  
  static generatePercentage(difficulty) {
    const percent = Math.floor(Math.random() * 50) + 10;
    const number = Math.floor(Math.random() * 200) + 50;
    const question = `What is ${percent}% of ${number}?`;
    const answer = number * percent / 100;
    const steps = `${percent}% = ${percent/100}<br>${percent/100} √ó ${number} = ${answer}`;
    return { question, answer: answer.toFixed(2), steps, topic: 'percentages', type: 'percentages' };
  }
  
  static generateExponents(difficulty) {
    const base = Math.floor(Math.random() * 6) + 2;
    const exp = Math.floor(Math.random() * 4) + 2;
    const question = `Calculate: ${base}^${exp}`;
    const answer = Math.pow(base, exp);
    const steps = `${base} √ó ${base} `.repeat(exp-1).trim() + ` = ${answer}`;
    return { question, answer, steps, topic: 'exponents', type: 'exponents' };
  }
  
  static generateDecimals(difficulty) {
    const num1 = (Math.random() * 100).toFixed(1);
    const num2 = (Math.random() * 100).toFixed(1);
    const op = Math.random() > 0.5 ? '+' : '-';
    const question = `${num1} ${op} ${num2} = ?`;
    let answer;
    if (op === '+') answer = (parseFloat(num1) + parseFloat(num2)).toFixed(1);
    else answer = (parseFloat(num1) - parseFloat(num2)).toFixed(1);
    const steps = `Align decimals and ${op === '+' ? 'add' : 'subtract'}: ${num1} ${op} ${num2} = ${answer}`;
    return { question, answer, steps, topic: 'decimals', type: 'decimals' };
  }
}

// MAIN APPLICATION STATE
let mfState = {
  flashcards: [],
  currentCardIndex: 0,
  practiceMode: false,
  timer: null,
  startTime: null,
  stats: {
    totalCards: 0,
    correctAnswers: 0,
    totalTime: 0,
    topicStats: {},
    sessionStart: null
  },
  practiceStats: {
    currentSet: [],
    userAnswers: [],
    startTime: null
  }
};

// Initialize from localStorage
function mfLoadState() {
  try {
    const saved = localStorage.getItem('mf-stats');
    if (saved) {
      mfState.stats = { ...mfState.stats, ...JSON.parse(saved) };
      mfUpdateStatsDisplay();
    }
  } catch (e) {
    console.log('Could not load saved stats');
  }
}

// Save state to localStorage
function mfSaveState() {
  try {
    localStorage.setItem('mf-stats', JSON.stringify(mfState.stats));
  } catch (e) {
    console.log('Could not save stats');
  }
}

// Generate flashcards
function mfGenerate(btn) {
  const card = btn.closest('.card') || document;
  const topic = card.querySelector('#mf-topic').value;
  const difficulty = card.querySelector('#mf-difficulty').value;
  const count = parseInt(card.querySelector('#mf-count').value);
  const showAnswer = card.querySelector('#mf-show-answer').checked;
  const showSteps = card.querySelector('#mf-show-steps').checked;
  const randomOrder = card.querySelector('#mf-random-order').checked;
  const timedMode = card.querySelector('#mf-timed-mode').checked;
  
  // Generate flashcards
  mfState.flashcards = [];
  for (let i = 0; i < count; i++) {
    const flashcard = FlashcardGenerator.generate(topic, difficulty);
    mfState.flashcards.push({
      ...flashcard,
      id: i + 1,
      revealed: showAnswer,
      userAnswer: '',
      isCorrect: null,
      timeTaken: 0
    });
  }
  
  // Randomize order
  if (randomOrder) {
    mfState.flashcards = mfState.flashcards.sort(() => Math.random() - 0.5);
  }
  
  // Update stats
  mfState.stats.totalCards += count;
  mfState.stats.sessionStart = Date.now();
  
  // Display flashcards
  mfDisplayFlashcards(card);
  
  // Update UI
  card.querySelector('#mf-progress').textContent = count;
  card.querySelector('#mf-score').textContent = '0/0';
  card.querySelector('#mf-hint').textContent = 'üéØ Flashcards generated! Click cards to reveal answers.';
  card.querySelector('#mf-hint').style.color = 'var(--accent)';
  
  // Show/hide practice elements
  card.querySelector('#mf-practice-nav').style.display = 'none';
  card.querySelector('#mf-answer-input-container').style.display = 'none';
  card.querySelector('#mf-stats-container').style.display = 'block';
  
  // Start timer if in timed mode
  if (timedMode) {
    mfStartTimer();
  }
  
  mfUpdateStatsDisplay();
  mfSaveState();
  
  // Visual feedback
  btn.innerHTML = '‚úÖ Generated!';
  setTimeout(() => {
    btn.innerHTML = 'üîÑ Generate New Flashcard Set';
  }, 1000);
}

// Display flashcards in container
function mfDisplayFlashcards(card) {
  const container = card.querySelector('#mf-flashcards-container');
  const emptyState = card.querySelector('#mf-empty-state');
  
  if (mfState.flashcards.length === 0) {
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  container.innerHTML = '';
  
  mfState.flashcards.forEach((fc, index) => {
    const cardEl = document.createElement('div');
    cardEl.className = 'flashcard';
    cardEl.dataset.index = index;
    cardEl.style.cssText = `
      background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04));
      border: 1px solid ${mfGetCardBorderColor(fc)};
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    `;
    
    cardEl.innerHTML = `
      <div style="position:absolute;top:12px;right:12px;font-size:11px;color:${mfGetTopicColor(fc.topic)};">
        #${fc.id} ‚Ä¢ ${fc.topic} ‚Ä¢ ${fc.difficulty}
      </div>
      
      <div style="font-weight:600;color:var(--accent);margin-bottom:16px;font-size:18px;text-align:center;">
        ${fc.question}
      </div>
      
      <div id="mf-answer-${index}" style="${fc.revealed ? '' : 'display:none;'}margin-top:16px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:8px;font-size:16px;">
          ‚úÖ Answer: ${fc.answer}
        </div>
        ${fc.isCorrect !== null ? `
          <div style="margin-bottom:8px;padding:8px;border-radius:6px;background:${fc.isCorrect ? 'rgba(57,255,20,0.1)' : 'rgba(255,45,85,0.1)'};border:1px solid ${fc.isCorrect ? 'rgba(57,255,20,0.3)' : 'rgba(255,45,85,0.3)'};">
            Your answer: <span style="color:${fc.isCorrect ? '#39ff14' : '#ff2d55'}">${fc.userAnswer || 'Not answered'}</span>
          </div>
        ` : ''}
        <div style="font-size:14px;color:rgba(230,250,255,0.8);margin-top:8px;line-height:1.5;">
          ${fc.steps}
        </div>
      </div>
      
      ${!fc.revealed ? `
        <div style="text-align:center;margin-top:16px;">
          <button onclick="mfRevealCard(${index})" 
                  style="padding:10px 20px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-size:14px;font-weight:500;">
            üëÅÔ∏è Reveal Answer
          </button>
        </div>
      ` : ''}
      
      ${fc.timeTaken > 0 ? `
        <div style="position:absolute;bottom:8px;left:12px;font-size:11px;color:rgba(230,250,255,0.6);">
          Time: ${fc.timeTaken}s
        </div>
      ` : ''}
    `;
    
    // Add hover effect
    cardEl.addEventListener('mouseenter', () => {
      cardEl.style.transform = 'translateY(-4px)';
      cardEl.style.boxShadow = '0 8px 24px rgba(0,0,0,0.3)';
    });
    
    cardEl.addEventListener('mouseleave', () => {
      cardEl.style.transform = '';
      cardEl.style.boxShadow = '';
    });
    
    // Click to reveal
    cardEl.addEventListener('click', (e) => {
      if (!e.target.closest('button')) {
        mfRevealCard(index);
      }
    });
    
    container.appendChild(cardEl);
  });
}

// Reveal a specific card
function mfRevealCard(index) {
  if (index >= 0 && index < mfState.flashcards.length) {
    mfState.flashcards[index].revealed = true;
    mfDisplayFlashcards(document.currentScript?.closest('.card') || document);
  }
}

// Practice mode functions
function mfPracticeMode(btn) {
  document.getElementById('mf-practice-modal').style.display = 'flex';
}

function mfClosePracticeModal() {
  document.getElementById('mf-practice-modal').style.display = 'none';
}

function mfStartPractice(count) {
  const card = document.currentScript?.closest('.card') || document;
  const topic = card.querySelector('#mf-topic').value;
  const difficulty = card.querySelector('#mf-difficulty').value;
  
  // Generate practice set
  mfState.practiceStats.currentSet = [];
  mfState.practiceStats.userAnswers = [];
  mfState.practiceStats.startTime = Date.now();
  
  for (let i = 0; i < count; i++) {
    const flashcard = FlashcardGenerator.generate(topic, difficulty);
    mfState.practiceStats.currentSet.push({
      ...flashcard,
      id: i + 1,
      userAnswer: '',
      isCorrect: null,
      startTime: Date.now()
    });
  }
  
  mfState.currentCardIndex = 0;
  mfState.practiceMode = true;
  
  // Update UI
  mfClosePracticeModal();
  card.querySelector('#mf-practice-nav').style.display = 'flex';
  card.querySelector('#mf-answer-input-container').style.display = 'block';
  card.querySelector('#mf-answer-input-container input').focus();
  
  // Show first card
  mfShowPracticeCard();
}

function mfShowPracticeCard() {
  const card = document.currentScript?.closest('.card') || document;
  const container = card.querySelector('#mf-flashcards-container');
  const currentCard = mfState.practiceStats.currentSet[mfState.currentCardIndex];
  
  if (!currentCard) return;
  
  container.innerHTML = `
    <div style="grid-column:1/-1;text-align:center;padding:40px 20px;">
      <div style="font-size:64px;margin-bottom:24px;">üßÆ</div>
      <div style="font-size:28px;color:var(--accent);margin-bottom:16px;font-weight:600;line-height:1.4;">
        ${currentCard.question}
      </div>
      <div style="color:rgba(230,250,255,0.7);font-size:16px;margin-top:24px;">
        Topic: ${currentCard.topic} ‚Ä¢ Difficulty: ${currentCard.difficulty}
      </div>
    </div>
  `;
  
  // Update navigation
  card.querySelector('#mf-current-card').textContent = mfState.currentCardIndex + 1;
  card.querySelector('#mf-total-cards').textContent = mfState.practiceStats.currentSet.length;
  
  // Clear feedback
  card.querySelector('#mf-answer-feedback').style.display = 'none';
  card.querySelector('#mf-user-answer').value = '';
}

function mfCheckAnswer() {
  const card = document.currentScript?.closest('.card') || document;
  const userAnswer = card.querySelector('#mf-user-answer').value.trim();
  const currentCard = mfState.practiceStats.currentSet[mfState.currentCardIndex];
  const feedbackEl = card.querySelector('#mf-answer-feedback');
  
  if (!userAnswer) {
    feedbackEl.innerHTML = '‚ö†Ô∏è Please enter an answer';
    feedbackEl.style.display = 'block';
    feedbackEl.style.background = 'rgba(255,204,0,0.1)';
    feedbackEl.style.border = '1px solid rgba(255,204,0,0.3)';
    feedbackEl.style.color = '#ffcc00';
    return;
  }
  
  // Check answer (simple string comparison for now)
  const correct = userAnswer === currentCard.answer.toString();
  currentCard.userAnswer = userAnswer;
  currentCard.isCorrect = correct;
  currentCard.timeTaken = Math.floor((Date.now() - currentCard.startTime) / 1000);
  
  // Update stats
  mfState.stats.totalCards++;
  if (correct) {
    mfState.stats.correctAnswers++;
  }
  
  // Update topic stats
  if (!mfState.stats.topicStats[currentCard.topic]) {
    mfState.stats.topicStats[currentCard.topic] = { correct: 0, total: 0 };
  }
  mfState.stats.topicStats[currentCard.topic].total++;
  if (correct) mfState.stats.topicStats[currentCard.topic].correct++;
  
  // Show feedback
  if (correct) {
    feedbackEl.innerHTML = `
      ‚úÖ <strong>Correct!</strong> The answer is ${currentCard.answer}<br>
      <div style="margin-top:8px;color:rgba(230,250,255,0.8);font-size:13px;">${currentCard.steps}</div>
    `;
    feedbackEl.style.background = 'rgba(57,255,20,0.1)';
    feedbackEl.style.border = '1px solid rgba(57,255,20,0.3)';
    feedbackEl.style.color = '#39ff14';
  } else {
    feedbackEl.innerHTML = `
      ‚ùå <strong>Incorrect.</strong> The correct answer is ${currentCard.answer}<br>
      <div style="margin-top:8px;color:rgba(230,250,255,0.8);font-size:13px;">${currentCard.steps}</div>
    `;
    feedbackEl.style.background = 'rgba(255,45,85,0.1)';
    feedbackEl.style.border = '1px solid rgba(255,45,85,0.3)';
    feedbackEl.style.color = '#ff2d55';
  }
  
  feedbackEl.style.display = 'block';
  
  // Update score
  const correctCount = mfState.practiceStats.userAnswers.filter(a => a.isCorrect).length;
  card.querySelector('#mf-score').textContent = `${correctCount + (correct ? 1 : 0)}/${mfState.currentCardIndex + 1}`;
  
  mfSaveState();
  mfUpdateStatsDisplay();
}

function mfSkipCard() {
  mfState.currentCardIndex++;
  if (mfState.currentCardIndex >= mfState.practiceStats.currentSet.length) {
    mfCompletePractice();
  } else {
    mfShowPracticeCard();
  }
}

function mfNextCard() {
  mfState.currentCardIndex++;
  if (mfState.currentCardIndex >= mfState.practiceStats.currentSet.length) {
    mfState.currentCardIndex = mfState.practiceStats.currentSet.length - 1;
  }
  mfShowPracticeCard();
}

function mfPrevCard() {
  mfState.currentCardIndex--;
  if (mfState.currentCardIndex < 0) {
    mfState.currentCardIndex = 0;
  }
  mfShowPracticeCard();
}

function mfCompletePractice() {
  const card = document.currentScript?.closest('.card') || document;
  const correctCount = mfState.practiceStats.userAnswers.filter(a => a.isCorrect).length;
  const total = mfState.practiceStats.currentSet.length;
  const accuracy = Math.round((correctCount / total) * 100);
  
  card.querySelector('#mf-hint').innerHTML = `
    üèÜ Practice complete! Score: ${correctCount}/${total} (${accuracy}%)
  `;
  card.querySelector('#mf-hint').style.color = '#39ff14';
  
  // Hide practice UI
  card.querySelector('#mf-practice-nav').style.display = 'none';
  card.querySelector('#mf-answer-input-container').style.display = 'none';
  card.querySelector('#mf-flashcards-container').innerHTML = '';
  
  mfState.practiceMode = false;
}

// Timer functions
function mfStartTimer() {
  mfState.startTime = Date.now();
  mfState.timer = setInterval(() => {
    const elapsed = Math.floor((Date.now() - mfState.startTime) / 1000);
    const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
    const secs = (elapsed % 60).toString().padStart(2, '0');
    const timerEl = document.querySelector('#mf-timer');
    if (timerEl) {
      timerEl.textContent = `${mins}:${secs}`;
    }
  }, 1000);
}

// Stats functions
function mfUpdateStatsDisplay() {
  const accuracy = mfState.stats.totalCards > 0 
    ? Math.round((mfState.stats.correctAnswers / mfState.stats.totalCards) * 100)
    : 0;
  
  const avgTime = mfState.stats.totalCards > 0
    ? Math.round(mfState.stats.totalTime / mfState.stats.totalCards)
    : 0;
  
  document.getElementById('mf-stat-total').textContent = mfState.stats.totalCards;
  document.getElementById('mf-stat-correct').textContent = mfState.stats.correctAnswers;
  document.getElementById('mf-stat-accuracy').textContent = `${accuracy}%`;
  document.getElementById('mf-stat-avg-time').textContent = `${avgTime}s`;
  
  // Update topic stats
  let topicHtml = '';
  for (const [topic, stat] of Object.entries(mfState.stats.topicStats)) {
    const topicAccuracy = Math.round((stat.correct / stat.total) * 100);
    topicHtml += `<div>${topic}: ${stat.correct}/${stat.total} (${topicAccuracy}%)</div>`;
  }
  document.getElementById('mf-topic-stats').innerHTML = topicHtml || 'No data yet';
  
  // Update performance text
  let performance = '';
  if (mfState.stats.totalCards > 0) {
    if (accuracy >= 90) {
      performance = 'Excellent! üéØ Keep up the great work!';
    } else if (accuracy >= 70) {
      performance = 'Good job! üëç Practice makes perfect.';
    } else if (accuracy >= 50) {
      performance = 'Keep practicing! üìö You\'re improving.';
    } else {
      performance = 'Focus on understanding concepts. üìñ You can do it!';
    }
  }
  document.getElementById('mf-performance').textContent = performance;
}

function mfExportStats() {
  const stats = {
    ...mfState.stats,
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(stats, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `maths-flashcards-stats-${new Date().toISOString().split('T')[0]}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
}

function mfResetStats() {
  if (confirm('Reset all statistics? This cannot be undone.')) {
    mfState.stats = {
      totalCards: 0,
      correctAnswers: 0,
      totalTime: 0,
      topicStats: {},
      sessionStart: null
    };
    mfUpdateStatsDisplay();
    mfSaveState();
    
    document.querySelector('#mf-hint').innerHTML = 'üìä Statistics reset';
    document.querySelector('#mf-hint').style.color = 'var(--accent)';
  }
}

// Helper functions
function mfGetCardBorderColor(card) {
  if (card.isCorrect === true) return 'rgba(57,255,20,0.4)';
  if (card.isCorrect === false) return 'rgba(255,45,85,0.4)';
  return 'rgba(45,212,255,0.15)';
}

function mfGetTopicColor(topic) {
  const colors = {
    'arithmetic': 'var(--accent)',
    'algebra': '#ff2d55',
    'geometry': '#39ff14',
    'fractions': '#ffcc00',
    'percentages': '#9d4edd',
    'exponents': '#2dd4ff',
    'decimals': '#ff9500'
  };
  return colors[topic] || 'rgba(230,250,255,0.7)';
}

function mfQuickTopic(topic) {
  const card = document.currentScript?.closest('.card') || document;
  const select = card.querySelector('#mf-topic');
  select.value = topic;
  
  // Update hint
  const hint = card.querySelector('#mf-hint');
  hint.textContent = `Topic set to: ${topic}. Ready to generate!`;
  hint.style.color = 'var(--accent)';
}

function mfReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Clear state
  mfState.flashcards = [];
  mfState.currentCardIndex = 0;
  mfState.practiceMode = false;
  
  // Clear UI
  card.querySelector('#mf-flashcards-container').innerHTML = '';
  card.querySelector('#mf-empty-state').style.display = 'block';
  card.querySelector('#mf-practice-nav').style.display = 'none';
  card.querySelector('#mf-answer-input-container').style.display = 'none';
  card.querySelector('#mf-progress').textContent = '0';
  card.querySelector('#mf-timer').textContent = '00:00';
  card.querySelector('#mf-score').textContent = '0/0';
  card.querySelector('#mf-hint').textContent = '';
  
  // Reset inputs to defaults
  card.querySelector('#mf-topic').selectedIndex = 0;
  card.querySelector('#mf-difficulty').selectedIndex = 0;
  card.querySelector('#mf-count').selectedIndex = 1;
  card.querySelector('#mf-show-answer').checked = true;
  card.querySelector('#mf-show-steps').checked = true;
  card.querySelector('#mf-random-order').checked = false;
  card.querySelector('#mf-timed-mode').checked = false;
  
  // Visual feedback
  btn.textContent = '‚úÖ Reset!';
  setTimeout(() => {
    btn.textContent = 'üîÑ Reset';
  }, 1000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    mfLoadState();
    console.log('Maths Flashcards loaded with', mfState.stats.totalCards, 'cards in history');
  });
}
</script>

<!-- CARD-SPECIFIC STYLES -->
<style>
#maths-flashcards-title {
  background: linear-gradient(135deg, var(--accent), #9d4edd);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

/* Animations */
@keyframes cardAppear {
  from { opacity: 0; transform: translateY(20px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.flashcard {
  animation: cardAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.flashcard:hover {
  transform: translateY(-4px) !important;
  box-shadow: 0 12px 32px rgba(0,0,0,0.3) !important;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@keyframes correct {
  0% { background: rgba(57,255,20,0.1); }
  50% { background: rgba(57,255,20,0.3); }
  100% { background: rgba(57,255,20,0.1); }
}

@keyframes incorrect {
  0% { background: rgba(255,45,85,0.1); }
  50% { background: rgba(255,45,85,0.3); }
  100% { background: rgba(255,45,85,0.1); }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  #mf-controls-grid {
    grid-template-columns: 1fr !important;
  }
  
  #mf-flashcards-container {
    grid-template-columns: 1fr !important;
  }
  
  #mf-action-buttons {
    flex-direction: column !important;
  }
  
  #mf-action-buttons button {
    width: 100% !important;
    margin: 4px 0 !important;
  }
  
  #mf-stats-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  #mf-answer-input-container > div {
    flex-direction: column !important;
  }
  
  #mf-answer-input-container button {
    width: 100% !important;
    margin: 4px 0 !important;
  }
}

/* Print styles */
@media print {
  .flashcard {
    break-inside: avoid;
    border: 2px solid #000 !important;
    background: white !important;
    color: black !important;
  }
  
  button, #mf-hint, #mf-timer, #mf-practice-nav, #mf-answer-input-container, #mf-stats-container {
    display: none !important;
  }
}

/* Accessibility improvements */
.flashcard:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

input:focus, select:focus, button:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Custom scrollbar for stats */
#mf-topic-stats {
  max-height: 100px;
  overflow-y: auto;
  padding-right: 8px;
}

#mf-topic-stats::-webkit-scrollbar {
  width: 6px;
}

#mf-topic-stats::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#mf-topic-stats::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
}
</style>
