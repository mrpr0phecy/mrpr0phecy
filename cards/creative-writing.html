<h2 id="creative-writing-title" style="margin-top:0;">Creative Writing Assistant</h2>

<form aria-describedby="creative-writing-desc">
  <p id="creative-writing-desc" class="small">Generate story starters, character sketches, scene outlines, and short prompts. Choose genre, tone, and length, then refine or export the opening paragraph.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="cw-genre">Genre</label>
      <select id="cw-genre" style="width:100%;">
        <option>Literary</option>
        <option>Speculative / Sci‑Fi</option>
        <option>Fantasy</option>
        <option>Mystery / Thriller</option>
        <option>Romance</option>
        <option>Historical</option>
        <option>Horror</option>
      </select>
    </div>

    <div class="field">
      <label for="cw-tone">Tone</label>
      <select id="cw-tone" style="width:100%;">
        <option>Dark</option>
        <option>Witty</option>
        <option>Melancholic</option>
        <option>Hopeful</option>
        <option>Suspenseful</option>
        <option>Playful</option>
      </select>
    </div>

    <div class="field" style="grid-column:1 / -1;">
      <label for="cw-prompt">Prompt / Idea (optional)</label>
      <input id="cw-prompt" type="text" placeholder="A lonely lighthouse keeper; a lost letter; a broken clock" style="width:100%;" />
    </div>

    <div class="field">
      <label for="cw-length">Length</label>
      <select id="cw-length" style="width:100%;">
        <option value="80">Micro (≈80 words)</option>
        <option value="200" selected>Short (≈200 words)</option>
        <option value="500">Scene (≈500 words)</option>
      </select>
    </div>

    <div class="field">
      <label for="cw-focus">Focus</label>
      <select id="cw-focus" style="width:100%;">
        <option>Opening paragraph</option>
        <option>Character sketch</option>
        <option>Scene description</option>
        <option>Plot outline (3 beats)</option>
        <option>Dialogue snippet</option>
      </select>
    </div>

    <div class="field" style="grid-column:1 / -1;">
      <label for="cw-constraints">Constraints (optional)</label>
      <input id="cw-constraints" type="text" placeholder="e.g. single sentence, second person, no dialogue" style="width:100%;" />
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="cwGenerate(this)">Generate</button>
    <button type="button" class="secondary" onclick="cwReset(this)">Reset</button>
    <button type="button" onclick="cwCopy(this)">Copy</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Output</h3>
  <textarea id="cw-output" rows="10" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>

  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div class="small">Estimated words: <span id="cw-wordcount">0</span></div>
    <div id="cw-hint" class="small" style="opacity:0.9;"></div>
  </div>

  <h4 class="small" style="margin-top:12px;">Quick tools</h4>
  <div style="display:flex;gap:8px;flex-wrap:wrap;">
    <button type="button" class="tiny" onclick="cwExpand(this)">Expand</button>
    <button type="button" class="tiny" onclick="cwCondense(this)">Condense</button>
    <button type="button" class="tiny" onclick="cwToneShift(this)">Shift Tone</button>
    <button type="button" class="tiny" onclick="cwCharacterSheet(this)">Character Sheet</button>
  </div>
</div>

<script>
/* Creative Writing Assistant
   - Generates creative outputs locally using deterministic scaffolding and simple transformations.
   - All DOM queries scoped via btn.closest('.card') so multiple instances are safe.
   - This is a writing helper; it does not call external APIs.
*/

function cwReset(btn) {
  const card = btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#cw-output').value = "";
  card.querySelector('#cw-wordcount').textContent = "0";
  card.querySelector('#cw-hint').textContent = "";
}

function cwCopy(btn) {
  const card = btn.closest('.card');
  const out = card.querySelector('#cw-output').value;
  if (!out.trim()) return;
  navigator.clipboard?.writeText(out).then(() => {
    const hint = card.querySelector('#cw-hint');
    hint.textContent = "Copied to clipboard.";
    setTimeout(() => { if (hint.textContent === "Copied to clipboard.") hint.textContent = ""; }, 1600);
  }).catch(() => {
    alert("Copy failed — select the text and copy manually.");
  });
}

function cwGenerate(btn) {
  const card = btn.closest('.card');
  const genre = card.querySelector('#cw-genre').value
