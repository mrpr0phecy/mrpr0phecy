<h2 id="cover-letter-builder-title" style="margin-top:0;color:#4a90e2 !important;">‚úçÔ∏è Cover Letter Builder</h2>

<form aria-describedby="cl-desc">
    <p id="cl-desc" class="small">
        <span style="color:#4a90e2;font-weight:600">PROFESSIONAL TOOL</span> - Create tailored cover letters with industry-specific templates, ATS optimization, and professional tone analysis. Used by career coaches worldwide.
    </p>
    
    <!-- TEMPLATE SELECTOR -->
    <div style="margin-bottom:20px;padding:12px;background:rgba(74,144,226,0.1);border-radius:8px;border:1px solid rgba(74,144,226,0.3);">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">üéØ Select Template</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="clSelectTemplate('standard')" class="cl-template-btn cl-active" data-template="standard">
                üìÑ Standard
            </button>
            <button type="button" onclick="clSelectTemplate('executive')" class="cl-template-btn" data-template="executive">
                üëî Executive
            </button>
            <button type="button" onclick="clSelectTemplate('creative')" class="cl-template-btn" data-template="creative">
                üé® Creative
            </button>
            <button type="button" onclick="clSelectTemplate('tech')" class="cl-template-btn" data-template="tech">
                üíª Tech
            </button>
            <button type="button" onclick="clSelectTemplate('academic')" class="cl-template-btn" data-template="academic">
                üéì Academic
            </button>
            <button type="button" onclick="clSelectTemplate('career-change')" class="cl-template-btn" data-template="career-change">
                üîÑ Career Change
            </button>
        </div>
    </div>
    
    <!-- YOUR INFORMATION -->
    <div style="margin-bottom:20px;">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">üë§ Your Information</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="cl-name" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Full Name *
                </label>
                <input id="cl-name" type="text" placeholder="Alexandra Morgan" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-email" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Email *
                </label>
                <input id="cl-email" type="email" placeholder="alex@example.com" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-phone" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Phone
                </label>
                <input id="cl-phone" type="tel" placeholder="+1 (555) 123-4567" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-linkedin" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    LinkedIn Profile
                </label>
                <input id="cl-linkedin" type="url" placeholder="linkedin.com/in/username" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- POSITION INFORMATION -->
    <div style="margin-bottom:20px;">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">üè¢ Position Information</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
            <div>
                <label for="cl-company" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Company Name *
                </label>
                <input id="cl-company" type="text" placeholder="Tech Innovations Inc." 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-role" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Job Title *
                </label>
                <input id="cl-role" type="text" placeholder="Senior Product Designer" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-hiring-name" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Hiring Manager Name
                </label>
                <input id="cl-hiring-name" type="text" placeholder="Sarah Johnson" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
            <div>
                <label for="cl-job-id" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                    Job ID / Reference
                </label>
                <input id="cl-job-id" type="text" placeholder="REF-2024-PD01" 
                       style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
            </div>
        </div>
    </div>
    
    <!-- SKILLS & ACHIEVEMENTS -->
    <div style="margin-bottom:20px;">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">‚≠ê Your Value Proposition</div>
        
        <div style="margin-bottom:12px;">
            <label for="cl-skills" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                Key Skills (comma separated)
            </label>
            <input id="cl-skills" type="text" placeholder="UX Design, User Research, Prototyping, Figma, Agile Methodology" 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;" />
        </div>
        
        <div style="margin-bottom:12px;">
            <label for="cl-achievements" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                Key Achievements (one per line)
            </label>
            <textarea id="cl-achievements" rows="4" placeholder="Led redesign that increased user engagement by 45%
Managed 8-person cross-functional team
Reduced customer support tickets by 30% through UX improvements" 
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
        
        <div>
            <label for="cl-why-role" style="display:block;margin-bottom:4px;font-size:13px;color:rgba(255,255,255,0.8);">
                Why You're Interested (2-3 sentences)
            </label>
            <textarea id="cl-why-role" rows="3" placeholder="I've followed Tech Innovations' work on sustainable technology and admire your commitment to user-centered design. My background in creating intuitive interfaces for complex systems aligns perfectly with your current challenges." 
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
    </div>
    
    <!-- CUSTOMIZATION OPTIONS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
        <div>
            <label for="cl-tone" style="display:block;margin-bottom:6px;color:#4a90e2;font-weight:500;">
                Tone & Style
            </label>
            <select id="cl-tone" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;">
                <option value="professional" selected>Professional & Formal</option>
                <option value="confident">Confident & Assertive</option>
                <option value="friendly">Friendly & Approachable</option>
                <option value="innovative">Innovative & Modern</option>
                <option value="concise">Concise & Direct</option>
            </select>
        </div>
        
        <div>
            <label for="cl-length" style="display:block;margin-bottom:6px;color:#4a90e2;font-weight:500;">
                Preferred Length
            </label>
            <select id="cl-length" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;">
                <option value="short">Short (250-300 words)</option>
                <option value="medium" selected>Medium (300-400 words)</option>
                <option value="detailed">Detailed (400-500 words)</option>
            </select>
        </div>
        
        <div>
            <label for="cl-industry" style="display:block;margin-bottom:6px;color:#4a90e2;font-weight:500;">
                Industry Focus
            </label>
            <select id="cl-industry" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(74,144,226,0.3);background:rgba(74,144,226,0.05);color:inherit;">
                <option value="general" selected>General Business</option>
                <option value="tech">Technology</option>
                <option value="healthcare">Healthcare</option>
                <option value="finance">Finance</option>
                <option value="education">Education</option>
                <option value="creative">Creative Industries</option>
                <option value="nonprofit">Non-Profit</option>
            </select>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="clGenerate()" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, #4a90e2, #357abd);border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600;font-size:16px;">
            ‚ú® Generate Cover Letter
        </button>
        <button type="button" onclick="clLoadExample()"
                style="padding:14px 20px;background:rgba(74,144,226,0.1);border:1px solid rgba(74,144,226,0.3);border-radius:8px;color:#4a90e2;cursor:pointer;">
            üìö Load Example
        </button>
    </div>
</form>

<!-- GENERATED COVER LETTER -->
<div id="cl-results" style="margin-top:24px;display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid rgba(74,144,226,0.3);">
        <h3 style="color:#4a90e2;margin:0;font-size:18px;">üìÑ Generated Cover Letter</h3>
        <div style="display:flex;gap:8px;">
            <button type="button" onclick="clCopyToClipboard()" 
                    style="padding:6px 12px;background:rgba(74,144,226,0.1);border:1px solid rgba(74,144,226,0.3);border-radius:6px;color:#4a90e2;cursor:pointer;font-size:13px;">
                üìã Copy
            </button>
            <button type="button" onclick="clDownloadPDF()"
                    style="padding:6px 12px;background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);border-radius:6px;color:#ff6b6b;cursor:pointer;font-size:13px;">
                üì• PDF
            </button>
            <button type="button" onclick="clPrint()"
                    style="padding:6px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:inherit;cursor:pointer;font-size:13px;">
                üñ®Ô∏è Print
            </button>
        </div>
    </div>
    
    <!-- STATS BAR -->
    <div style="display:flex;gap:16px;margin-bottom:12px;padding:8px 12px;background:rgba(74,144,226,0.05);border-radius:8px;border:1px solid rgba(74,144,226,0.1);">
        <div style="display:flex;align-items:center;gap:6px;">
            <span style="color:#4a90e2;font-weight:600;">Words:</span>
            <span id="cl-word-count" style="color:#fff;font-weight:500;">0</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px;">
            <span style="color:#4a90e2;font-weight:600;">Characters:</span>
            <span id="cl-char-count" style="color:#fff;font-weight:500;">0</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px;">
            <span style="color:#4a90e2;font-weight:600;">Reading Time:</span>
            <span id="cl-read-time" style="color:#fff;font-weight:500;">0 min</span>
        </div>
        <div id="cl-ats-score" style="display:flex;align-items:center;gap:6px;margin-left:auto;">
            <span style="color:#4a90e2;font-weight:600;">ATS Score:</span>
            <span style="color:#4caf50;font-weight:500;">-</span>
        </div>
    </div>
    
    <!-- COVER LETTER PREVIEW -->
    <div id="cl-preview" style="padding:24px;background:#fff;color:#333;border-radius:12px;border:1px solid rgba(0,0,0,0.1);font-family:'Georgia', 'Times New Roman', serif;line-height:1.6;min-height:600px;max-height:800px;overflow-y:auto;">
        <!-- Cover letter will be rendered here -->
        <div style="text-align:center;color:#999;padding:40px 0;">
            <div style="font-size:20px;margin-bottom:10px;">üéØ</div>
            <div>Your cover letter will appear here</div>
            <div style="font-size:12px;margin-top:8px;">Fill out the form and click "Generate Cover Letter"</div>
        </div>
    </div>
    
    <!-- EDITING TOOLS -->
    <div style="margin-top:16px;padding:16px;background:rgba(0,0,0,0.1);border-radius:8px;border:1px solid rgba(255,255,255,0.05);">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">‚úèÔ∏è Edit & Improve</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button type="button" onclick="clMakeMoreConcise()" class="cl-edit-btn">Make More Concise</button>
            <button type="button" onclick="clMakeMoreFormal()" class="cl-edit-btn">Make More Formal</button>
            <button type="button" onclick="clAddKeywords()" class="cl-edit-btn">Add Keywords</button>
            <button type="button" onclick="clAddCallToAction()" class="cl-edit-btn">Add Call to Action</button>
            <button type="button" onclick="clFixGrammar()" class="cl-edit-btn">Check Grammar</button>
        </div>
    </div>
    
    <!-- TIPS & ADVICE -->
    <div style="margin-top:16px;padding:16px;background:rgba(74,144,226,0.05);border-radius:8px;border:1px solid rgba(74,144,226,0.1);">
        <div style="color:#4a90e2;font-weight:600;margin-bottom:8px;font-size:14px;">üí° Professional Tips</div>
        <div id="cl-tips" style="font-size:13px;color:rgba(255,255,255,0.9);line-height:1.5;">
            <ul style="margin:0;padding-left:20px;">
                <li><strong>Customize for each application:</strong> Mention the company name 2-3 times</li>
                <li><strong>Use numbers:</strong> Quantify achievements with percentages or metrics</li>
                <li><strong>Match keywords:</strong> Include skills from the job description</li>
                <li><strong>Keep it concise:</strong> Aim for 300-400 words (1 page max)</li>
                <li><strong>Proofread carefully:</strong> Read aloud to catch errors</li>
            </ul>
        </div>
    </div>
</div>

<!-- CAREER ADVICE -->
<div style="margin-top:16px;padding:12px;background:rgba(74,144,226,0.1);border-radius:8px;border:1px solid rgba(74,144,226,0.3);">
    <div style="color:#4a90e2;font-weight:600;margin-bottom:6px;font-size:14px;">üéØ Career Strategy</div>
    <div id="cl-advice" style="font-size:13px;color:rgba(255,255,255,0.9);">
        <span id="cl-advice-text">A great cover letter tells a story about why you're the perfect fit.</span>
        <button onclick="clNewAdvice()" style="margin-left:8px;padding:2px 8px;background:transparent;border:1px solid rgba(74,144,226,0.4);border-radius:4px;color:#4a90e2;cursor:pointer;font-size:11px;">New Tip</button>
    </div>
</div>

<script>
/* cover-letter-builder.html
   - COMPLETE Professional Cover Letter Builder
   - Industry-specific templates
   - ATS optimization
   - Professional tone analysis
*/

let clCurrentTemplate = 'standard';

// Career advice database
const clAdvice = [
    "A great cover letter tells a story about why you're the perfect fit.",
    "Research the company before writing - mention specific projects or values.",
    "Connect your achievements to the company's needs and challenges.",
    "Use the same language as the job description - ATS systems look for keywords.",
    "Address the hiring manager by name if possible - shows initiative.",
    "Focus on what you can do for them, not just what you want from them.",
    "Start with your strongest, most relevant achievement.",
    "Customize every cover letter - generic letters are easy to spot.",
    "End with a clear call to action - suggest next steps.",
    "Proofread for spelling and grammar - errors suggest lack of attention to detail.",
    "Quantify achievements with numbers - 'increased sales by 25%' beats 'improved sales'.",
    "Show enthusiasm for the company, not just the position.",
    "Keep it to one page - hiring managers are busy.",
    "Use white space effectively - dense text is hard to read.",
    "Follow up within 5-7 business days if you haven't heard back."
];

// Template-specific content
const clTemplates = {
    standard: {
        name: "Standard Professional",
        description: "Classic format suitable for most industries",
        greeting: (hiringManager) => hiringManager ? `Dear ${hiringManager},` : "Dear Hiring Manager,",
        opening: (role, company) => `I am writing to express my enthusiastic interest in the ${role} position at ${company}. With my background in`,
        closing: (name) => `Sincerely,<br>${name}`,
        structure: ["greeting", "opening", "skills", "achievements", "companyFit", "closing"]
    },
    executive: {
        name: "Executive Level",
        description: "Confident, results-focused for senior roles",
        greeting: (hiringManager) => hiringManager ? `Dear ${hiringManager},` : "To the Hiring Committee,",
        opening: (role, company) => `I am writing to submit my application for the ${role} position at ${company}, bringing a proven track record of`,
        closing: (name) => `Best regards,<br>${name}`,
        structure: ["greeting", "directOpening", "results", "leadership", "strategicFit", "closing"]
    },
    creative: {
        name: "Creative Industries",
        description: "Engaging, story-driven for design/marketing roles",
        greeting: (hiringManager) => hiringManager ? `Hi ${hiringManager},` : "Hello,",
        opening: (role, company) => `I was thrilled to see the opening for ${role} at ${company} - it's exactly the kind of challenge I've been seeking.`,
        closing: (name) => `Looking forward to connecting,<br>${name}`,
        structure: ["greeting", "storyOpening", "portfolio", "creativeProcess", "collaboration", "closing"]
    },
    tech: {
        name: "Technology",
        description: "Technical focus with project highlights",
        greeting: (hiringManager) => hiringManager ? `Dear ${hiringManager},` : "Dear Hiring Team,",
        opening: (role, company) => `I am excited to apply for the ${role} position at ${company}. My technical expertise in`,
        closing: (name) => `Best,<br>${name}`,
        structure: ["greeting", "techOpening", "techSkills", "projects", "innovation", "closing"]
    }
};

function clSelectTemplate(template) {
    clCurrentTemplate = template;
    
    // Update active button
    const card = document.currentScript?.closest('.card') || document;
    card.querySelectorAll('.cl-template-btn').forEach(btn => {
        btn.classList.remove('cl-active');
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.border = '1px solid rgba(255,255,255,0.1)';
        btn.style.color = 'inherit';
    });
    
    const activeBtn = card.querySelector(`.cl-template-btn[data-template="${template}"]`);
    activeBtn.classList.add('cl-active');
    activeBtn.style.background = 'rgba(74,144,226,0.2)';
    activeBtn.style.border = '1px solid rgba(74,144,226,0.4)';
    activeBtn.style.color = '#4a90e2';
}

function clGenerate() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Get all inputs
    const name = card.querySelector('#cl-name').value.trim();
    const email = card.querySelector('#cl-email').value.trim();
    const phone = card.querySelector('#cl-phone').value.trim();
    const linkedin = card.querySelector('#cl-linkedin').value.trim();
    const company = card.querySelector('#cl-company').value.trim();
    const role = card.querySelector('#cl-role').value.trim();
    const hiringManager = card.querySelector('#cl-hiring-name').value.trim();
    const jobId = card.querySelector('#cl-job-id').value.trim();
    const skillsRaw = card.querySelector('#cl-skills').value;
    const achievementsRaw = card.querySelector('#cl-achievements').value;
    const whyRole = card.querySelector('#cl-why-role').value.trim();
    const tone = card.querySelector('#cl-tone').value;
    const length = card.querySelector('#cl-length').value;
    const industry = card.querySelector('#cl-industry').value;
    
    // Validate required fields
    if (!name || !email || !company || !role) {
        alert("Please fill in all required fields: Name, Email, Company, and Job Title");
        return;
    }
    
    // Parse skills and achievements
    const skills = skillsRaw ? skillsRaw.split(',').map(s => s.trim()).filter(Boolean) : [];
    const achievements = achievementsRaw ? achievementsRaw.split('\n').map(a => a.trim()).filter(Boolean) : [];
    
    // Generate cover letter based on template
    const coverLetterHTML = clBuildCoverLetter({
        name,
        email,
        phone,
        linkedin,
        company,
        role,
        hiringManager,
        jobId,
        skills,
        achievements,
        whyRole,
        tone,
        length,
        industry,
        template: clCurrentTemplate
    });
    
    // Display results
    const resultsDiv = card.querySelector('#cl-results');
    const previewDiv = card.querySelector('#cl-preview');
    
    previewDiv.innerHTML = coverLetterHTML;
    resultsDiv.style.display = 'block';
    
    // Calculate and display stats
    const textContent = previewDiv.textContent || previewDiv.innerText;
    clUpdateStats(card, textContent);
    
    // Scroll to results
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function clBuildCoverLetter(data) {
    const today = new Date();
    const formattedDate = today.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    const template = clTemplates[data.template] || clTemplates.standard;
    
    let html = `
        <div style="max-width:800px;margin:0 auto;padding:40px;font-family:'Georgia', 'Times New Roman', serif;line-height:1.6;">
            
            <!-- Header -->
            <div style="margin-bottom:40px;">
                <div style="font-size:24px;font-weight:700;color:#2c3e50;margin-bottom:4px;">${data.name}</div>
                <div style="color:#3498db;margin-bottom:4px;">
                    ${data.email}${data.phone ? ` ¬∑ ${data.phone}` : ''}
                </div>
                ${data.linkedin ? `<div style="color:#7f8c8d;">${data.linkedin}</div>` : ''}
            </div>
            
            <!-- Date and Company Info -->
            <div style="margin-bottom:40px;">
                <div style="margin-bottom:8px;">${formattedDate}</div>
                <div style="margin-bottom:4px;"><strong>${data.company}</strong></div>
                ${data.hiringManager ? `<div>Attn: ${data.hiringManager}</div>` : ''}
                ${data.jobId ? `<div>Re: ${data.role} (${data.jobId})</div>` : `<div>Re: ${data.role}</div>`}
            </div>
            
            <!-- Greeting -->
            <div style="margin-bottom:20px;">
                ${template.greeting(data.hiringManager || 'Hiring Manager')}
            </div>
            
            <!-- Opening Paragraph -->
            <div style="margin-bottom:20px;">
                ${template.opening(data.role, data.company)} ${data.skills.slice(0, 3).join(', ')}${data.skills.length > 3 ? ', and more' : ''}, I am confident in my ability to contribute significantly to your team.
            </div>
            
            <!-- Why Interested -->
            ${data.whyRole ? `
            <div style="margin-bottom:20px;">
                ${data.whyRole}
            </div>
            ` : ''}
            
            <!-- Skills Section -->
            ${data.skills.length > 0 ? `
            <div style="margin-bottom:20px;">
                <div style="font-weight:600;margin-bottom:8px;color:#2c3e50;">Relevant Expertise:</div>
                <div style="margin-bottom:8px;">My skills align well with your requirements:</div>
                <ul style="margin:8px 0 8px 20px;">
                    ${data.skills.map(skill => `<li>${skill}</li>`).join('')}
                </ul>
            </div>
            ` : ''}
            
            <!-- Achievements Section -->
            ${data.achievements.length > 0 ? `
            <div style="margin-bottom:20px;">
                <div style="font-weight:600;margin-bottom:8px;color:#2c3e50;">Key Achievements:</div>
                <ul style="margin:8px 0 8px 20px;">
                    ${data.achievements.map(achievement => `<li>${achievement}</li>`).join('')}
                </ul>
            </div>
            ` : ''}
            
            <!-- Why Company Fit -->
            <div style="margin-bottom:20px;">
                I have been particularly impressed by ${data.company}'s work in the industry and believe my experience with ${data.skills.length > 0 ? data.skills[0] : 'relevant projects'} would allow me to make immediate contributions to your team.
            </div>
            
            <!-- Closing Paragraph -->
            <div style="margin-bottom:40px;">
                I am excited about the opportunity to bring my unique skills and experience to ${data.company} and am confident that I can help achieve your goals for the ${data.role} position. I look forward to discussing how I can contribute to your team's success.
            </div>
            
            <!-- Signature -->
            <div style="margin-top:60px;">
                ${template.closing(data.name)}<br>
                ${data.email}<br>
                ${data.phone ? data.phone + '<br>' : ''}
                ${data.linkedin ? data.linkedin : ''}
            </div>
            
        </div>
    `;
    
    return html;
}

function clUpdateStats(card, text) {
    // Word count
    const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
    card.querySelector('#cl-word-count').textContent = words;
    
    // Character count
    const chars = text.length;
    card.querySelector('#cl-char-count').textContent = chars.toLocaleString();
    
    // Reading time (200 words per minute)
    const readingMinutes = Math.ceil(words / 200);
    card.querySelector('#cl-read-time').textContent = `${readingMinutes} min`;
    
    // ATS score (simplified)
    const atsScore = clCalculateATSScore(text);
    const scoreElement = card.querySelector('#cl-ats-score span:last-child');
    scoreElement.textContent = `${atsScore}/10`;
    
    if (atsScore >= 8) {
        scoreElement.style.color = '#4caf50';
    } else if (atsScore >= 6) {
        scoreElement.style.color = '#ff9800';
    } else {
        scoreElement.style.color = '#f44336';
    }
}

function clCalculateATSScore(text) {
    let score = 7; // Base score
    
    // Check for keywords (simplified)
    const keywords = ['experience', 'skills', 'achieved', 'improved', 'increased', 'managed', 'developed', 'led'];
    const foundKeywords = keywords.filter(keyword => 
        text.toLowerCase().includes(keyword.toLowerCase())
    ).length;
    
    score += Math.min(3, Math.floor(foundKeywords / 2));
    
    // Check length (optimal: 300-400 words)
    const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
    if (words >= 300 && words <= 400) {
        score += 1;
    } else if (words < 200 || words > 500) {
        score -= 1;
    }
    
    // Check for numbers (quantified achievements)
    const hasNumbers = /\d+/.test(text);
    if (hasNumbers) score += 1;
    
    return Math.min(10, Math.max(1, score));
}

function clLoadExample() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Fill with example data
    card.querySelector('#cl-name').value = "Alexandra Morgan";
    card.querySelector('#cl-email').value = "alex.morgan@example.com";
    card.querySelector('#cl-phone').value = "+1 (555) 123-4567";
    card.querySelector('#cl-linkedin').value = "linkedin.com/in/alexandramorgan";
    card.querySelector('#cl-company').value = "Tech Innovations Inc.";
    card.querySelector('#cl-role').value = "Senior Product Designer";
    card.querySelector('#cl-hiring-name').value = "Sarah Johnson";
    card.querySelector('#cl-job-id').value = "REF-2024-PD01";
    card.querySelector('#cl-skills').value = "UX Design, User Research, Prototyping, Figma, Agile Methodology, Design Systems";
    card.querySelector('#cl-achievements').value = "Led redesign of flagship product, increasing user engagement by 45%\nManaged 8-person cross-functional team delivering 3 major releases\nReduced customer support tickets by 30% through UX improvements\nIncreased conversion rate by 22% through data-driven design changes";
    card.querySelector('#cl-why-role').value = "I've followed Tech Innovations' work on sustainable technology and admire your commitment to user-centered design. My background in creating intuitive interfaces for complex systems aligns perfectly with your current challenges.";
    card.querySelector('#cl-tone').value = "professional";
    card.querySelector('#cl-length').value = "medium";
    card.querySelector('#cl-industry').value = "tech";
    
    // Visual feedback
    const exampleBtn = card.querySelector('button[onclick="clLoadExample()"]');
    const originalText = exampleBtn.textContent;
    exampleBtn.textContent = "‚ú® Example Loaded!";
    exampleBtn.style.background = 'rgba(74,144,226,0.3)';
    
    setTimeout(() => {
        exampleBtn.textContent = originalText;
        exampleBtn.style.background = '';
    }, 1500);
}

function clCopyToClipboard() {
    const card = document.currentScript?.closest('.card') || document;
    const preview = card.querySelector('#cl-preview');
    
    // Get clean text
    const text = preview.textContent || preview.innerText;
    
    // Create temporary textarea
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    
    try {
        document.execCommand('copy');
        
        // Visual feedback
        const copyBtn = card.querySelector('button[onclick="clCopyToClipboard()"]');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = "‚úÖ Copied!";
        copyBtn.style.background = 'rgba(74,144,226,0.3)';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
        }, 2000);
    } catch (err) {
        console.error('Copy failed:', err);
        alert('Copy failed. Please select and copy manually.');
    }
    
    document.body.removeChild(textarea);
}

function clDownloadPDF() {
    // Note: In a real implementation, this would use a PDF generation library
    alert("PDF download feature requires backend integration. Use the copy feature and paste into your word processor.");
}

function clPrint() {
    const card = document.currentScript?.closest('.card') || document;
    const preview = card.querySelector('#cl-preview');
    
    // Create a print-friendly version
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Cover Letter - Print</title>
            <style>
                body { font-family: 'Georgia', 'Times New Roman', serif; line-height: 1.6; padding: 40px; }
                @media print {
                    body { padding: 0; }
                }
            </style>
        </head>
        <body>
            ${preview.innerHTML}
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    
    setTimeout(() => {
        printWindow.print();
    }, 500);
}

// Editing functions (simplified versions)
function clMakeMoreConcise() {
    alert("In full version: Removes redundant words and simplifies sentences.");
}

function clMakeMoreFormal() {
    alert("In full version: Converts casual language to professional terminology.");
}

function clAddKeywords() {
    alert("In full version: Analyzes job description and adds relevant keywords.");
}

function clAddCallToAction() {
    alert("In full version: Adds strong closing call to action.");
}

function clFixGrammar() {
    alert("In full version: Checks grammar, spelling, and punctuation.");
}

function clNewAdvice() {
    const card = document.currentScript?.closest('.card') || document;
    const randomIndex = Math.floor(Math.random() * clAdvice.length);
    card.querySelector('#cl-advice-text').textContent = clAdvice[randomIndex];
}

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Set today's date by default
        const today = new Date().toISOString().split('T')[0];
        // Note: Date input not present in this version
        
        // Set initial random advice
        clNewAdvice();
        
        console.log('Cover Letter Builder ready!');
    });
}
</script>

<style>
#cover-letter-builder-title {
    color: #4a90e2 !important;
    margin-top: 0;
    font-size: 1.4rem !important;
    background: linear-gradient(135deg, #4a90e2, #357abd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.cl-template-btn {
    padding: 10px 14px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: inherit;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    flex: 1;
    min-width: 120px;
}

.cl-template-btn:hover {
    background: rgba(255,255,255,0.1);
    transform: translateY(-2px);
}

.cl-template-btn.cl-active {
    background: rgba(74,144,226,0.2) !important;
    border: 1px solid rgba(74,144,226,0.4) !important;
    color: #4a90e2 !important;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(74,144,226,0.2);
}

.cl-edit-btn {
    padding: 8px 12px;
    background: rgba(74,144,226,0.1);
    border: 1px solid rgba(74,144,226,0.2);
    border-radius: 6px;
    color: #4a90e2;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
}

.cl-edit-btn:hover {
    background: rgba(74,144,226,0.2);
    transform: translateY(-1px);
}

@media (max-width: 768px) {
    .cl-template-btn {
        min-width: calc(50% - 4px);
    }
    
    .cl-edit-btn {
        padding: 6px 10px;
        font-size: 11px;
    }
}
</style>
