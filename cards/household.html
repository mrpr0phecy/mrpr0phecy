<h2 id="hh-chore-tracker-title" style="margin-top:0;color:var(--accent);">ğŸ  Advanced Household Chore Tracker</h2>

<form aria-describedby="hh-chore-tracker-desc">
  <p id="hh-chore-tracker-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Manage household chores, assign tasks, set schedules, and track completion with reminders.
    <span style="color:var(--accent);font-weight:500;">Perfect for families and shared living!</span>
  </p>

  <!-- Chore Creation Section -->
  <div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
    <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:16px;">â• Add New Chore</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div>
        <label for="hh-task" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Chore Name *
        </label>
        <input id="hh-task" type="text" placeholder="Wash dishes" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
      
      <div>
        <label for="hh-person" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Assigned To
        </label>
        <select id="hh-person" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="">-- Select Person --</option>
          <option value="Alex">ğŸ‘¨â€ğŸ’¼ Alex</option>
          <option value="Jordan">ğŸ‘©â€ğŸ’¼ Jordan</option>
          <option value="Taylor">ğŸ§‘â€ğŸ’¼ Taylor</option>
          <option value="Casey">ğŸ‘¨â€ğŸ“ Casey</option>
          <option value="Everyone">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Everyone</option>
          <option value="Other">â• Other...</option>
        </select>
      </div>
      
      <div id="hh-other-person-container" style="display:none;">
        <label for="hh-other-person" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Custom Name
        </label>
        <input id="hh-other-person" type="text" placeholder="Enter name"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;" />
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:12px;">
      <div>
        <label for="hh-category" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Category
        </label>
        <select id="hh-category" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="cleaning">ğŸ§¹ Cleaning</option>
          <option value="kitchen">ğŸ½ï¸ Kitchen</option>
          <option value="bathroom">ğŸš½ Bathroom</option>
          <option value="laundry">ğŸ‘• Laundry</option>
          <option value="outdoor">ğŸŒ³ Outdoor</option>
          <option value="pet">ğŸ• Pet Care</option>
          <option value="maintenance">ğŸ”§ Maintenance</option>
          <option value="shopping">ğŸ›’ Shopping</option>
          <option value="other">ğŸ“‹ Other</option>
        </select>
      </div>
      
      <div>
        <label for="hh-frequency" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Frequency
        </label>
        <select id="hh-frequency" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="daily">ğŸ“… Daily</option>
          <option value="weekly">ğŸ—“ï¸ Weekly</option>
          <option value="biweekly">ğŸ“† Bi-weekly</option>
          <option value="monthly">ğŸ“… Monthly</option>
          <option value="as-needed">â° As Needed</option>
        </select>
      </div>
      
      <div>
        <label for="hh-priority" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Priority
        </label>
        <select id="hh-priority" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="1">ğŸŸ¢ Low</option>
          <option value="2" selected>ğŸŸ¡ Medium</option>
          <option value="3">ğŸ”´ High</option>
          <option value="4">ğŸš¨ Urgent</option>
        </select>
      </div>
    </div>
    
    <div style="margin-bottom:12px;">
      <label for="hh-notes" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Notes (Optional)
      </label>
      <textarea id="hh-notes" rows="2" placeholder="Special instructions, supplies needed, etc."
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-family:inherit;resize:vertical;"></textarea>
    </div>
    
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button type="button" onclick="hhAddChore()" 
              style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
        âœ… Add Chore
      </button>
      <button type="button" onclick="hhClearForm()"
              style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
        Clear Form
      </button>
    </div>
  </div>
</form>

<!-- Quick Add Common Chores -->
<div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:16px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
  <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:12px;">âš¡ Quick Add Common Chores</h3>
  
  <div style="display:flex;gap:8px;flex-wrap:wrap;">
    <button type="button" onclick="hhQuickAdd('dishes', 'Wash dishes', 'kitchen', 'daily')"
            style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:6px;">
      ğŸ½ï¸ Wash dishes
    </button>
    <button type="button" onclick="hhQuickAdd('vacuum', 'Vacuum floors', 'cleaning', 'weekly')"
            style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:6px;">
      ğŸ§¹ Vacuum floors
    </button>
    <button type="button" onclick="hhQuickAdd('laundry', 'Do laundry', 'laundry', 'weekly')"
            style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:6px;">
      ğŸ‘• Do laundry
    </button>
    <button type="button" onclick="hhQuickAdd('trash', 'Take out trash', 'cleaning', 'daily')"
            style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:6px;">
      ğŸ—‘ï¸ Take out trash
    </button>
    <button type="button" onclick="hhQuickAdd('groceries', 'Buy groceries', 'shopping', 'weekly')"
            style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:6px;">
      ğŸ›’ Buy groceries
    </button>
  </div>
</div>

<!-- Chore Dashboard -->
<div id="hh-dashboard-container" style="display:none;margin-bottom:20px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">ğŸ“Š Chore Dashboard</h3>
    <div style="display:flex;gap:8px;">
      <button type="button" onclick="hhChangeView('list')" id="hh-view-list"
              style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
        List View
      </button>
      <button type="button" onclick="hhChangeView('board')" id="hh-view-board"
              style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;font-size:12px;">
        Board View
      </button>
      <button type="button" onclick="hhChangeView('calendar')" id="hh-view-calendar"
              style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;font-size:12px;">
        Calendar View
      </button>
    </div>
  </div>
  
  <!-- Dashboard Stats -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px;margin-bottom:16px;">
    <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:12px;border:1px solid rgba(45,212,255,0.2);">
      <div style="font-size:12px;color:var(--accent);margin-bottom:4px;">Total Chores</div>
      <div id="hh-total-chores" style="font-size:24px;font-weight:600;color:var(--accent);">0</div>
    </div>
    <div style="background:rgba(57,255,20,0.05);border-radius:8px;padding:12px;border:1px solid rgba(57,255,20,0.2);">
      <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">Completed</div>
      <div id="hh-completed-chores" style="font-size:24px;font-weight:600;color:#39ff14;">0</div>
    </div>
    <div style="background:rgba(255,204,0,0.05);border-radius:8px;padding:12px;border:1px solid rgba(255,204,0,0.2);">
      <div style="font-size:12px;color:#ffcc00;margin-bottom:4px;">Pending</div>
      <div id="hh-pending-chores" style="font-size:24px;font-weight:600;color:#ffcc00;">0</div>
    </div>
    <div style="background:rgba(255,77,77,0.05);border-radius:8px;padding:12px;border:1px solid rgba(255,77,77,0.2);">
      <div style="font-size:12px;color:#ff4d4d;margin-bottom:4px;">Overdue</div>
      <div id="hh-overdue-chores" style="font-size:24px;font-weight:600;color:#ff4d4d;">0</div>
    </div>
  </div>
  
  <!-- Filter Controls -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:12px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.1);">
    <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">Filter by:</label>
        <select id="hh-filter-category" onchange="hhApplyFilters()" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:12px;">
          <option value="all">All Categories</option>
          <option value="cleaning">Cleaning</option>
          <option value="kitchen">Kitchen</option>
          <option value="bathroom">Bathroom</option>
          <option value="laundry">Laundry</option>
          <option value="outdoor">Outdoor</option>
        </select>
      </div>
      
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">Assigned to:</label>
        <select id="hh-filter-person" onchange="hhApplyFilters()" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:12px;">
          <option value="all">Everyone</option>
          <option value="Alex">Alex</option>
          <option value="Jordan">Jordan</option>
          <option value="Taylor">Taylor</option>
          <option value="Casey">Casey</option>
          <option value="Everyone">Everyone</option>
        </select>
      </div>
      
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">Status:</label>
        <select id="hh-filter-status" onchange="hhApplyFilters()" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:12px;">
          <option value="all">All</option>
          <option value="pending">Pending</option>
          <option value="completed">Completed</option>
          <option value="overdue">Overdue</option>
        </select>
      </div>
      
      <div style="margin-left:auto;">
        <button type="button" onclick="hhMarkAllCompleted()" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:6px;cursor:pointer;font-size:12px;">
          Mark All Done
        </button>
      </div>
    </div>
  </div>
  
  <!-- Chores Display -->
  <div id="hh-chores-display">
    <!-- Content will be populated by JavaScript -->
    <div style="text-align:center;padding:40px;color:var(--muted);font-style:italic;">
      No chores added yet. Add your first chore above!
    </div>
  </div>
</div>

<!-- Weekly Schedule -->
<div id="hh-schedule-container" style="display:none;margin-bottom:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:12px;">ğŸ“… Weekly Chore Schedule</h3>
  
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
    <div style="display:grid;grid-template-columns:repeat(7, 1fr);gap:8px;margin-bottom:16px;">
      <div style="text-align:center;padding:8px;background:rgba(45,212,255,0.1);border-radius:6px;">
        <div style="font-weight:600;color:var(--accent);">Mon</div>
        <div id="hh-mon-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Tue</div>
        <div id="hh-tue-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Wed</div>
        <div id="hh-wed-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Thu</div>
        <div id="hh-thu-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Fri</div>
        <div id="hh-fri-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Sat</div>
        <div id="hh-sat-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
      <div style="text-align:center;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;">
        <div style="font-weight:600;color:white;">Sun</div>
        <div id="hh-sun-count" style="font-size:12px;color:var(--muted);">0 chores</div>
      </div>
    </div>
    
    <div id="hh-schedule-details">
      <!-- Schedule details will be populated by JavaScript -->
      <div style="text-align:center;padding:20px;color:var(--muted);font-style:italic;">
        Add chores to see your weekly schedule
      </div>
    </div>
  </div>
</div>

<!-- Statistics & Insights -->
<div id="hh-statistics-container" style="display:none;margin-bottom:20px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:12px;">ğŸ“ˆ Chore Statistics & Insights</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;">
    <div>
      <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
        <div style="font-size:14px;color:var(--accent);margin-bottom:12px;">ğŸ§‘â€ğŸ¤â€ğŸ§‘ Distribution by Person</div>
        <div id="hh-person-distribution">
          <!-- Distribution chart will be populated by JavaScript -->
          <div style="text-align:center;color:var(--muted);font-size:13px;">Add chores to see distribution</div>
        </div>
      </div>
    </div>
    
    <div>
      <div style="background:rgba(255,255,255,0.03);border-radius:8px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
        <div style="font-size:14px;color:var(--accent);margin-bottom:12px;">ğŸ·ï¸ Distribution by Category</div>
        <div id="hh-category-distribution">
          <!-- Category chart will be populated by JavaScript -->
          <div style="text-align:center;color:var(--muted);font-size:13px;">Add chores to see categories</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Productivity Insights -->
  <div style="margin-top:16px;background:rgba(45,212,255,0.05);border-radius:8px;padding:16px;border:1px solid rgba(45,212,255,0.2);">
    <div style="font-size:14px;color:var(--accent);margin-bottom:12px;">ğŸ’¡ Productivity Insights</div>
    <div id="hh-insights-content">
      <!-- Insights will be populated by JavaScript -->
      <div style="text-align:center;color:var(--muted);font-size:13px;">Add and complete chores to get insights</div>
    </div>
  </div>
</div>

<!-- Reminders & Notifications -->
<div style="background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06);">
  <h3 class="small" style="color:var(--accent);margin-top:0;margin-bottom:16px;">â° Reminders & Notifications</h3>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;">
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin-bottom:8px;">ğŸ”” Set Daily Reminder</h4>
      <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Get daily reminders for pending chores.</p>
      <div style="display:flex;gap:8px;">
        <select id="hh-reminder-time" style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="18:00">6:00 PM</option>
          <option value="19:00">7:00 PM</option>
          <option value="20:00">8:00 PM</option>
          <option value="21:00">9:00 PM</option>
        </select>
        <button type="button" onclick="hhSetReminder()" 
                style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;">
          Set
        </button>
      </div>
    </div>
    
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin-bottom:8px;">ğŸ“¤ Export/Share</h4>
      <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Share chore list with housemates.</p>
      <div style="display:flex;gap:8px;">
        <button type="button" onclick="hhExportChores()" 
                style="flex:1;padding:8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;">
          Export List
        </button>
        <button type="button" onclick="hhShareSchedule()"
                style="flex:1;padding:8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;">
          Share Schedule
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Action Buttons -->
<div style="display:flex;gap:10px;margin-top:20px;">
  <button type="button" onclick="hhResetAll()" 
          style="flex:1;padding:12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
    ğŸ”„ Reset All Data
  </button>
  <button type="button" onclick="hhSaveChores()"
          style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;">
    ğŸ’¾ Save Chores
  </button>
  <button type="button" onclick="hhLoadSample()"
          style="padding:12px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:8px;cursor:pointer;">
    ğŸ§ª Load Sample
  </button>
</div>

<!-- Information Panel -->
<details style="margin-top:20px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06);">
  <summary style="color:var(--accent);font-weight:500;cursor:pointer;outline:none;">
    ğŸ“š Tips for Effective Chore Management
  </summary>
  <div style="margin-top:12px;font-size:13px;color:var(--muted);">
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
      <div>
        <strong style="color:var(--accent);">Best Practices:</strong>
        <ul style="margin:6px 0;padding-left:20px;">
          <li>Assign chores based on preferences and schedules</li>
          <li>Rotate unpleasant tasks regularly</li>
          <li>Set realistic deadlines and frequencies</li>
          <li>Celebrate completion with small rewards</li>
        </ul>
      </div>
      <div>
        <strong style="color:var(--accent);">Category Colors:</strong>
        <ul style="margin:6px 0;padding-left:20px;">
          <li><span style="color:#4ECDC4;">Cleaning:</span> Teal</li>
          <li><span style="color:#FFD166;">Kitchen:</span> Yellow</li>
          <li><span style="color:#06D6A0;">Bathroom:</span> Green</li>
          <li><span style="color:#118AB2;">Laundry:</span> Blue</li>
          <li><span style="color:#FF9E6D;">Outdoor:</span> Orange</li>
        </ul>
      </div>
    </div>
    <div style="margin-top:12px;">
      <strong style="color:var(--accent);">Frequency Guidelines:</strong>
      <div style="font-size:12px;color:var(--muted);margin-top:4px;">
        Daily (dishes, trash) | Weekly (vacuuming, laundry) | Bi-weekly (deep clean) | Monthly (windows, filters)
      </div>
    </div>
  </div>
</details>

<script>
/* household-chore-tracker.html
   - World-class household chore tracker with scheduling, reminders, and analytics
   - Scoped with hh- prefix (household)
*/

// Global state
let hhChores = [];
let hhCurrentView = 'list';
let hhNotificationPermission = false;

// Initialize when script loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    hhLoadChores();
    hhSetupEventListeners();
    console.log('Advanced Household Chore Tracker ready');
  });
} else {
  hhLoadChores();
  hhSetupEventListeners();
}

// Setup event listeners
function hhSetupEventListeners() {
  // Show/hide custom person input
  const personSelect = document.getElementById('hh-person');
  if (personSelect) {
    personSelect.addEventListener('change', function() {
      const otherContainer = document.getElementById('hh-other-person-container');
      if (this.value === 'Other') {
        otherContainer.style.display = 'block';
      } else {
        otherContainer.style.display = 'none';
      }
    });
  }
  
  // Request notification permission
  if ('Notification' in window && Notification.permission === 'default') {
    setTimeout(() => {
      Notification.requestPermission().then(permission => {
        hhNotificationPermission = permission === 'granted';
      });
    }, 1000);
  }
}

// Load chores from localStorage
function hhLoadChores() {
  const saved = localStorage.getItem('hh-chores');
  if (saved) {
    try {
      hhChores = JSON.parse(saved);
      if (hhChores.length > 0) {
        hhRenderChores();
        hhUpdateDashboard();
        hhUpdateSchedule();
        hhUpdateStatistics();
        document.getElementById('hh-dashboard-container').style.display = 'block';
        document.getElementById('hh-schedule-container').style.display = 'block';
        document.getElementById('hh-statistics-container').style.display = 'block';
      }
    } catch (e) {
      console.error('Failed to load chores:', e);
      hhChores = [];
    }
  }
}

// Save chores to localStorage
function hhSaveChores() {
  localStorage.setItem('hh-chores', JSON.stringify(hhChores));
  hhShowMessage('Chores saved successfully!', 'success');
}

// Add new chore
function hhAddChore() {
  const taskInput = document.getElementById('hh-task');
  const personSelect = document.getElementById('hh-person');
  const otherPersonInput = document.getElementById('hh-other-person');
  const categorySelect = document.getElementById('hh-category');
  const frequencySelect = document.getElementById('hh-frequency');
  const prioritySelect = document.getElementById('hh-priority');
  const notesInput = document.getElementById('hh-notes');
  
  const task = taskInput.value.trim();
  if (!task) {
    hhShowMessage('Please enter a chore name', 'error');
    return;
  }
  
  // Determine assigned person
  let person = personSelect.value;
  if (person === 'Other') {
    person = otherPersonInput.value.trim() || 'Unassigned';
  }
  if (!person) person = 'Unassigned';
  
  // Create chore object
  const newChore = {
    id: Date.now() + Math.random().toString(36).substr(2, 9),
    task: task,
    person: person,
    category: categorySelect.value,
    frequency: frequencySelect.value,
    priority: parseInt(prioritySelect.value),
    notes: notesInput.value.trim() || null,
    completed: false,
    createdAt: new Date().toISOString(),
    lastCompleted: null,
    dueDate: hhCalculateDueDate(frequencySelect.value)
  };
  
  hhChores.push(newChore);
  hhSaveChores();
  hhRenderChores();
  hhClearForm();
  
  // Show dashboard if hidden
  if (!document.getElementById('hh-dashboard-container').style.display || 
      document.getElementById('hh-dashboard-container').style.display === 'none') {
    document.getElementById('hh-dashboard-container').style.display = 'block';
    document.getElementById('hh-schedule-container').style.display = 'block';
    document.getElementById('hh-statistics-container').style.display = 'block';
  }
  
  hhUpdateDashboard();
  hhUpdateSchedule();
  hhUpdateStatistics();
  
  hhShowMessage(`"${task}" added to chore list`, 'success');
}

// Calculate due date based on frequency
function hhCalculateDueDate(frequency) {
  const now = new Date();
  const dueDate = new Date(now);
  
  switch(frequency) {
    case 'daily':
      dueDate.setDate(dueDate.getDate() + 1);
      break;
    case 'weekly':
      dueDate.setDate(dueDate.getDate() + 7);
      break;
    case 'biweekly':
      dueDate.setDate(dueDate.getDate() + 14);
      break;
    case 'monthly':
      dueDate.setMonth(dueDate.getMonth() + 1);
      break;
    case 'as-needed':
      // No due date for as-needed
      return null;
  }
  
  return dueDate.toISOString();
}

// Clear form
function hhClearForm() {
  document.getElementById('hh-task').value = '';
  document.getElementById('hh-person').value = '';
  document.getElementById('hh-other-person').value = '';
  document.getElementById('hh-notes').value = '';
  document.getElementById('hh-other-person-container').style.display = 'none';
  document.getElementById('hh-task').focus();
}

// Quick add common chores
function hhQuickAdd(type, task, category, frequency) {
  document.getElementById('hh-task').value = task;
  document.getElementById('hh-category').value = category;
  document.getElementById('hh-frequency').value = frequency;
  document.getElementById('hh-priority').value = '2'; // Medium
  
  hhShowMessage(`"${task}" pre-filled. Select a person and click "Add Chore"`, 'info');
}

// Change view type
function hhChangeView(viewType) {
  hhCurrentView = viewType;
  
  // Update button styles
  ['list', 'board', 'calendar'].forEach(view => {
    const btn = document.getElementById(`hh-view-${view}`);
    if (btn) {
      btn.style.background = view === viewType ? 'rgba(45,212,255,0.1)' : 'rgba(255,255,255,0.05)';
      btn.style.borderColor = view === viewType ? 'rgba(45,212,255,0.3)' : 'rgba(255,255,255,0.1)';
      btn.style.color = view === viewType ? 'var(--accent)' : 'inherit';
    }
  });
  
  hhRenderChores();
}

// Apply filters
function hhApplyFilters() {
  hhRenderChores();
}

// Render chores based on current view and filters
function hhRenderChores() {
  if (hhChores.length === 0) {
    document.getElementById('hh-chores-display').innerHTML = `
      <div style="text-align:center;padding:40px;color:var(--muted);font-style:italic;">
        No chores added yet. Add your first chore above!
      </div>
    `;
    return;
  }
  
  // Apply filters
  let filteredChores = [...hhChores];
  const categoryFilter = document.getElementById('hh-filter-category').value;
  const personFilter = document.getElementById('hh-filter-person').value;
  const statusFilter = document.getElementById('hh-filter-status').value;
  
  if (categoryFilter !== 'all') {
    filteredChores = filteredChores.filter(c => c.category === categoryFilter);
  }
  
  if (personFilter !== 'all') {
    filteredChores = filteredChores.filter(c => c.person === personFilter);
  }
  
  if (statusFilter !== 'all') {
    switch(statusFilter) {
      case 'pending':
        filteredChores = filteredChores.filter(c => !c.completed && !hhIsOverdue(c));
        break;
      case 'completed':
        filteredChores = filteredChores.filter(c => c.completed);
        break;
      case 'overdue':
        filteredChores = filteredChores.filter(c => !c.completed && hhIsOverdue(c));
        break;
    }
  }
  
  // Render based on view
  switch(hhCurrentView) {
    case 'board':
      hhRenderBoardView(filteredChores);
      break;
    case 'calendar':
      hhRenderCalendarView(filteredChores);
      break;
    default: // 'list'
      hhRenderListView(filteredChores);
  }
}

// Check if chore is overdue
function hhIsOverdue(chore) {
  if (!chore.dueDate || chore.completed) return false;
  
  const dueDate = new Date(chore.dueDate);
  const now = new Date();
  return now > dueDate;
}

// Render list view
function hhRenderListView(chores) {
  if (chores.length === 0) {
    document.getElementById('hh-chores-display').innerHTML = `
      <div style="text-align:center;padding:40px;color:var(--muted);font-style:italic;">
        No chores match the current filters.
      </div>
    `;
    return;
  }
  
  let html = '';
  
  chores.forEach(chore => {
    const isOverdue = hhIsOverdue(chore);
    const categoryColor = hhGetCategoryColor(chore.category);
    const priorityColor = hhGetPriorityColor(chore.priority);
    const overdueClass = isOverdue ? 'overdue' : '';
    const completedClass = chore.completed ? 'completed' : '';
    
    html += `
      <div style="margin-bottom:12px;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px;border-left:4px solid ${categoryColor};${isOverdue ? 'border-right:4px solid #ff4d4d;' : ''}">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
          <div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
              <span style="font-size:18px;">${hhGetCategoryIcon(chore.category)}</span>
              <div style="font-weight:600;${chore.completed ? 'text-decoration:line-through;color:var(--muted);' : 'color:white;'}">${chore.task}</div>
              ${isOverdue ? '<span style="font-size:10px;padding:2px 6px;background:rgba(255,77,77,0.2);color:#ff4d4d;border-radius:4px;">OVERDUE</span>' : ''}
            </div>
            <div style="font-size:12px;color:${categoryColor};margin-bottom:4px;">
              ${hhGetCategoryName(chore.category)} â€¢ ${chore.frequency}
            </div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:14px;font-weight:600;color:${chore.completed ? '#39ff14' : priorityColor};margin-bottom:4px;">
              ${chore.person}
            </div>
            <div style="font-size:11px;color:var(--muted);">
              ${chore.dueDate ? 'Due: ' + hhFormatDate(chore.dueDate) : 'No due date'}
            </div>
          </div>
        </div>
        
        ${chore.notes ? `<div style="font-size:13px;color:var(--muted);margin-top:8px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;">${chore.notes}</div>` : ''}
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
          <div style="font-size:11px;color:var(--muted);">
            ${chore.lastCompleted ? `Last done: ${hhFormatDate(chore.lastCompleted)}` : 'Never completed'}
          </div>
          <div>
            <button onclick="hhToggleChore('${chore.id}')" 
                    style="padding:6px 12px;background:${chore.completed ? 'rgba(255,255,255,0.05)' : 'rgba(57,255,20,0.1)'};border:1px solid ${chore.completed ? 'rgba(255,255,255,0.1)' : 'rgba(57,255,20,0.3)'};color:${chore.completed ? 'inherit' : '#39ff14'};border-radius:6px;cursor:pointer;font-size:12px;">
              ${chore.completed ? 'ğŸ”„ Undo' : 'âœ… Complete'}
            </button>
            <button onclick="hhEditChore('${chore.id}')" 
                    style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);border-radius:6px;cursor:pointer;font-size:12px;margin-left:6px;">
              Edit
            </button>
          </div>
        </div>
      </div>
    `;
  });
  
  document.getElementById('hh-chores-display').innerHTML = html;
}

// Render board view (Kanban style)
function hhRenderBoardView(chores) {
  if (chores.length === 0) {
    document.getElementById('hh-chores-display').innerHTML = `
      <div style="text-align:center;padding:40px;color:var(--muted);font-style:italic;">
        No chores match the current filters.
      </div>
    `;
    return;
  }
  
  // Group by status
  const pendingChores = chores.filter(c => !c.completed && !hhIsOverdue(c));
  const overdueChores = chores.filter(c => !c.completed && hhIsOverdue(c));
  const completedChores = chores.filter(c => c.completed);
  
  let html = `
    <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:16px;">
      <div>
        <div style="margin-bottom:12px;padding:8px;background:rgba(255,204,0,0.1);border-radius:6px;border:1px solid rgba(255,204,0,0.3);">
          <div style="font-weight:600;color:#ffcc00;">ğŸ“ Pending (${pendingChores.length})</div>
        </div>
        <div style="min-height:200px;">
  `;
  
  pendingChores.forEach(chore => {
    html += hhRenderChoreCard(chore);
  });
  
  html += `
        </div>
      </div>
      
      <div>
        <div style="margin-bottom:12px;padding:8px;background:rgba(255,77,77,0.1);border-radius:6px;border:1px solid rgba(255,77,77,0.3);">
          <div style="font-weight:600;color:#ff4d4d;">â° Overdue (${overdueChores.length})</div>
        </div>
        <div style="min-height:200px;">
  `;
  
  overdueChores.forEach(chore => {
    html += hhRenderChoreCard(chore);
  });
  
  html += `
        </div>
      </div>
      
      <div>
        <div style="margin-bottom:12px;padding:8px;background:rgba(57,255,20,0.1);border-radius:6px;border:1px solid rgba(57,255,20,0.3);">
          <div style="font-weight:600;color:#39ff14;">âœ… Completed (${completedChores.length})</div>
        </div>
        <div style="min-height:200px;">
  `;
  
  completedChores.forEach(chore => {
    html += hhRenderChoreCard(chore);
  });
  
  html += `
        </div>
      </div>
    </div>
  `;
  
  document.getElementById('hh-chores-display').innerHTML = html;
}

// Render chore card for board view
function hhRenderChoreCard(chore) {
  const isOverdue = hhIsOverdue(chore);
  const categoryColor = hhGetCategoryColor(chore.category);
  
  return `
    <div style="margin-bottom:8px;padding:12px;background:rgba(255,255,255,0.02);border-radius:6px;border:1px solid ${categoryColor}40;cursor:move;" draggable="true" data-id="${chore.id}">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-weight:600;color:white;font-size:14px;">${chore.task}</div>
        <div style="font-size:12px;color:${categoryColor};">${hhGetCategoryIcon(chore.category)}</div>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-bottom:6px;">${chore.person}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-size:10px;color:var(--muted);">
          ${chore.frequency}
        </div>
        <button onclick="hhToggleChore('${chore.id}')" style="padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:4px;cursor:pointer;font-size:11px;">
          ${chore.completed ? 'Undo' : 'Done'}
        </button>
      </div>
    </div>
  `;
}

// Render calendar view
function hhRenderCalendarView(chores) {
  const today = new Date();
  const days = [];
  
  // Create array for next 7 days
  for (let i = 0; i < 7; i++) {
    const date = new Date(today);
    date.setDate(date.getDate() + i);
    days.push(date);
  }
  
  let html = `
    <div style="display:grid;grid-template-columns:repeat(7, 1fr);gap:8px;">
  `;
  
  days.forEach((date, index) => {
    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
    const dayNum = date.getDate();
    const isToday = index === 0;
    
    // Find chores for this day
    const dayChores = chores.filter(chore => {
      if (chore.completed) return false;
      if (!chore.dueDate) return false;
      
      const dueDate = new Date(chore.dueDate);
      return dueDate.getDate() === date.getDate() &&
             dueDate.getMonth() === date.getMonth() &&
             dueDate.getFullYear() === date.getFullYear();
    });
    
    html += `
      <div style="background:${isToday ? 'rgba(45,212,255,0.05)' : 'rgba(255,255,255,0.02)'};border-radius:8px;padding:12px;border:1px solid ${isToday ? 'rgba(45,212,255,0.2)' : 'rgba(255,255,255,0.1)'};">
        <div style="text-align:center;margin-bottom:12px;">
          <div style="font-size:12px;color:${isToday ? 'var(--accent)' : 'var(--muted)'};">${dayName}</div>
          <div style="font-size:20px;font-weight:600;color:${isToday ? 'var(--accent)' : 'white'};">${dayNum}</div>
        </div>
        
        <div style="min-height:100px;">
    `;
    
    if (dayChores.length === 0) {
      html += `<div style="text-align:center;color:var(--muted);font-size:11px;font-style:italic;">No chores</div>`;
    } else {
      dayChores.forEach(chore => {
        html += `
          <div style="margin-bottom:6px;padding:6px;background:rgba(255,255,255,0.03);border-radius:4px;border-left:3px solid ${hhGetCategoryColor(chore.category)};">
            <div style="font-size:11px;color:white;margin-bottom:2px;">${chore.task}</div>
            <div style="font-size:9px;color:var(--muted);">${chore.person}</div>
          </div>
        `;
      });
    }
    
    html += `
        </div>
      </div>
    `;
  });
  
  html += `</div>`;
  document.getElementById('hh-chores-display').innerHTML = html;
}

// Toggle chore completion
function hhToggleChore(choreId) {
  const choreIndex = hhChores.findIndex(c => c.id === choreId);
  if (choreIndex === -1) return;
  
  hhChores[choreIndex].completed = !hhChores[choreIndex].completed;
  hhChores[choreIndex].lastCompleted = hhChores[choreIndex].completed ? new Date().toISOString() : null;
  
  // If marked as completed, update due date based on frequency
  if (hhChores[choreIndex].completed && hhChores[choreIndex].frequency !== 'as-needed') {
    hhChores[choreIndex].dueDate = hhCalculateDueDate(hhChores[choreIndex].frequency);
  }
  
  hhSaveChores();
  hhRenderChores();
  hhUpdateDashboard();
  hhUpdateSchedule();
  hhUpdateStatistics();
  
  const chore = hhChores[choreIndex];
  hhShowMessage(`"${chore.task}" marked as ${chore.completed ? 'completed' : 'pending'}`, 'success');
  
  // Send notification if completed
  if (chore.completed && hhNotificationPermission) {
    new Notification('Chore Completed!', {
      body: `${chore.task} has been marked as complete`,
      icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%2339ff14"/><path d="M30,50 L45,65 L70,35" stroke="white" stroke-width="8" fill="none"/></svg>'
    });
  }
}

// Edit chore
function hhEditChore(choreId) {
  const chore = hhChores.find(c => c.id === choreId);
  if (!chore) return;
  
  // Populate form with chore data
  document.getElementById('hh-task').value = chore.task;
  
  // Determine person selection
  const personSelect = document.getElementById('hh-person');
  const predefinedPeople = ['Alex', 'Jordan', 'Taylor', 'Casey', 'Everyone'];
  if (predefinedPeople.includes(chore.person)) {
    personSelect.value = chore.person;
    document.getElementById('hh-other-person-container').style.display = 'none';
  } else {
    personSelect.value = 'Other';
    document.getElementById('hh-other-person').value = chore.person;
    document.getElementById('hh-other-person-container').style.display = 'block';
  }
  
  document.getElementById('hh-category').value = chore.category;
  document.getElementById('hh-frequency').value = chore.frequency;
  document.getElementById('hh-priority').value = chore.priority.toString();
  document.getElementById('hh-notes').value = chore.notes || '';
  
  // Remove chore from array
  hhChores = hhChores.filter(c => c.id !== choreId);
  
  hhShowMessage(`Editing "${chore.task}"`, 'info');
}

// Update dashboard stats
function hhUpdateDashboard() {
  const totalChores = hhChores.length;
  const completedChores = hhChores.filter(c => c.completed).length;
  const pendingChores = hhChores.filter(c => !c.completed && !hhIsOverdue(c)).length;
  const overdueChores = hhChores.filter(c => !c.completed && hhIsOverdue(c)).length;
  
  document.getElementById('hh-total-chores').textContent = totalChores;
  document.getElementById('hh-completed-chores').textContent = completedChores;
  document.getElementById('hh-pending-chores').textContent = pendingChores;
  document.getElementById('hh-overdue-chores').textContent = overdueChores;
}

// Update weekly schedule
function hhUpdateSchedule() {
  if (hhChores.length === 0) return;
  
  const today = new Date();
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  
  // Update day counts
  days.forEach((day, index) => {
    const dayOffset = (index - today.getDay() + 7) % 7;
    const targetDate = new Date(today);
    targetDate.setDate(targetDate.getDate() + dayOffset);
    
    const dayChores = hhChores.filter(chore => {
      if (!chore.dueDate) return false;
      const dueDate = new Date(chore.dueDate);
      return dueDate.getDate() === targetDate.getDate() &&
             dueDate.getMonth() === targetDate.getMonth() &&
             dueDate.getFullYear() === targetDate.getFullYear();
    });
    
    const countElement = document.getElementById(`hh-${day.toLowerCase()}-count`);
    if (countElement) {
      countElement.textContent = `${dayChores.length} chore${dayChores.length !== 1 ? 's' : ''}`;
    }
  });
  
  // Update schedule details
  const scheduleDetails = document.getElementById('hh-schedule-details');
  let detailsHtml = '<div style="font-size:13px;color:var(--muted);margin-bottom:12px;">Upcoming chores:</div>';
  
  // Show next 3 days of chores
  for (let i = 0; i < 3; i++) {
    const targetDate = new Date(today);
    targetDate.setDate(targetDate.getDate() + i);
    const dayName = targetDate.toLocaleDateString('en-US', { weekday: 'long' });
    
    const dayChores = hhChores.filter(chore => {
      if (!chore.dueDate || chore.completed) return false;
      const dueDate = new Date(chore.dueDate);
      return dueDate.getDate() === targetDate.getDate() &&
             dueDate.getMonth() === targetDate.getMonth() &&
             dueDate.getFullYear() === targetDate.getFullYear();
    });
    
    if (dayChores.length > 0) {
      detailsHtml += `
        <div style="margin-bottom:12px;">
          <div style="font-weight:600;color:${i === 0 ? 'var(--accent)' : 'white'};margin-bottom:4px;">
            ${dayName}${i === 0 ? ' (Today)' : ''}
          </div>
      `;
      
      dayChores.forEach(chore => {
        detailsHtml += `
          <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(255,255,255,0.02);border-radius:4px;margin-bottom:4px;">
            <div style="width:8px;height:8px;border-radius:50%;background:${hhGetCategoryColor(chore.category)};"></div>
            <div style="flex:1;font-size:12px;color:white;">${chore.task}</div>
            <div style="font-size:11px;color:var(--muted);">${chore.person}</div>
          </div>
        `;
      });
      
      detailsHtml += `</div>`;
    }
  }
  
  scheduleDetails.innerHTML = detailsHtml;
}

// Update statistics
function hhUpdateStatistics() {
  if (hhChores.length === 0) return;
  
  // Person distribution
  const personDistribution = document.getElementById('hh-person-distribution');
  const personCounts = {};
  hhChores.forEach(c => {
    personCounts[c.person] = (personCounts[c.person] || 0) + 1;
  });
  
  let personHtml = '';
  Object.entries(personCounts).forEach(([person, count]) => {
    const percentage = Math.round((count / hhChores.length) * 100);
    personHtml += `
      <div style="margin-bottom:8px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <div style="font-size:12px;color:white;">${person}</div>
          <div style="font-size:12px;color:var(--muted);">${count} (${percentage}%)</div>
        </div>
        <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
          <div style="height:100%;width:${percentage}%;background:var(--accent);border-radius:3px;"></div>
        </div>
      </div>
    `;
  });
  
  personDistribution.innerHTML = personHtml;
  
  // Category distribution
  const categoryDistribution = document.getElementById('hh-category-distribution');
  const categoryCounts = {};
  hhChores.forEach(c => {
    categoryCounts[c.category] = (categoryCounts[c.category] || 0) + 1;
  });
  
  let categoryHtml = '';
  Object.entries(categoryCounts).forEach(([category, count]) => {
    const percentage = Math.round((count / hhChores.length) * 100);
    const color = hhGetCategoryColor(category);
    categoryHtml += `
      <div style="margin-bottom:8px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
          <div style="font-size:16px;">${hhGetCategoryIcon(category)}</div>
          <div style="flex:1;font-size:12px;color:white;">${hhGetCategoryName(category)}</div>
          <div style="font-size:12px;color:var(--muted);">${count}</div>
        </div>
        <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
          <div style="height:100%;width:${percentage}%;background:${color};border-radius:3px;"></div>
        </div>
      </div>
    `;
  });
  
  categoryDistribution.innerHTML = categoryHtml;
  
  // Insights
  const insightsContent = document.getElementById('hh-insights-content');
  const completedChores = hhChores.filter(c => c.completed).length;
  const completionRate = hhChores.length > 0 ? Math.round((completedChores / hhChores.length) * 100) : 0;
  
  const mostCommonCategory = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1])[0];
  const mostCommonPerson = Object.entries(personCounts).sort((a, b) => b[1] - a[1])[0];
  
  let insightsHtml = '';
  
  if (hhChores.length >= 5) {
    insightsHtml += `
      <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:12px;font-size:13px;">
        <div>
          <div style="color:var(--muted);margin-bottom:2px;">Completion Rate</div>
          <div style="font-weight:600;color:${completionRate >= 75 ? '#39ff14' : completionRate >= 50 ? '#ffcc00' : '#ff4d4d'};">${completionRate}%</div>
        </div>
        <div>
          <div style="color:var(--muted);margin-bottom:2px;">Most Common</div>
          <div style="font-weight:600;color:white;">${mostCommonCategory ? hhGetCategoryName(mostCommonCategory[0]) : 'N/A'}</div>
        </div>
        <div>
          <div style="color:var(--muted);margin-bottom:2px;">Busiest Person</div>
          <div style="font-weight:600;color:white;">${mostCommonPerson ? mostCommonPerson[0] : 'N/A'}</div>
        </div>
        <div>
          <div style="color:var(--muted);margin-bottom:2px;">Overdue Tasks</div>
          <div style="font-weight:600;color:#ff4d4d;">${hhChores.filter(c => hhIsOverdue(c)).length}</div>
        </div>
      </div>
    `;
  } else {
    insightsHtml = '<div style="text-align:center;color:var(--muted);font-size:13px;">Add more chores to get insights</div>';
  }
  
  insightsContent.innerHTML = insightsHtml;
}

// Set reminder
function hhSetReminder() {
  const time = document.getElementById('hh-reminder-time').value;
  const [hours, minutes] = time.split(':').map(Number);
  
  localStorage.setItem('hh-reminder-time', time);
  
  hhShowMessage(`Daily reminder set for ${time}`, 'success');
  
  // Schedule reminder
  const now = new Date();
  const reminderTime = new Date();
  reminderTime.setHours(hours, minutes, 0, 0);
  
  if (reminderTime <= now) {
    reminderTime.setDate(reminderTime.getDate() + 1);
  }
  
  const timeUntilReminder = reminderTime.getTime() - now.getTime();
  
  setTimeout(() => {
    hhSendReminder();
    // Schedule next reminder for tomorrow
    setInterval(hhSendReminder, 24 * 60 * 60 * 1000);
  }, timeUntilReminder);
}

// Send reminder
function hhSendReminder() {
  const pendingChores = hhChores.filter(c => !c.completed && !hhIsOverdue(c));
  const overdueChores = hhChores.filter(c => !c.completed && hhIsOverdue(c));
  
  if (pendingChores.length === 0 && overdueChores.length === 0) return;
  
  let message = 'Daily Chore Reminder:\n\n';
  
  if (overdueChores.length > 0) {
    message += `â° OVERDUE (${overdueChores.length}):\n`;
    overdueChores.slice(0, 3).forEach(c => {
      message += `â€¢ ${c.task} (${c.person})\n`;
    });
    message += '\n';
  }
  
  if (pendingChores.length > 0) {
    message += `ğŸ“ PENDING (${pendingChores.length}):\n`;
    pendingChores.slice(0, 3).forEach(c => {
      message += `â€¢ ${c.task} (${c.person})\n`;
    });
  }
  
  // Send notification
  if (hhNotificationPermission) {
    new Notification('Chore Reminder', {
      body: `${pendingChores.length + overdueChores.length} chores need attention`,
      icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ffcc00"/><path d="M50,30 L50,55 M50,60 L50,65" stroke="white" stroke-width="8" fill="none"/></svg>'
    });
  }
  
  // Show in-app notification
  hhShowMessage('Daily chore reminder sent!', 'info');
}

// Export chores
function hhExportChores() {
  if (hhChores.length === 0) {
    hhShowMessage('No chores to export', 'error');
    return;
  }
  
  const exportData = {
    chores: hhChores,
    metadata: {
      exported: new Date().toISOString(),
      totalChores: hhChores.length,
      completed: hhChores.filter(c => c.completed).length,
      pending: hhChores.filter(c => !c.completed).length
    }
  };
  
  const dataStr = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(exportData, null, 2));
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute('href', dataStr);
  downloadAnchorNode.setAttribute('download', `chores-export-${new Date().toISOString().split('T')[0]}.json`);
  document.body.appendChild(downloadAnchorNode);
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
  
  hhShowMessage('Chores exported successfully', 'success');
}

// Share schedule
function hhShareSchedule() {
  const pendingChores = hhChores.filter(c => !c.completed);
  
  if (pendingChores.length === 0) {
    hhShowMessage('No pending chores to share', 'info');
    return;
  }
  
  let scheduleText = 'Household Chore Schedule\n';
  scheduleText += '=======================\n\n';
  scheduleText += `Generated: ${new Date().toLocaleDateString()}\n`;
  scheduleText += `Total Pending Chores: ${pendingChores.length}\n\n`;
  
  // Group by person
  const byPerson = {};
  pendingChores.forEach(c => {
    if (!byPerson[c.person]) byPerson[c.person] = [];
    byPerson[c.person].push(c);
  });
  
  Object.entries(byPerson).forEach(([person, chores]) => {
    scheduleText += `${person}:\n`;
    chores.forEach(c => {
      scheduleText += `  â€¢ ${c.task}`;
      if (c.dueDate) {
        scheduleText += ` (due: ${hhFormatDate(c.dueDate)})`;
      }
      scheduleText += '\n';
    });
    scheduleText += '\n';
  });
  
  const dataStr = 'data:text/plain;charset=utf-8,' + encodeURIComponent(scheduleText);
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute('href', dataStr);
  downloadAnchorNode.setAttribute('download', `chore-schedule-${new Date().toISOString().split('T')[0]}.txt`);
  document.body.appendChild(downloadAnchorNode);
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
  
  hhShowMessage('Schedule exported as text file', 'success');
}

// Mark all as completed
function hhMarkAllCompleted() {
  if (hhChores.length === 0) return;
  
  if (!confirm('Mark all chores as completed? This will reset due dates.')) return;
  
  hhChores.forEach(chore => {
    if (!chore.completed) {
      chore.completed = true;
      chore.lastCompleted = new Date().toISOString();
      if (chore.frequency !== 'as-needed') {
        chore.dueDate = hhCalculateDueDate(chore.frequency);
      }
    }
  });
  
  hhSaveChores();
  hhRenderChores();
  hhUpdateDashboard();
  hhUpdateSchedule();
  hhUpdateStatistics();
  
  hhShowMessage('All chores marked as completed!', 'success');
}

// Load sample data
function hhLoadSample() {
  if (hhChores.length > 0 && !confirm('This will replace your current chores with sample data. Continue?')) {
    return;
  }
  
  const sampleChores = [
    {
      id: 'sample-1',
      task: 'Wash dishes',
      person: 'Alex',
      category: 'kitchen',
      frequency: 'daily',
      priority: 2,
      notes: 'Includes pots and pans',
      completed: false,
      createdAt: new Date().toISOString(),
      lastCompleted: null,
      dueDate: hhCalculateDueDate('daily')
    },
    {
      id: 'sample-2',
      task: 'Vacuum living room',
      person: 'Jordan',
      category: 'cleaning',
      frequency: 'weekly',
      priority: 2,
      notes: 'Don\'t forget under the couch',
      completed: true,
      createdAt: new Date(Date.now() - 86400000).toISOString(),
      lastCompleted: new Date(Date.now() - 43200000).toISOString(),
      dueDate: hhCalculateDueDate('weekly')
    },
    {
      id: 'sample-3',
      task: 'Clean bathroom',
      person: 'Taylor',
      category: 'bathroom',
      frequency: 'weekly',
      priority: 3,
      notes: 'Toilet, sink, and shower',
      completed: false,
      createdAt: new Date(Date.now() - 172800000).toISOString(),
      lastCompleted: new Date(Date.now() - 604800000).toISOString(),
      dueDate: new Date(Date.now() - 86400000).toISOString() // Overdue
    },
    {
      id: 'sample-4',
      task: 'Do laundry',
      person: 'Casey',
      category: 'laundry',
      frequency: 'weekly',
      priority: 2,
      notes: 'Wash, dry, and fold',
      completed: false,
      createdAt: new Date(Date.now() - 259200000).toISOString(),
      lastCompleted: null,
      dueDate: hhCalculateDueDate('weekly')
    },
    {
      id: 'sample-5',
      task: 'Take out trash',
      person: 'Everyone',
      category: 'cleaning',
      frequency: 'daily',
      priority: 3,
      notes: 'All trash cans in house',
      completed: false,
      createdAt: new Date(Date.now() - 345600000).toISOString(),
      lastCompleted: new Date(Date.now() - 86400000).toISOString(),
      dueDate: hhCalculateDueDate('daily')
    }
  ];
  
  hhChores = sampleChores;
  hhSaveChores();
  hhRenderChores();
  hhUpdateDashboard();
  hhUpdateSchedule();
  hhUpdateStatistics();
  
  document.getElementById('hh-dashboard-container').style.display = 'block';
  document.getElementById('hh-schedule-container').style.display = 'block';
  document.getElementById('hh-statistics-container').style.display = 'block';
  
  hhShowMessage('Sample chores loaded successfully!', 'success');
}

// Reset all data
function hhResetAll() {
  if (!confirm('Are you sure you want to reset all chore data? This cannot be undone.')) return;
  
  hhChores = [];
  localStorage.removeItem('hh-chores');
  
  document.getElementById('hh-dashboard-container').style.display = 'none';
  document.getElementById('hh-schedule-container').style.display = 'none';
  document.getElementById('hh-statistics-container').style.display = 'none';
  document.getElementById('hh-chores-display').innerHTML = `
    <div style="text-align:center;padding:40px;color:var(--muted);font-style:italic;">
      No chores added yet. Add your first chore above!
    </div>
  `;
  
  hhUpdateDashboard();
  hhClearForm();
  
  hhShowMessage('All chore data has been reset', 'info');
}

// Helper functions
function hhGetCategoryColor(category) {
  const colors = {
    'cleaning': '#4ECDC4',
    'kitchen': '#FFD166',
    'bathroom': '#06D6A0',
    'laundry': '#118AB2',
    'outdoor': '#FF9E6D',
    'pet': '#A663CC',
    'maintenance': '#FF6B6B',
    'shopping': '#9D4EDD',
    'other': '#666666'
  };
  return colors[category] || '#666666';
}

function hhGetCategoryIcon(category) {
  const icons = {
    'cleaning': 'ğŸ§¹',
    'kitchen': 'ğŸ½ï¸',
    'bathroom': 'ğŸš½',
    'laundry': 'ğŸ‘•',
    'outdoor': 'ğŸŒ³',
    'pet': 'ğŸ•',
    'maintenance': 'ğŸ”§',
    'shopping': 'ğŸ›’',
    'other': 'ğŸ“‹'
  };
  return icons[category] || 'ğŸ“‹';
}

function hhGetCategoryName(category) {
  const names = {
    'cleaning': 'Cleaning',
    'kitchen': 'Kitchen',
    'bathroom': 'Bathroom',
    'laundry': 'Laundry',
    'outdoor': 'Outdoor',
    'pet': 'Pet Care',
    'maintenance': 'Maintenance',
    'shopping': 'Shopping',
    'other': 'Other'
  };
  return names[category] || 'Other';
}

function hhGetPriorityColor(priority) {
  switch(priority) {
    case 1: return '#39ff14'; // Low - Green
    case 2: return '#ffcc00'; // Medium - Yellow
    case 3: return '#ff9800'; // High - Orange
    case 4: return '#ff4d4d'; // Urgent - Red
    default: return '#666666';
  }
}

function hhFormatDate(dateString) {
  if (!dateString) return 'N/A';
  
  const date = new Date(dateString);
  const now = new Date();
  const diffDays = Math.floor((date - now) / (1000 * 60 * 60 * 24));
  
  if (diffDays === 0) return 'Today';
  if (diffDays === 1) return 'Tomorrow';
  if (diffDays === -1) return 'Yesterday';
  if (diffDays < 0) return `${Math.abs(diffDays)} days ago`;
  if (diffDays < 7) return `In ${diffDays} days`;
  
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

function hhShowMessage(message, type = 'info') {
  const card = document.currentScript?.closest('.card') || document;
  
  // Remove existing message
  const existingMsg = card.querySelector('.hh-message');
  if (existingMsg) existingMsg.remove();
  
  // Create message element
  const messageEl = document.createElement('div');
  messageEl.className = 'hh-message';
  messageEl.style.cssText = `
    position:fixed;
    top:20px;
    right:20px;
    padding:12px 16px;
    border-radius:8px;
    background:${type === 'error' ? 'rgba(255,77,77,0.9)' : 
               type === 'success' ? 'rgba(57,255,20,0.9)' : 
               'rgba(45,212,255,0.9)'};
    color:#ffffff;
    z-index:10000;
    backdrop-filter:blur(4px);
    animation:hhSlideIn 0.3s ease;
  `;
  
  // Add CSS animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes hhSlideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes hhFadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  `;
  document.head.appendChild(style);
  
  messageEl.textContent = message;
  document.body.appendChild(messageEl);
  
  // Auto-remove after 3 seconds
  setTimeout(() => {
    messageEl.style.animation = 'hhFadeOut 0.3s ease';
    setTimeout(() => messageEl.remove(), 300);
  }, 3000);
}
</script>

<style>
#hh-chore-tracker-title {
  color: var(--accent);
  margin-top: 0;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

@media (max-width: 768px) {
  .hh-form-grid {
    grid-template-columns: 1fr !important;
  }
  
  #hh-chores-display .chore-card {
    width: 100% !important;
    margin: 8px 0 !important;
  }
  
  .hh-controls {
    flex-direction: column;
  }
  
  .hh-controls select, .hh-controls button {
    width: 100% !important;
  }
  
  #hh-schedule-container .day-column {
    padding: 8px !important;
  }
}
</style>
