<!-- cards/date-calculator.html -->
<h2 id="date-calculator-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸ“… Date Calculator
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    Smart Date Tool
  </span>
</h2>

<form aria-describedby="date-calculator-desc">
  <p id="date-calculator-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Calculate date differences, add/subtract days, and discover interesting date facts instantly.
  </p>

  <!-- Mode Selector -->
  <div style="margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <label style="color:var(--accent);font-weight:500;">ğŸ“‹ Calculation Mode</label>
      <span id="dc-mode-indicator" style="font-size:0.85rem;color:#39ff14;font-weight:500;">Difference Mode</span>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
      <button type="button" onclick="dcSetMode('difference')" 
              style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;font-weight:500;">
        â±ï¸ Difference
      </button>
      <button type="button" onclick="dcSetMode('add')"
              style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        â• Add Days
      </button>
      <button type="button" onclick="dcSetMode('subtract')"
              style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        â– Subtract Days
      </button>
    </div>
  </div>

  <!-- Date Inputs -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:16px;">
    <div class="field" style="position:relative;">
      <label for="dc-start" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
        ğŸ“Œ Start Date
      </label>
      <input id="dc-start" type="date" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:1rem;" />
      <div id="dc-start-display" class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);"></div>
    </div>

    <div class="field" id="dc-end-field" style="position:relative;">
      <label for="dc-end" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
        ğŸ¯ End Date
      </label>
      <input id="dc-end" type="date" 
             style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:1rem;" />
      <div id="dc-end-display" class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);"></div>
    </div>

    <div class="field" id="dc-offset-field" style="display:none;position:relative;">
      <label for="dc-offset" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
        ğŸ“Š Days to Add/Subtract
      </label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input id="dc-offset" type="number" value="0" min="-3650" max="3650" step="1"
               style="flex:1;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:1rem;" />
        <div style="display:flex;flex-direction:column;gap:4px;">
          <button type="button" onclick="dcAdjustOffset(7)" style="padding:6px 10px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:0.85rem;">+7d</button>
          <button type="button" onclick="dcAdjustOffset(30)" style="padding:6px 10px;border-radius:6px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);color:var(--accent);cursor:pointer;font-size:0.85rem;">+30d</button>
        </div>
      </div>
      <div id="dc-offset-hint" class="small" style="margin-top:4px;color:rgba(230,250,255,0.7);"></div>
    </div>
  </div>

  <!-- Quick Presets -->
  <div style="margin-bottom:20px;">
    <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">â±ï¸ Common Time Periods:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="dcSetCommonPeriod('week')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">1 Week</button>
      <button type="button" onclick="dcSetCommonPeriod('month')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">1 Month</button>
      <button type="button" onclick="dcSetCommonPeriod('quarter')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">3 Months</button>
      <button type="button" onclick="dcSetCommonPeriod('year')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">1 Year</button>
      <button type="button" onclick="dcSetCommonPeriod('decade')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:12px;">10 Years</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="dcCalculate(this)" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ§® Calculate
    </button>
    <button type="button" onclick="dcSetToday()"
            style="padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      ğŸ“… Set Today
    </button>
    <button type="button" onclick="dcSwapDates()"
            style="padding:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Swap Dates
    </button>
    <button type="button" onclick="dcReset(this)"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ—‘ï¸ Clear All
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Main Result Card -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:20px;border:1px solid rgba(45,212,255,0.1);margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">ğŸ“Š Calculation Results</h3>
      <button onclick="dcCopyResults()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        ğŸ“‹ Copy
      </button>
    </div>
    
    <div id="dc-result-primary" style="font-size:1.8rem;font-weight:700;color:#39ff14;margin-bottom:12px;text-align:center;">
      â€“
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:16px;margin-bottom:16px;">
      <div style="text-align:center;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Days</div>
        <div id="dc-result-days" style="font-size:1.4rem;font-weight:600;color:var(--accent);">â€“</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Weeks</div>
        <div id="dc-result-weeks" style="font-size:1.4rem;font-weight:600;color:#ffcc00;">â€“</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Months</div>
        <div id="dc-result-months" style="font-size:1.4rem;font-weight:600;color:#9d4edd;">â€“</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">Years</div>
        <div id="dc-result-years" style="font-size:1.4rem;font-weight:600;color:#ff2d55;">â€“</div>
      </div>
    </div>
    
    <div id="dc-result-details" style="color:rgba(230,250,255,0.9);font-size:0.95rem;line-height:1.5;padding:12px;background:rgba(0,0,0,0.1);border-radius:6px;">
      Enter dates to see detailed calculation results.
    </div>
  </div>

  <!-- Date Facts & Insights -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:20px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;font-size:1.1rem;">ğŸ“… Date Insights</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:16px;">
      <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:6px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">ğŸ“… Weekday</div>
        <div id="dc-weekday" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">â€“</div>
      </div>
      <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:6px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">ğŸ“† Week Number</div>
        <div id="dc-weeknum" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">â€“</div>
      </div>
      <div style="padding:12px;background:rgba(157,78,221,0.05);border-radius:6px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">â±ï¸ Days This Year</div>
        <div id="dc-days-year" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">â€“</div>
      </div>
    </div>
    
    <!-- Interesting Facts -->
    <div id="dc-facts-container" style="padding:12px;background:rgba(255,255,255,0.03);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ğŸ’¡ Did You Know?</div>
      <div id="dc-facts-text" style="font-size:0.9rem;color:rgba(230,250,255,0.9);line-height:1.5;">
        â€¢ February is the shortest month (28-29 days)<br>
        â€¢ Most months have 30 or 31 days<br>
        â€¢ A leap year occurs every 4 years (except century years)
      </div>
    </div>
  </div>
</div>

<script>
/* date-calculator.html - Enhanced version
   - Advanced date calculator with multiple modes
   - Scoped with dc- prefix
*/

let currentMode = 'difference';

// Date facts database
const dcDateFacts = [
  "The Gregorian calendar was introduced in 1582 to correct the Julian calendar's drift",
  "September, October, November, and December were originally the 7th, 8th, 9th, and 10th months",
  "February 30 existed in Sweden in 1712 during their calendar transition",
  "The year 1900 was not a leap year, but 2000 was",
  "October 1582 had only 21 days in some countries due to calendar reform",
  "The shortest month is February with 28 days (29 in leap years)",
  "July and August both have 31 days because Roman emperors wanted months named after them to be as long as Julius Caesar's July",
  "The concept of 'weekends' originated in the early 20th century"
];

function dcSetMode(mode) {
  const card = document.currentScript?.closest('.card') || document;
  currentMode = mode;
  
  // Update mode buttons
  card.querySelectorAll('[onclick*="dcSetMode"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  const activeBtn = card.querySelector(`[onclick="dcSetMode('${mode}')"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(45,212,255,0.2)';
    activeBtn.style.border = '2px solid var(--accent)';
    activeBtn.style.color = 'var(--accent)';
  }
  
  // Update mode indicator
  const modeNames = {
    'difference': 'Difference Mode',
    'add': 'Add Days Mode', 
    'subtract': 'Subtract Days Mode'
  };
  card.querySelector('#dc-mode-indicator').textContent = modeNames[mode] || 'Custom Mode';
  
  // Show/hide fields based on mode
  const endField = card.querySelector('#dc-end-field');
  const offsetField = card.querySelector('#dc-offset-field');
  
  if (mode === 'difference') {
    endField.style.display = 'block';
    offsetField.style.display = 'none';
    card.querySelector('#dc-end').required = true;
  } else {
    endField.style.display = 'none';
    offsetField.style.display = 'block';
    card.querySelector('#dc-end').required = false;
  }
  
  // Clear and update
  dcUpdateDisplays();
}

function dcUpdateDisplays() {
  const card = document.currentScript?.closest('.card') || document;
  const startInput = card.querySelector('#dc-start');
  const endInput = card.querySelector('#dc-end');
  const offsetInput = card.querySelector('#dc-offset');
  
  // Update date displays
  if (startInput.value) {
    const startDate = new Date(startInput.value);
    card.querySelector('#dc-start-display').textContent = startDate.toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  } else {
    card.querySelector('#dc-start-display').textContent = '';
  }
  
  if (endInput.value) {
    const endDate = new Date(endInput.value);
    card.querySelector('#dc-end-display').textContent = endDate.toLocaleDateString('en-US', {
      weekday: 'long', 
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  } else {
    card.querySelector('#dc-end-display').textContent = '';
  }
  
  // Update offset hint
  const offset = parseInt(offsetInput.value) || 0;
  if (offset !== 0) {
    const startDate = startInput.value ? new Date(startInput.value) : new Date();
    const resultDate = new Date(startDate);
    resultDate.setDate(resultDate.getDate() + offset);
    
    const direction = offset > 0 ? 'later' : 'earlier';
    card.querySelector('#dc-offset-hint').textContent = 
      `${Math.abs(offset)} days ${direction} is ${resultDate.toLocaleDateString()}`;
  } else {
    card.querySelector('#dc-offset-hint').textContent = '';
  }
}

function dcAdjustOffset(amount) {
  const card = document.currentScript?.closest('.card') || document;
  const offsetInput = card.querySelector('#dc-offset');
  let current = parseInt(offsetInput.value) || 0;
  
  // Determine if we're adding or subtracting based on mode
  if (currentMode === 'subtract') {
    offsetInput.value = current - amount;
  } else {
    offsetInput.value = current + amount;
  }
  
  dcUpdateDisplays();
  
  // Auto-calculate if start date is set
  const startInput = card.querySelector('#dc-start');
  if (startInput.value) {
    setTimeout(() => dcCalculate(), 100);
  }
}

function dcSetCommonPeriod(period) {
  const card = document.currentScript?.closest('.card') || document;
  const startInput = card.querySelector('#dc-start');
  const endInput = card.querySelector('#dc-end');
  
  if (!startInput.value) {
    dcSetToday();
  }
  
  const startDate = new Date(startInput.value);
  const endDate = new Date(startDate);
  
  switch(period) {
    case 'week':
      endDate.setDate(endDate.getDate() + 7);
      break;
    case 'month':
      endDate.setMonth(endDate.getMonth() + 1);
      break;
    case 'quarter':
      endDate.setMonth(endDate.getMonth() + 3);
      break;
    case 'year':
      endDate.setFullYear(endDate.getFullYear() + 1);
      break;
    case 'decade':
      endDate.setFullYear(endDate.getFullYear() + 10);
      break;
  }
  
  // Format date for input (YYYY-MM-DD)
  const formattedEnd = endDate.toISOString().split('T')[0];
  endInput.value = formattedEnd;
  
  dcSetMode('difference');
  dcUpdateDisplays();
  setTimeout(() => dcCalculate(), 100);
}

function dcSetToday() {
  const card = document.currentScript?.closest('.card') || document;
  const today = new Date();
  const formattedToday = today.toISOString().split('T')[0];
  
  card.querySelector('#dc-start').value = formattedToday;
  
  // Also set end date to today in difference mode
  if (currentMode === 'difference') {
    card.querySelector('#dc-end').value = formattedToday;
  }
  
  dcUpdateDisplays();
  
  // Show today as tomorrow's hint
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const formattedTomorrow = tomorrow.toISOString().split('T')[0];
  
  const resultDiv = card.querySelector('#dc-result-details');
  resultDiv.innerHTML = `âœ… Today is set to ${today.toLocaleDateString()}<br>
                         ğŸ’¡ Try adding days or setting an end date to calculate!`;
}

function dcSwapDates() {
  const card = document.currentScript?.closest('.card') || document;
  const startInput = card.querySelector('#dc-start');
  const endInput = card.querySelector('#dc-end');
  
  if (!startInput.value || !endInput.value) return;
  
  const temp = startInput.value;
  startInput.value = endInput.value;
  endInput.value = temp;
  
  dcUpdateDisplays();
  setTimeout(() => dcCalculate(), 100);
}

function dcCalculate(btn = null) {
  const card = document.currentScript?.closest('.card') || document;
  const startInput = card.querySelector('#dc-start');
  const endInput = card.querySelector('#dc-end');
  const offsetInput = card.querySelector('#dc-offset');
  
  const start = startInput.value;
  const end = endInput.value;
  const offset = parseInt(offsetInput.value) || 0;
  
  let result = "â€“";
  let days = 0;
  
  // Visual feedback
  if (btn) {
    btn.innerHTML = 'â³ Calculating...';
    btn.disabled = true;
  }
  
  setTimeout(() => {
    if (currentMode === 'difference') {
      if (start && end) {
        const d1 = new Date(start);
        const d2 = new Date(end);
        days = Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
        
        const direction = days >= 0 ? "after" : "before";
        const absDays = Math.abs(days);
        
        result = `${absDays} day${absDays !== 1 ? 's' : ''} ${direction}`;
        
        // Calculate additional time units
        const weeks = (absDays / 7).toFixed(1);
        const months = (absDays / 30.44).toFixed(1);
        const years = (absDays / 365.25).toFixed(2);
        
        // Update displays
        card.querySelector('#dc-result-days').textContent = absDays;
        card.querySelector('#dc-result-weeks').textContent = weeks;
        card.querySelector('#dc-result-months').textContent = months;
        card.querySelector('#dc-result-years').textContent = years;
        
        // Detailed description
        const details = [];
        if (absDays === 0) details.push("The dates are the same day");
        if (absDays === 1) details.push("Exactly 1 day apart");
        if (weeks.includes('.0')) details.push(`Exactly ${parseInt(weeks)} week${weeks !== '1' ? 's' : ''}`);
        if (months.includes('.0')) details.push(`Approximately ${parseInt(months)} month${months !== '1' ? 's' : ''}`);
        
        const detailText = details.length > 0 ? details.join(' â€¢ ') : `${absDays} days total`;
        card.querySelector('#dc-result-details').textContent = detailText;
        
        // Update insights
        dcUpdateInsights(d1, d2);
      } else {
        result = "Enter both dates";
        card.querySelector('#dc-result-details').textContent = "Please enter both start and end dates";
      }
    } else {
      // Add/Subtract mode
      if (start) {
        const d1 = new Date(start);
        const resultDate = new Date(d1);
        resultDate.setDate(resultDate.getDate() + offset);
        
        days = offset;
        
        // Format the result
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        result = resultDate.toLocaleDateString('en-US', options);
        
        // Update displays
        const absDays = Math.abs(days);
        const weeks = (absDays / 7).toFixed(1);
        const months = (absDays / 30.44).toFixed(1);
        const years = (absDays / 365.25).toFixed(2);
        
        card.querySelector('#dc-result-days').textContent = absDays;
        card.querySelector('#dc-result-weeks').textContent = weeks;
        card.querySelector('#dc-result-months').textContent = months;
        card.querySelector('#dc-result-years').textContent = years;
        
        const direction = offset > 0 ? 'after' : 'before';
        card.querySelector('#dc-result-details').textContent = 
          `${absDays} day${absDays !== 1 ? 's' : ''} ${direction} ${d1.toLocaleDateString()}`;
        
        // Update insights for result date
        dcUpdateInsights(d1, resultDate);
      } else {
        result = "Enter start date";
        card.querySelector('#dc-result-details').textContent = "Please enter a start date";
      }
    }
    
    // Update primary result
    card.querySelector('#dc-result-primary').textContent = result;
    
    // Update facts with random fact
    const randomFact = dcDateFacts[Math.floor(Math.random() * dcDateFacts.length)];
    card.querySelector('#dc-facts-text').innerHTML = `â€¢ ${randomFact}`;
    
    // Reset button if clicked
    if (btn) {
      btn.innerHTML = 'âœ… Calculated';
      setTimeout(() => {
        btn.innerHTML = 'ğŸ§® Calculate';
        btn.disabled = false;
      }, 1000);
    }
  }, 300);
}

function dcUpdateInsights(date1, date2) {
  const card = document.currentScript?.closest('.card') || document;
  
  // Update weekday
  const weekday = date2.toLocaleDateString('en-US', { weekday: 'long' });
  card.querySelector('#dc-weekday').textContent = weekday;
  
  // Update week number
  const firstDayOfYear = new Date(date2.getFullYear(), 0, 1);
  const pastDaysOfYear = (date2 - firstDayOfYear) / 86400000;
  const weekNumber = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
  card.querySelector('#dc-weeknum').textContent = `Week ${weekNumber}`;
  
  // Update days in year
  const isLeapYear = (year) => (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
  const daysInYear = isLeapYear(date2.getFullYear()) ? 366 : 365;
  const dayOfYear = Math.floor((date2 - new Date(date2.getFullYear(), 0, 0)) / 86400000);
  card.querySelector('#dc-days-year').textContent = `${dayOfYear}/${daysInYear}`;
}

function dcCopyResults() {
  const card = document.currentScript?.closest('.card') || document;
  const primary = card.querySelector('#dc-result-primary').textContent;
  const details = card.querySelector('#dc-result-details').textContent;
  
  const text = `ğŸ“… Date Calculation Result:\n${primary}\n${details}`;
  
  navigator.clipboard?.writeText(text).then(() => {
    const btn = card.querySelector('[onclick="dcCopyResults()"]');
    btn.innerHTML = 'âœ… Copied!';
    setTimeout(() => {
      btn.innerHTML = 'ğŸ“‹ Copy';
    }, 2000);
  });
}

function dcReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form
  card.querySelector('form').reset();
  
  // Reset mode
  dcSetMode('difference');
  
  // Reset displays
  card.querySelector('#dc-start-display').textContent = '';
  card.querySelector('#dc-end-display').textContent = '';
  card.querySelector('#dc-offset-hint').textContent = '';
  
  // Reset results
  card.querySelector('#dc-result-primary').textContent = 'â€“';
  card.querySelector('#dc-result-days').textContent = 'â€“';
  card.querySelector('#dc-result-weeks').textContent = 'â€“';
  card.querySelector('#dc-result-months').textContent = 'â€“';
  card.querySelector('#dc-result-years').textContent = 'â€“';
  card.querySelector('#dc-result-details').textContent = 'Enter dates to see detailed calculation results.';
  
  // Reset insights
  card.querySelector('#dc-weekday').textContent = 'â€“';
  card.querySelector('#dc-weeknum').textContent = 'â€“';
  card.querySelector('#dc-days-year').textContent = 'â€“';
  
  // Visual feedback
  btn.innerHTML = 'âœ… Cleared';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ—‘ï¸ Clear All';
  }, 1000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Set up event listeners
    const startInput = card.querySelector('#dc-start');
    const endInput = card.querySelector('#dc-end');
    const offsetInput = card.querySelector('#dc-offset');
    
    startInput.addEventListener('change', dcUpdateDisplays);
    endInput.addEventListener('change', dcUpdateDisplays);
    offsetInput.addEventListener('input', dcUpdateDisplays);
    
    // Set default to today
    dcSetToday();
    dcSetMode('difference');
    
    // Auto-calculate when inputs change
    startInput.addEventListener('change', () => setTimeout(() => dcCalculate(), 300));
    endInput.addEventListener('change', () => setTimeout(() => dcCalculate(), 300));
    offsetInput.addEventListener('input', () => setTimeout(() => dcCalculate(), 500));
    
    console.log('Enhanced Date Calculator ready');
  });
} else {
  // Run immediately if already loaded
  const card = document.currentScript?.closest('.card') || document;
  if (card) {
    setTimeout(() => {
      dcSetToday();
      dcSetMode('difference');
    }, 100);
  }
}
</script>

<style>
/* Card-specific styles */
#date-calculator-title {
  color: var(--accent);
  margin-top: 0;
  position: relative;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(45,212,255,0.2);
}

/* Interactive elements */
button:hover {
  transform: translateY(-1px);
  transition: all 0.2s;
}

input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(0.8);
  cursor: pointer;
}

/* Results styling */
#dc-result-primary {
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* Mobile adjustments */
@media (max-width: 768px) {
  .actions {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(3,1fr)"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))"] {
    grid-template-columns: 1fr !important;
  }
}

/* Animation for updates */
@keyframes highlight {
  0% { background-color: rgba(45,212,255,0.1); }
  100% { background-color: transparent; }
}

.highlight {
  animation: highlight 0.5s ease;
}
</style>
