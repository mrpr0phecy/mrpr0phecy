<!-- cards/japanese-kanji-helper.html -->
<h2 id="kanji-helper-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸŒ Japanese Kanji Expert Helper
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:rgba(45,212,255,0.7);font-weight:normal;">
    æ¼¢å­—å­¦ç¿’ãƒ„ãƒ¼ãƒ«
  </span>
</h2>

<form aria-describedby="kanji-helper-desc">
  <p id="kanji-helper-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Learn, practice, and master Japanese kanji with stroke order, meanings, readings, and example words.
  </p>

  <!-- Search and Input Section -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:12px;padding:20px;border:1px solid rgba(45,212,255,0.1);margin-bottom:20px;">
    <div style="display:grid;grid-template-columns:1fr auto;gap:12px;margin-bottom:16px;">
      <div style="position:relative;">
        <label for="kh-kanji-input" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:500;">
          ğŸ” Enter Kanji, Meaning, or Reading
        </label>
        <input id="kh-kanji-input" type="text" placeholder="Example: æ°´, water, or ã¿ãš" 
               style="width:100%;padding:14px 16px;border-radius:10px;border:2px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:1.1rem;" />
        <div class="small" style="margin-top:6px;color:rgba(230,250,255,0.7);">
          Try: æ—¥ (sun), æœˆ (moon), æœ¨ (tree), å±± (mountain), å· (river)
        </div>
      </div>
      
      <div style="display:flex;flex-direction:column;justify-content:flex-end;">
        <button type="button" onclick="khLookupKanji()" 
                style="padding:14px 24px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;white-space:nowrap;">
          æ¤œç´¢ ğŸ”
        </button>
      </div>
    </div>

    <!-- JLPT Level Selection -->
    <div style="margin-bottom:16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <label style="color:var(--accent);font-weight:500;">ğŸ“š JLPT Level Filter</label>
        <span id="kh-jlpt-indicator" style="font-size:0.9rem;color:#39ff14;">N5 (Basic)</span>
      </div>
      <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;">
        <button type="button" onclick="khSetJLPTLevel('N5')" 
                style="padding:10px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;font-weight:500;">
          N5
        </button>
        <button type="button" onclick="khSetJLPTLevel('N4')"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
          N4
        </button>
        <button type="button" onclick="khSetJLPTLevel('N3')"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
          N3
        </button>
        <button type="button" onclick="khSetJLPTLevel('N2')"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
          N2
        </button>
        <button type="button" onclick="khSetJLPTLevel('N1')"
                style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
          N1
        </button>
      </div>
    </div>

    <!-- Quick Kanji Access -->
    <div>
      <div style="color:rgba(230,250,255,0.8);margin-bottom:8px;font-size:14px;">âš¡ Quick Access - Common Kanji:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button type="button" onclick="khQuickKanji('æ—¥')" style="padding:10px 14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:6px;color:#ffcc00;cursor:pointer;font-size:1.2rem;">æ—¥</button>
        <button type="button" onclick="khQuickKanji('æœˆ')" style="padding:10px 14px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:1.2rem;">æœˆ</button>
        <button type="button" onclick="khQuickKanji('æœ¨')" style="padding:10px 14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:1.2rem;">æœ¨</button>
        <button type="button" onclick="khQuickKanji('å±±')" style="padding:10px 14px;background:rgba(157,78,221,0.1);border:1px solid rgba(157,78,221,0.3);border-radius:6px;color:#9d4edd;cursor:pointer;font-size:1.2rem;">å±±</button>
        <button type="button" onclick="khQuickKanji('å·')" style="padding:10px 14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:1.2rem;">å·</button>
        <button type="button" onclick="khQuickKanji('äºº')" style="padding:10px 14px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:1.2rem;">äºº</button>
        <button type="button" onclick="khQuickKanji('æ°´')" style="padding:10px 14px;background:rgba(0,191,255,0.1);border:1px solid rgba(0,191,255,0.3);border-radius:6px;color:#00bfff;cursor:pointer;font-size:1.2rem;">æ°´</button>
        <button type="button" onclick="khQuickKanji('ç«')" style="padding:10px 14px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;font-size:1.2rem;">ç«</button>
      </div>
    </div>
  </div>

  <!-- Practice Tools -->
  <div style="margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <label style="color:var(--accent);font-weight:500;">ğŸ–‹ï¸ Practice Tools</label>
      <span id="kh-tool-indicator" style="font-size:0.85rem;color:#9d4edd;font-weight:500;">Stroke Order</span>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:8px;">
      <button type="button" onclick="khSetTool('stroke')" 
              style="padding:12px;border-radius:8px;background:rgba(45,212,255,0.2);border:2px solid var(--accent);color:var(--accent);cursor:pointer;font-weight:500;">
        ğŸ–‹ï¸ Stroke Order
      </button>
      <button type="button" onclick="khSetTool('flashcards')"
              style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        ğŸ“‡ Flashcards
      </button>
      <button type="button" onclick="khSetTool('quiz')"
              style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        â“ Quiz Mode
      </button>
      <button type="button" onclick="khSetTool('writing')"
              style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:inherit;cursor:pointer;">
        âœï¸ Writing Practice
      </button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="khRandomKanji()" 
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ² Random Kanji
    </button>
    <button type="button" onclick="khPracticeMode()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ® Practice Now
    </button>
    <button type="button" onclick="khCopyInfo()"
            style="padding:14px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);color:#ffcc00;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ“‹ Copy Info
    </button>
    <button type="button" onclick="khResetTool()"
            style="padding:14px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Reset
    </button>
  </div>
</form>

<!-- Main Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Kanji Display Card -->
  <div id="kh-results-section" style="display:none;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;padding:24px;border:1px solid rgba(45,212,255,0.1);margin-bottom:20px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;">
      <div>
        <h3 style="color:var(--accent);margin:0 0 4px 0;font-size:1.1rem;" id="kh-kanji-title">Kanji Information</h3>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);" id="kh-kanji-subtitle">Detailed information about the selected kanji</div>
      </div>
      <button onclick="khSaveToStudyList()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        ğŸ’¾ Save to Study List
      </button>
    </div>
    
    <!-- Kanji Character and Basic Info -->
    <div style="display:grid;grid-template-columns:auto 1fr;gap:24px;align-items:center;margin-bottom:24px;">
      <div style="text-align:center;">
        <div id="kh-kanji-character" style="font-size:120px;font-weight:700;color:#ffcc00;text-shadow:0 4px 20px rgba(255,204,0,0.3);line-height:1;margin-bottom:12px;">
          æ—¥
        </div>
        <div style="display:flex;gap:8px;justify-content:center;">
          <span id="kh-stroke-count" style="padding:4px 12px;background:rgba(45,212,255,0.1);border-radius:20px;color:var(--accent);font-size:0.9rem;">4 strokes</span>
          <span id="kh-jlpt-level" style="padding:4px 12px;background:rgba(57,255,20,0.1);border-radius:20px;color:#39ff14;font-size:0.9rem;">N5</span>
          <span id="kh-frequency" style="padding:4px 12px;background:rgba(255,204,0,0.1);border-radius:20px;color:#ffcc00;font-size:0.9rem;">#1 Common</span>
        </div>
      </div>
      
      <div>
        <div style="margin-bottom:16px;">
          <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ“– Meanings</div>
          <div id="kh-meanings" style="font-size:1.1rem;font-weight:600;color:#39ff14;">sun, day, Sunday</div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div>
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ‡¯ğŸ‡µ Kun'yomi (Japanese Reading)</div>
            <div id="kh-kunyomi" style="font-size:1.1rem;font-weight:600;color:var(--accent);">ã², -ã³, -ã‹</div>
          </div>
          <div>
            <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">ğŸ‡¨ğŸ‡³ On'yomi (Chinese Reading)</div>
            <div id="kh-onyomi" style="font-size:1.1rem;font-weight:600;color:#9d4edd;">ãƒ‹ãƒ, ã‚¸ãƒ„</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Example Words -->
    <div style="margin-bottom:24px;">
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ“š Example Words & Compounds</div>
      <div id="kh-example-words" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
    
    <!-- Stroke Order Visualization -->
    <div id="kh-stroke-order-section" style="margin-bottom:24px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">ğŸ–‹ï¸ Stroke Order Guide</div>
        <button onclick="khAnimateStrokeOrder()" style="padding:4px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.85rem;">
          â–¶ï¸ Animate
        </button>
      </div>
      <div id="kh-stroke-order-display" style="display:flex;justify-content:center;gap:16px;padding:20px;background:rgba(0,0,0,0.2);border-radius:8px;min-height:120px;">
        <!-- Stroke order visualization will be created here -->
      </div>
    </div>
    
    <!-- Radical Information -->
    <div style="margin-bottom:24px;">
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ§© Radical & Components</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:12px;">
        <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:6px;">
          <div style="color:var(--accent);font-weight:600;margin-bottom:4px;">Radical</div>
          <div id="kh-radical" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">æ—¥ (sun)</div>
        </div>
        <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:6px;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">Strokes</div>
          <div id="kh-stroke-details" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">4 total strokes</div>
        </div>
        <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:6px;">
          <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">Grade Taught</div>
          <div id="kh-grade" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">Grade 1 (Age 6)</div>
        </div>
        <div style="padding:12px;background:rgba(157,78,221,0.05);border-radius:6px;">
          <div style="color:#9d4edd;font-weight:600;margin-bottom:4px;">Frequency Rank</div>
          <div id="kh-frequency-rank" style="font-size:1.1rem;font-weight:500;color:rgba(230,250,255,0.9);">#1 (Most Common)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Study Tools Section -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:24px;border:1px solid rgba(255,255,255,0.05);margin-bottom:20px;">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:20px;font-size:1.1rem;">ğŸ“š Study & Practice Tools</h3>
    
    <!-- Flashcard Practice -->
    <div id="kh-flashcard-section" style="display:none;margin-bottom:24px;">
      <div style="text-align:center;margin-bottom:16px;">
        <div id="kh-flashcard" style="width:240px;height:180px;margin:0 auto 16px;background:linear-gradient(135deg, rgba(45,212,255,0.1), rgba(45,212,255,0.05));border-radius:12px;border:2px solid rgba(45,212,255,0.3);display:flex;align-items:center;justify-content:center;font-size:72px;color:var(--accent);cursor:pointer;">
          æ—¥
        </div>
        <div style="display:flex;justify-content:center;gap:12px;">
          <button onclick="khFlipCard()" style="padding:8px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;">
            ğŸ”„ Flip Card
          </button>
          <button onclick="khNextCard()" style="padding:8px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;">
            â­ï¸ Next Card
          </button>
        </div>
      </div>
    </div>
    
    <!-- Quiz Mode -->
    <div id="kh-quiz-section" style="display:none;margin-bottom:24px;">
      <div style="text-align:center;margin-bottom:16px;">
        <div style="font-size:1.2rem;color:var(--accent);margin-bottom:12px;" id="kh-quiz-question">What does this kanji mean? <span style="font-size:2rem;color:#ffcc00;">æ—¥</span></div>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;max-width:400px;margin:0 auto;">
          <button onclick="khCheckAnswer(1)" style="padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;" id="kh-quiz-option1">Sun, Day</button>
          <button onclick="khCheckAnswer(2)" style="padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;" id="kh-quiz-option2">Moon, Month</button>
          <button onclick="khCheckAnswer(3)" style="padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;" id="kh-quiz-option3">Tree, Wood</button>
          <button onclick="khCheckAnswer(4)" style="padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;" id="kh-quiz-option4">Mountain</button>
        </div>
        <div id="kh-quiz-feedback" style="margin-top:12px;color:#39ff14;font-weight:600;"></div>
      </div>
    </div>
    
    <!-- Writing Practice -->
    <div id="kh-writing-section" style="display:none;">
      <div style="text-align:center;">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">âœï¸ Practice Writing This Kanji</div>
        <div style="width:240px;height:240px;margin:0 auto 16px;background:white;border-radius:12px;border:2px solid rgba(45,212,255,0.3);position:relative;">
          <canvas id="kh-writing-canvas" width="240" height="240" style="border-radius:10px;cursor:crosshair;background:white;"></canvas>
        </div>
        <div style="display:flex;justify-content:center;gap:12px;">
          <button onclick="khClearCanvas()" style="padding:8px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">
            ğŸ—‘ï¸ Clear
          </button>
          <button onclick="khShowStrokeGuide()" style="padding:8px 16px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;">
            ğŸ–‹ï¸ Show Guide
          </button>
          <button onclick="khCheckWriting()" style="padding:8px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;">
            âœ… Check
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Learning Tips & Resources -->
  <div style="background:rgba(0,0,0,0.1);border-radius:8px;padding:24px;border:1px solid rgba(255,255,255,0.05);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:20px;font-size:1.1rem;">ğŸ’¡ Kanji Learning Tips</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;">
        <div style="color:#39ff14;font-weight:600;margin-bottom:8px;">ğŸ¯ Learn Radicals First</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Master the 214 radicals - they're the building blocks of all kanji</div>
      </div>
      <div style="padding:16px;background:rgba(57,255,20,0.05);border-radius:8px;">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:8px;">ğŸ“ Practice Stroke Order</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Correct stroke order helps with memorization and writing speed</div>
      </div>
      <div style="padding:16px;background:rgba(255,204,0,0.05);border-radius:8px;">
        <div style="color:#9d4edd;font-weight:600;margin-bottom:8px;">ğŸ§  Use Mnemonics</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Create stories or images to remember kanji shapes and meanings</div>
      </div>
      <div style="padding:16px;background:rgba(157,78,221,0.05);border-radius:8px;">
        <div style="color:#ff2d55;font-weight:600;margin-bottom:8px;">ğŸ”„ Spaced Repetition</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Review kanji at increasing intervals for long-term retention</div>
      </div>
    </div>
    
    <!-- JLPT Study Guide -->
    <div style="padding:16px;background:rgba(45,212,255,0.05);border-radius:8px;border-left:4px solid var(--accent);">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ğŸ“Š JLPT Kanji Requirements</div>
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);line-height:1.5;">
        <strong>N5:</strong> ~100 kanji â€¢ <strong>N4:</strong> ~300 kanji â€¢ <strong>N3:</strong> ~650 kanji â€¢ <strong>N2:</strong> ~1000 kanji â€¢ <strong>N1:</strong> ~2000 kanji<br>
        <span style="color:#39ff14;">Tip:</span> Focus on learning 5-10 new kanji daily with their readings and example words.
      </div>
    </div>
  </div>
</div>

<script>
/* japanese-kanji-helper.html
   - Comprehensive Japanese Kanji learning tool
   - Scoped with kh- prefix
*/

// Kanji database (expanded sample)
const khKanjiDatabase = {
  // N5 Kanji (Basic)
  'æ—¥': {
    character: 'æ—¥',
    meanings: ['sun', 'day', 'Sunday'],
    kunyomi: ['ã²', '-ã³', '-ã‹'],
    onyomi: ['ãƒ‹ãƒ', 'ã‚¸ãƒ„'],
    strokes: 4,
    jlpt: 'N5',
    grade: 1,
    frequency: 1,
    radical: 'æ—¥',
    radicalMeaning: 'sun',
    examples: [
      { japanese: 'æ—¥æ›œæ—¥', reading: 'ã«ã¡ã‚ˆã†ã³', meaning: 'Sunday' },
      { japanese: 'æ—¥æœ¬', reading: 'ã«ã»ã‚“', meaning: 'Japan' },
      { japanese: 'ä¸€æ—¥', reading: 'ã„ã¡ã«ã¡', meaning: 'one day' },
      { japanese: 'ä»Šæ—¥', reading: 'ãã‚‡ã†', meaning: 'today' }
    ]
  },
  'æœˆ': {
    character: 'æœˆ',
    meanings: ['moon', 'month'],
    kunyomi: ['ã¤ã'],
    onyomi: ['ã‚²ãƒ„', 'ã‚¬ãƒ„'],
    strokes: 4,
    jlpt: 'N5',
    grade: 1,
    frequency: 2,
    radical: 'æœˆ',
    radicalMeaning: 'moon',
    examples: [
      { japanese: 'æœˆæ›œæ—¥', reading: 'ã’ã¤ã‚ˆã†ã³', meaning: 'Monday' },
      { japanese: 'ä¸€æœˆ', reading: 'ã„ã¡ãŒã¤', meaning: 'January' },
      { japanese: 'æœˆè¦‹', reading: 'ã¤ãã¿', meaning: 'moon viewing' },
      { japanese: 'ä»Šæœˆ', reading: 'ã“ã‚“ã’ã¤', meaning: 'this month' }
    ]
  },
  'æœ¨': {
    character: 'æœ¨',
    meanings: ['tree', 'wood'],
    kunyomi: ['ã', 'ã“'],
    onyomi: ['ãƒœã‚¯', 'ãƒ¢ã‚¯'],
    strokes: 4,
    jlpt: 'N5',
    grade: 1,
    frequency: 3,
    radical: 'æœ¨',
    radicalMeaning: 'tree',
    examples: [
      { japanese: 'æœ¨æ›œæ—¥', reading: 'ã‚‚ãã‚ˆã†ã³', meaning: 'Thursday' },
      { japanese: 'æœ¨ã®è‘‰', reading: 'ã“ã®ã¯', meaning: 'tree leaves' },
      { japanese: 'æœ¨æ', reading: 'ã‚‚ãã–ã„', meaning: 'lumber' },
      { japanese: 'æœç‰©', reading: 'ãã ã‚‚ã®', meaning: 'fruit (tree thing)' }
    ]
  },
  'å±±': {
    character: 'å±±',
    meanings: ['mountain'],
    kunyomi: ['ã‚„ã¾'],
    onyomi: ['ã‚µãƒ³'],
    strokes: 3,
    jlpt: 'N5',
    grade: 1,
    frequency: 4,
    radical: 'å±±',
    radicalMeaning: 'mountain',
    examples: [
      { japanese: 'å±±ç™»ã‚Š', reading: 'ã‚„ã¾ã®ã¼ã‚Š', meaning: 'mountain climbing' },
      { japanese: 'å¯Œå£«å±±', reading: 'ãµã˜ã•ã‚“', meaning: 'Mount Fuji' },
      { japanese: 'ç«å±±', reading: 'ã‹ã–ã‚“', meaning: 'volcano' },
      { japanese: 'å±±ã€…', reading: 'ã‚„ã¾ã‚„ã¾', meaning: 'mountains' }
    ]
  },
  'å·': {
    character: 'å·',
    meanings: ['river', 'stream'],
    kunyomi: ['ã‹ã‚'],
    onyomi: ['ã‚»ãƒ³'],
    strokes: 3,
    jlpt: 'N5',
    grade: 1,
    frequency: 5,
    radical: 'å·',
    radicalMeaning: 'river',
    examples: [
      { japanese: 'å·è¾º', reading: 'ã‹ã‚ã¹', meaning: 'riverside' },
      { japanese: 'æ²³å·', reading: 'ã‹ã›ã‚“', meaning: 'rivers' },
      { japanese: 'å·ä¸‹ã‚Š', reading: 'ã‹ã‚ãã ã‚Š', meaning: 'river descent' },
      { japanese: 'å°å·', reading: 'ãŠãŒã‚', meaning: 'stream' }
    ]
  },
  'äºº': {
    character: 'äºº',
    meanings: ['person', 'people'],
    kunyomi: ['ã²ã¨', '-ã‚Š', '-ã¨'],
    onyomi: ['ã‚¸ãƒ³', 'ãƒ‹ãƒ³'],
    strokes: 2,
    jlpt: 'N5',
    grade: 1,
    frequency: 6,
    radical: 'äºº',
    radicalMeaning: 'person',
    examples: [
      { japanese: 'æ—¥æœ¬äºº', reading: 'ã«ã»ã‚“ã˜ã‚“', meaning: 'Japanese person' },
      { japanese: 'ä¸€äºº', reading: 'ã²ã¨ã‚Š', meaning: 'one person' },
      { japanese: 'äººå£', reading: 'ã˜ã‚“ã“ã†', meaning: 'population' },
      { japanese: 'äººé–“', reading: 'ã«ã‚“ã’ã‚“', meaning: 'human being' }
    ]
  },
  'æ°´': {
    character: 'æ°´',
    meanings: ['water'],
    kunyomi: ['ã¿ãš'],
    onyomi: ['ã‚¹ã‚¤'],
    strokes: 4,
    jlpt: 'N5',
    grade: 1,
    frequency: 7,
    radical: 'æ°´',
    radicalMeaning: 'water',
    examples: [
      { japanese: 'æ°´æ›œæ—¥', reading: 'ã™ã„ã‚ˆã†ã³', meaning: 'Wednesday' },
      { japanese: 'æ°´æ³³', reading: 'ã™ã„ãˆã„', meaning: 'swimming' },
      { japanese: 'æ°´é“', reading: 'ã™ã„ã©ã†', meaning: 'water supply' },
      { japanese: 'é›¨æ°´', reading: 'ã‚ã¾ã¿ãš', meaning: 'rainwater' }
    ]
  },
  'ç«': {
    character: 'ç«',
    meanings: ['fire'],
    kunyomi: ['ã²', '-ã³', '-ã»'],
    onyomi: ['ã‚«'],
    strokes: 4,
    jlpt: 'N5',
    grade: 1,
    frequency: 8,
    radical: 'ç«',
    radicalMeaning: 'fire',
    examples: [
      { japanese: 'ç«æ›œæ—¥', reading: 'ã‹ã‚ˆã†ã³', meaning: 'Tuesday' },
      { japanese: 'ç«äº‹', reading: 'ã‹ã˜', meaning: 'fire (disaster)' },
      { japanese: 'èŠ±ç«', reading: 'ã¯ãªã³', meaning: 'fireworks' },
      { japanese: 'ç«å±±', reading: 'ã‹ã–ã‚“', meaning: 'volcano' }
    ]
  },
  // N4 Kanji examples
  'æ™‚': {
    character: 'æ™‚',
    meanings: ['time', 'hour'],
    kunyomi: ['ã¨ã', '-ã©ã'],
    onyomi: ['ã‚¸'],
    strokes: 10,
    jlpt: 'N4',
    grade: 2,
    frequency: 9,
    radical: 'æ—¥',
    radicalMeaning: 'sun',
    examples: [
      { japanese: 'æ™‚é–“', reading: 'ã˜ã‹ã‚“', meaning: 'time' },
      { japanese: 'æ™‚è¨ˆ', reading: 'ã¨ã‘ã„', meaning: 'clock' },
      { japanese: 'ä¸€æ™‚', reading: 'ã„ã¡ã˜', meaning: 'one o\'clock' },
      { japanese: 'æ™‚ä»£', reading: 'ã˜ã ã„', meaning: 'era, period' }
    ]
  },
  'èª': {
    character: 'èª',
    meanings: ['word', 'speech', 'language'],
    kunyomi: ['ã‹ãŸ.ã‚‹', 'ã‹ãŸ.ã‚‰ã†'],
    onyomi: ['ã‚´'],
    strokes: 14,
    jlpt: 'N4',
    grade: 2,
    frequency: 10,
    radical: 'è¨€',
    radicalMeaning: 'speech',
    examples: [
      { japanese: 'æ—¥æœ¬èª', reading: 'ã«ã»ã‚“ã”', meaning: 'Japanese language' },
      { japanese: 'è‹±èª', reading: 'ãˆã„ã”', meaning: 'English language' },
      { japanese: 'èªå­¦', reading: 'ã”ãŒã', meaning: 'language study' },
      { japanese: 'ç‰©èª', reading: 'ã‚‚ã®ãŒãŸã‚Š', meaning: 'story, tale' }
    ]
  }
};

let currentTool = 'stroke';
let currentJLPTLevel = 'N5';
let currentKanji = 'æ—¥';
let isCardFlipped = false;
let studyList = [];

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    khInitializeTool();
    khSetJLPTLevel('N5');
    khSetTool('stroke');
    khLookupKanji('æ—¥'); // Show sample kanji on load
    
    // Load study list from localStorage
    const savedList = localStorage.getItem('kh-study-list');
    if (savedList) {
      studyList = JSON.parse(savedList);
    }
  });
}

function khInitializeTool() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Set up input event listener
  const input = card.querySelector('#kh-kanji-input');
  input.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      khLookupKanji();
    }
  });
  
  // Initialize writing canvas
  const canvas = card.querySelector('#kh-writing-canvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';
    
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    
    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });
    
    canvas.addEventListener('mousemove', (e) => {
      if (!isDrawing) return;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });
    
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);
  }
}

function khSetJLPTLevel(level) {
  const card = document.currentScript?.closest('.card') || document;
  currentJLPTLevel = level;
  
  // Update JLPT buttons
  card.querySelectorAll('[onclick*="khSetJLPTLevel"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  const activeBtn = card.querySelector(`[onclick="khSetJLPTLevel('${level}')"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(45,212,255,0.2)';
    activeBtn.style.border = '2px solid var(--accent)';
    activeBtn.style.color = 'var(--accent)';
  }
  
  // Update indicator
  const levelNames = {
    'N5': 'N5 (Basic - 100 kanji)',
    'N4': 'N4 (Elementary - 300 kanji)', 
    'N3': 'N3 (Intermediate - 650 kanji)',
    'N2': 'N2 (Advanced - 1000 kanji)',
    'N1': 'N1 (Fluent - 2000 kanji)'
  };
  card.querySelector('#kh-jlpt-indicator').textContent = levelNames[level] || level;
}

function khSetTool(tool) {
  const card = document.currentScript?.closest('.card') || document;
  currentTool = tool;
  
  // Update tool buttons
  card.querySelectorAll('[onclick*="khSetTool"]').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
  });
  
  const activeBtn = card.querySelector(`[onclick="khSetTool('${tool}')"]`);
  if (activeBtn) {
    activeBtn.style.background = 'rgba(45,212,255,0.2)';
    activeBtn.style.border = '2px solid var(--accent)';
    activeBtn.style.color = 'var(--accent)';
  }
  
  // Update indicator
  const toolNames = {
    'stroke': 'Stroke Order',
    'flashcards': 'Flashcards',
    'quiz': 'Quiz Mode', 
    'writing': 'Writing Practice'
  };
  card.querySelector('#kh-tool-indicator').textContent = toolNames[tool] || tool;
  
  // Show/hide tool sections
  const sections = ['flashcard', 'quiz', 'writing'];
  sections.forEach(section => {
    const sectionEl = card.querySelector(`#kh-${section}-section`);
    if (sectionEl) {
      sectionEl.style.display = section === tool ? 'block' : 'none';
    }
  });
  
  // Initialize tool if needed
  if (tool === 'quiz') {
    khGenerateQuiz();
  } else if (tool === 'flashcards') {
    khInitializeFlashcards();
  }
}

function khLookupKanji(kanji = null) {
  const card = document.currentScript?.closest('.card') || document;
  
  if (!kanji) {
    const input = card.querySelector('#kh-kanji-input');
    kanji = input.value.trim();
  }
  
  // If input is empty, use current kanji
  if (!kanji) {
    kanji = currentKanji;
  }
  
  // Search for kanji in database
  let kanjiData = khKanjiDatabase[kanji];
  
  // If not found by exact character, search by meaning or reading
  if (!kanjiData) {
    // Search by meaning (English)
    for (const key in khKanjiDatabase) {
      const data = khKanjiDatabase[key];
      if (data.meanings.some(m => m.toLowerCase().includes(kanji.toLowerCase()))) {
        kanjiData = data;
        kanji = key;
        break;
      }
    }
    
    // Search by reading (Japanese)
    if (!kanjiData) {
      for (const key in khKanjiDatabase) {
        const data = khKanjiDatabase[key];
        if (data.kunyomi.some(r => r.includes(kanji)) || 
            data.onyomi.some(r => r.includes(kanji))) {
          kanjiData = data;
          kanji = key;
          break;
        }
      }
    }
  }
  
  // If still not found, use default
  if (!kanjiData) {
    kanjiData = khKanjiDatabase['æ—¥'];
    kanji = 'æ—¥';
    
    // Show error message
    const input = card.querySelector('#kh-kanji-input');
    input.value = '';
    input.placeholder = 'Not found. Try: æ—¥, æœˆ, æœ¨, å±±, å·';
  }
  
  currentKanji = kanji;
  
  // Show results section
  card.querySelector('#kh-results-section').style.display = 'block';
  
  // Scroll to results
  card.querySelector('#kh-results-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
  
  // Update display with kanji data
  khUpdateKanjiDisplay(kanjiData);
  
  // Update input field
  const input = card.querySelector('#kh-kanji-input');
  input.value = kanji;
  
  // Update quick access buttons
  card.querySelectorAll('[onclick*="khQuickKanji"]').forEach(btn => {
    const btnKanji = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
    btn.style.border = btnKanji === kanji ? '2px solid var(--accent)' : '1px solid rgba(255,255,255,0.3)';
    btn.style.background = btnKanji === kanji ? 'rgba(45,212,255,0.2)' : btn.style.background;
  });
}

function khQuickKanji(kanji) {
  khLookupKanji(kanji);
}

function khUpdateKanjiDisplay(data) {
  const card = document.currentScript?.closest('.card') || document;
  
  // Update basic information
  card.querySelector('#kh-kanji-character').textContent = data.character;
  card.querySelector('#kh-stroke-count').textContent = `${data.strokes} stroke${data.strokes !== 1 ? 's' : ''}`;
  card.querySelector('#kh-jlpt-level').textContent = data.jlpt;
  card.querySelector('#kh-frequency').textContent = `#${data.frequency} Common`;
  card.querySelector('#kh-meanings').textContent = data.meanings.join(', ');
  card.querySelector('#kh-kunyomi').textContent = data.kunyomi.join(', ');
  card.querySelector('#kh-onyomi').textContent = data.onyomi.join(', ');
  card.querySelector('#kh-radical').textContent = `${data.radical} (${data.radicalMeaning})`;
  card.querySelector('#kh-stroke-details').textContent = `${data.strokes} total strokes`;
  card.querySelector('#kh-grade').textContent = `Grade ${data.grade} (Age ${data.grade + 5})`;
  card.querySelector('#kh-frequency-rank').textContent = `#${data.frequency} (${khGetFrequencyText(data.frequency)})`;
  
  // Update title
  card.querySelector('#kh-kanji-title').textContent = `Kanji: ${data.character}`;
  card.querySelector('#kh-kanji-subtitle').textContent = `Detailed information about ${data.character}`;
  
  // Update example words
  const examplesContainer = card.querySelector('#kh-example-words');
  examplesContainer.innerHTML = '';
  
  data.examples.forEach(example => {
    const exampleDiv = document.createElement('div');
    exampleDiv.style.padding = '12px';
    exampleDiv.style.background = 'rgba(0,0,0,0.2)';
    exampleDiv.style.borderRadius = '6px';
    exampleDiv.innerHTML = `
      <div style="font-size:1.2rem;color:var(--accent);margin-bottom:4px;">${example.japanese}</div>
      <div style="font-size:0.9rem;color:#ffcc00;margin-bottom:4px;">${example.reading}</div>
      <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">${example.meaning}</div>
    `;
    examplesContainer.appendChild(exampleDiv);
  });
  
  // Update stroke order visualization
  khUpdateStrokeOrder(data.character, data.strokes);
  
  // Update common amounts
  khUpdateCommonAmounts(data);
  
  // Update current tool if needed
  if (currentTool === 'quiz') {
    khGenerateQuiz();
  }
}

function khGetFrequencyText(rank) {
  if (rank <= 10) return 'Most Common';
  if (rank <= 100) return 'Very Common';
  if (rank <= 500) return 'Common';
  if (rank <= 1000) return 'Less Common';
  return 'Rare';
}

function khUpdateStrokeOrder(character, strokeCount) {
  const card = document.currentScript?.closest('.card') || document;
  const container = card.querySelector('#kh-stroke-order-display');
  container.innerHTML = '';
  
  // Create stroke order visualization
  for (let i = 1; i <= strokeCount; i++) {
    const strokeDiv = document.createElement('div');
    strokeDiv.style.textAlign = 'center';
    strokeDiv.style.padding = '8px';
    
    // Create stroke number
    const numberDiv = document.createElement('div');
    numberDiv.textContent = i;
    numberDiv.style.width = '30px';
    numberDiv.style.height = '30px';
    numberDiv.style.background = 'rgba(45,212,255,0.1)';
    numberDiv.style.borderRadius = '50%';
    numberDiv.style.display = 'flex';
    numberDiv.style.alignItems = 'center';
    numberDiv.style.justifyContent = 'center';
    numberDiv.style.color = 'var(--accent)';
    numberDiv.style.fontWeight = '600';
    numberDiv.style.margin = '0 auto 8px';
    
    // Create stroke character
    const charDiv = document.createElement('div');
    charDiv.textContent = character;
    charDiv.style.fontSize = '36px';
    charDiv.style.color = i === 1 ? '#39ff14' : 'rgba(230,250,255,0.3)';
    charDiv.style.filter = i > 1 ? 'opacity(0.3)' : 'none';
    
    strokeDiv.appendChild(numberDiv);
    strokeDiv.appendChild(charDiv);
    container.appendChild(strokeDiv);
  }
}

function khAnimateStrokeOrder() {
  const card = document.currentScript?.closest('.card') || document;
  const strokes = card.querySelectorAll('#kh-stroke-order-display > div');
  
  // Reset all strokes
  strokes.forEach((stroke, index) => {
    const char = stroke.querySelector('div:last-child');
    char.style.color = 'rgba(230,250,255,0.3)';
    char.style.filter = 'opacity(0.3)';
  });
  
  // Animate each stroke sequentially
  strokes.forEach((stroke, index) => {
    setTimeout(() => {
      const char = stroke.querySelector('div:last-child');
      char.style.color = '#39ff14';
      char.style.filter = 'none';
      char.style.transition = 'all 0.3s ease';
      
      // Add highlight to stroke number
      const number = stroke.querySelector('div:first-child');
      number.style.background = 'rgba(57,255,20,0.2)';
      number.style.boxShadow = '0 0 10px rgba(57,255,20,0.5)';
      
      // Reset after delay
      setTimeout(() => {
        number.style.background = 'rgba(45,212,255,0.1)';
        number.style.boxShadow = 'none';
      }, 300);
    }, index * 800);
  });
}

function khUpdateCommonAmounts(data) {
  const card = document.currentScript?.closest('.card') || document;
  
  // Update common conversion amounts
  const amounts = [10, 50, 100, 500];
  amounts.forEach(amount => {
    const element = card.querySelector(`#cx-common-${amount}`);
    if (element) {
      // For demonstration, we'll show the kanji with its meaning
      element.textContent = `${amount} = ${data.character} (${data.meanings[0]})`;
    }
  });
}

function khUseCommon(amount) {
  const card = document.currentScript?.closest('.card') || document;
  const input = card.querySelector('#kh-kanji-input');
  input.value = amount;
  
  // Highlight the button
  card.querySelectorAll('[onclick*="khUseCommon"]').forEach(btn => {
    btn.textContent = 'Use';
    btn.style.background = 'rgba(45,212,255,0.1)';
  });
  
  const amountBtn = card.querySelector(`[onclick="khUseCommon(${amount})"]`);
  if (amountBtn) {
    amountBtn.textContent = 'âœ“ Used';
    amountBtn.style.background = 'rgba(57,255,20,0.1)';
  }
  
  setTimeout(() => khLookupKanji(), 300);
}

function khRandomKanji() {
  const card = document.currentScript?.closest('.card') || document;
  const kanjiList = Object.keys(khKanjiDatabase);
  
  // Filter by JLPT level if set
  let filteredList = kanjiList;
  if (currentJLPTLevel) {
    filteredList = kanjiList.filter(k => khKanjiDatabase[k].jlpt === currentJLPTLevel);
  }
  
  if (filteredList.length > 0) {
    const randomIndex = Math.floor(Math.random() * filteredList.length);
    khLookupKanji(filteredList[randomIndex]);
    
    // Visual feedback
    const btn = card.querySelector('[onclick="khRandomKanji()"]');
    btn.innerHTML = 'ğŸ² Randomizing...';
    setTimeout(() => {
      btn.innerHTML = 'ğŸ² Random Kanji';
    }, 1000);
  }
}

function khPracticeMode() {
  khSetTool('quiz');
  
  const card = document.currentScript?.closest('.card') || document;
  const btn = card.querySelector('[onclick="khPracticeMode()"]');
  btn.innerHTML = 'ğŸ¯ Practicing...';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ® Practice Now';
  }, 1000);
}

function khGenerateQuiz() {
  const card = document.currentScript?.closest('.card') || document;
  const currentData = khKanjiDatabase[currentKanji];
  
  if (!currentData) return;
  
  // Create quiz options (correct answer + 3 wrong answers)
  const allKanji = Object.keys(khKanjiDatabase);
  const wrongOptions = [];
  
  // Get 3 random wrong kanji (excluding current)
  while (wrongOptions.length < 3) {
    const randomKanji = allKanji[Math.floor(Math.random() * allKanji.length)];
    if (randomKanji !== currentKanji && !wrongOptions.includes(randomKanji)) {
      wrongOptions.push(randomKanji);
    }
  }
  
  // Create options array with correct answer at random position
  const correctPosition = Math.floor(Math.random() * 4);
  const options = [...wrongOptions];
  options.splice(correctPosition, 0, currentKanji);
  
  // Update quiz display
  card.querySelector('#kh-quiz-question').innerHTML = 
    `What does this kanji mean? <span style="font-size:2rem;color:#ffcc00;">${currentKanji}</span>`;
  
  // Update option buttons
  for (let i = 1; i <= 4; i++) {
    const kanji = options[i-1];
    const data = khKanjiDatabase[kanji];
    const btn = card.querySelector(`#kh-quiz-option${i}`);
    if (btn && data) {
      btn.textContent = data.meanings.join(', ');
      btn.dataset.correct = (kanji === currentKanji) ? 'true' : 'false';
    }
  }
  
  // Clear feedback
  card.querySelector('#kh-quiz-feedback').textContent = '';
}

function khCheckAnswer(optionNumber) {
  const card = document.currentScript?.closest('.card') || document;
  const btn = card.querySelector(`#kh-quiz-option${optionNumber}`);
  const feedback = card.querySelector('#kh-quiz-feedback');
  
  if (btn.dataset.correct === 'true') {
    feedback.textContent = 'âœ… Correct! Well done!';
    feedback.style.color = '#39ff14';
    btn.style.background = 'rgba(57,255,20,0.2)';
    btn.style.border = '1px solid #39ff14';
  } else {
    feedback.textContent = 'âŒ Incorrect. Try again!';
    feedback.style.color = '#ff2d55';
    btn.style.background = 'rgba(255,45,85,0.2)';
    btn.style.border = '1px solid #ff2d55';
  }
  
  // Reset buttons after delay and generate new quiz
  setTimeout(() => {
    card.querySelectorAll('[id^="kh-quiz-option"]').forEach(optionBtn => {
      optionBtn.style.background = 'rgba(255,255,255,0.05)';
      optionBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    });
    feedback.textContent = '';
    khGenerateQuiz();
  }, 2000);
}

function khInitializeFlashcards() {
  const card = document.currentScript?.closest('.card') || document;
  const flashcard = card.querySelector('#kh-flashcard');
  
  if (flashcard) {
    flashcard.textContent = currentKanji;
    flashcard.style.color = 'var(--accent)';
    flashcard.dataset.side = 'front';
    isCardFlipped = false;
  }
}

function khFlipCard() {
  const card = document.currentScript?.closest('.card') || document;
  const flashcard = card.querySelector('#kh-flashcard');
  const currentData = khKanjiDatabase[currentKanji];
  
  if (!flashcard || !currentData) return;
  
  if (flashcard.dataset.side === 'front') {
    // Flip to back (show meaning)
    flashcard.innerHTML = `
      <div style="text-align:center;padding:20px;">
        <div style="font-size:1.5rem;color:#39ff14;margin-bottom:12px;">${currentData.meanings.join(', ')}</div>
        <div style="font-size:1rem;color:var(--accent);">Kun: ${currentData.kunyomi.join(', ')}</div>
        <div style="font-size:1rem;color:#9d4edd;">On: ${currentData.onyomi.join(', ')}</div>
      </div>
    `;
    flashcard.dataset.side = 'back';
    flashcard.style.fontSize = '1.5rem';
  } else {
    // Flip to front (show character)
    flashcard.textContent = currentKanji;
    flashcard.dataset.side = 'front';
    flashcard.style.fontSize = '72px';
    flashcard.style.color = 'var(--accent)';
  }
  
  // Animation effect
  flashcard.style.transform = 'rotateY(90deg)';
  setTimeout(() => {
    flashcard.style.transform = 'rotateY(0deg)';
    flashcard.style.transition = 'transform 0.6s ease';
  }, 10);
}

function khNextCard() {
  khRandomKanji();
  khInitializeFlashcards();
}

function khClearCanvas() {
  const card = document.currentScript?.closest('.card') || document;
  const canvas = card.querySelector('#kh-writing-canvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
}

function khShowStrokeGuide() {
  khAnimateStrokeOrder();
  
  const card = document.currentScript?.closest('.card') || document;
  const btn = card.querySelector('[onclick="khShowStrokeGuide()"]');
  btn.textContent = 'ğŸ¯ Showing Guide...';
  setTimeout(() => {
    btn.textContent = 'ğŸ–‹ï¸ Show Guide';
  }, 2000);
}

function khCheckWriting() {
  const card = document.currentScript?.closest('.card') || document;
  const feedback = card.querySelector('#kh-quiz-feedback') || document.createElement('div');
  
  // Simple check - just provide encouragement
  feedback.textContent = 'ğŸ¯ Good effort! Compare your writing with the stroke order guide above.';
  feedback.style.color = '#ffcc00';
  feedback.style.textAlign = 'center';
  feedback.style.marginTop = '12px';
  
  // If not already in DOM, add it
  if (!feedback.parentNode) {
    const writingSection = card.querySelector('#kh-writing-section');
    writingSection.appendChild(feedback);
  }
}

function khSaveToStudyList() {
  const currentData = khKanjiDatabase[currentKanji];
  if (!currentData) return;
  
  // Check if already in study list
  if (!studyList.some(item => item.character === currentKanji)) {
    studyList.push({
      character: currentKanji,
      added: new Date().toISOString(),
      reviewed: 0,
      mastered: false
    });
    
    // Save to localStorage
    localStorage.setItem('kh-study-list', JSON.stringify(studyList));
    
    // Visual feedback
    const card = document.currentScript?.closest('.card') || document;
    const btn = card.querySelector('[onclick="khSaveToStudyList()"]');
    btn.textContent = 'ğŸ’¾ Saved!';
    btn.style.background = 'rgba(57,255,20,0.1)';
    btn.style.borderColor = '#39ff14';
    
    setTimeout(() => {
      btn.textContent = 'ğŸ’¾ Save to Study List';
      btn.style.background = 'rgba(45,212,255,0.1)';
      btn.style.borderColor = 'rgba(45,212,255,0.3)';
    }, 2000);
  }
}

function khCopyInfo() {
  const currentData = khKanjiDatabase[currentKanji];
  if (!currentData) return;
  
  const text = `Kanji: ${currentKanji}\n` +
               `Meanings: ${currentData.meanings.join(', ')}\n` +
               `Kun'yomi: ${currentData.kunyomi.join(', ')}\n` +
               `On'yomi: ${currentData.onyomi.join(', ')}\n` +
               `Strokes: ${currentData.strokes}\n` +
               `JLPT Level: ${currentData.jlpt}\n\n` +
               `Study Tip: Practice writing this kanji 10 times daily!`;
  
  navigator.clipboard?.writeText(text).then(() => {
    const card = document.currentScript?.closest('.card') || document;
    const btn = card.querySelector('[onclick="khCopyInfo()"]');
    btn.innerHTML = 'ğŸ“‹ Copied!';
    setTimeout(() => {
      btn.innerHTML = 'ğŸ“‹ Copy Info';
    }, 2000);
  });
}

function khResetTool() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Reset input
  card.querySelector('#kh-kanji-input').value = '';
  
  // Reset to defaults
  khSetJLPTLevel('N5');
  khSetTool('stroke');
  khLookupKanji('æ—¥');
  khClearCanvas();
  
  // Hide results section
  card.querySelector('#kh-results-section').style.display = 'none';
  
  // Visual feedback
  const btn = card.querySelector('[onclick="khResetTool()"]');
  btn.innerHTML = 'âœ… Reset Complete';
  setTimeout(() => {
    btn.innerHTML = 'ğŸ”„ Reset';
  }, 1000);
}
</script>

<style>
/* Kanji Helper specific styles */
#kanji-helper-title {
  color: var(--accent);
  margin-top: 0;
  position: relative;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(45,212,255,0.2);
}

/* Kanji character display */
#kh-kanji-character {
  font-family: "MS Mincho", "SimSun", "Hiragino Mincho Pro", serif;
  text-shadow: 0 4px 20px rgba(255,204,0,0.3);
}

/* Stroke order animation */
@keyframes stroke-highlight {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.stroke-highlight {
  animation: stroke-highlight 0.5s ease;
}

/* Flashcard animation */
@keyframes flip-card {
  0% { transform: rotateY(0deg); }
  50% { transform: rotateY(90deg); }
  100% { transform: rotateY(0deg); }
}

.flip-animation {
  animation: flip-card 0.6s ease;
}

/* Writing canvas styling */
#kh-writing-canvas {
  background: white;
  touch-action: none;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  #kh-kanji-character {
    font-size: 80px !important;
  }
  
  .actions {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(5,1fr)"] {
    grid-template-columns: repeat(3, 1fr) !important;
  }
  
  [style*="grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))"] {
    grid-template-columns: 1fr !important;
  }
  
  #kh-stroke-order-display {
    flex-wrap: wrap;
  }
}

/* Japanese text styling */
.japanese-text {
  font-family: "Hiragino Kaku Gothic Pro", "Meiryo", sans-serif;
}

.kanji-large {
  font-family: "MS Mincho", "SimSun", "Hiragino Mincho Pro", serif;
  font-weight: bold;
}
</style>
