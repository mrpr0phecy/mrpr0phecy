<h2 id="essay-title" style="margin-top:0;">Essay Helper</h2>

<form aria-describedby="essay-desc">
  <p id="essay-desc" class="small">Plan your essay with topic, thesis, and outline. Use the generated plan as a scaffold for writing paragraphs and adding evidence.</p>

  <div class="row">
    <div class="field">
      <label for="essay-topic">Topic</label>
      <input id="essay-topic" type="text" placeholder="e.g. Climate Change" />
    </div>
    <div class="field">
      <label for="essay-thesis">Thesis Statement</label>
      <input id="essay-thesis" type="text" placeholder="e.g. Human activity accelerates global warming" />
    </div>
    <div class="field">
      <label for="essay-outline">Outline (comma-separated)</label>
      <input id="essay-outline" type="text" placeholder="e.g. Causes, Effects, Solutions" />
    </div>
  </div>

  <div class="row" style="margin-top:8px;">
    <div class="field">
      <label for="essay-type">Essay type</label>
      <select id="essay-type">
        <option value="argumentative">Argumentative</option>
        <option value="expository">Expository</option>
        <option value="persuasive">Persuasive</option>
        <option value="compare">Compare and Contrast</option>
        <option value="literary">Literary Analysis</option>
        <option value="cause">Cause and Effect</option>
        <option value="process">Process / How-to</option>
      </select>
    </div>

    <div class="field">
      <label for="essay-length">Approx length</label>
      <select id="essay-length">
        <option value="300">Short (~300 words)</option>
        <option value="600" selected>Medium (~600 words)</option>
        <option value="1200">Long (~1200 words)</option>
      </select>
    </div>

    <div class="field">
      <label for="essay-tone">Tone</label>
      <select id="essay-tone">
        <option>Formal</option>
        <option>Academic</option>
        <option>Neutral</option>
        <option>Conversational</option>
      </select>
    </div>
  </div>

  <div class="actions">
    <button type="button" onclick="essayPlan(this)">Generate Plan</button>
    <button type="button" class="secondary" onclick="essayReset(this)">Reset</button>
    <button type="button" onclick="essayCopy(this)">Copy Plan</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Essay Plan</h3>
  <textarea id="essay-output" rows="12" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>
  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div class="small">Estimated words: <span id="essay-wordcount">0</span></div>
    <div id="essay-hint" class="small" style="opacity:0.9;"></div>
  </div>
</div>

<script>
/* Essay Helper
   - Scoped via btn.closest('.card') for modularity
   - Generates a structured plan from topic, thesis and outline points
   - Reuses small helper functions for intro, body paragraphs and conclusion
*/

function essayReset(btn) {
  const card = btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#essay-output').value = "";
  card.querySelector('#essay-wordcount').textContent = "0";
  card.querySelector('#essay-hint').textContent = "";
}

function essayCopy(btn) {
  const card = btn.closest('.card');
  const out = card.querySelector('#essay-output').value;
  if (!out.trim()) return;
  navigator.clipboard?.writeText(out).then(() => {
    const hint = card.querySelector('#essay-hint');
    hint.textContent = "Copied to clipboard.";
    setTimeout(() => { if (hint.textContent === "Copied to clipboard.") hint.textContent = ""; }, 1800);
  }).catch(() => {
    alert("Copy failed â€” select the text and copy manually.");
  });
}

function essayPlan(btn) {
  const card = btn.closest('.card');
  const topic = (card.querySelector('#essay-topic').value || "").trim();
  const thesis = (card.querySelector('#essay-thesis').value || "").trim();
  const outlineRaw = (card.querySelector('#essay-outline').value || "").trim();
  const type = card.querySelector('#essay-type').value;
  const tone = card.querySelector('#essay-tone').value;
  const length = parseInt(card.querySelector('#essay-length').value, 10) || 600;

  if (!topic || !thesis) {
    card.querySelector('#essay-hint').textContent = "Please enter both a topic and a thesis.";
    return;
  }

  const outlinePoints = outlineRaw
    ? outlineRaw.split(',').map(p => p.trim()).filter(Boolean)
    : [];

  const plan = buildEssayPlan({ topic, thesis, outlinePoints, type, tone, length });
  const outEl = card.querySelector('#essay-output');
  outEl.value = plan;
  card.querySelector('#essay-wordcount').textContent = estimateWords(plan);
  card.querySelector('#essay-hint').textContent = "Generated plan. Flesh out each section with evidence and transitions.";
}

/* Helpers */

function estimateWords(text) {
  return (text.trim().split(/\s+/).filter(Boolean).length).toString();
}

function sentenceCase(s) {
  if (!s) return s;
  return s.charAt(0).toUpperCase() + s.slice(1);
}

function buildEssayPlan(opts) {
  const { topic, thesis, outlinePoints, type, tone, length } = opts;

  const introApprox = Math.max(40, Math.round(length * 0.15));
  const conclApprox = Math.max(40, Math.round(length * 0.15));
  const bodyApprox = Math.max(100, length - introApprox - conclApprox);

  const intro = generateIntro({ topic, thesis, tone, approx: introApprox });

  // If user provided outline points, use them as body headings; otherwise generate based on
