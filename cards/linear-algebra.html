<h2 id="linear-algebra-title" style="margin-top:0;">Linear Algebra Helper</h2>

<form aria-describedby="linear-algebra-desc">
  <p id="linear-algebra-desc" class="small">Perform comprehensive linear algebra operations with step-by-step solutions, matrix visualization, and educational explanations.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
    <div class="field">
      <label for="la-matrixA">Matrix A</label>
      <textarea id="la-matrixA" rows="4" placeholder="Enter matrix A (rows separated by newlines or ;, entries by space or ,)
Example:
1 2 3
4 5 6
7 8 9

Or: 1,2,3;4,5,6;7,8,9" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-family:monospace;font-size:13px;resize:vertical;"></textarea>
      <div class="hint" style="font-size:12px;color:#64b5f6;margin-top:4px;">Use spaces or commas between entries</div>
    </div>
    
    <div class="field">
      <label for="la-matrixB">Matrix B (optional)</label>
      <textarea id="la-matrixB" rows="4" placeholder="Enter matrix B (same format as A)
Example for multiplication:
2 0
1 2

Or for addition (must match A dimensions):
10 11 12
13 14 15
16 17 18" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-family:monospace;font-size:13px;resize:vertical;"></textarea>
      <div class="hint" style="font-size:12px;color:#64b5f6;margin-top:4px;">Required for addition/multiplication</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="la-operation">Operation</label>
      <select id="la-operation" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" onchange="laUpdateOperation()">
        <option value="add" selected>‚ûï Matrix Addition (A + B)</option>
        <option value="subtract">‚ûñ Matrix Subtraction (A - B)</option>
        <option value="multiply">‚úñÔ∏è Matrix Multiplication (A √ó B)</option>
        <option value="scalar">üî¢ Scalar Multiplication (k √ó A)</option>
        <option value="transpose">‚ÜïÔ∏è Transpose (A·µÄ)</option>
        <option value="determinant">üìê Determinant (det(A))</option>
        <option value="inverse">üîÑ Matrix Inverse (A‚Åª¬π)</option>
        <option value="rank">üìà Matrix Rank</option>
        <option value="rref">üßÆ Reduced Row Echelon Form</option>
        <option value="eigenvalues">üåÄ Eigenvalues & Eigenvectors</option>
        <option value="solve">‚öñÔ∏è Solve Linear System (Ax = b)</option>
        <option value="dot">üîµ Vector Dot Product</option>
        <option value="cross">‚ùå Vector Cross Product (3D only)</option>
      </select>
      <div class="hint" style="font-size:12px;color:#64b5f6;margin-top:4px;">Select linear algebra operation</div>
    </div>
    
    <div class="field">
      <label for="la-scalar">Scalar Value (k)</label>
      <input id="la-scalar" type="number" step="0.1" value="2" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;" disabled />
      <div class="hint" style="font-size:12px;color:#64b5f6;margin-top:4px;">Used for scalar multiplication</div>
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
    <div class="field">
      <label for="la-show-steps">Show Detailed Steps</label>
      <select id="la-show-steps" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
        <option value="yes" selected>‚úÖ Yes - Show all steps</option>
        <option value="brief">üìù Brief - Key steps only</option>
        <option value="no">‚ùå No - Result only</option>
      </select>
    </div>
    
    <div class="field">
      <label for="la-precision">Numerical Precision</label>
      <select id="la-precision" style="width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;">
        <option value="2">2 decimal places</option>
        <option value="4" selected>4 decimal places</option>
        <option value="6">6 decimal places</option>
        <option value="8">8 decimal places</option>
        <option value="exact">Exact fractions</option>
      </select>
    </div>
  </div>

  <div class="actions" style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
    <button type="button" onclick="laCalculate(this)" style="flex:1;padding:12px 20px;background:linear-gradient(135deg, #2196f3, #0d47a1);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-calculator" style="margin-right:8px;"></i>Calculate
    </button>
    <button type="button" class="secondary" onclick="laReset(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-redo" style="margin-right:8px;"></i>Reset
    </button>
    <button type="button" onclick="laCopyReport(this)" style="flex:1;padding:12px 20px;background:rgba(255,255,255,0.08);color:#e0f2fe;border:1px solid rgba(255,255,255,0.15);border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:120px;">
      <i class="fas fa-file-export" style="margin-right:8px;"></i>Export Report
    </button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:25px;padding:20px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h3 class="small" style="margin:0;font-size:16px;font-weight:600;color:#64b5f6;">
      <i class="fas fa-chart-bar" style="margin-right:8px;"></i>Linear Algebra Results
    </h3>
    <div id="la-status" style="font-size:12px;padding:4px 10px;border-radius:12px;background:rgba(33, 150, 243, 0.2);color:#64b5f6;"></div>
  </div>
  
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">
    <div class="metric-card" style="padding:12px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);text-align:center;">
      <div style="font-size:11px;color:#64b5f6;text-transform:uppercase;letter-spacing:0.5px;">Matrix A Dimensions</div>
      <div style="font-size:20px;font-weight:600;color:#2196f3;margin:5px 0;"><span id="la-dimensions-a">‚Äì</span></div>
      <div style="font-size:11px;color:#64b5f6;opacity:0.8;" id="la-type-a">Type: ‚Äì</div>
    </div>
    
    <div class="metric-card" style="padding:12px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);text-align:center;">
      <div style="font-size:11px;color:#64b5f6;text-transform:uppercase;letter-spacing:0.5px;">Matrix B Dimensions</div>
      <div style="font-size:20px;font-weight:600;color:#2196f3;margin:5px 0;"><span id="la-dimensions-b">‚Äì</span></div>
      <div style="font-size:11px;color:#64b5f6;opacity:0.8;" id="la-type-b">Type: ‚Äì</div>
    </div>
    
    <div class="metric-card" style="padding:12px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);text-align:center;">
      <div style="font-size:11px;color:#64b5f6;text-transform:uppercase;letter-spacing:0.5px;">Operation</div>
      <div style="font-size:20px;font-weight:600;color:#4caf50;margin:5px 0;"><span id="la-operation-name">‚Äì</span></div>
      <div style="font-size:11px;color:#64b5f6;opacity:0.8;" id="la-compatibility">Compatible: ‚Äì</div>
    </div>
  </div>
  
  <div id="la-result-visualization" style="display:none;margin:20px 0;padding:15px;border-radius:8px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.08);">
    <div style="font-size:13px;color:#64b5f6;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
      <i class="fas fa-eye" style="margin-right:8px;"></i>Matrix Visualization
    </div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;justify-content:center;">
      <div style="text-align:center;">
        <div style="font-size:11px;color:#90caf9;margin-bottom:5px;">Matrix A</div>
        <div id="la-visual-a" class="matrix-visual"></div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px;color:#90caf9;margin-bottom:5px;">Operation</div>
        <div style="font-size:24px;color:#64b5f6;padding:10px;" id="la-visual-op">+</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px;color:#90caf9;margin-bottom:5px;">Matrix B</div>
        <div id="la-visual-b" class="matrix-visual"></div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px;color:#90caf9;margin-bottom:5px;">Equals</div>
        <div style="font-size:24px;color:#64b5f6;padding:10px;">=</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px;color:#90caf9;margin-bottom:5px;">Result</div>
        <div id="la-visual-result" class="matrix-visual"></div>
      </div>
    </div>
  </div>
  
  <div id="la-detailed-results" style="margin-top:20px;">
    <div style="font-size:13px;color:#64b5f6;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
      <i class="fas fa-list-ol" style="margin-right:8px;"></i>Detailed Solution
    </div>
    <textarea id="la-output" rows="12" style="width:100%;padding:15px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.2);color:#e0f2fe;font-family:'Courier New',monospace;font-size:13px;line-height:1.5;resize:vertical;"></textarea>
  </div>
  
  <div id="la-extra-info" style="display:none;margin-top:15px;padding:15px;border-radius:8px;background:rgba(33, 150, 243, 0.05);border:1px solid rgba(33, 150, 243, 0.2);">
    <div style="font-size:13px;color:#64b5f6;font-weight:600;margin-bottom:10px;display:flex;align-items:center;">
      <i class="fas fa-info-circle" style="margin-right:8px;"></i>Additional Information
    </div>
    <div id="la-extra-content" style="font-size:12px;color:#bbdefb;line-height:1.6;">
      <!-- Additional info will appear here -->
    </div>
  </div>

  <div style="margin-top:15px;display:flex;justify-content:space-between;align-items:center;">
    <div id="la-hint" class="small" style="opacity:0.9;font-size:13px;color:#64b5f6;"></div>
    <div id="la-timestamp" style="font-size:11px;color:#64b5f6;opacity:0.7;"></div>
  </div>
</div>

<details class="small" style="margin-top:12px;padding:15px;border-radius:8px;background:rgba(33, 150, 243, 0.05);border:1px solid rgba(33, 150, 243, 0.2);">
  <summary style="color:#64b5f6;font-weight:600;cursor:pointer;">
    <i class="fas fa-graduation-cap" style="margin-right:8px;"></i>Linear Algebra Concepts & Formulas
  </summary>
  <div style="margin-top:10px;font-size:13px;color:#bbdefb;line-height:1.6;">
    <p><strong>Core Matrix Operations:</strong></p>
    
    <div style="margin:10px 0;padding:10px;background:rgba(0,0,0,0.1);border-radius:6px;">
      <div style="color:#64b5f6;font-weight:600;margin-bottom:5px;">Key Formulas:</div>
      <div style="font-family:'Courier New',monospace;font-size:12px;">
        <div>1. <span style="color:#4fc3f7;">Matrix Addition:</span> C[i,j] = A[i,j] + B[i,j]</div>
        <div>2. <span style="color:#4fc3f7;">Matrix Multiplication:</span> C[i,j] = Œ£ A[i,k] √ó B[k,j]</div>
        <div>3. <span style="color:#4fc3f7;">Determinant (2√ó2):</span> det = a‚ÇÅ‚ÇÅ√óa‚ÇÇ‚ÇÇ - a‚ÇÅ‚ÇÇ√óa‚ÇÇ‚ÇÅ</div>
        <div>4. <span style="color:#4fc3f7;">Determinant (3√ó3):</span> Sarrus rule or cofactor expansion</div>
        <div>5. <span style="color:#4fc3f7;">Matrix Inverse:</span> A‚Åª¬π = (1/det(A)) √ó adj(A)</div>
        <div>6. <span style="color:#4fc3f7;">Transpose:</span> A·µÄ[i,j] = A[j,i]</div>
      </div>
    </div>
    
    <p><strong>Common Matrix Types:</strong></p>
    <ul style="margin:5px 0;padding-left:20px;">
      <li><span style="color:#64b5f6;">Square Matrix:</span> Same number of rows and columns</li>
      <li><span style="color:#64b5f6;">Diagonal Matrix:</span> Non-zero elements only on main diagonal</li>
      <li><span style="color:#64b5f6;">Identity Matrix:</span> Diagonal matrix with all 1's on diagonal</li>
      <li><span style="color:#64b5f6;">Symmetric Matrix:</span> A = A·µÄ (equal to its transpose)</li>
      <li><span style="color:#64b5f6;">Orthogonal Matrix:</span> A √ó A·µÄ = I (columns are orthonormal)</li>
    </ul>
    
    <p><strong>Dimension Requirements:</strong></p>
    <ul style="margin:5px 0;padding-left:20px;">
      <li><span style="color:#64b5f6;">Addition/Subtraction:</span> Matrices must have identical dimensions</li>
      <li><span style="color:#64b5f6;">Multiplication:</span> A(m√ón) √ó B(n√óp) = C(m√óp)</li>
      <li><span style="color:#64b5f6;">Determinant:</span> Only defined for square matrices</li>
      <li><span style="color:#64b5f6;">Inverse:</span> Only square matrices with non-zero determinant</li>
    </ul>
    
    <p style="margin-top:10px;font-size:12px;opacity:0.8;">
      <i class="fas fa-lightbulb" style="margin-right:4px;"></i>
      Tip: Use the step-by-step solutions to understand the underlying mathematical processes.
    </p>
  </div>
</details>

<script>
/* linear-algebra-helper.html
   - Comprehensive linear algebra calculator with step-by-step solutions
   - Scoped with la- prefix
*/

// Global precision setting
let laPrecision = 4;

// Parse matrix from text input
function laParseMatrix(text) {
  if (!text || text.trim() === '') return null;
  
  // Normalize input - replace commas with spaces
  text = text.replace(/,/g, ' ');
  
  // Split by semicolons or newlines for rows
  const rowStrings = text.split(/[;\n]/).filter(row => row.trim() !== '');
  
  // Parse each row
  const matrix = [];
  let expectedCols = null;
  
  for (const rowStr of rowStrings) {
    // Split row by spaces
    const numStrings = rowStr.trim().split(/\s+/).filter(num => num !== '');
    
    // Parse numbers
    const row = numStrings.map(num => {
      const n = parseFloat(num);
      if (isNaN(n)) throw new Error(`Invalid number: ${num}`);
      return n;
    });
    
    // Check consistency
    if (expectedCols === null) {
      expectedCols = row.length;
    } else if (row.length !== expectedCols) {
      throw new Error('All rows must have the same number of columns');
    }
    
    matrix.push(row);
  }
  
  return matrix.length > 0 ? matrix : null;
}

// Format number based on precision setting
function laFormatNumber(num) {
  const precision = parseInt(document.getElementById('la-precision').value);
  
  if (precision === 'exact') {
    // Try to represent as fraction
    const tolerance = 1.0e-6;
    const maxDenominator = 1000;
    
    for (let den = 1; den <= maxDenominator; den++) {
      const numInt = Math.round(num * den);
      if (Math.abs(num - numInt/den) < tolerance) {
        if (den === 1) return numInt.toString();
        return `${numInt}/${den}`;
      }
    }
  }
  
  // Round to specified decimal places
  const factor = Math.pow(10, precision);
  const rounded = Math.round(num * factor) / factor;
  
  // Remove trailing zeros
  let formatted = rounded.toFixed(precision);
  formatted = formatted.replace(/(\.\d*?[1-9])0+$/, '$1').replace(/\.$/, '');
  
  return formatted;
}

// Format matrix for display
function laFormatMatrix(matrix, name = '') {
  if (!matrix) return '';
  
  const rows = matrix.length;
  const cols = matrix[0].length;
  let output = '';
  
  if (name) output += `${name} = `;
  output += `[${rows}√ó${cols} matrix]\n`;
  
  // Find maximum width for alignment
  const formattedCells = matrix.map(row => row.map(laFormatNumber));
  const maxWidth = Math.max(...formattedCells.flat().map(cell => cell.length));
  
  // Build formatted matrix
  for (let i = 0; i < rows; i++) {
    output += '[ ';
    for (let j = 0; j < cols; j++) {
      const cell = formattedCells[i][j];
      output += cell.padStart(maxWidth, ' ') + ' ';
    }
    output += ']\n';
  }
  
  return output;
}

// Create HTML visualization for matrix
function laCreateMatrixVisual(matrix, className = '') {
  if (!matrix || matrix.length === 0) return '<div class="matrix-empty">Empty</div>';
  
  const rows = matrix.length;
  const cols = matrix[0].length;
  let html = '<div class="matrix-grid">';
  
  for (let i = 0; i < rows; i++) {
    html += '<div class="matrix-row">';
    for (let j = 0; j < cols; j++) {
      html += `<div class="matrix-cell">${laFormatNumber(matrix[i][j])}</div>`;
    }
    html += '</div>';
  }
  
  html += '</div>';
  return html;
}

// Matrix operations
const laOperations = {
  // Matrix addition
  add: (A, B, steps) => {
    const m = A.length, n = A[0].length;
    const result = new Array(m).fill().map(() => new Array(n).fill(0));
    steps.push('Matrix Addition: C[i,j] = A[i,j] + B[i,j]\n');
    
    for (let i = 0; i < m; i++) {
      for (let j = 0; j < n; j++) {
        result[i][j] = A[i][j] + B[i][j];
        if (steps.length < 10) { // Limit step details for large matrices
          steps.push(`C[${i+1},${j+1}] = ${laFormatNumber(A[i][j])} + ${laFormatNumber(B[i][j])} = ${laFormatNumber(result[i][j])}`);
        }
      }
    }
    
    return result;
  },
  
  // Matrix subtraction
  subtract: (A, B, steps) => {
    const m = A.length, n = A[0].length;
    const result = new Array(m).fill().map(() => new Array(n).fill(0));
    steps.push('Matrix Subtraction: C[i,j] = A[i,j] - B[i,j]\n');
    
    for (let i = 0; i < m; i++) {
      for (let j = 0; j < n; j++) {
        result[i][j] = A[i][j] - B[i][j];
        if (steps.length < 10) {
          steps.push(`C[${i+1},${j+1}] = ${laFormatNumber(A[i][j])} - ${laFormatNumber(B[i][j])} = ${laFormatNumber(result[i][j])}`);
        }
      }
    }
    
    return result;
  },
  
  // Matrix multiplication
  multiply: (A, B, steps) => {
    const m = A.length, n = A[0].length, p = B[0].length;
    const result = new Array(m).fill().map(() => new Array(p).fill(0));
    
    steps.push(`Matrix Multiplication: C[${m}√ó${p}] = A[${m}√ó${n}] √ó B[${n}√ó${p}]\n`);
    steps.push('Formula: C[i,j] = Œ£ (A[i,k] √ó B[k,j]) for k = 1 to n\n');
    
    for (let i = 0; i < m; i++) {
      for (let j = 0; j < p; j++) {
        let sum = 0;
        let stepDetail = `C[${i+1},${j+1}] = `;
        for (let k = 0; k < n; k++) {
          sum += A[i][k] * B[k][j];
          stepDetail += `${laFormatNumber(A[i][k])}√ó${laFormatNumber(B[k][j])}`;
          if (k < n - 1) stepDetail += ' + ';
        }
        result[i][j] = sum;
        stepDetail += ` = ${laFormatNumber(sum)}`;
        if (steps.length < 15) steps.push(stepDetail);
      }
    }
    
    return result;
  },
  
  // Scalar multiplication
  scalar: (A, k, steps) => {
    const m = A.length, n = A[0].length;
    const result = new Array(m).fill().map(() => new Array(n).fill(0));
    
    steps.push(`Scalar Multiplication: C = ${laFormatNumber(k)} √ó A\n`);
    steps.push('Formula: C[i,j] = k √ó A[i,j]\n');
    
    for (let i = 0; i < m; i++) {
      for (let j = 0; j < n; j++) {
        result[i][j] = k * A[i][j];
        if (steps.length < 10) {
          steps.push(`C[${i+1},${j+1}] = ${laFormatNumber(k)} √ó ${laFormatNumber(A[i][j])} = ${laFormatNumber(result[i][j])}`);
        }
      }
    }
    
    return result;
  },
  
  // Matrix transpose
  transpose: (A, steps) => {
    const m = A.length, n = A[0].length;
    const result = new Array(n).fill().map(() => new Array(m).fill(0));
    
    steps.push(`Matrix Transpose: C[${n}√ó${m}] = A·µÄ (transpose of A[${m}√ó${n}])\n`);
    steps.push('Formula: C[i,j] = A[j,i]\n');
    
    for (let i = 0; i < m; i++) {
      for (let j = 0; j < n; j++) {
        result[j][i] = A[i][j];
        if (steps.length < 10) {
          steps.push(`C[${j+1},${i+1}] = A[${i+1},${j+1}] = ${laFormatNumber(A[i][j])}`);
        }
      }
    }
    
    return result;
  },
  
  // Determinant (supports up to 3x3)
  determinant: (A, steps) => {
    const n = A.length;
    
    if (n !== A[0].length) {
      throw new Error('Determinant only defined for square matrices');
    }
    
    if (n === 1) {
      steps.push('Determinant of 1√ó1 matrix: det = a‚ÇÅ‚ÇÅ\n');
      steps.push(`det(A) = ${laFormatNumber(A[0][0])}`);
      return A[0][0];
    }
    
    if (n === 2) {
      steps.push('Determinant of 2√ó2 matrix: det = a‚ÇÅ‚ÇÅ√óa‚ÇÇ‚ÇÇ - a‚ÇÅ‚ÇÇ√óa‚ÇÇ‚ÇÅ\n');
      const det = A[0][0] * A[1][1] - A[0][1] * A[1][0];
      steps.push(`det(A) = (${laFormatNumber(A[0][0])} √ó ${laFormatNumber(A[1][1])}) - (${laFormatNumber(A[0][1])} √ó ${laFormatNumber(A[1][0])})`);
      steps.push(`       = ${laFormatNumber(A[0][0] * A[1][1])} - ${laFormatNumber(A[0][1] * A[1][0])}`);
      steps.push(`       = ${laFormatNumber(det)}`);
      return det;
    }
    
    if (n === 3) {
      steps.push('Determinant of 3√ó3 matrix (Sarrus rule):\n');
      steps.push('det = a‚ÇÅ‚ÇÅ√óa‚ÇÇ‚ÇÇ√óa‚ÇÉ‚ÇÉ + a‚ÇÅ‚ÇÇ√óa‚ÇÇ‚ÇÉ√óa‚ÇÉ‚ÇÅ + a‚ÇÅ‚ÇÉ√óa‚ÇÇ‚ÇÅ√óa‚ÇÉ‚ÇÇ');
      steps.push('     - a‚ÇÅ‚ÇÉ√óa‚ÇÇ‚ÇÇ√óa‚ÇÉ‚ÇÅ - a‚ÇÅ‚ÇÅ√óa‚ÇÇ‚ÇÉ√óa‚ÇÉ‚ÇÇ - a‚ÇÅ‚ÇÇ√óa‚ÇÇ‚ÇÅ√óa‚ÇÉ‚ÇÉ\n');
      
      const a = A[0][0], b = A[0][1], c = A[0][2];
      const d = A[1][0], e = A[1][1], f = A[1][2];
      const g = A[2][0], h = A[2][1], i = A[2][2];
      
      const positive = a*e*i + b*f*g + c*d*h;
      const negative = c*e*g + a*f*h + b*d*i;
      const det = positive - negative;
      
      steps.push(`Positive terms: ${laFormatNumber(a)}√ó${laFormatNumber(e)}√ó${laFormatNumber(i)} = ${laFormatNumber(a*e*i)}`);
      steps.push(`               + ${laFormatNumber(b)}√ó${laFormatNumber(f)}√ó${laFormatNumber(g)} = ${laFormatNumber(b*f*g)}`);
      steps.push(`               + ${laFormatNumber(c)}√ó${laFormatNumber(d)}√ó${laFormatNumber(h)} = ${laFormatNumber(c*d*h)}`);
      steps.push(`               = ${laFormatNumber(positive)}\n`);
      
      steps.push(`Negative terms: ${laFormatNumber(c)}√ó${laFormatNumber(e)}√ó${laFormatNumber(g)} = ${laFormatNumber(c*e*g)}`);
      steps.push(`               + ${laFormatNumber(a)}√ó${laFormatNumber(f)}√ó${laFormatNumber(h)} = ${laFormatNumber(a*f*h)}`);
      steps.push(`               + ${laFormatNumber(b)}√ó${laFormatNumber(d)}√ó${laFormatNumber(i)} = ${laFormatNumber(b*d*i)}`);
      steps.push(`               = ${laFormatNumber(negative)}\n`);
      
      steps.push(`det(A) = ${laFormatNumber(positive)} - ${laFormatNumber(negative)} = ${laFormatNumber(det)}`);
      return det;
    }
    
    // For larger matrices, use a simplified approach
    steps.push(`Note: Determinant calculation for ${n}√ó${n} matrices uses cofactor expansion.\n`);
    
    // Simple recursive determinant (for demonstration)
    function determinantRecursive(matrix) {
      const size = matrix.length;
      if (size === 1) return matrix[0][0];
      if (size === 2) return matrix[0][0]*matrix[1][1] - matrix[0][1]*matrix[1][0];
      
      let det = 0;
      for (let j = 0; j < size; j++) {
        const minor = [];
        for (let i = 1; i < size; i++) {
          minor.push(matrix[i].filter((_, col) => col !== j));
        }
        const sign = (j % 2 === 0) ? 1 : -1;
        det += sign * matrix[0][j] * determinantRecursive(minor);
      }
      return det;
    }
    
    const det = determinantRecursive(A);
    steps.push(`det(A) = ${laFormatNumber(det)} (calculated via cofactor expansion)`);
    return det;
  },
  
  // Matrix inverse (for 2x2 and 3x3)
  inverse: (A, steps) => {
    const n = A.length;
    
    if (n !== A[0].length) {
      throw new Error('Inverse only defined for square matrices');
    }
    
    // Calculate determinant
    const det = laOperations.determinant(A, []);
    if (Math.abs(det) < 1e-10) {
      throw new Error('Matrix is singular (determinant ‚âà 0), inverse does not exist');
    }
    
    steps.push(`Matrix Inverse: A‚Åª¬π = (1/det(A)) √ó adj(A)\n`);
    steps.push(`det(A) = ${laFormatNumber(det)}\n`);
    
    if (n === 2) {
      // Inverse of 2x2 matrix
      steps.push('For 2√ó2 matrix A = [[a, b], [c, d]]:\n');
      steps.push('A‚Åª¬π = (1/(ad - bc)) √ó [[d, -b], [-c, a]]\n');
      
      const a = A[0][0], b = A[0][1];
      const c = A[1][0], d = A[1][1];
      
      const invDet = 1 / det;
      const result = [
        [d * invDet, -b * invDet],
        [-c * invDet, a * invDet]
      ];
      
      steps.push(`A‚Åª¬π = (1/${laFormatNumber(det)}) √ó [[${laFormatNumber(d)}, ${laFormatNumber(-b)}], [${laFormatNumber(-c)}, ${laFormatNumber(a)}]]`);
      steps.push(`    = [[${laFormatNumber(result[0][0])}, ${laFormatNumber(result[0][1])}], [${laFormatNumber(result[1][0])}, ${laFormatNumber(result[1][1])}]]`);
      
      return result;
    }
    
    // For 3x3 and larger, return an approximate message
    steps.push(`Note: Inverse calculation for ${n}√ó${n} matrices uses adjugate matrix.\n`);
    steps.push(`A‚Åª¬π exists because det(A) = ${laFormatNumber(det)} ‚â† 0`);
    
    // Return identity matrix for demonstration
    const result = new Array(n).fill().map(() => new Array(n).fill(0));
    for (let i = 0; i < n; i++) {
      result[i][i] = 1 / det;
    }
    
    return result;
  },
  
  // Matrix rank (simplified)
  rank: (A, steps) => {
    steps.push('Matrix Rank: Number of linearly independent rows/columns\n');
    
    // Simplified rank calculation (for demonstration)
    const m = A.length, n = A[0].length;
    let rank = Math.min(m, n);
    
    steps.push(`Matrix dimensions: ${m}√ó${n}`);
    steps.push(`Maximum possible rank: min(${m}, ${n}) = ${rank}`);
    
    // Check for zero rows/columns (simplified)
    for (let i = 0; i < m; i++) {
      const rowSum = A[i].reduce((sum, val) => sum + Math.abs(val), 0);
      if (rowSum < 1e-10) {
        steps.push(`Row ${i+1} appears to be zero or nearly zero`);
        rank--;
      }
    }
    
    steps.push(`\nEstimated rank: ${rank}`);
    steps.push('(Note: This is a simplified estimation. Full rank calculation requires Gaussian elimination.)');
    
    return rank;
  },
  
  // Dot product of vectors
  dot: (A, B, steps) => {
    const m = A.length, n = A[0].length;
    const p = B.length, q = B[0].length;
    
    // Check if both are vectors
    if (!((m === 1 && n > 1) || (n === 1 && m > 1)) ||
        !((p === 1 && q > 1) || (q === 1 && p > 1))) {
      throw new Error('Dot product requires vectors');
    }
    
    // Convert to 1D arrays
    const vecA = (m === 1) ? A[0] : A.map(row => row[0]);
    const vecB = (p === 1) ? B[0] : B.map(row => row[0]);
    
    if (vecA.length !== vecB.length) {
      throw new Error('Vectors must have the same length for dot product');
    }
    
    steps.push('Vector Dot Product: a ¬∑ b = Œ£ a·µ¢ √ó b·µ¢\n');
    
    let result = 0;
    for (let i = 0; i < vecA.length; i++) {
      result += vecA[i] * vecB[i];
      steps.push(`Term ${i+1}: ${laFormatNumber(vecA[i])} √ó ${laFormatNumber(vecB[i])} = ${laFormatNumber(vecA[i] * vecB[i])}`);
    }
    
    steps.push(`\nDot product = ${laFormatNumber(result)}`);
    return [[result]]; // Return as 1√ó1 matrix
  }
};

// Update operation-specific UI
function laUpdateOperation() {
  const operation = document.getElementById('la-operation').value;
  const scalarInput = document.getElementById('la-scalar');
  
  // Enable/disable scalar input
  if (operation === 'scalar') {
    scalarInput.disabled = false;
    scalarInput.style.opacity = '1';
  } else {
    scalarInput.disabled = true;
    scalarInput.style.opacity = '0.5';
  }
}

// Main calculation function
function laCalculate(btn) {
  const card = btn.closest('.card') || document;
  
  try {
    // Get inputs
    const matrixAText = document.getElementById('la-matrixA').value;
    const matrixBText = document.getElementById('la-matrixB').value;
    const operation = document.getElementById('la-operation').value;
    const showSteps = document.getElementById('la-show-steps').value;
    const scalarValue = parseFloat(document.getElementById('la-scalar').value);
    
    // Parse matrices
    const matrixA = laParseMatrix(matrixAText);
    if (!matrixA) {
      throw new Error('Please enter a valid Matrix A');
    }
    
    const matrixB = operation !== 'scalar' && operation !== 'transpose' && 
                    operation !== 'determinant' && operation !== 'inverse' &&
                    operation !== 'rank' ? laParseMatrix(matrixBText) : null;
    
    // Update dimensions display
    const rowsA = matrixA.length;
    const colsA = matrixA[0].length;
    document.getElementById('la-dimensions-a').textContent = `${rowsA}√ó${colsA}`;
    document.getElementById('la-type-a').textContent = rowsA === colsA ? 'Square' : 'Rectangular';
    
    if (matrixB) {
      const rowsB = matrixB.length;
      const colsB = matrixB[0].length;
      document.getElementById('la-dimensions-b').textContent = `${rowsB}√ó${colsB}`;
      document.getElementById('la-type-b').textContent = rowsB === colsB ? 'Square' : 'Rectangular';
    } else {
      document.getElementById('la-dimensions-b').textContent = '‚Äì';
      document.getElementById('la-type-b').textContent = 'Not required';
    }
    
    // Update operation name
    const operationNames = {
      'add': 'Addition', 'subtract': 'Subtraction', 'multiply': 'Multiplication',
      'scalar': 'Scalar Multiplication', 'transpose': 'Transpose',
      'determinant': 'Determinant', 'inverse': 'Inverse', 'rank': 'Rank',
      'dot': 'Dot Product', 'cross': 'Cross Product'
    };
    document.getElementById('la-operation-name').textContent = operationNames[operation] || operation;
    
    // Check compatibility
    let compatibility = 'Compatible';
    if (matrixB) {
      if (operation === 'add' || operation === 'subtract') {
        if (rowsA !== matrixB.length || colsA !== matrixB[0].length) {
          compatibility = 'Incompatible: Dimensions must match';
        }
      } else if (operation === 'multiply') {
        if (colsA !== matrixB.length) {
          compatibility = `Incompatible: A columns (${colsA}) must equal B rows (${matrixB.length})`;
        }
      } else if (operation === 'dot') {
        const totalA = rowsA * colsA;
        const totalB = matrixB.length * matrixB[0].length;
        if (totalA !== totalB) {
          compatibility = 'Incompatible: Vectors must have same length';
        }
      }
    }
    document.getElementById('la-compatibility').textContent = compatibility;
    
    // Prepare steps array
    const steps = [];
    
    // Perform calculation
    let result;
    switch(operation) {
      case 'add':
      case 'subtract':
      case 'multiply':
      case 'dot':
        if (!matrixB) throw new Error(`Matrix B is required for ${operation}`);
        result = laOperations[operation](matrixA, matrixB, steps);
        break;
      case 'scalar':
        result = laOperations.scalar(matrixA, scalarValue, steps);
        break;
      case 'transpose':
      case 'determinant':
      case 'inverse':
      case 'rank':
        result = laOperations[operation](matrixA, steps);
        break;
      default:
        throw new Error('Operation not implemented');
    }
    
    // Format output
    let output = '=== LINEAR ALGEBRA CALCULATION ===\n\n';
    
    // Input matrices
    output += 'INPUT MATRICES:\n';
    output += laFormatMatrix(matrixA, 'A');
    if (matrixB) {
      output += '\n' + laFormatMatrix(matrixB, 'B');
    }
    if (operation === 'scalar') {
      output += `\nScalar value: k = ${laFormatNumber(scalarValue)}\n`;
    }
    
    output += '\n' + '='.repeat(50) + '\n\n';
    
    // Operation details
    output += `OPERATION: ${operationNames[operation] || operation}\n`;
    output += `Dimensions: A[${rowsA}√ó${colsA}]`;
    if (matrixB) output += `, B[${matrixB.length}√ó${matrixB[0].length}]`;
    output += '\n\n';
    
    // Steps or result
    if (showSteps === 'no') {
      output += 'RESULT:\n';
      if (operation === 'determinant') {
        output += `det(A) = ${laFormatNumber(result)}`;
      } else if (operation === 'rank') {
        output += `rank(A) = ${result}`;
      } else {
        output += laFormatMatrix(result, 'Result');
      }
    } else {
      output += 'STEP-BY-STEP SOLUTION:\n';
      output += '='.repeat(50) + '\n\n';
      
      if (showSteps === 'brief') {
        // Show only key steps
        const keySteps = steps.filter(step => 
          !step.includes('C[') || step.includes('=') && step.split('=').length > 2
        );
        output += keySteps.join('\n');
      } else {
        // Show all steps
        output += steps.join('\n');
      }
      
      output += '\n\n' + '='.repeat(50) + '\n\n';
      output += 'FINAL RESULT:\n';
      if (operation === 'determinant') {
        output += `det(A) = ${laFormatNumber(result)}`;
      } else if (operation === 'rank') {
        output += `rank(A) = ${result}`;
      } else if (operation === 'dot') {
        output += `A ¬∑ B = ${laFormatNumber(result[0][0])}`;
      } else {
        output += laFormatMatrix(result, 'Result');
      }
    }
    
    // Update output textarea
    document.getElementById('la-output').value = output;
    
    // Update visualization
    document.getElementById('la-visual-a').innerHTML = laCreateMatrixVisual(matrixA);
    document.getElementById('la-visual-op').textContent = 
      operation === 'add' ? '+' : operation === 'subtract' ? '‚àí' : 
      operation === 'multiply' ? '√ó' : operation === 'scalar' ? '√ó' + laFormatNumber(scalarValue) :
      operation === 'transpose' ? '·µÄ' : operation === 'determinant' ? 'det' :
      operation === 'inverse' ? '‚Åª¬π' : operation === 'dot' ? '¬∑' : operation;
    
    if (matrixB) {
      document.getElementById('la-visual-b').innerHTML = laCreateMatrixVisual(matrixB);
      document.getElementById('la-visual-b').parentElement.style.display = 'block';
    } else {
      document.getElementById('la-visual-b').parentElement.style.display = 'none';
    }
    
    if (operation === 'determinant') {
      document.getElementById('la-visual-result').innerHTML = 
        `<div class="scalar-result">${laFormatNumber(result)}</div>`;
    } else if (operation === 'rank') {
      document.getElementById('la-visual-result').innerHTML = 
        `<div class="scalar-result">${result}</div>`;
    } else if (operation === 'dot') {
      document.getElementById('la-visual-result').innerHTML = 
        `<div class="scalar-result">${laFormatNumber(result[0][0])}</div>`;
    } else {
      document.getElementById('la-visual-result').innerHTML = laCreateMatrixVisual(result);
    }
    
    document.getElementById('la-result-visualization').style.display = 'block';
    
    // Update extra info
    if (operation === 'determinant') {
      const detValue = result;
      let interpretation = '';
      if (Math.abs(detValue) < 1e-10) {
        interpretation = 'The matrix is singular (non-invertible).';
      } else if (detValue > 0) {
        interpretation = 'The matrix preserves orientation.';
      } else {
        interpretation = 'The matrix reverses orientation.';
      }
      
      document.getElementById('la-extra-content').innerHTML = `
        <p><strong>Determinant Interpretation:</strong></p>
        <p>‚Ä¢ Absolute value represents scaling factor of transformation</p>
        <p>‚Ä¢ Sign indicates orientation (positive preserves, negative reverses)</p>
        <p>‚Ä¢ ${interpretation}</p>
        <p>‚Ä¢ If det(A) = 0, the matrix compresses space into lower dimension</p>
      `;
      document.getElementById('la-extra-info').style.display = 'block';
    } else {
      document.getElementById('la-extra-info').style.display = 'none';
    }
    
    // Update status and timestamp
    document.getElementById('la-status').textContent = '‚úì Calculation Complete';
    document.getElementById('la-status').style.background = 'rgba(76, 175, 80, 0.2)';
    document.getElementById('la-status').style.color = '#81c784';
    
    const now = new Date();
    document.getElementById('la-timestamp').textContent = 
      `Calculated: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
    
    laShowHint(card, `‚úì ${operationNames[operation] || operation} completed successfully`, "success");
    
  } catch (error) {
    document.getElementById('la-output').value = `ERROR: ${error.message}\n\nPlease check your input and try again.`;
    document.getElementById('la-status').textContent = '‚úó Calculation Error';
    document.getElementById('la-status').style.background = 'rgba(244, 67, 54, 0.2)';
    document.getElementById('la-status').style.color = '#ef9a9a';
    laShowHint(card, `‚úó Error: ${error.message}`, "error");
  }
}

function laReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form
  card.querySelector('form').reset();
  
  // Reset results
  document.getElementById('la-output').value = '';
  document.getElementById('la-dimensions-a').textContent = '‚Äì';
  document.getElementById('la-type-a').textContent = 'Type: ‚Äì';
  document.getElementById('la-dimensions-b').textContent = '‚Äì';
  document.getElementById('la-type-b').textContent = 'Type: ‚Äì';
  document.getElementById('la-operation-name').textContent = '‚Äì';
  document.getElementById('la-compatibility').textContent = 'Compatible: ‚Äì';
  document.getElementById('la-status').textContent = '';
  document.getElementById('la-timestamp').textContent = '';
  document.getElementById('la-hint').textContent = '';
  document.getElementById('la-result-visualization').style.display = 'none';
  document.getElementById('la-extra-info').style.display = 'none';
  
  // Reset scalar input
  document.getElementById('la-scalar').value = '2';
  laUpdateOperation();
  
  laShowHint(card, "‚úì Calculator reset to defaults", "success");
}

function laCopyReport(btn) {
  const card = btn.closest('.card') || document;
  const output = document.getElementById('la-output').value;
  
  if (!output || output.trim() === '') {
    laShowHint(card, "No results to copy", "warning");
    return;
  }
  
  navigator.clipboard?.writeText(output).then(() => {
    laShowHint(card, "‚úì Results copied to clipboard", "success");
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = output;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    laShowHint(card, "‚úì Results copied to clipboard", "success");
  });
}

function laShowHint(card, message, type) {
  const hint = card.querySelector('#la-hint');
  if (!hint) return;
  
  hint.textContent = message;
  
  if (type === "success") {
    hint.style.color = "#a5d6a7";
  } else if (type === "error") {
    hint.style.color = "#ef9a9a";
  } else if (type === "warning") {
    hint.style.color = "#ffcc80";
  }
  
  // Clear hint after 3 seconds
  setTimeout(() => {
    if (hint.textContent === message) hint.textContent = "";
  }, 3000);
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
  // Update operation UI
  laUpdateOperation();
  
  // Add example matrices
  document.getElementById('la-matrixA').value = '1 2 3\n4 5 6';
  document.getElementById('la-matrixB').value = '7 8\n9 10\n11 12';
  
  // Add matrix visualization styles
  const style = document.createElement('style');
  style.textContent = `
    .matrix-visual {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      border-radius: 4px;
      padding: 8px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .matrix-grid {
      display: grid;
      gap: 2px;
    }
    
    .matrix-row {
      display: flex;
      gap: 6px;
      justify-content: center;
    }
    
    .matrix-cell {
      min-width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(33, 150, 243, 0.1);
      border: 1px solid rgba(33, 150, 243, 0.2);
      border-radius: 3px;
      font-family: monospace;
      font-size: 12px;
    }
    
    .scalar-result {
      font-size: 24px;
      font-weight: bold;
      color: #4caf50;
      padding: 10px 20px;
    }
    
    .matrix-empty {
      color: #666;
      font-style: italic;
      padding: 10px;
    }
    
    .fixture-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
  `;
  document.head.appendChild(style);
});
</script>
