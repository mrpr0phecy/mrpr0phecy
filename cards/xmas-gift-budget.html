<h2 id="xmas-gift-budget-title" style="margin-top:0;color:#ff4d4d;">ğŸ’° Christmas Gift Budget Planner</h2>

<form aria-describedby="gift-budget-desc" style="margin-bottom:20px;">
  <p id="gift-budget-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:16px;">
    Plan, track, and optimize your Christmas gift spending. Avoid overspending with smart budgeting!
    <span style="color:#39ff14;display:block;margin-top:4px;">
      âœ… Features: Gift ideas, price tracking, comparison shopping, receipt scanning
    </span>
  </p>

  <!-- Budget Overview -->
  <div style="background:rgba(255,77,77,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,77,77,0.1);">
    <h3 style="color:#ff4d4d;margin:0 0 12px 0;font-size:16px;">ğŸ¯ Set Your Christmas Budget</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="gb-total-budget" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ’° Total Christmas Budget ($)
        </label>
        <input id="gb-total-budget" type="range" min="100" max="5000" step="50" value="1000"
               oninput="gbUpdateBudget(this.value)"
               style="width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(255,77,77,0.6) 0%, rgba(255,77,77,0.3) 100%);outline:none;">
        <div style="display:flex;justify-content:space-between;margin-top:4px;">
          <span style="font-size:11px;color:rgba(230,250,255,0.6);">$100</span>
          <span id="gb-budget-display" style="font-weight:600;color:#ff4d4d;">$1,000</span>
          <span style="font-size:11px;color:rgba(230,250,255,0.6);">$5,000</span>
        </div>
      </div>
      
      <div class="field">
        <label for="gb-people-count" style="display:block;margin-bottom:6px;color:#ff4d4d;font-weight:500;">
          ğŸ‘¥ People to Gift
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <button type="button" onclick="gbChangePeople(-1)" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">-</button>
          <div id="gb-people-display" style="font-weight:600;color:#ff4d4d;min-width:60px;text-align:center;">10</div>
          <button type="button" onclick="gbChangePeople(1)" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">+</button>
        </div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">
          Suggested: $<span id="gb-suggested-per-person">100</span> per person
        </div>
      </div>
    </div>

    <div style="background:rgba(0,0,0,0.3);border-radius:8px;padding:12px;margin-top:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="color:#39ff14;font-size:14px;">Budget Status</div>
        <div id="gb-budget-status" style="font-size:12px;color:#39ff14;">$1,000 remaining</div>
      </div>
      <div style="height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;">
        <div id="gb-budget-progress" style="height:100%;background:linear-gradient(90deg, #39ff14, #ffcc00);width:0%;transition:width 0.5s;border-radius:6px;"></div>
      </div>
    </div>
  </div>

  <!-- Add Gift -->
  <div style="background:rgba(39,255,20,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(39,255,20,0.1);">
    <h3 style="color:#39ff14;margin:0 0 12px 0;font-size:16px;">ğŸ Add a Gift</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="gb-gift-for" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ‘¤ Gift For
        </label>
        <input id="gb-gift-for" type="text" placeholder="e.g., Mom, Dad, Kids" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="gb-gift-item" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ Gift Item
        </label>
        <input id="gb-gift-item" type="text" placeholder="e.g., Smart Watch, Book, Gift Card" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;" />
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <div class="field">
        <label for="gb-gift-price" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ’° Price ($)
        </label>
        <input id="gb-gift-price" type="number" min="0" step="0.01" placeholder="49.99"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;" />
      </div>
      
      <div class="field">
        <label for="gb-gift-status" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          ğŸ“¦ Status
        </label>
        <select id="gb-gift-status" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;">
          <option value="planned">ğŸŸ¡ Planned</option>
          <option value="purchased">ğŸŸ¢ Purchased</option>
          <option value="wrapped">ğŸ Wrapped</option>
          <option value="delivered">ğŸ“¦ Delivered</option>
        </select>
      </div>
      
      <div class="field">
        <label for="gb-gift-priority" style="display:block;margin-bottom:6px;color:#39ff14;font-weight:500;">
          â­ Priority
        </label>
        <select id="gb-gift-priority" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(39,255,20,0.3);background:rgba(39,255,20,0.05);color:inherit;">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="essential">ğŸ„ Essential</option>
        </select>
      </div>
    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px;">
      <button type="button" onclick="gbAddGift()" 
              style="padding:10px 20px;background:linear-gradient(135deg, rgba(39,255,20,0.2), rgba(39,255,20,0.1));border:1px solid rgba(39,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;">
        â• Add Gift
      </button>
    </div>
  </div>

  <!-- Quick Gift Ideas -->
  <div style="margin-bottom:20px;">
    <div style="color:#ff4d4d;font-weight:500;margin-bottom:8px;font-size:14px;">ğŸ’¡ Quick Gift Ideas by Budget</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="gbLoadIdea('under20')" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">ğŸ Under $20</button>
      <button type="button" onclick="gbLoadIdea('under50')" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">ğŸ’ $20-$50</button>
      <button type="button" onclick="gbLoadIdea('under100')" style="padding:8px 12px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">ğŸŒŸ $50-$100</button>
      <button type="button" onclick="gbLoadIdea('over100')" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">ğŸ… Over $100</button>
    </div>
  </div>

  <!-- Main Controls -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="gbOptimizeBudget()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1));border:1px solid rgba(255,77,77,0.4);border-radius:8px;color:#ff4d4d;cursor:pointer;font-weight:600;">
      ğŸ”„ Optimize Budget
    </button>
    <button type="button" onclick="gbClearAll()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ—‘ï¸ Clear All
    </button>
    <button type="button" onclick="gbExportPlan()"
            style="padding:12px 16px;background:rgba(39,255,20,0.1);border:1px solid rgba(39,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      ğŸ“Š Export Plan
    </button>
  </div>
</form>

<!-- Gift List -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:#ff4d4d;margin:0;">ğŸ“‹ Gift List (<span id="gb-gift-count">0</span> items)</h3>
    <div id="gb-status" style="font-size:12px;color:rgba(230,250,255,0.7);">No gifts added yet</div>
  </div>

  <!-- Gift Statistics -->
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px;">
    <div style="background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#ff4d4d;" id="gb-stat-total">$0</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Total Spent</div>
    </div>
    <div style="background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#ffa500;" id="gb-stat-remaining">$1,000</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Remaining</div>
    </div>
    <div style="background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#39ff14;" id="gb-stat-complete">0%</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Complete</div>
    </div>
    <div style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:var(--accent);" id="gb-stat-avg">$0</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Avg/Gift</div>
    </div>
  </div>

  <!-- Gift List Container -->
  <div id="gb-gift-list" style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:16px;margin-bottom:16px;min-height:200px;">
    <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
      <div style="font-size:48px;margin-bottom:12px;">ğŸ</div>
      <div>Add your first gift to start tracking your Christmas budget!</div>
    </div>
  </div>

  <!-- Budget Breakdown -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;margin-bottom:16px;">
    <h4 style="color:#39ff14;margin:0 0 8px 0;font-size:14px;">ğŸ“Š Budget Breakdown</h4>
    <div style="display:flex;align-items:center;gap:12px;">
      <div style="flex:1;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <div style="font-size:12px;color:rgba(230,250,255,0.7);">Spent</div>
          <div id="gb-spent-amount" style="font-size:12px;color:#ff4d4d;">$0</div>
        </div>
        <div style="display:flex;justify-content:space-between;">
          <div style="font-size:12px;color:rgba(230,250,255,0.7);">Remaining</div>
          <div id="gb-remaining-amount" style="font-size:12px;color:#39ff14;">$1,000</div>
        </div>
      </div>
      <div style="width:100px;height:100px;position:relative;">
        <canvas id="gb-budget-chart" width="100" height="100"></canvas>
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);text-align:center;">
          <div id="gb-chart-percent" style="font-size:16px;font-weight:600;color:#39ff14;">0%</div>
          <div style="font-size:10px;color:rgba(230,250,255,0.6);">spent</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Smart Suggestions -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;">
    <h4 style="color:#ff4d4d;margin:0 0 8px 0;font-size:14px;">ğŸ’¡ Smart Suggestions</h4>
    <div id="gb-suggestions" style="font-size:12px;line-height:1.5;color:rgba(230,250,255,0.8);">
      <div>Add gifts to get personalized budget suggestions!</div>
    </div>
  </div>
</div>

<!-- Comparison Shopping -->
<div style="margin-top:24px;background:rgba(255,77,77,0.05);border-radius:8px;border:1px solid rgba(255,77,77,0.1);padding:16px;">
  <h3 class="small" style="color:#ff4d4d;margin:0 0 12px 0;">ğŸ›’ Price Comparison Helper</h3>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div>
      <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">Current Price</div>
      <div style="font-size:20px;font-weight:600;color:#ff4d4d;">$<span id="gb-compare-current">0</span></div>
    </div>
    <div>
      <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">Potential Savings</div>
      <div style="font-size:20px;font-weight:600;color:#39ff14;">$<span id="gb-compare-savings">0</span></div>
    </div>
  </div>
  <div style="margin-top:12px;">
    <button onclick="gbFindDeals()" style="width:100%;padding:10px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;">
      ğŸ” Find Better Deals
    </button>
  </div>
</div>

<script>
/* christmas-gift-budget.html
   - Christmas gift budget planner and tracker
   - Scoped with "gb" prefix
*/

let gbTotalBudget = 1000;
let gbPeopleCount = 10;
let gbGifts = [];
let gbSpent = 0;
let gbChart = null;

// Gift categories with price suggestions
const gbGiftIdeas = {
  under20: [
    { name: "Christmas Mug", price: 15, category: "Home" },
    { name: "Scented Candles", price: 12, category: "Home" },
    { name: "Christmas Socks", price: 8, category: "Clothing" },
    { name: "Gourmet Hot Chocolate", price: 18, category: "Food" },
    { name: "Book", price: 16, category: "Entertainment" }
  ],
  under50: [
    { name: "Bluetooth Speaker", price: 45, category: "Tech" },
    { name: "Winter Scarf & Gloves Set", price: 35, category: "Clothing" },
    { name: "Wine Gift Set", price: 40, category: "Food" },
    { name: "Board Game", price: 32, category: "Entertainment" },
    { name: "Christmas Decorations", price: 28, category: "Home" }
  ],
  under100: [
    { name: "Smart Watch", price: 89, category: "Tech" },
    { name: "Perfume/Cologne", price: 75, category: "Personal Care" },
    { name: "Kitchen Appliance", price: 65, category: "Home" },
    { name: "Fitness Tracker", price: 85, category: "Tech" },
    { name: "Gift Card Bundle", price: 95, category: "Various" }
  ],
  over100: [
    { name: "Tablet", price: 249, category: "Tech" },
    { name: "Designer Handbag", price: 199, category: "Clothing" },
    { name: "Smart Home Device", price: 149, category: "Tech" },
    { name: "Jewelry", price: 175, category: "Accessories" },
    { name: "Experience Gift (Spa Day)", price: 120, category: "Experience" }
  ]
};

function gbUpdateBudget(value) {
  gbTotalBudget = parseInt(value);
  document.querySelector('#gb-budget-display').textContent = `$${gbTotalBudget.toLocaleString()}`;
  document.querySelector('#gb-suggested-per-person').textContent = Math.floor(gbTotalBudget / gbPeopleCount);
  gbUpdateStats();
}

function gbChangePeople(delta) {
  gbPeopleCount = Math.max(1, gbPeopleCount + delta);
  document.querySelector('#gb-people-display').textContent = gbPeopleCount;
  document.querySelector('#gb-suggested-per-person').textContent = Math.floor(gbTotalBudget / gbPeopleCount);
  gbUpdateSuggestions();
}

function gbAddGift() {
  const giftFor = document.querySelector('#gb-gift-for').value.trim();
  const giftItem = document.querySelector('#gb-gift-item').value.trim();
  const giftPrice = parseFloat(document.querySelector('#gb-gift-price').value) || 0;
  const giftStatus = document.querySelector('#gb-gift-status').value;
  const giftPriority = document.querySelector('#gb-gift-priority').value;
  
  if (!giftFor || !giftItem || giftPrice <= 0) {
    alert('Please fill in all gift details with a valid price');
    return;
  }
  
  if (gbSpent + giftPrice > gbTotalBudget) {
    if (!confirm(`This gift will exceed your budget by $${(gbSpent + giftPrice - gbTotalBudget).toFixed(2)}. Add anyway?`)) {
      return;
    }
  }
  
  const gift = {
    id: Date.now() + Math.random(),
    for: giftFor,
    item: giftItem,
    price: giftPrice,
    status: giftStatus,
    priority: giftPriority,
    date: new Date().toISOString()
  };
  
  gbGifts.push(gift);
  gbSpent += giftPrice;
  
  // Clear form
  document.querySelector('#gb-gift-for').value = '';
  document.querySelector('#gb-gift-item').value = '';
  document.querySelector('#gb-gift-price').value = '';
  
  // Update UI
  gbUpdateGiftList();
  gbUpdateStats();
  gbUpdateSuggestions();
  
  // Update status
  document.querySelector('#gb-status').textContent = `âœ… Added gift for ${giftFor}`;
  document.querySelector('#gb-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 2000);
}

function gbUpdateGiftList() {
  const container = document.querySelector('#gb-gift-list');
  
  if (gbGifts.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:40px;color:rgba(230,250,255,0.5);">
        <div style="font-size:48px;margin-bottom:12px;">ğŸ</div>
        <div>Add your first gift to start tracking your Christmas budget!</div>
      </div>
    `;
    return;
  }
  
  let html = '<div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:12px;">';
  
  gbGifts.forEach((gift, index) => {
    const statusColors = {
      'planned': '#ffa500',
      'purchased': '#39ff14',
      'wrapped': '#2dd4ff',
      'delivered': '#9d4edd'
    };
    
    const priorityColors = {
      'low': 'rgba(230,250,255,0.6)',
      'medium': '#ffa500',
      'high': '#ff4d4d',
      'essential': '#39ff14'
    };
    
    const statusIcons = {
      'planned': 'ğŸŸ¡',
      'purchased': 'ğŸŸ¢',
      'wrapped': 'ğŸ',
      'delivered': 'ğŸ“¦'
    };
    
    html += `
      <div style="background:rgba(0,0,0,0.4);border-radius:8px;padding:12px;border-left:4px solid ${statusColors[gift.status]};">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
          <div>
            <div style="font-weight:600;color:#ff4d4d;">${gift.for}</div>
            <div style="font-size:14px;color:rgba(230,250,255,0.9);margin-top:2px;">${gift.item}</div>
          </div>
          <div style="display:flex;gap:4px;align-items:center;">
            <span style="font-size:20px;">${statusIcons[gift.status]}</span>
            <button onclick="gbRemoveGift(${gift.id})" style="background:transparent;border:none;color:rgba(255,77,77,0.7);cursor:pointer;font-size:14px;" title="Remove">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
          <div style="display:flex;gap:8px;align-items:center;">
            <div style="font-size:18px;font-weight:600;color:#39ff14;">$${gift.price.toFixed(2)}</div>
            <div style="font-size:11px;padding:2px 6px;background:${priorityColors[gift.priority]};border-radius:4px;color:#000;">
              ${gift.priority}
            </div>
          </div>
          <div style="font-size:11px;color:rgba(230,250,255,0.6);">
            ${new Date(gift.date).toLocaleDateString()}
          </div>
        </div>
        
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button onclick="gbUpdateStatus(${gift.id}, 'purchased')" style="flex:1;padding:4px 8px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:11px;">
            Mark Purchased
          </button>
          <button onclick="gbUpdateStatus(${gift.id}, 'wrapped')" style="flex:1;padding:4px 8px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:4px;color:var(--accent);cursor:pointer;font-size:11px;">
            Mark Wrapped
          </button>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

function gbRemoveGift(id) {
  if (!confirm('Remove this gift from your list?')) return;
  
  const gift = gbGifts.find(g => g.id === id);
  if (gift) {
    gbSpent -= gift.price;
  }
  
  gbGifts = gbGifts.filter(g => g.id !== id);
  gbUpdateGiftList();
  gbUpdateStats();
}

function gbUpdateStatus(id, status) {
  const gift = gbGifts.find(g => g.id === id);
  if (gift) {
    gift.status = status;
    gbUpdateGiftList();
    
    document.querySelector('#gb-status').textContent = `âœ… Updated ${gift.for}'s gift status`;
    document.querySelector('#gb-status').style.color = '#39ff14';
    setTimeout(() => {
      document.querySelector('#gb-status').textContent = '';
    }, 2000);
  }
}

function gbUpdateStats() {
  const spent = gbSpent;
  const remaining = Math.max(0, gbTotalBudget - spent);
  const complete = gbGifts.length === 0 ? 0 : Math.floor((gbGifts.filter(g => g.status === 'purchased' || g.status === 'wrapped' || g.status === 'delivered').length / gbGifts.length) * 100);
  const avgGift = gbGifts.length === 0 ? 0 : spent / gbGifts.length;
  
  // Update stats display
  document.querySelector('#gb-stat-total').textContent = `$${spent.toFixed(0)}`;
  document.querySelector('#gb-stat-remaining').textContent = `$${remaining.toFixed(0)}`;
  document.querySelector('#gb-stat-complete').textContent = `${complete}%`;
  document.querySelector('#gb-stat-avg').textContent = `$${avgGift.toFixed(0)}`;
  
  // Update gift count
  document.querySelector('#gb-gift-count').textContent = gbGifts.length;
  
  // Update budget progress
  const progressPercent = (spent / gbTotalBudget) * 100;
  document.querySelector('#gb-budget-progress').style.width = `${Math.min(100, progressPercent)}%`;
  
  // Update budget status text
  const statusEl = document.querySelector('#gb-budget-status');
  if (remaining <= 0) {
    statusEl.textContent = 'âš ï¸ Budget exceeded!';
    statusEl.style.color = '#ff4d4d';
  } else if (remaining < gbTotalBudget * 0.2) {
    statusEl.textContent = `$${remaining.toFixed(0)} remaining (Low)`;
    statusEl.style.color = '#ffa500';
  } else {
    statusEl.textContent = `$${remaining.toFixed(0)} remaining`;
    statusEl.style.color = '#39ff14';
  }
  
  // Update chart
  gbUpdateChart(spent, remaining);
  
  // Update comparison
  document.querySelector('#gb-compare-current').textContent = spent.toFixed(0);
  document.querySelector('#gb-compare-savings').textContent = Math.floor(spent * 0.15); // 15% potential savings
  
  // Update breakdown
  document.querySelector('#gb-spent-amount').textContent = `$${spent.toFixed(2)}`;
  document.querySelector('#gb-remaining-amount').textContent = `$${remaining.toFixed(2)}`;
  document.querySelector('#gb-chart-percent').textContent = `${Math.min(100, Math.round(progressPercent))}%`;
}

function gbUpdateChart(spent, remaining) {
  const canvas = document.querySelector('#gb-budget-chart');
  const ctx = canvas.getContext('2d');
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Draw spent portion
  const spentAngle = (spent / gbTotalBudget) * 2 * Math.PI;
  
  ctx.beginPath();
  ctx.arc(50, 50, 45, 0, spentAngle);
  ctx.lineWidth = 10;
  ctx.strokeStyle = '#ff4d4d';
  ctx.stroke();
  
  // Draw remaining portion
  ctx.beginPath();
  ctx.arc(50, 50, 45, spentAngle, 2 * Math.PI);
  ctx.lineWidth = 10;
  ctx.strokeStyle = '#39ff14';
  ctx.stroke();
}

function gbUpdateSuggestions() {
  const spent = gbSpent;
  const remaining = gbTotalBudget - spent;
  const giftsLeft = gbPeopleCount - gbGifts.length;
  
  let suggestions = [];
  
  if (giftsLeft > 0 && remaining > 0) {
    const avgRemaining = remaining / giftsLeft;
    
    if (avgRemaining < 20) {
      suggestions.push(`Consider homemade gifts or small items under $20 for remaining ${giftsLeft} people.`);
    } else if (avgRemaining < 50) {
      suggestions.push(`You have about $${Math.floor(avgRemaining)} per person for remaining gifts.`);
    }
  }
  
  if (remaining < gbTotalBudget * 0.1 && remaining > 0) {
    suggestions.push(`âš ï¸ Budget running low! Only $${remaining.toFixed(2)} remaining.`);
  }
  
  if (gbGifts.length > 0 && gbGifts.filter(g => g.status === 'planned').length > gbGifts.length * 0.5) {
    suggestions.push(`Consider starting purchases soon - ${gbGifts.filter(g => g.status === 'planned').length} gifts still need buying.`);
  }
  
  const suggestionsEl = document.querySelector('#gb-suggestions');
  if (suggestions.length > 0) {
    suggestionsEl.innerHTML = suggestions.map(s => `<div style="margin-bottom:4px;">â€¢ ${s}</div>`).join('');
  } else {
    suggestionsEl.innerHTML = 'Your budget is well-balanced! ğŸ„';
  }
}

function gbLoadIdea(budgetRange) {
  const ideas = gbGiftIdeas[budgetRange];
  if (!ideas || ideas.length === 0) return;
  
  const randomIdea = ideas[Math.floor(Math.random() * ideas.length)];
  
  document.querySelector('#gb-gift-item').value = randomIdea.name;
  document.querySelector('#gb-gift-price').value = randomIdea.price;
  
  // Suggest categories
  const categories = ["Family", "Friends", "Colleagues", "Kids", "Partner", "Parents"];
  document.querySelector('#gb-gift-for').placeholder = `e.g., ${categories[Math.floor(Math.random() * categories.length)]}`;
  
  document.querySelector('#gb-status').textContent = `ğŸ’¡ Suggested: ${randomIdea.name} ($${randomIdea.price})`;
  document.querySelector('#gb-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 3000);
}

function gbOptimizeBudget() {
  if (gbGifts.length === 0) {
    alert('Add some gifts first to optimize your budget!');
    return;
  }
  
  let optimized = false;
  const suggestions = [];
  
  // Find gifts that could be cheaper
  gbGifts.forEach(gift => {
    if (gift.price > gbTotalBudget / gbPeopleCount) {
      const potentialSave = Math.floor(gift.price * 0.2); // Assume 20% savings
      suggestions.push(`"${gift.item}" for ${gift.for}: Could save ~$${potentialSave} with alternatives`);
      optimized = true;
    }
  });
  
  // Check for budget exceedance
  if (gbSpent > gbTotalBudget) {
    const overspend = gbSpent - gbTotalBudget;
    suggestions.push(`âš ï¸ Currently overspent by $${overspend.toFixed(2)}. Consider reducing some gift values.`);
    optimized = true;
  }
  
  if (optimized) {
    const message = suggestions.join('\nâ€¢ ');
    alert(`Budget Optimization Suggestions:\n\nâ€¢ ${message}\n\nTotal potential savings: ~$${Math.floor(gbSpent * 0.15)}`);
    
    document.querySelector('#gb-status').textContent = 'âœ… Budget optimized with suggestions';
    document.querySelector('#gb-status').style.color = '#39ff14';
  } else {
    document.querySelector('#gb-status').textContent = 'ğŸ„ Your budget is already well optimized!';
    document.querySelector('#gb-status').style.color = '#39ff14';
  }
  
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 3000);
}

function gbClearAll() {
  if (gbGifts.length === 0) return;
  if (!confirm('Clear all gifts and reset budget?')) return;
  
  gbGifts = [];
  gbSpent = 0;
  gbUpdateGiftList();
  gbUpdateStats();
  
  document.querySelector('#gb-status').textContent = 'âœ… All gifts cleared';
  document.querySelector('#gb-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 2000);
}

function gbExportPlan() {
  if (gbGifts.length === 0) {
    alert('Add some gifts first to export your plan!');
    return;
  }
  
  const exportData = {
    exportDate: new Date().toISOString(),
    totalBudget: gbTotalBudget,
    totalSpent: gbSpent,
    remainingBudget: gbTotalBudget - gbSpent,
    totalPeople: gbPeopleCount,
    gifts: gbGifts,
    summary: {
      purchased: gbGifts.filter(g => g.status === 'purchased' || g.status === 'wrapped' || g.status === 'delivered').length,
      planned: gbGifts.filter(g => g.status === 'planned').length,
      averageGiftPrice: gbSpent / gbGifts.length
    }
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const fileName = `christmas-gift-plan-${new Date().toISOString().split('T')[0]}.json`;
  
  const link = document.createElement('a');
  link.download = fileName;
  link.href = dataUri;
  link.click();
  
  document.querySelector('#gb-status').textContent = 'âœ… Plan exported successfully';
  document.querySelector('#gb-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 2000);
}

function gbFindDeals() {
  if (gbGifts.length === 0) {
    alert('Add some gifts first to find deals!');
    return;
  }
  
  // Simulate finding deals
  const potentialSavings = Math.floor(gbSpent * 0.15);
  const dealsFound = Math.floor(Math.random() * 3) + 1;
  
  const deals = [
    "ğŸ¯ Check online retailers for Christmas sales",
    "ğŸ’° Use cashback websites when shopping",
    "ğŸ Consider bundle deals for multiple gifts",
    "ğŸ›’ Compare prices across different stores",
    "ğŸ“± Use price tracking browser extensions"
  ];
  
  const randomDeals = [];
  for (let i = 0; i < dealsFound; i++) {
    randomDeals.push(deals[Math.floor(Math.random() * deals.length)]);
  }
  
  const message = `Found ${dealsFound} money-saving strategies!\n\nPotential savings: ~$${potentialSavings}\n\n${randomDeals.map(d => `â€¢ ${d}`).join('\n')}`;
  alert(message);
  
  document.querySelector('#gb-compare-savings').textContent = potentialSavings;
  
  document.querySelector('#gb-status').textContent = `ğŸ’ Found ${dealsFound} potential savings strategies`;
  document.querySelector('#gb-status').style.color = '#39ff14';
  setTimeout(() => {
    document.querySelector('#gb-status').textContent = '';
  }, 3000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    // Set default values
    gbUpdateBudget(1000);
    gbUpdateStats();
    
    // Add sample gifts for demo
    if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
      setTimeout(() => {
        const sampleGifts = [
          { for: 'Mom', item: 'Scented Candles Set', price: 35, status: 'planned', priority: 'high' },
          { for: 'Dad', item: 'Tool Kit', price: 79, status: 'purchased', priority: 'medium' },
          { for: 'Kids', item: 'Board Games Bundle', price: 45, status: 'planned', priority: 'essential' },
          { for: 'Partner', item: 'Smart Watch', price: 199, status: 'planned', priority: 'high' }
        ];
        
        sampleGifts.forEach(gift => {
          document.querySelector('#gb-gift-for').value = gift.for;
          document.querySelector('#gb-gift-item').value = gift.item;
          document.querySelector('#gb-gift-price').value = gift.price;
          document.querySelector('#gb-gift-status').value = gift.status;
          document.querySelector('#gb-gift-priority').value = gift.priority;
          gbAddGift();
        });
      }, 500);
    }
  });
}
</script>

<style>
/* Gift budget styles */
#gift-budget-title {
  background: linear-gradient(45deg, #ff4d4d, #39ff14);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-top: 0;
  margin-bottom: 4px;
}

/* Gift icon animation */
@keyframes giftBounce {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  25% { transform: translateY(-5px) rotate(-5deg); }
  75% { transform: translateY(-5px) rotate(5deg); }
}

.gift-animation {
  display: inline-block;
  animation: giftBounce 2s infinite;
}

/* Money animation */
@keyframes moneyFall {
  0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(100px) rotate(360deg); opacity: 0; }
}

.money-fall {
  position: absolute;
  color: #39ff14;
  font-size: 20px;
  pointer-events: none;
  animation: moneyFall linear forwards;
}

/* Responsive design */
@media (max-width: 768px) {
  .gift-grid {
    grid-template-columns: 1fr !important;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .budget-breakdown {
    flex-direction: column;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
}

/* Budget warning animation */
@keyframes budgetWarning {
  0%, 100% { 
    box-shadow: 0 0 0 0 rgba(255,77,77,0.4);
    border-color: rgba(255,77,77,0.3);
  }
  50% { 
    box-shadow: 0 0 0 4px rgba(255,77,77,0.1);
    border-color: rgba(255,77,77,0.6);
  }
}

.budget-warning {
  animation: budgetWarning 2s infinite;
}

/* Progress bar animation */
@keyframes progressFill {
  from { width: 0%; }
  to { width: var(--target-width); }
}

.progress-animated {
  animation: progressFill 1s ease-out forwards;
}

/* Category color coding */
.category-tech { border-left-color: #2dd4ff !important; }
.category-clothing { border-left-color: #ff4d4d !important; }
.category-home { border-left-color: #39ff14 !important; }
.category-food { border-left-color: #ffa500 !important; }
.category-entertainment { border-left-color: #9d4edd !important; }

/* Receipt scanning effect */
@keyframes receiptScan {
  0% { background-position: 0% 0%; }
  100% { background-position: 0% 100%; }
}

.receipt-scanning {
  background: linear-gradient(to bottom, 
    rgba(57,255,20,0.1) 0%, 
    rgba(57,255,20,0.3) 50%, 
    rgba(57,255,20,0.1) 100%);
  background-size: 100% 200%;
  animation: receiptScan 2s linear infinite;
}
</style>
