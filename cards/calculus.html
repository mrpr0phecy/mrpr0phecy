<h2 id="calculus-title" style="margin-top:0;">Calculus Helper</h2>

<form aria-describedby="calculus-desc">
  <p id="calculus-desc" class="small">Work with derivatives and integrals. Enter a function of x, choose operation, and generate step‑by‑step results.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field" style="grid-column:1 / -1;">
      <label for="calc-function">Function</label>
      <input id="calc-function" type="text" placeholder="e.g. x^2 + 3x + 5" style="width:100%;" />
    </div>

    <div class="field">
      <label for="calc-operation">Operation</label>
      <select id="calc-operation" style="width:100%;">
        <option value="derivative" selected>Derivative</option>
        <option value="integral">Indefinite Integral</option>
        <option value="definite">Definite Integral</option>
      </select>
    </div>

    <div class="field">
      <label for="calc-bounds">Bounds (for definite integral)</label>
      <input id="calc-bounds" type="text" placeholder="e.g. 0,2" style="width:100%;" />
    </div>

    <div class="field">
      <label for="calc-show-steps">Show steps</label>
      <select id="calc-show-steps" style="width:100%;">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="calcSolve(this)">Compute</button>
    <button type="button" class="secondary" onclick="calcReset(this)">Reset</button>
    <button type="button" onclick="calcCopy(this)">Copy Result</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Result</h3>
  <textarea id="calc-output" rows="10" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>

  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div class="small">Steps shown: <span id="calc-steps">–</span></div>
    <div id="calc-hint" class="small" style="opacity:0.9;"></div>
  </div>
</div>

<script>
/* calculus.html
   - Simple calculus helper for derivatives and integrals
   - Scoped with calc- prefix
   - Demo only: uses basic parsing and mock rules
*/

function calcReset(btn){
  const card=btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#calc-output').value="";
  card.querySelector('#calc-steps').textContent="–";
  card.querySelector('#calc-hint').textContent="";
}

function calcCopy(btn){
  const card=btn.closest('.card');
  const out=card.querySelector('#calc-output').value;
  if(!out.trim())return;
  navigator.clipboard?.writeText(out).then(()=>{
    const hint=card.querySelector('#calc-hint');
    hint.textContent="Copied to clipboard.";
    setTimeout(()=>{if(hint.textContent==="Copied to clipboard.")hint.textContent="";},1600);
  }).catch(()=>alert("Copy failed."));
}

function calcSolve(btn){
  const card=btn.closest('.card');
  const fn=(card.querySelector('#calc-function').value||"").trim();
  const op=card.querySelector('#calc-operation').value;
  const bounds=(card.querySelector('#calc-bounds').value||"").trim();
  const showSteps=card.querySelector('#calc-show-steps').value==="yes";
  if(!fn){card.querySelector('#calc-hint').textContent="Please enter a function.";return;}
  let result="";let steps="";
  try{
    if(op==="derivative"){
      result=`Derivative of ${fn} is (demo) 2x + 3`;
      if(showSteps){steps=`Step 1: Identify terms\nStep 2: Apply power rule\nStep 3: Simplify → 2x+3`;}
    } else if(op==="integral"){
      result=`Indefinite integral of ${fn} is (demo) (x^3/3) + (3x^2/2) + 5x + C`;
      if(showSteps){steps=`Step 1: Apply reverse power rule\nStep 2: Add constant of integration\nStep 3: Simplify`;}
    } else if(op==="definite"){
      const [a,b]=bounds.split(',').map(s=>parseFloat(s));
      result=`Definite integral of ${fn} from ${a} to ${b} is (demo) ≈ value`;
      if(showSteps){steps=`Step 1: Find indefinite integral\nStep 2: Evaluate at bounds ${a}, ${b}\nStep 3: Subtract lower from upper`;}
    }
  }catch(e){result="Error computing.";}
  card.querySelector('#calc-output').value=result+(showSteps&&steps?`\n\n${steps}`:"");
  card.querySelector('#calc-steps').textContent=showSteps?"Yes":"No";
  card.querySelector('#calc-hint').textContent="Result generated.";
}
</script>
