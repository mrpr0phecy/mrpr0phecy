<h2 id="compoundinterest-title" style="margin-top:0;color:var(--accent);">ğŸ’° Compound Interest Calculator</h2>

<form aria-describedby="compoundinterest-desc" style="margin-bottom:20px;">
  <p id="compoundinterest-desc" class="small" style="color:rgba(230,250,255,0.8);margin-bottom:16px;">
    Calculate future value, growth projections, and compare investment scenarios. 
    Visualize wealth accumulation over time with detailed breakdowns.
    <span style="color:var(--accent);display:block;margin-top:4px;">
      âœ… Features: Regular contributions, inflation adjustment, tax considerations, goal tracking
    </span>
  </p>

  <!-- Investment Basics -->
  <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid rgba(45,212,255,0.1);">
    <h3 style="color:var(--accent);margin:0 0 12px 0;font-size:16px;">ğŸ“Š Investment Parameters</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="ci-principal" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ¦ Initial Investment (Â£)
        </label>
        <div style="position:relative;">
          <input id="ci-principal" type="range" min="100" max="1000000" step="100" value="10000"
                 oninput="ciUpdateSlider('principal', this.value)"
                 style="width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(45,212,255,0.6) 0%, rgba(45,212,255,0.3) 100%);outline:none;">
          <div style="display:flex;justify-content:space-between;margin-top:4px;">
            <span style="font-size:11px;color:rgba(230,250,255,0.6);">Â£100</span>
            <span id="ci-principal-display" style="font-weight:600;color:var(--accent);">Â£10,000</span>
            <span style="font-size:11px;color:rgba(230,250,255,0.6);">Â£1M</span>
          </div>
        </div>
      </div>
      
      <div class="field">
        <label for="ci-monthly-contribution" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ“… Monthly Contribution (Â£)
        </label>
        <div style="position:relative;">
          <input id="ci-monthly-contribution" type="range" min="0" max="5000" step="50" value="100"
                 oninput="ciUpdateSlider('monthly', this.value)"
                 style="width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(57,255,20,0.6) 0%, rgba(57,255,20,0.3) 100%);outline:none;">
          <div style="display:flex;justify-content:space-between;margin-top:4px;">
            <span style="font-size:11px;color:rgba(230,250,255,0.6);">Â£0</span>
            <span id="ci-monthly-display" style="font-weight:600;color:#39ff14;">Â£100</span>
            <span style="font-size:11px;color:rgba(230,250,255,0.6);">Â£5,000</span>
          </div>
        </div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <div class="field">
        <label for="ci-annual-rate" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ“ˆ Annual Return Rate (%)
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="ci-annual-rate" type="range" min="0" max="20" step="0.1" value="7"
                 oninput="ciUpdateSlider('rate', this.value)"
                 style="flex:1;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(255,165,0,0.6) 0%, rgba(255,165,0,0.3) 100%);outline:none;">
          <span id="ci-rate-display" style="font-weight:600;color:#ffa500;min-width:40px;text-align:right;">7%</span>
        </div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;">
          Conservative: 4-6% | Moderate: 7-9% | Aggressive: 10%+
        </div>
      </div>

      <div class="field">
        <label for="ci-years" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          â³ Investment Period (years)
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="ci-years" type="range" min="1" max="50" step="1" value="20"
                 oninput="ciUpdateSlider('years', this.value)"
                 style="flex:1;height:8px;border-radius:4px;background:linear-gradient(90deg, rgba(255,77,77,0.6) 0%, rgba(255,77,77,0.3) 100%);outline:none;">
          <span id="ci-years-display" style="font-weight:600;color:#ff4d4d;min-width:40px;text-align:right;">20</span>
        </div>
      </div>

      <div class="field">
        <label for="ci-frequency" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          ğŸ”„ Compounding Frequency
        </label>
        <select id="ci-frequency" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          <option value="1">Annually</option>
          <option value="2">Semi-annually</option>
          <option value="4">Quarterly</option>
          <option value="12" selected>Monthly</option>
          <option value="52">Weekly</option>
          <option value="365">Daily</option>
          <option value="continuous">Continuous</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Advanced Settings -->
  <div style="margin-bottom:16px;">
    <details style="border:1px solid rgba(255,255,255,0.1);border-radius:8px;overflow:hidden;">
      <summary style="padding:12px 16px;background:rgba(255,255,255,0.05);cursor:pointer;color:var(--accent);font-weight:500;list-style:none;">
        âš™ï¸ Advanced Settings
      </summary>
      <div style="padding:16px;background:rgba(0,0,0,0.2);">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
          <div class="field">
            <label for="ci-inflation" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ’¸ Annual Inflation Rate (%)
            </label>
            <input id="ci-inflation" type="number" min="0" max="10" step="0.1" value="2.5"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.3);background:rgba(255,165,0,0.05);color:inherit;">
          </div>
          <div class="field">
            <label for="ci-tax-rate" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ›ï¸ Annual Tax Rate (%)
            </label>
            <input id="ci-tax-rate" type="number" min="0" max="50" step="0.1" value="20"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,77,77,0.3);background:rgba(255,77,77,0.05);color:inherit;">
          </div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div class="field">
            <label for="ci-goal" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ¯ Financial Goal (Â£)
            </label>
            <input id="ci-goal" type="number" min="0" step="1000" value="100000"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:inherit;">
          </div>
          <div class="field">
            <label for="ci-contribution-increase" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
              ğŸ“ˆ Annual Contribution Increase (%)
            </label>
            <input id="ci-contribution-increase" type="number" min="0" max="20" step="0.1" value="3"
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;">
          </div>
        </div>
      </div>
    </details>
  </div>

  <!-- Quick Scenarios -->
  <div style="margin-bottom:20px;">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;font-size:14px;">ğŸš€ Quick Scenarios</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="ciLoadScenario('retirement')" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">ğŸ–ï¸ Retirement Planning</button>
      <button type="button" onclick="ciLoadScenario('education')" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">ğŸ“ Education Fund</button>
      <button type="button" onclick="ciLoadScenario('house')" style="padding:8px 12px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">ğŸ  House Deposit</button>
      <button type="button" onclick="ciLoadScenario('emergency')" style="padding:8px 12px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);border-radius:6px;color:#ff4d4d;cursor:pointer;font-size:12px;">ğŸš¨ Emergency Fund</button>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions" style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="ciCalculate()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ğŸ§® Calculate Growth
    </button>
    <button type="button" onclick="ciReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      ğŸ”„ Reset
    </button>
    <button type="button" onclick="ciExport()"
            style="padding:12px 16px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;">
      ğŸ“Š Export Data
    </button>
  </div>
</form>

<!-- Results Section -->
<div class="results" aria-live="polite" style="margin-top:24px;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 class="small" style="color:var(--accent);margin:0;">ğŸ“ˆ Investment Growth Projection</h3>
    <div id="ci-status" style="font-size:12px;color:rgba(230,250,255,0.7);"></div>
  </div>

  <!-- Quick Stats -->
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px;">
    <div style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:var(--accent);" id="ci-stat-future">Â£</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Future Value</div>
    </div>
    <div style="background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#39ff14;" id="ci-stat-interest">Â£</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Total Interest</div>
    </div>
    <div style="background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#ffa500;" id="ci-stat-contributions">Â£</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Total Contributions</div>
    </div>
    <div style="background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.2);border-radius:6px;padding:8px;text-align:center;">
      <div style="font-size:18px;font-weight:600;color:#ff4d4d;" id="ci-stat-real">Â£</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Inflation-Adjusted</div>
    </div>
  </div>

  <!-- Goal Progress -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="color:var(--accent);font-weight:500;font-size:14px;">ğŸ¯ Goal Progress</div>
      <div id="ci-goal-percent" style="font-size:12px;color:#39ff14;"></div>
    </div>
    <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
      <div id="ci-goal-progress" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:0%;transition:width 0.5s;"></div>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:4px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">Current</div>
      <div id="ci-goal-target" style="font-size:11px;color:var(--accent);">Goal: Â£100,000</div>
    </div>
  </div>

  <!-- Year-by-Year Breakdown -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:16px;margin-bottom:16px;">
    <h4 style="color:var(--accent);margin:0 0 12px 0;font-size:14px;">ğŸ“… Year-by-Year Growth</h4>
    <div style="max-height:200px;overflow-y:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:12px;">
        <thead>
          <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
            <th style="padding:8px;text-align:left;color:var(--accent);">Year</th>
            <th style="padding:8px;text-align:right;color:#39ff14;">Balance</th>
            <th style="padding:8px;text-align:right;color:#ffa500;">Contributions</th>
            <th style="padding:8px;text-align:right;color:var(--accent);">Interest</th>
            <th style="padding:8px;text-align:right;color:rgba(230,250,255,0.7);">Real Value</th>
          </tr>
        </thead>
        <tbody id="ci-yearly-table">
          <tr><td colspan="5" style="padding:16px;text-align:center;color:rgba(230,250,255,0.5);">Calculate to see yearly breakdown</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Visual Chart -->
  <div style="background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:12px;">
    <h4 style="color:var(--accent);margin:0 0 8px 0;font-size:14px;">ğŸ“Š Growth Visualization</h4>
    <div id="ci-chart" style="height:200px;display:flex;align-items:flex-end;gap:2px;padding:12px 0;">
      <div style="text-align:center;color:rgba(230,250,255,0.5);flex:1;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;">
        <div>Calculate to see chart</div>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:8px;">
      <div style="font-size:11px;color:var(--accent);">Year 0</div>
      <div style="font-size:11px;color:var(--accent);" id="ci-chart-end">Year 20</div>
    </div>
  </div>
</div>

<!-- Comparison Section -->
<div style="margin-top:24px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1);padding:16px;">
  <h3 class="small" style="color:var(--accent);margin:0 0 12px 0;">ğŸ”„ Compare Scenarios</h3>
  
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
    <div style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.2);border-radius:6px;padding:12px;text-align:center;">
      <div style="font-size:12px;color:var(--accent);margin-bottom:4px;">Conservative (4%)</div>
      <div style="font-size:16px;font-weight:600;color:var(--accent);" id="ci-compare-conservative">Â£</div>
    </div>
    <div style="background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.2);border-radius:6px;padding:12px;text-align:center;">
      <div style="font-size:12px;color:#ffa500;margin-bottom:4px;">Your Scenario</div>
      <div style="font-size:16px;font-weight:600;color:#ffa500;" id="ci-compare-current">Â£</div>
    </div>
    <div style="background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.2);border-radius:6px;padding:12px;text-align:center;">
      <div style="font-size:12px;color:#39ff14;margin-bottom:4px;">Aggressive (10%)</div>
      <div style="font-size:16px;font-weight:600;color:#39ff14;" id="ci-compare-aggressive">Â£</div>
    </div>
  </div>
</div>

<script>
/* compound-interest.html
   - Advanced compound interest calculator with visualization
   - Scoped with "ci" prefix (compound interest)
*/

// Investment calculation functions
function ciCalculateFutureValue(principal, annualRate, years, frequency, monthlyContribution = 0, contributionIncrease = 0) {
  let total = principal;
  let yearlyData = [];
  
  const periodicRate = annualRate / 100 / frequency;
  const periods = years * frequency;
  
  // For regular contributions with compounding
  for (let year = 1; year <= years; year++) {
    let yearStart = total;
    let contributions = 0;
    
    // Calculate contributions for this year (with annual increase)
    const annualContribution = monthlyContribution * 12 * Math.pow(1 + contributionIncrease / 100, year - 1);
    
    // Add contributions monthly with compounding
    for (let month = 1; month <= 12; month++) {
      if (frequency === 12) { // Monthly compounding
        total *= (1 + periodicRate);
      }
      
      // Add monthly contribution
      const monthlyAmount = annualContribution / 12;
      total += monthlyAmount;
      contributions += monthlyAmount;
      
      // For other compounding frequencies, adjust accordingly
      if (frequency !== 12) {
        // Simplified: contributions added at end of compounding period
      }
    }
    
    // Apply compounding for other frequencies
    if (frequency !== 12) {
      total = yearStart * Math.pow(1 + periodicRate, frequency) + annualContribution;
    }
    
    const interest = total - yearStart - contributions;
    
    yearlyData.push({
      year,
      balance: total,
      contributions: contributions,
      interest: interest,
      yearStart: yearStart
    });
  }
  
  // For continuous compounding
  if (frequency === 'continuous') {
    const e = Math.E;
    total = principal * Math.pow(e, annualRate / 100 * years);
    // Add contributions approximation for continuous
    if (monthlyContribution > 0) {
      total += monthlyContribution * 12 * years; // Simplified
    }
  }
  
  return { total, yearlyData };
}

function ciCalculateInflationAdjusted(value, inflationRate, years) {
  return value / Math.pow(1 + inflationRate / 100, years);
}

function ciCalculateAfterTax(value, taxRate) {
  return value * (1 - taxRate / 100);
}

// UI Update Functions
function ciUpdateSlider(type, value) {
  const display = document.querySelector(`#ci-${type}-display`);
  if (!display) return;
  
  switch(type) {
    case 'principal':
      display.textContent = `Â£${parseInt(value).toLocaleString()}`;
      break;
    case 'monthly':
      display.textContent = `Â£${parseInt(value).toLocaleString()}`;
      break;
    case 'rate':
      display.textContent = `${parseFloat(value).toFixed(1)}%`;
      break;
    case 'years':
      display.textContent = `${parseInt(value)}`;
      break;
  }
  
  // Auto-calculate on slider change
  setTimeout(ciCalculate, 100);
}

function ciCalculate() {
  try {
    // Get inputs
    const principal = parseFloat(document.querySelector('#ci-principal').value) || 10000;
    const monthlyContribution = parseFloat(document.querySelector('#ci-monthly-contribution').value) || 100;
    const annualRate = parseFloat(document.querySelector('#ci-annual-rate').value) || 7;
    const years = parseInt(document.querySelector('#ci-years').value) || 20;
    const frequency = document.querySelector('#ci-frequency').value;
    const inflationRate = parseFloat(document.querySelector('#ci-inflation').value) || 2.5;
    const taxRate = parseFloat(document.querySelector('#ci-tax-rate').value) || 20;
    const goal = parseFloat(document.querySelector('#ci-goal').value) || 100000;
    const contributionIncrease = parseFloat(document.querySelector('#ci-contribution-increase').value) || 3;
    
    // Convert frequency to number for calculations (except 'continuous')
    const freqNum = frequency === 'continuous' ? 12 : parseInt(frequency);
    
    // Calculate future value
    const result = ciCalculateFutureValue(
      principal, 
      annualRate, 
      years, 
      freqNum,
      monthlyContribution,
      contributionIncrease
    );
    
    const futureValue = result.total;
    const yearlyData = result.yearlyData;
    
    // Calculate totals
    const totalContributions = principal + (monthlyContribution * 12 * years);
    const totalInterest = futureValue - totalContributions;
    const realValue = ciCalculateInflationAdjusted(futureValue, inflationRate, years);
    const afterTax = ciCalculateAfterTax(futureValue, taxRate);
    
    // Update quick stats
    document.querySelector('#ci-stat-future').textContent = `Â£${futureValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    document.querySelector('#ci-stat-interest').textContent = `Â£${totalInterest.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    document.querySelector('#ci-stat-contributions').textContent = `Â£${totalContributions.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    document.querySelector('#ci-stat-real').textContent = `Â£${realValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    
    // Update goal progress
    const goalPercent = Math.min(100, (futureValue / goal) * 100);
    document.querySelector('#ci-goal-percent').textContent = `${goalPercent.toFixed(1)}%`;
    document.querySelector('#ci-goal-progress').style.width = `${goalPercent}%`;
    document.querySelector('#ci-goal-target').textContent = `Goal: Â£${goal.toLocaleString()}`;
    
    // Update yearly table
    const tableBody = document.querySelector('#ci-yearly-table');
    tableBody.innerHTML = '';
    
    yearlyData.forEach(data => {
      const realYearValue = ciCalculateInflationAdjusted(data.balance, inflationRate, data.year);
      
      const row = document.createElement('tr');
      row.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
      row.innerHTML = `
        <td style="padding:8px;color:var(--accent);font-weight:500;">Year ${data.year}</td>
        <td style="padding:8px;text-align:right;color:#39ff14;">Â£${data.balance.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
        <td style="padding:8px;text-align:right;color:#ffa500;">Â£${data.contributions.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
        <td style="padding:8px;text-align:right;color:var(--accent);">Â£${data.interest.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
        <td style="padding:8px;text-align:right;color:rgba(230,250,255,0.7);">Â£${realYearValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
      `;
      tableBody.appendChild(row);
    });
    
    // Update chart
    ciUpdateChart(yearlyData);
    
    // Update comparison scenarios
    const conservativeResult = ciCalculateFutureValue(principal, 4, years, freqNum, monthlyContribution, contributionIncrease);
    const aggressiveResult = ciCalculateFutureValue(principal, 10, years, freqNum, monthlyContribution, contributionIncrease);
    
    document.querySelector('#ci-compare-conservative').textContent = `Â£${conservativeResult.total.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
    document.querySelector('#ci-compare-current').textContent = `Â£${futureValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
    document.querySelector('#ci-compare-aggressive').textContent = `Â£${aggressiveResult.total.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
    
    // Update status
    const status = document.querySelector('#ci-status');
    status.textContent = 'âœ… Calculation complete';
    status.style.color = '#39ff14';
    
    // Update chart end label
    document.querySelector('#ci-chart-end').textContent = `Year ${years}`;
    
  } catch (error) {
    console.error('Calculation error:', error);
    document.querySelector('#ci-status').textContent = 'âŒ Error in calculation';
    document.querySelector('#ci-status').style.color = '#ff4d4d';
  }
}

function ciUpdateChart(yearlyData) {
  const chart = document.querySelector('#ci-chart');
  if (!chart || !yearlyData.length) return;
  
  // Find max value for scaling
  const maxValue = Math.max(...yearlyData.map(d => d.balance));
  const maxHeight = 180; // pixels
  
  chart.innerHTML = '';
  
  yearlyData.forEach((data, index) => {
    if (index % Math.max(1, Math.floor(yearlyData.length / 10)) === 0 || index === yearlyData.length - 1) {
      const height = (data.balance / maxValue) * maxHeight;
      const color = `hsl(${200 + (index / yearlyData.length) * 100}, 70%, 60%)`;
      
      const bar = document.createElement('div');
      bar.style.cssText = `
        flex: 1;
        background: linear-gradient(to top, ${color}, var(--accent));
        height: ${height}px;
        border-radius: 4px 4px 0 0;
        position: relative;
        min-width: 4px;
      `;
      
      // Add value label on hover
      bar.title = `Year ${data.year}: Â£${data.balance.toLocaleString()}`;
      
      // Add year label for some bars
      if (index === 0 || index === yearlyData.length - 1 || index % 5 === 0) {
        const label = document.createElement('div');
        label.style.cssText = `
          position: absolute;
          bottom: -20px;
          left: 50%;
          transform: translateX(-50%) rotate(-45deg);
          font-size: 10px;
          color: rgba(230,250,255,0.7);
          white-space: nowrap;
        `;
        label.textContent = data.year;
        bar.appendChild(label);
      }
      
      chart.appendChild(bar);
    }
  });
}

function ciLoadScenario(type) {
  const scenarios = {
    retirement: {
      principal: 50000,
      monthly: 500,
      rate: 7,
      years: 30,
      frequency: '12',
      goal: 1000000,
      inflation: 2.5,
      tax: 20
    },
    education: {
      principal: 5000,
      monthly: 200,
      rate: 5,
      years: 18,
      frequency: '12',
      goal: 100000,
      inflation: 3,
      tax: 0
    },
    house: {
      principal: 10000,
      monthly: 300,
      rate: 4,
      years: 5,
      frequency: '12',
      goal: 50000,
      inflation: 2,
      tax: 0
    },
    emergency: {
      principal: 1000,
      monthly: 100,
      rate: 2,
      years: 3,
      frequency: '12',
      goal: 5000,
      inflation: 2,
      tax: 0
    }
  };
  
  const scenario = scenarios[type];
  if (!scenario) return;
  
  // Update inputs
  document.querySelector('#ci-principal').value = scenario.principal;
  document.querySelector('#ci-monthly-contribution').value = scenario.monthly;
  document.querySelector('#ci-annual-rate').value = scenario.rate;
  document.querySelector('#ci-years').value = scenario.years;
  document.querySelector('#ci-frequency').value = scenario.frequency;
  document.querySelector('#ci-goal').value = scenario.goal;
  document.querySelector('#ci-inflation').value = scenario.inflation;
  document.querySelector('#ci-tax-rate').value = scenario.tax;
  
  // Update displays
  ciUpdateSlider('principal', scenario.principal);
  ciUpdateSlider('monthly', scenario.monthly);
  ciUpdateSlider('rate', scenario.rate);
  ciUpdateSlider('years', scenario.years);
  
  // Calculate
  setTimeout(ciCalculate, 100);
}

function ciReset() {
  if (!confirm('Reset all values to defaults?')) return;
  
  // Reset sliders
  document.querySelector('#ci-principal').value = 10000;
  document.querySelector('#ci-monthly-contribution').value = 100;
  document.querySelector('#ci-annual-rate').value = 7;
  document.querySelector('#ci-years').value = 20;
  
  // Reset displays
  ciUpdateSlider('principal', 10000);
  ciUpdateSlider('monthly', 100);
  ciUpdateSlider('rate', 7);
  ciUpdateSlider('years', 20);
  
  // Reset other inputs
  document.querySelector('#ci-frequency').value = '12';
  document.querySelector('#ci-inflation').value = 2.5;
  document.querySelector('#ci-tax-rate').value = 20;
  document.querySelector('#ci-goal').value = 100000;
  document.querySelector('#ci-contribution-increase').value = 3;
  
  // Reset results
  document.querySelector('#ci-status').textContent = '';
  document.querySelector('#ci-yearly-table').innerHTML = `
    <tr><td colspan="5" style="padding:16px;text-align:center;color:rgba(230,250,255,0.5);">Calculate to see yearly breakdown</td></tr>
  `;
  
  document.querySelector('#ci-chart').innerHTML = `
    <div style="text-align:center;color:rgba(230,250,255,0.5);flex:1;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;">
      <div>Calculate to see chart</div>
    </div>
  `;
}

function ciExport() {
  const yearlyData = [];
  // Get current data if available
  // This would need to store the data from the last calculation
  
  const exportData = {
    timestamp: new Date().toISOString(),
    parameters: {
      principal: document.querySelector('#ci-principal').value,
      monthlyContribution: document.querySelector('#ci-monthly-contribution').value,
      annualRate: document.querySelector('#ci-annual-rate').value,
      years: document.querySelector('#ci-years').value,
      frequency: document.querySelector('#ci-frequency').value,
      inflation: document.querySelector('#ci-inflation').value,
      taxRate: document.querySelector('#ci-tax-rate').value,
      goal: document.querySelector('#ci-goal').value
    },
    results: {
      futureValue: document.querySelector('#ci-stat-future').textContent,
      totalInterest: document.querySelector('#ci-stat-interest').textContent,
      totalContributions: document.querySelector('#ci-stat-contributions').textContent,
      realValue: document.querySelector('#ci-stat-real').textContent
    }
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `investment-projection-${new Date().toISOString().split('T')[0]}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  // Visual feedback
  const status = document.querySelector('#ci-status');
  status.textContent = 'âœ… Data exported';
  status.style.color = '#39ff14';
  setTimeout(() => {
    status.textContent = '';
  }, 2000);
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    // Set initial display values
    ciUpdateSlider('principal', 10000);
    ciUpdateSlider('monthly', 100);
    ciUpdateSlider('rate', 7);
    ciUpdateSlider('years', 20);
    
    // Calculate on load
    setTimeout(ciCalculate, 500);
    
    // Add input listeners for auto-calculation
    ['#ci-inflation', '#ci-tax-rate', '#ci-goal', '#ci-contribution-increase', '#ci-frequency'].forEach(selector => {
      const input = document.querySelector(selector);
      if (input) {
        input.addEventListener('change', ciCalculate);
      }
    });
  });
}
</script>

<style>
/* Card-specific styles */
#compoundinterest-title {
  color: var(--accent);
  margin-top: 0;
  margin-bottom: 4px;
}

/* Range slider styling */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 8px;
  border-radius: 4px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 10px rgba(45,212,255,0.5);
}

input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 10px rgba(45,212,255,0.5);
}

/* Table styling */
table {
  border-collapse: separate;
  border-spacing: 0;
}

th, td {
  padding: 8px;
}

tbody tr:hover {
  background: rgba(45,212,255,0.05);
}

/* Chart bar animation */
@keyframes growBar {
  from { height: 0; opacity: 0; }
  to { height: var(--target-height); opacity: 1; }
}

.chart-bar {
  animation: growBar 0.5s ease-out forwards;
}

/* Responsive design */
@media (max-width: 768px) {
  #compoundinterest-title {
    font-size: 1.2rem;
  }
  
  .input-grid {
    grid-template-columns: 1fr !important;
  }
  
  .quick-stats {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .comparison-grid {
    grid-template-columns: 1fr !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
}

/* Custom scrollbar for table */
#ci-yearly-table::-webkit-scrollbar {
  width: 6px;
}

#ci-yearly-table::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
}

#ci-yearly-table::-webkit-scrollbar-thumb {
  background: rgba(45,212,255,0.3);
  border-radius: 3px;
}

/* Details/summary styling */
details summary::-webkit-details-marker {
  display: none;
}

details summary {
  list-style: none;
}

details[open] summary {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 16px;
}
</style>
