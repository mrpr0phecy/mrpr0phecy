<h2 id="networth-tracker-title" style="margin-top:0;">ğŸ’° Personal Finance Dashboard</h2>

<!-- Manifest metadata -->
<!--
  id: networth-tracker
  title: Personal Finance Dashboard
  path: cards/networth-tracker.html
  category: Finance & Money
  version: 2.0
  viral_tags: [finance, money, wealth, investing, budget, financial_freedom]
  accessibility: [keyboard_nav, screen_reader, high_contrast, financial_privacy]
  languages: [en, es, fr, de, zh, ja, pt, ru]
  features: [networth, assets, liabilities, goals, projections, history, export]
  currencies: [USD, EUR, GBP, JPY, CAD, AUD, CHF, CNY, INR, BRL]
-->

<div style="margin-bottom:20px;">
  <div id="networth-desc" style="margin-bottom:16px;">
    <p style="margin:0 0 12px 0;color:var(--muted);font-size:14px;line-height:1.5;">
      <span style="color:var(--accent);font-weight:600;">Complete personal finance dashboard</span>: Track net worth, analyze assets vs liabilities, set financial goals, project future growth, and monitor your journey to financial freedom.
    </p>
    
    <!-- Quick Stats Banner -->
    <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px;">
      <div style="flex:1;min-width:200px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="color:var(--muted);font-size:13px;">Current Net Worth</span>
          <span id="nw-current-nw" style="color:var(--accent);font-weight:600;font-size:18px;">Â£60,000.00</span>
        </div>
        <div style="height:8px;background:var(--glass);border-radius:4px;overflow:hidden;">
          <div id="nw-progress-bar" style="height:100%;background:linear-gradient(90deg, #39ff14, var(--accent));width:60%;transition:width 0.5s;"></div>
        </div>
      </div>
      
      <div style="display:flex;gap:12px;">
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Assets</div>
          <div id="nw-stats-assets" style="color:#39ff14;font-size:18px;font-weight:600;">Â£100,000</div>
        </div>
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Liabilities</div>
          <div id="nw-stats-liabilities" style="color:#ff2d55;font-size:18px;font-weight:600;">Â£40,000</div>
        </div>
        <div style="text-align:center;">
          <div style="color:var(--muted);font-size:11px;">Goal</div>
          <div id="nw-stats-goal" style="color:#ffcc00;font-size:18px;font-weight:600;">Â£100,000</div>
        </div>
      </div>
    </div>
    
    <!-- Currency & Privacy Controls -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="display:flex;gap:8px;align-items:center;">
        <span style="color:var(--muted);font-size:12px;">ğŸŒ Currency:</span>
        <select id="nw-currency" style="padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);font-size:12px;">
          <option value="GBP">Â£ GBP</option>
          <option value="USD">$ USD</option>
          <option value="EUR">â‚¬ EUR</option>
          <option value="JPY">Â¥ JPY</option>
          <option value="CAD">$ CAD</option>
          <option value="AUD">$ AUD</option>
          <option value="CHF">â‚£ CHF</option>
          <option value="CNY">Â¥ CNY</option>
          <option value="INR">â‚¹ INR</option>
          <option value="BRL">R$ BRL</option>
        </select>
      </div>
      
      <div style="display:flex;gap:8px;">
        <button onclick="nwTogglePrivacy()" style="padding:6px 12px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;">
          <span id="nw-privacy-icon">ğŸ‘ï¸</span> <span id="nw-privacy-text">Hide Values</span>
        </button>
        <button onclick="nwShareDashboard()" style="padding:6px 12px;background:linear-gradient(135deg, #1da1f2, #0d8bd9);color:white;border:none;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;">
          ğŸ“¤ Share
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Main Dashboard Grid -->
<div style="display:grid;grid-template-columns:1fr 300px;gap:20px;margin-bottom:20px;">
  
  <!-- Left Column: Asset/Liability Input -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:20px;background:var(--panel);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="color:var(--accent);font-size:16px;margin:0;">ğŸ“Š Enter Your Finances</h3>
      <div style="display:flex;gap:8px;">
        <button onclick="nwAddSampleData()" style="padding:6px 12px;font-size:12px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">
          Load Sample
        </button>
        <button onclick="nwClearAll()" style="padding:6px 12px;font-size:12px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">
          Clear All
        </button>
      </div>
    </div>
    
    <!-- Assets Section -->
    <div style="margin-bottom:24px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h4 style="color:#39ff14;font-size:14px;margin:0;display:flex;align-items:center;gap:6px;">
          ğŸ“ˆ Assets (What You Own)
        </h4>
        <button onclick="nwAddAsset()" style="padding:6px 10px;font-size:11px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;">
          + Add Asset
        </button>
      </div>
      
      <div id="nw-assets-list" style="margin-bottom:16px;">
        <!-- Asset entries will be added here -->
        <div class="nw-entry" data-type="asset">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Savings Account" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                   value="Savings Account" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="100" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                     value="25000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div class="nw-entry" data-type="asset">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Investment Portfolio" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                   value="Investment Portfolio" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="100" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                     value="50000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div class="nw-entry" data-type="asset">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Property Value" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                   value="Property Value" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="1000" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" 
                     value="250000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
      
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid var(--border);">
        <span style="color:var(--muted);font-size:13px;">Total Assets</span>
        <span id="nw-total-assets" style="color:#39ff14;font-weight:600;font-size:16px;">Â£325,000.00</span>
      </div>
    </div>
    
    <!-- Liabilities Section -->
    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <h4 style="color:#ff2d55;font-size:14px;margin:0;display:flex;align-items:center;gap:6px;">
          ğŸ“‰ Liabilities (What You Owe)
        </h4>
        <button onclick="nwAddLiability()" style="padding:6px 10px;font-size:11px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:4px;color:#ff2d55;cursor:pointer;">
          + Add Liability
        </button>
      </div>
      
      <div id="nw-liabilities-list" style="margin-bottom:16px;">
        <!-- Liability entries will be added here -->
        <div class="nw-entry" data-type="liability">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Mortgage" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                   value="Mortgage" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="100" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                     value="200000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div class="nw-entry" data-type="liability">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Student Loans" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                   value="Student Loans" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="100" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                     value="25000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div class="nw-entry" data-type="liability">
          <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
            <input type="text" placeholder="e.g., Credit Card Debt" 
                   style="padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                   value="Credit Card Debt" />
            <div style="display:flex;align-items:center;">
              <span class="nw-currency-symbol">Â£</span>
              <input type="number" min="0" step="100" placeholder="0.00" 
                     style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" 
                     value="5000" />
            </div>
            <button onclick="nwRemoveEntry(this)" class="nw-remove-btn" style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
      
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid var(--border);">
        <span style="color:var(--muted);font-size:13px;">Total Liabilities</span>
        <span id="nw-total-liabilities" style="color:#ff2d55;font-weight:600;font-size:16px;">Â£230,000.00</span>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div style="display:flex;gap:10px;margin-top:24px;">
      <button onclick="nwCalculate()" style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid var(--accent);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;font-size:15px;">
        ğŸ”„ Update Dashboard
      </button>
      <button onclick="nwSaveSnapshot()" style="padding:14px 20px;background:var(--glass);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;">
        ğŸ’¾ Save Snapshot
      </button>
    </div>
  </div>
  
  <!-- Right Column: Results & Insights -->
  <div style="display:flex;flex-direction:column;gap:20px;">
    
    <!-- Net Worth Display -->
    <div style="border:2px solid var(--border);border-radius:12px;padding:20px;background:var(--panel);text-align:center;">
      <div style="color:var(--muted);font-size:13px;margin-bottom:8px;">YOUR NET WORTH</div>
      <div id="nw-net-worth" style="color:var(--accent);font-size:36px;font-weight:700;margin-bottom:8px;letter-spacing:-0.5px;">Â£95,000.00</div>
      <div style="color:var(--muted);font-size:12px;">Assets âˆ’ Liabilities = Net Worth</div>
      
      <div style="display:flex;justify-content:center;gap:16px;margin-top:16px;">
        <div style="text-align:center;">
          <div style="color:#39ff14;font-size:12px;">Asset Ratio</div>
          <div id="nw-asset-ratio" style="color:#39ff14;font-weight:600;font-size:16px;">58.5%</div>
        </div>
        <div style="width:1px;background:var(--border);"></div>
        <div style="text-align:center;">
          <div style="color:#ff2d55;font-size:12px;">Debt Ratio</div>
          <div id="nw-debt-ratio" style="color:#ff2d55;font-weight:600;font-size:16px;">41.5%</div>
        </div>
      </div>
    </div>
    
    <!-- Financial Health Meter -->
    <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
      <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
        ğŸ“Š Financial Health
        <button onclick="nwShowHealthDetails()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
          Details
        </button>
      </h4>
      
      <div style="margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="color:var(--muted);font-size:12px;">Health Score</span>
          <span id="nw-health-score" style="color:var(--accent);font-weight:600;">72/100</span>
        </div>
        <div style="height:8px;background:var(--glass);border-radius:4px;overflow:hidden;">
          <div id="nw-health-bar" style="height:100%;background:linear-gradient(90deg, #ff2d55, #ffcc00, #39ff14);width:72%;"></div>
        </div>
      </div>
      
      <div id="nw-health-tips" style="font-size:12px;color:var(--muted);">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:6px;">
          <span style="color:#39ff14;">âœ“</span>
          <span>Good asset diversification</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px;">
          <span style="color:#ffcc00;">âš </span>
          <span>Consider reducing high-interest debt</span>
        </div>
      </div>
    </div>
    
    <!-- Quick Goals -->
    <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
      <h4 style="color:#ffcc00;font-size:14px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
        ğŸ¯ Financial Goals
        <button onclick="nwAddGoal()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:#ffcc00;cursor:pointer;">
          + Add
        </button>
      </h4>
      
      <div id="nw-goals-list">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,204,0,0.05);border-radius:6px;margin-bottom:8px;">
          <div>
            <div style="color:var(--text);font-size:13px;font-weight:500;">Reach Â£100K Net Worth</div>
            <div style="color:var(--muted);font-size:11px;">Progress: Â£95,000 / Â£100,000</div>
          </div>
          <div style="width:40px;height:40px;position:relative;">
            <svg width="40" height="40" viewBox="0 0 40 40">
              <circle cx="20" cy="20" r="18" fill="none" stroke="var(--glass)" stroke-width="4"/>
              <circle cx="20" cy="20" r="18" fill="none" stroke="#ffcc00" stroke-width="4" stroke-dasharray="113" stroke-dashoffset="23" stroke-linecap="round" transform="rotate(-90 20 20)"/>
              <text x="20" y="23" text-anchor="middle" fill="#ffcc00" font-size="10" font-weight="600">95%</text>
            </svg>
          </div>
        </div>
      </div>
      
      <button onclick="nwProjectFuture()" style="width:100%;padding:8px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;font-size:12px;margin-top:8px;">
        ğŸ“ˆ Project Future Growth
      </button>
    </div>
  </div>
</div>

<!-- Charts & History Section -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
  
  <!-- Asset Allocation Chart -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
    <h3 style="color:var(--accent);font-size:15px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
      ğŸ“Š Asset Allocation
      <button onclick="nwToggleChart('assets')" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
        Details
      </button>
    </h3>
    
    <div style="height:200px;display:flex;align-items:center;justify-content:center;">
      <!-- This would be a pie chart in production -->
      <div style="width:150px;height:150px;border-radius:50%;background:conic-gradient(
        #9d4edd 0% 30%,
        #2dd4ff 30% 50%,
        #39ff14 50% 70%,
        #ff9500 70% 85%,
        #ffcc00 85% 100%
      );position:relative;">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:70px;height:70px;background:var(--panel);border-radius:50%;"></div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:8px;margin-top:12px;">
      <div style="display:flex;align-items:center;gap:6px;">
        <div style="width:12px;height:12px;background:#9d4edd;border-radius:2px;"></div>
        <span style="color:var(--text);font-size:12px;">Property (77%)</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div style="width:12px;height:12px;background:#2dd4ff;border-radius:2px;"></div>
        <span style="color:var(--text);font-size:12px;">Investments (15%)</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div style="width:12px;height:12px;background:#39ff14;border-radius:2px;"></div>
        <span style="color:var(--text);font-size:12px;">Savings (8%)</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div style="width:12px;height:12px;background:#ff9500;border-radius:2px;"></div>
        <span style="color:var(--text);font-size:12px;">Other (5%)</span>
      </div>
    </div>
  </div>
  
  <!-- Net Worth History -->
  <div style="border:2px solid var(--border);border-radius:12px;padding:16px;background:var(--panel);">
    <h3 style="color:var(--accent);font-size:15px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
      ğŸ“ˆ Net Worth History
      <button onclick="nwViewHistory()" style="margin-left:auto;padding:4px 8px;font-size:11px;background:var(--glass);border:1px solid var(--border);border-radius:4px;color:var(--accent);cursor:pointer;">
        View All
      </button>
    </h3>
    
    <div style="height:200px;position:relative;margin-bottom:12px;">
      <!-- This would be a line chart in production -->
      <div style="position:absolute;bottom:0;left:0;right:0;height:150px;display:flex;align-items:flex-end;justify-content:space-around;padding:0 20px;">
        <div style="width:12px;background:linear-gradient(to top, var(--accent), rgba(45,212,255,0.3));height:60%;border-radius:6px 6px 0 0;"></div>
        <div style="width:12px;background:linear-gradient(to top, var(--accent), rgba(45,212,255,0.3));height:70%;border-radius:6px 6px 0 0;"></div>
        <div style="width:12px;background:linear-gradient(to top, var(--accent), rgba(45,212,255,0.3));height:80%;border-radius:6px 6px 0 0;"></div>
        <div style="width:12px;background:linear-gradient(to top, var(--accent), rgba(45,212,255,0.3));height:90%;border-radius:6px 6px 0 0;"></div>
        <div style="width:12px;background:linear-gradient(to top, var(--accent), rgba(45,212,255,0.3));height:100%;border-radius:6px 6px 0 0;"></div>
      </div>
    </div>
    
    <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--muted);">
      <span>3 months ago</span>
      <span>Current</span>
    </div>
    
    <div style="margin-top:12px;padding:10px;background:rgba(45,212,255,0.05);border-radius:6px;border:1px solid rgba(45,212,255,0.1);">
      <div style="display:flex;justify-content:space-between;font-size:12px;">
        <span style="color:var(--muted);">Growth This Period</span>
        <span id="nw-growth-period" style="color:#39ff14;font-weight:600;">+12.5%</span>
      </div>
    </div>
  </div>
</div>

<!-- Advanced Features Section -->
<details style="margin-bottom:20px;">
  <summary style="padding:14px;background:var(--glass);border:2px solid var(--border);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:500;list-style:none;display:flex;align-items:center;gap:8px;">
    âš™ï¸ Advanced Features & Analysis
  </summary>
  
  <div style="padding:20px;background:var(--panel);border:2px solid var(--border);border-radius:0 0 8px 8px;margin-top:-2px;">
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;margin-bottom:20px;">
      
      <!-- Retirement Projection -->
      <div>
        <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ¦ Retirement Projection</h4>
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Current Age</div>
          <input id="nw-current-age" type="number" min="18" max="100" value="35" 
                 style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
        </div>
        
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Retirement Age</div>
          <input id="nw-retirement-age" type="number" min="18" max="100" value="65" 
                 style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
        </div>
        
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Annual Return Rate (%)</div>
          <input id="nw-return-rate" type="number" min="0" max="50" step="0.1" value="7" 
                 style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
        </div>
        
        <button onclick="nwCalculateRetirement()" style="width:100%;padding:10px;background:var(--accent);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;">
          Calculate Retirement Projection
        </button>
        
        <div id="nw-retirement-result" style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.05);border-radius:6px;border:1px solid rgba(57,255,20,0.1);display:none;">
          <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">Projected Retirement Net Worth</div>
          <div id="nw-retirement-amount" style="font-size:20px;font-weight:700;color:var(--accent);"></div>
        </div>
      </div>
      
      <!-- Debt Payoff Calculator -->
      <div>
        <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ’¸ Debt Payoff Strategy</h4>
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Monthly Payment Capacity</div>
          <div style="display:flex;align-items:center;">
            <span class="nw-currency-symbol">Â£</span>
            <input id="nw-monthly-payment" type="number" min="0" step="10" value="500" 
                   style="flex:1;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);" />
          </div>
        </div>
        
        <div style="margin-bottom:12px;">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Strategy</div>
          <select id="nw-debt-strategy" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);">
            <option value="avalanche">Avalanche (Highest Interest First)</option>
            <option value="snowball">Snowball (Smallest Balance First)</option>
            <option value="consolidation">Consolidation (Lower Interest Rate)</option>
          </select>
        </div>
        
        <button onclick="nwCalculateDebtPayoff()" style="width:100%;padding:10px;background:var(--accent);border:none;border-radius:6px;color:#000;cursor:pointer;font-weight:600;">
          Calculate Payoff Plan
        </button>
        
        <div id="nw-debt-result" style="margin-top:12px;padding:12px;background:rgba(255,45,85,0.05);border-radius:6px;border:1px solid rgba(255,45,85,0.1);display:none;">
          <div style="color:#ff2d55;font-weight:600;margin-bottom:4px;">Payoff Timeline</div>
          <div id="nw-payoff-time" style="font-size:20px;font-weight:700;color:var(--accent);"></div>
        </div>
      </div>
    </div>
    
    <!-- Export & Backup -->
    <div>
      <h4 style="color:var(--accent);font-size:14px;margin:0 0 12px 0;">ğŸ’¾ Export & Backup</h4>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button onclick="nwExportCSV()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          ğŸ“Š Export CSV
        </button>
        <button onclick="nwExportPDF()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          ğŸ“„ Export PDF Report
        </button>
        <button onclick="nwBackupData()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          ğŸ’¾ Backup Data
        </button>
        <button onclick="nwImportData()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          ğŸ“¥ Import Data
        </button>
        <button onclick="nwPrintReport()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;">
          ğŸ–¨ï¸ Print Report
        </button>
      </div>
    </div>
  </div>
</details>

<!-- Educational Tips -->
<div style="padding:16px;background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(45,212,255,0.02));border-radius:8px;border:1px solid rgba(45,212,255,0.1);">
  <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px;">
    <h3 style="color:var(--accent);font-size:14px;margin:0;">ğŸ’¡ Financial Wisdom</h3>
    <button onclick="nwToggleTips()" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">
      Hide
    </button>
  </div>
  
  <div id="nw-tips-content" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:12px;">
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Emergency Fund</div>
      <div style="color:var(--muted);font-size:12px;">Aim for 3-6 months of expenses in liquid assets.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Debt Management</div>
      <div style="color:var(--muted);font-size:12px;">Prioritize high-interest debt to save on interest payments.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Asset Diversification</div>
      <div style="color:var(--muted);font-size:12px;">Don't put all your eggs in one basketâ€”diversify investments.</div>
    </div>
    <div style="padding:12px;background:var(--glass);border-radius:6px;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:6px;">Regular Tracking</div>
      <div style="color:var(--muted);font-size:12px;">Review your net worth monthly to stay on track with goals.</div>
    </div>
  </div>
</div>

<script>
/* Ultimate Net Worth Tracker & Personal Finance Dashboard
   Features:
   - Complete net worth tracking
   - Asset and liability management
   - Financial goal setting
   - Retirement projections
   - Debt payoff planning
   - Multiple currencies
   - Data privacy controls
   - Export and sharing
*/

// ========== GLOBAL STATE ==========
const nw = {
  // Financial data
  assets: [],
  liabilities: [],
  goals: [],
  history: [],
  snapshots: [],
  
  // Settings
  currency: 'GBP',
  currencySymbols: {
    'GBP': 'Â£',
    'USD': '$',
    'EUR': 'â‚¬',
    'JPY': 'Â¥',
    'CAD': '$',
    'AUD': '$',
    'CHF': 'â‚£',
    'CNY': 'Â¥',
    'INR': 'â‚¹',
    'BRL': 'R$'
  },
  privacyMode: false,
  
  // Templates
  assetTemplates: [
    { name: 'Savings Account', category: 'cash', default: 25000 },
    { name: 'Checking Account', category: 'cash', default: 5000 },
    { name: 'Investment Portfolio', category: 'investments', default: 50000 },
    { name: 'Retirement Account', category: 'retirement', default: 75000 },
    { name: 'Property Value', category: 'property', default: 250000 },
    { name: 'Vehicle Value', category: 'vehicles', default: 15000 },
    { name: 'Business Equity', category: 'business', default: 0 },
    { name: 'Collectibles', category: 'other', default: 5000 }
  ],
  
  liabilityTemplates: [
    { name: 'Mortgage', category: 'mortgage', default: 200000 },
    { name: 'Student Loans', category: 'education', default: 25000 },
    { name: 'Credit Card Debt', category: 'credit', default: 5000 },
    { name: 'Car Loan', category: 'auto', default: 10000 },
    { name: 'Personal Loan', category: 'personal', default: 5000 },
    { name: 'Medical Debt', category: 'medical', default: 0 },
    { name: 'Business Debt', category: 'business', default: 0 }
  ],
  
  // Categories with colors
  categories: {
    cash: { name: 'Cash & Savings', color: '#39ff14' },
    investments: { name: 'Investments', color: '#2dd4ff' },
    retirement: { name: 'Retirement', color: '#9d4edd' },
    property: { name: 'Real Estate', color: '#ff9500' },
    vehicles: { name: 'Vehicles', color: '#ffcc00' },
    business: { name: 'Business', color: '#ff2d55' },
    other: { name: 'Other Assets', color: '#5ac8fa' },
    
    mortgage: { name: 'Mortgage', color: '#ff2d55' },
    education: { name: 'Education', color: '#9d4edd' },
    credit: { name: 'Credit Cards', color: '#ff9500' },
    auto: { name: 'Auto Loans', color: '#ffcc00' },
    personal: { name: 'Personal Loans', color: '#2dd4ff' },
    medical: { name: 'Medical', color: '#39ff14' }
  }
};

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', function() {
  // Load saved data
  nwLoadData();
  
  // Initialize currency
  const currencySelect = document.getElementById('nw-currency');
  currencySelect.addEventListener('change', function() {
    nw.currency = this.value;
    updateCurrencySymbols();
    nwCalculate();
    nwSaveData();
  });
  
  // Set up input event listeners
  setupInputListeners();
  
  // Initialize with sample data if empty
  if (nw.assets.length === 0 && nw.liabilities.length === 0) {
    nwAddSampleData();
  } else {
    renderAssets();
    renderLiabilities();
    nwCalculate();
  }
  
  // Announce to screen reader
  announceToScreenReader('Personal Finance Dashboard loaded. Track your net worth and financial progress.');
});

function setupInputListeners() {
  // Auto-calculate on input changes
  document.addEventListener('input', function(e) {
    if (e.target.closest('.nw-entry')) {
      // Debounce calculation
      clearTimeout(window.nwCalculateTimeout);
      window.nwCalculateTimeout = setTimeout(nwCalculate, 500);
    }
  });
}

// ========== CORE CALCULATION FUNCTIONS ==========
function nwCalculate() {
  // Calculate totals
  let totalAssets = 0;
  let totalLiabilities = 0;
  
  // Sum assets
  nw.assets.forEach(asset => {
    const value = parseFloat(asset.value) || 0;
    totalAssets += value;
  });
  
  // Sum liabilities
  nw.liabilities.forEach(liability => {
    const value = parseFloat(liability.value) || 0;
    totalLiabilities += value;
  });
  
  // Calculate net worth
  const netWorth = totalAssets - totalLiabilities;
  
  // Calculate ratios
  const assetRatio = totalAssets > 0 ? (totalAssets / (totalAssets + totalLiabilities)) * 100 : 0;
  const debtRatio = totalLiabilities > 0 ? (totalLiabilities / (totalAssets + totalLiabilities)) * 100 : 0;
  
  // Format numbers with currency
  const formatCurrency = (amount) => {
    if (nw.privacyMode) return 'â€¢â€¢â€¢â€¢â€¢';
    return nw.currencySymbols[nw.currency] + amount.toLocaleString('en-US', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  };
  
  // Update display
  document.getElementById('nw-total-assets').textContent = formatCurrency(totalAssets);
  document.getElementById('nw-total-liabilities').textContent = formatCurrency(totalLiabilities);
  document.getElementById('nw-net-worth').textContent = formatCurrency(netWorth);
  
  // Update stats
  document.getElementById('nw-current-nw').textContent = formatCurrency(netWorth);
  document.getElementById('nw-stats-assets').textContent = formatCurrency(totalAssets);
  document.getElementById('nw-stats-liabilities').textContent = formatCurrency(totalLiabilities);
  
  // Update ratios
  document.getElementById('nw-asset-ratio').textContent = assetRatio.toFixed(1) + '%';
  document.getElementById('nw-debt-ratio').textContent = debtRatio.toFixed(1) + '%';
  
  // Update progress bar
  const goalAmount = 100000; // Default goal
  const progress = Math.min(100, (netWorth / goalAmount) * 100);
  document.getElementById('nw-progress-bar').style.width = progress + '%';
  document.getElementById('nw-stats-goal').textContent = formatCurrency(goalAmount);
  
  // Calculate financial health score
  const healthScore = calculateHealthScore(totalAssets, totalLiabilities, netWorth);
  document.getElementById('nw-health-score').textContent = healthScore + '/100';
  document.getElementById('nw-health-bar').style.width = healthScore + '%';
  
  // Update health tips
  updateHealthTips(netWorth, totalAssets, totalLiabilities);
  
  // Save data
  nwSaveData();
}

function calculateHealthScore(assets, liabilities, netWorth) {
  let score = 50; // Base score
  
  // Asset to liability ratio (0-30 points)
  if (liabilities === 0) {
    score += 30;
  } else {
    const ratio = assets / liabilities;
    if (ratio >= 3) score += 30;
    else if (ratio >= 2) score += 20;
    else if (ratio >= 1) score += 10;
    else if (ratio >= 0.5) score += 5;
  }
  
  // Net worth positive (0-20 points)
  if (netWorth > 0) {
    score += Math.min(20, (netWorth / assets) * 20);
  }
  
  // Emergency fund check (0-20 points)
  const hasEmergencyFund = assets > liabilities * 0.5;
  if (hasEmergencyFund) score += 20;
  
  // Cap at 100
  return Math.min(100, Math.round(score));
}

function updateHealthTips(netWorth, assets, liabilities) {
  const tipsContainer = document.getElementById('nw-health-tips');
  let tips = [];
  
  if (liabilities > assets * 0.5) {
    tips.push('âš  Consider reducing high-interest debt');
  } else {
    tips.push('âœ“ Good debt-to-asset ratio');
  }
  
  if (netWorth > 0) {
    tips.push('âœ“ Positive net worth');
  } else {
    tips.push('âš  Focus on reducing debt first');
  }
  
  if (assets > 0) {
    // Check for diversification
    const hasMultipleAssets = nw.assets.filter(a => parseFloat(a.value) > 0).length >= 3;
    if (hasMultipleAssets) {
      tips.push('âœ“ Good asset diversification');
    } else {
      tips.push('âš  Consider diversifying your assets');
    }
  }
  
  let html = '';
  tips.forEach((tip, index) => {
    const icon = tip.startsWith('âœ“') ? 'âœ“' : 'âš ';
    const color = tip.startsWith('âœ“') ? '#39ff14' : '#ffcc00';
    html += `
      <div style="display:flex;align-items:center;gap:6px;margin-bottom:${index === tips.length - 1 ? '0' : '6px'}">
        <span style="color:${color}">${icon}</span>
        <span>${tip.substring(2)}</span>
      </div>
    `;
  });
  
  tipsContainer.innerHTML = html;
}

// ========== ASSET & LIABILITY MANAGEMENT ==========
function nwAddAsset() {
  const id = 'asset-' + Date.now();
  nw.assets.push({
    id: id,
    name: '',
    value: 0,
    category: 'other',
    notes: ''
  });
  
  renderAssets();
  
  // Focus on the new input
  setTimeout(() => {
    const newInput = document.querySelector(`[data-id="${id}"] input[type="text"]`);
    if (newInput) newInput.focus();
  }, 100);
}

function nwAddLiability() {
  const id = 'liability-' + Date.now();
  nw.liabilities.push({
    id: id,
    name: '',
    value: 0,
    category: 'personal',
    notes: ''
  });
  
  renderLiabilities();
  
  // Focus on the new input
  setTimeout(() => {
    const newInput = document.querySelector(`[data-id="${id}"] input[type="text"]`);
    if (newInput) newInput.focus();
  }, 100);
}

function renderAssets() {
  const container = document.getElementById('nw-assets-list');
  if (nw.assets.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:20px;color:var(--muted);font-style:italic;">
        No assets added. Click "Add Asset" to start.
      </div>
    `;
    return;
  }
  
  let html = '';
  nw.assets.forEach(asset => {
    html += `
      <div class="nw-entry" data-type="asset" data-id="${asset.id}">
        <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
          <input type="text" placeholder="Asset name" 
                 value="${escapeHtml(asset.name)}"
                 oninput="nwUpdateEntry('${asset.id}', 'name', this.value)"
                 style="padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" />
          <div style="display:flex;align-items:center;">
            <span class="nw-currency-symbol">${nw.currencySymbols[nw.currency]}</span>
            <input type="number" min="0" step="any" placeholder="0.00" 
                   value="${asset.value}"
                   oninput="nwUpdateEntry('${asset.id}', 'value', this.value)"
                   style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:var(--text);" />
          </div>
          <button onclick="nwRemoveEntryById('${asset.id}')" 
                  style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function renderLiabilities() {
  const container = document.getElementById('nw-liabilities-list');
  if (nw.liabilities.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:20px;color:var(--muted);font-style:italic;">
        No liabilities added. Click "Add Liability" to start.
      </div>
    `;
    return;
  }
  
  let html = '';
  nw.liabilities.forEach(liability => {
    html += `
      <div class="nw-entry" data-type="liability" data-id="${liability.id}">
        <div style="display:grid;grid-template-columns:2fr 1fr 60px;gap:8px;align-items:center;margin-bottom:8px;">
          <input type="text" placeholder="Liability name" 
                 value="${escapeHtml(liability.name)}"
                 oninput="nwUpdateEntry('${liability.id}', 'name', this.value)"
                 style="padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" />
          <div style="display:flex;align-items:center;">
            <span class="nw-currency-symbol">${nw.currencySymbols[nw.currency]}</span>
            <input type="number" min="0" step="any" placeholder="0.00" 
                   value="${liability.value}"
                   oninput="nwUpdateEntry('${liability.id}', 'value', this.value)"
                   style="flex:1;padding:10px;border-radius:6px;border:1px solid rgba(255,45,85,0.3);background:rgba(255,45,85,0.05);color:var(--text);" />
          </div>
          <button onclick="nwRemoveEntryById('${liability.id}')" 
                  style="padding:8px;background:rgba(255,45,85,0.1);border:1px solid rgba(255,45,85,0.3);border-radius:6px;color:#ff2d55;cursor:pointer;">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function nwUpdateEntry(id, field, value) {
  // Find and update asset
  let entry = nw.assets.find(a => a.id === id);
  let isAsset = true;
  
  if (!entry) {
    entry = nw.liabilities.find(l => l.id === id);
    isAsset = false;
  }
  
  if (entry) {
    if (field === 'value') {
      entry[field] = parseFloat(value) || 0;
    } else {
      entry[field] = value;
    }
    
    nwCalculate();
  }
}

function nwRemoveEntry(button) {
  const entry = button.closest('.nw-entry');
  if (entry) {
    entry.remove();
    nwCalculate();
  }
}

function nwRemoveEntryById(id) {
  // Remove from assets
  nw.assets = nw.assets.filter(a => a.id !== id);
  
  // Remove from liabilities
  nw.liabilities = nw.liabilities.filter(l => l.id !== id);
  
  // Re-render
  renderAssets();
  renderLiabilities();
  nwCalculate();
}

function nwAddSampleData() {
  // Clear existing data
  nw.assets = [];
  nw.liabilities = [];
  
  // Add sample assets
  nw.assetTemplates.slice(0, 4).forEach(template => {
    nw.assets.push({
      id: 'asset-' + Date.now() + Math.random(),
      name: template.name,
      value: template.default,
      category: template.category,
      notes: 'Sample data'
    });
  });
  
  // Add sample liabilities
  nw.liabilityTemplates.slice(0, 3).forEach(template => {
    nw.liabilities.push({
      id: 'liability-' + Date.now() + Math.random(),
      name: template.name,
      value: template.default,
      category: template.category,
      notes: 'Sample data'
    });
  });
  
  // Add a goal
  nw.goals = [{
    id: 'goal-1',
    name: 'Reach Â£100K Net Worth',
    target: 100000,
    current: 95000,
    deadline: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0]
  }];
  
  // Render and calculate
  renderAssets();
  renderLiabilities();
  renderGoals();
  nwCalculate();
  
  showNotification('Sample data loaded. Update with your own numbers!', 'success');
  announceToScreenReader('Sample financial data loaded. Please update with your personal information.');
}

function nwClearAll() {
  if (confirm('Are you sure you want to clear all financial data? This cannot be undone.')) {
    nw.assets = [];
    nw.liabilities = [];
    nw.goals = [];
    nw.history = [];
    
    renderAssets();
    renderLiabilities();
    renderGoals();
    nwCalculate();
    
    showNotification('All data cleared', 'info');
    announceToScreenReader('All financial data cleared');
  }
}

// ========== GOAL MANAGEMENT ==========
function nwAddGoal() {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
  `;
  
  modal.innerHTML = `
    <div style="background: var(--panel); padding: 24px; border-radius: 12px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto;">
      <h3 style="color: var(--accent); margin: 0 0 16px 0;">Add Financial Goal</h3>
      
      <div style="display: grid; gap: 12px; margin-bottom: 20px;">
        <div>
          <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Goal Name</label>
          <input id="nw-goal-name" type="text" placeholder="e.g., Save for down payment" 
                 style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
        </div>
        
        <div>
          <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Target Amount</label>
          <div style="display: flex; align-items: center;">
            <span class="nw-currency-symbol">${nw.currencySymbols[nw.currency]}</span>
            <input id="nw-goal-target" type="number" min="0" step="100" placeholder="0.00" 
                   style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
          </div>
        </div>
        
        <div>
          <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Target Date</label>
          <input id="nw-goal-deadline" type="date" 
                 style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
        </div>
        
        <div>
          <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Goal Type</label>
          <select id="nw-goal-type" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);">
            <option value="networth">Net Worth Target</option>
            <option value="savings">Savings Goal</option>
            <option value="debt">Debt Payoff</option>
            <option value="investment">Investment Target</option>
          </select>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                style="padding: 10px 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 6px; color: var(--text); cursor: pointer;">
          Cancel
        </button>
        <button onclick="nwSaveGoal()" 
                style="padding: 10px 20px; background: var(--accent); border: none; border-radius: 6px; color: #000; cursor: pointer; font-weight: 600;">
          Save Goal
        </button>
      </div>
    </div>
  `;
  
  // Set default date to 1 year from now
  const oneYearLater = new Date();
  oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
  modal.querySelector('#nw-goal-deadline').value = oneYearLater.toISOString().split('T')[0];
  
  document.body.appendChild(modal);
  modal.querySelector('#nw-goal-name').focus();
}

function nwSaveGoal() {
  const name = document.getElementById('nw-goal-name').value.trim();
  const target = parseFloat(document.getElementById('nw-goal-target').value) || 0;
  const deadline = document.getElementById('nw-goal-deadline').value;
  const type = document.getElementById('nw-goal-type').value;
  
  if (!name) {
    showNotification('Please enter a goal name', 'warning');
    return;
  }
  
  if (target <= 0) {
    showNotification('Please enter a valid target amount', 'warning');
    return;
  }
  
  // Calculate current value based on goal type
  let current = 0;
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const netWorth = totalAssets - totalLiabilities;
  
  switch (type) {
    case 'networth':
      current = netWorth;
      break;
    case 'savings':
      // Sum cash assets
      current = nw.assets
        .filter(a => a.category === 'cash')
        .reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
      break;
    case 'debt':
      current = totalLiabilities;
      break;
    case 'investment':
      // Sum investment assets
      current = nw.assets
        .filter(a => ['investments', 'retirement'].includes(a.category))
        .reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
      break;
  }
  
  const goal = {
    id: 'goal-' + Date.now(),
    name: name,
    type: type,
    target: target,
    current: current,
    deadline: deadline,
    created: new Date().toISOString()
  };
  
  nw.goals.push(goal);
  
  // Close modal
  document.querySelector('[style*="position: fixed"]').remove();
  
  // Update display
  renderGoals();
  nwSaveData();
  
  showNotification('Goal added successfully!', 'success');
  announceToScreenReader(`Goal added: ${name}`);
}

function renderGoals() {
  const container = document.getElementById('nw-goals-list');
  if (nw.goals.length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:20px;color:var(--muted);font-style:italic;">
        No goals set. Click "Add Goal" to start.
      </div>
    `;
    return;
  }
  
  let html = '';
  nw.goals.forEach(goal => {
    const progress = Math.min(100, (goal.current / goal.target) * 100);
    const circumference = 2 * Math.PI * 18;
    const dashoffset = circumference - (progress / 100) * circumference;
    
    html += `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,204,0,0.05);border-radius:6px;margin-bottom:8px;">
        <div style="flex:1;min-width:0;">
          <div style="color:var(--text);font-size:13px;font-weight:500;margin-bottom:4px;">${escapeHtml(goal.name)}</div>
          <div style="color:var(--muted);font-size:11px;">
            Progress: ${formatCurrency(goal.current, true)} / ${formatCurrency(goal.target, true)}
            ${goal.deadline ? ` â€¢ Due: ${formatDateDisplay(goal.deadline)}` : ''}
          </div>
        </div>
        <div style="width:40px;height:40px;position:relative;flex-shrink:0;">
          <svg width="40" height="40" viewBox="0 0 40 40">
            <circle cx="20" cy="20" r="18" fill="none" stroke="var(--glass)" stroke-width="4"/>
            <circle cx="20" cy="20" r="18" fill="none" stroke="#ffcc00" stroke-width="4" 
                    stroke-dasharray="${circumference}" 
                    stroke-dashoffset="${dashoffset}" 
                    stroke-linecap="round" 
                    transform="rotate(-90 20 20)"/>
            <text x="20" y="23" text-anchor="middle" fill="#ffcc00" font-size="10" font-weight="600">
              ${Math.round(progress)}%
            </text>
          </svg>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// ========== ADVANCED FEATURES ==========
function nwProjectFuture() {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
  `;
  
  modal.innerHTML = `
    <div style="background: var(--panel); padding: 24px; border-radius: 12px; max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;">
      <h3 style="color: var(--accent); margin: 0 0 16px 0;">ğŸ“ˆ Future Net Worth Projection</h3>
      
      <div style="display: grid; gap: 12px; margin-bottom: 20px;">
        <div>
          <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Years to Project</label>
          <input id="nw-projection-years" type="range" min="1" max="30" value="10" 
                 style="width: 100%;" />
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--muted); font-size: 11px;">1 year</span>
            <span id="nw-projection-years-value" style="color: var(--accent); font-weight: 600;">10 years</span>
            <span style="color: var(--muted); font-size: 11px;">30 years</span>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Annual Asset Growth (%)</label>
            <input id="nw-asset-growth" type="number" min="0" max="50" step="0.1" value="7" 
                   style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
          </div>
          
          <div>
            <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Annual Savings Added</label>
            <div style="display: flex; align-items: center;">
              <span class="nw-currency-symbol">${nw.currencySymbols[nw.currency]}</span>
              <input id="nw-annual-savings" type="number" min="0" step="1000" value="5000" 
                     style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
            </div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Annual Debt Reduction</label>
            <div style="display: flex; align-items: center;">
              <span class="nw-currency-symbol">${nw.currencySymbols[nw.currency]}</span>
              <input id="nw-debt-reduction" type="number" min="0" step="1000" value="2000" 
                     style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
            </div>
          </div>
          
          <div>
            <label style="display: block; font-size: 12px; color: var(--accent); margin-bottom: 6px;">Inflation Rate (%)</label>
            <input id="nw-inflation-rate" type="number" min="0" max="20" step="0.1" value="2.5" 
                   style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--glass); color: var(--text);" />
          </div>
        </div>
      </div>
      
      <div id="nw-projection-results" style="display: none; margin-bottom: 20px;">
        <div style="padding: 16px; background: rgba(57,255,20,0.05); border-radius: 8px; border: 1px solid rgba(57,255,20,0.1);">
          <div style="color: #39ff14; font-weight: 600; margin-bottom: 8px;">Projection Results</div>
          <div id="nw-projection-details" style="font-size: 13px;"></div>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                style="padding: 10px 20px; background: var(--glass); border: 1px solid var(--border); border-radius: 6px; color: var(--text); cursor: pointer;">
          Close
        </button>
        <button onclick="nwCalculateProjection()" 
                style="padding: 10px 20px; background: var(--accent); border: none; border-radius: 6px; color: #000; cursor: pointer; font-weight: 600;">
          Calculate Projection
        </button>
      </div>
    </div>
  `;
  
  // Set up slider
  const slider = modal.querySelector('#nw-projection-years');
  const valueDisplay = modal.querySelector('#nw-projection-years-value');
  slider.addEventListener('input', function() {
    valueDisplay.textContent = this.value + ' years';
  });
  
  document.body.appendChild(modal);
}

function nwCalculateProjection() {
  const years = parseInt(document.getElementById('nw-projection-years').value);
  const assetGrowth = parseFloat(document.getElementById('nw-asset-growth').value) / 100;
  const annualSavings = parseFloat(document.getElementById('nw-annual-savings').value) || 0;
  const debtReduction = parseFloat(document.getElementById('nw-debt-reduction').value) || 0;
  const inflation = parseFloat(document.getElementById('nw-inflation-rate').value) / 100;
  
  // Calculate current totals
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const currentNetWorth = totalAssets - totalLiabilities;
  
  // Project future values
  let projectedAssets = totalAssets;
  let projectedLiabilities = totalLiabilities;
  
  for (let i = 0; i < years; i++) {
    // Apply growth to assets
    projectedAssets *= (1 + assetGrowth);
    projectedAssets += annualSavings;
    
    // Reduce liabilities
    projectedLiabilities = Math.max(0, projectedLiabilities - debtReduction);
    
    // Apply inflation adjustment for real value
    if (inflation > 0) {
      projectedAssets /= (1 + inflation);
      projectedLiabilities /= (1 + inflation);
    }
  }
  
  const projectedNetWorth = projectedAssets - projectedLiabilities;
  const growthMultiple = projectedNetWorth / currentNetWorth;
  
  // Display results
  const resultsDiv = document.getElementById('nw-projection-results');
  const detailsDiv = document.getElementById('nw-projection-details');
  
  detailsDiv.innerHTML = `
    <div style="margin-bottom: 8px;">
      <span style="color: var(--muted);">Projected Net Worth in ${years} years:</span><br>
      <span style="color: var(--accent); font-size: 20px; font-weight: 700;">${formatCurrency(projectedNetWorth)}</span>
    </div>
    <div style="margin-bottom: 8px;">
      <span style="color: var(--muted);">Growth:</span>
      <span style="color: #39ff14; font-weight: 600;"> ${(growthMultiple * 100).toFixed(1)}% of current value</span>
    </div>
    <div style="margin-bottom: 8px;">
      <span style="color: var(--muted);">Projected Assets:</span>
      <span style="color: #39ff14; font-weight: 600;"> ${formatCurrency(projectedAssets)}</span>
    </div>
    <div>
      <span style="color: var(--muted);">Projected Liabilities:</span>
      <span style="color: #ff2d55; font-weight: 600;"> ${formatCurrency(projectedLiabilities)}</span>
    </div>
  `;
  
  resultsDiv.style.display = 'block';
  resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function nwCalculateRetirement() {
  const currentAge = parseInt(document.getElementById('nw-current-age').value) || 35;
  const retirementAge = parseInt(document.getElementById('nw-retirement-age').value) || 65;
  const returnRate = parseFloat(document.getElementById('nw-return-rate').value) / 100 || 0.07;
  
  if (retirementAge <= currentAge) {
    showNotification('Retirement age must be greater than current age', 'error');
    return;
  }
  
  const yearsToRetirement = retirementAge - currentAge;
  
  // Calculate current totals
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const currentNetWorth = totalAssets - totalLiabilities;
  
  // Simple compound interest calculation
  const projectedNetWorth = currentNetWorth * Math.pow(1 + returnRate, yearsToRetirement);
  
  // Display results
  const resultDiv = document.getElementById('nw-retirement-result');
  const amountDiv = document.getElementById('nw-retirement-amount');
  
  amountDiv.textContent = formatCurrency(projectedNetWorth);
  resultDiv.style.display = 'block';
  
  showNotification(`Retirement projection calculated for ${yearsToRetirement} years`, 'success');
}

function nwCalculateDebtPayoff() {
  const monthlyPayment = parseFloat(document.getElementById('nw-monthly-payment').value) || 500;
  const strategy = document.getElementById('nw-debt-strategy').value;
  
  if (monthlyPayment <= 0) {
    showNotification('Please enter a valid monthly payment amount', 'error');
    return;
  }
  
  // Calculate total debt
  const totalDebt = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  
  if (totalDebt <= 0) {
    showNotification('No debts found to calculate payoff', 'info');
    return;
  }
  
  // Simplified calculation (real implementation would be more complex)
  const months = Math.ceil(totalDebt / monthlyPayment);
  const years = Math.floor(months / 12);
  const remainingMonths = months % 12;
  
  let timeText;
  if (years > 0) {
    timeText = `${years} year${years > 1 ? 's' : ''}`;
    if (remainingMonths > 0) {
      timeText += ` ${remainingMonths} month${remainingMonths > 1 ? 's' : ''}`;
    }
  } else {
    timeText = `${months} month${months > 1 ? 's' : ''}`;
  }
  
  // Display results
  const resultDiv = document.getElementById('nw-debt-result');
  const timeDiv = document.getElementById('nw-payoff-time');
  
  timeDiv.textContent = timeText;
  resultDiv.style.display = 'block';
  
  showNotification(`Debt payoff plan calculated using ${strategy} strategy`, 'success');
}

// ========== PRIVACY & SHARING ==========
function nwTogglePrivacy() {
  nw.privacyMode = !nw.privacyMode;
  
  const icon = document.getElementById('nw-privacy-icon');
  const text = document.getElementById('nw-privacy-text');
  
  if (nw.privacyMode) {
    icon.textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
    text.textContent = 'Show Values';
  } else {
    icon.textContent = 'ğŸ‘ï¸';
    text.textContent = 'Hide Values';
  }
  
  // Recalculate to update display
  nwCalculate();
  
  showNotification(nw.privacyMode ? 'Values hidden for privacy' : 'Values shown', 'info');
  announceToScreenReader(nw.privacyMode ? 'Financial values hidden for privacy' : 'Financial values shown');
}

function nwShareDashboard() {
  // Calculate totals
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const netWorth = totalAssets - totalLiabilities;
  
  let shareText = `ğŸ’° My Financial Dashboard\n\n`;
  shareText += `Net Worth: ${formatCurrency(netWorth)}\n`;
  shareText += `Assets: ${formatCurrency(totalAssets)}\n`;
  shareText += `Liabilities: ${formatCurrency(totalLiabilities)}\n\n`;
  shareText += `Tracked ${nw.assets.length} assets and ${nw.liabilities.length} liabilities\n\n`;
  shareText += `Created with The Most Useful Site in the World`;
  
  // Try Web Share API
  if (navigator.share) {
    navigator.share({
      title: 'My Financial Dashboard',
      text: shareText,
      url: window.location.href
    }).catch(console.error);
  } else {
    // Fallback to clipboard
    navigator.clipboard.writeText(shareText)
      .then(() => {
        showNotification('Dashboard summary copied to clipboard!', 'success');
      })
      .catch(() => {
        // Show share dialog
        const shareDiv = document.createElement('div');
        shareDiv.innerHTML = `
          <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);padding:20px;border-radius:12px;border:2px solid var(--accent);z-index:10000;max-width:500px;">
            <h3 style="color:var(--accent);margin:0 0 10px 0;">Share Financial Dashboard</h3>
            <textarea style="width:100%;height:200px;padding:10px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);margin-bottom:15px;font-family:monospace;font-size:12px;">${shareText}</textarea>
            <div style="display:flex;gap:10px;justify-content:flex-end;">
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">Close</button>
            </div>
          </div>
        `;
        document.body.appendChild(shareDiv);
      });
  }
}

function nwSaveSnapshot() {
  // Calculate current values
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const netWorth = totalAssets - totalLiabilities;
  
  const snapshot = {
    date: new Date().toISOString(),
    assets: totalAssets,
    liabilities: totalLiabilities,
    netWorth: netWorth,
    currency: nw.currency
  };
  
  nw.snapshots.push(snapshot);
  
  // Keep only last 12 snapshots
  if (nw.snapshots.length > 12) {
    nw.snapshots = nw.snapshots.slice(-12);
  }
  
  nwSaveData();
  
  showNotification('Financial snapshot saved!', 'success');
  announceToScreenReader('Financial snapshot saved for historical tracking');
}

// ========== EXPORT & IMPORT ==========
function nwExportCSV() {
  const data = [];
  
  // Add assets
  nw.assets.forEach(asset => {
    data.push({
      Type: 'Asset',
      Name: asset.name,
      Category: asset.category,
      Value: asset.value,
      Currency: nw.currency,
      Notes: asset.notes || ''
    });
  });
  
  // Add liabilities
  nw.liabilities.forEach(liability => {
    data.push({
      Type: 'Liability',
      Name: liability.name,
      Category: liability.category,
      Value: liability.value,
      Currency: nw.currency,
      Notes: liability.notes || ''
    });
  });
  
  // Convert to CSV
  const csv = arrayToCSV(data);
  downloadCSV(csv, `financial-data-${new Date().toISOString().split('T')[0]}.csv`);
  
  showNotification('Financial data exported as CSV', 'success');
}

function nwExportPDF() {
  // In a real implementation, use jsPDF or similar
  showNotification('PDF export would generate a detailed report', 'info');
  announceToScreenReader('PDF report generation would be available with additional libraries');
}

function nwBackupData() {
  const backup = {
    assets: nw.assets,
    liabilities: nw.liabilities,
    goals: nw.goals,
    snapshots: nw.snapshots,
    currency: nw.currency,
    timestamp: new Date().toISOString(),
    version: '2.0'
  };
  
  const dataStr = JSON.stringify(backup, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `financial-backup-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  URL.revokeObjectURL(url);
  
  showNotification('Financial data backed up successfully!', 'success');
}

function nwImportData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json,.csv';
  
  input.onchange = function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    
    reader.onload = function(event) {
      try {
        const data = JSON.parse(event.target.result);
        
        // Validate data structure
        if (!data.assets || !Array.isArray(data.assets)) {
          throw new Error('Invalid backup file format');
        }
        
        // Load data
        nw.assets = data.assets || [];
        nw.liabilities = data.liabilities || [];
        nw.goals = data.goals || [];
        nw.snapshots = data.snapshots || [];
        nw.currency = data.currency || 'GBP';
        
        // Update UI
        renderAssets();
        renderLiabilities();
        renderGoals();
        nwCalculate();
        nwSaveData();
        
        showNotification('Financial data imported successfully!', 'success');
        announceToScreenReader('Financial data imported from backup');
        
      } catch (error) {
        showNotification('Failed to import: ' + error.message, 'error');
      }
    };
    
    reader.readAsText(file);
  };
  
  input.click();
}

function nwPrintReport() {
  const printWindow = window.open('', '_blank');
  const totalAssets = nw.assets.reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
  const totalLiabilities = nw.liabilities.reduce((sum, l) => sum + (parseFloat(l.value) || 0), 0);
  const netWorth = totalAssets - totalLiabilities;
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Financial Report</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
          h1 { color: #2dd4ff; border-bottom: 2px solid #2dd4ff; padding-bottom: 10px; }
          .summary { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
          .summary-item { display: flex; justify-content: space-between; margin: 10px 0; }
          .assets { color: #39ff14; }
          .liabilities { color: #ff2d55; }
          .networth { color: #2dd4ff; font-weight: bold; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
          th { background: #f5f5f5; }
          .footer { margin-top: 40px; color: #666; font-size: 12px; text-align: center; }
        </style>
      </head>
      <body>
        <h1>Financial Report</h1>
        <div>Generated: ${new Date().toLocaleDateString()}</div>
        
        <div class="summary">
          <div class="summary-item">
            <span>Total Assets:</span>
            <span class="assets">${formatCurrency(totalAssets)}</span>
          </div>
          <div class="summary-item">
            <span>Total Liabilities:</span>
            <span class="liabilities">${formatCurrency(totalLiabilities)}</span>
          </div>
          <div class="summary-item">
            <span>Net Worth:</span>
            <span class="networth">${formatCurrency(netWorth)}</span>
          </div>
        </div>
        
        <h2>Assets</h2>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            ${nw.assets.map(asset => `
              <tr>
                <td>${escapeHtml(asset.name)}</td>
                <td>${formatCurrency(asset.value)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <h2>Liabilities</h2>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            ${nw.liabilities.map(liability => `
              <tr>
                <td>${escapeHtml(liability.name)}</td>
                <td>${formatCurrency(liability.value)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <div class="footer">
          Report generated by The Most Useful Site in the World
        </div>
        
        <script>
          window.onload = function() {
            window.print();
            setTimeout(function() {
              window.close();
            }, 1000);
          }
        <\/script>
      </body>
    </html>
  `);
  printWindow.document.close();
}

// ========== UI HELPER FUNCTIONS ==========
function nwShowHealthDetails() {
  alert('Financial Health Score considers:\nâ€¢ Asset to debt ratio\nâ€¢ Emergency fund adequacy\nâ€¢ Debt repayment capacity\nâ€¢ Savings rate\nâ€¢ Investment diversification\n\nA score of 70+ is considered healthy.');
}

function nwViewHistory() {
  alert('History view would show net worth changes over time with interactive charts.');
}

function nwToggleChart(type) {
  alert(`${type} chart details would show breakdown and analytics.`);
}

function nwToggleTips() {
  const tips = document.getElementById('nw-tips-content');
  const btn = document.querySelector('button[onclick="nwToggleTips()"]');
  
  if (tips.style.display === 'none') {
    tips.style.display = 'grid';
    btn.textContent = 'Hide';
  } else {
    tips.style.display = 'none';
    btn.textContent = 'Show';
  }
}

// ========== UTILITY FUNCTIONS ==========
function updateCurrencySymbols() {
  const symbol = nw.currencySymbols[nw.currency];
  document.querySelectorAll('.nw-currency-symbol').forEach(el => {
    el.textContent = symbol;
  });
}

function formatCurrency(amount, forceShow = false) {
  if (nw.privacyMode && !forceShow) {
    return 'â€¢â€¢â€¢â€¢â€¢';
  }
  
  return nw.currencySymbols[nw.currency] + amount.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

function formatDateDisplay(dateStr) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric' 
  });
}

function escapeHtml(text) {
  if (!text) return '';
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function arrayToCSV(data) {
  if (data.length === 0) return '';
  
  const headers = Object.keys(data[0]);
  const rows = data.map(row => 
    headers.map(header => {
      const value = row[header];
      if (typeof value === 'string' && (value.includes(',') || value.includes('\n') || value.includes('"'))) {
        return `"${value.replace(/"/g, '""')}"`;
      }
      return value;
    }).join(',')
  );
  
  return [headers.join(','), ...rows].join('\n');
}

function downloadCSV(content, filename) {
  const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
}

function showNotification(message, type = 'info') {
  // Remove existing notifications
  document.querySelectorAll('.nw-notification').forEach(el => el.remove());
  
  const notification = document.createElement('div');
  notification.className = 'nw-notification';
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    border-radius: 8px;
    background: ${type === 'error' ? '#ff2d55' : type === 'warning' ? '#ff9500' : type === 'success' ? '#39ff14' : 'var(--accent)'};
    color: #000;
    font-weight: 600;
    z-index: 10001;
    animation: slideIn 0.3s ease;
    max-width: 300px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  `;
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Auto-remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

function announceToScreenReader(message) {
  const liveRegion = document.getElementById('nw-screen-reader') || (() => {
    const region = document.createElement('div');
    region.id = 'nw-screen-reader';
    region.setAttribute('aria-live', 'polite');
    region.setAttribute('aria-atomic', 'true');
    region.style.cssText = 'position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;';
    document.body.appendChild(region);
    return region;
  })();
  
  liveRegion.textContent = message;
  setTimeout(() => { liveRegion.textContent = ''; }, 1000);
}

// ========== DATA PERSISTENCE ==========
function nwSaveData() {
  const data = {
    assets: nw.assets,
    liabilities: nw.liabilities,
    goals: nw.goals,
    snapshots: nw.snapshots,
    currency: nw.currency,
    privacyMode: nw.privacyMode,
    version: '2.0',
    lastUpdated: new Date().toISOString()
  };
  
  localStorage.setItem('netWorthData', JSON.stringify(data));
}

function nwLoadData() {
  try {
    const saved = localStorage.getItem('netWorthData');
    if (saved) {
      const data = JSON.parse(saved);
      
      nw.assets = data.assets || [];
      nw.liabilities = data.liabilities || [];
      nw.goals = data.goals || [];
      nw.snapshots = data.snapshots || [];
      nw.currency = data.currency || 'GBP';
      nw.privacyMode = data.privacyMode || false;
      
      console.log('Net worth data loaded:', nw.assets.length, 'assets,', nw.liabilities.length, 'liabilities');
    }
  } catch (error) {
    console.error('Failed to load net worth data:', error);
    // Start fresh
    nw.assets = [];
    nw.liabilities = [];
    nw.goals = [];
    nw.snapshots = [];
    nw.currency = 'GBP';
    nw.privacyMode = false;
  }
}

// ========== GLOBAL EXPORTS ==========
window.nwCalculate = nwCalculate;
window.nwAddAsset = nwAddAsset;
window.nwAddLiability = nwAddLiability;
window.nwRemoveEntry = nwRemoveEntry;
window.nwRemoveEntryById = nwRemoveEntryById;
window.nwAddSampleData = nwAddSampleData;
window.nwClearAll = nwClearAll;
window.nwTogglePrivacy = nwTogglePrivacy;
window.nwShareDashboard = nwShareDashboard;
window.nwSaveSnapshot = nwSaveSnapshot;
window.nwAddGoal = nwAddGoal;
window.nwSaveGoal = nwSaveGoal;
window.nwProjectFuture = nwProjectFuture;
window.nwCalculateProjection = nwCalculateProjection;
window.nwCalculateRetirement = nwCalculateRetirement;
window.nwCalculateDebtPayoff = nwCalculateDebtPayoff;
window.nwShowHealthDetails = nwShowHealthDetails;
window.nwViewHistory = nwViewHistory;
window.nwToggleChart = nwToggleChart;
window.nwToggleTips = nwToggleTips;
window.nwExportCSV = nwExportCSV;
window.nwExportPDF = nwExportPDF;
window.nwBackupData = nwBackupData;
window.nwImportData = nwImportData;
window.nwPrintReport = nwPrintReport;

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  .nw-entry:hover {
    transform: translateY(-1px);
    transition: transform 0.2s;
  }
  
  input:focus, select:focus, button:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  
  @media (max-width: 768px) {
    .dashboard .card {
      grid-template-columns: 1fr;
    }
    
    .row {
      grid-template-columns: 1fr !important;
    }
  }
`;
document.head.appendChild(style);

console.log('Ultimate Net Worth Tracker loaded successfully!');
</script>
