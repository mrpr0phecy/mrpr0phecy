<h2 id="idealweight-title" style="margin-top:0;color:var(--accent);text-align:center;position:relative;">
  ‚öñÔ∏è <span style="color:#2dd4ff">Smart</span> Ideal Weight & BMI Calculator
  <div style="font-size:14px;color:rgba(230,250,255,0.7);font-weight:400;margin-top:4px;">
    Your Personalized Body Weight Analysis
  </div>
</h2>

<!-- Health Dashboard -->
<div style="background:linear-gradient(135deg, rgba(45,212,255,0.08), rgba(57,255,20,0.05));border-radius:12px;padding:16px;margin-bottom:20px;border:1px solid rgba(45,212,255,0.2);box-shadow:0 4px 20px rgba(0,0,0,0.2);">
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;">
    <div style="padding:8px;background:rgba(255,255,255,0.03);border-radius:8px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Your BMI</div>
      <div id="iw-bmi-value" style="font-size:24px;font-weight:700;color:#39ff14;">22.5</div>
    </div>
    <div style="padding:8px;background:rgba(255,255,255,0.03);border-radius:8px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Healthy Range</div>
      <div id="iw-healthy-range" style="font-size:18px;font-weight:700;color:#2dd4ff;">65-80kg</div>
    </div>
    <div style="padding:8px;background:rgba(255,255,255,0.03);border-radius:8px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Status</div>
      <div id="iw-status" style="font-size:14px;font-weight:700;color:#39ff14;padding:4px 8px;background:rgba(57,255,20,0.1);border-radius:6px;border:1px solid rgba(57,255,20,0.3);">
        Healthy
      </div>
    </div>
  </div>
</div>

<form aria-describedby="idealweight-desc" style="margin-top:16px;">
  <p id="idealweight-desc" class="small" style="text-align:center;color:rgba(230,250,255,0.9);line-height:1.5;">
    Get a <span style="color:var(--accent);font-weight:600">comprehensive analysis</span> of your ideal weight range 
    using multiple scientific formulas and personalized factors.
  </p>

  <!-- PERSONAL PROFILE SECTION -->
  <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(45,212,255,0.15);">
    <h4 style="color:var(--accent);margin-top:0;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
      <span style="font-size:18px">üë§</span> Your Profile
    </h4>
    
    <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <!-- Gender -->
      <div>
        <label for="idealweight-gender" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Gender
        </label>
        <div style="display:flex;gap:8px;">
          <button type="button" id="iw-male" onclick="iwSetGender('male')" 
                  style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:2px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üë® Male
          </button>
          <button type="button" id="iw-female" onclick="iwSetGender('female')"
                  style="flex:1;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;">
            üë© Female
          </button>
        </div>
      </div>
      
      <!-- Age -->
      <div>
        <label for="idealweight-age" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Age (years)
        </label>
        <input id="idealweight-age" type="number" min="18" max="100" value="30" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
      </div>
    </div>
    
    <!-- Height & Current Weight -->
    <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
      <!-- Height -->
      <div>
        <label for="idealweight-height" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Height
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="idealweight-height" type="number" min="100" max="250" value="175" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <div style="display:flex;gap:4px;">
            <button type="button" onclick="iwSetUnit('cm')" id="iw-unit-cm" 
                    style="padding:6px 10px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
              cm
            </button>
            <button type="button" onclick="iwSetUnit('in')" id="iw-unit-in"
                    style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;font-size:12px;">
              in
            </button>
          </div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;text-align:center;">
          Quick set: 
          <button type="button" onclick="iwSetHeight(160)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">160</button> ‚Ä¢ 
          <button type="button" onclick="iwSetHeight(175)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">175</button> ‚Ä¢ 
          <button type="button" onclick="iwSetHeight(190)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">190</button> cm
        </div>
      </div>
      
      <!-- Current Weight -->
      <div>
        <label for="idealweight-current" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
          Current Weight
        </label>
        <div style="display:flex;align-items:center;gap:8px;">
          <input id="idealweight-current" type="number" min="30" max="300" value="70" 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;" />
          <div style="display:flex;gap:4px;">
            <button type="button" onclick="iwSetWeightUnit('kg')" id="iw-weightunit-kg" 
                    style="padding:6px 10px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
              kg
            </button>
            <button type="button" onclick="iwSetWeightUnit('lb')" id="iw-weightunit-lb"
                    style="padding:6px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;font-size:12px;">
              lb
            </button>
          </div>
        </div>
        <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:4px;text-align:center;">
          Quick set: 
          <button type="button" onclick="iwSetWeight(60)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">60</button> ‚Ä¢ 
          <button type="button" onclick="iwSetWeight(75)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">75</button> ‚Ä¢ 
          <button type="button" onclick="iwSetWeight(90)" style="background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;">90</button> kg
        </div>
      </div>
    </div>
    
    <!-- Body Frame -->
    <div style="margin-top:12px;">
      <label style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        Body Frame Size
      </label>
      <div style="display:flex;gap:8px;">
        <button type="button" onclick="iwSetFrame('small')" id="iw-frame-small" 
                style="flex:1;padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;">
          üü¢ Small
        </button>
        <button type="button" onclick="iwSetFrame('medium')" id="iw-frame-medium" 
                style="flex:1;padding:10px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:2px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
          üü° Medium
        </button>
        <button type="button" onclick="iwSetFrame('large')" id="iw-frame-large"
                style="flex:1;padding:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;font-weight:500;">
          üî¥ Large
        </button>
      </div>
      <div style="font-size:11px;color:rgba(230,250,255,0.6);margin-top:4px;text-align:center;">
        <span style="color:#39ff14;">Small</span> = wrist ‚â§ 15cm (6in) ‚Ä¢ 
        <span style="color:#ffcc00;">Medium</span> = 15-17cm (6-6.7in) ‚Ä¢ 
        <span style="color:#ff2d55;">Large</span> = ‚â• 17cm (6.7in)
      </div>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="idealweightCalc()" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600;font-size:16px;">
      ‚öñÔ∏è Calculate My Analysis
    </button>
    <button type="button" onclick="iwShareResults()"
            style="padding:14px 20px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:10px;color:#39ff14;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px;">
      üì§ Share
    </button>
  </div>
</form>

<!-- COMPREHENSIVE RESULTS -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <div style="background:linear-gradient(135deg, rgba(20,20,20,0.8), rgba(10,15,20,0.9));border-radius:12px;padding:20px;border:1px solid rgba(45,212,255,0.2);box-shadow:0 8px 32px rgba(0,0,0,0.3);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:16px;text-align:center;font-size:18px;">
      üìä Your Body Weight Analysis
    </h3>
    
    <!-- Results Grid -->
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px;">
      <!-- Healthy Weight Range -->
      <div style="text-align:center;padding:16px;background:rgba(57,255,20,0.08);border-radius:10px;border:1px solid rgba(57,255,20,0.2);">
        <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:6px;">üéØ Healthy Weight Range</div>
        <div id="idealweight-range" style="font-size:28px;font-weight:700;color:#39ff14;margin-bottom:4px;">65-80kg</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.6);">
          Based on BMI 18.5‚Äì24.9
        </div>
      </div>
      
      <!-- Current vs Ideal -->
      <div style="text-align:center;padding:16px;background:rgba(45,212,255,0.08);border-radius:10px;border:1px solid rgba(45,212,255,0.2);">
        <div style="font-size:13px;color:rgba(230,250,255,0.7);margin-bottom:6px;">üìà Current vs Ideal</div>
        <div id="iw-difference" style="font-size:24px;font-weight:700;color:var(--accent);margin-bottom:4px;">
          <span id="iw-diff-value">-5kg</span>
          <div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:2px;">
            <span id="iw-diff-percent">(7.1%)</span> from ideal
          </div>
        </div>
      </div>
    </div>
    
    <!-- BMI Progress Bar -->
    <div style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-size:13px;color:rgba(230,250,255,0.9);font-weight:500;">Body Mass Index (BMI)</div>
        <div style="font-size:13px;color:rgba(230,250,255,0.7);">
          <span id="iw-bmi-category" style="color:#39ff14;font-weight:600;">Healthy Weight</span>
        </div>
      </div>
      
      <div style="height:20px;background:linear-gradient(90deg, #00ff99, #39ff14, #ffcc00, #ff2d55, #ff0000);border-radius:10px;margin-bottom:8px;position:relative;">
        <!-- BMI Marker -->
        <div id="iw-bmi-marker" style="position:absolute;top:-4px;width:12px;height:28px;background:#ffffff;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.5);transform:translateX(-50%);"></div>
        
        <!-- BMI Labels -->
        <div style="position:absolute;top:24px;left:0;right:0;display:flex;justify-content:space-between;font-size:10px;color:rgba(230,250,255,0.6);">
          <span>Underweight</span>
          <span>Healthy</span>
          <span>Overweight</span>
          <span>Obese</span>
        </div>
      </div>
      
      <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(230,250,255,0.6);">
        <span>16</span>
        <span>18.5</span>
        <span>25</span>
        <span>30</span>
        <span>40+</span>
      </div>
    </div>
    
    <!-- Formula Comparison -->
    <div style="margin-top:20px;">
      <h4 style="color:rgba(230,250,255,0.9);margin-bottom:8px;font-size:14px;">üî¨ Weight Calculation Methods</h4>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;font-size:12px;">
        <div style="padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;">
          <div style="color:var(--accent);font-weight:500;margin-bottom:4px;">Devine Formula</div>
          <div id="iw-devine" style="color:rgba(230,250,255,0.9);">72.5 kg</div>
        </div>
        <div style="padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;">
          <div style="color:var(--accent);font-weight:500;margin-bottom:4px;">Robinson Formula</div>
          <div id="iw-robinson" style="color:rgba(230,250,255,0.9);">73.1 kg</div>
        </div>
        <div style="padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;">
          <div style="color:var(--accent);font-weight:500;margin-bottom:4px;">Miller Formula</div>
          <div id="iw-miller" style="color:rgba(230,250,255,0.9);">71.9 kg</div>
        </div>
        <div style="padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;">
          <div style="color:var(--accent);font-weight:500;margin-bottom:4px;">Hamwi Formula</div>
          <div id="iw-hamwi" style="color:rgba(230,250,255,0.9);">74.2 kg</div>
        </div>
      </div>
    </div>
    
    <!-- PERSONALIZED RECOMMENDATIONS -->
    <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.1);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <h4 style="color:rgba(230,250,255,0.9);margin:0;font-size:14px;">üí° Personalized Recommendations</h4>
        <button type="button" onclick="iwNewTip()" 
                style="padding:4px 8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;font-size:11px;">
          New Tip
        </button>
      </div>
      <div id="iw-recommendation" style="font-size:13px;color:rgba(230,250,255,0.9);line-height:1.5;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:4px solid var(--accent);">
        <div style="display:flex;align-items:flex-start;gap:8px;">
          <span style="color:#39ff14;flex-shrink:0;font-size:16px;">üéØ</span>
          <span>Maintain your healthy weight by combining regular exercise with a balanced diet rich in vegetables and lean proteins.</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- HEALTH INFORMATION -->
<details class="small" style="margin-top:20px;background:rgba(20,20,20,0.6);border-radius:10px;border:1px solid rgba(255,255,255,0.1);padding:8px;">
  <summary style="color:var(--accent);font-weight:600;cursor:pointer;padding:8px;font-size:14px;">
    üìö Scientific Formulas & Health Information
  </summary>
  <div style="padding:12px 8px 8px;border-top:1px solid rgba(255,255,255,0.1);">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div>
        <h5 style="color:var(--accent);margin-top:0;margin-bottom:6px;font-size:13px;">Weight Formulas</h5>
        <ul style="font-size:12px;color:rgba(230,250,255,0.8);padding-left:16px;margin:0;">
          <li><strong>Devine:</strong> 50kg + 2.3kg/inch over 5ft (male)</li>
          <li><strong>Robinson:</strong> 52kg + 1.9kg/inch (male)</li>
          <li><strong>Miller:</strong> 56.2kg + 1.41kg/inch (male)</li>
          <li><strong>Hamwi:</strong> 48kg + 2.7kg/inch (male)</li>
        </ul>
      </div>
      <div>
        <h5 style="color:var(--accent);margin-top:0;margin-bottom:6px;font-size:13px;">BMI Categories</h5>
        <ul style="font-size:12px;color:rgba(230,250,255,0.8);padding-left:16px;margin:0;">
          <li>< 18.5: Underweight</li>
          <li>18.5‚Äì24.9: Healthy</li>
          <li>25‚Äì29.9: Overweight</li>
          <li>30‚Äì34.9: Obese (Class 1)</li>
          <li>35‚Äì39.9: Obese (Class 2)</li>
          <li>‚â• 40: Obese (Class 3)</li>
        </ul>
      </div>
    </div>
    
    <!-- Health Risks Info -->
    <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:10px;margin-top:10px;border:1px solid rgba(45,212,255,0.1);">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">‚ö†Ô∏è Health Considerations</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.9);line-height:1.5;">
        <strong>Note:</strong> These formulas provide estimates. Individual ideal weight varies based on muscle mass, bone density, age, and overall health. Consult a healthcare professional for personalized advice. BMI has limitations for athletes and elderly individuals.
      </div>
    </div>
    
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
      <div style="font-size:11px;color:rgba(230,250,255,0.6);">
        Formulas approved by medical associations
      </div>
      <button type="button" onclick="iwSaveProfile()"
              style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:11px;">
        üíæ Save My Profile
      </button>
    </div>
  </div>
</details>

<!-- TRACKING SECTION -->
<div style="margin-top:20px;background:rgba(20,20,20,0.6);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
  <h4 style="color:var(--accent);margin-top:0;margin-bottom:12px;text-align:center;font-size:16px;">
    üìà Weight Tracking
  </h4>
  
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px;">
    <div style="text-align:center;padding:12px;background:rgba(57,255,20,0.08);border-radius:8px;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Target Weight</div>
      <input id="iw-target-weight" type="number" min="30" max="300" value="75" 
             style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#39ff14;text-align:center;font-size:16px;font-weight:600;" />
    </div>
    <div style="text-align:center;padding:12px;background:rgba(45,212,255,0.08);border-radius:8px;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Weekly Goal</div>
      <div id="iw-weekly-goal" style="font-size:16px;font-weight:600;color:var(--accent);">0.5 kg/week</div>
      <div style="font-size:10px;color:rgba(230,250,255,0.6);margin-top:4px;">Safe weight loss</div>
    </div>
  </div>
  
  <div style="text-align:center;">
    <button type="button" onclick="iwSetGoal()"
            style="padding:10px 20px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:6px;">
      üéØ Set Weight Goal
    </button>
  </div>
</div>

<script>
/* ideal-weight-calculator.html - VIRAL EDITION
   - Comprehensive weight analysis tool
   - Multiple scientific formulas
   - BMI visualization
   - Personalized recommendations
   - Weight tracking goals
*/

// User profile
let iwProfile = {
  gender: 'male',
  age: 30,
  height: 175, // in cm
  currentWeight: 70, // in kg
  frame: 'medium',
  heightUnit: 'cm',
  weightUnit: 'kg',
  targetWeight: null,
  lastCalculation: null
};

// Health tips database
const iwHealthTips = [
  "Losing 5-10% of body weight can significantly improve blood pressure, cholesterol, and blood sugar levels.",
  "Muscle weighs more than fat - focus on body composition, not just scale weight.",
  "Drinking water before meals can reduce calorie intake by 13% on average.",
  "Consistent sleep (7-9 hours) helps regulate hormones that control hunger and metabolism.",
  "High-protein diets can boost metabolism by 80-100 calories per day through thermogenesis.",
  "Regular strength training preserves muscle mass during weight loss, keeping metabolism higher.",
  "Eating more fiber helps you feel full longer and improves gut health.",
  "Tracking food intake increases awareness and can double weight loss results.",
  "Stress management is crucial - cortisol promotes abdominal fat storage.",
  "Small, sustainable changes are more effective than drastic diets you can't maintain.",
  "Weigh yourself at the same time each day (morning after bathroom) for consistency.",
  "Celebrate non-scale victories like better sleep, more energy, and improved mood."
];

// Initialize
function iwInit() {
  console.log("Ideal Weight Calculator initialized");
  
  // Load saved profile
  const savedProfile = localStorage.getItem('iwProfile');
  if (savedProfile) {
    try {
      iwProfile = JSON.parse(savedProfile);
      
      // Apply saved values to form
      iwSetGender(iwProfile.gender);
      document.getElementById('idealweight-age').value = iwProfile.age;
      document.getElementById('idealweight-height').value = iwProfile.height;
      document.getElementById('idealweight-current').value = iwProfile.currentWeight;
      iwSetFrame(iwProfile.frame);
      iwSetUnit(iwProfile.heightUnit);
      iwSetWeightUnit(iwProfile.weightUnit);
      
      if (iwProfile.targetWeight) {
        document.getElementById('iw-target-weight').value = iwProfile.targetWeight;
      }
    } catch (e) {
      console.log("Failed to load profile:", e);
    }
  }
  
  // Set up event listeners for auto-calculation
  document.querySelectorAll('#idealweight-age, #idealweight-height, #idealweight-current').forEach(input => {
    input.addEventListener('input', function() {
      setTimeout(idealweightCalc, 300);
    });
  });
  
  // Set up target weight listener
  document.getElementById('iw-target-weight').addEventListener('input', function() {
    iwUpdateWeeklyGoal();
  });
  
  // Initial calculation
  idealweightCalc();
}

// Set gender with visual feedback
function iwSetGender(gender) {
  iwProfile.gender = gender;
  
  const maleBtn = document.getElementById('iw-male');
  const femaleBtn = document.getElementById('iw-female');
  
  if (gender === 'male') {
    maleBtn.style.background = 'linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1))';
    maleBtn.style.border = '2px solid rgba(45,212,255,0.4)';
    maleBtn.style.color = 'var(--accent)';
    maleBtn.style.fontWeight = '600';
    
    femaleBtn.style.background = 'rgba(255,255,255,0.05)';
    femaleBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    femaleBtn.style.color = 'inherit';
    femaleBtn.style.fontWeight = '500';
  } else {
    femaleBtn.style.background = 'linear-gradient(135deg, rgba(255,77,191,0.2), rgba(255,77,191,0.1))';
    femaleBtn.style.border = '2px solid rgba(255,77,191,0.4)';
    femaleBtn.style.color = '#ff4dbf';
    femaleBtn.style.fontWeight = '600';
    
    maleBtn.style.background = 'rgba(255,255,255,0.05)';
    maleBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    maleBtn.style.color = 'inherit';
    maleBtn.style.fontWeight = '500';
  }
  
  idealweightCalc();
}

// Set height unit
function iwSetUnit(unit) {
  iwProfile.heightUnit = unit;
  
  const cmBtn = document.getElementById('iw-unit-cm');
  const inBtn = document.getElementById('iw-unit-in');
  
  if (unit === 'cm') {
    cmBtn.style.background = 'rgba(45,212,255,0.2)';
    cmBtn.style.border = '1px solid rgba(45,212,255,0.4)';
    cmBtn.style.color = 'var(--accent)';
    
    inBtn.style.background = 'rgba(255,255,255,0.05)';
    inBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    inBtn.style.color = 'inherit';
  } else {
    inBtn.style.background = 'rgba(45,212,255,0.2)';
    inBtn.style.border = '1px solid rgba(45,212,255,0.4)';
    inBtn.style.color = 'var(--accent)';
    
    cmBtn.style.background = 'rgba(255,255,255,0.05)';
    cmBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    cmBtn.style.color = 'inherit';
  }
  
  // Convert height value if needed
  const heightInput = document.getElementById('idealweight-height');
  if (unit === 'cm' && heightInput.value < 100) {
    // Probably inches, convert to cm
    heightInput.value = Math.round(heightInput.value * 2.54);
  } else if (unit === 'in' && heightInput.value > 100) {
    // Probably cm, convert to inches
    heightInput.value = Math.round(heightInput.value / 2.54);
  }
  
  idealweightCalc();
}

// Set weight unit
function iwSetWeightUnit(unit) {
  iwProfile.weightUnit = unit;
  
  const kgBtn = document.getElementById('iw-weightunit-kg');
  const lbBtn = document.getElementById('iw-weightunit-lb');
  
  if (unit === 'kg') {
    kgBtn.style.background = 'rgba(45,212,255,0.2)';
    kgBtn.style.border = '1px solid rgba(45,212,255,0.4)';
    kgBtn.style.color = 'var(--accent)';
    
    lbBtn.style.background = 'rgba(255,255,255,0.05)';
    lbBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    lbBtn.style.color = 'inherit';
  } else {
    lbBtn.style.background = 'rgba(45,212,255,0.2)';
    lbBtn.style.border = '1px solid rgba(45,212,255,0.4)';
    lbBtn.style.color = 'var(--accent)';
    
    kgBtn.style.background = 'rgba(255,255,255,0.05)';
    kgBtn.style.border = '1px solid rgba(255,255,255,0.1)';
    kgBtn.style.color = 'inherit';
  }
  
  idealweightCalc();
}

// Set frame size
function iwSetFrame(frame) {
  iwProfile.frame = frame;
  
  const smallBtn = document.getElementById('iw-frame-small');
  const mediumBtn = document.getElementById('iw-frame-medium');
  const largeBtn = document.getElementById('iw-frame-large');
  
  // Reset all buttons
  [smallBtn, mediumBtn, largeBtn].forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.05)';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
    btn.style.color = 'inherit';
    btn.style.fontWeight = '500';
  });
  
  // Style active button
  const activeBtn = frame === 'small' ? smallBtn : frame === 'medium' ? mediumBtn : largeBtn;
  const activeColor = frame === 'small' ? '#39ff14' : frame === 'medium' ? 'var(--accent)' : '#ff2d55';
  
  activeBtn.style.background = `linear-gradient(135deg, ${activeColor}20, ${activeColor}10)`;
  activeBtn.style.border = `2px solid ${activeColor}40`;
  activeBtn.style.color = activeColor;
  activeBtn.style.fontWeight = '600';
  
  idealweightCalc();
}

// Quick height set
function iwSetHeight(height) {
  document.getElementById('idealweight-height').value = height;
  idealweightCalc();
}

// Quick weight set
function iwSetWeight(weight) {
  document.getElementById('idealweight-current').value = weight;
  idealweightCalc();
}

// Main calculation function
function idealweightCalc(btn = null) {
  // Update profile from form
  iwProfile.age = parseInt(document.getElementById('idealweight-age').value) || 30;
  iwProfile.height = parseFloat(document.getElementById('idealweight-height').value) || 175;
  iwProfile.currentWeight = parseFloat(document.getElementById('idealweight-current').value) || 70;
  
  // Convert height to cm if in inches
  let heightCm = iwProfile.height;
  if (iwProfile.heightUnit === 'in') {
    heightCm = iwProfile.height * 2.54;
  }
  
  // Convert current weight to kg if in lbs
  let currentWeightKg = iwProfile.currentWeight;
  if (iwProfile.weightUnit === 'lb') {
    currentWeightKg = iwProfile.currentWeight * 0.453592;
  }
  
  // Convert height to inches for formulas
  const heightInches = heightCm / 2.54;
  const baseInches = 60; // 5 ft
  
  // Calculate using multiple formulas
  let devineWeight, robinsonWeight, millerWeight, hamwiWeight;
  
  if (heightInches > baseInches) {
    const extraInches = heightInches - baseInches;
    
    // Devine formula
    if (iwProfile.gender === 'male') {
      devineWeight = 50 + (2.3 * extraInches);
      robinsonWeight = 52 + (1.9 * extraInches);
      millerWeight = 56.2 + (1.41 * extraInches);
      hamwiWeight = 48 + (2.7 * extraInches);
    } else {
      devineWeight = 45.5 + (2.3 * extraInches);
      robinsonWeight = 49 + (1.7 * extraInches);
      millerWeight = 53.1 + (1.36 * extraInches);
      hamwiWeight = 45.5 + (2.2 * extraInches);
    }
  } else {
    // For heights at or below 5ft
    if (iwProfile.gender === 'male') {
      devineWeight = 50;
      robinsonWeight = 52;
      millerWeight = 56.2;
      hamwiWeight = 48;
    } else {
      devineWeight = 45.5;
      robinsonWeight = 49;
      millerWeight = 53.1;
      hamwiWeight = 45.5;
    }
  }
  
  // Adjust for frame size
  const frameAdjustment = iwProfile.frame === 'small' ? -0.95 : iwProfile.frame === 'large' ? 1.05 : 1;
  devineWeight *= frameAdjustment;
  robinsonWeight *= frameAdjustment;
  millerWeight *= frameAdjustment;
  hamwiWeight *= frameAdjustment;
  
  // Calculate average ideal weight
  const averageIdeal = (devineWeight + robinsonWeight + millerWeight + hamwiWeight) / 4;
  
  // Calculate BMI
  const heightM = heightCm / 100;
  const bmi = currentWeightKg / (heightM * heightM);
  
  // Determine BMI category
  let bmiCategory, bmiColor;
  if (bmi < 18.5) {
    bmiCategory = 'Underweight';
    bmiColor = '#00ff99';
  } else if (bmi < 25) {
    bmiCategory = 'Healthy Weight';
    bmiColor = '#39ff14';
  } else if (bmi < 30) {
    bmiCategory = 'Overweight';
    bmiColor = '#ffcc00';
  } else if (bmi < 35) {
    bmiCategory = 'Obese (Class 1)';
    bmiColor = '#ff2d55';
  } else if (bmi < 40) {
    bmiCategory = 'Obese (Class 2)';
    bmiColor = '#ff0000';
  } else {
    bmiCategory = 'Obese (Class 3)';
    bmiColor = '#cc0000';
  }
  
  // Calculate healthy weight range (BMI 18.5-24.9)
  const minWeight = 18.5 * (heightM * heightM);
  const maxWeight = 24.9 * (heightM * heightM);
  
  // Calculate difference from ideal
  const diffKg = currentWeightKg - averageIdeal;
  const diffPercent = (Math.abs(diffKg) / averageIdeal) * 100;
  
  // Update display
  document.getElementById('iw-bmi-value').textContent = bmi.toFixed(1);
  document.getElementById('iw-healthy-range').textContent = 
    `${minWeight.toFixed(0)}-${maxWeight.toFixed(0)}kg`;
  document.getElementById('iw-status').textContent = bmiCategory;
  document.getElementById('iw-status').style.color = bmiColor;
  document.getElementById('iw-status').style.borderColor = bmiColor + '40';
  document.getElementById('iw-status').style.background = bmiColor + '10';
  
  // Update ideal weight range
  document.getElementById('idealweight-range').textContent = 
    `${minWeight.toFixed(0)}-${maxWeight.toFixed(0)}kg`;
  
  // Update difference display
  const diffElement = document.getElementById('iw-diff-value');
  const diffPercentElement = document.getElementById('iw-diff-percent');
  
  if (Math.abs(diffKg) < 0.1) {
    diffElement.innerHTML = 'At ideal!';
    diffElement.style.color = '#39ff14';
    diffPercentElement.textContent = '';
  } else {
    const direction = diffKg > 0 ? '+' : '';
    diffElement.innerHTML = `${direction}${diffKg.toFixed(1)}kg`;
    diffElement.style.color = diffKg > 0 ? '#ffcc00' : '#2dd4ff';
    diffPercentElement.textContent = `(${diffPercent.toFixed(1)}%)`;
  }
  
  // Update formula results
  document.getElementById('iw-devine').textContent = devineWeight.toFixed(1) + ' kg';
  document.getElementById('iw-robinson').textContent = robinsonWeight.toFixed(1) + ' kg';
  document.getElementById('iw-miller').textContent = millerWeight.toFixed(1) + ' kg';
  document.getElementById('iw-hamwi').textContent = hamwiWeight.toFixed(1) + ' kg';
  
  // Update BMI marker position (0% at 16, 100% at 40)
  const bmiMarker = document.getElementById('iw-bmi-marker');
  const bmiPosition = ((bmi - 16) / 24) * 100; // 16-40 range = 24 points
  bmiMarker.style.left = Math.min(100, Math.max(0, bmiPosition)) + '%';
  
  // Update BMI category
  document.getElementById('iw-bmi-category').textContent = bmiCategory;
  document.getElementById('iw-bmi-category').style.color = bmiColor;
  
  // Generate personalized recommendation
  iwGenerateRecommendation(bmiCategory, diffKg, averageIdeal);
  
  // Update weekly goal
  iwUpdateWeeklyGoal();
  
  // Save calculation
  iwProfile.lastCalculation = {
    bmi: bmi,
    idealWeight: averageIdeal,
    healthyRange: { min: minWeight, max: maxWeight },
    timestamp: new Date().toISOString()
  };
  
  // Save profile
  iwSaveProfile();
}

// Generate personalized recommendation
function iwGenerateRecommendation(bmiCategory, diffKg, idealWeight) {
  const tipElement = document.getElementById('iw-recommendation');
  let recommendation = '';
  
  if (bmiCategory === 'Underweight') {
    recommendation = 'Focus on nutrient-dense foods and strength training to build healthy muscle mass. Aim for gradual weight gain of 0.25-0.5kg per week.';
  } else if (bmiCategory === 'Healthy Weight') {
    if (Math.abs(diffKg) < 2) {
      recommendation = 'Maintain your healthy weight by combining regular exercise with a balanced diet rich in vegetables and lean proteins.';
    } else if (diffKg > 0) {
      recommendation = 'Consider losing a few kilograms through increased physical activity and portion control to optimize your health.';
    } else {
      recommendation = 'You could gain a few kilograms through strength training and increased protein intake for optimal health.';
    }
  } else if (bmiCategory === 'Overweight') {
    recommendation = 'Aim for gradual weight loss of 0.5-1kg per week through calorie deficit and regular exercise. Small, consistent changes work best.';
  } else {
    recommendation = 'Consult with a healthcare professional about a structured weight loss plan. Focus on sustainable lifestyle changes for long-term health.';
  }
  
  tipElement.querySelector('span:nth-child(2)').textContent = recommendation;
}

// Update weekly goal
function iwUpdateWeeklyGoal() {
  const targetWeight = parseFloat(document.getElementById('iw-target-weight').value) || 0;
  const currentWeightKg = iwProfile.currentWeight;
  
  if (iwProfile.weightUnit === 'lb') {
    // Convert target to kg if needed
    targetWeight = targetWeight * 0.453592;
  }
  
  if (targetWeight > 0) {
    const difference = currentWeightKg - targetWeight;
    const weeks = Math.abs(difference) / 0.5; // Assuming 0.5kg per week is safe
    
    let goalText;
    if (Math.abs(difference) < 0.5) {
      goalText = 'Maintain';
    } else if (difference > 0) {
      goalText = `Lose ${(difference / weeks).toFixed(1)} kg/week`;
    } else {
      goalText = `Gain ${(Math.abs(difference) / weeks).toFixed(1)} kg/week`;
    }
    
    document.getElementById('iw-weekly-goal').textContent = goalText;
  }
}

// Set weight goal
function iwSetGoal() {
  const targetWeight = document.getElementById('iw-target-weight').value;
  if (targetWeight && targetWeight > 0) {
    iwProfile.targetWeight = parseFloat(targetWeight);
    iwSaveProfile();
    
    // Visual feedback
    const goalBtn = document.querySelector('[onclick="iwSetGoal()"]');
    const originalText = goalBtn.textContent;
    goalBtn.textContent = '‚úÖ Goal Set!';
    goalBtn.style.background = 'linear-gradient(135deg, rgba(57,255,20,0.3), rgba(57,255,20,0.2))';
    
    setTimeout(() => {
      goalBtn.textContent = originalText;
      goalBtn.style.background = '';
    }, 1500);
    
    iwUpdateWeeklyGoal();
  }
}

// Show new health tip
function iwNewTip() {
  const tipElement = document.getElementById('iw-recommendation');
  
  // Get random tip that's not the current one
  let newTip;
  const currentTip = tipElement.querySelector('span:nth-child(2)').textContent;
  do {
    newTip = iwHealthTips[Math.floor(Math.random() * iwHealthTips.length)];
  } while (newTip === currentTip && iwHealthTips.length > 1);
  
  tipElement.querySelector('span:nth-child(2)').textContent = newTip;
  
  // Visual feedback
  tipElement.style.opacity = '0.5';
  setTimeout(() => {
    tipElement.style.opacity = '1';
    tipElement.style.transition = 'opacity 0.3s';
  }, 10);
}

// Share results
function iwShareResults() {
  const bmi = document.getElementById('iw-bmi-value').textContent;
  const category = document.getElementById('iw-bmi-category').textContent;
  const range = document.getElementById('idealweight-range').textContent;
  
  const shareText = `‚öñÔ∏è My BMI is ${bmi} (${category}) with ideal weight range of ${range}. Calculate yours at The Most Useful Site in the World!`;
  
  // Try Web Share API first
  if (navigator.share) {
    navigator.share({
      title: 'My Weight Analysis',
      text: shareText,
      url: window.location.href
    }).catch(err => {
      console.log('Share cancelled:', err);
      // Fallback to clipboard
      navigator.clipboard.writeText(shareText).then(() => {
        alert('Results copied to clipboard! üìã');
      });
    });
  } else {
    // Fallback to clipboard
    navigator.clipboard.writeText(shareText).then(() => {
      alert('Results copied to clipboard! üìã Share your health journey!');
    });
  }
}

// Save profile
function iwSaveProfile() {
  localStorage.setItem('iwProfile', JSON.stringify(iwProfile));
}

// Reset form
function idealweightReset(btn) {
  if (confirm("Reset all values to defaults?")) {
    iwSetGender('male');
    document.getElementById('idealweight-age').value = 30;
    document.getElementById('idealweight-height').value = 175;
    document.getElementById('idealweight-current').value = 70;
    iwSetFrame('medium');
    iwSetUnit('cm');
    iwSetWeightUnit('kg');
    document.getElementById('iw-target-weight').value = 75;
    
    idealweightCalc();
  }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', iwInit);
} else {
  iwInit();
}
</script>

<style>
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

#idealweight-title {
  position: relative;
  overflow: hidden;
}

#idealweight-title::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 25%;
  width: 50%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  border-radius: 2px;
}

/* BMI progress bar gradient */
#iw-bmi-marker {
  transition: left 0.5s ease;
}

/* Button hover effects */
button {
  transition: all 0.2s ease;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Input focus effects */
input:focus, select:focus {
  outline: none;
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px rgba(45,212,255,0.2);
}

@media (max-width: 768px) {
  .row {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
  
  .results-grid {
    grid-template-columns: 1fr !important;
  }
  
  .formula-grid {
    grid-template-columns: 1fr !important;
  }
  
  /* Make BMI visualization responsive */
  #iw-bmi-marker {
    width: 10px;
    height: 24px;
  }
}
</style>
