<h2 id="physics-tools-title" style="margin-top:0;">Physics Tools</h2>

<form aria-describedby="physics-tools-desc">
  <p id="physics-tools-desc" class="small">Calculate basic physics quantities. Choose a tool, enter values, and get results with formulas.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="phys-tool">Tool</label>
      <select id="phys-tool" style="width:100%;">
        <option value="force" selected>Force (F = mÂ·a)</option>
        <option value="work">Work (W = FÂ·d)</option>
        <option value="power">Power (P = W/t)</option>
        <option value="kinetic">Kinetic Energy (KE = Â½mvÂ²)</option>
        <option value="potential">Potential Energy (PE = mgh)</option>
        <option value="momentum">Momentum (p = mv)</option>
      </select>
    </div>

    <div class="field">
      <label for="phys-values">Values</label>
      <input id="phys-values" type="text" placeholder="e.g. m=10,a=2" style="width:100%;" />
    </div>

    <div class="field">
      <label for="phys-show-steps">Show steps</label>
      <select id="phys-show-steps" style="width:100%;">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="physCalculate()">Calculate</button>
    <button type="button" class="secondary" onclick="physReset()">Reset</button>
    <button type="button" onclick="physCopy()">Copy Result</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Results</h3>
  <textarea id="phys-output" rows="10" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>

  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div id="phys-hint" class="small" style="opacity:0.9;"></div>
  </div>
</div>

<style>
/* Physics Tools specific styles */
#physics-tools-title {
  color: var(--accent);
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

#physics-tools-desc {
  color: rgba(230, 250, 255, 0.7);
  margin-bottom: 1rem;
  line-height: 1.4;
}

.phys-tool-info {
  background: rgba(66, 153, 225, 0.1);
  border: 1px solid rgba(66, 153, 225, 0.3);
  border-radius: 6px;
  padding: 8px 12px;
  margin: 12px 0;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: #4299e1;
  font-size: 0.9rem;
  text-align: center;
}

.phys-quick-examples {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  margin: 16px 0;
}

.phys-example {
  background: rgba(66, 153, 225, 0.05);
  border: 1px solid rgba(66, 153, 225, 0.2);
  border-radius: 6px;
  padding: 8px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.phys-example:hover {
  background: rgba(66, 153, 225, 0.1);
  border-color: rgba(66, 153, 225, 0.4);
  transform: translateY(-1px);
}

.phys-example-icon {
  font-size: 1rem;
}

.phys-result-display {
  background: rgba(66, 153, 225, 0.05);
  border: 1px solid rgba(66, 153, 225, 0.2);
  border-radius: 8px;
  padding: 16px;
  margin: 12px 0;
  text-align: center;
}

.phys-result-value {
  font-size: 2rem;
  font-weight: 700;
  color: #4299e1;
  font-family: 'Courier New', monospace;
  margin: 8px 0;
}

.phys-result-unit {
  font-size: 0.9rem;
  color: rgba(230, 250, 255, 0.7);
  margin-top: 4px;
}

.phys-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 12px 0;
  padding: 8px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 6px;
}

.phys-toggle input[type="checkbox"] {
  margin: 0;
  cursor: pointer;
}

.phys-toggle-label {
  font-size: 0.9rem;
  color: rgba(230, 250, 255, 0.9);
  cursor: pointer;
}

@keyframes phys-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.phys-pulse {
  animation: phys-pulse 0.3s ease;
}
</style>

<script>
/* physics-tools.html - Enhanced Version
   - Calculates basic physics quantities
   - Scoped with phys- prefix
   - Enhanced with visual feedback and examples
*/

// Tool configurations
const physTools = {
  force: {
    name: 'Force',
    formula: 'F = mÂ·a',
    unit: 'N',
    example: 'm=5,a=9.8',
    calculate: (vals) => {
      const m = vals.m;
      const a = vals.a;
      if (m && a) return m * a;
      return null;
    },
    steps: (vals, result) => [
      `Given: mass (m) = ${vals.m} kg, acceleration (a) = ${vals.a} m/sÂ²`,
      `Formula: F = m Ã— a`,
      `Calculation: F = ${vals.m} Ã— ${vals.a}`,
      `Result: F = ${result} N`
    ]
  },
  work: {
    name: 'Work',
    formula: 'W = FÂ·d',
    unit: 'J',
    example: 'F=50,d=10',
    calculate: (vals) => {
      const F = vals.F;
      const d = vals.d;
      if (F && d) return F * d;
      return null;
    },
    steps: (vals, result) => [
      `Given: force (F) = ${vals.F} N, distance (d) = ${vals.d} m`,
      `Formula: W = F Ã— d`,
      `Calculation: W = ${vals.F} Ã— ${vals.d}`,
      `Result: W = ${result} J`
    ]
  },
  power: {
    name: 'Power',
    formula: 'P = W/t',
    unit: 'W',
    example: 'W=500,t=10',
    calculate: (vals) => {
      const W = vals.W;
      const t = vals.t;
      if (W && t) return W / t;
      return null;
    },
    steps: (vals, result) => [
      `Given: work (W) = ${vals.W} J, time (t) = ${vals.t} s`,
      `Formula: P = W Ã· t`,
      `Calculation: P = ${vals.W} Ã· ${vals.t}`,
      `Result: P = ${result} W`
    ]
  },
  kinetic: {
    name: 'Kinetic Energy',
    formula: 'KE = Â½mvÂ²',
    unit: 'J',
    example: 'm=1000,v=20',
    calculate: (vals) => {
      const m = vals.m;
      const v = vals.v;
      if (m && v) return 0.5 * m * v * v;
      return null;
    },
    steps: (vals, result) => [
      `Given: mass (m) = ${vals.m} kg, velocity (v) = ${vals.v} m/s`,
      `Formula: KE = Â½ Ã— m Ã— vÂ²`,
      `Calculation: KE = 0.5 Ã— ${vals.m} Ã— (${vals.v})Â²`,
      `Result: KE = ${result} J`
    ]
  },
  potential: {
    name: 'Potential Energy',
    formula: 'PE = mgh',
    unit: 'J',
    example: 'm=10,g=9.8,h=50',
    calculate: (vals) => {
      const m = vals.m;
      const g = vals.g || 9.8;
      const h = vals.h;
      if (m && h) return m * g * h;
      return null;
    },
    steps: (vals, result) => {
      const g = vals.g || 9.8;
      return [
        `Given: mass (m) = ${vals.m} kg, gravity (g) = ${g} m/sÂ², height (h) = ${vals.h} m`,
        `Formula: PE = m Ã— g Ã— h`,
        `Calculation: PE = ${vals.m} Ã— ${g} Ã— ${vals.h}`,
        `Result: PE = ${result} J`
      ];
    }
  },
  momentum: {
    name: 'Momentum',
    formula: 'p = mv',
    unit: 'kgÂ·m/s',
    example: 'm=5,v=10',
    calculate: (vals) => {
      const m = vals.m;
      const v = vals.v;
      if (m && v) return m * v;
      return null;
    },
    steps: (vals, result) => [
      `Given: mass (m) = ${vals.m} kg, velocity (v) = ${vals.v} m/s`,
      `Formula: p = m Ã— v`,
      `Calculation: p = ${vals.m} Ã— ${vals.v}`,
      `Result: p = ${result} kgÂ·m/s`
    ]
  }
};

// Initialize
function physInit() {
  // Update placeholder when tool changes
  document.getElementById('phys-tool').addEventListener('change', function() {
    const tool = physTools[this.value];
    document.getElementById('phys-values').placeholder = `e.g. ${tool.example}`;
    updateToolInfo();
  });
  
  // Set up Enter key
  document.getElementById('phys-values').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      physCalculate();
    }
  });
  
  // Add quick examples
  addQuickExamples();
  
  // Add toggle for steps
  addStepsToggle();
  
  // Initial update
  updateToolInfo();
}

// Add quick examples
function addQuickExamples() {
  const examplesContainer = document.createElement('div');
  examplesContainer.className = 'phys-quick-examples';
  
  const examples = [
    { tool: 'force', icon: 'ðŸ”º', text: 'Force: m=5, a=9.8' },
    { tool: 'kinetic', icon: 'ðŸš€', text: 'KE: m=1000, v=20' },
    { tool: 'potential', icon: 'â›°ï¸', text: 'PE: m=10, h=50' },
    { tool: 'work', icon: 'âš¡', text: 'Work: F=50, d=10' }
  ];
  
  examples.forEach(example => {
    const exampleEl = document.createElement('div');
    exampleEl.className = 'phys-example';
    exampleEl.innerHTML = `
      <span class="phys-example-icon">${example.icon}</span>
      <span>${example.text}</span>
    `;
    exampleEl.onclick = () => physLoadExample(example.tool);
    examplesContainer.appendChild(exampleEl);
  });
  
  // Insert after the form
  const form = document.querySelector('form');
  form.parentNode.insertBefore(examplesContainer, form.nextSibling);
}

// Add steps toggle
function addStepsToggle() {
  const toggleContainer = document.createElement('div');
  toggleContainer.className = 'phys-toggle';
  toggleContainer.innerHTML = `
    <input type="checkbox" id="phys-show-steps-toggle" checked>
    <label for="phys-show-steps-toggle" class="phys-toggle-label">Show calculation steps</label>
  `;
  
  const toggle = toggleContainer.querySelector('input');
  toggle.addEventListener('change', function() {
    document.getElementById('phys-show-steps').value = this.checked ? 'yes' : 'no';
  });
  
  // Replace the select with toggle
  const selectField = document.querySelector('[for="phys-show-steps"]').parentNode;
  selectField.parentNode.replaceChild(toggleContainer, selectField);
}

// Update tool info display
function updateToolInfo() {
  let infoDisplay = document.querySelector('.phys-tool-info');
  
  if (!infoDisplay) {
    infoDisplay = document.createElement('div');
    infoDisplay.className = 'phys-tool-info';
    const examplesContainer = document.querySelector('.phys-quick-examples');
    examplesContainer.parentNode.insertBefore(infoDisplay, examplesContainer);
  }
  
  const tool = physTools[document.getElementById('phys-tool').value];
  infoDisplay.textContent = `Formula: ${tool.formula} | Unit: ${tool.unit}`;
}

// Load example
function physLoadExample(toolId) {
  const tool = physTools[toolId];
  document.getElementById('phys-tool').value = toolId;
  document.getElementById('phys-values').value = tool.example;
  updateToolInfo();
  physShowHint('Example loaded. Click Calculate.', 'info');
  document.getElementById('phys-values').focus();
}

// Parse values string
function parsePhys(str) {
  const vals = {};
  str.split(',').forEach(p => {
    const [k, v] = p.split('=');
    if (k && v) vals[k.trim()] = parseFloat(v);
  });
  return vals;
}

// Calculate
function physCalculate() {
  const toolId = document.getElementById('phys-tool').value;
  const tool = physTools[toolId];
  const valuesStr = document.getElementById('phys-values').value;
  const showSteps = document.getElementById('phys-show-steps').value === 'yes';
  
  // Parse values
  const vals = parsePhys(valuesStr);
  
  // Calculate
  const result = tool.calculate(vals);
  
  if (result === null) {
    physShowHint('Please provide correct values', 'error');
    return;
  }
  
  // Generate output
  let output = `=== ${tool.name} Calculation ===\n\n`;
  output += `Formula: ${tool.formula}\n\n`;
  
  output += 'Input Values:\n';
  Object.entries(vals).forEach(([key, value]) => {
    output += `${key} = ${value}\n`;
  });
  
  output += `\nResult: ${result.toFixed(3)} ${tool.unit}\n`;
  
  if (showSteps) {
    output += '\nCalculation Steps:\n';
    const steps = tool.steps(vals, result.toFixed(3));
    steps.forEach(step => {
      output += `â€¢ ${step}\n`;
    });
  }
  
  // Additional info
  output += '\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
  output += physGetAdditionalInfo(toolId, result);
  
  // Update output
  document.getElementById('phys-output').value = output;
  
  // Add result display
  addResultDisplay(tool.name, result, tool.unit);
  
  // Show success hint
  physShowHint('Calculation complete!', 'success');
}

// Add result display
function addResultDisplay(name, result, unit) {
  let resultDisplay = document.querySelector('.phys-result-display');
  
  if (!resultDisplay) {
    resultDisplay = document.createElement('div');
    resultDisplay.className = 'phys-result-display';
    const output = document.getElementById('phys-output');
    output.parentNode.insertBefore(resultDisplay, output);
  }
  
  resultDisplay.innerHTML = `
    <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:4px;">${name}</div>
    <div class="phys-result-value phys-pulse">${result.toFixed(3)}</div>
    <div class="phys-result-unit">${unit}</div>
  `;
  
  // Remove pulse animation after it completes
  setTimeout(() => {
    const valueEl = resultDisplay.querySelector('.phys-result-value');
    if (valueEl) valueEl.classList.remove('phys-pulse');
  }, 300);
}

// Get additional info
function physGetAdditionalInfo(toolId, result) {
  const info = {
    force: `Force needed to accelerate ${result.toFixed(3)} N â‰ˆ ${(result / 9.81).toFixed(3)} kg-weight`,
    work: `Work done: ${result.toFixed(3)} J â‰ˆ ${(result / 4184).toFixed(5)} dietary calories`,
    power: `Power: ${result.toFixed(3)} W â‰ˆ ${(result / 745.7).toFixed(5)} horsepower`,
    kinetic: `Kinetic energy: Could lift ${(result / 9.81).toFixed(3)} kg by 1 m`,
    potential: `Potential energy stored at height`,
    momentum: `Momentum: ${result.toFixed(3)} kgÂ·m/s`
  };
  return info[toolId] || '';
}

// Copy result
function physCopy() {
  const output = document.getElementById('phys-output').value;
  if (!output.trim()) {
    physShowHint('No results to copy', 'error');
    return;
  }
  
  navigator.clipboard?.writeText(output).then(() => {
    physShowHint('Results copied to clipboard!', 'success');
  }).catch(() => {
    physShowHint('Failed to copy', 'error');
  });
}

// Reset
function physReset() {
  if (confirm('Reset all inputs and results?')) {
    document.getElementById('phys-values').value = '';
    document.getElementById('phys-show-steps-toggle').checked = true;
    document.getElementById('phys-show-steps').value = 'yes';
    document.getElementById('phys-output').value = '';
    physShowHint('All inputs cleared', 'info');
    
    // Remove result display
    const resultDisplay = document.querySelector('.phys-result-display');
    if (resultDisplay) {
      resultDisplay.remove();
    }
  }
}

// Show hint
function physShowHint(message, type = 'info') {
  const hint = document.getElementById('phys-hint');
  hint.textContent = message;
  hint.style.color = type === 'error' ? '#ff6b6b' : 
                     type === 'success' ? '#4ecdc4' : 
                     'rgba(230, 250, 255, 0.7)';
  
  if (type !== 'error') {
    setTimeout(() => {
      hint.textContent = '';
    }, 2000);
  }
}

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', physInit);
} else {
  physInit();
}
</script>
