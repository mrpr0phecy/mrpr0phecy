<h2 id="translation-helper-title">üåç Translation Helper</h2>

<form aria-describedby="translation-helper-desc">
  <p id="translation-helper-desc" class="small">
    Translate text between languages with style and tone analysis.
    <span style="color:var(--accent)">Includes language detection and clarity checking!</span>
  </p>
  
  <!-- Language Selection -->
  <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:end;margin-bottom:20px;">
    <!-- Source Language -->
    <div>
      <label for="th-source" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        From Language
      </label>
      <div style="position:relative;">
        <select id="th-source" 
                style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
          <option value="auto" selected>Auto-detect</option>
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="pt">Portuguese</option>
          <option value="ru">Russian</option>
          <option value="zh">Chinese</option>
          <option value="ja">Japanese</option>
          <option value="ko">Korean</option>
          <option value="ar">Arabic</option>
          <option value="hi">Hindi</option>
        </select>
        <button type="button" onclick="thDetectLanguage()" 
                style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--accent);cursor:pointer;font-size:12px;padding:4px 8px;">
          üîç Detect
        </button>
      </div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;" id="th-detected-lang">
        Language will be auto-detected
      </div>
    </div>
    
    <!-- Swap Button -->
    <div style="text-align:center;padding-bottom:8px;">
      <button type="button" onclick="thSwapLanguages()" 
              style="background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;padding:10px 14px;font-size:16px;"
              title="Swap languages">
        ‚áÑ
      </button>
    </div>
    
    <!-- Target Language -->
    <div>
      <label for="th-target" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
        To Language
      </label>
      <select id="th-target" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
        <option value="en" selected>English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="ru">Russian</option>
        <option value="zh">Chinese</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="ar">Arabic</option>
        <option value="hi">Hindi</option>
      </select>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">
        Select target language
      </div>
    </div>
  </div>
  
  <!-- Text Input -->
  <div class="field" style="margin-bottom:20px;">
    <label for="th-text" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Text to Translate
    </label>
    <textarea id="th-text" rows="6" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-size:14px;line-height:1.4;"
              placeholder="Enter or paste text to translate..."></textarea>
    <div style="display:flex;justify-content:space-between;margin-top:8px;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">
        <span id="th-char-count">0</span> characters ‚Ä¢ <span id="th-word-count">0</span> words
      </div>
      <div style="font-size:12px;color:rgba(230,250,255,0.7);">
        <button type="button" onclick="thClearText()" style="background:transparent;border:none;color:#ff4d4d;cursor:pointer;font-size:12px;">
          Clear text
        </button>
      </div>
    </div>
  </div>
  
  <!-- Translation Settings -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">‚öôÔ∏è Translation Settings</div>
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
      <div>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;">
          <input id="th-preserve-formatting" type="checkbox" checked style="width:16px;height:16px;" />
          <span>Preserve formatting</span>
        </label>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-top:2px;">
          Keep line breaks and structure
        </div>
      </div>
      <div>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;">
          <input id="th-include-notes" type="checkbox" checked style="width:16px;height:16px;" />
          <span>Include style notes</span>
        </label>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);margin-top:2px;">
          Add translation insights
        </div>
      </div>
    </div>
  </div>
  
  <!-- Quick Phrases -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üí¨ Quick Phrases</div>
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
      <button type="button" onclick="thLoadPhrase('greeting')" 
              style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">Greeting</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">"Hello, how are you today?"</div>
      </button>
      <button type="button" onclick="thLoadPhrase('business')" 
              style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">Business Email</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">"I'm following up on our meeting..."</div>
      </button>
      <button type="button" onclick="thLoadPhrase('technical')" 
              style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">Technical Term</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">"Please restart the application"</div>
      </button>
      <button type="button" onclick="thLoadPhrase('travel')" 
              style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
        <div style="font-weight:500;">Travel Phrase</div>
        <div style="font-size:11px;color:rgba(230,250,255,0.7);">"Where is the nearest station?"</div>
      </button>
    </div>
  </div>
  
  <!-- Actions -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="thTranslate()" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ‚ú® Translate Text
    </button>
    <button type="button" onclick="thCopyTranslation()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      üìã Copy
    </button>
    <button type="button" onclick="thReset()"
            style="padding:12px 16px;background:rgba(255,77,77,0.1);border:1px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;">
      üîÑ Reset
    </button>
  </div>
</form>

<!-- Results -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üåê Translation Result</h3>
  
  <!-- Translation Output -->
  <div style="position:relative;margin-bottom:16px;">
    <textarea id="th-output" rows="8" 
              style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(0,0,0,0.2);color:inherit;font-size:14px;line-height:1.4;"
              placeholder="Translation will appear here..." readonly></textarea>
    <button type="button" onclick="thCopyOutput()" 
            style="position:absolute;right:12px;bottom:12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;padding:6px 10px;font-size:12px;">
      Copy
    </button>
  </div>
  
  <!-- Translation Stats -->
  <div id="th-stats" style="display:none;margin-bottom:16px;">
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
      <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);text-align:center;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Characters</div>
        <div id="th-output-chars" style="font-weight:600;font-size:18px;color:#2dd4ff;">‚Äì</div>
      </div>
      <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.2);text-align:center;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Words</div>
        <div id="th-output-words" style="font-weight:600;font-size:18px;color:#39ff14;">‚Äì</div>
      </div>
      <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.2);text-align:center;">
        <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Reading Time</div>
        <div id="th-reading-time" style="font-weight:600;font-size:18px;color:#ffcc00;">‚Äì</div>
      </div>
    </div>
  </div>
  
  <!-- Style Notes -->
  <div id="th-notes-container" style="display:none;">
    <h3 class="small" style="color:var(--accent);margin-bottom:8px;">üìù Style & Clarity Notes</h3>
    <div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
      <div id="th-notes" style="font-size:14px;line-height:1.5;color:rgba(230,250,255,0.9);">
        Style notes will appear here...
      </div>
    </div>
  </div>
  
  <!-- Language Tips -->
  <div style="margin-top:16px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">üí° Translation Tips</div>
    <ul style="list-style:disc;padding-left:20px;margin:0;font-size:13px;color:rgba(230,250,255,0.8);line-height:1.5;">
      <li>For best results, keep sentences clear and concise</li>
      <li>Technical terms may need manual verification</li>
      <li>Consider cultural context for idiomatic expressions</li>
      <li>Formal vs informal tone can affect translation accuracy</li>
      <li>Review translations for proper grammar and flow</li>
    </ul>
    <div style="margin-top:12px;padding:10px;background:rgba(255,204,0,0.1);border-radius:6px;border:1px solid rgba(255,204,0,0.3);">
      <span style="color:#ffcc00;font-weight:500;">Note:</span>
      <span style="font-size:12px;"> This is a demonstration tool. For production use, integrate with a translation API like Google Translate, DeepL, or Microsoft Translator.</span>
    </div>
  </div>
</div>

<script>
/* translation-helper.html
   - Translation helper with language detection and style analysis
   - Scoped with th- prefix (Translation Helper)
*/

// Language names mapping
const thLanguageNames = {
    'auto': 'Auto-detect',
    'en': 'English',
    'es': 'Spanish',
    'fr': 'French',
    'de': 'German',
    'it': 'Italian',
    'pt': 'Portuguese',
    'ru': 'Russian',
    'zh': 'Chinese',
    'ja': 'Japanese',
    'ko': 'Korean',
    'ar': 'Arabic',
    'hi': 'Hindi'
};

// Sample translations for demonstration
const thSampleTranslations = {
    'en-es': 'Hola, ¬øc√≥mo est√°s hoy?',
    'en-fr': 'Bonjour, comment allez-vous aujourd\'hui ?',
    'en-de': 'Hallo, wie geht es dir heute?',
    'en-it': 'Ciao, come stai oggi?',
    'en-zh': '‰Ω†Â•ΩÔºå‰ªäÂ§©ËøáÂæóÊÄé‰πàÊ†∑Ôºü',
    'en-ja': '„Åì„Çì„Å´„Å°„ÅØ„ÄÅ‰ªäÊó•„ÅØ„Å©„ÅÜ„Åß„Åô„ÅãÔºü',
    'es-en': 'Hello, how are you today?',
    'fr-en': 'Hello, how are you today?',
    'de-en': 'Hello, how are you today?',
    'it-en': 'Hello, how are you today?',
    'zh-en': 'Hello, how are you today?',
    'ja-en': 'Hello, how are you today?'
};

// Initialize on load
function thInitialize() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Cache elements
    window.thElements = {
        source: card.querySelector('#th-source'),
        target: card.querySelector('#th-target'),
        text: card.querySelector('#th-text'),
        output: card.querySelector('#th-output'),
        charCount: card.querySelector('#th-char-count'),
        wordCount: card.querySelector('#th-word-count'),
        detectedLang: card.querySelector('#th-detected-lang'),
        stats: card.querySelector('#th-stats'),
        outputChars: card.querySelector('#th-output-chars'),
        outputWords: card.querySelector('#th-output-words'),
        readingTime: card.querySelector('#th-reading-time'),
        notesContainer: card.querySelector('#th-notes-container'),
        notes: card.querySelector('#th-notes'),
        preserveFormatting: card.querySelector('#th-preserve-formatting'),
        includeNotes: card.querySelector('#th-include-notes')
    };
    
    // Load saved settings
    const savedSettings = localStorage.getItem('th-settings');
    if (savedSettings) {
        try {
            const settings = JSON.parse(savedSettings);
            if (settings.source) thElements.source.value = settings.source;
            if (settings.target) thElements.target.value = settings.target;
            if (settings.preserveFormatting !== undefined) thElements.preserveFormatting.checked = settings.preserveFormatting;
            if (settings.includeNotes !== undefined) thElements.includeNotes.checked = settings.includeNotes;
        } catch (e) {
            console.log('No saved settings found');
        }
    }
    
    // Update character/word count
    thElements.text.addEventListener('input', function() {
        thUpdateTextStats();
        thSaveSettings();
    });
    
    // Auto-detect language on text input
    thElements.text.addEventListener('input', thDebounce(thDetectLanguage, 500));
    
    // Save settings on changes
    thElements.source.addEventListener('change', thSaveSettings);
    thElements.target.addEventListener('change', thSaveSettings);
    thElements.preserveFormatting.addEventListener('change', thSaveSettings);
    thElements.includeNotes.addEventListener('change', thSaveSettings);
    
    // Initial stats update
    thUpdateTextStats();
    
    console.log('Translation Helper initialized');
}

// Debounce function for performance
function thDebounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Save settings to localStorage
function thSaveSettings() {
    if (!window.thElements) return;
    
    const settings = {
        source: thElements.source.value,
        target: thElements.target.value,
        preserveFormatting: thElements.preserveFormatting.checked,
        includeNotes: thElements.includeNotes.checked,
        timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('th-settings', JSON.stringify(settings));
}

// Update text statistics
function thUpdateTextStats() {
    if (!window.thElements) return;
    
    const text = thElements.text.value;
    const charCount = text.length;
    const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
    
    thElements.charCount.textContent = charCount;
    thElements.wordCount.textContent = wordCount;
}

// Detect language (simulated)
function thDetectLanguage() {
    if (!window.thElements) return;
    
    const text = thElements.text.value.trim();
    if (!text) {
        thElements.detectedLang.textContent = 'Language will be auto-detected';
        return;
    }
    
    // Simple language detection based on common words
    const enWords = ['the', 'and', 'you', 'that', 'have', 'for', 'not', 'with', 'this', 'but'];
    const esWords = ['el', 'la', 'que', 'y', 'en', 'los', 'del', 'se', 'las', 'por'];
    const frWords = ['le', 'la', 'et', 'les', 'des', 'une', 'dans', 'que', 'est', 'pas'];
    const deWords = ['der', 'die', 'das', 'und', 'in', 'den', 'von', 'zu', 'mit', 'sich'];
    
    let enCount = 0, esCount = 0, frCount = 0, deCount = 0;
    const words = text.toLowerCase().split(/\s+/);
    
    words.forEach(word => {
        if (enWords.includes(word)) enCount++;
        if (esWords.includes(word)) esCount++;
        if (frWords.includes(word)) frCount++;
        if (deWords.includes(word)) deCount++;
    });
    
    let detected = 'en'; // Default to English
    const counts = { en: enCount, es: esCount, fr: frCount, de: deCount };
    const maxCount = Math.max(enCount, esCount, frCount, deCount);
    
    if (maxCount > 0) {
        for (const [lang, count] of Object.entries(counts)) {
            if (count === maxCount) {
                detected = lang;
                break;
            }
        }
    }
    
    thElements.source.value = detected;
    thElements.detectedLang.textContent = `Detected: ${thLanguageNames[detected] || 'Unknown'}`;
    thSaveSettings();
}

// Swap languages
function thSwapLanguages() {
    if (!window.thElements) return;
    
    const source = thElements.source.value;
    const target = thElements.target.value;
    
    // Don't swap if source is auto-detect
    if (source !== 'auto') {
        thElements.source.value = target;
        thElements.target.value = source;
        thSaveSettings();
    }
}

// Clear text
function thClearText() {
    if (!window.thElements) return;
    
    thElements.text.value = '';
    thUpdateTextStats();
    thElements.detectedLang.textContent = 'Language will be auto-detected';
}

// Load sample phrase
function thLoadPhrase(type) {
    if (!window.thElements) return;
    
    const phrases = {
        'greeting': 'Hello, how are you today? I hope you are having a wonderful day.',
        'business': 'Dear team, I am following up on our meeting from yesterday. Please find attached the updated project timeline for your review.',
        'technical': 'To resolve the issue, please restart the application and check if the error persists. If the problem continues, clear the cache and try again.',
        'travel': 'Excuse me, could you tell me where the nearest train station is? I am looking for the quickest way to get to the city center.'
    };
    
    thElements.text.value = phrases[type] || '';
    thUpdateTextStats();
    thDetectLanguage();
}

// Generate translation
function thTranslate() {
    if (!window.thElements) thInitialize();
    
    const source = thElements.source.value;
    const target = thElements.target.value;
    const text = thElements.text.value.trim();
    const includeNotes = thElements.includeNotes.checked;
    
    if (!text) {
        thElements.output.value = 'Please enter text to translate.';
        thElements.stats.style.display = 'none';
        thElements.notesContainer.style.display = 'none';
        return;
    }
    
    // Get language names
    const sourceName = thLanguageNames[source] || 'Unknown';
    const targetName = thLanguageNames[target] || 'Unknown';
    
    // Generate mock translation
    let translation = '';
    if (source === target) {
        translation = text; // Same language, return original
    } else {
        // Look for sample translation
        const key = `${source === 'auto' ? 'en' : source}-${target}`;
        translation = thSampleTranslations[key] || `[${sourceName} ‚Üí ${targetName}]: ${text}`;
    }
    
    // Preserve formatting if enabled
    if (thElements.preserveFormatting.checked) {
        // Preserve line breaks and spacing
        const lines = text.split('\n');
        translation = lines.map(line => line ? translation : '').join('\n');
    }
    
    // Add translation header
    const detectedSource = source === 'auto' ? 'Auto-detected' : sourceName;
    const result = `üåê Translation (${detectedSource} ‚Üí ${targetName})\n${'‚ïê'.repeat(40)}\n\n${translation}`;
    
    thElements.output.value = result;
    
    // Update output stats
    const outCharCount = result.length;
    const outWordCount = result.trim() ? result.trim().split(/\s+/).length : 0;
    const readingTime = Math.ceil(outWordCount / 200); // 200 words per minute
    
    thElements.outputChars.textContent = outCharCount;
    thElements.outputWords.textContent = outWordCount;
    thElements.readingTime.textContent = `${readingTime} min`;
    thElements.stats.style.display = 'grid';
    
    // Generate style notes
    if (includeNotes) {
        const notes = thGenerateStyleNotes(text, source, target, translation);
        thElements.notes.textContent = notes;
        thElements.notesContainer.style.display = 'block';
    } else {
        thElements.notesContainer.style.display = 'none';
    }
    
    thSaveSettings();
}

// Generate style notes
function thGenerateStyleNotes(original, source, target, translation) {
    const sourceName = thLanguageNames[source === 'auto' ? 'en' : source] || 'Source';
    const targetName = thLanguageNames[target] || 'Target';
    
    const notes = [];
    
    // Basic analysis
    const wordCount = original.trim().split(/\s+/).length;
    const sentenceCount = original.split(/[.!?]+/).filter(s => s.trim()).length;
    const avgSentenceLength = sentenceCount > 0 ? (wordCount / sentenceCount).toFixed(1) : 0;
    
    notes.push(`üìä Text Analysis:`);
    notes.push(`  ‚Ä¢ Words: ${wordCount}`);
    notes.push(`  ‚Ä¢ Sentences: ${sentenceCount}`);
    notes.push(`  ‚Ä¢ Avg. sentence length: ${avgSentenceLength} words`);
    notes.push(``);
    
    notes.push(`üéØ Translation Notes:`);
    notes.push(`  ‚Ä¢ Translation: ${sourceName} ‚Üí ${targetName}`);
    
    if (source === target) {
        notes.push(`  ‚Ä¢ Same language selected - text returned unchanged`);
    } else {
        notes.push(`  ‚Ä¢ This is a demonstration translation`);
        notes.push(`  ‚Ä¢ For accurate results, use professional translation services`);
    }
    
    // Style recommendations
    notes.push(``);
    notes.push(`üí° Style Recommendations:`);
    
    if (wordCount > 100) {
        notes.push(`  ‚Ä¢ Consider breaking into shorter paragraphs for better readability`);
    }
    
    if (avgSentenceLength > 25) {
        notes.push(`  ‚Ä¢ Sentences are quite long - consider splitting for clarity`);
    }
    
    notes.push(`  ‚Ä¢ Review cultural context for ${targetName} audience`);
    notes.push(`  ‚Ä¢ Verify technical terms with subject matter experts`);
    
    return notes.join('\n');
}

// Copy output to clipboard
function thCopyOutput() {
    if (!window.thElements) thInitialize();
    
    const output = thElements.output.value;
    if (!output.trim()) return;
    
    navigator.clipboard.writeText(output).then(() => {
        // Visual feedback
        const copyBtn = document.querySelector('button[onclick="thCopyOutput()"]');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.style.background = 'rgba(57,255,20,0.1)';
        copyBtn.style.borderColor = 'rgba(57,255,20,0.3)';
        copyBtn.style.color = '#39ff14';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
            copyBtn.style.borderColor = '';
            copyBtn.style.color = '';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
    });
}

// Copy translation only (without header)
function thCopyTranslation() {
    if (!window.thElements) thInitialize();
    
    const output = thElements.output.value;
    if (!output.trim()) return;
    
    // Extract just the translation part (after the header)
    const lines = output.split('\n');
    const translationStart = lines.findIndex(line => line.includes('‚ïê'));
    const translationText = translationStart >= 0 ? lines.slice(translationStart + 2).join('\n') : output;
    
    navigator.clipboard.writeText(translationText.trim()).then(() => {
        // Visual feedback on main copy button
        const copyBtn = document.querySelector('button[onclick="thCopyTranslation()"]');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.style.background = 'rgba(57,255,20,0.1)';
        copyBtn.style.borderColor = 'rgba(57,255,20,0.3)';
        copyBtn.style.color = '#39ff14';
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '';
            copyBtn.style.borderColor = '';
            copyBtn.style.color = '';
        }, 2000);
    }).catch(err => {
        console.error('Copy failed:', err);
    });
}

// Reset function
function thReset() {
    if (!window.thElements) thInitialize();
    
    thElements.source.value = 'auto';
    thElements.target.value = 'en';
    thElements.text.value = '';
    thElements.output.value = '';
    thElements.preserveFormatting.checked = true;
    thElements.includeNotes.checked = true;
    
    thElements.detectedLang.textContent = 'Language will be auto-detected';
    thElements.stats.style.display = 'none';
    thElements.notesContainer.style.display = 'none';
    
    thUpdateTextStats();
    localStorage.removeItem('th-settings');
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', thInitialize);
} else {
    thInitialize();
}
</script>

<style>
/* Card-specific styles */
#translation-helper-title {
    color: var(--accent);
    margin-top: 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .input-grid {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }
    
    /* Stack language selection on mobile */
    .language-selection {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }
    
    .language-selection > div:nth-child(2) {
        order: 3;
        text-align: center;
    }
    
    /* Adjust button layout for mobile */
    .actions {
        flex-direction: column;
        gap: 8px !important;
    }
    
    .actions button {
        width: 100% !important;
        margin: 0 !important;
        min-height: 48px !important;
    }
    
    /* Make textareas more mobile-friendly */
    textarea {
        font-size: 16px !important;
        min-height: 120px;
    }
    
    /* Stack stats cards on mobile */
    #th-stats > div {
        grid-template-columns: 1fr !important;
        gap: 8px !important;
    }
}

/* Touch-friendly improvements */
button, input[type="button"], input[type="submit"] {
    min-height: 44px;
}

input[type="number"], input[type="text"], textarea, select {
    font-size: 16px; /* Prevent iOS zoom */
}

/* Focus styles for better accessibility */
input:focus, select:focus, button:focus, textarea:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Animation for results */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.results > div {
    animation: fadeIn 0.3s ease-out;
}

/* Smooth transitions */
button, input, select, textarea {
    transition: all 0.2s ease;
}

button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Custom checkbox styling */
input[type="checkbox"] {
    accent-color: var(--accent);
}

/* Textarea styling */
textarea {
    resize: vertical;
    scrollbar-width: thin;
    scrollbar-color: rgba(45,212,255,0.3) transparent;
}

textarea::-webkit-scrollbar {
    width: 8px;
}

textarea::-webkit-scrollbar-track {
    background: transparent;
}

textarea::-webkit-scrollbar-thumb {
    background-color: rgba(45,212,255,0.3);
    border-radius: 4px;
}

/* Language detect button */
#th-detected-lang {
    transition: color 0.3s ease;
}

.detecting {
    color: var(--accent) !important;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

/* Responsive typography */
@media (max-width: 480px) {
    #translation-helper-title {
        font-size: 1.2rem;
    }
    
    .small {
        font-size: 0.85rem;
    }
    
    .field label {
        font-size: 0.9rem;
    }
}
</style>
