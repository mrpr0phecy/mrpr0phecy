<h2 id="targethr-title" style="margin-top:0;color:var(--accent);">‚ù§Ô∏è Target Heart Rate Calculator</h2>

<form aria-describedby="targethr-desc" style="margin-bottom:20px;">
    <p id="targethr-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
        Calculate your optimal heart rate zones for effective exercise training. 
        <span style="color:var(--accent);">Based on American Heart Association guidelines.</span>
    </p>
    
    <!-- AGE INPUT -->
    <div class="field" style="margin-bottom:16px;">
        <label for="targethr-age" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
            Your Age (years)
        </label>
        <div style="display:flex;align-items:center;gap:12px;">
            <input id="targethr-age" type="number" min="10" max="120" value="30" step="1"
                   style="flex:1;padding:12px;border-radius:10px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:16px;" />
            <div style="display:flex;gap:8px;">
                <button type="button" onclick="thrSetAge(-1)" 
                        style="width:36px;height:36px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.1);color:var(--accent);cursor:pointer;font-weight:bold;">-</button>
                <button type="button" onclick="thrSetAge(1)" 
                        style="width:36px;height:36px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.1);color:var(--accent);cursor:pointer;font-weight:bold;">+</button>
            </div>
        </div>
    </div>
    
    <!-- INTENSITY SLIDER -->
    <div class="field" style="margin-bottom:24px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <label for="targethr-intensity" style="color:var(--accent);font-weight:500;">
                Intensity Level
            </label>
            <span id="thr-intensity-value" style="color:var(--accent);font-weight:600;font-size:1.1em;">70%</span>
        </div>
        <input id="targethr-intensity" type="range" min="50" max="95" value="70" step="5"
               style="width:100%;height:8px;-webkit-appearance:none;background:linear-gradient(90deg, #ff2d55, #ffcc00, #39ff14);border-radius:4px;outline:none;" />
        <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:12px;color:rgba(230,250,255,0.7);">
            <span>Warm-up (50%)</span>
            <span>Fat Burning (70%)</span>
            <span>Aerobic (85%)</span>
        </div>
        
        <!-- QUICK INTENSITY BUTTONS -->
        <div style="display:flex;gap:8px;margin-top:12px;">
            <button type="button" onclick="thrSetIntensity(50)" 
                    style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(45,212,255,0.05);color:rgba(45,212,255,0.9);cursor:pointer;font-size:13px;">
                Light (50%)
            </button>
            <button type="button" onclick="thrSetIntensity(70)" 
                    style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--accent);background:rgba(45,212,255,0.15);color:var(--accent);cursor:pointer;font-weight:600;font-size:13px;">
                Moderate (70%)
            </button>
            <button type="button" onclick="thrSetIntensity(85)" 
                    style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(57,255,20,0.3);background:rgba(57,255,20,0.05);color:#39ff14;cursor:pointer;font-size:13px;">
                Vigorous (85%)
            </button>
        </div>
    </div>
    
    <!-- ACTION BUTTONS -->
    <div class="actions" style="margin-top:24px;display:flex;gap:10px;">
        <button type="button" onclick="thrCalculate(this)" 
                style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1));border:1px solid rgba(255,77,77,0.4);border-radius:10px;color:#ff4d4d;cursor:pointer;font-weight:600;font-size:15px;">
            ‚ù§Ô∏è Calculate Heart Rate
        </button>
        <button type="button" onclick="thrReset(this)"
                style="padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:inherit;cursor:pointer;">
            Reset
        </button>
    </div>
</form>

<!-- RESULTS SECTION -->
<div class="results" aria-live="polite" style="margin-top:20px;">
    <h3 class="small" style="color:var(--accent);margin-bottom:12px;font-weight:600;">üìä Your Heart Rate Zones</h3>
    
    <!-- MAIN RESULT CARD -->
    <div id="thr-main-result" style="background:linear-gradient(135deg, rgba(255,77,77,0.1), rgba(255,77,77,0.05));border:1px solid rgba(255,77,77,0.2);border-radius:12px;padding:16px;margin-bottom:16px;text-align:center;">
        <div style="font-size:13px;color:rgba(255,255,255,0.8);margin-bottom:6px;">Target Heart Rate at <span id="thr-current-intensity" style="color:#ffcc00;font-weight:600;">70%</span> intensity</div>
        <div id="thr-target" style="font-size:42px;font-weight:700;color:#ff4d4d;line-height:1;">--</div>
        <div style="font-size:14px;color:rgba(255,255,255,0.7);margin-top:4px;">beats per minute</div>
    </div>
    
    <!-- ZONE GRID -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div style="background:linear-gradient(135deg, rgba(45,212,255,0.08), rgba(45,212,255,0.04));border:1px solid rgba(45,212,255,0.2);border-radius:10px;padding:12px;">
            <div style="font-size:12px;color:rgba(45,212,255,0.9);margin-bottom:4px;">Maximum Heart Rate</div>
            <div id="thr-max" style="font-size:22px;font-weight:600;color:var(--accent);">--</div>
        </div>
        <div style="background:linear-gradient(135deg, rgba(57,255,20,0.08), rgba(57,255,20,0.04));border:1px solid rgba(57,255,20,0.2);border-radius:10px;padding:12px;">
            <div style="font-size:12px;color:rgba(57,255,20,0.9);margin-bottom:4px;">Zone Range</div>
            <div id="thr-zone" style="font-size:22px;font-weight:600;color:#39ff14;">--</div>
        </div>
    </div>
    
    <!-- ZONE DESCRIPTIONS -->
    <div style="margin-top:16px;background:rgba(0,0,0,0.2);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.05);">
        <div style="font-size:13px;color:var(--accent);font-weight:500;margin-bottom:8px;">Exercise Zones:</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;font-size:11px;">
            <div style="text-align:center;padding:6px;background:rgba(255,77,77,0.1);border-radius:6px;border:1px solid rgba(255,77,77,0.2);">
                <div style="color:#ff4d4d;font-weight:600;">50-60%</div>
                <div style="color:rgba(255,255,255,0.7);">Warm-up</div>
            </div>
            <div style="text-align:center;padding:6px;background:rgba(255,204,0,0.1);border-radius:6px;border:1px solid rgba(255,204,0,0.2);">
                <div style="color:#ffcc00;font-weight:600;">60-70%</div>
                <div style="color:rgba(255,255,255,0.7);">Fat Burn</div>
            </div>
            <div style="text-align:center;padding:6px;background:rgba(57,255,20,0.1);border-radius:6px;border:1px solid rgba(57,255,20,0.2);">
                <div style="color:#39ff14;font-weight:600;">70-85%</div>
                <div style="color:rgba(255,255,255,0.7);">Aerobic</div>
            </div>
        </div>
    </div>
</div>

<!-- EDUCATIONAL COLLAPSE -->
<details style="margin-top:20px;border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:12px;background:rgba(0,0,0,0.15);">
    <summary style="color:var(--accent);font-weight:600;cursor:pointer;outline:none;user-select:none;">üìö How This Calculator Works</summary>
    <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05);">
        <p style="margin-bottom:10px;color:rgba(230,250,255,0.9);font-size:14px;line-height:1.5;">
            <strong style="color:var(--accent);">Formula:</strong> Maximum Heart Rate (MHR) = 220 - Age<br>
            <strong style="color:#39ff14;">Target Zone:</strong> MHR √ó (Intensity √∑ 100)
        </p>
        
        <div style="background:rgba(45,212,255,0.05);border-radius:8px;padding:12px;margin:12px 0;border-left:3px solid var(--accent);">
            <strong style="color:var(--accent);">Example for age 30:</strong><br>
            ‚Ä¢ MHR = 220 - 30 = 190 bpm<br>
            ‚Ä¢ 70% intensity = 190 √ó 0.7 = 133 bpm<br>
            ‚Ä¢ Safe zone = 50-85% = 95-162 bpm
        </div>
        
        <p style="color:rgba(230,250,255,0.8);font-size:13px;line-height:1.5;">
            <span style="color:#ffcc00;">‚ö†Ô∏è Note:</span> This formula provides estimates. 
            Consult a healthcare professional for personalized exercise recommendations.
        </p>
    </div>
</details>

<!-- SCRIPT -->
<script>
/* targethr.html - Target Heart Rate Calculator
   - Prefix: thr
   - Calculates heart rate zones for exercise
   - Includes interactive sliders and visual feedback
*/

// Update intensity display when slider changes
function thrUpdateIntensityDisplay() {
    const card = document.currentScript?.closest('.card') || document;
    const intensityInput = card.querySelector('#targethr-intensity');
    const display = card.querySelector('#thr-intensity-value');
    if (intensityInput && display) {
        const value = intensityInput.value;
        display.textContent = value + '%';
        
        // Update current intensity in results
        const currentIntensity = card.querySelector('#thr-current-intensity');
        if (currentIntensity) {
            currentIntensity.textContent = value + '%';
        }
        
        // Auto-calculate if values exist
        const age = card.querySelector('#targethr-age').value;
        if (age && age > 0) {
            thrCalculate();
        }
    }
}

// Set intensity with quick buttons
function thrSetIntensity(percent) {
    const card = document.currentScript?.closest('.card') || document;
    const intensityInput = card.querySelector('#targethr-intensity');
    if (intensityInput) {
        intensityInput.value = percent;
        thrUpdateIntensityDisplay();
    }
}

// Adjust age with +/- buttons
function thrSetAge(delta) {
    const card = document.currentScript?.closest('.card') || document;
    const ageInput = card.querySelector('#targethr-age');
    if (ageInput) {
        let age = parseInt(ageInput.value) || 30;
        age += delta;
        age = Math.max(10, Math.min(120, age));
        ageInput.value = age;
        
        // Auto-calculate if intensity is set
        const intensity = card.querySelector('#targethr-intensity').value;
        if (intensity) {
            thrCalculate();
        }
    }
}

// Main calculation function
function thrCalculate(btn = null) {
    const card = btn ? btn.closest('.card') : (document.currentScript?.closest('.card') || document);
    
    try {
        // Get values with validation
        const age = parseInt(card.querySelector('#targethr-age').value);
        const intensity = parseFloat(card.querySelector('#targethr-intensity').value);
        
        // Validate inputs
        if (!age || age < 10 || age > 120) {
            throw new Error('Please enter a valid age between 10 and 120 years.');
        }
        
        if (intensity < 50 || intensity > 95) {
            throw new Error('Intensity must be between 50% and 95%.');
        }
        
        // Calculate
        const maxHR = 220 - age;
        const target = Math.round(maxHR * (intensity / 100));
        const zoneLow = Math.round(maxHR * 0.5);
        const zoneHigh = Math.round(maxHR * 0.85);
        
        // Update displays
        card.querySelector('#thr-target').textContent = target;
        card.querySelector('#thr-max').textContent = maxHR + ' bpm';
        card.querySelector('#thr-zone').textContent = zoneLow + '-' + zoneHigh + ' bpm';
        
        // Visual feedback
        const mainResult = card.querySelector('#thr-main-result');
        if (mainResult) {
            mainResult.style.animation = 'pulse 0.5s ease';
            setTimeout(() => {
                mainResult.style.animation = '';
            }, 500);
        }
        
        console.log(`Heart Rate Calc: Age=${age}, Intensity=${intensity}%, Target=${target}bpm`);
        
    } catch (error) {
        // Show error to user
        const targetDisplay = card.querySelector('#thr-target');
        if (targetDisplay) {
            targetDisplay.textContent = 'Error';
            targetDisplay.style.color = '#ff2d55';
        }
        
        // Show error in console
        console.error('Heart Rate Calculator Error:', error.message);
        
        // Optional: Show alert for user
        if (btn) {
            alert('Error: ' + error.message);
        }
    }
}

// Reset function
function thrReset(btn) {
    const card = btn.closest('.card') || document;
    
    // Reset inputs
    card.querySelector('#targethr-age').value = 30;
    card.querySelector('#targethr-intensity').value = 70;
    
    // Reset displays
    card.querySelector('#thr-target').textContent = '--';
    card.querySelector('#thr-target').style.color = '#ff4d4d';
    card.querySelector('#thr-max').textContent = '--';
    card.querySelector('#thr-zone').textContent = '--';
    card.querySelector('#thr-intensity-value').textContent = '70%';
    card.querySelector('#thr-current-intensity').textContent = '70%';
    
    console.log('Heart Rate Calculator reset');
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Set up intensity slider
        const intensityInput = card.querySelector('#targethr-intensity');
        if (intensityInput) {
            intensityInput.addEventListener('input', thrUpdateIntensityDisplay);
            intensityInput.addEventListener('change', function() {
                thrCalculate();
            });
        }
        
        // Set up age input
        const ageInput = card.querySelector('#targethr-age');
        if (ageInput) {
            ageInput.addEventListener('change', function() {
                thrCalculate();
            });
        }
        
        // Initial calculation
        setTimeout(() => {
            thrCalculate();
        }, 100);
        
        console.log('Target Heart Rate Calculator initialized');
    });
} else {
    // Run immediately if already loaded
    setTimeout(() => {
        thrCalculate();
    }, 100);
}
</script>

<!-- CARD-SPECIFIC STYLES -->
<style>
/* Pulse animation for results */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

/* Customize the range slider */
#targethr-intensity::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(45, 212, 255, 0.5);
}

#targethr-intensity::-moz-range-thumb {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 10px rgba(45, 212, 255, 0.5);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    #targethr-title {
        font-size: 1.3rem !important;
    }
    
    #thr-target {
        font-size: 36px !important;
    }
    
    .actions {
        flex-direction: column;
    }
    
    .actions button {
        width: 100%;
        margin: 4px 0 !important;
    }
}
</style>
