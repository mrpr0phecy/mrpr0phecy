<!-- cards/fuel-cost-calculator.html -->
<h2 id="fuel-cost-title" style="margin-top:0;color:var(--accent);">‚õΩ Fuel Cost Calculator</h2>

<form aria-describedby="fuel-cost-desc">
  <p id="fuel-cost-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.8);">
    Calculate trip fuel costs, compare vehicles, and explore savings strategies.
    <span style="color:var(--accent);font-weight:500;">Plan your journey efficiently!</span>
  </p>

  <!-- Trip Information -->
  <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(45,212,255,0.2);">
    <h4 class="small" style="color:var(--accent);margin-bottom:16px;">üìç Trip Information</h4>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="fuel-trip-distance" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Trip Distance</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="fuel-trip-distance" type="number" min="1" max="10000" value="100" step="1"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
          <select id="fuel-distance-unit" 
                  style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="km">km</option>
            <option value="miles">miles</option>
          </select>
        </div>
      </div>
      
      <div class="field">
        <label for="fuel-trip-frequency" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Trip Frequency</label>
        <select id="fuel-trip-frequency" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="single">Single Trip</option>
          <option value="daily">Daily Commute</option>
          <option value="weekly" selected>Weekly</option>
          <option value="monthly">Monthly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="fuel-return-trip" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Return Trip</label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="checkbox" id="fuel-return-trip" checked style="width:18px;height:18px;cursor:pointer;" />
          <span>Include return journey</span>
        </label>
      </div>
      
      <div class="field">
        <label for="fuel-passengers" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Passengers</label>
        <input id="fuel-passengers" type="number" min="1" max="10" value="1" step="1"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
      </div>
    </div>
  </div>

  <!-- Vehicle Information -->
  <div style="background:rgba(57,255,20,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(57,255,20,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h4 class="small" style="color:#39ff14;margin:0;">üöó Vehicle Information</h4>
      <button type="button" onclick="fuelLoadVehicleExample()" class="small-btn" style="font-size:11px;">Load Example</button>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="fuel-vehicle-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Vehicle Type</label>
        <select id="fuel-vehicle-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="custom">Custom</option>
          <option value="sedan">Sedan</option>
          <option value="suv" selected>SUV</option>
          <option value="truck">Truck</option>
          <option value="hybrid">Hybrid</option>
          <option value="electric">Electric</option>
          <option value="motorcycle">Motorcycle</option>
        </select>
      </div>
      
      <div class="field">
        <label for="fuel-efficiency" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Fuel Efficiency</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="fuel-efficiency" type="number" min="1" max="100" value="15" step="0.1"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
          <select id="fuel-efficiency-unit" 
                  style="width:100px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="kmpl">km/L</option>
            <option value="mpg">MPG</option>
            <option value="l100km">L/100km</option>
          </select>
        </div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="fuel-tank-capacity" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Tank Capacity</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="fuel-tank-capacity" type="number" min="1" max="200" value="60" step="1"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
          <span style="color:var(--accent);">litres</span>
        </div>
      </div>
      
      <div class="field">
        <label for="fuel-current-fuel" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Current Fuel</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="fuel-current-fuel" type="number" min="0" max="200" value="30" step="1"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
          <span style="color:var(--accent);">% full</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Fuel Information -->
  <div style="background:rgba(255,165,0,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(255,165,0,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h4 class="small" style="color:#ffa500;margin:0;">‚õΩ Fuel Information</h4>
      <button type="button" onclick="fuelFetchLivePrices()" class="small-btn" style="font-size:11px;">Fetch Live Prices</button>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="fuel-price" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Fuel Price</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <select id="fuel-currency" 
                  style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="¬£">¬£</option>
            <option value="$" selected>$</option>
            <option value="‚Ç¨">‚Ç¨</option>
            <option value="¬•">¬•</option>
            <option value="‚Çπ">‚Çπ</option>
          </select>
          <input id="fuel-price" type="number" min="0.1" max="20" value="3.50" step="0.01"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
          <span style="color:var(--accent);">per unit</span>
        </div>
      </div>
      
      <div class="field">
        <label for="fuel-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Fuel Type</label>
        <select id="fuel-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="petrol" selected>Petrol/Gasoline</option>
          <option value="diesel">Diesel</option>
          <option value="electric">Electricity</option>
          <option value="hybrid">Hybrid</option>
          <option value="cng">CNG</option>
          <option value="lpg">LPG</option>
        </select>
      </div>
    </div>
    
    <div id="fuel-price-trend" style="display:none;padding:10px;background:rgba(255,255,255,0.03);border-radius:6px;margin-top:8px;">
      <div class="small" style="color:#ffa500;">üìà Price trend: <span id="fuel-trend-text">Loading...</span></div>
    </div>
  </div>

  <!-- Advanced Options -->
  <div style="margin-bottom:20px;">
    <details>
      <summary style="color:var(--accent);font-weight:500;cursor:pointer;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;">‚öôÔ∏è Advanced Options</summary>
      <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field">
          <label for="fuel-traffic-factor" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Traffic Factor</label>
          <select id="fuel-traffic-factor" 
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="0.9">Light traffic (-10%)</option>
            <option value="1.0" selected>Normal traffic</option>
            <option value="1.1">Heavy traffic (+10%)</option>
            <option value="1.2">Severe traffic (+20%)</option>
          </select>
        </div>
        
        <div class="field">
          <label for="fuel-driving-style" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Driving Style</label>
          <select id="fuel-driving-style" 
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="0.9">Eco-friendly (-10%)</option>
            <option value="1.0" selected>Normal</option>
            <option value="1.1">Aggressive (+10%)</option>
            <option value="1.2">Very aggressive (+20%)</option>
          </select>
        </div>
        
        <div class="field">
          <label for="fuel-weather-factor" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Weather Conditions</label>
          <select id="fuel-weather-factor" 
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="0.95">Clear weather (-5%)</option>
            <option value="1.0" selected>Normal weather</option>
            <option value="1.05">Rainy (+5%)</option>
            <option value="1.15">Snow/ice (+15%)</option>
          </select>
        </div>
        
        <div class="field">
          <label for="fuel-road-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Road Type</label>
          <select id="fuel-road-type" 
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
            <option value="0.95">Highway (-5%)</option>
            <option value="1.0" selected>Mixed roads</option>
            <option value="1.1">City traffic (+10%)</option>
            <option value="1.2">Mountain roads (+20%)</option>
          </select>
        </div>
      </div>
    </details>
  </div>

  <div class="actions" style="display:flex;gap:10px;">
    <button type="button" onclick="fuelCalculate(this)" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(57,255,20,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);font-weight:600;cursor:pointer;font-size:16px;">
      ‚õΩ Calculate Fuel Cost
    </button>
    <button type="button" onclick="fuelReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="fuelCompareVehicles()"
            style="padding:12px 16px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;">
      Compare
    </button>
  </div>
</form>

<div id="fuel-results" aria-live="polite" style="margin-top:20px;display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">üìä Fuel Cost Analysis</h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="fuel-calculation-time" class="small" style="color:rgba(230,250,255,0.6);"></div>
    </div>
  </div>

  <div id="fuel-output-container" style="min-height:200px;">
    <!-- Results will be inserted here -->
  </div>

  <div id="fuel-breakdown-container" style="margin-top:20px;display:none;">
    <h4 class="small" style="color:var(--accent);margin-bottom:12px;">üìà Cost Breakdown</h4>
    <div id="fuel-breakdown-content" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(45,212,255,0.2);">
      <!-- Breakdown will be inserted here -->
    </div>
  </div>

  <div id="fuel-savings-container" style="margin-top:20px;display:none;">
    <h4 class="small" style="color:#39ff14;margin-bottom:12px;">üí° Potential Savings</h4>
    <div id="fuel-savings-content" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(57,255,20,0.2);">
      <!-- Savings tips will be inserted here -->
    </div>
  </div>

  <div id="fuel-charts-container" style="margin-top:20px;display:none;">
    <h4 class="small" style="color:var(--accent);margin-bottom:12px;">üìä Visual Comparison</h4>
    <div id="fuel-charts-content" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(45,212,255,0.2);min-height:200px;">
      <!-- Charts will be inserted here -->
    </div>
  </div>

  <div style="margin-top:20px;">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px;">
      <button onclick="fuelCopyResults()" 
              style="padding:10px;background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.2);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;">
        üìã Copy Results
      </button>
      <button onclick="fuelDownloadReport()" 
              style="padding:10px;background:rgba(57,255,20,0.05);border:1px solid rgba(57,255,20,0.2);border-radius:8px;color:#39ff14;cursor:pointer;font-size:12px;">
        üíæ Download Report
      </button>
      <button onclick="fuelShareResults()" 
              style="padding:10px;background:rgba(255,165,0,0.05);border:1px solid rgba(255,165,0,0.2);border-radius:8px;color:#ffa500;cursor:pointer;font-size:12px;">
        üì± Share
      </button>
    </div>

    <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center;">
      <div id="fuel-hint" class="small" style="color:#39ff14;"></div>
      <button onclick="fuelShowAlternativeRoutes()" 
              style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
        üó∫Ô∏è Alternative Routes
      </button>
    </div>
  </div>
</div>

<script>
/* fuel-cost-calculator.html
   - Comprehensive fuel cost calculator with advanced features
   - Scoped with fuel- prefix
*/

// Vehicle database with average efficiency
const fuelVehicles = {
  'sedan': { efficiency: 15, unit: 'kmpl', tank: 55 },
  'suv': { efficiency: 12, unit: 'kmpl', tank: 70 },
  'truck': { efficiency: 8, unit: 'kmpl', tank: 120 },
  'hybrid': { efficiency: 22, unit: 'kmpl', tank: 45 },
  'electric': { efficiency: 6, unit: 'kmpl', tank: 0 }, // km per kWh
  'motorcycle': { efficiency: 30, unit: 'kmpl', tank: 15 }
};

// Fuel price averages (simulated - would be from API in real implementation)
const fuelPrices = {
  'petrol': { price: 3.50, trend: 'stable', lastUpdate: '2024-12-01' },
  'diesel': { price: 3.80, trend: 'rising', lastUpdate: '2024-12-01' },
  'electric': { price: 0.15, trend: 'stable', lastUpdate: '2024-12-01' },
  'cng': { price: 2.50, trend: 'falling', lastUpdate: '2024-12-01' },
  'lpg': { price: 2.20, trend: 'stable', lastUpdate: '2024-12-01' }
};

// Initialize the tool
function fuelInit() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Set up event listeners
  const vehicleSelect = card.querySelector('#fuel-vehicle-type');
  if (vehicleSelect) {
    vehicleSelect.addEventListener('change', fuelUpdateVehicle);
  }
  
  const fuelTypeSelect = card.querySelector('#fuel-type');
  if (fuelTypeSelect) {
    fuelTypeSelect.addEventListener('change', fuelUpdateFuelType);
  }
  
  // Initialize vehicle and fuel type
  fuelUpdateVehicle();
  fuelUpdateFuelType();
  
  console.log('Fuel Cost Calculator initialized');
}

// Update vehicle efficiency based on selection
function fuelUpdateVehicle() {
  const card = document.currentScript?.closest('.card') || document;
  const vehicleType = card.querySelector('#fuel-vehicle-type').value;
  
  if (vehicleType !== 'custom' && fuelVehicles[vehicleType]) {
    const vehicle = fuelVehicles[vehicleType];
    card.querySelector('#fuel-efficiency').value = vehicle.efficiency;
    card.querySelector('#fuel-efficiency-unit').value = vehicle.unit;
    card.querySelector('#fuel-tank-capacity').value = vehicle.tank;
    
    // Update hint
    const hint = card.querySelector('#fuel-hint');
    hint.textContent = `Loaded ${vehicleType} vehicle settings`;
    hint.style.color = '#39ff14';
    setTimeout(() => {
      if (hint.textContent.includes('Loaded')) hint.textContent = '';
    }, 2000);
  }
}

// Update fuel price based on type
function fuelUpdateFuelType() {
  const card = document.currentScript?.closest('.card') || document;
  const fuelType = card.querySelector('#fuel-type').value;
  
  if (fuelPrices[fuelType]) {
    const priceInfo = fuelPrices[fuelType];
    card.querySelector('#fuel-price').value = priceInfo.price;
    
    // Update price trend display
    const trendContainer = card.querySelector('#fuel-price-trend');
    const trendText = card.querySelector('#fuel-trend-text');
    
    trendContainer.style.display = 'block';
    trendText.textContent = `${priceInfo.trend} (Updated: ${priceInfo.lastUpdate})`;
    
    // Color code trend
    if (priceInfo.trend === 'rising') {
      trendText.style.color = '#ff2d55';
    } else if (priceInfo.trend === 'falling') {
      trendText.style.color = '#39ff14';
    } else {
      trendText.style.color = '#ffa500';
    }
  }
}

// Load vehicle example
function fuelLoadVehicleExample() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Set example values
  card.querySelector('#fuel-trip-distance').value = 150;
  card.querySelector('#fuel-distance-unit').value = 'km';
  card.querySelector('#fuel-efficiency').value = 18;
  card.querySelector('#fuel-efficiency-unit').value = 'kmpl';
  card.querySelector('#fuel-price').value = 3.75;
  card.querySelector('#fuel-currency').value = '$';
  
  const hint = card.querySelector('#fuel-hint');
  hint.textContent = 'Example vehicle loaded - adjust as needed';
  hint.style.color = '#ffa500';
  setTimeout(() => {
    if (hint.textContent.includes('Example')) hint.textContent = '';
  }, 2000);
}

// Fetch live prices (simulated)
function fuelFetchLivePrices() {
  const card = document.currentScript?.closest('.card') || document;
  const fuelType = card.querySelector('#fuel-type').value;
  
  // Simulate API call
  const hint = card.querySelector('#fuel-hint');
  hint.textContent = 'Fetching live prices...';
  hint.style.color = '#2dd4ff';
  
  setTimeout(() => {
    // Simulate price update
    const currentPrice = parseFloat(card.querySelector('#fuel-price').value);
    const newPrice = currentPrice + (Math.random() * 0.5 - 0.25); // +/- $0.25
    card.querySelector('#fuel-price').value = newPrice.toFixed(2);
    
    hint.textContent = `Live price updated: $${newPrice.toFixed(2)}`;
    hint.style.color = '#39ff14';
    
    setTimeout(() => {
      if (hint.textContent.includes('Live price')) hint.textContent = '';
    }, 3000);
  }, 1000);
}

// Convert efficiency to common unit (L/100km)
function fuelConvertToL100km(efficiency, unit) {
  switch (unit) {
    case 'kmpl': // km per litre
      return 100 / efficiency;
    case 'mpg': // miles per gallon
      return 235.215 / efficiency; // Convert MPG to L/100km
    case 'l100km': // litres per 100km
      return efficiency;
    default:
      return 100 / efficiency;
  }
}

// Convert distance to km
function fuelConvertToKm(distance, unit) {
  if (unit === 'miles') {
    return distance * 1.60934;
  }
  return distance;
}

// Calculate fuel consumption
function fuelCalculateConsumption(distanceKm, efficiency, unit) {
  const l100km = fuelConvertToL100km(efficiency, unit);
  return (distanceKm * l100km) / 100;
}

// Main calculation function
function fuelCalculate(btn) {
  const startTime = performance.now();
  const card = btn.closest('.card') || document;
  
  // Get inputs
  const distance = parseFloat(card.querySelector('#fuel-trip-distance').value);
  const distanceUnit = card.querySelector('#fuel-distance-unit').value;
  const efficiency = parseFloat(card.querySelector('#fuel-efficiency').value);
  const efficiencyUnit = card.querySelector('#fuel-efficiency-unit').value;
  const price = parseFloat(card.querySelector('#fuel-price').value);
  const currency = card.querySelector('#fuel-currency').value;
  const fuelType = card.querySelector('#fuel-type').value;
  const returnTrip = card.querySelector('#fuel-return-trip').checked;
  const passengers = parseInt(card.querySelector('#fuel-passengers').value) || 1;
  const frequency = card.querySelector('#fuel-trip-frequency').value;
  
  // Get advanced factors
  const trafficFactor = parseFloat(card.querySelector('#fuel-traffic-factor').value);
  const drivingFactor = parseFloat(card.querySelector('#fuel-driving-style').value);
  const weatherFactor = parseFloat(card.querySelector('#fuel-weather-factor').value);
  const roadFactor = parseFloat(card.querySelector('#fuel-road-type').value);
  
  // Validate inputs
  if (!distance || distance <= 0 || !efficiency || efficiency <= 0 || !price || price <= 0) {
    const hint = card.querySelector('#fuel-hint');
    hint.textContent = 'Please enter valid distance, efficiency, and price values';
    hint.style.color = '#ff2d55';
    return;
  }
  
  // Calculate total distance
  const totalDistanceKm = fuelConvertToKm(distance, distanceUnit) * (returnTrip ? 2 : 1);
  
  // Calculate base consumption
  const baseConsumption = fuelCalculateConsumption(totalDistanceKm, efficiency, efficiencyUnit);
  
  // Apply adjustment factors
  const adjustmentFactor = trafficFactor * drivingFactor * weatherFactor * roadFactor;
  const adjustedConsumption = baseConsumption * adjustmentFactor;
  
  // Calculate costs
  const cost = adjustedConsumption * price;
  const costPerPassenger = cost / passengers;
  
  // Calculate frequency costs
  const frequencyMultipliers = {
    'single': 1,
    'daily': 365,
    'weekly': 52,
    'monthly': 12,
    'yearly': 1
  };
  
  const yearlyCost = cost * (frequencyMultipliers[frequency] || 1);
  
  // Calculate additional metrics
  const tankCapacity = parseFloat(card.querySelector('#fuel-tank-capacity').value) || 60;
  const currentFuel = parseFloat(card.querySelector('#fuel-current-fuel').value) || 100;
  const currentFuelLitres = (currentFuel / 100) * tankCapacity;
  
  // Can we make the trip without refueling?
  const canMakeTrip = currentFuelLitres >= adjustedConsumption;
  const fuelNeeded = Math.max(0, adjustedConsumption - currentFuelLitres);
  const refuelCost = fuelNeeded * price;
  
  // Display results
  fuelDisplayResults(card, {
    distance: totalDistanceKm,
    distanceUnit: 'km',
    consumption: adjustedConsumption,
    baseConsumption: baseConsumption,
    cost: cost,
    yearlyCost: yearlyCost,
    costPerPassenger: costPerPassenger,
    currency: currency,
    fuelType: fuelType,
    passengers: passengers,
    frequency: frequency,
    canMakeTrip: canMakeTrip,
    fuelNeeded: fuelNeeded,
    refuelCost: refuelCost,
    adjustmentFactor: adjustmentFactor,
    efficiency: efficiency,
    efficiencyUnit: efficiencyUnit
  });
  
  // Show additional sections
  fuelShowBreakdown(card, {
    baseConsumption: baseConsumption,
    adjustedConsumption: adjustedConsumption,
    factors: {
      traffic: trafficFactor,
      driving: drivingFactor,
      weather: weatherFactor,
      road: roadFactor
    }
  });
  
  fuelShowSavingsTips(card, {
    cost: cost,
    consumption: adjustedConsumption,
    efficiency: efficiency,
    efficiencyUnit: efficiencyUnit
  });
  
  // Calculate and show execution time
  const endTime = performance.now();
  const timeTaken = (endTime - startTime).toFixed(2);
  card.querySelector('#fuel-calculation-time').textContent = `Calculated in ${timeTaken}ms`;
  
  // Show results section
  const resultsDiv = card.querySelector('#fuel-results');
  resultsDiv.style.display = 'block';
  resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
  
  // Update hint
  const hint = card.querySelector('#fuel-hint');
  hint.textContent = 'Fuel cost calculated successfully!';
  hint.style.color = '#39ff14';
}

// Display main results
function fuelDisplayResults(card, data) {
  const container = card.querySelector('#fuel-output-container');
  
  let html = `<div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(45,212,255,0.2);">`;
  
  // Main cost display
  html += `<div style="text-align:center;margin-bottom:24px;">`;
  html += `<div style="font-size:48px;font-weight:600;color:var(--accent);">${data.currency}${data.cost.toFixed(2)}</div>`;
  html += `<div class="small" style="color:rgba(230,250,255,0.7);">Total ${data.frequency} fuel cost</div>`;
  html += `</div>`;
  
  // Key metrics grid
  html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">`;
  
  html += `<div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;">`;
  html += `<div class="small" style="color:var(--accent);">Fuel Consumption</div>`;
  html += `<div style="font-size:18px;font-weight:600;">${data.consumption.toFixed(2)} L</div>`;
  html += `</div>`;
  
  html += `<div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;">`;
  html += `<div class="small" style="color:#39ff14;">Cost per Passenger</div>`;
  html += `<div style="font-size:18px;font-weight:600;">${data.currency}${data.costPerPassenger.toFixed(2)}</div>`;
  html += `</div>`;
  
  html += `<div style="padding:12px;background:rgba(255,165,0,0.05);border-radius:8px;">`;
  html += `<div class="small" style="color:#ffa500;">Yearly Cost</div>`;
  html += `<div style="font-size:18px;font-weight:600;">${data.currency}${data.yearlyCost.toFixed(2)}</div>`;
  html += `</div>`;
  
  html += `<div style="padding:12px;background:rgba(255,77,77,0.05);border-radius:8px;">`;
  html += `<div class="small" style="color:#ff4d4d;">Trip Distance</div>`;
  html += `<div style="font-size:18px;font-weight:600;">${data.distance.toFixed(1)} ${data.distanceUnit}</div>`;
  html += `</div>`;
  html += `</div>`;
  
  // Trip feasibility
  if (!data.canMakeTrip) {
    html += `<div style="margin-top:12px;padding:12px;background:rgba(255,77,77,0.1);border-radius:8px;border:1px solid rgba(255,77,77,0.3);">`;
    html += `<div style="color:#ff4d4d;font-weight:600;">‚ö†Ô∏è Need to Refuel</div>`;
    html += `<div class="small" style="color:rgba(230,250,255,0.8);">You'll need ${data.fuelNeeded.toFixed(2)}L more fuel (${data.currency}${data.refuelCost.toFixed(2)}) for this trip</div>`;
    html += `</div>`;
  } else {
    html += `<div style="margin-top:12px;padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);">`;
    html += `<div style="color:#39ff14;font-weight:600;">‚úÖ Sufficient Fuel</div>`;
    html += `<div class="small" style="color:rgba(230,250,255,0.8);">You have enough fuel for this trip</div>`;
    html += `</div>`;
  }
  
  html += `</div>`;
  
  container.innerHTML = html;
  
  // Show breakdown container
  const breakdownContainer = card.querySelector('#fuel-breakdown-container');
  breakdownContainer.style.display = 'block';
  
  // Show savings container
  const savingsContainer = card.querySelector('#fuel-savings-container');
  savingsContainer.style.display = 'block';
  
  // Store data for copying
  container.dataset.fuelData = JSON.stringify(data);
}

// Show cost breakdown
function fuelShowBreakdown(card, data) {
  const container = card.querySelector('#fuel-breakdown-content');
  
  let html = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">`;
  
  html += `<div>`;
  html += `<div class="small" style="color:var(--accent);margin-bottom:4px;">Base Consumption</div>`;
  html += `<div style="font-weight:600;">${data.baseConsumption.toFixed(2)} L</div>`;
  html += `</div>`;
  
  html += `<div>`;
  html += `<div class="small" style="color:var(--accent);margin-bottom:4px;">Adjusted Consumption</div>`;
  html += `<div style="font-weight:600;">${data.adjustedConsumption.toFixed(2)} L</div>`;
  html += `</div>`;
  
  html += `<div>`;
  html += `<div class="small" style="color:var(--accent);margin-bottom:4px;">Adjustment Factor</div>`;
  html += `<div style="font-weight:600;">${data.adjustmentFactor.toFixed(2)}x</div>`;
  html += `</div>`;
  
  html += `<div>`;
  html += `<div class="small" style="color:var(--accent);margin-bottom:4px;">Efficiency Impact</div>`;
  html += `<div style="font-weight:600;">${((data.adjustmentFactor - 1) * 100).toFixed(1)}%</div>`;
  html += `</div>`;
  html += `</div>`;
  
  // Factor breakdown
  html += `<div style="margin-top:16px;">`;
  html += `<div class="small" style="color:var(--accent);margin-bottom:8px;">Factor Details:</div>`;
  html += `<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;">`;
  
  const factors = [
    { name: 'Traffic', value: data.factors.traffic, color: '#2dd4ff' },
    { name: 'Driving', value: data.factors.driving, color: '#39ff14' },
    { name: 'Weather', value: data.factors.weather, color: '#ffa500' },
    { name: 'Road', value: data.factors.road, color: '#ff4d4d' }
  ];
  
  factors.forEach(factor => {
    const impact = ((factor.value - 1) * 100).toFixed(0);
    const sign = impact >= 0 ? '+' : '';
    
    html += `<div style="text-align:center;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;">`;
    html += `<div class="small" style="color:${factor.color};">${factor.name}</div>`;
    html += `<div style="font-weight:600;color:${impact >= 0 ? '#ff4d4d' : '#39ff14'};">${sign}${impact}%</div>`;
    html += `</div>`;
  });
  
  html += `</div>`;
  html += `</div>`;
  
  container.innerHTML = html;
}

// Show savings tips
function fuelShowSavingsTips(card, data) {
  const container = card.querySelector('#fuel-savings-content');
  
  const tips = [];
  
  // Generate tips based on data
  if (data.consumption > 20) {
    tips.push(`üîÑ Improve driving habits to reduce consumption by up to 20%`);
  }
  
  if (data.efficiency < 15 && data.efficiencyUnit === 'kmpl') {
    tips.push(`üöó Consider a more fuel-efficient vehicle (aim for 15+ km/L)`);
  }
  
  tips.push(`üö¶ Avoid rush hour traffic to save ~10% on fuel`);
  tips.push(`‚ö° Maintain proper tire pressure for 3% better efficiency`);
  tips.push(`üîÑ Regular vehicle maintenance can improve efficiency by 4-10%`);
  tips.push(`üì± Use fuel price apps to find cheaper stations`);
  tips.push(`üöó Carpooling can cut your fuel costs by 50-75%`);
  
  let html = `<div style="display:grid;gap:8px;">`;
  
  tips.forEach(tip => {
    html += `<div style="display:flex;align-items:start;gap:8px;">`;
    html += `<span style="color:#39ff14;">‚Ä¢</span>`;
    html += `<span style="flex:1;">${tip}</span>`;
    html += `</div>`;
  });
  
  // Potential savings calculation
  const potentialSavings = data.cost * 0.15; // Assume 15% savings possible
  html += `<div style="margin-top:12px;padding:10px;background:rgba(57,255,20,0.1);border-radius:6px;">`;
  html += `<div style="color:#39ff14;font-weight:600;">Potential Savings: ${data.currency}${potentialSavings.toFixed(2)} per trip</div>`;
  html += `<div class="small" style="color:rgba(230,250,255,0.8);">By implementing these tips</div>`;
  html += `</div>`;
  
  html += `</div>`;
  container.innerHTML = html;
}

// Compare vehicles
function fuelCompareVehicles() {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#fuel-hint');
  
  // Get current trip data
  const distance = parseFloat(card.querySelector('#fuel-trip-distance').value);
  const distanceUnit = card.querySelector('#fuel-distance-unit').value;
  const price = parseFloat(card.querySelector('#fuel-price').value);
  const currency = card.querySelector('#fuel-currency').value;
  const returnTrip = card.querySelector('#fuel-return-trip').checked;
  
  const totalDistanceKm = fuelConvertToKm(distance, distanceUnit) * (returnTrip ? 2 : 1);
  
  // Compare different vehicle types
  let comparison = `<div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(45,212,255,0.2);">`;
  comparison += `<h4 class="small" style="color:var(--accent);margin-bottom:16px;">üöó Vehicle Comparison</h4>`;
  comparison += `<div style="display:grid;gap:8px;">`;
  
  Object.entries(fuelVehicles).forEach(([type, vehicle]) => {
    if (type === 'electric') return; // Skip electric for now
    
    const consumption = fuelCalculateConsumption(totalDistanceKm, vehicle.efficiency, vehicle.unit);
    const cost = consumption * price;
    
    comparison += `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;">`;
    comparison += `<span style="color:var(--accent);text-transform:capitalize;">${type}</span>`;
    comparison += `<span>${currency}${cost.toFixed(2)}</span>`;
    comparison += `</div>`;
  });
  
  comparison += `</div>`;
  comparison += `</div>`;
  
  // Show charts container
  const chartsContainer = card.querySelector('#fuel-charts-container');
  const chartsContent = card.querySelector('#fuel-charts-content');
  chartsContent.innerHTML = comparison;
  chartsContainer.style.display = 'block';
  
  hint.textContent = 'Vehicle comparison generated';
  hint.style.color = '#ffa500';
  setTimeout(() => {
    if (hint.textContent.includes('comparison')) hint.textContent = '';
  }, 3000);
}

// Reset form
function fuelReset(btn) {
  const card = btn.closest('.card') || document;
  
  // Reset form to default values
  card.querySelector('#fuel-trip-distance').value = 100;
  card.querySelector('#fuel-distance-unit').value = 'km';
  card.querySelector('#fuel-efficiency').value = 15;
  card.querySelector('#fuel-efficiency-unit').value = 'kmpl';
  card.querySelector('#fuel-price').value = 3.50;
  card.querySelector('#fuel-currency').value = '$';
  card.querySelector('#fuel-type').value = 'petrol';
  card.querySelector('#fuel-return-trip').checked = true;
  card.querySelector('#fuel-passengers').value = 1;
  card.querySelector('#fuel-trip-frequency').value = 'weekly';
  card.querySelector('#fuel-vehicle-type').value = 'suv';
  card.querySelector('#fuel-tank-capacity').value = 60;
  card.querySelector('#fuel-current-fuel').value = 30;
  
  // Reset advanced options
  card.querySelector('#fuel-traffic-factor').value = '1.0';
  card.querySelector('#fuel-driving-style').value = '1.0';
  card.querySelector('#fuel-weather-factor').value = '1.0';
  card.querySelector('#fuel-road-type').value = '1.0';
  
  // Hide results
  const resultsDiv = card.querySelector('#fuel-results');
  resultsDiv.style.display = 'none';
  
  // Hide price trend
  const trendContainer = card.querySelector('#fuel-price-trend');
  trendContainer.style.display = 'none';
  
  // Clear hint
  const hint = card.querySelector('#fuel-hint');
  hint.textContent = '';
}

// Copy results
function fuelCopyResults() {
  const card = document.currentScript?.closest('.card') || document;
  const data = card.querySelector('#fuel-output-container').dataset.fuelData;
  
  if (!data) {
    fuelShowMessage('No results available to copy', '#ff2d55');
    return;
  }
  
  const fuelData = JSON.parse(data);
  const text = `Fuel Cost Calculation\n` +
               `Total Cost: ${fuelData.currency}${fuelData.cost.toFixed(2)}\n` +
               `Distance: ${fuelData.distance.toFixed(1)} ${fuelData.distanceUnit}\n` +
               `Consumption: ${fuelData.consumption.toFixed(2)} L\n` +
               `Cost per Passenger: ${fuelData.currency}${fuelData.costPerPassenger.toFixed(2)}\n` +
               `Yearly Cost: ${fuelData.currency}${fuelData.yearlyCost.toFixed(2)}`;
  
  navigator.clipboard.writeText(text).then(() => {
    fuelShowMessage('‚úÖ Results copied to clipboard!', '#39ff14');
  }).catch(err => {
    console.error('Copy failed:', err);
    fuelShowMessage('‚ùå Copy failed', '#ff2d55');
  });
}

// Download report
function fuelDownloadReport() {
  const card = document.currentScript?.closest('.card') || document;
  const data = card.querySelector('#fuel-output-container').dataset.fuelData;
  
  if (!data) {
    fuelShowMessage('No results available to download', '#ff2d55');
    return;
  }
  
  const fuelData = JSON.parse(data);
  let text = `FUEL COST CALCULATION REPORT\n`;
  text += `Generated: ${new Date().toLocaleString()}\n\n`;
  text += `TRIP INFORMATION:\n`;
  text += `Distance: ${fuelData.distance.toFixed(1)} ${fuelData.distanceUnit}\n`;
  text += `Passengers: ${fuelData.passengers}\n`;
  text += `Frequency: ${fuelData.frequency}\n\n`;
  text += `FUEL INFORMATION:\n`;
  text += `Fuel Type: ${fuelData.fuelType}\n`;
  text += `Efficiency: ${fuelData.efficiency} ${fuelData.efficiencyUnit}\n\n`;
  text += `COST BREAKDOWN:\n`;
  text += `Total Cost: ${fuelData.currency}${fuelData.cost.toFixed(2)}\n`;
  text += `Cost per Passenger: ${fuelData.currency}${fuelData.costPerPassenger.toFixed(2)}\n`;
  text += `Yearly Cost: ${fuelData.currency}${fuelData.yearlyCost.toFixed(2)}\n`;
  text += `Fuel Consumption: ${fuelData.consumption.toFixed(2)} L\n\n`;
  
  if (!fuelData.canMakeTrip) {
    text += `NOTICE: Need to refuel ${fuelData.fuelNeeded.toFixed(2)}L more\n`;
  }
  
  const blob = new Blob([text], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'fuel-cost-report.txt';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  fuelShowMessage('‚úÖ Report downloaded!', '#39ff14');
}

// Share results
function fuelShareResults() {
  const card = document.currentScript?.closest('.card') || document;
  const data = card.querySelector('#fuel-output-container').dataset.fuelData;
  
  if (!data) {
    fuelShowMessage('No results to share', '#ff2d55');
    return;
  }
  
  const fuelData = JSON.parse(data);
  const shareText = `My trip fuel cost: ${fuelData.currency}${fuelData.cost.toFixed(2)} for ${fuelData.distance.toFixed(1)}km. Calculated with The Most Useful Site!`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Fuel Cost Calculation',
      text: shareText,
      url: window.location.href
    }).catch(console.error);
  } else {
    navigator.clipboard.writeText(shareText).then(() => {
      fuelShowMessage('‚úÖ Results copied to share!', '#39ff14');
    });
  }
}

// Show alternative routes
function fuelShowAlternativeRoutes() {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#fuel-hint');
  
  hint.textContent = 'Alternative routes could save 10-25% on fuel. Consider using navigation apps.';
  hint.style.color = '#2dd4ff';
  setTimeout(() => {
    if (hint.textContent.includes('Alternative routes')) hint.textContent = '';
  }, 4000);
}

// Helper function to show messages
function fuelShowMessage(message, color) {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#fuel-hint');
  hint.textContent = message;
  hint.style.color = color;
  setTimeout(() => {
    if (hint.textContent === message) hint.textContent = '';
  }, 3000);
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', fuelInit);
} else {
  fuelInit();
}
</script>

<style>
#fuel-cost-title {
  color: var(--accent);
  margin-top: 0;
  font-size: 1.3rem;
}

.small-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: inherit;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 12px;
  padding: 4px 8px;
}

.small-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
}

details summary {
  list-style: none;
}

details summary::-webkit-details-marker {
  display: none;
}

details summary::after {
  content: '‚ñ∂';
  float: right;
  transition: transform 0.2s;
}

details[open] summary::after {
  transform: rotate(90deg);
}

@media (max-width: 768px) {
  .field {
    grid-column: 1 / -1 !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
}
</style>
