<h2 id="interest-title" style="margin-top:0;color:var(--accent);border-bottom:2px solid var(--accent);padding-bottom:8px;">
  ğŸ’° Interest Calculator
  <span style="font-size:14px;color:var(--muted);display:block;margin-top:4px;">
    Watch your money grow with compound magic!
  </span>
</h2>

<form aria-describedby="interest-desc">
  <p id="interest-desc" class="small" style="color:var(--muted);margin-bottom:20px;">
    Calculate how your money multiplies over time with <strong style="color:var(--accent)">compound interest</strong>â€”the 8th wonder of the world!
  </p>

  <!-- VISUAL SLIDERS INSTEAD OF INPUTS -->
  <div class="field-group" style="margin-bottom:24px;">
    <div class="slider-header" style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <label for="interest-principal" style="color:var(--accent);font-weight:500;">
        ğŸ’° Initial Investment
      </label>
      <span id="principal-value" style="background:rgba(45,212,255,0.1);color:var(--accent);padding:4px 12px;border-radius:12px;font-weight:600;">
        Â£1,000
      </span>
    </div>
    <input type="range" id="interest-principal" min="100" max="1000000" step="100" value="1000" 
           style="width:100%;height:6px;-webkit-appearance:none;background:linear-gradient(90deg, rgba(45,212,255,0.3), rgba(45,212,255,0.8));border-radius:3px;outline:none;" />
    <div class="slider-labels" style="display:flex;justify-content:space-between;margin-top:4px;font-size:12px;color:var(--muted);">
      <span>Â£100</span>
      <span>Â£500k</span>
      <span>Â£1M</span>
    </div>
  </div>

  <div class="field-group" style="margin-bottom:24px;">
    <div class="slider-header" style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <label for="interest-rate" style="color:var(--accent);font-weight:500;">
        ğŸ“ˆ Annual Rate
      </label>
      <span id="rate-value" style="background:rgba(45,212,255,0.1);color:var(--accent);padding:4px 12px;border-radius:12px;font-weight:600;">
        5%
      </span>
    </div>
    <input type="range" id="interest-rate" min="0.1" max="20" step="0.1" value="5" 
           style="width:100%;height:6px;-webkit-appearance:none;background:linear-gradient(90deg, rgba(45,212,255,0.3), rgba(45,212,255,0.8));border-radius:3px;outline:none;" />
    <div class="slider-labels" style="display:flex;justify-content:space-between;margin-top:4px;font-size:12px;color:var(--muted);">
      <span>0.1%</span>
      <span>10%</span>
      <span>20%</span>
    </div>
  </div>

  <div class="field-group" style="margin-bottom:24px;">
    <div class="slider-header" style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <label for="interest-years" style="color:var(--accent);font-weight:500;">
        â³ Time Period
      </label>
      <span id="years-value" style="background:rgba(45,212,255,0.1);color:var(--accent);padding:4px 12px;border-radius:12px;font-weight:600;">
        5 years
      </span>
    </div>
    <input type="range" id="interest-years" min="1" max="50" step="1" value="5" 
           style="width:100%;height:6px;-webkit-appearance:none;background:linear-gradient(90deg, rgba(45,212,255,0.3), rgba(45,212,255,0.8));border-radius:3px;outline:none;" />
    <div class="slider-labels" style="display:flex;justify-content:space-between;margin-top:4px;font-size:12px;color:var(--muted);">
      <span>1 year</span>
      <span>25 years</span>
      <span>50 years</span>
    </div>
  </div>

  <!-- QUICK PRESETS FOR VIRAL APPEAL -->
  <div style="margin-bottom:20px;">
    <div style="color:var(--muted);margin-bottom:8px;font-size:14px;">âœ¨ Quick Scenarios:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="setScenario('savings')" style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;">ğŸ’° High-Yield Savings</button>
      <button type="button" onclick="setScenario('investment')" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:8px;color:#39ff14;cursor:pointer;font-size:12px;">ğŸ“ˆ Stock Investment</button>
      <button type="button" onclick="setScenario('retirement')" style="padding:8px 12px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;font-size:12px;">ğŸ–ï¸ Retirement Fund</button>
    </div>
  </div>

  <!-- INTEREST TYPE TOGGLE -->
  <div style="margin-bottom:20px;">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
      <div style="color:var(--accent);font-weight:500;">ğŸ§  Interest Type:</div>
      <div style="display:flex;background:rgba(255,255,255,0.05);border-radius:10px;padding:4px;flex:1;">
        <button id="simple-btn" type="button" onclick="setInterestType('simple')" 
                style="flex:1;padding:8px;border:none;background:rgba(45,212,255,0.2);color:var(--accent);border-radius:6px;cursor:pointer;font-weight:500;">
          Simple
        </button>
        <button id="compound-btn" type="button" onclick="setInterestType('compound')" 
                style="flex:1;padding:8px;border:none;background:rgba(57,255,20,0.2);color:#39ff14;border-radius:6px;cursor:pointer;font-weight:500;">
          Compound
        </button>
      </div>
    </div>
    
    <!-- COMPOUND FREQUENCY (SHOWS ONLY FOR COMPOUND) -->
    <div id="compound-options" style="margin-top:12px;display:none;">
      <div style="color:var(--muted);margin-bottom:6px;font-size:14px;">ğŸ”„ Compounding Frequency:</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;">
        <button type="button" onclick="setFrequency(1)" class="freq-btn" data-freq="1">Annual</button>
        <button type="button" onclick="setFrequency(4)" class="freq-btn" data-freq="4">Quarterly</button>
        <button type="button" onclick="setFrequency(12)" class="freq-btn active" data-freq="12">Monthly</button>
        <button type="button" onclick="setFrequency(365)" class="freq-btn" data-freq="365">Daily</button>
        <button type="button" onclick="setFrequency(1000)" class="freq-btn" data-freq="1000">Continuous</button>
      </div>
    </div>
  </div>

  <!-- VISUAL RESULTS -->
  <div class="results" aria-live="polite" style="background:linear-gradient(135deg, rgba(45,212,255,0.05), rgba(57,255,20,0.05));border-radius:12px;padding:20px;border:1px solid rgba(45,212,255,0.2);margin-bottom:20px;">
    <div style="text-align:center;margin-bottom:16px;">
      <div style="color:var(--muted);font-size:14px;">Your investment grows to:</div>
      <div id="interest-fv" style="font-size:36px;font-weight:700;color:#39ff14;margin:8px 0;">Â£1,276.28</div>
      <div style="color:var(--muted);font-size:14px;">
        That's <span id="interest-res" style="color:var(--accent);font-weight:600;">Â£276.28</span> in interest!
      </div>
    </div>
    
    <!-- VISUAL GROWTH BAR -->
    <div style="margin:16px 0;">
      <div style="display:flex;justify-content:space-between;margin-bottom:6px;font-size:12px;color:var(--muted);">
        <span>Principal</span>
        <span>Total Growth</span>
      </div>
      <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;position:relative;">
        <div id="growth-bar" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:22%;transition:width 0.5s;"></div>
      </div>
    </div>
    
    <!-- FUN FACT -->
    <div id="fun-fact" style="background:rgba(255,255,255,0.03);border-left:3px solid var(--accent);padding:10px;border-radius:6px;font-size:13px;color:var(--muted);margin-top:12px;">
      ğŸ’¡ <strong>Did you know?</strong> With 7% annual returns, your money doubles every 10 years!
    </div>
  </div>

  <!-- YEAR-BY-YEAR BREAKDOWN (EXPANDABLE) -->
  <details style="margin-bottom:16px;">
    <summary style="color:var(--accent);font-weight:500;cursor:pointer;padding:8px;background:rgba(255,255,255,0.03);border-radius:8px;">
      ğŸ“Š View Year-by-Year Breakdown
    </summary>
    <div id="yearly-table" style="margin-top:12px;max-height:300px;overflow-y:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead style="background:rgba(45,212,255,0.1);">
          <tr>
            <th style="padding:8px;text-align:left;color:var(--accent);">Year</th>
            <th style="padding:8px;text-align:right;color:var(--accent);">Principal</th>
            <th style="padding:8px;text-align:right;color:var(--accent);">Interest</th>
            <th style="padding:8px;text-align:right;color:var(--accent);">Total</th>
          </tr>
        </thead>
        <tbody id="yearly-tbody">
          <!-- Filled by JavaScript -->
        </tbody>
      </table>
    </div>
  </details>

  <!-- SHARE BUTTON FOR VIRALITY -->
  <div style="display:flex;gap:10px;margin-top:20px;">
    <button type="button" onclick="interestCalc()" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, var(--accent), rgba(57,255,20,0.8));border:none;border-radius:10px;color:white;cursor:pointer;font-weight:600;font-size:16px;">
      ğŸ”„ Update Calculation
    </button>
    <button type="button" onclick="shareResults()" 
            style="padding:14px 20px;background:linear-gradient(135deg, #9d4edd, rgba(255,45,85,0.8));border:none;border-radius:10px;color:white;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px;">
      ğŸ“¤ Share
    </button>
  </div>
</form>

<!-- INTERACTIVE COMPARISON -->
<div style="margin-top:24px;background:rgba(20,20,20,0.6);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.1);">
  <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:16px;">âš–ï¸ Simple vs Compound Comparison</h3>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div style="text-align:center;padding:12px;background:rgba(45,212,255,0.1);border-radius:8px;">
      <div style="color:var(--muted);font-size:12px;">Simple Interest</div>
      <div id="simple-total" style="color:var(--accent);font-size:20px;font-weight:600;margin:8px 0;">Â£1,250</div>
      <div style="color:var(--muted);font-size:11px;">Linear growth</div>
    </div>
    <div style="text-align:center;padding:12px;background:rgba(57,255,20,0.1);border-radius:8px;">
      <div style="color:var(--muted);font-size:12px;">Compound Interest</div>
      <div id="compound-total" style="color:#39ff14;font-size:20px;font-weight:600;margin:8px 0;">Â£1,276</div>
      <div style="color:var(--muted);font-size:11px;">Exponential growth</div>
    </div>
  </div>
  <div style="height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin:12px 0;overflow:hidden;">
    <div id="difference-bar" style="height:100%;background:linear-gradient(90deg, var(--accent), #39ff14);width:2%;"></div>
  </div>
  <div style="text-align:center;color:var(--muted);font-size:12px;">
    Compound earns <span id="difference-amount" style="color:#39ff14;font-weight:600;">Â£26</span> more!
  </div>
</div>

<script>
// Scoped functions with 'ic' prefix (Interest Calculator)
let icCurrentType = 'compound';
let icCurrentFrequency = 12;

// Initialize
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', icInitialize);
} else {
  icInitialize();
}

function icInitialize() {
  console.log('Interest Calculator loaded');
  
  const card = document.currentScript?.closest('.card') || document;
  
  // Set default to compound
  setInterestType('compound');
  
  // Add real-time updates to sliders
  const sliders = card.querySelectorAll('input[type="range"]');
  sliders.forEach(slider => {
    slider.addEventListener('input', function() {
      updateSliderValue(this);
      interestCalc();
    });
  });
  
  // Initialize frequency buttons
  const freqButtons = card.querySelectorAll('.freq-btn');
  freqButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      freqButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      icCurrentFrequency = parseInt(this.dataset.freq);
      interestCalc();
    });
  });
  
  // Run initial calculation
  interestCalc();
}

function updateSliderValue(slider) {
  const valueSpan = document.getElementById(slider.id + '-value');
  if (!valueSpan) return;
  
  let displayValue = slider.value;
  
  switch(slider.id) {
    case 'interest-principal':
      if (slider.value >= 1000) {
        displayValue = 'Â£' + formatNumber(parseFloat(slider.value));
      } else {
        displayValue = 'Â£' + slider.value;
      }
      break;
    case 'interest-rate':
      displayValue = slider.value + '%';
      break;
    case 'interest-years':
      displayValue = slider.value + ' year' + (slider.value == 1 ? '' : 's');
      break;
  }
  
  valueSpan.textContent = displayValue;
}

function setInterestType(type) {
  const card = document.currentScript?.closest('.card') || document;
  const simpleBtn = card.querySelector('#simple-btn');
  const compoundBtn = card.querySelector('#compound-btn');
  const compoundOptions = card.querySelector('#compound-options');
  
  icCurrentType = type;
  
  if (type === 'simple') {
    simpleBtn.style.background = 'rgba(45,212,255,0.3)';
    simpleBtn.style.color = 'var(--accent)';
    compoundBtn.style.background = 'transparent';
    compoundBtn.style.color = 'var(--muted)';
    compoundOptions.style.display = 'none';
  } else {
    simpleBtn.style.background = 'transparent';
    simpleBtn.style.color = 'var(--muted)';
    compoundBtn.style.background = 'rgba(57,255,20,0.3)';
    compoundBtn.style.color = '#39ff14';
    compoundOptions.style.display = 'block';
  }
  
  interestCalc();
}

function setFrequency(freq) {
  icCurrentFrequency = freq;
  interestCalc();
}

function setScenario(type) {
  const card = document.currentScript?.closest('.card') || document;
  const principal = card.querySelector('#interest-principal');
  const rate = card.querySelector('#interest-rate');
  const years = card.querySelector('#interest-years');
  
  switch(type) {
    case 'savings':
      principal.value = 5000;
      rate.value = 4.5;
      years.value = 3;
      setInterestType('compound');
      break;
    case 'investment':
      principal.value = 10000;
      rate.value = 8;
      years.value = 10;
      setInterestType('compound');
      break;
    case 'retirement':
      principal.value = 50000;
      rate.value = 6;
      years.value = 30;
      setInterestType('compound');
      break;
  }
  
  // Update slider displays
  updateSliderValue(principal);
  updateSliderValue(rate);
  updateSliderValue(years);
  
  interestCalc();
  
  // Show notification
  const funFact = card.querySelector('#fun-fact');
  const originalText = funFact.innerHTML;
  
  switch(type) {
    case 'savings':
      funFact.innerHTML = 'ğŸ’° <strong>High-Yield Tip:</strong> Many online banks offer 4-5% APY on savings accounts!';
      break;
    case 'investment':
      funFact.innerHTML = 'ğŸ“ˆ <strong>Stock Market:</strong> Average S&P 500 return is ~10% annually before inflation.';
      break;
    case 'retirement':
      funFact.innerHTML = 'ğŸ–ï¸ <strong>Retirement Rule:</strong> The "4% Rule" suggests withdrawing 4% annually from retirement savings.';
      break;
  }
  
  setTimeout(() => {
    funFact.innerHTML = originalText;
  }, 5000);
}

function interestCalc() {
  const card = document.currentScript?.closest('.card') || document;
  
  const principal = parseFloat(card.querySelector('#interest-principal').value) || 0;
  const rate = parseFloat(card.querySelector('#interest-rate').value) / 100 || 0;
  const years = parseInt(card.querySelector('#interest-years').value) || 0;
  
  if (!principal || !rate || !years) return;
  
  // Calculate both simple and compound for comparison
  const simpleInterest = principal * rate * years;
  const simpleTotal = principal + simpleInterest;
  
  let compoundTotal, compoundInterest;
  
  if (icCurrentType === 'simple') {
    compoundTotal = simpleTotal;
    compoundInterest = simpleInterest;
  } else {
    if (icCurrentFrequency === 1000) {
      // Continuous compounding
      compoundTotal = principal * Math.exp(rate * years);
    } else {
      compoundTotal = principal * Math.pow(1 + rate / icCurrentFrequency, icCurrentFrequency * years);
    }
    compoundInterest = compoundTotal - principal;
  }
  
  // Format numbers with commas
  function formatMoney(num) {
    return 'Â£' + formatNumber(num.toFixed(2));
  }
  
  function formatNumber(numStr) {
    const num = parseFloat(numStr);
    if (num >= 1000) {
      return num.toLocaleString('en-GB');
    }
    return numStr;
  }
  
  // Update main results
  card.querySelector('#interest-fv').textContent = formatMoney(compoundTotal);
  card.querySelector('#interest-res').textContent = formatMoney(compoundInterest);
  
  // Update growth bar
  const growthPercent = Math.min(100, (compoundInterest / principal) * 100);
  card.querySelector('#growth-bar').style.width = growthPercent + '%';
  
  // Update comparison section
  card.querySelector('#simple-total').textContent = formatMoney(simpleTotal);
  card.querySelector('#compound-total').textContent = formatMoney(compoundTotal);
  
  const difference = compoundTotal - simpleTotal;
  const differencePercent = Math.min(100, (difference / simpleTotal) * 100);
  card.querySelector('#difference-bar').style.width = differencePercent + '%';
  card.querySelector('#difference-amount').textContent = formatMoney(difference);
  
  // Update yearly breakdown
  updateYearlyBreakdown(principal, rate, years, compoundTotal, icCurrentType, icCurrentFrequency);
  
  // Update fun fact based on results
  updateFunFact(principal, compoundTotal, compoundInterest, years);
}

function updateYearlyBreakdown(principal, rate, years, finalTotal, type, frequency) {
  const card = document.currentScript?.closest('.card') || document;
  const tbody = card.querySelector('#yearly-tbody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  let runningTotal = principal;
  
  for (let year = 1; year <= years; year++) {
    let yearlyInterest;
    
    if (type === 'simple') {
      yearlyInterest = principal * rate;
    } else {
      if (frequency === 1000) {
        // Continuous
        const totalAtYear = principal * Math.exp(rate * year);
        const totalAtPrevYear = principal * Math.exp(rate * (year - 1));
        yearlyInterest = totalAtYear - totalAtPrevYear;
        runningTotal = totalAtYear;
      } else {
        // Periodic
        const totalAtYear = principal * Math.pow(1 + rate / frequency, frequency * year);
        const totalAtPrevYear = principal * Math.pow(1 + rate / frequency, frequency * (year - 1));
        yearlyInterest = totalAtYear - totalAtPrevYear;
        runningTotal = totalAtYear;
      }
    }
    
    const row = document.createElement('tr');
    row.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
    row.innerHTML = `
      <td style="padding:8px;color:var(--muted);">Year ${year}</td>
      <td style="padding:8px;text-align:right;color:var(--muted);">Â£${formatNumber(principal.toFixed(2))}</td>
      <td style="padding:8px;text-align:right;color:var(--accent);">Â£${formatNumber(yearlyInterest.toFixed(2))}</td>
      <td style="padding:8px;text-align:right;color:#39ff14;font-weight:600;">Â£${formatNumber(runningTotal.toFixed(2))}</td>
    `;
    
    tbody.appendChild(row);
  }
}

function updateFunFact(principal, finalTotal, interest, years) {
  const card = document.currentScript?.closest('.card') || document;
  const funFact = card.querySelector('#fun-fact');
  
  const growthRatio = finalTotal / principal;
  const annualizedReturn = Math.pow(growthRatio, 1/years) - 1;
  
  let fact = '';
  
  if (growthRatio >= 2) {
    fact = `ğŸ¯ <strong>Doubled your money!</strong> At ${(annualizedReturn*100).toFixed(1)}% annual returns, your money doubles every ${(Math.log(2)/Math.log(1+annualizedReturn)).toFixed(1)} years.`;
  } else if (interest > principal) {
    fact = `ğŸš€ <strong>Great growth!</strong> You earned more in interest than your original investment!`;
  } else if (annualizedReturn > 0.07) {
    fact = `ğŸ“ˆ <strong>Above average!</strong> 7% is the historical stock market average. You're beating it!`;
  } else if (years >= 20) {
    fact = `â³ <strong>Patience pays!</strong> Long-term investing smooths out market volatility.`;
  } else {
    const quotes = [
      `ğŸ’¡ <strong>Did you know?</strong> Starting 10 years earlier can triple your final amount!`,
      `ğŸ’° <strong>Pro tip:</strong> Regular monthly contributions beat one-time investing.`,
      `ğŸ“Š <strong>Rule of 72:</strong> Divide 72 by your interest rate to see how many years to double your money.`,
      `ğŸ¦ <strong>Compound magic:</strong> Interest earns interest, creating exponential growth!`
    ];
    fact = quotes[Math.floor(Math.random() * quotes.length)];
  }
  
  funFact.innerHTML = fact;
}

function shareResults() {
  const card = document.currentScript?.closest('.card') || document;
  const principal = card.querySelector('#interest-principal').value;
  const rate = card.querySelector('#interest-rate').value;
  const years = card.querySelector('#interest-years').value;
  const total = card.querySelector('#interest-fv').textContent;
  
  const shareText = `ğŸ’° I calculated my investment growth with The Most Useful Site! 
  
Initial: Â£${principal}
Rate: ${rate}%
Time: ${years} years
Total: ${total}

Try it yourself!`;

  if (navigator.share) {
    navigator.share({
      title: 'Interest Calculator Results',
      text: shareText,
      url: window.location.href
    });
  } else {
    // Fallback to clipboard
    navigator.clipboard.writeText(shareText).then(() => {
      alert('Results copied to clipboard! ğŸ“‹ Share them anywhere.');
    });
  }
}

// Helper function
function formatNumber(num) {
  return parseFloat(num).toLocaleString('en-GB');
}
</script>

<style>
/* Card-specific styles */
#interest-title {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.9; }
  100% { opacity: 1; }
}

.small {
  font-size: 14px;
  line-height: 1.4;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 20px;
  height: 20px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(45,212,255,0.5);
}

input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
  border: none;
}

.freq-btn {
  padding: 6px 10px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: var(--muted);
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s;
}

.freq-btn.active {
  background: rgba(57,255,20,0.2);
  color: #39ff14;
  border-color: rgba(57,255,20,0.4);
}

.freq-btn:hover {
  background: rgba(255,255,255,0.1);
}

table tbody tr:hover {
  background: rgba(255,255,255,0.03);
}

@media (max-width: 768px) {
  #interest-fv {
    font-size: 28px !important;
  }
  
  .freq-btn {
    flex: 1;
    min-width: 80px;
  }
}
</style>
