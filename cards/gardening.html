<!-- cards/gardening-planner.html -->
<h2 id="gardening-planner-title" style="margin-top:0;color:var(--accent);">ğŸŒ¿ Garden Planning Assistant</h2>

<form aria-describedby="gardening-planner-desc">
  <p id="gardening-planner-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.8);">
    Plan, track, and optimize your garden with planting schedules, care reminders, and plant databases.
    <span style="color:var(--accent);font-weight:500;">Grow your perfect garden!</span>
  </p>

  <!-- Quick Plant Selector -->
  <div style="background:rgba(57,255,20,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(57,255,20,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h4 class="small" style="color:#39ff14;margin:0;">ğŸŒ± Quick Plant Selector</h4>
      <button type="button" onclick="gardeningShowPlantDatabase()" class="small-btn" style="font-size:11px;">Browse Plants</button>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="gardening-plant-type" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Plant Type</label>
        <select id="gardening-plant-type" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="custom">Custom Plant</option>
          <option value="vegetable">Vegetable</option>
          <option value="herb">Herb</option>
          <option value="fruit">Fruit</option>
          <option value="flower">Flower</option>
          <option value="succulent">Succulent</option>
        </select>
      </div>
      
      <div class="field">
        <label for="gardening-plant-name" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Plant Name</label>
        <div style="display:flex;gap:8px;">
          <input id="gardening-plant-name" type="text" placeholder="Enter plant name..." 
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;"
                 list="plant-suggestions">
          <datalist id="plant-suggestions">
            <option>Tomato</option>
            <option>Basil</option>
            <option>Rosemary</option>
            <option>Lavender</option>
            <option>Strawberry</option>
            <option>Sunflower</option>
            <option>Cactus</option>
            <option>Mint</option>
            <option>Pepper</option>
            <option>Lettuce</option>
          </datalist>
          <button type="button" onclick="gardeningLoadPlantInfo()" class="small-btn" style="white-space:nowrap;">Info</button>
        </div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="gardening-plant-location" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Location</label>
        <select id="gardening-plant-location" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="garden">Garden Bed</option>
          <option value="container">Container/Pot</option>
          <option value="indoor">Indoor</option>
          <option value="greenhouse">Greenhouse</option>
          <option value="vertical">Vertical Garden</option>
        </select>
      </div>
      
      <div class="field">
        <label for="gardening-plant-quantity" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Quantity</label>
        <input id="gardening-plant-quantity" type="number" min="1" max="100" value="1" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;text-align:center;">
      </div>
    </div>
  </div>

  <!-- Planting Schedule -->
  <div style="background:rgba(255,165,0,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(255,165,0,0.2);">
    <h4 class="small" style="color:#ffa500;margin-bottom:16px;">ğŸ“… Planting Schedule</h4>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
      <div class="field">
        <label for="gardening-plant-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Planting Date</label>
        <input id="gardening-plant-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
      </div>
      
      <div class="field">
        <label for="gardening-harvest-date" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Expected Harvest</label>
        <input id="gardening-harvest-date" type="date" 
               style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="field">
        <label for="gardening-sunlight" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Sunlight Needs</label>
        <select id="gardening-sunlight" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="full">Full Sun (6+ hours)</option>
          <option value="partial">Partial Sun (4-6 hours)</option>
          <option value="shade">Shade (<4 hours)</option>
          <option value="indirect">Indirect Light</option>
        </select>
      </div>
      
      <div class="field">
        <label for="gardening-water-needs" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Water Needs</label>
        <select id="gardening-water-needs" 
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
          <option value="low">Low (drought tolerant)</option>
          <option value="moderate">Moderate</option>
          <option value="high">High (moist soil)</option>
          <option value="varies">Varies by season</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Care Tasks -->
  <div style="background:rgba(45,212,255,0.05);border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid rgba(45,212,255,0.2);">
    <h4 class="small" style="color:var(--accent);margin-bottom:16px;">ğŸ’§ Care Tasks & Notes</h4>
    
    <div class="field" style="margin-bottom:12px;">
      <label for="gardening-care-task" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Care Task</label>
      <select id="gardening-care-task" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;">
        <option value="water">Watering</option>
        <option value="fertilize">Fertilizing</option>
        <option value="prune">Pruning</option>
        <option value="weed">Weeding</option>
        <option value="pest">Pest Control</option>
        <option value="harvest">Harvesting</option>
        <option value="transplant">Transplanting</option>
        <option value="monitor">Monitoring</option>
      </select>
    </div>
    
    <div class="field" style="margin-bottom:12px;">
      <label for="gardening-task-frequency" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Frequency</label>
      <select id="gardening-task-frequency" 
              style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="biweekly" selected>Every 2 weeks</option>
        <option value="monthly">Monthly</option>
        <option value="seasonal">Seasonal</option>
        <option value="as-needed">As needed</option>
      </select>
    </div>
    
    <div class="field">
      <label for="gardening-notes" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Notes & Observations</label>
      <textarea id="gardening-notes" rows="3" placeholder="Add notes about soil, growth, issues, or observations..."
                style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.2);background:rgba(255,255,255,0.05);color:inherit;resize:vertical;"></textarea>
    </div>
  </div>

  <!-- Quick Examples -->
  <div style="margin-bottom:20px;">
    <div class="small" style="color:var(--accent);margin-bottom:8px;">ğŸŒ± Quick Examples:</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button type="button" onclick="gardeningLoadExample('tomato')" class="small-btn">ğŸ… Tomatoes</button>
      <button type="button" onclick="gardeningLoadExample('herb')" class="small-btn">ğŸŒ¿ Herb Garden</button>
      <button type="button" onclick="gardeningLoadExample('succulent')" class="small-btn">ğŸŒµ Succulents</button>
      <button type="button" onclick="gardeningLoadExample('flower')" class="small-btn">ğŸŒ» Sunflowers</button>
      <button type="button" onclick="gardeningLoadExample('strawberry')" class="small-btn">ğŸ“ Strawberries</button>
    </div>
  </div>

  <div class="actions" style="display:flex;gap:10px;">
    <button type="button" onclick="gardeningAddPlant(this)" 
            style="flex:1;padding:14px;background:linear-gradient(135deg, rgba(57,255,20,0.2), rgba(45,212,255,0.1));border:1px solid rgba(57,255,20,0.4);border-radius:8px;color:#39ff14;font-weight:600;cursor:pointer;font-size:16px;">
      ğŸŒ¿ Add to Garden
    </button>
    <button type="button" onclick="gardeningReset(this)"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
    <button type="button" onclick="gardeningViewCalendar()"
            style="padding:12px 16px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:8px;color:#ffa500;cursor:pointer;">
      ğŸ“… Calendar
    </button>
  </div>
</form>

<div id="gardening-results" aria-live="polite" style="margin-top:20px;display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h3 class="small" style="color:var(--accent);margin:0;">ğŸŒ» Your Garden Plan</h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="gardening-plant-count" class="small" style="color:rgba(45,212,255,0.8);">0 plants</div>
      <div id="gardening-task-count" class="small" style="color:rgba(57,255,20,0.8);">0 tasks</div>
    </div>
  </div>

  <!-- Garden Overview -->
  <div id="gardening-overview" style="margin-bottom:20px;">
    <!-- Will be filled by JavaScript -->
  </div>

  <!-- Plant List -->
  <div id="gardening-plant-list-container" style="margin-bottom:20px;display:none;">
    <h4 class="small" style="color:#39ff14;margin-bottom:12px;">ğŸŒ± Your Plants</h4>
    <div id="gardening-plant-list" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;border:1px solid rgba(57,255,20,0.2);">
      <!-- Plants will be listed here -->
    </div>
  </div>

  <!-- Care Schedule -->
  <div id="gardening-schedule-container" style="margin-bottom:20px;display:none;">
    <h4 class="small" style="color:#ffa500;margin-bottom:12px;">ğŸ“… Upcoming Care Tasks</h4>
    <div id="gardening-schedule-list" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;border:1px solid rgba(255,165,0,0.2);max-height:300px;overflow-y:auto;">
      <!-- Tasks will be listed here -->
    </div>
  </div>

  <!-- Garden Tips -->
  <div id="gardening-tips-container" style="margin-bottom:20px;display:none;">
    <h4 class="small" style="color:var(--accent);margin-bottom:12px;">ğŸ’¡ Garden Tips</h4>
    <div id="gardening-tips-content" style="background:rgba(0,0,0,0.2);border-radius:10px;padding:16px;border:1px solid rgba(45,212,255,0.2);">
      <!-- Tips will be inserted here -->
    </div>
  </div>

  <div style="margin-top:20px;">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px;">
      <button onclick="gardeningExportData()" 
              style="padding:10px;background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.2);border-radius:8px;color:var(--accent);cursor:pointer;font-size:12px;">
        ğŸ“‹ Export Data
      </button>
      <button onclick="gardeningPrintPlan()" 
              style="padding:10px;background:rgba(57,255,20,0.05);border:1px solid rgba(57,255,20,0.2);border-radius:8px;color:#39ff14;cursor:pointer;font-size:12px;">
        ğŸ–¨ï¸ Print Plan
      </button>
      <button onclick="gardeningShareGarden()" 
              style="padding:10px;background:rgba(255,165,0,0.05);border:1px solid rgba(255,165,0,0.2);border-radius:8px;color:#ffa500;cursor:pointer;font-size:12px;">
        ğŸ“± Share
      </button>
    </div>

    <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center;">
      <div id="gardening-hint" class="small" style="color:#39ff14;"></div>
      <button onclick="gardeningShowReminders()" 
              style="padding:6px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:12px;">
        â° Set Reminders
      </button>
    </div>
  </div>
</div>

<!-- Plant Database Modal (simplified inline version) -->
<div id="gardening-database" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:20px;z-index:10000;max-width:500px;max-height:80vh;overflow-y:auto;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 style="color:var(--accent);margin:0;">ğŸŒ¿ Plant Database</h3>
    <button onclick="gardeningHidePlantDatabase()" style="background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:20px;">Ã—</button>
  </div>
  <div id="gardening-database-content">
    <!-- Will be filled by JavaScript -->
  </div>
</div>

<script>
/* gardening-planner.html
   - Comprehensive gardening planning and tracking tool
   - Scoped with gardening- prefix
*/

// Plant database with care information
const gardeningPlants = {
  'tomato': {
    name: 'Tomato',
    type: 'vegetable',
    sunlight: 'full',
    water: 'moderate',
    spacing: '60-90 cm',
    harvest: '60-80 days',
    tips: ['Stake for support', 'Remove lower leaves', 'Water at base only']
  },
  'basil': {
    name: 'Basil',
    type: 'herb',
    sunlight: 'full',
    water: 'moderate',
    spacing: '30-45 cm',
    harvest: '60-90 days',
    tips: ['Pinch flowers for bushier growth', 'Harvest from top']
  },
  'rosemary': {
    name: 'Rosemary',
    type: 'herb',
    sunlight: 'full',
    water: 'low',
    spacing: '60-90 cm',
    harvest: 'Year-round',
    tips: ['Drought tolerant', 'Prune after flowering']
  },
  'lavender': {
    name: 'Lavender',
    type: 'flower',
    sunlight: 'full',
    water: 'low',
    spacing: '60-90 cm',
    harvest: 'Year 2+',
    tips: ['Well-draining soil', 'Prune in spring']
  },
  'strawberry': {
    name: 'Strawberry',
    type: 'fruit',
    sunlight: 'full',
    water: 'moderate',
    spacing: '30-45 cm',
    harvest: '60-90 days',
    tips: ['Use straw mulch', 'Replace plants every 3 years']
  },
  'sunflower': {
    name: 'Sunflower',
    type: 'flower',
    sunlight: 'full',
    water: 'moderate',
    spacing: '30-60 cm',
    harvest: '70-100 days',
    tips: ['Support tall varieties', 'Attracts pollinators']
  },
  'cactus': {
    name: 'Cactus',
    type: 'succulent',
    sunlight: 'full',
    water: 'low',
    spacing: 'Varies',
    harvest: 'N/A',
    tips: ['Minimal watering', 'Well-draining soil']
  },
  'mint': {
    name: 'Mint',
    type: 'herb',
    sunlight: 'partial',
    water: 'high',
    spacing: '30-45 cm',
    harvest: '60 days',
    tips: ['Grows aggressively', 'Keep in container']
  },
  'pepper': {
    name: 'Bell Pepper',
    type: 'vegetable',
    sunlight: 'full',
    water: 'moderate',
    spacing: '45-60 cm',
    harvest: '60-90 days',
    tips: ['Warm soil needed', 'Support heavy fruits']
  },
  'lettuce': {
    name: 'Lettuce',
    type: 'vegetable',
    sunlight: 'partial',
    water: 'high',
    spacing: '20-30 cm',
    harvest: '30-60 days',
    tips: ['Cool weather crop', 'Harvest outer leaves']
  }
};

// Example gardens
const gardeningExamples = {
  'tomato': {
    plantName: 'Tomato',
    plantType: 'vegetable',
    location: 'garden',
    quantity: 3,
    sunlight: 'full',
    waterNeeds: 'moderate',
    careTask: 'water',
    frequency: 'weekly'
  },
  'herb': {
    plantName: 'Basil',
    plantType: 'herb',
    location: 'container',
    quantity: 2,
    sunlight: 'full',
    waterNeeds: 'moderate',
    careTask: 'prune',
    frequency: 'biweekly'
  },
  'succulent': {
    plantName: 'Cactus',
    plantType: 'succulent',
    location: 'indoor',
    quantity: 1,
    sunlight: 'full',
    waterNeeds: 'low',
    careTask: 'water',
    frequency: 'monthly'
  },
  'flower': {
    plantName: 'Sunflower',
    plantType: 'flower',
    location: 'garden',
    quantity: 5,
    sunlight: 'full',
    waterNeeds: 'moderate',
    careTask: 'water',
    frequency: 'weekly'
  },
  'strawberry': {
    plantName: 'Strawberry',
    plantType: 'fruit',
    location: 'container',
    quantity: 4,
    sunlight: 'full',
    waterNeeds: 'moderate',
    careTask: 'fertilize',
    frequency: 'monthly'
  }
};

// Gardening data storage
let gardeningData = {
  plants: [], // Array of plant objects
  tasks: [],  // Array of care tasks
  lastUpdated: null
};

// Initialize
function gardeningInit() {
  const card = document.currentScript?.closest('.card') || document;
  
  // Set today's date as default planting date
  const today = new Date().toISOString().split('T')[0];
  const plantDateInput = card.querySelector('#gardening-plant-date');
  if (plantDateInput) {
    plantDateInput.value = today;
    
    // Set harvest date 90 days from now
    const harvestDate = new Date();
    harvestDate.setDate(harvestDate.getDate() + 90);
    const harvestDateInput = card.querySelector('#gardening-harvest-date');
    if (harvestDateInput) {
      harvestDateInput.value = harvestDate.toISOString().split('T')[0];
    }
  }
  
  // Load saved data from localStorage
  gardeningLoadSavedData();
  
  console.log('Gardening Planner initialized');
}

// Load example garden
function gardeningLoadExample(exampleKey) {
  const card = document.currentScript?.closest('.card') || document;
  const example = gardeningExamples[exampleKey];
  
  if (!example) return;
  
  // Set form values
  card.querySelector('#gardening-plant-name').value = example.plantName;
  card.querySelector('#gardening-plant-type').value = example.plantType;
  card.querySelector('#gardening-plant-location').value = example.location;
  card.querySelector('#gardening-plant-quantity').value = example.quantity;
  card.querySelector('#gardening-sunlight').value = example.sunlight;
  card.querySelector('#gardening-water-needs').value = example.waterNeeds;
  card.querySelector('#gardening-care-task').value = example.careTask;
  card.querySelector('#gardening-task-frequency').value = example.frequency;
  
  const hint = card.querySelector('#gardening-hint');
  hint.textContent = `Loaded ${example.plantName} example`;
  hint.style.color = '#39ff14';
  setTimeout(() => {
    if (hint.textContent.includes('Loaded')) hint.textContent = '';
  }, 2000);
}

// Load plant information from database
function gardeningLoadPlantInfo() {
  const card = document.currentScript?.closest('.card') || document;
  const plantName = card.querySelector('#gardening-plant-name').value.toLowerCase();
  
  if (!plantName) return;
  
  // Find matching plant
  let plantInfo = null;
  for (const [key, plant] of Object.entries(gardeningPlants)) {
    if (plant.name.toLowerCase().includes(plantName) || key.includes(plantName)) {
      plantInfo = plant;
      break;
    }
  }
  
  if (plantInfo) {
    // Update form with plant info
    card.querySelector('#gardening-plant-type').value = plantInfo.type;
    card.querySelector('#gardening-sunlight').value = plantInfo.sunlight;
    card.querySelector('#gardening-water-needs').value = plantInfo.water;
    
    const hint = card.querySelector('#gardening-hint');
    hint.textContent = `Loaded info for ${plantInfo.name}: ${plantInfo.tips[0]}`;
    hint.style.color = '#39ff14';
    setTimeout(() => {
      if (hint.textContent.includes('Loaded info')) hint.textContent = '';
    }, 3000);
  } else {
    const hint = card.querySelector('#gardening-hint');
    hint.textContent = `No info found for "${plantName}" - using custom settings`;
    hint.style.color = '#ffa500';
    setTimeout(() => hint.textContent = '', 3000);
  }
}

// Show plant database
function gardeningShowPlantDatabase() {
  const databaseDiv = document.getElementById('gardening-database');
  const contentDiv = document.getElementById('gardening-database-content');
  
  let html = '<div style="display:grid;gap:12px;">';
  
  Object.values(gardeningPlants).forEach(plant => {
    html += `<div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(45,212,255,0.1);">`;
    html += `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">`;
    html += `<strong style="color:var(--accent);">${plant.name}</strong>`;
    html += `<span style="color:#39ff14;font-size:12px;text-transform:capitalize;">${plant.type}</span>`;
    html += `</div>`;
    html += `<div style="font-size:13px;color:rgba(230,250,255,0.8);margin-bottom:6px;">`;
    html += `â˜€ï¸ ${plant.sunlight} | ğŸ’§ ${plant.water} | ğŸ“ ${plant.spacing}`;
    html += `</div>`;
    html += `<div style="font-size:12px;color:rgba(230,250,255,0.6);">`;
    html += `<strong>Tips:</strong> ${plant.tips.join(', ')}`;
    html += `</div>`;
    html += `<button onclick="gardeningSelectPlant('${plant.name.toLowerCase()}')" style="margin-top:8px;padding:4px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:4px;color:#39ff14;cursor:pointer;font-size:11px;">Select</button>`;
    html += `</div>`;
  });
  
  html += '</div>';
  contentDiv.innerHTML = html;
  databaseDiv.style.display = 'block';
  
  // Add overlay
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;';
  overlay.id = 'gardening-overlay';
  overlay.onclick = gardeningHidePlantDatabase;
  document.body.appendChild(overlay);
}

// Hide plant database
function gardeningHidePlantDatabase() {
  const databaseDiv = document.getElementById('gardening-database');
  const overlay = document.getElementById('gardening-overlay');
  
  databaseDiv.style.display = 'none';
  if (overlay) overlay.remove();
}

// Select plant from database
function gardeningSelectPlant(plantKey) {
  const card = document.currentScript?.closest('.card') || document;
  const plant = gardeningPlants[plantKey];
  
  if (plant) {
    card.querySelector('#gardening-plant-name').value = plant.name;
    card.querySelector('#gardening-plant-type').value = plant.type;
    card.querySelector('#gardening-sunlight').value = plant.sunlight;
    card.querySelector('#gardening-water-needs').value = plant.water;
  }
  
  gardeningHidePlantDatabase();
}

// Add plant to garden
function gardeningAddPlant(btn) {
  const card = btn.closest('.card') || document;
  
  // Get all form values
  const plantName = card.querySelector('#gardening-plant-name').value.trim();
  const plantType = card.querySelector('#gardening-plant-type').value;
  const location = card.querySelector('#gardening-plant-location').value;
  const quantity = parseInt(card.querySelector('#gardening-plant-quantity').value) || 1;
  const plantDate = card.querySelector('#gardening-plant-date').value;
  const harvestDate = card.querySelector('#gardening-harvest-date').value;
  const sunlight = card.querySelector('#gardening-sunlight').value;
  const waterNeeds = card.querySelector('#gardening-water-needs').value;
  const careTask = card.querySelector('#gardening-care-task').value;
  const frequency = card.querySelector('#gardening-task-frequency').value;
  const notes = card.querySelector('#gardening-notes').value.trim();
  
  // Validate required fields
  if (!plantName || !plantDate) {
    const hint = card.querySelector('#gardening-hint');
    hint.textContent = 'Please enter plant name and planting date';
    hint.style.color = '#ff2d55';
    return;
  }
  
  // Create plant object
  const plant = {
    id: Date.now(),
    name: plantName,
    type: plantType,
    location: location,
    quantity: quantity,
    planted: plantDate,
    harvest: harvestDate,
    sunlight: sunlight,
    water: waterNeeds,
    notes: notes,
    added: new Date().toISOString()
  };
  
  // Create care task
  const task = {
    id: Date.now() + 1,
    plantId: plant.id,
    plantName: plantName,
    task: careTask,
    frequency: frequency,
    lastCompleted: null,
    nextDue: gardeningCalculateNextDue(frequency),
    notes: notes
  };
  
  // Add to data
  gardeningData.plants.push(plant);
  gardeningData.tasks.push(task);
  gardeningData.lastUpdated = new Date().toISOString();
  
  // Save to localStorage
  gardeningSaveData();
  
  // Update display
  gardeningUpdateDisplay(card);
  
  // Reset form (keep dates for convenience)
  card.querySelector('#gardening-plant-name').value = '';
  card.querySelector('#gardening-plant-quantity').value = 1;
  card.querySelector('#gardening-notes').value = '';
  
  // Show success message
  const hint = card.querySelector('#gardening-hint');
  hint.textContent = `âœ… Added ${quantity} ${plantName} to your garden!`;
  hint.style.color = '#39ff14';
  setTimeout(() => {
    if (hint.textContent.includes('Added')) hint.textContent = '';
  }, 3000);
}

// Calculate next due date for task
function gardeningCalculateNextDue(frequency) {
  const today = new Date();
  const nextDue = new Date(today);
  
  switch (frequency) {
    case 'daily':
      nextDue.setDate(today.getDate() + 1);
      break;
    case 'weekly':
      nextDue.setDate(today.getDate() + 7);
      break;
    case 'biweekly':
      nextDue.setDate(today.getDate() + 14);
      break;
    case 'monthly':
      nextDue.setMonth(today.getMonth() + 1);
      break;
    case 'seasonal':
      nextDue.setMonth(today.getMonth() + 3);
      break;
    default:
      nextDue.setDate(today.getDate() + 7);
  }
  
  return nextDue.toISOString().split('T')[0];
}

// Update garden display
function gardeningUpdateDisplay(card) {
  const resultsDiv = card.querySelector('#gardening-results');
  resultsDiv.style.display = 'block';
  
  // Update counts
  const plantCount = gardeningData.plants.length;
  const taskCount = gardeningData.tasks.length;
  card.querySelector('#gardening-plant-count').textContent = `${plantCount} plant${plantCount !== 1 ? 's' : ''}`;
  card.querySelector('#gardening-task-count').textContent = `${taskCount} task${taskCount !== 1 ? 's' : ''}`;
  
  // Show/hide containers based on data
  const plantListContainer = card.querySelector('#gardening-plant-list-container');
  const scheduleContainer = card.querySelector('#gardening-schedule-container');
  const tipsContainer = card.querySelector('#gardening-tips-container');
  
  if (plantCount > 0) {
    gardeningUpdatePlantList(card);
    plantListContainer.style.display = 'block';
  } else {
    plantListContainer.style.display = 'none';
  }
  
  if (taskCount > 0) {
    gardeningUpdateSchedule(card);
    scheduleContainer.style.display = 'block';
  } else {
    scheduleContainer.style.display = 'none';
  }
  
  // Always show tips
  gardeningUpdateTips(card);
  tipsContainer.style.display = 'block';
  
  // Update overview
  gardeningUpdateOverview(card);
}

// Update plant list
function gardeningUpdatePlantList(card) {
  const container = card.querySelector('#gardening-plant-list');
  
  if (gardeningData.plants.length === 0) {
    container.innerHTML = '<div style="color:rgba(230,250,255,0.6);text-align:center;padding:20px;">No plants added yet</div>';
    return;
  }
  
  let html = '<div style="display:grid;gap:12px;">';
  
  gardeningData.plants.forEach(plant => {
    const daysSince = Math.floor((new Date() - new Date(plant.planted)) / (1000 * 60 * 60 * 24));
    const daysToHarvest = plant.harvest ? Math.floor((new Date(plant.harvest) - new Date()) / (1000 * 60 * 60 * 24)) : null;
    
    html += `<div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border-left:4px solid ${gardeningGetPlantColor(plant.type)};">`;
    html += `<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">`;
    html += `<div>`;
    html += `<strong style="color:var(--accent);">${plant.name}</strong>`;
    html += `<div style="font-size:12px;color:rgba(230,250,255,0.6);margin-top:2px;">`;
    html += `${plant.quantity} Ã— ${plant.location} | â˜€ï¸ ${plant.sunlight} | ğŸ’§ ${plant.water}`;
    html += `</div>`;
    html += `</div>`;
    html += `<div style="text-align:right;">`;
    html += `<div style="font-size:11px;color:rgba(230,250,255,0.6);">Planted: ${plant.planted}</div>`;
    if (daysToHarvest && daysToHarvest > 0) {
      html += `<div style="font-size:11px;color:#39ff14;">Harvest in ${daysToHarvest} days</div>`;
    }
    html += `</div>`;
    html += `</div>`;
    
    if (plant.notes) {
      html += `<div style="font-size:12px;color:rgba(230,250,255,0.8);margin-top:8px;padding:8px;background:rgba(255,255,255,0.02);border-radius:4px;">`;
      html += `<em>${plant.notes}</em>`;
      html += `</div>`;
    }
    
    html += `</div>`;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// Update care schedule
function gardeningUpdateSchedule(card) {
  const container = card.querySelector('#gardening-schedule-list');
  
  if (gardeningData.tasks.length === 0) {
    container.innerHTML = '<div style="color:rgba(230,250,255,0.6);text-align:center;padding:20px;">No care tasks scheduled</div>';
    return;
  }
  
  // Sort tasks by next due date
  const sortedTasks = [...gardeningData.tasks].sort((a, b) => {
    return new Date(a.nextDue) - new Date(b.nextDue);
  });
  
  let html = '<div style="display:grid;gap:8px;">';
  
  sortedTasks.forEach(task => {
    const today = new Date().toISOString().split('T')[0];
    const isOverdue = task.nextDue < today;
    const isToday = task.nextDue === today;
    
    html += `<div style="display:flex;align-items:center;gap:12px;padding:10px;background:rgba(255,255,255,0.03);border-radius:6px;border-left:4px solid ${isOverdue ? '#ff2d55' : isToday ? '#ffa500' : '#39ff14'};">`;
    html += `<div style="color:${isOverdue ? '#ff2d55' : isToday ? '#ffa500' : '#39ff14'};font-size:20px;">${gardeningGetTaskIcon(task.task)}</div>`;
    html += `<div style="flex:1;">`;
    html += `<div style="font-weight:600;color:var(--accent);">${task.plantName}</div>`;
    html += `<div style="font-size:12px;color:rgba(230,250,255,0.8);">${task.task.charAt(0).toUpperCase() + task.task.slice(1)} (${task.frequency})</div>`;
    html += `</div>`;
    html += `<div style="text-align:right;">`;
    html += `<div style="font-size:11px;color:${isOverdue ? '#ff2d55' : isToday ? '#ffa500' : '#39ff14'};">`;
    if (isOverdue) {
      html += `Overdue`;
    } else if (isToday) {
      html += `Today`;
    } else {
      const daysUntil = Math.floor((new Date(task.nextDue) - new Date()) / (1000 * 60 * 60 * 24));
      html += `In ${daysUntil} days`;
    }
    html += `</div>`;
    html += `<div style="font-size:10px;color:rgba(230,250,255,0.6);">${task.nextDue}</div>`;
    html += `</div>`;
    html += `</div>`;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// Update garden tips
function gardeningUpdateTips(card) {
  const container = card.querySelector('#gardening-tips-content');
  const tips = [
    'ğŸ’§ Water in the morning to reduce evaporation',
    'ğŸŒ± Rotate crops each season to prevent soil depletion',
    'ğŸ Plant flowers to attract pollinators',
    'ğŸ‚ Add compost to improve soil health',
    'ğŸ” Check plants regularly for pests and diseases',
    'âœ‚ï¸ Prune dead or diseased branches promptly',
    'ğŸŒ Group plants with similar sunlight needs together',
    'ğŸ’¦ Use mulch to retain soil moisture',
    'ğŸ“… Keep a garden journal to track progress',
    'ğŸŒ§ï¸ Adjust watering based on weather conditions'
  ];
  
  // Select random tips
  const selectedTips = [];
  while (selectedTips.length < 3) {
    const tip = tips[Math.floor(Math.random() * tips.length)];
    if (!selectedTips.includes(tip)) {
      selectedTips.push(tip);
    }
  }
  
  let html = '<div style="display:grid;gap:8px;">';
  selectedTips.forEach(tip => {
    html += `<div style="display:flex;align-items:start;gap:8px;">`;
    html += `<span style="color:#39ff14;">â€¢</span>`;
    html += `<span style="flex:1;">${tip}</span>`;
    html += `</div>`;
  });
  html += '</div>';
  
  container.innerHTML = html;
}

// Update garden overview
function gardeningUpdateOverview(card) {
  const container = card.querySelector('#gardening-overview');
  
  if (gardeningData.plants.length === 0) {
    container.innerHTML = `
      <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:40px;border:1px solid rgba(45,212,255,0.2);text-align:center;">
        <div style="font-size:48px;margin-bottom:16px;">ğŸŒ±</div>
        <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">Your Garden is Empty</div>
        <div style="color:rgba(230,250,255,0.7);">Add your first plant to get started!</div>
      </div>
    `;
    return;
  }
  
  // Calculate statistics
  const plantTypes = {};
  const locations = {};
  let totalPlants = 0;
  
  gardeningData.plants.forEach(plant => {
    plantTypes[plant.type] = (plantTypes[plant.type] || 0) + 1;
    locations[plant.location] = (locations[plant.location] || 0) + 1;
    totalPlants += plant.quantity;
  });
  
  // Count overdue tasks
  const today = new Date().toISOString().split('T')[0];
  const overdueTasks = gardeningData.tasks.filter(task => task.nextDue < today).length;
  
  let html = `<div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:20px;border:1px solid rgba(45,212,255,0.2);">`;
  html += `<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px;">`;
  
  html += `<div style="text-align:center;padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;">`;
  html += `<div style="font-size:24px;font-weight:600;color:#39ff14;">${totalPlants}</div>`;
  html += `<div class="small" style="color:rgba(230,250,255,0.7);">Total Plants</div>`;
  html += `</div>`;
  
  html += `<div style="text-align:center;padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;">`;
  html += `<div style="font-size:24px;font-weight:600;color:var(--accent);">${gardeningData.plants.length}</div>`;
  html += `<div class="small" style="color:rgba(230,250,255,0.7);">Different Species</div>`;
  html += `</div>`;
  
  html += `<div style="text-align:center;padding:12px;background:rgba(${overdueTasks > 0 ? '255,45,85' : '57,255,20'},0.05);border-radius:8px;">`;
  html += `<div style="font-size:24px;font-weight:600;color:${overdueTasks > 0 ? '#ff2d55' : '#39ff14'};">${overdueTasks}</div>`;
  html += `<div class="small" style="color:rgba(230,250,255,0.7);">Overdue Tasks</div>`;
  html += `</div>`;
  html += `</div>`;
  
  // Plant type breakdown
  if (Object.keys(plantTypes).length > 0) {
    html += `<div class="small" style="color:var(--accent);margin-bottom:8px;">Plant Types:</div>`;
    html += `<div style="display:flex;gap:8px;flex-wrap:wrap;">`;
    
    Object.entries(plantTypes).forEach(([type, count]) => {
      html += `<div style="padding:6px 12px;background:rgba(255,255,255,0.05);border-radius:20px;border:1px solid ${gardeningGetPlantColor(type)};">`;
      html += `<span style="color:${gardeningGetPlantColor(type)};">${type}</span>`;
      html += `<span style="color:var(--accent);margin-left:4px;">${count}</span>`;
      html += `</div>`;
    });
    
    html += `</div>`;
  }
  
  html += `</div>`;
  container.innerHTML = html;
}

// Get color for plant type
function gardeningGetPlantColor(type) {
  const colors = {
    'vegetable': '#39ff14',
    'herb': '#2dd4ff',
    'fruit': '#ffa500',
    'flower': '#9d4edd',
    'succulent': '#ff2d55',
    'custom': '#ffcc00'
  };
  return colors[type] || colors.custom;
}

// Get icon for task type
function gardeningGetTaskIcon(task) {
  const icons = {
    'water': 'ğŸ’§',
    'fertilize': 'ğŸŒ±',
    'prune': 'âœ‚ï¸',
    'weed': 'ğŸŒ¿',
    'pest': 'ğŸ›',
    'harvest': 'ğŸ›’',
    'transplant': 'ğŸ”„',
    'monitor': 'ğŸ‘€'
  };
  return icons[task] || 'ğŸ“';
}

// View calendar
function gardeningViewCalendar() {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#gardening-hint');
  
  hint.textContent = 'Calendar view would show planting/harvest dates (simulated)';
  hint.style.color = '#ffa500';
  setTimeout(() => {
    if (hint.textContent.includes('Calendar')) hint.textContent = '';
  }, 3000);
}

// Export garden data
function gardeningExportData() {
  if (gardeningData.plants.length === 0) {
    gardeningShowMessage('No garden data to export', '#ff2d55');
    return;
  }
  
  const dataStr = JSON.stringify(gardeningData, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'my-garden-plan.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  gardeningShowMessage('âœ… Garden data exported!', '#39ff14');
}

// Print garden plan
function gardeningPrintPlan() {
  if (gardeningData.plants.length === 0) {
    gardeningShowMessage('No garden plan to print', '#ff2d55');
    return;
  }
  
  // In a real implementation, this would open a print-friendly view
  gardeningShowMessage('Print view would open (simulated)', '#ffa500');
}

// Share garden
function gardeningShareGarden() {
  if (gardeningData.plants.length === 0) {
    gardeningShowMessage('No garden to share', '#ff2d55');
    return;
  }
  
  const plantCount = gardeningData.plants.length;
  const shareText = `ğŸŒ¿ My Garden: ${plantCount} plant${plantCount !== 1 ? 's' : ''} growing! Planned with The Most Useful Site's Gardening Planner.`;
  
  if (navigator.share) {
    navigator.share({
      title: 'My Garden Plan',
      text: shareText,
      url: window.location.href
    }).catch(console.error);
  } else {
    navigator.clipboard.writeText(shareText).then(() => {
      gardeningShowMessage('âœ… Garden info copied to share!', '#39ff14');
    });
  }
}

// Show reminders
function gardeningShowReminders() {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#gardening-hint');
  
  if (gardeningData.tasks.length === 0) {
    hint.textContent = 'Add care tasks to set reminders';
    hint.style.color = '#ff2d55';
    return;
  }
  
  const overdueCount = gardeningData.tasks.filter(task => task.nextDue < new Date().toISOString().split('T')[0]).length;
  
  if (overdueCount > 0) {
    hint.textContent = `âš ï¸ You have ${overdueCount} overdue care task${overdueCount !== 1 ? 's' : ''}!`;
    hint.style.color = '#ff2d55';
  } else {
    hint.textContent = 'âœ… All tasks are up to date!';
    hint.style.color = '#39ff14';
  }
  
  setTimeout(() => {
    if (hint.textContent.includes('overdue') || hint.textContent.includes('up to date')) hint.textContent = '';
  }, 4000);
}

// Save data to localStorage
function gardeningSaveData() {
  try {
    localStorage.setItem('gardeningData', JSON.stringify(gardeningData));
  } catch (e) {
    console.error('Failed to save gardening data:', e);
  }
}

// Load saved data from localStorage
function gardeningLoadSavedData() {
  try {
    const saved = localStorage.getItem('gardeningData');
    if (saved) {
      gardeningData = JSON.parse(saved);
      
      // Update next due dates for tasks
      const today = new Date().toISOString().split('T')[0];
      gardeningData.tasks.forEach(task => {
        if (!task.nextDue || task.nextDue < today) {
          task.nextDue = gardeningCalculateNextDue(task.frequency);
        }
      });
    }
  } catch (e) {
    console.error('Failed to load gardening data:', e);
  }
}

// Reset garden
function gardeningReset(btn) {
  const card = btn.closest('.card') || document;
  
  if (gardeningData.plants.length > 0) {
    if (!confirm('Are you sure you want to clear your garden plan? This cannot be undone.')) {
      return;
    }
  }
  
  // Reset form
  card.querySelector('form').reset();
  
  // Reset data
  gardeningData = { plants: [], tasks: [], lastUpdated: null };
  gardeningSaveData();
  
  // Hide results
  const resultsDiv = card.querySelector('#gardening-results');
  resultsDiv.style.display = 'none';
  
  // Clear hint
  const hint = card.querySelector('#gardening-hint');
  hint.textContent = '';
  
  // Reset dates to today
  const today = new Date().toISOString().split('T')[0];
  const plantDateInput = card.querySelector('#gardening-plant-date');
  if (plantDateInput) {
    plantDateInput.value = today;
    
    const harvestDate = new Date();
    harvestDate.setDate(harvestDate.getDate() + 90);
    const harvestDateInput = card.querySelector('#gardening-harvest-date');
    if (harvestDateInput) {
      harvestDateInput.value = harvestDate.toISOString().split('T')[0];
    }
  }
  
  gardeningShowMessage('Garden plan cleared', '#ffa500');
}

// Helper function to show messages
function gardeningShowMessage(message, color) {
  const card = document.currentScript?.closest('.card') || document;
  const hint = card.querySelector('#gardening-hint');
  hint.textContent = message;
  hint.style.color = color;
  setTimeout(() => {
    if (hint.textContent === message) hint.textContent = '';
  }, 3000);
}

// Initialize on load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', gardeningInit);
} else {
  gardeningInit();
}
</script>

<style>
#gardening-planner-title {
  color: var(--accent);
  margin-top: 0;
  font-size: 1.3rem;
}

.small-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: inherit;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 12px;
  padding: 4px 8px;
}

.small-btn:hover {
  background: rgba(45,212,255,0.1);
  border-color: rgba(45,212,255,0.3);
}

#gardening-database {
  max-width: 90vw;
  width: 500px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7);
}

@media (max-width: 768px) {
  .field {
    grid-column: 1 / -1 !important;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .actions button {
    width: 100%;
    margin: 4px 0 !important;
  }
  
  #gardening-database {
    width: 95vw;
    max-height: 90vh;
  }
}
</style>
