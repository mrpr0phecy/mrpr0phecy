<h2 id="chemistry-title" style="margin-top:0;">Chemistry Helper</h2>

<form aria-describedby="chemistry-desc">
  <p id="chemistry-desc" class="small">Calculate molar mass, balance equations, analyze compounds, and reference periodic table data.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px;">
    <div class="field">
      <label for="chem-mode">Calculation Mode</label>
      <select id="chem-mode" style="width:100%;">
        <option value="molar-mass">Molar Mass Calculator</option>
        <option value="equation-balancer">Equation Balancer</option>
        <option value="element-info">Element Information</option>
        <option value="compound-analyzer">Compound Analyzer</option>
        <option value="stoichiometry">Stoichiometry</option>
        <option value="density">Density Calculator</option>
        <option value="concentration">Concentration Calculator</option>
      </select>
    </div>

    <div class="field">
      <label for="chem-input">Input</label>
      <input id="chem-input" type="text" placeholder="e.g. H2O or NaOH + HCl → NaCl + H2O" />
    </div>
  </div>

  <div id="chem-extra-fields" style="margin-top:10px; display:none;">
    <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <div class="field">
        <label for="chem-mass">Mass (g)</label>
        <input id="chem-mass" type="number" step="0.001" placeholder="0.000" />
      </div>
      <div class="field">
        <label for="chem-volume">Volume (L)</label>
        <input id="chem-volume" type="number" step="0.001" placeholder="0.000" />
      </div>
      <div class="field">
        <label for="chem-concentration">Concentration (M)</label>
        <input id="chem-concentration" type="number" step="0.001" placeholder="0.000" />
      </div>
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="chemCalculate()" style="background:#4dabf7;">Calculate</button>
    <button type="button" class="secondary" onclick="chemReset()">Reset</button>
    <button type="button" onclick="chemCopy()" style="background:#6c757d;">Copy Result</button>
    <button type="button" onclick="chemSave()" style="background:#28a745;">Save</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <h3 class="small" style="margin:0;">Results</h3>
    <div class="small" style="opacity:0.7;" id="chem-mode-display">Molar Mass Calculator</div>
  </div>
  
  <div id="chem-output" style="background:#f8f9fa; padding:15px; border-radius:8px; min-height:100px; font-family:monospace; white-space:pre-wrap;"></div>

  <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px;">
    <div class="small" style="display:flex; gap:16px;">
      <div>Status: <span id="chem-status">Ready</span></div>
      <div>Precision: <span id="chem-precision">High</span></div>
      <div>Units: <span id="chem-units">g/mol</span></div>
    </div>
    <div id="chem-hint" class="small" style="opacity:0.9; text-align:right;"></div>
  </div>
</div>

<div id="chem-periodic-table" style="margin-top:20px;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <h4 class="small">Periodic Table Quick Reference</h4>
    <button onclick="togglePeriodicTable()" class="small" style="padding:4px 8px; background:#6c757d; color:white; border:none; border-radius:4px; cursor:pointer;">
      Hide Table
    </button>
  </div>
  
  <div id="periodic-table-container" style="background:white; border:1px solid #dee2e6; border-radius:8px; padding:12px; overflow-x:auto;">
    <div id="periodic-table-grid" style="display:grid; grid-template-columns:repeat(18, 1fr); gap:2px; min-width:800px;">
      <!-- Periodic table will be generated by JavaScript -->
    </div>
  </div>
  
  <div class="small" style="margin-top:8px; color:#6c757d; display:flex; justify-content:space-between;">
    <div>
      <span style="display:inline-block; width:12px; height:12px; background:#4dabf7; border-radius:2px; margin-right:4px;"></span>
      Alkali Metals
      <span style="display:inline-block; width:12px; height:12px; background:#20c997; border-radius:2px; margin:0 8px 0 12px;"></span>
      Alkaline Earth
    </div>
    <div>
      Click any element for details
    </div>
  </div>
</div>

<div id="chem-history" style="margin-top:20px; display:none;">
  <h4 class="small">Calculation History</h4>
  <div id="chem-history-list" style="max-height:200px; overflow-y:auto; background:#f8f9fa; padding:8px; border-radius:6px;"></div>
</div>

<script>
/* Enhanced Chemistry Helper
   - Molar mass calculations
   - Equation balancing
   - Element information
   - Compound analysis
   - Interactive periodic table
*/

const periodicTable = {
  "H": { name: "Hydrogen", atomicNumber: 1, mass: 1.008, group: 1, period: 1, category: "nonmetal", electronegativity: 2.20 },
  "He": { name: "Helium", atomicNumber: 2, mass: 4.0026, group: 18, period: 1, category: "noblegas", electronegativity: null },
  "Li": { name: "Lithium", atomicNumber: 3, mass: 6.94, group: 1, period: 2, category: "alkalimetal", electronegativity: 0.98 },
  "Be": { name: "Beryllium", atomicNumber: 4, mass: 9.0122, group: 2, period: 2, category: "alkalineearth", electronegativity: 1.57 },
  "B": { name: "Boron", atomicNumber: 5, mass: 10.81, group: 13, period: 2, category: "metalloid", electronegativity: 2.04 },
  "C": { name: "Carbon", atomicNumber: 6, mass: 12.011, group: 14, period: 2, category: "nonmetal", electronegativity: 2.55 },
  "N": { name: "Nitrogen", atomicNumber: 7, mass: 14.007, group: 15, period: 2, category: "nonmetal", electronegativity: 3.04 },
  "O": { name: "Oxygen", atomicNumber: 8, mass: 15.999, group: 16, period: 2, category: "nonmetal", electronegativity: 3.44 },
  "F": { name: "Fluorine", atomicNumber: 9, mass: 18.998, group: 17, period: 2, category: "halogen", electronegativity: 3.98 },
  "Ne": { name: "Neon", atomicNumber: 10, mass: 20.180, group: 18, period: 2, category: "noblegas", electronegativity: null },
  "Na": { name: "Sodium", atomicNumber: 11, mass: 22.990, group: 1, period: 3, category: "alkalimetal", electronegativity: 0.93 },
  "Mg": { name: "Magnesium", atomicNumber: 12, mass: 24.305, group: 2, period: 3, category: "alkalineearth", electronegativity: 1.31 },
  "Al": { name: "Aluminium", atomicNumber: 13, mass: 26.982, group: 13, period: 3, category: "posttransition", electronegativity: 1.61 },
  "Si": { name: "Silicon", atomicNumber: 14, mass: 28.085, group: 14, period: 3, category: "metalloid", electronegativity: 1.90 },
  "P": { name: "Phosphorus", atomicNumber: 15, mass: 30.974, group: 15, period: 3, category: "nonmetal", electronegativity: 2.19 },
  "S": { name: "Sulfur", atomicNumber: 16, mass: 32.06, group: 16, period: 3, category: "nonmetal", electronegativity: 2.58 },
  "Cl": { name: "Chlorine", atomicNumber: 17, mass: 35.45, group: 17, period: 3, category: "halogen", electronegativity: 3.16 },
  "Ar": { name: "Argon", atomicNumber: 18, mass: 39.948, group: 18, period: 3, category: "noblegas", electronegativity: null },
  "K": { name: "Potassium", atomicNumber: 19, mass: 39.098, group: 1, period: 4, category: "alkalimetal", electronegativity: 0.82 },
  "Ca": { name: "Calcium", atomicNumber: 20, mass: 40.078, group: 2, period: 4, category: "alkalineearth", electronegativity: 1.00 },
  "Fe": { name: "Iron", atomicNumber: 26, mass: 55.845, group: 8, period: 4, category: "transition", electronegativity: 1.83 },
  "Cu": { name: "Copper", atomicNumber: 29, mass: 63.546, group: 11, period: 4, category: "transition", electronegativity: 1.90 },
  "Zn": { name: "Zinc", atomicNumber: 30, mass: 65.38, group: 12, period: 4, category: "transition", electronegativity: 1.65 },
  "Ag": { name: "Silver", atomicNumber: 47, mass: 107.87, group: 11, period: 5, category: "transition", electronegativity: 1.93 },
  "Au": { name: "Gold", atomicNumber: 79, mass: 196.97, group: 11, period: 6, category: "transition", electronegativity: 2.54 },
  "Hg": { name: "Mercury", atomicNumber: 80, mass: 200.59, group: 12, period: 6, category: "transition", electronegativity: 2.00 },
  "Pb": { name: "Lead", atomicNumber: 82, mass: 207.2, group: 14, period: 6, category: "posttransition", electronegativity: 2.33 },
  "U": { name: "Uranium", atomicNumber: 92, mass: 238.03, group: null, period: 7, category: "actinide", electronegativity: 1.38 }
};

let calculationHistory = JSON.parse(localStorage.getItem('chemHistory') || '[]');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  generatePeriodicTable();
  setupEventListeners();
  updateModeDisplay();
  loadHistory();
});

function setupEventListeners() {
  const modeSelect = document.getElementById('chem-mode');
  const extraFields = document.getElementById('chem-extra-fields');
  
  if (modeSelect) {
    modeSelect.addEventListener('change', function() {
      updateModeDisplay();
      
      // Show/hide extra fields based on mode
      const mode = this.value;
      if (mode === 'stoichiometry' || mode === 'density' || mode === 'concentration') {
        extraFields.style.display = 'block';
      } else {
        extraFields.style.display = 'none';
      }
    });
  }
}

function updateModeDisplay() {
  const modeSelect = document.getElementById('chem-mode');
  const modeDisplay = document.getElementById('chem-mode-display');
  const unitsDisplay = document.getElementById('chem-units');
  
  if (!modeSelect || !modeDisplay) return;
  
  const mode = modeSelect.value;
  let displayName = '';
  let units = '';
  
  switch(mode) {
    case 'molar-mass':
      displayName = 'Molar Mass Calculator';
      units = 'g/mol';
      break;
    case 'equation-balancer':
      displayName = 'Equation Balancer';
      units = 'balanced coefficients';
      break;
    case 'element-info':
      displayName = 'Element Information';
      units = 'various';
      break;
    case 'compound-analyzer':
      displayName = 'Compound Analyzer';
      units = 'composition %';
      break;
    case 'stoichiometry':
      displayName = 'Stoichiometry';
      units = 'moles/g/L';
      break;
    case 'density':
      displayName = 'Density Calculator';
      units = 'g/mL';
      break;
    case 'concentration':
      displayName = 'Concentration Calculator';
      units = 'M (mol/L)';
      break;
  }
  
  modeDisplay.textContent = displayName;
  unitsDisplay.textContent = units;
  
  // Update input placeholder
  const inputField = document.getElementById('chem-input');
  if (inputField) {
    switch(mode) {
      case 'molar-mass':
        inputField.placeholder = 'e.g. H2O, C6H12O6, NaCl';
        break;
      case 'equation-balancer':
        inputField.placeholder = 'e.g. H2 + O2 → H2O';
        break;
      case 'element-info':
        inputField.placeholder = 'e.g. H, Fe, Carbon';
        break;
      case 'compound-analyzer':
        inputField.placeholder = 'e.g. H2SO4, CH4';
        break;
      case 'stoichiometry':
        inputField.placeholder = 'e.g. 2H2 + O2 → 2H2O';
        break;
      case 'density':
        inputField.placeholder = 'e.g. H2O';
        break;
      case 'concentration':
        inputField.placeholder = 'e.g. NaCl';
        break;
    }
  }
}

function chemCalculate() {
  const mode = document.getElementById('chem-mode').value;
  const input = document.getElementById('chem-input').value.trim();
  const output = document.getElementById('chem-output');
  const status = document.getElementById('chem-status');
  
  if (!input) {
    showChemHint("Please enter a chemical formula or equation", "error");
    return;
  }
  
  status.textContent = "Calculating...";
  status.style.color = "#fd7e14";
  
  try {
    let result = "";
    
    switch(mode) {
      case 'molar-mass':
        result = calculateMolarMass(input);
        break;
      case 'equation-balancer':
        result = balanceEquation(input);
        break;
      case 'element-info':
        result = getElementInfo(input);
        break;
      case 'compound-analyzer':
        result = analyzeCompound(input);
        break;
      case 'stoichiometry':
        result = calculateStoichiometry(input);
        break;
      case 'density':
        result = calculateDensity(input);
        break;
      case 'concentration':
        result = calculateConcentration(input);
        break;
    }
    
    output.textContent = result;
    status.textContent = "Success";
    status.style.color = "#28a745";
    
    // Add to history
    addToHistory(mode, input, result);
    
    showChemHint("Calculation completed", "success");
    
  } catch (error) {
    output.textContent = `Error: ${error.message}\n\nPlease check your input format.`;
    status.textContent = "Error";
    status.style.color = "#dc3545";
    showChemHint(error.message, "error");
  }
}

function calculateMolarMass(formula) {
  const elements = parseFormula(formula);
  let totalMass = 0;
  let breakdown = [];
  
  for (const [symbol, count] of Object.entries(elements)) {
    if (!periodicTable[symbol]) {
      throw new Error(`Unknown element: ${symbol}`);
    }
    
    const elementMass = periodicTable[symbol].mass;
    const elementTotal = elementMass * count;
    totalMass += elementTotal;
    
    breakdown.push(`${symbol}${count > 1 ? count : ''}: ${elementMass.toFixed(3)} × ${count} = ${elementTotal.toFixed(3)} g/mol`);
  }
  
  return `Molar Mass of ${formula}:\n${'═'.repeat(40)}\n\n` +
         `Total: ${totalMass.toFixed(3)} g/mol\n\n` +
         `Breakdown:\n${breakdown.join('\n')}\n\n` +
         `This means:\n` +
         `• 1 mole of ${formula} weighs ${totalMass.toFixed(3)} grams\n` +
         `• ${totalMass.toFixed(3)} g contains 6.022×10²³ molecules`;
}

function balanceEquation(equation) {
  // Simple equation balancing for common reactions
  const commonEquations = {
    "H2 + O2 → H2O": "2H2 + O2 → 2H2O",
    "N2 + H2 → NH3": "N2 + 3H2 → 2NH3",
    "CH4 + O2 → CO2 + H2O": "CH4 + 2O2 → CO2 + 2H2O",
    "Fe + O2 → Fe2O3": "4Fe + 3O2 → 2Fe2O3",
    "NaOH + HCl → NaCl + H2O": "NaOH + HCl → NaCl + H2O",
    "CaCO3 → CaO + CO2": "CaCO3 → CaO + CO2",
    "C6H12O6 + O2 → CO2 + H2O": "C6H12O6 + 6O2 → 6CO2 + 6H2O",
    "Al + O2 → Al2O3": "4Al + 3O2 → 2Al2O3"
  };
  
  if (commonEquations[equation]) {
    return `Balanced Equation:\n${'═'.repeat(40)}\n\n` +
           `Original: ${equation}\n` +
           `Balanced: ${commonEquations[equation]}\n\n` +
           `Reaction Type: ${getReactionType(equation)}\n\n` +
           `Note: For complex equations, use algebraic balancing methods.`;
  } else {
    return `Equation: ${equation}\n${'═'.repeat(40)}\n\n` +
           `Unable to automatically balance this equation.\n` +
           `Try one of these common reactions:\n` +
           `• H2 + O2 → H2O\n` +
           `• CH4 + O2 → CO2 + H2O\n` +
           `• NaOH + HCl → NaCl + H2O\n` +
           `• C6H12O6 + O2 → CO2 + H2O`;
  }
}

function getElementInfo(input) {
  // Convert element name to symbol if needed
  let symbol = input;
  if (input.length > 2) {
    // Try to find by name
    const found = Object.entries(periodicTable).find(([sym, data]) => 
      data.name.toLowerCase() === input.toLowerCase()
    );
    if (found) {
      symbol = found[0];
    }
  }
  
  const element = periodicTable[symbol.toUpperCase()];
  
  if (!element) {
    throw new Error(`Element not found: ${input}`);
  }
  
  const categoryColors = {
    'alkalimetal': '#4dabf7',
    'alkalineearth': '#20c997',
    'transition': '#ff6b6b',
    'posttransition': '#ffd43b',
    'metalloid': '#51cf66',
    'nonmetal': '#9775fa',
    'halogen': '#f783ac',
    'noblegas': '#868e96',
    'actinide': '#ff922b'
  };
  
  return `Element: ${element.name} (${symbol})\n${'═'.repeat(40)}\n\n` +
         `Atomic Number: ${element.atomicNumber}\n` +
         `Atomic Mass: ${element.mass} g/mol\n` +
         `Category: ${element.category.replace(/([A-Z])/g, ' $1').trim()}\n` +
         `Group: ${element.group || 'N/A'}\n` +
         `Period: ${element.period}\n` +
         `Electronegativity: ${element.electronegativity || 'N/A'}\n\n` +
         `Common Uses:\n${getElementUses(symbol)}`;
}

function analyzeCompound(formula) {
  const elements = parseFormula(formula);
  const molarMass = calculateMolarMassRaw(formula);
  let result = `Compound Analysis: ${formula}\n${'═'.repeat(40)}\n\n`;
  
  result += `Elemental Composition:\n`;
  
  for (const [symbol, count] of Object.entries(elements)) {
    if (!periodicTable[symbol]) continue;
    
    const elementMass = periodicTable[symbol].mass;
    const elementTotal = elementMass * count;
    const percentage = (elementTotal / molarMass) * 100;
    
    result += `• ${symbol}: ${count} atom${count > 1 ? 's' : ''} = ${percentage.toFixed(2)}%\n`;
  }
  
  result += `\nMolar Mass: ${molarMass.toFixed(3)} g/mol\n`;
  result += `Empirical Formula: ${getEmpiricalFormula(elements)}\n`;
  result += `Molecular Formula: ${formula}\n\n`;
  
  const commonName = getCommonCompoundName(formula);
  if (commonName) {
    result += `Common Name: ${commonName}\n`;
  }
  
  result += `Properties: ${getCompoundProperties(formula)}`;
  
  return result;
}

function calculateStoichiometry(equation) {
  const mass = parseFloat(document.getElementById('chem-mass').value) || 0;
  const volume = parseFloat(document.getElementById('chem-volume').value) || 0;
  const concentration = parseFloat(document.getElementById('chem-concentration').value) || 0;
  
  if (!mass && !volume && !concentration) {
    throw new Error("Enter mass, volume, or concentration values");
  }
  
  // Simple stoichiometry for common equations
  const simpleEquations = {
    "2H2 + O2 → 2H2O": {
      reactants: ["H2", "O2"],
      products: ["H2O"],
      ratios: { "H2": 2, "O2": 1, "H2O": 2 }
    },
    "NaOH + HCl → NaCl + H2O": {
      reactants: ["NaOH", "HCl"],
      products: ["NaCl", "H2O"],
      ratios: { "NaOH": 1, "HCl": 1, "NaCl": 1, "H2O": 1 }
    }
  };
  
  let result = `Stoichiometry Calculation\n${'═'.repeat(40)}\n\n`;
  result += `Equation: ${equation}\n\n`;
  
  if (mass > 0) {
    result += `Given mass: ${mass} g\n`;
    // Calculate moles for a simple compound
    const formula = equation.split('→')[0].split('+')[0].trim();
    const molarMass = calculateMolarMassRaw(formula);
    const moles = mass / molarMass;
    result += `Moles of ${formula}: ${moles.toFixed(4)} mol\n\n`;
  }
  
  if (volume > 0 && concentration > 0) {
    result += `Given volume: ${volume} L\n`;
    result += `Concentration: ${concentration} M\n`;
    const moles = volume * concentration;
    result += `Moles: ${moles.toFixed(4)} mol\n`;
  }
  
  result += `\nStoichiometric Ratios:\n`;
  result += `Use the balanced equation coefficients to convert between substances.\n`;
  result += `Example: For 2H2 + O2 → 2H2O, 2 moles H2 produce 2 moles H2O.`;
  
  return result;
}

function calculateDensity(formula) {
  const commonDensities = {
    "H2O": { density: 1.00, state: "liquid", temp: "4°C" },
    "NaCl": { density: 2.16, state: "solid", temp: "25°C" },
    "Fe": { density: 7.87, state: "solid", temp: "25°C" },
    "Al": { density: 2.70, state: "solid", temp: "25°C" },
    "Cu": { density: 8.96, state: "solid", temp: "25°C" },
    "Au": { density: 19.32, state: "solid", temp: "25°C" },
    "Hg": { density: 13.53, state: "liquid", temp: "25°C" },
    "C": { density: 2.26, state: "solid", temp: "25°C" }
  };
  
  const info = commonDensities[formula];
  
  if (info) {
    return `Density of ${formula}\n${'═'.repeat(40)}\n\n` +
           `Density: ${info.density} g/cm³\n` +
           `State: ${info.state}\n` +
           `Temperature: ${info.temp}\n\n` +
           `Calculations:\n` +
           `• Mass = Density × Volume\n` +
           `• Volume = Mass ÷ Density\n` +
           `• Density = Mass ÷ Volume`;
  } else {
    return `Density information not available for ${formula}.\n\n` +
           `Common substances with known densities:\n` +
           `• H2O (Water): 1.00 g/cm³\n` +
           `• NaCl (Salt): 2.16 g/cm³\n` +
           `• Fe (Iron): 7.87 g/cm³\n` +
           `• Al (Aluminium): 2.70 g/cm³`;
  }
}

function calculateConcentration(formula) {
  const mass = parseFloat(document.getElementById('chem-mass').value) || 0;
  const volume = parseFloat(document.getElementById('chem-volume').value) || 0;
  
  if (!mass || !volume) {
    throw new Error("Enter both mass and volume values");
  }
  
  const molarMass = calculateMolarMassRaw(formula);
  const moles = mass / molarMass;
  const concentration = moles / volume;
  
  return `Concentration Calculation\n${'═'.repeat(40)}\n\n` +
         `Compound: ${formula}\n` +
         `Molar Mass: ${molarMass.toFixed(3)} g/mol\n` +
         `Mass: ${mass} g\n` +
         `Volume: ${volume} L\n\n` +
         `Moles = Mass ÷ Molar Mass\n` +
         `= ${mass} ÷ ${molarMass.toFixed(3)}\n` +
         `= ${moles.toFixed(4)} mol\n\n` +
         `Concentration = Moles ÷ Volume\n` +
         `= ${moles.toFixed(4)} ÷ ${volume}\n` +
         `= ${concentration.toFixed(4)} M\n\n` +
         `Result: ${concentration.toFixed(4)} mol/L (Molar)`;
}

// Helper functions
function parseFormula(formula) {
  const elements = {};
  let currentElement = '';
  let currentCount = '';
  
  for (let i = 0; i < formula.length; i++) {
    const char = formula[i];
    
    if (char >= 'A' && char <= 'Z') {
      // New element starting
      if (currentElement) {
        elements[currentElement] = (elements[currentElement] || 0) + (parseInt(currentCount) || 1);
      }
      currentElement = char;
      currentCount = '';
    } else if (char >= 'a' && char <= 'z') {
      // Second letter of element symbol
      currentElement += char;
    } else if (char >= '0' && char <= '9') {
      // Number for count
      currentCount += char;
    }
  }
  
  // Add the last element
  if (currentElement) {
    elements[currentElement] = (elements[currentElement] || 0) + (parseInt(currentCount) || 1);
  }
  
  return elements;
}

function calculateMolarMassRaw(formula) {
  const elements = parseFormula(formula);
  let total = 0;
  
  for (const [symbol, count] of Object.entries(elements)) {
    if (periodicTable[symbol]) {
      total += periodicTable[symbol].mass * count;
    }
  }
  
  return total;
}

function getReactionType(equation) {
  if (equation.includes('+') && equation.includes('→')) {
    if (equation.includes('+ O2 →') && equation.includes('CO2') && equation.includes('H2O')) {
      return 'Combustion';
    } else if (equation.includes('→') && !equation.includes('+')) {
      return 'Decomposition';
    } else if (equation.includes('AB + CD → AD + CB')) {
      return 'Double Displacement';
    } else {
      return 'Synthesis or Single Displacement';
    }
  }
  return 'Unknown';
}

function getElementUses(symbol) {
  const uses = {
    "H": "• Fuel for rockets\n• Hydrogenation of oils\n• Ammonia production",
    "O": "• Respiration (breathing)\n• Steel production\n• Water purification",
    "C": "• All organic compounds\n• Graphite for pencils\n• Diamond for cutting",
    "Fe": "• Steel production\n• Magnets\n• Hemoglobin in blood",
    "Cu": "• Electrical wiring\n• Plumbing pipes\n• Antimicrobial surfaces",
    "Au": "• Jewelry\n• Electronics\n• Financial standard",
    "Na": "• Table salt (NaCl)\n• Street lights\n• Nuclear reactors",
    "Cl": "• Water purification\n• PVC plastic\n• Bleach production"
  };
  
  return uses[symbol] || "Various industrial and biological applications.";
}

function getEmpiricalFormula(elements) {
  // Find simplest ratio
  const counts = Object.values(elements);
  const gcd = findGCD(counts);
  
  let formula = '';
  for (const [symbol, count] of Object.entries(elements)) {
    const simpleCount = count / gcd;
    formula += symbol + (simpleCount > 1 ? simpleCount : '');
  }
  
  return formula;
}

function findGCD(numbers) {
  // Find greatest common divisor
  const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
  return numbers.reduce(gcd);
}

function getCommonCompoundName(formula) {
  const names = {
    "H2O": "Water",
    "NaCl": "Table Salt",
    "CO2": "Carbon Dioxide",
    "CH4": "Methane",
    "C6H12O6": "Glucose",
    "H2SO4": "Sulfuric Acid",
    "HCl": "Hydrochloric Acid",
    "NaOH": "Sodium Hydroxide",
    "NH3": "Ammonia"
  };
  
  return names[formula];
}

function getCompoundProperties(formula) {
  const props = {
    "H2O": "Polar molecule, universal solvent, high heat capacity",
    "NaCl": "Ionic compound, soluble in water, high melting point",
    "CO2": "Linear molecule, greenhouse gas, soluble in water",
    "CH4": "Tetrahedral, flammable, main component of natural gas",
    "C6H12O6": "Monosaccharide, energy source in biology, sweet taste"
  };
  
  return props[formula] || "Properties vary based on structure and bonding.";
}

// Periodic table display
function generatePeriodicTable() {
  const container = document.getElementById('periodic-table-grid');
  if (!container) return;
  
  container.innerHTML = '';
  
  // Create 18x7 grid
  for (let row = 0; row < 7; row++) {
    for (let col = 0; col < 18; col++) {
      const cell = document.createElement('div');
      cell.style.cssText = `
        padding: 4px;
        text-align: center;
        font-size: 0.8em;
        border: 1px solid #dee2e6;
        min-height: 40px;
        cursor: pointer;
        transition: all 0.2s ease;
      `;
      
      // Find element at this position
      const element = findElementAtPosition(col + 1, row + 1);
      
      if (element) {
        cell.innerHTML = `
          <div style="font-weight:bold; font-size:1.1em;">${element.symbol}</div>
          <div style="font-size:0.7em;">${element.atomicNumber}</div>
        `;
        
        // Color by category
        const color = getCategoryColor(element.category);
        cell.style.background = color + '20';
        cell.style.borderColor = color;
        
        cell.onclick = () => showElementDetails(element.symbol);
        cell.onmouseenter = () => {
          cell.style.transform = 'scale(1.05)';
          cell.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
          cell.style.zIndex = '10';
        };
        cell.onmouseleave = () => {
          cell.style.transform = 'scale(1)';
          cell.style.boxShadow = 'none';
          cell.style.zIndex = '1';
        };
      }
      
      container.appendChild(cell);
    }
  }
}

function findElementAtPosition(group, period) {
  for (const [symbol, data] of Object.entries(periodicTable)) {
    if (data.group === group && data.period === period) {
      return { symbol, ...data };
    }
  }
  return null;
}

function getCategoryColor(category) {
  const colors = {
    'alkalimetal': '#4dabf7',
    'alkalineearth': '#20c997',
    'transition': '#ff6b6b',
    'posttransition': '#ffd43b',
    'metalloid': '#51cf66',
    'nonmetal': '#9775fa',
    'halogen': '#f783ac',
    'noblegas': '#868e96',
    'actinide': '#ff922b'
  };
  
  return colors[category] || '#dee2e6';
}

function showElementDetails(symbol) {
  const element = periodicTable[symbol];
  if (!element) return;
  
  const details = `
Element: ${element.name} (${symbol})
${'═'.repeat(40)}

Atomic Number: ${element.atomicNumber}
Atomic Mass: ${element.mass} g/mol
Category: ${element.category.replace(/([A-Z])/g, ' $1').trim()}
Group: ${element.group || 'N/A'}
Period: ${element.period}
Electronegativity: ${element.electronegativity || 'N/A'}

Common Uses:
${getElementUses(symbol)}

Sample Calculations:
• Molar mass: ${element.mass} g/mol
• Atoms in 1g: ${(1/element.mass * 6.022e23).toExponential(2)}
• Mass of 1 mole: ${element.mass} grams
  `;
  
  document.getElementById('chem-input').value = symbol;
  document.getElementById('chem-mode').value = 'element-info';
  updateModeDisplay();
  
  const output = document.getElementById('chem-output');
  output.textContent = details;
  
  document.getElementById('chem-status').textContent = "Element Info Loaded";
  document.getElementById('chem-status').style.color = "#28a745";
}

function togglePeriodicTable() {
  const container = document.getElementById('periodic-table-container');
  const button = document.querySelector('#chem-periodic-table button');
  
  if (container.style.display === 'none') {
    container.style.display = 'block';
    button.textContent = 'Hide Table';
  } else {
    container.style.display = 'none';
    button.textContent = 'Show Table';
  }
}

// History functions
function addToHistory(mode, input, result) {
  const entry = {
    id: Date.now(),
    mode: mode,
    input: input,
    result: result.substring(0, 200) + (result.length > 200 ? '...' : ''),
    timestamp: new Date().toLocaleString()
  };
  
  calculationHistory.unshift(entry);
  if (calculationHistory.length > 10) {
    calculationHistory.pop();
  }
  
  localStorage.setItem('chemHistory', JSON.stringify(calculationHistory));
  loadHistory();
}

function loadHistory() {
  const container = document.getElementById('chem-history');
  const list = document.getElementById('chem-history-list');
  
  if (!container || !list) return;
  
  if (calculationHistory.length === 0) {
    container.style.display = 'none';
    return;
  }
  
  container.style.display = 'block';
  list.innerHTML = '';
  
  calculationHistory.forEach(entry => {
    const div = document.createElement('div');
    div.style.cssText = `
      padding: 8px;
      margin-bottom: 4px;
      background: white;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      cursor: pointer;
      font-size: 0.9em;
    `;
    
    div.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <div style="font-weight:500;">${entry.mode.replace('-', ' ')}</div>
        <div style="color:#6c757d; font-size:0.85em;">${entry.timestamp}</div>
      </div>
      <div style="color:#4dabf7; margin:4px 0;">${entry.input}</div>
      <div style="color:#6c757d; font-size:0.85em; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
        ${entry.result}
      </div>
    `;
    
    div.onclick = () => {
      document.getElementById('chem-input').value = entry.input;
      document.getElementById('chem-mode').value = entry.mode;
      updateModeDisplay();
      document.getElementById('chem-output').textContent = entry.result;
    };
    
    list.appendChild(div);
  });
}

function chemReset() {
  document.getElementById('chem-input').value = '';
  document.getElementById('chem-mass').value = '';
  document.getElementById('chem-volume').value = '';
  document.getElementById('chem-concentration').value = '';
  document.getElementById('chem-output').textContent = '';
  document.getElementById('chem-status').textContent = 'Ready';
  document.getElementById('chem-status').style.color = '';
  showChemHint('Form reset', 'info');
}

function chemCopy() {
  const output = document.getElementById('chem-output').textContent;
  if (!output.trim()) {
    showChemHint('No results to copy', 'error');
    return;
  }
  
  navigator.clipboard.writeText(output).then(() => {
    showChemHint('Results copied to clipboard', 'success');
  }).catch(() => {
    alert('Copy failed. Select and copy manually.');
  });
}

function chemSave() {
  const mode = document.getElementById('chem-mode').value;
  const input = document.getElementById('chem-input').value;
  const output = document.getElementById('chem-output').textContent;
  
  if (!input || !output.trim()) {
    showChemHint('Nothing to save', 'error');
    return;
  }
  
  addToHistory(mode, input, output);
  showChemHint('Calculation saved to history', 'success');
}

function showChemHint(message, type) {
  const hint = document.getElementById('chem-hint');
  if (!hint) return;
  
  hint.textContent = message;
  hint.style.color = type === 'error' ? '#dc3545' :
                     type === 'success' ? '#28a745' :
                     type === 'info' ? '#17a2b8' : '#212529';
  
  setTimeout(() => {
    hint.textContent = '';
    hint.style.color = '';
  }, 3000);
}
</script>

<style>
#periodic-table-grid div:hover {
  z-index: 10;
}

#chem-history-list div:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border-color: #4dabf7;
}

.actions button {
  transition: all 0.2s ease;
}

.actions button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

#chem-output {
  line-height: 1.6;
  max-height: 400px;
  overflow-y: auto;
}

.field input, .field select {
  transition: border-color 0.2s;
}

.field input:focus, .field select:focus {
  border-color: #4dabf7 !important;
  outline: none;
}
</style>
