<h2 id="bmr-title" style="margin-top:0;color:var(--accent);position:relative;">
  ğŸ”¥ BMR & TDEE Calculator
  <span style="position:absolute;right:0;top:0;font-size:0.7rem;color:var(--accent);font-weight:normal;">
    Metabolic Tool
  </span>
</h2>

<form aria-describedby="bmr-desc">
  <p id="bmr-desc" class="small" style="margin-bottom:20px;color:rgba(230,250,255,0.9);">
    Calculate your Basal Metabolic Rate (BMR) and Total Daily Energy Expenditure (TDEE) using scientifically validated formulas.
  </p>

  <!-- Personal Information -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <!-- Age Input -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(45,212,255,0.3);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <label for="bmr-age" style="color:var(--accent);font-weight:500;">ğŸ‚ Age</label>
        <span id="bmr-age-display" style="font-size:0.9rem;color:#39ff14;">30 years</span>
      </div>
      
      <div style="margin-bottom:12px;">
        <input id="bmr-age" type="range" min="15" max="80" step="1" value="30" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(45,212,255,0.1);outline:none;accent-color:var(--accent);" />
      </div>
      
      <input id="bmr-age-input" type="number" min="15" max="80" value="30" 
             style="width:100%;padding:12px;border-radius:8px;border:2px solid rgba(45,212,255,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:1rem;" />
      
      <div class="small" style="display:flex;justify-content:space-between;margin-top:8px;color:rgba(230,250,255,0.7);">
        <span>15</span>
        <span>80</span>
      </div>
    </div>

    <!-- Gender Selection -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(255,204,0,0.3);">
      <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">âš§ Gender</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
        <button type="button" onclick="bmrSelectGender('male')" id="bmr-gender-male"
                style="padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(20,20,20,0.8));border:2px solid var(--accent);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:500;">
          â™‚ Male
        </button>
        <button type="button" onclick="bmrSelectGender('female')" id="bmr-gender-female"
                style="padding:12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
          â™€ Female
        </button>
        <button type="button" onclick="bmrSelectGender('other')" id="bmr-gender-other"
                style="padding:12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
          âš§ Other
        </button>
      </div>
      <input type="hidden" id="bmr-gender" value="male">
    </div>
  </div>

  <!-- Height and Weight -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <!-- Height Input -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(57,255,20,0.3);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <label for="bmr-height" style="color:var(--accent);font-weight:500;">ğŸ“ Height</label>
        <span id="bmr-height-display" style="font-size:0.9rem;color:#39ff14;">175 cm</span>
      </div>
      
      <div style="margin-bottom:12px;">
        <input id="bmr-height" type="range" min="100" max="220" step="1" value="175" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(57,255,20,0.1);outline:none;accent-color:#39ff14;" />
      </div>
      
      <div style="display:flex;align-items:center;gap:12px;">
        <input id="bmr-height-input" type="number" min="100" max="220" step="0.1" value="175" 
               style="flex:1;padding:12px;border-radius:8px;border:2px solid rgba(57,255,20,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:1rem;" />
        <div style="display:flex;gap:8px;">
          <button type="button" onclick="bmrSetHeightUnit('cm')" style="padding:6px 12px;background:rgba(57,255,20,0.2);border:2px solid #39ff14;border-radius:6px;color:#39ff14;cursor:pointer;">cm</button>
          <button type="button" onclick="bmrSetHeightUnit('in')" style="padding:6px 12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">in</button>
        </div>
      </div>
      
      <div class="small" style="display:flex;justify-content:space-between;margin-top:8px;color:rgba(230,250,255,0.7);">
        <span>100 cm</span>
        <span>220 cm</span>
      </div>
    </div>

    <!-- Weight Input -->
    <div class="field" style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(255,204,0,0.3);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <label for="bmr-weight" style="color:var(--accent);font-weight:500;">âš–ï¸ Weight</label>
        <span id="bmr-weight-display" style="font-size:0.9rem;color:#ffcc00;">70 kg</span>
      </div>
      
      <div style="margin-bottom:12px;">
        <input id="bmr-weight" type="range" min="40" max="150" step="0.5" value="70" 
               style="width:100%;height:8px;border-radius:4px;background:rgba(255,204,0,0.1);outline:none;accent-color:#ffcc00;" />
      </div>
      
      <div style="display:flex;align-items:center;gap:12px;">
        <input id="bmr-weight-input" type="number" min="40" max="150" step="0.1" value="70" 
               style="flex:1;padding:12px;border-radius:8px;border:2px solid rgba(255,204,0,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:1rem;" />
        <div style="display:flex;gap:8px;">
          <button type="button" onclick="bmrSetWeightUnit('kg')" style="padding:6px 12px;background:rgba(255,204,0,0.2);border:2px solid #ffcc00;border-radius:6px;color:#ffcc00;cursor:pointer;">kg</button>
          <button type="button" onclick="bmrSetWeightUnit('lb')" style="padding:6px 12px;background:rgba(20,20,20,0.8);border:2px solid rgba(255,255,255,0.1);border-radius:6px;color:inherit;cursor:pointer;">lb</button>
        </div>
      </div>
      
      <div class="small" style="display:flex;justify-content:space-between;margin-top:8px;color:rgba(230,250,255,0.7);">
        <span>40 kg</span>
        <span>150 kg</span>
      </div>
    </div>
  </div>

  <!-- Activity Level -->
  <div style="background:rgba(20,20,20,0.8);border-radius:10px;padding:16px;border:2px solid rgba(157,78,221,0.3);margin-bottom:20px;">
    <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">ğŸƒâ€â™‚ï¸ Activity Level</div>
    <select id="bmr-activity" 
            style="width:100%;padding:12px;border-radius:8px;border:2px solid rgba(157,78,221,0.3);background:rgba(20,20,20,0.8);color:inherit;font-size:0.95rem;appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill="%239d4edd" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');background-repeat:no-repeat;background-position:right 12px center;background-size:16px;">
      <option value="1.2">Sedentary (office job, little/no exercise)</option>
      <option value="1.375">Lightly Active (light exercise 1-3 days/week)</option>
      <option value="1.55" selected>Moderately Active (moderate exercise 3-5 days/week)</option>
      <option value="1.725">Very Active (hard exercise 6-7 days/week)</option>
      <option value="1.9">Extra Active (very hard exercise & physical job)</option>
    </select>
    <div id="bmr-activity-description" class="small" style="margin-top:8px;color:rgba(230,250,255,0.7);">
      Moderate exercise 3-5 days/week
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;margin-top:20px;">
    <button type="button" onclick="bmrCalculate()" id="bmr-calculate-btn"
            style="padding:14px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(20,20,20,0.8));border:2px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s;">
      ğŸ”¥ Calculate
    </button>
    <button type="button" onclick="bmrCalculateGoals()"
            style="padding:14px;background:rgba(57,255,20,0.1);border:2px solid rgba(57,255,20,0.3);color:#39ff14;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ¯ Set Goals
    </button>
    <button type="button" onclick="bmrReset()" id="bmr-reset-btn"
            style="padding:14px;background:rgba(255,77,77,0.1);border:2px solid rgba(255,77,77,0.3);color:#ff4d4d;border-radius:8px;cursor:pointer;transition:all 0.2s;">
      ğŸ”„ Reset
    </button>
  </div>
</form>

<!-- Results Display -->
<div class="results" aria-live="polite" style="margin-top:20px;">
  <!-- Metabolic Results -->
  <div style="background:linear-gradient(135deg, rgba(45,212,255,0.07), rgba(20,20,20,0.9));border-radius:12px;padding:20px;border:2px solid rgba(45,212,255,0.2);margin-bottom:16px;box-shadow:0 8px 32px rgba(0,0,0,0.4);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="color:var(--accent);margin:0;font-size:1.1rem;">ğŸ“Š Metabolic Results</h3>
      <button onclick="bmrCopyResults()" style="padding:6px 12px;background:rgba(45,212,255,0.1);border:2px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:0.9rem;">
        ğŸ“‹ Copy
      </button>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:16px;margin-bottom:20px;">
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(45,212,255,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ˜´ Basal Metabolic Rate</div>
        <div id="bmr-result" style="font-size:2rem;font-weight:700;color:#4dabf7;">â€“</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:8px;">Calories at complete rest</div>
      </div>
      
      <div style="text-align:center;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(57,255,20,0.2);">
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-bottom:8px;">ğŸ”¥ Total Daily Energy Expenditure</div>
        <div id="tdee-result" style="font-size:2rem;font-weight:700;color:#39ff14;">â€“</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);margin-top:8px;">Calories with activity</div>
      </div>
    </div>
    
    <!-- Calorie Goals -->
    <div style="margin-bottom:20px;">
      <div style="color:var(--accent);font-weight:500;margin-bottom:12px;">ğŸ¯ Calorie Goals</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:10px;">
        <div style="text-align:center;padding:12px;background:rgba(40,0,0,0.4);border-radius:8px;border:2px solid rgba(255,77,77,0.3);">
          <div style="font-size:0.9rem;color:#ff4d4d;font-weight:600;margin-bottom:8px;">ğŸš« Extreme Cut</div>
          <div id="bmr-loss-extreme" style="font-size:1.3rem;font-weight:700;color:#ff4d4d;">â€“</div>
          <div style="font-size:0.8rem;color:rgba(255,200,200,0.8);margin-top:4px;">TDEE - 1000 kcal</div>
        </div>
        
        <div style="text-align:center;padding:12px;background:rgba(60,40,0,0.4);border-radius:8px;border:2px solid rgba(255,165,0,0.3);">
          <div style="font-size:0.9rem;color:#ffa500;font-weight:600;margin-bottom:8px;">ğŸ’ª Weight Loss</div>
          <div id="bmr-loss-moderate" style="font-size:1.3rem;font-weight:700;color:#ffa500;">â€“</div>
          <div style="font-size:0.8rem;color:rgba(255,220,200,0.8);margin-top:4px;">TDEE - 500 kcal</div>
        </div>
        
        <div style="text-align:center;padding:12px;background:rgba(0,60,0,0.4);border-radius:8px;border:2px solid rgba(57,255,20,0.3);">
          <div style="font-size:0.9rem;color:#39ff14;font-weight:600;margin-bottom:8px;">âš–ï¸ Maintenance</div>
          <div id="bmr-maintenance" style="font-size:1.3rem;font-weight:700;color:#39ff14;">â€“</div>
          <div style="font-size:0.8rem;color:rgba(200,255,200,0.8);margin-top:4px;">TDEE</div>
        </div>
        
        <div style="text-align:center;padding:12px;background:rgba(0,0,60,0.4);border-radius:8px;border:2px solid rgba(45,212,255,0.3);">
          <div style="font-size:0.9rem;color:#4dabf7;font-weight:600;margin-bottom:8px;">ğŸ’ Weight Gain</div>
          <div id="bmr-gain-moderate" style="font-size:1.3rem;font-weight:700;color:#4dabf7;">â€“</div>
          <div style="font-size:0.8rem;color:rgba(200,230,255,0.8);margin-top:4px;">TDEE + 500 kcal</div>
        </div>
      </div>
    </div>
    
    <!-- Macronutrients -->
    <div id="bmr-macros-section" style="display:none;padding:16px;background:rgba(0,0,0,0.4);border-radius:10px;border:2px solid rgba(157,78,221,0.3);">
      <div style="color:#9d4edd;font-weight:600;margin-bottom:12px;">ğŸ½ï¸ Macronutrients (for Weight Loss)</div>
      
      <div style="margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div style="font-size:0.9rem;color:rgba(230,250,255,0.7);">Distribution:</div>
          <div style="font-size:0.9rem;color:#9d4edd;">Protein 30% | Carbs 40% | Fat 30%</div>
        </div>
        <div style="height:12px;background:linear-gradient(90deg, #4dabf7 30%, #51cf66 40%, #ffd43b 30%);border-radius:6px;margin-bottom:12px;"></div>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
        <div style="text-align:center;padding:10px;background:rgba(45,212,255,0.1);border-radius:8px;border:1px solid rgba(45,212,255,0.3);">
          <div style="font-size:0.9rem;color:#4dabf7;margin-bottom:4px;">ğŸ¥© Protein</div>
          <div id="bmr-protein-grams" style="font-size:1.2rem;font-weight:600;color:#4dabf7;">â€“ g</div>
          <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">4 kcal/g</div>
        </div>
        
        <div style="text-align:center;padding:10px;background:rgba(57,255,20,0.1);border-radius:8px;border:1px solid rgba(57,255,20,0.3);">
          <div style="font-size:0.9rem;color:#39ff14;margin-bottom:4px;">ğŸ Carbohydrates</div>
          <div id="bmr-carbs-grams" style="font-size:1.2rem;font-weight:600;color:#39ff14;">â€“ g</div>
          <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">4 kcal/g</div>
        </div>
        
        <div style="text-align:center;padding:10px;background:rgba(255,204,0,0.1);border-radius:8px;border:1px solid rgba(255,204,0,0.3);">
          <div style="font-size:0.9rem;color:#ffcc00;margin-bottom:4px;">ğŸ¥‘ Fat</div>
          <div id="bmr-fat-grams" style="font-size:1.2rem;font-weight:600;color:#ffcc00;">â€“ g</div>
          <div style="font-size:0.8rem;color:rgba(230,250,255,0.7);">9 kcal/g</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Activity Multiplier Info -->
  <div style="background:rgba(20,20,20,0.9);border-radius:12px;padding:20px;border:2px solid rgba(157,78,221,0.3);margin-bottom:16px;">
    <h3 style="color:#9d4edd;margin:0 0 16px 0;font-size:1.1rem;">ğŸ“ˆ Activity Multipliers</h3>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;">
      <div style="padding:12px;background:rgba(0,0,0,0.4);border-radius:8px;border:1px solid rgba(157,78,221,0.2);">
        <div style="color:#4dabf7;font-weight:600;margin-bottom:4px;">1.2 Ã— BMR</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Sedentary: Office job, little/no exercise</div>
      </div>
      <div style="padding:12px;background:rgba(0,0,0,0.4);border-radius:8px;border:1px solid rgba(157,78,221,0.2);">
        <div style="color:#39ff14;font-weight:600;margin-bottom:4px;">1.375 Ã— BMR</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Lightly Active: Light exercise 1-3 days/week</div>
      </div>
      <div style="padding:12px;background:rgba(0,0,0,0.4);border-radius:8px;border:1px solid rgba(157,78,221,0.2);">
        <div style="color:#ffcc00;font-weight:600;margin-bottom:4px;">1.55 Ã— BMR</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Moderately Active: Moderate exercise 3-5 days/week</div>
      </div>
      <div style="padding:12px;background:rgba(0,0,0,0.4);border-radius:8px;border:1px solid rgba(157,78,221,0.2);">
        <div style="color:#ffa500;font-weight:600;margin-bottom:4px;">1.725 Ã— BMR</div>
        <div style="font-size:0.9rem;color:rgba(230,250,255,0.9);">Very Active: Hard exercise 6-7 days/week</div>
      </div>
    </div>
  </div>

  <!-- Important Disclaimer -->
  <div style="background:rgba(30,0,0,0.6);border-radius:12px;padding:20px;border:2px solid rgba(255,77,77,0.3);">
    <div style="color:#ff6b6b;font-weight:600;margin-bottom:8px;">âš ï¸ Medical Disclaimer</div>
    <div style="font-size:0.9rem;color:rgba(255,200,200,0.9);">
      <strong>BMR & TDEE are estimates only.</strong> Individual metabolism varies based on genetics, body composition, and other factors.
      <ul style="margin:8px 0 8px 20px;">
        <li>These calculations assume average muscle mass</li>
        <li>Accuracy decreases for very lean or very muscular individuals</li>
        <li>Doesn't account for medical conditions or medications</li>
        <li>For athletes, consider body fat percentage measurements</li>
      </ul>
      <strong>Consult a healthcare professional</strong> for personalized nutrition and fitness advice.
      <div style="margin-top:8px;font-size:0.85rem;color:rgba(255,200,200,0.7);">
        Formulas: Mifflin-St Jeor (BMR), Harris-Benedict (alternate)
      </div>
    </div>
  </div>
</div>

<script>
/* bmr-calculator.html
   - Fully functional BMR & TDEE calculator
   - Scoped with bmr- prefix
   - Uses Mifflin-St Jeor formula (most accurate)
*/

// Global configuration
let bmrHeightUnit = 'cm';
let bmrWeightUnit = 'kg';
let bmrGender = 'male';

// Initialize the calculator
function bmrInit() {
    // Set up input synchronization
    bmrSyncInputs();
    
    // Set activity description
    updateActivityDescription();
    
    // Auto-calculate when inputs change
    ['#bmr-age-input', '#bmr-height-input', '#bmr-weight-input'].forEach(selector => {
        const input = document.querySelector(selector);
        if (input) {
            input.addEventListener('input', () => {
                setTimeout(() => bmrCalculate(), 500);
            });
        }
    });
    
    // Activity level change
    const activitySelect = document.querySelector('#bmr-activity');
    if (activitySelect) {
        activitySelect.addEventListener('change', function() {
            updateActivityDescription();
            setTimeout(() => bmrCalculate(), 300);
        });
    }
    
    // Initial calculation
    setTimeout(() => bmrCalculate(), 300);
}

// Synchronize sliders with number inputs
function bmrSyncInputs() {
    // Age sync
    const ageSlider = document.querySelector('#bmr-age');
    const ageInput = document.querySelector('#bmr-age-input');
    const ageDisplay = document.querySelector('#bmr-age-display');
    
    if (ageSlider && ageInput && ageDisplay) {
        ageSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            ageInput.value = value;
            ageDisplay.textContent = value + ' years';
        });
        
        ageInput.addEventListener('input', function() {
            let value = parseInt(this.value) || 30;
            value = Math.min(80, Math.max(15, value));
            ageSlider.value = value;
            ageDisplay.textContent = value + ' years';
        });
    }
    
    // Height sync
    const heightSlider = document.querySelector('#bmr-height');
    const heightInput = document.querySelector('#bmr-height-input');
    const heightDisplay = document.querySelector('#bmr-height-display');
    
    if (heightSlider && heightInput && heightDisplay) {
        heightSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            heightInput.value = value;
            heightDisplay.textContent = value + ' cm';
        });
        
        heightInput.addEventListener('input', function() {
            let value = parseFloat(this.value) || 175;
            value = Math.min(220, Math.max(100, value));
            heightSlider.value = value;
            heightDisplay.textContent = value + ' cm';
        });
    }
    
    // Weight sync
    const weightSlider = document.querySelector('#bmr-weight');
    const weightInput = document.querySelector('#bmr-weight-input');
    const weightDisplay = document.querySelector('#bmr-weight-display');
    
    if (weightSlider && weightInput && weightDisplay) {
        weightSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            weightInput.value = value;
            weightDisplay.textContent = value + ' kg';
        });
        
        weightInput.addEventListener('input', function() {
            let value = parseFloat(this.value) || 70;
            value = Math.min(150, Math.max(40, value));
            weightSlider.value = value;
            weightDisplay.textContent = value + ' kg';
        });
    }
}

// Select gender
function bmrSelectGender(gender) {
    bmrGender = gender;
    
    // Update buttons
    ['male', 'female', 'other'].forEach(g => {
        const btn = document.querySelector(`#bmr-gender-${g}`);
        if (btn) {
            if (g === gender) {
                btn.style.background = 'linear-gradient(135deg, rgba(45,212,255,0.2), rgba(20,20,20,0.8))';
                btn.style.border = '2px solid var(--accent)';
                btn.style.color = 'var(--accent)';
            } else {
                btn.style.background = 'rgba(20,20,20,0.8)';
                btn.style.border = '2px solid rgba(255,255,255,0.1)';
                btn.style.color = 'inherit';
            }
        }
    });
    
    // Auto-calculate
    setTimeout(() => bmrCalculate(), 100);
}

// Set height unit
function bmrSetHeightUnit(unit) {
    bmrHeightUnit = unit;
    
    const heightCmBtn = document.querySelector('[onclick="bmrSetHeightUnit(\'cm\')"]');
    const heightInBtn = document.querySelector('[onclick="bmrSetHeightUnit(\'in\')"]');
    const heightInput = document.querySelector('#bmr-height-input');
    const heightSlider = document.querySelector('#bmr-height');
    const heightDisplay = document.querySelector('#bmr-height-display');
    
    if (!heightInput || !heightSlider) return;
    
    let currentValue = parseFloat(heightInput.value) || 175;
    
    if (unit === 'cm') {
        // Convert inches to centimeters
        if (bmrHeightUnit === 'in') {
            currentValue = Math.round(currentValue * 2.54);
        }
        heightSlider.min = 100;
        heightSlider.max = 220;
        heightSlider.step = 1;
        
        // Update buttons
        if (heightCmBtn) {
            heightCmBtn.style.background = 'rgba(57,255,20,0.2)';
            heightCmBtn.style.border = '2px solid #39ff14';
            heightCmBtn.style.color = '#39ff14';
        }
        if (heightInBtn) {
            heightInBtn.style.background = 'rgba(20,20,20,0.8)';
            heightInBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            heightInBtn.style.color = 'inherit';
        }
    } else if (unit === 'in') {
        // Convert centimeters to inches
        if (bmrHeightUnit === 'cm') {
            currentValue = Math.round(currentValue / 2.54);
        }
        heightSlider.min = 40;
        heightSlider.max = 87;
        heightSlider.step = 0.5;
        
        // Update buttons
        if (heightCmBtn) {
            heightCmBtn.style.background = 'rgba(20,20,20,0.8)';
            heightCmBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            heightCmBtn.style.color = 'inherit';
        }
        if (heightInBtn) {
            heightInBtn.style.background = 'rgba(57,255,20,0.2)';
            heightInBtn.style.border = '2px solid #39ff14';
            heightInBtn.style.color = '#39ff14';
        }
    }
    
    // Apply bounds
    currentValue = Math.min(heightSlider.max, Math.max(heightSlider.min, currentValue));
    
    // Update values
    heightInput.value = currentValue;
    heightSlider.value = currentValue;
    heightDisplay.textContent = currentValue + ' ' + unit;
    
    // Auto-calculate
    setTimeout(() => bmrCalculate(), 100);
}

// Set weight unit
function bmrSetWeightUnit(unit) {
    bmrWeightUnit = unit;
    
    const weightKgBtn = document.querySelector('[onclick="bmrSetWeightUnit(\'kg\')"]');
    const weightLbBtn = document.querySelector('[onclick="bmrSetWeightUnit(\'lb\')"]');
    const weightInput = document.querySelector('#bmr-weight-input');
    const weightSlider = document.querySelector('#bmr-weight');
    const weightDisplay = document.querySelector('#bmr-weight-display');
    
    if (!weightInput || !weightSlider) return;
    
    let currentValue = parseFloat(weightInput.value) || 70;
    
    if (unit === 'kg') {
        // Convert pounds to kilograms
        if (bmrWeightUnit === 'lb') {
            currentValue = Math.round((currentValue / 2.20462) * 10) / 10;
        }
        weightSlider.min = 40;
        weightSlider.max = 150;
        weightSlider.step = 0.5;
        
        // Update buttons
        if (weightKgBtn) {
            weightKgBtn.style.background = 'rgba(255,204,0,0.2)';
            weightKgBtn.style.border = '2px solid #ffcc00';
            weightKgBtn.style.color = '#ffcc00';
        }
        if (weightLbBtn) {
            weightLbBtn.style.background = 'rgba(20,20,20,0.8)';
            weightLbBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            weightLbBtn.style.color = 'inherit';
        }
    } else if (unit === 'lb') {
        // Convert kilograms to pounds
        if (bmrWeightUnit === 'kg') {
            currentValue = Math.round(currentValue * 2.20462 * 10) / 10;
        }
        weightSlider.min = 88;
        weightSlider.max = 330;
        weightSlider.step = 0.5;
        
        // Update buttons
        if (weightKgBtn) {
            weightKgBtn.style.background = 'rgba(20,20,20,0.8)';
            weightKgBtn.style.border = '2px solid rgba(255,255,255,0.1)';
            weightKgBtn.style.color = 'inherit';
        }
        if (weightLbBtn) {
            weightLbBtn.style.background = 'rgba(255,204,0,0.2)';
            weightLbBtn.style.border = '2px solid #ffcc00';
            weightLbBtn.style.color = '#ffcc00';
        }
    }
    
    // Apply bounds
    currentValue = Math.min(weightSlider.max, Math.max(weightSlider.min, currentValue));
    
    // Update values
    weightInput.value = currentValue;
    weightSlider.value = currentValue;
    weightDisplay.textContent = currentValue + ' ' + unit;
    
    // Auto-calculate
    setTimeout(() => bmrCalculate(), 100);
}

// Update activity description
function updateActivityDescription() {
    const activitySelect = document.querySelector('#bmr-activity');
    const descriptionDiv = document.querySelector('#bmr-activity-description');
    
    if (!activitySelect || !descriptionDiv) return;
    
    const selectedOption = activitySelect.options[activitySelect.selectedIndex];
    const multiplier = parseFloat(selectedOption.value);
    
    let description = '';
    switch(multiplier) {
        case 1.2:
            description = 'Sedentary: Office job, little/no exercise';
            break;
        case 1.375:
            description = 'Lightly Active: Light exercise 1-3 days/week';
            break;
        case 1.55:
            description = 'Moderately Active: Moderate exercise 3-5 days/week';
            break;
        case 1.725:
            description = 'Very Active: Hard exercise 6-7 days/week';
            break;
        case 1.9:
            description = 'Extra Active: Very hard exercise & physical job';
            break;
        default:
            description = 'Select your activity level';
    }
    
    descriptionDiv.textContent = description;
}

// Main calculation function
function bmrCalculate() {
    const ageInput = document.querySelector('#bmr-age-input');
    const heightInput = document.querySelector('#bmr-height-input');
    const weightInput = document.querySelector('#bmr-weight-input');
    const activitySelect = document.querySelector('#bmr-activity');
    const calculateBtn = document.querySelector('#bmr-calculate-btn');
    
    if (!ageInput || !heightInput || !weightInput || !activitySelect) return;
    
    // Get and convert values
    let age = parseInt(ageInput.value) || 0;
    let heightCm = parseFloat(heightInput.value) || 0;
    let weightKg = parseFloat(weightInput.value) || 0;
    const activity = parseFloat(activitySelect.value) || 1.55;
    
    // Convert to metric if needed
    if (bmrHeightUnit === 'in') {
        heightCm = heightCm * 2.54; // Convert inches to cm
    }
    
    if (bmrWeightUnit === 'lb') {
        weightKg = weightKg / 2.20462; // Convert pounds to kg
    }
    
    // Validate inputs
    if (age < 15 || age > 80 || heightCm < 100 || weightKg < 40) {
        bmrShowError('Please enter valid values');
        return;
    }
    
    // Visual feedback
    if (calculateBtn) {
        calculateBtn.innerHTML = 'â³ Calculating...';
        calculateBtn.disabled = true;
    }
    
    setTimeout(() => {
        // Calculate BMR using Mifflin-St Jeor formula (most accurate)
        let bmr = 0;
        const heightM = heightCm / 100;
        
        if (bmrGender === 'male') {
            bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;
        } else if (bmrGender === 'female') {
            bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) - 161;
        } else {
            // For 'other', use average of male and female formulas
            const maleBmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;
            const femaleBmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) - 161;
            bmr = (maleBmr + femaleBmr) / 2;
        }
        
        const bmrRounded = Math.round(bmr);
        
        // Calculate TDEE
        const tdee = bmr * activity;
        const tdeeRounded = Math.round(tdee);
        
        // Display results
        bmrDisplayResults(bmrRounded, tdeeRounded);
        
        // Calculate macronutrients
        bmrCalculateMacronutrients(tdeeRounded - 500); // For weight loss goal
        
        // Reset button
        if (calculateBtn) {
            calculateBtn.innerHTML = 'âœ… Calculated';
            setTimeout(() => {
                calculateBtn.innerHTML = 'ğŸ”¥ Calculate';
                calculateBtn.disabled = false;
            }, 1000);
        }
    }, 300);
}

// Display BMR and TDEE results
function bmrDisplayResults(bmr, tdee) {
    // Update main results
    const bmrResult = document.querySelector('#bmr-result');
    const tdeeResult = document.querySelector('#tdee-result');
    
    if (bmrResult) bmrResult.textContent = bmr.toLocaleString() + ' kcal';
    if (tdeeResult) tdeeResult.textContent = tdee.toLocaleString() + ' kcal';
    
    // Update calorie goals
    const lossExtreme = document.querySelector('#bmr-loss-extreme');
    const lossModerate = document.querySelector('#bmr-loss-moderate');
    const maintenance = document.querySelector('#bmr-maintenance');
    const gainModerate = document.querySelector('#bmr-gain-moderate');
    
    if (lossExtreme) lossExtreme.textContent = (tdee - 1000).toLocaleString();
    if (lossModerate) lossModerate.textContent = (tdee - 500).toLocaleString();
    if (maintenance) maintenance.textContent = tdee.toLocaleString();
    if (gainModerate) gainModerate.textContent = (tdee + 500).toLocaleString();
    
    // Show macronutrients section
    const macrosSection = document.querySelector('#bmr-macros-section');
    if (macrosSection) {
        macrosSection.style.display = 'block';
    }
}

// Calculate macronutrients
function bmrCalculateMacronutrients(calories) {
    // Standard macronutrient distribution for weight loss
    const proteinRatio = 0.3; // 30% protein
    const carbsRatio = 0.4;   // 40% carbohydrates
    const fatRatio = 0.3;     // 30% fat
    
    // Calculate grams (protein & carbs: 4 kcal/g, fat: 9 kcal/g)
    const proteinGrams = Math.round((calories * proteinRatio) / 4);
    const carbsGrams = Math.round((calories * carbsRatio) / 4);
    const fatGrams = Math.round((calories * fatRatio) / 9);
    
    // Update display
    const proteinElement = document.querySelector('#bmr-protein-grams');
    const carbsElement = document.querySelector('#bmr-carbs-grams');
    const fatElement = document.querySelector('#bmr-fat-grams');
    
    if (proteinElement) proteinElement.textContent = proteinGrams + ' g';
    if (carbsElement) carbsElement.textContent = carbsGrams + ' g';
    if (fatElement) fatElement.textContent = fatGrams + ' g';
}

// Calculate specific goals (button click)
function bmrCalculateGoals() {
    const tdeeElement = document.querySelector('#tdee-result');
    if (!tdeeElement || tdeeElement.textContent === 'â€“') {
        alert('Please calculate BMR/TDEE first');
        return;
    }
    
    // Extract TDEE value
    const tdeeText = tdeeElement.textContent;
    const tdeeValue = parseInt(tdeeText.replace(/[^0-9]/g, ''));
    
    if (isNaN(tdeeValue)) return;
    
    // Show confirmation
    const btn = document.querySelector('[onclick="bmrCalculateGoals()"]');
    if (btn) {
        btn.innerHTML = 'âœ… Goals Set';
        setTimeout(() => {
            btn.innerHTML = 'ğŸ¯ Set Goals';
        }, 1500);
    }
}

// Show error message
function bmrShowError(message) {
    const bmrResult = document.querySelector('#bmr-result');
    const tdeeResult = document.querySelector('#tdee-result');
    const macrosSection = document.querySelector('#bmr-macros-section');
    
    if (bmrResult) bmrResult.textContent = 'Invalid input';
    if (tdeeResult) tdeeResult.textContent = 'â€“';
    if (macrosSection) macrosSection.style.display = 'none';
}

// Copy results to clipboard
function bmrCopyResults() {
    const bmr = document.querySelector('#bmr-result')?.textContent || 'N/A';
    const tdee = document.querySelector('#tdee-result')?.textContent || 'N/A';
    const maintenance = document.querySelector('#bmr-maintenance')?.textContent || 'N/A';
    
    const text = `ğŸ”¥ BMR & TDEE Results:\nBMR: ${bmr}\nTDEE: ${tdee}\nMaintenance Calories: ${maintenance}\n\nNote: These are estimates. Individual metabolism varies.`;
    
    navigator.clipboard?.writeText(text).then(() => {
        const btn = document.querySelector('[onclick="bmrCopyResults()"]');
        if (btn) {
            btn.innerHTML = 'âœ… Copied!';
            setTimeout(() => {
                btn.innerHTML = 'ğŸ“‹ Copy';
            }, 2000);
        }
    });
}

// Reset calculator
function bmrReset() {
    // Reset form inputs
    const ageInput = document.querySelector('#bmr-age-input');
    const ageSlider = document.querySelector('#bmr-age');
    const ageDisplay = document.querySelector('#bmr-age-display');
    
    const heightInput = document.querySelector('#bmr-height-input');
    const heightSlider = document.querySelector('#bmr-height');
    const heightDisplay = document.querySelector('#bmr-height-display');
    
    const weightInput = document.querySelector('#bmr-weight-input');
    const weightSlider = document.querySelector('#bmr-weight');
    const weightDisplay = document.querySelector('#bmr-weight-display');
    
    const activitySelect = document.querySelector('#bmr-activity');
    
    if (ageInput) ageInput.value = 30;
    if (ageSlider) ageSlider.value = 30;
    if (ageDisplay) ageDisplay.textContent = '30 years';
    
    if (heightInput) heightInput.value = 175;
    if (heightSlider) heightSlider.value = 175;
    if (heightDisplay) heightDisplay.textContent = '175 cm';
    
    if (weightInput) weightInput.value = 70;
    if (weightSlider) weightSlider.value = 70;
    if (weightDisplay) weightDisplay.textContent = '70 kg';
    
    if (activitySelect) activitySelect.selectedIndex = 2;
    
    // Reset units and gender
    bmrSetHeightUnit('cm');
    bmrSetWeightUnit('kg');
    bmrSelectGender('male');
    
    // Update activity description
    updateActivityDescription();
    
    // Reset results
    const bmrResult = document.querySelector('#bmr-result');
    const tdeeResult = document.querySelector('#tdee-result');
    const macrosSection = document.querySelector('#bmr-macros-section');
    
    if (bmrResult) bmrResult.textContent = 'â€“';
    if (tdeeResult) tdeeResult.textContent = 'â€“';
    if (macrosSection) macrosSection.style.display = 'none';
    
    // Reset calorie goals
    const lossExtreme = document.querySelector('#bmr-loss-extreme');
    const lossModerate = document.querySelector('#bmr-loss-moderate');
    const maintenance = document.querySelector('#bmr-maintenance');
    const gainModerate = document.querySelector('#bmr-gain-moderate');
    
    if (lossExtreme) lossExtreme.textContent = 'â€“';
    if (lossModerate) lossModerate.textContent = 'â€“';
    if (maintenance) maintenance.textContent = 'â€“';
    if (gainModerate) gainModerate.textContent = 'â€“';
    
    // Visual feedback
    const resetBtn = document.querySelector('#bmr-reset-btn');
    if (resetBtn) {
        resetBtn.innerHTML = 'âœ… Reset Complete';
        setTimeout(() => {
            resetBtn.innerHTML = 'ğŸ”„ Reset';
        }, 1000);
    }
}

// Initialize on page load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', bmrInit);
} else {
    bmrInit();
}
</script>
