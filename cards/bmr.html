<h2 id="bmr-title" style="margin-top:0;">BMR & TDEE Calculator</h2>

<form aria-describedby="bmr-desc">
  <p id="bmr-desc" class="small">Calculate your Basal Metabolic Rate (BMR) and Total Daily Energy Expenditure (TDEE).</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="bmr-age">Age</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input id="bmr-age" type="range" min="15" max="80" step="1" value="30" style="flex:1;" oninput="updateAgeValue(this.value)" />
        <input id="bmr-age-input" type="number" min="15" max="80" value="30" style="width:70px;" oninput="updateAgeSlider(this.value)" />
        <span class="small">years</span>
      </div>
    </div>
    <div class="field">
      <label for="bmr-gender">Gender</label>
      <div style="display:flex;gap:6px;margin-top:2px;">
        <button type="button" id="gender-male" class="gender-btn active" onclick="selectGender('male')" style="flex:1;padding:6px;background:#4dabf7;color:white;border:none;border-radius:4px;cursor:pointer;">Male</button>
        <button type="button" id="gender-female" class="gender-btn" onclick="selectGender('female')" style="flex:1;padding:6px;background:#f8f9fa;color:#495057;border:1px solid #dee2e6;border-radius:4px;cursor:pointer;">Female</button>
      </div>
      <input type="hidden" id="bmr-gender" value="male">
    </div>
  </div>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="bmr-height">Height</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input id="bmr-height" type="range" min="100" max="220" step="1" value="175" style="flex:1;" oninput="updateHeightValue(this.value)" />
        <input id="bmr-height-input" type="number" min="100" max="220" step="0.1" value="175" style="width:70px;" oninput="updateHeightSlider(this.value)" />
        <span class="small">cm</span>
      </div>
    </div>
    <div class="field">
      <label for="bmr-weight">Weight</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input id="bmr-weight" type="range" min="40" max="150" step="0.5" value="70" style="flex:1;" oninput="updateWeightValue(this.value)" />
        <input id="bmr-weight-input" type="number" min="40" max="150" step="0.1" value="70" style="width:70px;" oninput="updateWeightSlider(this.value)" />
        <span class="small">kg</span>
      </div>
    </div>
  </div>

  <div class="field">
    <label for="bmr-activity">Activity Level</label>
    <select id="bmr-activity" style="width:100%;padding:8px;" onchange="autoCalculate()">
      <option value="1.2">Sedentary (little/no exercise)</option>
      <option value="1.375">Lightly Active (1-3 days/week)</option>
      <option value="1.55" selected>Moderately Active (3-5 days/week)</option>
      <option value="1.725">Very Active (6-7 days/week)</option>
      <option value="1.9">Extra Active (very hard exercise)</option>
    </select>
  </div>

  <div class="actions" style="margin-top:8px;">
    <button type="button" onclick="bmrCalc(this)">Calculate</button>
    <button type="button" class="secondary" onclick="bmrReset(this)">Reset</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-bottom:12px;">
    <div style="padding:10px;background:#f8f9fa;border-radius:6px;border-left:4px solid #4dabf7;">
      <div class="small" style="font-weight:500;">Basal Metabolic Rate</div>
      <div id="bmr-res" style="font-size:1.3em;font-weight:600;color:#4dabf7;">–</div>
      <div class="small" style="color:#6c757d;">Calories at rest</div>
    </div>
    <div style="padding:10px;background:#f8f9fa;border-radius:6px;border-left:4px solid #51cf66;">
      <div class="small" style="font-weight:500;">Daily Energy Expenditure</div>
      <div id="tdee-res" style="font-size:1.3em;font-weight:600;color:#51cf66;">–</div>
      <div class="small" style="color:#6c757d;">With activity</div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:6px;margin-bottom:12px;">
    <div style="padding:8px;background:#e8f6f3;border-radius:6px;border-left:3px solid #51cf66;">
      <div class="small" style="font-weight:500;color:#51cf66;">Weight Loss</div>
      <div style="font-size:1.1em;font-weight:600;"><span id="loss-calories">–</span> kcal</div>
      <div class="small" style="color:#6c757d;">TDEE - 500</div>
    </div>
    <div style="padding:8px;background:#e8f4fc;border-radius:6px;border-left:3px solid #4dabf7;">
      <div class="small" style="font-weight:500;color:#4dabf7;">Mild Loss</div>
      <div style="font-size:1.1em;font-weight:600;"><span id="mild-loss-calories">–</span> kcal</div>
      <div class="small" style="color:#6c757d;">TDEE - 250</div>
    </div>
    <div style="padding:8px;background:#fff3cd;border-radius:6px;border-left:3px solid #ffd43b;">
      <div class="small" style="font-weight:500;color:#ffd43b;">Maintenance</div>
      <div style="font-size:1.1em;font-weight:600;"><span id="maintenance-calories">–</span> kcal</div>
      <div class="small" style="color:#6c757d;">TDEE</div>
    </div>
    <div style="padding:8px;background:#f8d7da;border-radius:6px;border-left:3px solid #fa5252;">
      <div class="small" style="font-weight:500;color:#fa5252;">Weight Gain</div>
      <div style="font-size:1.1em;font-weight:600;"><span id="gain-calories">–</span> kcal</div>
      <div class="small" style="color:#6c757d;">TDEE + 500</div>
    </div>
  </div>

  <div id="macros-section" style="display:none;padding:10px;background:#f8f9fa;border-radius:6px;">
    <div class="small" style="font-weight:500;margin-bottom:6px;">Macronutrients (Weight Loss)</div>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
      <div style="flex:1;">
        <div id="macro-chart" style="height:12px;background:linear-gradient(to right,#4dabf7 30%,#51cf66 50%,#ffd43b 20%);border-radius:6px;"></div>
      </div>
      <div style="font-size:0.85em;">
        <div><span style="color:#4dabf7;">●</span> Protein: <span id="protein-percent">30%</span></div>
        <div><span style="color:#51cf66;">●</span> Carbs: <span id="carbs-percent">50%</span></div>
        <div><span style="color:#ffd43b;">●</span> Fat: <span id="fat-percent">20%</span></div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:0.9em;">
      <div><strong id="protein-grams">– g</strong> protein</div>
      <div><strong id="carbs-grams">– g</strong> carbs</div>
      <div><strong id="fat-grams">– g</strong> fat</div>
    </div>
  </div>
</div>

<details class="small" style="margin-top:12px;">
  <summary>Formula & Notes</summary>
  <div style="padding:6px 0;">
    <p><strong>Mifflin-St Jeor:</strong> BMR = (10×weight) + (6.25×height) - (5×age) + 5(male) or -161(female)</p>
    <p><strong>TDEE:</strong> BMR × Activity (1.2-1.9)</p>
    <p class="small" style="color:#fa5252;margin-top:4px;">Note: Individual metabolism varies. Consult healthcare professional.</p>
  </div>
</details>

<script>
// Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateAgeValue(30);
  updateHeightValue(175);
  updateWeightValue(70);
  setTimeout(() => bmrCalc(), 100);
});

// Gender selection
function selectGender(gender) {
  document.getElementById('bmr-gender').value = gender;
  document.querySelectorAll('.gender-btn').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = '#f8f9fa';
    btn.style.color = '#495057';
    btn.style.border = '1px solid #dee2e6';
  });
  const selectedBtn = document.getElementById(`gender-${gender}`);
  selectedBtn.classList.add('active');
  selectedBtn.style.background = '#4dabf7';
  selectedBtn.style.color = 'white';
  selectedBtn.style.border = 'none';
  autoCalculate();
}

// Update controls
function updateAgeValue(value) {
  document.getElementById('bmr-age').value = value;
  document.getElementById('bmr-age-input').value = value;
  autoCalculate();
}
function updateAgeSlider(value) {
  let num = parseInt(value);
  if (isNaN(num) || num < 15) num = 15;
  if (num > 80) num = 80;
  updateAgeValue(num);
}

function updateHeightValue(value) {
  document.getElementById('bmr-height').value = value;
  document.getElementById('bmr-height-input').value = value;
  autoCalculate();
}
function updateHeightSlider(value) {
  let num = parseFloat(value);
  if (isNaN(num) || num < 100) num = 100;
  if (num > 220) num = 220;
  updateHeightValue(num);
}

function updateWeightValue(value) {
  document.getElementById('bmr-weight').value = value;
  document.getElementById('bmr-weight-input').value = value;
  autoCalculate();
}
function updateWeightSlider(value) {
  let num = parseFloat(value);
  if (isNaN(num) || num < 40) num = 40;
  if (num > 150) num = 150;
  updateWeightValue(num);
}

// Auto-calculate
function autoCalculate() {
  const age = parseInt(document.getElementById('bmr-age').value);
  const height = parseFloat(document.getElementById('bmr-height').value);
  const weight = parseFloat(document.getElementById('bmr-weight').value);
  if (age > 0 && height > 0 && weight > 0) bmrCalc();
}

// Main calculation
function bmrCalc() {
  const age = parseInt(document.getElementById('bmr-age').value, 10) || 0;
  const gender = document.getElementById('bmr-gender').value;
  const height = parseFloat(document.getElementById('bmr-height').value) || 0;
  const weight = parseFloat(document.getElementById('bmr-weight').value) || 0;
  const activity = parseFloat(document.getElementById('bmr-activity').value) || 1.55;

  if (age < 15 || age > 80 || height < 100 || height > 220 || weight < 40 || weight > 150) {
    showError();
    return;
  }

  // Calculate BMR
  let bmr = 0;
  if (gender === 'male') {
    bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
  } else {
    bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
  }
  const bmrRounded = Math.round(bmr);
  
  // Calculate TDEE
  const tdee = bmr * activity;
  const tdeeRounded = Math.round(tdee);

  // Update main results
  document.getElementById('bmr-res').textContent = bmrRounded.toLocaleString() + " kcal";
  document.getElementById('tdee-res').textContent = tdeeRounded.toLocaleString() + " kcal";

  // Goal calories
  document.getElementById('loss-calories').textContent = Math.round(tdee - 500).toLocaleString();
  document.getElementById('mild-loss-calories').textContent = Math.round(tdee - 250).toLocaleString();
  document.getElementById('maintenance-calories').textContent = tdeeRounded.toLocaleString();
  document.getElementById('gain-calories').textContent = Math.round(tdee + 500).toLocaleString();

  // Macronutrients
  calculateMacronutrients(Math.round(tdee - 500));
  
  // Show sections
  document.getElementById('macros-section').style.display = 'block';
}

// Macronutrients
function calculateMacronutrients(calories) {
  const proteinRatio = 0.3;
  const carbsRatio = 0.5;
  const fatRatio = 0.2;

  const proteinGrams = Math.round((calories * proteinRatio) / 4);
  const carbsGrams = Math.round((calories * carbsRatio) / 4);
  const fatGrams = Math.round((calories * fatRatio) / 9);

  document.getElementById('protein-percent').textContent = Math.round(proteinRatio * 100) + '%';
  document.getElementById('carbs-percent').textContent = Math.round(carbsRatio * 100) + '%';
  document.getElementById('fat-percent').textContent = Math.round(fatRatio * 100) + '%';

  document.getElementById('protein-grams').textContent = proteinGrams.toLocaleString();
  document.getElementById('carbs-grams').textContent = carbsGrams.toLocaleString();
  document.getElementById('fat-grams').textContent = fatGrams.toLocaleString();
}

// Error state
function showError() {
  document.getElementById('bmr-res').textContent = "Invalid input";
  document.getElementById('tdee-res').textContent = "–";
  document.getElementById('macros-section').style.display = 'none';
}

// Reset
function bmrReset() {
  selectGender('male');
  updateAgeValue(30);
  updateHeightValue(175);
  updateWeightValue(70);
  document.getElementById('bmr-activity').selectedIndex = 2;
  bmrCalc();
}
</script>

<style>
input[type="range"] {
  height: 6px;
  background: #e9ecef;
  border-radius: 3px;
}
input[type="range"]::-webkit-slider-thumb {
  width: 16px;
  height: 16px;
  background: #4dabf7;
  border-radius: 50%;
  cursor: pointer;
}
input[type="number"] {
  padding: 6px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  font-size: 0.9em;
}
input[type="number"]:focus {
  border-color: #4dabf7;
  outline: none;
}
.actions button {
  padding: 8px 16px;
}
.results > div > div {
  transition: all 0.2s;
}
.results > div > div:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
