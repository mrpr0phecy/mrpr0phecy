<h2 id="solar-system-simulator-title" style="margin-top:0;color:var(--accent);">üåå Solar System Simulator</h2>

<form aria-describedby="sss-desc" style="margin-bottom:16px;">
  <p id="sss-desc" class="small" style="color:var(--muted);">
    Interactive 2D simulation of the Solar System. Adjust time speed and scale, toggle orbits and labels, click planets for details.
  </p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:center;margin-bottom:16px;">
    <div>
      <label for="sss-speed" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Time Speed</label>
      <input id="sss-speed" type="range" min="0" max="200" value="10" 
             style="width:100%;height:6px;background:rgba(45,212,255,0.2);border-radius:3px;cursor:pointer;" />
      <div class="small" id="sss-speed-label" style="color:var(--muted);margin-top:4px;">Speed: 10√ó (days per second)</div>
    </div>

    <div>
      <label for="sss-scale" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">Distance Scale</label>
      <input id="sss-scale" type="range" min="0.2" max="4" step="0.1" value="1" 
             style="width:100%;height:6px;background:rgba(45,212,255,0.2);border-radius:3px;cursor:pointer;" />
      <div class="small" id="sss-scale-label" style="color:var(--muted);margin-top:4px;">Scale: 1.0</div>
    </div>

    <div style="display:flex;align-items:center;gap:8px;">
      <input id="sss-show-orbits" type="checkbox" checked style="width:18px;height:18px;" />
      <label for="sss-show-orbits" style="color:var(--muted);cursor:pointer;">Show Orbits</label>
    </div>

    <div style="display:flex;align-items:center;gap:8px;">
      <input id="sss-show-labels" type="checkbox" checked style="width:18px;height:18px;" />
      <label for="sss-show-labels" style="color:var(--muted);cursor:pointer;">Show Labels</label>
    </div>
  </div>

  <div style="display:flex;gap:10px;flex-wrap:wrap;">
    <button type="button" id="sss-play" 
            style="padding:10px 20px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      ‚è∏Ô∏è Pause
    </button>
    <button type="button" id="sss-reset" 
            style="padding:10px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text);cursor:pointer;">
      üîÑ Reset View
    </button>
    <select id="sss-focus" 
            style="margin-left:auto;padding:10px;background:rgba(45,212,255,0.05);border:1px solid rgba(45,212,255,0.3);border-radius:8px;color:var(--text);cursor:pointer;">
      <option value="sun">Focus: Sun</option>
      <option value="mercury">Mercury</option>
      <option value="venus">Venus</option>
      <option value="earth">Earth</option>
      <option value="mars">Mars</option>
      <option value="jupiter">Jupiter</option>
      <option value="saturn">Saturn</option>
      <option value="uranus">Uranus</option>
      <option value="neptune">Neptune</option>
      <option value="pluto">Pluto</option>
    </select>
  </div>
</form>

<div style="display:grid;grid-template-columns:1fr 320px;gap:16px;margin-top:20px;">
  <canvas id="sss-canvas" 
          style="width:100%;height:480px;display:block;background:#000;border:1px solid rgba(45,212,255,0.2);border-radius:12px;">
  </canvas>

  <div style="border:1px solid rgba(45,212,255,0.1);padding:16px;border-radius:12px;background:rgba(0,0,0,0.2);">
    <h3 style="color:var(--accent);margin-top:0;margin-bottom:12px;font-size:1.1rem;">ü™ê Planet Info</h3>
    <div id="sss-info" class="small" 
         style="white-space:pre-wrap;min-height:200px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.05);color:var(--text);font-family:monospace;line-height:1.5;">
      Click a planet to see details here.
    </div>

    <h3 style="color:var(--accent);margin-top:20px;margin-bottom:8px;font-size:1rem;">üéÆ Controls</h3>
    <div class="small" style="line-height:1.5;color:var(--muted);">
      <div style="margin-bottom:6px;"><strong>Click</strong> any planet to focus and view facts</div>
      <div style="margin-bottom:6px;"><strong>Time Speed</strong> adjusts orbital motion</div>
      <div style="margin-bottom:6px;"><strong>Distance Scale</strong> spreads out the system</div>
      <div><strong>Toggle orbits/labels</strong> for clarity</div>
    </div>
    
    <div style="margin-top:16px;display:flex;gap:8px;">
      <button id="sss-center" style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">Center Sun</button>
      <button id="sss-realistic" style="padding:8px 12px;background:rgba(255,165,0,0.1);border:1px solid rgba(255,165,0,0.3);border-radius:6px;color:#ffa500;cursor:pointer;font-size:12px;">Realistic Scale</button>
    </div>
  </div>
</div>

<script>
/* solar-system-simulator.html
   - Interactive Solar System simulator
   - Scoped with sss- prefix
   - Theme-aware colors
   - Responsive design
*/

(function() {
  'use strict';
  
  // Get the card context for scoping
  const card = document.currentScript?.closest('.card') || document;
  
  // ---------- Planetary data ----------
  const PLANETS = [
    {id:'sun', name:'Sun', a:0, period:0, radius:696340, color:'#ffdd66', desc:'The Sun ‚Äî the star at the center of the Solar System.'},
    {id:'mercury', name:'Mercury', a:0.387, period:87.97, radius:2439.7, color:'#bdbdbd', desc:'Mercury ‚Äî smallest planet, closest to the Sun.'},
    {id:'venus', name:'Venus', a:0.723, period:224.7, radius:6051.8, color:'#e6c07b', desc:'Venus ‚Äî similar size to Earth, thick atmosphere.'},
    {id:'earth', name:'Earth', a:1.000, period:365.25, radius:6371, color:'#4aa3ff', desc:'Earth ‚Äî our home planet.'},
    {id:'mars', name:'Mars', a:1.524, period:686.98, radius:3389.5, color:'#ff6b4a', desc:'Mars ‚Äî the red planet.'},
    {id:'jupiter', name:'Jupiter', a:5.203, period:4332.59, radius:69911, color:'#d9b48f', desc:'Jupiter ‚Äî gas giant, largest planet.'},
    {id:'saturn', name:'Saturn', a:9.537, period:10759, radius:58232, color:'#f0d7a8', desc:'Saturn ‚Äî gas giant with prominent rings.'},
    {id:'uranus', name:'Uranus', a:19.191, period:30687, radius:25362, color:'#9fe0e6', desc:'Uranus ‚Äî ice giant, rotates on its side.'},
    {id:'neptune', name:'Neptune', a:30.07, period:60190, radius:24622, color:'#3b6cff', desc:'Neptune ‚Äî distant ice giant.'},
    {id:'pluto', name:'Pluto', a:39.48, period:90560, radius:1188.3, color:'#c9a3a3', desc:'Pluto ‚Äî dwarf planet in the Kuiper belt.'}
  ];

  // ---------- Canvas setup ----------
  const canvas = card.querySelector('#sss-canvas');
  const ctx = canvas.getContext('2d');
  let DPR = window.devicePixelRatio || 1;
  
  function sssResizeCanvas() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * DPR);
    canvas.height = Math.floor(rect.height * DPR);
    sssDraw();
  }
  
  // ---------- Simulation state ----------
  let sssSim = {
    day: 0,
    speed: 10,
    running: true,
    distanceScale: 1,
    showOrbits: true,
    showLabels: true,
    focus: 'sun'
  };
  
  // ---------- Utility functions ----------
  function sssAuToPixels(au) {
    const base = 120;
    const s = sssSim.distanceScale;
    return Math.pow(au, 0.9) * base * s * DPR;
  }
  
  function sssRadiusToPixels(km) {
    const min = 3, max = 40;
    const r = Math.log10(km + 1);
    const scaled = (r - 2) * 6;
    return Math.max(min, Math.min(max, scaled)) * DPR;
  }
  
  function sssPlanetScreenPos(planet) {
    const focus = PLANETS.find(p => p.id === sssSim.focus) || PLANETS[0];
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    
    if (planet.id === 'sun') {
      return {x: cx, y: cy};
    }
    
    const angle = 2 * Math.PI * ((sssSim.day % planet.period) / planet.period || 0);
    const r = sssAuToPixels(planet.a);
    const wx = r * Math.cos(angle);
    const wy = r * Math.sin(angle);
    
    let fx = 0, fy = 0;
    if (focus.id !== 'sun') {
      const fangle = 2 * Math.PI * ((sssSim.day % focus.period) / focus.period || 0);
      const fr = sssAuToPixels(focus.a);
      fx = fr * Math.cos(fangle);
      fy = fr * Math.sin(fangle);
    }
    
    return {
      x: cx + (wx - fx),
      y: cy + (wy - fy)
    };
  }
  
  function sssPlanetAtScreenPos(sx, sy) {
    const center = {x: canvas.width/2, y: canvas.height/2};
    for (let i = PLANETS.length - 1; i >= 0; i--) {
      const p = PLANETS[i];
      const pos = sssPlanetScreenPos(p);
      const r = sssRadiusToPixels(p.radius);
      const dx = sx - pos.x;
      const dy = sy - pos.y;
      if (dx*dx + dy*dy <= (r+4)*(r+4)) return p;
    }
    return null;
  }
  
  // ---------- Drawing functions ----------
  function sssDrawStars() {
    const seed = Math.floor(canvas.width * canvas.height / 50000);
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#ffffff';
    for (let i = 0; i < seed; i++) {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      const a = Math.random() * 0.6;
      ctx.globalAlpha = a;
      ctx.fillRect(x, y, 1*DPR, 1*DPR);
    }
    ctx.globalAlpha = 1;
  }
  
  function sssDrawOrbit(p) {
    if (p.a === 0) return;
    const focus = PLANETS.find(f => f.id === sssSim.focus) || PLANETS[0];
    let fx = 0, fy = 0;
    if (focus.id !== 'sun') {
      const fangle = 2 * Math.PI * ((sssSim.day % focus.period) / focus.period || 0);
      const fr = sssAuToPixels(focus.a);
      fx = fr * Math.cos(fangle);
      fy = fr * Math.sin(fangle);
    }
    const r = sssAuToPixels(p.a);
    const cx = canvas.width/2 - fx;
    const cy = canvas.height/2 - fy;
    
    ctx.beginPath();
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1 * DPR;
    ctx.ellipse(cx, cy, r, r, 0, 0, Math.PI*2);
    ctx.stroke();
  }
  
  function sssDrawPlanet(p) {
    const pos = sssPlanetScreenPos(p);
    const rpx = sssRadiusToPixels(p.radius);
    
    if (p.id === 'sun') {
      const g = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, rpx*6);
      g.addColorStop(0, p.color);
      g.addColorStop(0.6, 'rgba(255,200,120,0.2)');
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(pos.x, pos.y, rpx*6, 0, Math.PI*2);
      ctx.fill();
    }
    
    ctx.beginPath();
    ctx.fillStyle = p.color;
    ctx.arc(pos.x, pos.y, rpx, 0, Math.PI*2);
    ctx.fill();
    
    if (p.id === 'saturn') {
      ctx.beginPath();
      ctx.strokeStyle = 'rgba(200,160,120,0.6)';
      ctx.lineWidth = Math.max(2, rpx*0.6);
      ctx.ellipse(pos.x, pos.y, rpx*2.2, rpx*1.0, Math.PI/6, 0, Math.PI*2);
      ctx.stroke();
    }
    
    if (sssSim.showLabels) {
      ctx.fillStyle = 'var(--text)';
      ctx.font = `${12*DPR}px sans-serif`;
      ctx.fillText(p.name, pos.x + rpx + 6*DPR, pos.y + 4*DPR);
    }
  }
  
  function sssDraw() {
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    sssDrawStars();
    
    if (sssSim.showOrbits) {
      PLANETS.forEach(p => {
        if (p.id === 'sun') return;
        sssDrawOrbit(p);
      });
    }
    
    PLANETS.forEach(p => sssDrawPlanet(p));
    
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(10*DPR, 10*DPR, 260*DPR, 56*DPR);
    ctx.fillStyle = 'var(--text)';
    ctx.font = `${14*DPR}px sans-serif`;
    ctx.fillText(`Day: ${Math.round(sssSim.day)}`, 18*DPR, 32*DPR);
    ctx.fillText(`Focus: ${sssSim.focus.charAt(0).toUpperCase() + sssSim.focus.slice(1)}`, 18*DPR, 52*DPR);
  }
  
  // ---------- Info panel ----------
  function sssShowPlanetInfo(p) {
    const info = card.querySelector('#sss-info');
    const lines = [];
    lines.push(`‚ú® ${p.name}`);
    lines.push(`‚îÄ`.repeat(20));
    if (p.a) lines.push(`Orbit: ${p.a} AU`);
    if (p.period) lines.push(`Period: ${p.period.toLocaleString()} days`);
    lines.push(`Radius: ${p.radius.toLocaleString()} km`);
    lines.push(``);
    lines.push(p.desc || '');
    info.textContent = lines.join('\n');
  }
  
  // ---------- UI Event Handlers ----------
  function sssSetupUI() {
    const speedInput = card.querySelector('#sss-speed');
    const speedLabel = card.querySelector('#sss-speed-label');
    const scaleInput = card.querySelector('#sss-scale');
    const scaleLabel = card.querySelector('#sss-scale-label');
    const playBtn = card.querySelector('#sss-play');
    const resetBtn = card.querySelector('#sss-reset');
    const focusSelect = card.querySelector('#sss-focus');
    const orbitsCheck = card.querySelector('#sss-show-orbits');
    const labelsCheck = card.querySelector('#sss-show-labels');
    const centerBtn = card.querySelector('#sss-center');
    const realisticBtn = card.querySelector('#sss-realistic');
    
    speedInput.addEventListener('input', () => {
      sssSim.speed = Number(speedInput.value);
      speedLabel.textContent = `Speed: ${sssSim.speed}√ó (days per second)`;
    });
    
    scaleInput.addEventListener('input', () => {
      sssSim.distanceScale = Number(scaleInput.value);
      scaleLabel.textContent = `Scale: ${sssSim.distanceScale.toFixed(1)}`;
      sssDraw();
    });
    
    orbitsCheck.addEventListener('change', e => {
      sssSim.showOrbits = e.target.checked;
      sssDraw();
    });
    
    labelsCheck.addEventListener('change', e => {
      sssSim.showLabels = e.target.checked;
      sssDraw();
    });
    
    playBtn.addEventListener('click', () => {
      sssSim.running = !sssSim.running;
      playBtn.textContent = sssSim.running ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
    });
    
    resetBtn.addEventListener('click', () => {
      sssSim.day = 0;
      sssSim.distanceScale = 1;
      scaleInput.value = 1;
      scaleLabel.textContent = 'Scale: 1.0';
      sssDraw();
    });
    
    focusSelect.addEventListener('change', e => {
      sssSim.focus = e.target.value;
      sssDraw();
    });
    
    centerBtn.addEventListener('click', () => {
      sssSim.focus = 'sun';
      focusSelect.value = 'sun';
      sssDraw();
    });
    
    realisticBtn.addEventListener('click', () => {
      sssSim.distanceScale = 0.2;
      scaleInput.value = 0.2;
      scaleLabel.textContent = 'Scale: 0.2';
      sssDraw();
    });
    
    canvas.addEventListener('click', e => {
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) * DPR;
      const y = (e.clientY - rect.top) * DPR;
      const clicked = sssPlanetAtScreenPos(x, y);
      if (clicked) {
        sssSim.focus = clicked.id;
        focusSelect.value = clicked.id;
        sssShowPlanetInfo(clicked);
        sssDraw();
      }
    });
    
    // Initialize
    sssShowPlanetInfo(PLANETS[0]);
  }
  
  // ---------- Animation loop ----------
  let lastTime = performance.now();
  function sssAnimationLoop(now) {
    const dt = (now - lastTime) / 1000;
    lastTime = now;
    if (sssSim.running) {
      sssSim.day += sssSim.speed * dt;
    }
    sssDraw();
    requestAnimationFrame(sssAnimationLoop);
  }
  
  // ---------- Initialize ----------
  function sssInit() {
    sssResizeCanvas();
    sssSetupUI();
    requestAnimationFrame(sssAnimationLoop);
    
    window.addEventListener('resize', () => {
      sssResizeCanvas();
    });
    
    // Save/Load state
    const savedState = localStorage.getItem('sss-state');
    if (savedState) {
      try {
        const state = JSON.parse(savedState);
        Object.assign(sssSim, state);
        card.querySelector('#sss-speed').value = sssSim.speed;
        card.querySelector('#sss-scale').value = sssSim.distanceScale;
        card.querySelector('#sss-show-orbits').checked = sssSim.showOrbits;
        card.querySelector('#sss-show-labels').checked = sssSim.showLabels;
        card.querySelector('#sss-focus').value = sssSim.focus;
      } catch (e) {
        console.log('Could not load saved state:', e);
      }
    }
    
    // Auto-save state every 30 seconds
    setInterval(() => {
      localStorage.setItem('sss-state', JSON.stringify(sssSim));
    }, 30000);
  }
  
  // Start when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', sssInit);
  } else {
    sssInit();
  }
  
})();
</script>

<style>
/* Card-specific styles */
#solar-system-simulator-title {
  color: var(--accent);
  margin-top: 0;
}

/* Responsive design */
@media (max-width: 768px) {
  #sss-canvas {
    height: 360px !important;
  }
  
  div[style*="grid-template-columns:1fr 320px"] {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
}

@media (max-width: 480px) {
  #sss-canvas {
    height: 280px !important;
  }
  
  .flex-wrap {
    flex-direction: column !important;
  }
  
  #sss-focus {
    margin-left: 0 !important;
    margin-top: 10px;
    width: 100%;
  }
}
</style>
