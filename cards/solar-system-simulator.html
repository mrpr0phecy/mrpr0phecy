<h2 id="solar-system-simulator" style="margin-top:0;">Solar System Simulator</h2>

<!--
  Manifest metadata (for generate-cards-json.js)
  id: solar-system-simulator
  title: Solar System Simulator
  path: cards/solar-system-simulator.html
  category: Science & Education
  version: 1.0
-->

<form aria-describedby="solar-desc" style="margin-bottom:12px;">
  <p id="solar-desc" class="small">
    Interactive 2D simulation of the Solar System. Adjust time speed and scale, toggle orbits and labels, click planets for details.
  </p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;align-items:center;">
    <div>
      <label for="ss-speed">Time speed</label>
      <input id="ss-speed" type="range" min="0" max="200" value="10" style="width:100%;" />
      <div class="small" id="ss-speed-label">Speed: 10× (days per second)</div>
    </div>

    <div>
      <label for="ss-scale">Distance scale</label>
      <input id="ss-scale" type="range" min="0.2" max="4" step="0.1" value="1" style="width:100%;" />
      <div class="small" id="ss-scale-label">Scale: 1.0</div>
    </div>

    <div>
      <label for="ss-show-orbits"><input id="ss-show-orbits" type="checkbox" checked /> Show orbits</label>
    </div>

    <div>
      <label for="ss-show-labels"><input id="ss-show-labels" type="checkbox" checked /> Show labels</label>
    </div>
  </div>

  <div style="margin-top:8px;display:flex;gap:8px;">
    <button type="button" id="ss-play">Pause</button>
    <button type="button" id="ss-reset">Reset View</button>
    <select id="ss-focus" style="margin-left:auto;">
      <option value="sun">Focus: Sun</option>
      <option value="mercury">Mercury</option>
      <option value="venus">Venus</option>
      <option value="earth">Earth</option>
      <option value="mars">Mars</option>
      <option value="jupiter">Jupiter</option>
      <option value="saturn">Saturn</option>
      <option value="uranus">Uranus</option>
      <option value="neptune">Neptune</option>
      <option value="pluto">Pluto</option>
    </select>
  </div>
</form>

<div style="display:grid;grid-template-columns:1fr 320px;gap:12px;">
  <div style="border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:6px;">
    <canvas id="ss-canvas" style="width:100%;height:640px;display:block;background:#000;"></canvas>
  </div>

  <div style="border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:6px;">
    <h3 class="small">Planet Info</h3>
    <div id="ss-info" class="small" style="white-space:pre-wrap;min-height:220px;padding:6px;background:#fafafa;border-radius:6px;">
      Click a planet to see details here.
    </div>

    <h3 class="small" style="margin-top:12px;">Legend & Controls</h3>
    <div class="small" style="line-height:1.4;">
      <strong>Click</strong> a planet to focus and view facts. Use <strong>Time speed</strong> to speed up or slow down orbital motion. <strong>Distance scale</strong> adjusts how spread out the system appears. Toggle orbits and labels for clarity.
    </div>
  </div>
</div>

<script>
/* Solar System Simulator
   - Simplified circular orbits
   - Distances and sizes are scaled for visualization (log scaling for distances)
   - Click planets to view info and focus
   - Client-side only, no external libs
*/

// ---------- Planetary data (semi-major axis in AU, orbital period in days, radius in km, color, short desc) ----------
const PLANETS = [
  {id:'sun', name:'Sun', a:0, period:0, radius:696340, color:'#ffdd66', desc:'The Sun — the star at the center of the Solar System.'},
  {id:'mercury', name:'Mercury', a:0.387, period:87.97, radius:2439.7, color:'#bdbdbd', desc:'Mercury — smallest planet, closest to the Sun.'},
  {id:'venus', name:'Venus', a:0.723, period:224.7, radius:6051.8, color:'#e6c07b', desc:'Venus — similar size to Earth, thick atmosphere.'},
  {id:'earth', name:'Earth', a:1.000, period:365.25, radius:6371, color:'#4aa3ff', desc:'Earth — our home planet.'},
  {id:'mars', name:'Mars', a:1.524, period:686.98, radius:3389.5, color:'#ff6b4a', desc:'Mars — the red planet.'},
  {id:'jupiter', name:'Jupiter', a:5.203, period:4332.59, radius:69911, color:'#d9b48f', desc:'Jupiter — gas giant, largest planet.'},
  {id:'saturn', name:'Saturn', a:9.537, period:10759, radius:58232, color:'#f0d7a8', desc:'Saturn — gas giant with prominent rings.'},
  {id:'uranus', name:'Uranus', a:19.191, period:30687, radius:25362, color:'#9fe0e6', desc:'Uranus — ice giant, rotates on its side.'},
  {id:'neptune', name:'Neptune', a:30.07, period:60190, radius:24622, color:'#3b6cff', desc:'Neptune — distant ice giant.'},
  {id:'pluto', name:'Pluto', a:39.48, period:90560, radius:1188.3, color:'#c9a3a3', desc:'Pluto — dwarf planet in the Kuiper belt.'}
];

// ---------- Canvas & view state ----------
const canvas = document.getElementById('ss-canvas');
const ctx = canvas.getContext('2d');
let DPR = window.devicePixelRatio || 1;
function resizeCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.max(600, Math.floor(rect.width * DPR));
  canvas.height = Math.max(400, Math.floor(rect.height * DPR));
}
resizeCanvas();
window.addEventListener('resize', ()=>{ resizeCanvas(); draw(); });

// world state
let sim = {
  day: 0,                 // simulation day counter
  speed: Number(document.getElementById('ss-speed').value), // days per second
  running: true,
  distanceScale: Number(document.getElementById('ss-scale').value),
  showOrbits: document.getElementById('ss-show-orbits').checked,
  showLabels: document.getElementById('ss-show-labels').checked,
  focus: 'sun'
};

// mapping helpers: convert AU to screen pixels using log scaling for distances
function auToPixels(au){
  // base radius for 1 AU at scale=1
  const base = 120; // pixels per AU at scale 1 (tunable)
  // use a gentle power scale so outer planets fit
  const s = sim.distanceScale;
  return Math.pow(au, 0.9) * base * s;
}

// size scaling: map real radius (km) to visible pixels
function radiusToPixels(km){
  // use logarithmic mapping to keep planets visible
  const min = 3, max = 40;
  const r = Math.log10(km + 1);
  const scaled = (r - 2) * 6; // tuned
  return Math.max(min, Math.min(max, scaled));
}

// ---------- UI wiring ----------
const speedInput = document.getElementById('ss-speed');
const speedLabel = document.getElementById('ss-speed-label');
const scaleInput = document.getElementById('ss-scale');
const scaleLabel = document.getElementById('ss-scale-label');
const playBtn = document.getElementById('ss-play');
const resetBtn = document.getElementById('ss-reset');
const focusSelect = document.getElementById('ss-focus');

speedInput.addEventListener('input', ()=>{ sim.speed = Number(speedInput.value); speedLabel.textContent = `Speed: ${sim.speed}× (days per second)`; });
scaleInput.addEventListener('input', ()=>{ sim.distanceScale = Number(scaleInput.value); scaleLabel.textContent = `Scale: ${sim.distanceScale.toFixed(1)}`; draw(); });
document.getElementById('ss-show-orbits').addEventListener('change', e=>{ sim.showOrbits = e.target.checked; draw(); });
document.getElementById('ss-show-labels').addEventListener('change', e=>{ sim.showLabels = e.target.checked; draw(); });

playBtn.addEventListener('click', ()=>{
  sim.running = !sim.running;
  playBtn.textContent = sim.running ? 'Pause' : 'Play';
});
resetBtn.addEventListener('click', ()=>{
  sim.day = 0; sim.distanceScale = 1; scaleInput.value = 1; scaleLabel.textContent = 'Scale: 1.0'; draw();
});
focusSelect.addEventListener('change', e=>{ sim.focus = e.target.value; draw(); });

// ---------- Interaction: click to select planet ----------
canvas.addEventListener('click', (ev)=>{
  const rect = canvas.getBoundingClientRect();
  const x = (ev.clientX - rect.left) * DPR;
  const y = (ev.clientY - rect.top) * DPR;
  const clicked = planetAtScreenPos(x, y);
  if(clicked){
    sim.focus = clicked.id;
    focusSelect.value = clicked.id;
    showPlanetInfo(clicked);
    draw();
  }
});

// detect planet under screen coords
function planetAtScreenPos(sx, sy){
  const center = {x: canvas.width/2, y: canvas.height/2};
  for(let i=PLANETS.length-1;i>=0;i--){
    const p = PLANETS[i];
    const pos = planetScreenPos(p);
    const r = radiusToPixels(p.radius) * DPR;
    const dx = sx - pos.x;
    const dy = sy - pos.y;
    if(dx*dx + dy*dy <= (r+4)*(r+4)) return p;
  }
  return null;
}

// ---------- Planet positions ----------
function planetScreenPos(planet){
  // center on focus body
  const focus = PLANETS.find(p=>p.id===sim.focus) || PLANETS[0];
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  // compute world positions in pixels relative to Sun
  if(planet.id === 'sun'){
    return {x: cx, y: cy};
  }
  const angle = 2 * Math.PI * ((sim.day % planet.period) / planet.period || 0);
  const r = auToPixels(planet.a);
  const wx = r * Math.cos(angle);
  const wy = r * Math.sin(angle);

  // focus offset: compute focus world pos and subtract so focus is centered
  let fx = 0, fy = 0;
  if(focus.id !== 'sun'){
    const fangle = 2 * Math.PI * ((sim.day % focus.period) / focus.period || 0);
    const fr = auToPixels(focus.a);
    fx = fr * Math.cos(fangle);
    fy = fr * Math.sin(fangle);
  }

  // screen pos
  const sx = cx + (wx - fx);
  const sy = cy + (wy - fy);
  return {x: sx, y: sy};
}

// ---------- Drawing ----------
function draw(){
  // clear
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // background stars
  drawStars();

  // draw orbits (if enabled)
  if(sim.showOrbits){
    PLANETS.forEach(p=>{
      if(p.id === 'sun') return;
      drawOrbit(p);
    });
  }

  // draw planets (sun first)
  PLANETS.forEach(p=>{
    drawPlanet(p);
  });

  // overlay HUD: simulation day and focus
  ctx.setTransform(1,0,0,1,0,0);
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(10*DPR, 10*DPR, 260*DPR, 56*DPR);
  ctx.fillStyle = '#fff';
  ctx.font = `${14*DPR}px sans-serif`;
  ctx.fillText(`Day: ${Math.round(sim.day)}`, 18*DPR, 32*DPR);
  ctx.fillText(`Focus: ${sim.focus.charAt(0).toUpperCase() + sim.focus.slice(1)}`, 18*DPR, 52*DPR);
}

function drawStars(){
  // subtle star field seeded by canvas size
  const seed = Math.floor(canvas.width * canvas.height / 50000);
  ctx.fillStyle = '#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#ffffff';
  for(let i=0;i<seed;i++){
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;
    const a = Math.random() * 0.6;
    ctx.globalAlpha = a;
    ctx.fillRect(x, y, 1*DPR, 1*DPR);
  }
  ctx.globalAlpha = 1;
}

function drawOrbit(p){
  if(p.a === 0) return;
  const focus = PLANETS.find(f=>f.id===sim.focus) || PLANETS[0];
  // compute focus offset
  let fx = 0, fy = 0;
  if(focus.id !== 'sun'){
    const fangle = 2 * Math.PI * ((sim.day % focus.period) / focus.period || 0);
    const fr = auToPixels(focus.a);
    fx = fr * Math.cos(fangle);
    fy = fr * Math.sin(fangle);
  }
  const r = auToPixels(p.a);
  const cx = canvas.width/2 - fx;
  const cy = canvas.height/2 - fy;

  ctx.beginPath();
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1 * DPR;
  ctx.ellipse(cx, cy, r, r, 0, 0, Math.PI*2);
  ctx.stroke();
}

function drawPlanet(p){
  const pos = planetScreenPos(p);
  const rpx = radiusToPixels(p.radius) * DPR;
  // glow for sun
  if(p.id === 'sun'){
    // radial gradient
    const g = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, rpx*6);
    g.addColorStop(0, p.color);
    g.addColorStop(0.6, 'rgba(255,200,120,0.2)');
    g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, rpx*6, 0, Math.PI*2);
    ctx.fill();
  }

  // planet body
  ctx.beginPath();
  ctx.fillStyle = p.color;
  ctx.arc(pos.x, pos.y, rpx, 0, Math.PI*2);
  ctx.fill();

  // ring for Saturn (visual only)
  if(p.id === 'saturn'){
    ctx.beginPath();
    ctx.strokeStyle = 'rgba(200,160,120,0.6)';
    ctx.lineWidth = Math.max(2, rpx*0.6);
    ctx.ellipse(pos.x, pos.y, rpx*2.2, rpx*1.0, Math.PI/6, 0, Math.PI*2);
    ctx.stroke();
  }

  // label
  if(sim.showLabels){
    ctx.fillStyle = '#fff';
    ctx.font = `${12*DPR}px sans-serif`;
    ctx.fillText(p.name, pos.x + rpx + 6*DPR, pos.y + 4*DPR);
  }
}

// ---------- Info panel ----------
function showPlanetInfo(p){
  const info = document.getElementById('ss-info');
  const lines = [];
  lines.push(`${p.name}`);
  if(p.a) lines.push(`Semi-major axis: ${p.a} AU`);
  if(p.period) lines.push(`Orbital period: ${p.period.toLocaleString()} days`);
  lines.push(`Radius: ${p.radius.toLocaleString()} km`);
  lines.push('');
  lines.push(p.desc || '');
  info.textContent = lines.join('\\n');
}

// ---------- Animation loop ----------
let last = performance.now();
function step(now){
  const dt = (now - last) / 1000; // seconds
  last = now;
  if(sim.running){
    sim.day += sim.speed * dt;
  }
  draw();
  requestAnimationFrame(step);
}
requestAnimationFrame(step);

// initial draw and show sun info
showPlanetInfo(PLANETS[0]);
draw();

// ---------- Expose a simple API for external use (optional) ----------
window.SolarSim = {
  setSpeed: v => { sim.speed = v; speedInput.value = v; speedLabel.textContent = `Speed: ${v}× (days per second)`; },
  setScale: v => { sim.distanceScale = v; scaleInput.value = v; scaleLabel.textContent = `Scale: ${v.toFixed(1)}`; draw(); },
  focusOn: id => { sim.focus = id; focusSelect.value = id; draw(); }
};
</script>
