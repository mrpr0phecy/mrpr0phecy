<!-- cards/breakeven-calculator.html -->
<h2 id="breakeven-calculator-title">Breakâ€‘Even Calculator</h2>

<div class="description">
  Find the sales volume needed to break even and calculate required revenue.
  <span class="disclaimer">For educational and planning purposes only.</span>
</div>

<div class="tool-body">
  <!-- INPUT SECTION -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
    <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 15px;">
      ğŸ’° Business Costs Input
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
      <div>
        <label for="be-fixed" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #ffa500;">Fixed Costs (Â£)</span>
        </label>
        <input id="be-fixed" type="number" min="0" value="10000" step="100"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,165,0,0.3); background: rgba(255,165,0,0.05); color: #e6faff;">
        <div style="margin-top: 6px; color: rgba(255,165,0,0.7); font-size: 13px;">
          Rent, salaries, utilities, insurance
        </div>
      </div>
      
      <div>
        <label for="be-variable" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #39ff14;">Variable Cost per Unit (Â£)</span>
        </label>
        <input id="be-variable" type="number" min="0" value="5" step="0.01"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(57,255,20,0.3); background: rgba(57,255,20,0.05); color: #e6faff;">
        <div style="margin-top: 6px; color: rgba(57,255,20,0.7); font-size: 13px;">
          Materials, packaging, shipping per item
        </div>
      </div>
      
      <div>
        <label for="be-price" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #ff4081;">Selling Price per Unit (Â£)</span>
        </label>
        <input id="be-price" type="number" min="0" value="10" step="0.01"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,64,129,0.3); background: rgba(255,64,129,0.05); color: #e6faff;">
        <div style="margin-top: 6px; color: rgba(255,64,129,0.7); font-size: 13px;">
          Price you charge customers
        </div>
      </div>
    </div>
    
    <!-- QUICK EXAMPLES -->
    <div>
      <div style="color: rgba(230,250,255,0.8); margin-bottom: 10px; font-size: 14px;">Quick Examples:</div>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="be-example-btn" data-fixed="10000" data-variable="5" data-price="10"
                style="padding: 8px 12px; background: rgba(45,212,255,0.1); border: 1px solid rgba(45,212,255,0.3); border-radius: 6px; cursor: pointer; color: #2dd4ff; font-size: 13px;">
          ğŸ“Š Standard Business
        </button>
        <button class="be-example-btn" data-fixed="5000" data-variable="2" data-price="8"
                style="padding: 8px 12px; background: rgba(255,165,0,0.1); border: 1px solid rgba(255,165,0,0.3); border-radius: 6px; cursor: pointer; color: #ffa500; font-size: 13px;">
          ğŸ›ï¸ Small Retail
        </button>
        <button class="be-example-btn" data-fixed="25000" data-variable="15" data-price="30"
                style="padding: 8px 12px; background: rgba(57,255,20,0.1); border: 1px solid rgba(57,255,20,0.3); border-radius: 6px; cursor: pointer; color: #39ff14; font-size: 13px;">
          ğŸ­ Manufacturing
        </button>
        <button class="be-example-btn" data-fixed="2000" data-variable="1" data-price="5"
                style="padding: 8px 12px; background: rgba(255,64,129,0.1); border: 1px solid rgba(255,64,129,0.3); border-radius: 6px; cursor: pointer; color: #ff4081; font-size: 13px;">
          â˜• Coffee Shop
        </button>
      </div>
    </div>
  </div>
  
  <!-- CALCULATE BUTTONS -->
  <div style="text-align: center; margin: 25px 0;">
    <button id="be-calculate-btn" 
            style="background: #2dd4ff; color: #000; border: none; padding: 14px 32px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 15px rgba(45,212,255,0.3);">
      ğŸ’° CALCULATE BREAKâ€‘EVEN
    </button>
    
    <button id="be-reset-btn" 
            style="background: rgba(255,255,255,0.08); color: #e6faff; border: 1px solid rgba(255,255,255,0.2); padding: 14px 24px; border-radius: 10px; cursor: pointer; font-size: 16px; margin-left: 12px;">
      Reset
    </button>
  </div>
  
  <!-- RESULTS DISPLAY -->
  <div id="be-results" style="display: none;">
    <div style="background: rgba(20,20,20,0.7); border-radius: 10px; padding: 25px; border: 1px solid rgba(57,255,20,0.2); margin-bottom: 25px;">
      <div style="color: #39ff14; font-size: 18px; font-weight: 600; margin-bottom: 20px; text-align: center;">
        ğŸ“ˆ Breakâ€‘Even Analysis Results
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <div style="background: rgba(45,212,255,0.1); padding: 20px; border-radius: 8px; text-align: center; border: 1px solid rgba(45,212,255,0.3);">
          <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Breakâ€‘Even Units</div>
          <div id="be-units" style="font-size: 28px; font-weight: 800; color: #2dd4ff;">0</div>
          <div style="color: rgba(45,212,255,0.7); font-size: 13px; margin-top: 5px;">Units to sell</div>
        </div>
        
        <div style="background: rgba(255,165,0,0.1); padding: 20px; border-radius: 8px; text-align: center; border: 1px solid rgba(255,165,0,0.3);">
          <div style="color: #ffa500; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Breakâ€‘Even Revenue</div>
          <div id="be-revenue" style="font-size: 28px; font-weight: 800; color: #ffa500;">Â£0</div>
          <div style="color: rgba(255,165,0,0.7); font-size: 13px; margin-top: 5px;">Total sales needed</div>
        </div>
        
        <div style="background: rgba(57,255,20,0.1); padding: 20px; border-radius: 8px; text-align: center; border: 1px solid rgba(57,255,20,0.3);">
          <div style="color: #39ff14; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Contribution Margin</div>
          <div id="be-margin" style="font-size: 28px; font-weight: 800; color: #39ff14;">Â£0</div>
          <div style="color: rgba(57,255,20,0.7); font-size: 13px; margin-top: 5px;">Profit per unit</div>
        </div>
      </div>
      
      <div id="be-formula-section" style="background: rgba(30,30,30,0.5); padding: 15px; border-radius: 8px;">
        <div style="color: #ff4081; font-weight: 600; margin-bottom: 10px;">ğŸ“ Calculation Formula:</div>
        <div style="color: #e6faff; font-size: 14px; line-height: 1.6;">
          â€¢ <span style="color: #2dd4ff;">Contribution Margin = Selling Price âˆ’ Variable Cost</span><br>
          â€¢ <span style="color: #39ff14;">Breakâ€‘Even Units = Fixed Costs Ã· Contribution Margin</span><br>
          â€¢ <span style="color: #ffa500;">Breakâ€‘Even Revenue = Breakâ€‘Even Units Ã— Selling Price</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- PROFIT SIMULATION -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px; margin-bottom: 25px;">
    <div style="color: #ffa500; font-weight: 600; margin-bottom: 15px;">
      ğŸ“Š Profit Simulation
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
      <div>
        <label for="be-simulation-units" style="display: block; margin-bottom: 6px; color: rgba(230,250,255,0.8); font-size: 14px;">
          <span style="color: #39ff14;">Projected Sales Units</span>
        </label>
        <input id="be-simulation-units" type="number" min="0" value="1500" step="100"
               style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(57,255,20,0.3); background: rgba(57,255,20,0.05); color: #e6faff;">
      </div>
      
      <button id="be-simulate-btn" 
              style="padding: 12px; background: rgba(57,255,20,0.1); color: #39ff14; border: 1px solid rgba(57,255,20,0.3); border-radius: 8px; cursor: pointer; font-weight: 600; align-self: end;">
        ğŸ”® Simulate Profit
      </button>
    </div>
    
    <div id="be-simulation-results" style="display: none; background: rgba(20,20,20,0.7); padding: 15px; border-radius: 8px; border: 1px solid rgba(57,255,20,0.2);">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div>
          <div style="color: rgba(230,250,255,0.7); font-size: 13px;">Total Revenue:</div>
          <div id="be-sim-revenue" style="color: #39ff14; font-weight: 600; font-size: 18px;">Â£0</div>
        </div>
        <div>
          <div style="color: rgba(230,250,255,0.7); font-size: 13px;">Total Costs:</div>
          <div id="be-sim-costs" style="color: #ff4d4d; font-weight: 600; font-size: 18px;">Â£0</div>
        </div>
        <div>
          <div style="color: rgba(230,250,255,0.7); font-size: 13px;">Profit/Loss:</div>
          <div id="be-sim-profit" style="color: #2dd4ff; font-weight: 600; font-size: 18px;">Â£0</div>
        </div>
        <div>
          <div style="color: rgba(230,250,255,0.7); font-size: 13px;">Margin:</div>
          <div id="be-sim-margin" style="color: #ffa500; font-weight: 600; font-size: 18px;">0%</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- BUSINESS INSIGHTS -->
  <div style="background: rgba(30,30,30,0.5); border-radius: 10px; padding: 20px;">
    <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 15px; font-size: 16px;">
      ğŸ’¡ Business Insights & Tips
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
      <div style="background: rgba(45,212,255,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #2dd4ff;">
        <div style="color: #2dd4ff; font-weight: 600; margin-bottom: 5px;">Lower Fixed Costs</div>
        <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Reducing fixed costs lowers breakâ€‘even point. Consider shared workspaces, remote teams, or renegotiating contracts.</div>
      </div>
      
      <div style="background: rgba(255,165,0,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #ffa500;">
        <div style="color: #ffa500; font-weight: 600; margin-bottom: 5px;">Increase Price</div>
        <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Even small price increases significantly impact breakâ€‘even point if demand stays constant.</div>
      </div>
      
      <div style="background: rgba(57,255,20,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #39ff14;">
        <div style="color: #39ff14; font-weight: 600; margin-bottom: 5px;">Reduce Variable Costs</div>
        <div style="color: rgba(230,250,255,0.8); font-size: 14px;">Bulk purchasing, efficiency improvements, or supplier negotiation can lower perâ€‘unit costs.</div>
      </div>
      
      <div style="background: rgba(255,77,77,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #ff4d4d;">
        <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 5px;">Warning</div>
        <div style="color: rgba(230,250,255,0.8); font-size: 14px;">This is an educational tool. Actual business planning requires market research and professional advice.</div>
      </div>
    </div>
  </div>
  
  <!-- ERROR MESSAGE -->
  <div id="be-error" style="margin-top: 20px; padding: 15px; background: rgba(255,77,77,0.1); border-radius: 8px; border: 1px solid rgba(255,77,77,0.3); display: none;">
    <div style="color: #ff4d4d; font-weight: 600; margin-bottom: 5px;">âš ï¸ Calculation Error</div>
    <div id="be-error-text" style="color: rgba(255,77,77,0.9);"></div>
  </div>
</div>

<style>
#breakeven-calculator-title { 
  color: #2dd4ff; 
  margin-top: 0;
  margin-bottom: 10px;
}

.description {
  color: rgba(230,250,255,0.8);
  margin-bottom: 20px;
  font-size: 14px;
}

.disclaimer {
  display: block;
  color: rgba(255,165,0,0.8);
  font-size: 12px;
  margin-top: 5px;
  font-style: italic;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .tool-body > div > div {
    grid-template-columns: 1fr !important;
  }
  
  .be-example-btn {
    width: calc(50% - 5px);
    margin: 2px 0 !important;
  }
  
  #be-calculate-btn, #be-reset-btn {
    width: 100%;
    margin: 5px 0 !important;
  }
}
</style>

<script>
// ============================================
// BREAK-EVEN CALCULATOR - PROPERLY SCOPED
// All functions prefixed with "be" (break-even)
// ============================================

// Initialize the tool
function beInit() {
  console.log("Break-Even Calculator: Initializing...");
  
  // Example buttons
  const exampleBtns = document.querySelectorAll('.be-example-btn');
  exampleBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const fixed = this.dataset.fixed;
      const variable = this.dataset.variable;
      const price = this.dataset.price;
      
      document.getElementById('be-fixed').value = fixed;
      document.getElementById('be-variable').value = variable;
      document.getElementById('be-price').value = price;
      
      // Visual feedback
      exampleBtns.forEach(b => {
        b.style.background = '';
        b.style.border = '1px solid rgba(255,255,255,0.1)';
      });
      this.style.background = 'rgba(45,212,255,0.2)';
      this.style.border = '1px solid #2dd4ff';
      
      beClearResults();
    });
  });
  
  // Calculate button
  document.getElementById('be-calculate-btn').addEventListener('click', beCalculate);
  
  // Reset button
  document.getElementById('be-reset-btn').addEventListener('click', beReset);
  
  // Simulate button
  document.getElementById('be-simulate-btn').addEventListener('click', beSimulateProfit);
  
  // Enter key support
  document.querySelectorAll('#be-fixed, #be-variable, #be-price').forEach(input => {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') beCalculate();
    });
  });
  
  // Auto-calculate when inputs change
  document.querySelectorAll('#be-fixed, #be-variable, #be-price').forEach(input => {
    input.addEventListener('input', function() {
      // Clear example button highlights when user types
      exampleBtns.forEach(b => {
        b.style.background = '';
        b.style.border = '1px solid rgba(255,255,255,0.1)';
      });
    });
  });
  
  console.log("âœ… Break-Even Calculator ready!");
}

// Main calculation function
function beCalculate() {
  console.log("Calculating break-even point...");
  
  // Hide previous results/errors
  document.getElementById('be-results').style.display = 'none';
  document.getElementById('be-error').style.display = 'none';
  
  // Get inputs
  const fixed = parseFloat(document.getElementById('be-fixed').value);
  const variable = parseFloat(document.getElementById('be-variable').value);
  const price = parseFloat(document.getElementById('be-price').value);
  
  // Validate inputs
  if (isNaN(fixed) || isNaN(variable) || isNaN(price)) {
    beShowError('Please enter valid numbers for all fields');
    return;
  }
  
  if (fixed < 0 || variable < 0 || price < 0) {
    beShowError('Values cannot be negative');
    return;
  }
  
  if (price <= variable) {
    beShowError('Selling price must be greater than variable cost');
    return;
  }
  
  // Calculate
  const contributionMargin = price - variable;
  const breakEvenUnits = fixed / contributionMargin;
  const breakEvenRevenue = breakEvenUnits * price;
  
  // Format numbers
  const formattedUnits = Math.ceil(breakEvenUnits).toLocaleString();
  const formattedRevenue = `Â£${breakEvenRevenue.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  const formattedMargin = `Â£${contributionMargin.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  
  // Display results
  document.getElementById('be-units').textContent = formattedUnits;
  document.getElementById('be-revenue').textContent = formattedRevenue;
  document.getElementById('be-margin').textContent = formattedMargin;
  
  // Show results
  document.getElementById('be-results').style.display = 'block';
  
  // Update simulation with current values
  document.getElementById('be-simulation-units').value = Math.round(breakEvenUnits * 1.5);
  beSimulateProfit();
}

// Profit simulation
function beSimulateProfit() {
  const simulationUnits = parseFloat(document.getElementById('be-simulation-units').value);
  
  if (isNaN(simulationUnits) || simulationUnits < 0) {
    return;
  }
  
  // Get current values
  const fixed = parseFloat(document.getElementById('be-fixed').value) || 0;
  const variable = parseFloat(document.getElementById('be-variable').value) || 0;
  const price = parseFloat(document.getElementById('be-price').value) || 0;
  
  // Calculate
  const totalRevenue = simulationUnits * price;
  const totalVariableCost = simulationUnits * variable;
  const totalCost = fixed + totalVariableCost;
  const profit = totalRevenue - totalCost;
  const profitMargin = totalRevenue > 0 ? (profit / totalRevenue) * 100 : 0;
  
  // Format results
  const formattedRevenue = `Â£${totalRevenue.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  const formattedCosts = `Â£${totalCost.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  const formattedProfit = `Â£${profit.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  const formattedMargin = `${profitMargin.toFixed(1)}%`;
  
  // Determine profit/loss color
  let profitColor = profit >= 0 ? '#39ff14' : '#ff4d4d';
  
  // Display simulation results
  document.getElementById('be-sim-revenue').textContent = formattedRevenue;
  document.getElementById('be-sim-costs').textContent = formattedCosts;
  document.getElementById('be-sim-profit').textContent = formattedProfit;
  document.getElementById('be-sim-profit').style.color = profitColor;
  document.getElementById('be-sim-margin').textContent = formattedMargin;
  
  // Show simulation results
  document.getElementById('be-simulation-results').style.display = 'block';
}

// Reset function
function beReset() {
  // Reset inputs to defaults
  document.getElementById('be-fixed').value = '10000';
  document.getElementById('be-variable').value = '5';
  document.getElementById('be-price').value = '10';
  document.getElementById('be-simulation-units').value = '1500';
  
  // Reset example buttons
  document.querySelectorAll('.be-example-btn').forEach(btn => {
    btn.style.background = '';
    btn.style.border = '1px solid rgba(255,255,255,0.1)';
  });
  
  // Clear results
  beClearResults();
  
  console.log("Break-even calculator reset");
}

// Clear results
function beClearResults() {
  document.getElementById('be-results').style.display = 'none';
  document.getElementById('be-error').style.display = 'none';
  document.getElementById('be-simulation-results').style.display = 'none';
}

// Show error
function beShowError(message) {
  document.getElementById('be-error-text').textContent = message;
  document.getElementById('be-error').style.display = 'block';
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', beInit);
} else {
  setTimeout(beInit, 100);
}
</script>
