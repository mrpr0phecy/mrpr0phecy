<h2 id="tip-calculator-title">ðŸ’¸ Tip & Split Calculator</h2>

<form aria-describedby="tip-calculator-desc">
  <p id="tip-calculator-desc" class="small">
    Calculate tips, split bills, and see exactly how much everyone owes.
    <span style="color:var(--accent)">Supports multiple currencies!</span>
  </p>
  
  <!-- Bill Amount -->
  <div class="field" style="margin-bottom:16px;">
    <label for="tc-bill" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Bill Amount
    </label>
    <div style="display:flex;gap:8px;align-items:center;">
      <select id="tc-currency" style="padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;font-size:14px;">
        <option value="GBP">Â£ GBP</option>
        <option value="USD">$ USD</option>
        <option value="EUR">â‚¬ EUR</option>
        <option value="CAD">$ CAD</option>
        <option value="AUD">$ AUD</option>
        <option value="JPY">Â¥ JPY</option>
        <option value="INR">â‚¹ INR</option>
      </select>
      <input id="tc-bill" type="number" min="0" step="0.01" value="50.00" 
             style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(255,255,255,0.05);color:inherit;font-family:monospace;"
             placeholder="0.00" />
    </div>
  </div>
  
  <!-- Tip Percentage -->
  <div class="field" style="margin-bottom:16px;">
    <label for="tc-tip-percent" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Tip Percentage
    </label>
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px;">
      <button type="button" onclick="tcSetTipPercent(10)" 
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;">
        10%
      </button>
      <button type="button" onclick="tcSetTipPercent(15)" 
              style="padding:8px 12px;background:rgba(45,212,255,0.2);border:1px solid rgba(45,212,255,0.4);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;font-weight:600;">
        15%
      </button>
      <button type="button" onclick="tcSetTipPercent(18)" 
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;">
        18%
      </button>
      <button type="button" onclick="tcSetTipPercent(20)" 
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;">
        20%
      </button>
      <button type="button" onclick="tcSetTipPercent(25)" 
              style="padding:8px 12px;background:rgba(45,212,255,0.1);border:1px solid rgba(45,212,255,0.3);border-radius:6px;color:var(--accent);cursor:pointer;font-size:14px;">
        25%
      </button>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <input id="tc-tip-percent" type="number" min="0" max="100" step="0.5" value="15" 
             style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;"
             aria-label="Custom tip percentage" />
      <div style="color:rgba(230,250,255,0.8);font-size:14px;">%</div>
    </div>
  </div>
  
  <!-- Number of People -->
  <div class="field" style="margin-bottom:20px;">
    <label for="tc-people" style="display:block;margin-bottom:6px;color:var(--accent);font-weight:500;">
      Number of People
    </label>
    <div style="display:flex;align-items:center;gap:12px;">
      <div style="display:flex;gap:4px;">
        <button type="button" onclick="tcAdjustPeople(-1)" 
                style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
          âˆ’
        </button>
        <input id="tc-people" type="number" min="1" max="50" step="1" value="2" 
               style="width:80px;padding:10px;border-radius:8px;border:1px solid rgba(45,212,255,0.3);background:rgba(45,212,255,0.05);color:inherit;text-align:center;font-size:16px;"
               aria-label="Number of people splitting the bill" />
        <button type="button" onclick="tcAdjustPeople(1)" 
                style="padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:16px;">
          +
        </button>
      </div>
      <div style="color:rgba(230,250,255,0.8);font-size:13px;">
        <span id="tc-people-label">2 people</span>
      </div>
    </div>
  </div>
  
  <!-- Round Up Option -->
  <div style="margin-bottom:20px;padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
      <input id="tc-round-up" type="checkbox" style="width:16px;height:16px;" />
      <span style="color:var(--accent);font-weight:500;">Round up to nearest whole currency unit</span>
    </label>
    <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-top:4px;">
      Makes splitting cash payments easier
    </div>
  </div>
  
  <!-- Actions -->
  <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
    <button type="button" onclick="tcCalculate(this)" 
            style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
      Calculate & Split
    </button>
    <button type="button" onclick="tcReset()"
            style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
      Reset
    </button>
  </div>
</form>

<!-- Results -->
<div class="results" aria-live="polite" style="margin-top:16px;">
  <h3 class="small" style="color:var(--accent);margin-bottom:8px;">ðŸ’° Bill Breakdown</h3>
  
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;">
    <div style="padding:12px;background:rgba(45,212,255,0.05);border-radius:8px;border:1px solid rgba(45,212,255,0.2);text-align:center;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Tip Amount</div>
      <div id="tc-result-tip" style="font-weight:600;font-size:18px;color:#2dd4ff;">â€“</div>
    </div>
    <div style="padding:12px;background:rgba(57,255,20,0.05);border-radius:8px;border:1px solid rgba(57,255,20,0.2);text-align:center;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Total Bill</div>
      <div id="tc-result-total" style="font-weight:600;font-size:18px;color:#39ff14;">â€“</div>
    </div>
    <div style="padding:12px;background:rgba(255,204,0,0.05);border-radius:8px;border:1px solid rgba(255,204,0,0.2);text-align:center;">
      <div style="font-size:12px;color:rgba(230,250,255,0.7);margin-bottom:4px;">Per Person</div>
      <div id="tc-result-person" style="font-weight:600;font-size:18px;color:#ffcc00;">â€“</div>
    </div>
  </div>
  
  <!-- Detailed Breakdown -->
  <div id="tc-detailed-breakdown" style="display:none;">
    <div style="padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(45,212,255,0.2);font-family:monospace;white-space:pre-line;">
      <div style="color:var(--accent);font-weight:600;margin-bottom:8px;">ðŸ“‹ Detailed Split</div>
      <div id="tc-breakdown-text">Enter bill details to see breakdown</div>
    </div>
  </div>
</div>

<!-- Quick Scenarios -->
<div style="margin-top:16px;padding:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);">
  <div style="color:var(--accent);font-weight:500;margin-bottom:8px;">ðŸ’¡ Quick Scenarios</div>
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
    <button type="button" onclick="tcLoadScenario('dinner')" 
            style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
      <div style="font-weight:500;">Dinner Out</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Â£85, 15%, 4 people</div>
    </button>
    <button type="button" onclick="tcLoadScenario('coffee')" 
            style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
      <div style="font-weight:500;">Coffee Run</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Â£25, 10%, 3 people</div>
    </button>
    <button type="button" onclick="tcLoadScenario('delivery')" 
            style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
      <div style="font-weight:500;">Food Delivery</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Â£40, 18%, 2 people</div>
    </button>
    <button type="button" onclick="tcLoadScenario('bar')" 
            style="padding:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#e6faff;cursor:pointer;font-size:13px;text-align:left;">
      <div style="font-weight:500;">Bar Tab</div>
      <div style="font-size:11px;color:rgba(230,250,255,0.7);">Â£120, 20%, 6 people</div>
    </button>
  </div>
</div>

<script>
/* tip-calculator.html
   - Enhanced tip calculator with multiple currencies and splitting
   - Scoped with tc- prefix (Tip Calculator)
*/

// Initialize on load
function tcInitialize() {
    const card = document.currentScript?.closest('.card') || document;
    
    // Cache elements
    window.tcElements = {
        bill: card.querySelector('#tc-bill'),
        currency: card.querySelector('#tc-currency'),
        tipPercent: card.querySelector('#tc-tip-percent'),
        people: card.querySelector('#tc-people'),
        peopleLabel: card.querySelector('#tc-people-label'),
        roundUp: card.querySelector('#tc-round-up'),
        resultTip: card.querySelector('#tc-result-tip'),
        resultTotal: card.querySelector('#tc-result-total'),
        resultPerson: card.querySelector('#tc-result-person'),
        breakdown: card.querySelector('#tc-detailed-breakdown'),
        breakdownText: card.querySelector('#tc-breakdown-text')
    };
    
    // Load saved settings
    const savedSettings = localStorage.getItem('tc-settings');
    if (savedSettings) {
        try {
            const settings = JSON.parse(savedSettings);
            if (settings.bill) tcElements.bill.value = settings.bill;
            if (settings.currency) tcElements.currency.value = settings.currency;
            if (settings.tipPercent) tcElements.tipPercent.value = settings.tipPercent;
            if (settings.people) tcElements.people.value = settings.people;
            if (settings.roundUp) tcElements.roundUp.checked = settings.roundUp;
        } catch (e) {
            console.log('No saved settings found');
        }
    }
    
    // Auto-calculate when inputs change
    tcElements.bill.addEventListener('input', function() {
        tcUpdatePeopleLabel();
        tcCalculate();
        tcSaveSettings();
    });
    
    tcElements.tipPercent.addEventListener('input', function() {
        tcCalculate();
        tcSaveSettings();
    });
    
    tcElements.currency.addEventListener('change', function() {
        tcCalculate();
        tcSaveSettings();
    });
    
    tcElements.people.addEventListener('input', function() {
        tcUpdatePeopleLabel();
        tcCalculate();
        tcSaveSettings();
    });
    
    tcElements.roundUp.addEventListener('change', function() {
        tcCalculate();
        tcSaveSettings();
    });
    
    // Initial calculation
    tcUpdatePeopleLabel();
    tcCalculate();
    
    console.log('Tip Calculator initialized');
}

// Save settings to localStorage
function tcSaveSettings() {
    if (!window.tcElements) return;
    
    const settings = {
        bill: tcElements.bill.value,
        currency: tcElements.currency.value,
        tipPercent: tcElements.tipPercent.value,
        people: tcElements.people.value,
        roundUp: tcElements.roundUp.checked,
        timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('tc-settings', JSON.stringify(settings));
}

// Set tip percentage
function tcSetTipPercent(percent) {
    if (!window.tcElements) tcInitialize();
    tcElements.tipPercent.value = percent;
    tcCalculate();
    tcSaveSettings();
}

// Adjust number of people
function tcAdjustPeople(change) {
    if (!window.tcElements) tcInitialize();
    const current = parseInt(tcElements.people.value) || 2;
    const newValue = Math.max(1, Math.min(50, current + change));
    tcElements.people.value = newValue;
    tcUpdatePeopleLabel();
    tcCalculate();
    tcSaveSettings();
}

// Update people label
function tcUpdatePeopleLabel() {
    if (!window.tcElements) return;
    const count = parseInt(tcElements.people.value) || 1;
    tcElements.peopleLabel.textContent = `${count} person${count !== 1 ? 's' : ''}`;
}

// Format money with currency
function tcFormatMoney(amount, currencyCode) {
    // Special handling for currencies without decimals
    const noDecimals = ['JPY'];
    
    const options = {
        style: 'currency',
        currency: currencyCode,
        minimumFractionDigits: noDecimals.includes(currencyCode) ? 0 : 2,
        maximumFractionDigits: noDecimals.includes(currencyCode) ? 0 : 2
    };
    
    try {
        return new Intl.NumberFormat('en-US', options).format(amount);
    } catch (e) {
        // Fallback formatting
        const symbols = {
            'GBP': 'Â£', 'USD': '$', 'EUR': 'â‚¬', 'CAD': '$', 
            'AUD': '$', 'JPY': 'Â¥', 'INR': 'â‚¹'
        };
        const symbol = symbols[currencyCode] || currencyCode;
        return `${symbol}${amount.toFixed(2)}`;
    }
}

// Round to nearest whole unit if enabled
function tcRoundIfNeeded(amount, currencyCode) {
    if (!window.tcElements?.roundUp.checked) return amount;
    
    // JPY doesn't need rounding (no decimals)
    if (currencyCode === 'JPY') return Math.round(amount);
    
    return Math.ceil(amount);
}

// Main calculation function
function tcCalculate() {
    if (!window.tcElements) tcInitialize();
    
    // Get values
    const bill = parseFloat(tcElements.bill.value) || 0;
    const tipPercent = parseFloat(tcElements.tipPercent.value) || 0;
    const people = parseInt(tcElements.people.value) || 1;
    const currency = tcElements.currency.value;
    
    if (bill <= 0) {
        tcElements.resultTip.textContent = 'â€“';
        tcElements.resultTotal.textContent = 'â€“';
        tcElements.resultPerson.textContent = 'â€“';
        tcElements.breakdown.style.display = 'none';
        return;
    }
    
    // Calculate
    const tipAmount = bill * (tipPercent / 100);
    let totalAmount = bill + tipAmount;
    let perPerson = totalAmount / people;
    
    // Apply rounding if enabled
    if (tcElements.roundUp.checked) {
        totalAmount = tcRoundIfNeeded(totalAmount, currency);
        perPerson = tcRoundIfNeeded(perPerson, currency);
    }
    
    // Update results
    tcElements.resultTip.textContent = tcFormatMoney(tipAmount, currency);
    tcElements.resultTotal.textContent = tcFormatMoney(totalAmount, currency);
    tcElements.resultPerson.textContent = tcFormatMoney(perPerson, currency);
    
    // Show detailed breakdown
    tcUpdateBreakdown(bill, tipAmount, totalAmount, perPerson, people, currency);
}

// Update detailed breakdown
function tcUpdateBreakdown(bill, tip, total, perPerson, people, currency) {
    if (!window.tcElements) return;
    
    const roundNote = tcElements.roundUp.checked ? 
        '\n* Amounts rounded up to nearest whole unit' : '';
    
    const breakdown = `Bill: ${tcFormatMoney(bill, currency)}\n` +
                      `Tip (${tcElements.tipPercent.value}%): ${tcFormatMoney(tip, currency)}\n` +
                      `Total: ${tcFormatMoney(total, currency)}\n` +
                      `Split ${people} ways: ${tcFormatMoney(perPerson, currency)} each${roundNote}\n\n`;
    
    // Add per-person breakdown if multiple people
    if (people > 1) {
        let splitText = 'Individual shares:\n';
        for (let i = 1; i <= Math.min(people, 8); i++) {
            splitText += `  Person ${i}: ${tcFormatMoney(perPerson, currency)}\n`;
        }
        if (people > 8) {
            splitText += `  ... and ${people - 8} more at ${tcFormatMoney(perPerson, currency)} each`;
        }
        tcElements.breakdownText.textContent = breakdown + splitText;
    } else {
        tcElements.breakdownText.textContent = breakdown;
    }
    
    tcElements.breakdown.style.display = 'block';
}

// Load quick scenario
function tcLoadScenario(type) {
    if (!window.tcElements) tcInitialize();
    
    const scenarios = {
        'dinner': { bill: 85, tip: 15, people: 4, currency: 'GBP' },
        'coffee': { bill: 25, tip: 10, people: 3, currency: 'GBP' },
        'delivery': { bill: 40, tip: 18, people: 2, currency: 'GBP' },
        'bar': { bill: 120, tip: 20, people: 6, currency: 'GBP' }
    };
    
    const scenario = scenarios[type];
    if (!scenario) return;
    
    tcElements.bill.value = scenario.bill;
    tcElements.tipPercent.value = scenario.tip;
    tcElements.people.value = scenario.people;
    tcElements.currency.value = scenario.currency;
    
    tcUpdatePeopleLabel();
    tcCalculate();
    tcSaveSettings();
}

// Reset function
function tcReset() {
    if (!window.tcElements) tcInitialize();
    
    tcElements.bill.value = '50.00';
    tcElements.currency.value = 'GBP';
    tcElements.tipPercent.value = '15';
    tcElements.people.value = '2';
    tcElements.roundUp.checked = false;
    
    tcElements.resultTip.textContent = 'â€“';
    tcElements.resultTotal.textContent = 'â€“';
    tcElements.resultPerson.textContent = 'â€“';
    tcElements.breakdown.style.display = 'none';
    
    tcUpdatePeopleLabel();
    tcCalculate();
    localStorage.removeItem('tc-settings');
}

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', tcInitialize);
} else {
    tcInitialize();
}
</script>

<style>
/* Card-specific styles */
#tip-calculator-title {
    color: var(--accent);
    margin-top: 0;
}

/* Custom checkbox styling */
input[type="checkbox"] {
    accent-color: var(--accent);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .results > div:first-child {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    /* Fix for iOS zooming */
    input[type="number"], input[type="text"] {
        font-size: 16px;
    }
    
    .quick-scenarios-grid {
        grid-template-columns: 1fr;
    }
}

/* Focus styles for better accessibility */
input:focus, select:focus, button:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Animation for results */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

.results > div {
    animation: fadeIn 0.3s ease-out;
}

/* Smooth transitions for interactive elements */
button, input, select {
    transition: all 0.2s ease;
}

button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Scrollbar styling */
.scrollable {
    scrollbar-width: thin;
    scrollbar-color: rgba(45,212,255,0.3) transparent;
}

.scrollable::-webkit-scrollbar {
    width: 8px;
}

.scrollable::-webkit-scrollbar-track {
    background: transparent;
}

.scrollable::-webkit-scrollbar-thumb {
    background-color: rgba(45,212,255,0.3);
    border-radius: 4px;
}
</style>
