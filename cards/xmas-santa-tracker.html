<!-- cards/xmas-santa-tracker.html -->
<h2 id="xmas-santa-tracker-title">üéÖ XMAS Santa Tracker & Message Center</h2>

<form aria-describedby="santa-tracker-desc">
    <p id="santa-tracker-desc" class="small">
        Track Santa's journey and send him a message! Get a personalized response from the North Pole.
        <span style="color:var(--accent)">Perfect for kids and kids-at-heart!</span>
    </p>
    
    <!-- TRACKER SECTION -->
    <div style="margin-bottom:20px;padding:16px;background:linear-gradient(135deg, rgba(220,20,60,0.1), rgba(255,20,147,0.05));border-radius:10px;border:1px solid rgba(220,20,60,0.3);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
                <div style="font-size:14px;color:rgba(255,255,255,0.7);margin-bottom:4px;">üéÖ SANTA'S CURRENT STATUS</div>
                <div id="st-status" style="font-size:18px;font-weight:600;color:#ff2d55;">Loading tracker...</div>
            </div>
            <div id="st-countdown" style="text-align:center;">
                <div style="font-size:12px;color:rgba(255,255,255,0.6);">HOURS UNTIL</div>
                <div style="font-size:24px;font-weight:700;color:#ff2d55;">24</div>
                <div style="font-size:12px;color:rgba(255,255,255,0.6);">YOUR HOUSE</div>
            </div>
        </div>
        
        <!-- FAKE RADAR -->
        <div style="position:relative;height:120px;background:linear-gradient(180deg, #001122, #002244);border-radius:8px;overflow:hidden;margin-bottom:12px;">
            <div style="position:absolute;top:50%;left:0;right:0;height:1px;background:rgba(0,255,255,0.2);"></div>
            <div style="position:absolute;left:50%;top:0;bottom:0;width:1px;background:rgba(0,255,255,0.2);"></div>
            
            <!-- Radar sweep -->
            <div id="st-radar-sweep" style="position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;border:60px solid rgba(255,20,147,0.1);transform:translate(-50%,-50%);"></div>
            
            <!-- "Santa" dot -->
            <div id="st-santa-dot" style="position:absolute;top:40%;left:60%;width:12px;height:12px;background:radial-gradient(circle, #ff2d55, #ff1493);border-radius:50%;box-shadow:0 0 20px #ff2d55;"></div>
            
            <!-- City labels -->
            <div style="position:absolute;top:20%;left:30%;color:rgba(0,255,255,0.8);font-size:11px;">North Pole</div>
            <div style="position:absolute;bottom:30%;right:20%;color:rgba(0,255,255,0.8);font-size:11px;">Your Location</div>
        </div>
        
        <!-- Location info -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div>
                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:2px;">Current Location</div>
                <div id="st-location" style="font-weight:500;color:#ffcc00;">Over the Atlantic</div>
            </div>
            <div>
                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:2px;">Presents Delivered</div>
                <div id="st-presents" style="font-weight:500;color:#39ff14;">1.2 billion</div>
            </div>
        </div>
    </div>
    
    <!-- MESSAGE TO SANTA SECTION -->
    <div style="margin-bottom:20px;">
        <h3 class="small" style="color:var(--accent);margin-bottom:8px;">‚úâÔ∏è Send Santa a Message</h3>
        
        <div class="field" style="margin-bottom:12px;">
            <label for="st-name" style="display:block;margin-bottom:6px;color:#ffcc00;font-weight:500;">
                Your Name
            </label>
            <input id="st-name" type="text" placeholder="e.g., Timmy or Sarah" 
                   style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;" />
        </div>
        
        <div class="field" style="margin-bottom:12px;">
            <label for="st-message" style="display:block;margin-bottom:6px;color:#ffcc00;font-weight:500;">
                Your Message to Santa
            </label>
            <textarea id="st-message" rows="3" placeholder="What would you like to tell Santa? Ask for gifts, say hello, or tell him you've been good!"
                      style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,204,0,0.3);background:rgba(255,204,0,0.05);color:inherit;resize:vertical;"></textarea>
        </div>
        
        <div style="display:flex;gap:8px;margin-top:16px;">
            <button type="button" onclick="stSendMessage(this)" 
                    style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(255,45,85,0.3), rgba(255,20,147,0.2));border:1px solid rgba(255,45,85,0.5);border-radius:8px;color:#ff2d55;cursor:pointer;font-weight:600;">
                ‚ú® Send to Santa
            </button>
            <button type="button" onclick="stGenerateRandomMessage(this)"
                    style="padding:12px 16px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;color:#ffcc00;cursor:pointer;">
                üé≤ Random Message
            </button>
        </div>
    </div>
    
    <!-- SANTA'S RESPONSE -->
    <div id="st-response-section" style="display:none;margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(57,255,20,0.1), rgba(0,255,153,0.05));border-radius:10px;border:1px solid rgba(57,255,20,0.3);">
        <h3 class="small" style="color:#39ff14;margin-bottom:8px;">üéÖ Santa's Response</h3>
        
        <div id="st-response-content" style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(57,255,20,0.2);min-height:80px;font-style:italic;">
            Waiting for Santa to reply...
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
            <div style="font-size:12px;color:rgba(57,255,20,0.7);">
                üìç Direct from the North Pole
            </div>
            <button type="button" onclick="stShareResponse(this)" 
                    style="padding:8px 12px;background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);border-radius:6px;color:#39ff14;cursor:pointer;font-size:12px;">
                üì§ Share Response
            </button>
        </div>
    </div>
    
    <!-- ACTIONS -->
    <div class="actions" style="margin-top:20px;display:flex;gap:10px;">
        <button type="button" onclick="stStartTracker(this)" 
                style="flex:1;padding:12px;background:linear-gradient(135deg, rgba(45,212,255,0.2), rgba(45,212,255,0.1));border:1px solid rgba(45,212,255,0.4);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600;">
            üé¨ Start Live Tracker
        </button>
        <button type="button" onclick="stResetAll(this)"
                style="padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:inherit;cursor:pointer;">
            üîÑ Reset All
        </button>
    </div>
</form>

<!-- FUN FACTS -->
<div style="margin-top:16px;padding:12px;background:rgba(157,78,221,0.1);border-radius:8px;border:1px solid rgba(157,78,221,0.3);">
    <div style="color:#9d4edd;font-weight:600;margin-bottom:6px;font-size:14px;">üéÑ Santa Tracker Fun Facts</div>
    <div id="st-fun-fact" style="font-size:13px;color:rgba(230,250,255,0.8);">
        Loading holiday fact...
    </div>
</div>

<script>
/* xmas-santa-tracker.html
   - Santa tracker with messaging system
   - Scoped with st- prefix
*/

let stTrackerInterval = null;
let stIsTracking = false;
let stHoursUntilArrival = 24;
let stSantaPosition = { x: 60, y: 40 }; // percentage position
let stCurrentLocationIndex = 0;

// Santa locations (progress around the world)
const stLocations = [
    { name: "North Pole Workshop", presents: "0.1 billion" },
    { name: "Over Greenland", presents: "0.3 billion" },
    { name: "Over the Atlantic", presents: "0.6 billion" },
    { name: "East Coast USA", presents: "0.9 billion" },
    { name: "Midwest USA", presents: "1.2 billion" },
    { name: "West Coast USA", presents: "1.5 billion" },
    { name: "Over the Pacific", presents: "1.8 billion" },
    { name: "Asia", presents: "2.1 billion" },
    { name: "Europe", presents: "2.4 billion" },
    { name: "Almost to your house!", presents: "2.7 billion" }
];

// Santa responses (randomized)
const stResponses = [
    "Ho ho ho! Thank you for your message! I've checked my list twice and I see you've been very good this year! The elves are working hard on your presents. Remember to leave out some cookies! üç™ - Santa",
    
    "Greetings from the North Pole! Rudolph's nose is extra bright tonight, guiding us through the snowy skies. Your kindness this year has not gone unnoticed. Keep spreading joy! ü¶å - Santa Claus",
    
    "Merry Christmas! The reindeer are rested and ready. I appreciate you taking the time to write. Remember, the best gift you can give is love and kindness to others. üéÅ - Santa",
    
    "Ho ho ho! I'm flying over with a sleigh full of presents as we speak! Your message warmed my heart on this cold night. Stay on the Nice List by helping others! ‚ùÑÔ∏è - Santa",
    
    "Message received! Mrs. Claus says hello too! We're making great time thanks to clear skies. Your good deeds this year shine brighter than any Christmas star. üåü - Santa",
    
    "Greetings! The elves are cheering as we read your message. They say you've earned extra candy canes this year! Keep up the wonderful work. üç¨ - Santa & The Elves",
    
    "Ho ho ho! What a delightful message! I've added an extra sprinkle of magic to your gifts. Remember to dream big and be kind to all creatures. üéÑ - Santa",
    
    "North Pole to Earth, reading you loud and clear! Your Christmas spirit is contagious. We can feel it all the way up here! Keep being amazing! üéÖ - Santa Claus",
    
    "Message delivered to the workshop! The reindeer are excited to visit your home. They can smell the carrots you're leaving out! ü•ï - Santa & The Reindeer Team",
    
    "Jingle bells! Your kindness echoes through the snow-capped mountains. I've made a special note in my book for next year too! üé∂ - Santa"
];

// Fun facts about Santa/Christmas
const stFunFacts = [
    "Santa would need to visit 822 homes per second to deliver all presents!",
    "Rudolph's red nose is scientifically possible - reindeer have 25% more capillaries in their noses!",
    "The original Santa (St. Nicholas) was known for secretly giving gifts to poor families.",
    "Santa's sleigh would need to travel at 1,800 miles per second to visit every child.",
    "The North Pole email server receives over 12 million messages to Santa each December!",
    "Mrs. Claus first appeared in literature in 1849 in a story called 'A Christmas Legend.'",
    "Santa's elves are said to make over 1 billion toys each year in the North Pole workshop.",
    "The heaviest Christmas stocking ever made was 168 feet long and weighed 1,064 pounds!",
    "Santa has different names around the world: P√®re No√´l (France), Babbo Natale (Italy), Weihnachtsmann (Germany).",
    "The first department store Santa appeared in 1890 in Boston."
];

// Message templates (for random message button)
const stMessageTemplates = [
    "Dear Santa, I've tried my best to be good this year. Can I please get a new bike?",
    "Hi Santa! I left extra cookies for you and carrots for the reindeer. Merry Christmas!",
    "Santa, my little brother says he wants a puppy. Is that possible?",
    "Dear Santa, I helped my mom bake cookies and donated my old toys. Have a safe trip!",
    "Santa, I really hope I'm on the nice list this year. I've been practicing kindness.",
    "Ho ho ho Santa! What's your favorite type of cookie? We're baking tonight!",
    "Dear Santa, how do you fit all those presents in one sleigh? It must be magic!",
    "Santa, say hi to Mrs. Claus and the elves for me!",
    "I left you hot cocoa instead of milk this year. Hope you like it!",
    "Santa, what's Rudolph's favorite Christmas song? We're singing carols!"
];

function stStartTracker(btn) {
    if (stIsTracking) {
        stStopTracker();
        btn.textContent = "üé¨ Start Live Tracker";
        return;
    }
    
    const card = btn.closest('.card') || document;
    stIsTracking = true;
    btn.textContent = "‚è∏Ô∏è Stop Tracker";
    
    // Update status
    card.querySelector('#st-status').textContent = "IN TRANSIT - MAKING DELIVERIES";
    card.querySelector('#st-status').style.color = "#39ff14";
    
    // Start radar animation
    const radar = card.querySelector('#st-radar-sweep');
    radar.style.animation = "stRadarSweep 3s linear infinite";
    
    // Start tracker interval
    stTrackerInterval = setInterval(() => {
        stUpdateTracker(card);
    }, 3000);
    
    // Show initial location
    stUpdateSantaPosition(card);
}

function stStopTracker() {
    stIsTracking = false;
    if (stTrackerInterval) {
        clearInterval(stTrackerInterval);
        stTrackerInterval = null;
    }
    
    const card = document.currentScript?.closest('.card') || document;
    const radar = card.querySelector('#st-radar-sweep');
    radar.style.animation = "";
    
    card.querySelector('#st-status').textContent = "TRACKER PAUSED";
    card.querySelector('#st-status').style.color = "#ffcc00";
}

function stUpdateTracker(card) {
    // Update countdown (random but decreasing)
    if (stHoursUntilArrival > 0) {
        stHoursUntilArrival = Math.max(0, stHoursUntilArrival - (Math.random() * 0.5));
    }
    
    // Update location (cycle through locations)
    stCurrentLocationIndex = (stCurrentLocationIndex + 1) % stLocations.length;
    const location = stLocations[stCurrentLocationIndex];
    
    // Update Santa position (move toward "your house" - bottom right)
    stSantaPosition.x = Math.min(90, stSantaPosition.x + (Math.random() * 10));
    stSantaPosition.y = Math.min(80, stSantaPosition.y + (Math.random() * 8));
    
    // Update display
    card.querySelector('#st-countdown').querySelector('div:nth-child(2)').textContent = 
        Math.round(stHoursUntilArrival);
    card.querySelector('#st-location').textContent = location.name;
    card.querySelector('#st-presents').textContent = location.presents;
    
    // Update Santa dot position
    const santaDot = card.querySelector('#st-santa-dot');
    santaDot.style.left = `${stSantaPosition.x}%`;
    santaDot.style.top = `${stSantaPosition.y}%`;
    
    // Update fun fact occasionally
    if (Math.random() > 0.7) {
        stUpdateFunFact(card);
    }
}

function stUpdateSantaPosition(card) {
    const santaDot = card.querySelector('#st-santa-dot');
    santaDot.style.left = `${stSantaPosition.x}%`;
    santaDot.style.top = `${stSantaPosition.y}%`;
}

function stUpdateFunFact(card) {
    const randomFact = stFunFacts[Math.floor(Math.random() * stFunFacts.length)];
    card.querySelector('#st-fun-fact').textContent = randomFact;
}

function stSendMessage(btn) {
    const card = btn.closest('.card') || document;
    const nameInput = card.querySelector('#st-name');
    const messageInput = card.querySelector('#st-message');
    
    const name = nameInput.value.trim();
    const message = messageInput.value.trim();
    
    if (!name) {
        alert("Please enter your name so Santa knows who's writing!");
        nameInput.focus();
        return;
    }
    
    if (!message) {
        alert("Please write a message to Santa!");
        messageInput.focus();
        return;
    }
    
    // Show sending animation
    const originalText = btn.textContent;
    btn.textContent = "‚ú® Sending...";
    btn.disabled = true;
    
    // Simulate sending delay
    setTimeout(() => {
        // Get random response
        const response = stResponses[Math.floor(Math.random() * stResponses.length)];
        
        // Update response section
        const responseSection = card.querySelector('#st-response-section');
        const responseContent = card.querySelector('#st-response-content');
        
        // Personalize response with name
        const personalizedResponse = response.replace(/your/g, `${name}'s`);
        
        responseContent.innerHTML = `"${personalizedResponse}"`;
        responseSection.style.display = 'block';
        
        // Scroll to response
        responseSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        
        // Reset button
        btn.textContent = originalText;
        btn.disabled = false;
        
        // Add to message history (simulated)
        stSaveMessageToHistory(name, message);
        
        // Play success sound if available
        stPlaySantaSound();
        
    }, 1500 + Math.random() * 1000); // Random delay 1.5-2.5 seconds
}

function stGenerateRandomMessage(btn) {
    const card = btn.closest('.card') || document;
    const messageInput = card.querySelector('#st-message');
    
    const randomTemplate = stMessageTemplates[Math.floor(Math.random() * stMessageTemplates.length)];
    messageInput.value = randomTemplate;
    
    // Also fill name if empty
    const nameInput = card.querySelector('#st-name');
    if (!nameInput.value.trim()) {
        const kidNames = ["Timmy", "Sarah", "Alex", "Emma", "Noah", "Olivia", "Liam", "Ava", "Lucas", "Mia"];
        nameInput.value = kidNames[Math.floor(Math.random() * kidNames.length)];
    }
    
    // Visual feedback
    const originalText = btn.textContent;
    btn.textContent = "‚ú® Generated!";
    setTimeout(() => {
        btn.textContent = originalText;
    }, 1000);
}

function stShareResponse(btn) {
    const card = btn.closest('.card') || document;
    const responseContent = card.querySelector('#st-response-content').textContent;
    const name = card.querySelector('#st-name').value || "a child";
    
    // Create shareable text
    const shareText = `üéÖ I just got a message back from Santa! He says: "${responseContent.substring(0, 100)}..."\n\nTry it yourself: The Most Useful Site in the World`;
    
    // Try Web Share API first
    if (navigator.share) {
        navigator.share({
            title: "Santa Sent Me a Message!",
            text: shareText,
            url: window.location.href
        }).catch(() => {
            // Fallback to clipboard
            navigator.clipboard.writeText(shareText).then(() => {
                btn.textContent = "‚úÖ Copied!";
                setTimeout(() => btn.textContent = "üì§ Share Response", 2000);
            });
        });
    } else {
        // Fallback to clipboard
        navigator.clipboard.writeText(shareText).then(() => {
            btn.textContent = "‚úÖ Copied to clipboard!";
            setTimeout(() => btn.textContent = "üì§ Share Response", 2000);
        });
    }
}

function stSaveMessageToHistory(name, message) {
    // In a real app, you'd save to localStorage or server
    console.log(`Message saved: ${name} - "${message.substring(0, 50)}..."`);
    
    // Simple localStorage for demo
    try {
        const history = JSON.parse(localStorage.getItem('st-message-history') || '[]');
        history.unshift({
            name: name,
            message: message,
            timestamp: new Date().toISOString(),
            responded: true
        });
        
        // Keep only last 10
        if (history.length > 10) history.length = 10;
        
        localStorage.setItem('st-message-history', JSON.stringify(history));
    } catch (e) {
        // Silently fail
    }
}

function stPlaySantaSound() {
    try {
        // Create a simple "bell" sound using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(1200, audioContext.currentTime + 0.1);
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
    } catch (e) {
        // Sound not supported, continue silently
    }
}

function stResetAll(btn) {
    const card = btn.closest('.card') || document;
    
    // Stop tracker if running
    stStopTracker();
    
    // Reset values
    stHoursUntilArrival = 24;
    stSantaPosition = { x: 60, y: 40 };
    stCurrentLocationIndex = 0;
    
    // Update display
    card.querySelector('#st-status').textContent = "TRACKER READY";
    card.querySelector('#st-status').style.color = "#ff2d55";
    card.querySelector('#st-countdown').querySelector('div:nth-child(2)').textContent = "24";
    card.querySelector('#st-location').textContent = "North Pole";
    card.querySelector('#st-presents').textContent = "0.1 billion";
    
    // Reset inputs
    card.querySelector('#st-name').value = "";
    card.querySelector('#st-message').value = "";
    
    // Hide response
    card.querySelector('#st-response-section').style.display = 'none';
    
    // Update Santa position
    stUpdateSantaPosition(card);
    
    // Update fun fact
    stUpdateFunFact(card);
    
    // Reset start button
    const startBtn = card.querySelector('.actions button:first-child');
    if (startBtn) startBtn.textContent = "üé¨ Start Live Tracker";
}

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.currentScript?.closest('.card') || document;
        
        // Initialize fun fact
        stUpdateFunFact(card);
        
        // Update Santa position
        stUpdateSantaPosition(card);
        
        // Add CSS animation for radar
        const style = document.createElement('style');
        style.textContent = `
            @keyframes stRadarSweep {
                0% { 
                    transform: translate(-50%, -50%) rotate(0deg);
                    border-color: rgba(255,20,147,0.1);
                }
                50% {
                    border-color: rgba(255,20,147,0.3);
                }
                100% { 
                    transform: translate(-50%, -50%) rotate(360deg);
                    border-color: rgba(255,20,147,0.1);
                }
            }
            
            #st-santa-dot {
                transition: left 2s ease-in-out, top 2s ease-in-out;
            }
        `;
        card.appendChild(style);
        
        console.log('XMAS Santa Tracker ready!');
    });
} else {
    // Run immediately if already loaded
    const card = document.currentScript?.closest('.card') || document;
    stUpdateFunFact(card);
    stUpdateSantaPosition(card);
}
</script>

<style>
#xmas-santa-tracker-title {
    color: #ff2d55 !important; /* Christmas red */
    margin-top: 0;
    font-size: 1.4rem !important;
}

/* Make radar responsive */
@media (max-width: 768px) {
    #st-countdown div:nth-child(2) {
        font-size: 20px !important;
    }
    
    #st-status {
        font-size: 16px !important;
    }
}

/* Print-friendly */
@media print {
    .embed-section, button, input, textarea {
        display: none !important;
    }
}
</style>
