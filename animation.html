<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MrProphecy Hip-Hop Screensaver</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; }
    @font-face {
      font-family: 'HipHopFont';
      src: url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
    }
  </style>
</head>
<body>
  <script>
    let particles = [];
    let shapes = [];
    let glitchTimer = 0;
    const GLITCH_INTERVAL = 120; // Glitch every 120 frames (~2 seconds at 60 FPS)
    let noiseScale = 0.002; // For Perlin noise
    let time = 0; // For animation evolution

    function setup() {
      createCanvas(windowWidth, windowHeight);
      colorMode(HSB, 360, 100, 100, 1);
      
      // Initialize particles with varied properties
      for (let i = 0; i < 200; i++) {
        particles.push({
          x: random(width),
          y: random(height),
          vx: random(-1.5, 1.5),
          vy: random(-1.5, 1.5),
          size: random(5, 20),
          hue: random(360),
          alpha: random(0.5, 1),
          type: random(['circle', 'square', 'triangle'])
        });
      }
      
      // Initialize fractal-inspired shapes
      for (let i = 0; i < 20; i++) {
        shapes.push({
          x: random(width),
          y: random(height),
          size: random(50, 120),
          angle: random(TWO_PI),
          speed: random(-0.03, 0.03),
          hue: random(360),
          glitchOffsetX: 0,
          glitchOffsetY: 0,
          variation: random(['linear', 'swirl']) // Inspired by FLAM3 variations
        });
      }

      // Optional: Initialize audio input (uncomment to enable)
      /*
      mic = new p5.AudioIn();
      mic.start();
      */
    }

    function draw() {
      // Semi-transparent background for smooth trails
      background(0, 0, 0, 0.15);
      time += 0.01; // Increment time for evolution

      // Layer 1: Perlin noise background (inspired by Electric Sheepâ€™s organic motion)
      drawNoiseBackground();

      // Layer 2: Fractal-inspired shapes with glitch effects
      glitchTimer++;
      if (glitchTimer > GLITCH_INTERVAL) {
        glitchTimer = 0;
        applyGlitch();
      }
      for (let s of shapes) {
        push();
        translate(s.x + s.glitchOffsetX, s.y + s.glitchOffsetY);
        rotate(s.angle);
        fill(s.hue, 80, 80, 0.7);
        noStroke();
        if (s.variation === 'swirl') {
          // Swirl effect inspired by FLAM3 variations
          let swirl = sin(time + s.x * 0.01) * 20;
          beginShape();
          for (let a = 0; a < TWO_PI; a += 0.1) {
            let r = s.size * (1 + 0.2 * sin(a * 6 + time));
            vertex(r * cos(a + swirl), r * sin(a + swirl));
          }
          endShape(CLOSE);
        } else {
          // Linear geometric shape
          triangle(
            -s.size / 2, s.size / 2,
            s.size / 2, s.size / 2,
            0, -s.size / 2
          );
        }
        s.angle += s.speed;
        s.hue = (s.hue + 0.3) % 360; // Gradual color shift
        pop();
      }

      // Layer 3: Enhanced particle system
      // Optional: Audio reactivity (uncomment mic code and add this)
      /*
      let vol = mic.getLevel();
      */
      for (let p of particles) {
        fill(p.hue, 80, 80, p.alpha);
        noStroke();
        push();
        translate(p.x, p.y);
        if (p.type === 'circle') {
          ellipse(0, 0, p.size /* * map(vol, 0, 1, 1, 2) */);
        } else if (p.type === 'square') {
          rect(-p.size / 2, -p.size / 2, p.size, p.size);
        } else {
          triangle(
            -p.size / 2, p.size / 2,
            p.size / 2, p.size / 2,
            0, -p.size / 2
          );
        }
        pop();
        p.x += p.vx;
        p.y += p.vy;
        // Bounce off edges
        if (p.x < 0 || p.x > width) p.vx *= -1;
        if (p.y < 0 || p.y > height) p.vy *= -1;
        p.hue = (p.hue + random(0.5)) % 360; // Random color shift
        p.size = constrain(p.size + random(-0.2, 0.2), 5, 20); // Slight size variation
      }

      // Layer 4: Glitchy text overlay
      drawGlitchText("MrProphecy", width - 220, height - 50, 40);
    }

    function drawNoiseBackground() {
      // Perlin noise background with evolving colors
      loadPixels();
      for (let x = 0; x < width; x += 8) {
        for (let y = 0; y < height; y += 8) {
          let n = noise(x * noiseScale, y * noiseScale, time);
          let hue = map(n, 0, 1, 0, 360);
          fill(hue, 50, 50, 0.4);
          noStroke();
          rect(x, y, 8, 8);
        }
      }
      updatePixels();
    }

    function applyGlitch() {
      // Apply glitch to shapes
      for (let s of shapes) {
        s.glitchOffsetX = random(-15, 15);
        s.glitchOffsetY = random(-15, 15);
        setTimeout(() => {
          s.glitchOffsetX = 0;
          s.glitchOffsetY = 0;
        }, 100); // Reset after 100ms
      }
    }

    function drawGlitchText(text, x, y, size) {
      // Glitchy text with neon effect
      fill(60, 100, 100, 1); // Neon yellow
      textSize(size);
      textStyle(BOLD);
      textFont('Orbitron');
      text(text, x, y);
      if (random() < 0.1) { // 10% chance per frame for glitch
        fill(180, 100, 100, 0.6); // Cyan glitch
        text(text, x + random(-10, 10), y + random(-10, 10));
        fill(300, 100, 100, 0.6); // Magenta glitch
        text(text, x + random(-10, 10), y + random(-10, 10));
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>