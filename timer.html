<h2 id="palette-swapper-title" style="margin-top:0;">Palette Swapper</h2>

<form aria-describedby="palette-swapper-desc">
  <p id="palette-swapper-desc" class="small">Upload an image and swap one color for another.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="palette-file">Image</label>
      <input id="palette-file" type="file" accept="image/*" style="width:100%;" />
    </div>
    <div class="field">
      <label for="palette-from">From Color (hex)</label>
      <input id="palette-from" type="text" placeholder="#ff0000" style="width:100%;" />
    </div>
    <div class="field">
      <label for="palette-to">To Color (hex)</label>
      <input id="palette-to" type="text" placeholder="#00ff00" style="width:100%;" />
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="paletteSwap(this)">Swap</button>
    <button type="button" class="secondary" onclick="paletteReset(this)">Reset</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Palette Swap Results</h3>
  <canvas id="palette-output" style="max-width:100%;border:1px solid rgba(255,255,255,0.08);"></canvas>
  <div id="palette-hint" class="small" style="margin-top:8px;opacity:0.9;"></div>
</div>

<script>
function paletteReset(btn){
  const card=btn.closest('.card')||document;
  card.querySelector('form').reset();
  const ctx=card.querySelector('#palette-output').getContext('2d');
  ctx.clearRect(0,0,card.querySelector('#palette-output').width,card.querySelector('#palette-output').height);
  card.querySelector('#palette-hint').textContent="";
}

function paletteSwap(btn){
  const card=btn.closest('.card')||document;
  const file=card.querySelector('#palette-file').files[0];
  const from=card.querySelector('#palette-from').value;
  const to=card.querySelector('#palette-to').value;
  if(!file||!from||!to){
    card.querySelector('#palette-hint').textContent="Please provide an image and both colors.";
    return;
  }
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const canvas=card.querySelector('#palette-output');
      canvas.width=img.width; canvas.height=img.height;
      const ctx=canvas.getContext('2d');
      ctx.drawImage(img,0,0);
      const data=ctx.getImageData(0,0,img.width,img.height);
      const fromRGB=hexToRgb(from), toRGB=hexToRgb(to);
      for(let i=0;i<data.data.length;i+=4){
        if(data.data[i]===fromRGB.r && data.data[i+1]===fromRGB.g && data.data[i+2]===fromRGB.b){
          data.data[i]=toRGB.r; data.data[i+1]=toRGB.g; data.data[i+2]=toRGB.b;
        }
      }
      ctx.putImageData(data,0,0);
      card.querySelector('#palette-hint').textContent="Palette swapped successfully.";
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(file);
}

function hexToRgb(hex){
  const bigint=parseInt(hex.replace('#',''),16);
  return {r:(bigint>>16)&255,g:(bigint>>8)&255,b:bigint&255};
}
</script>
