<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Most Useful Site in the World</title>
  <style>
    body {
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:linear-gradient(-45deg,#0b0f1a,#1a1f2b,#2a2f3b,#1a1f2b);
      background-size:400% 400%;
      animation:gradientShift 20s ease infinite;
      color:#e6faff;
    }
    @keyframes gradientShift {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }
    header{text-align:center;padding:40px;}
    .search-bar{max-width:640px;margin:0 auto;display:flex;
      background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);
      border-radius:12px;padding:12px 16px;}
    .search-bar input{flex:1;border:none;background:transparent;color:#e6faff;font-size:1rem;}
    main{max-width:1280px;margin:0 auto;padding:30px;}
    section{margin-bottom:60px;}
    .section-header{text-align:center;margin-bottom:30px;}
    .section-header h2{
      display:inline-block;
      background:rgba(255,255,255,0.06);
      padding:6px 14px;
      border-radius:10px;
      color:#2dd4ff;
      text-shadow:0 0 12px rgba(45,212,255,0.35);
    }
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:28px;}
    .card{
      background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.08));
      background-size:200% 200%;
      animation:cardGradientShift 12s ease infinite;
      border:1px solid rgba(255,255,255,0.12);
      border-radius:12px;
      padding:24px;
      backdrop-filter:blur(8px);
      opacity:0;
      transform:translateY(20px);
      transition:all 0.6s ease;
    }
    .card.visible{opacity:1;transform:translateY(0);}
    @keyframes cardGradientShift {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }
    .card h2,.card h3{
      background:rgba(45,212,255,0.08);
      padding:8px 12px;
      border-radius:8px;
      margin-top:0;
      margin-bottom:12px;
      color:#2dd4ff;
      text-shadow:0 0 8px rgba(45,212,255,0.35);
    }
    .small{font-size:0.9rem;color:rgba(230,250,255,0.9);}
    .actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
    .actions button{padding:8px 12px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:inherit;cursor:pointer;}
    .actions button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);}
    .tiny{font-size:0.8rem;padding:4px 8px;border-radius:6px;border:none;background:rgba(255,255,255,0.04);color:inherit;cursor:pointer;}
  </style>
</head>
<body>
  <header>
    <h1>The Most Useful Site in the World</h1>
    <div class="search-bar">
      <input id="searchInput" type="text" placeholder="Search calculators, tools, or topics..." aria-label="Search tools" />
    </div>
  </header>

  <main id="playground"></main>

  <script>
    const sections = {
      "Music": [
        "tuner.html","metronome.html","chord-finder.html","scale-trainer.html","ear-trainer.html",
        "practice-tracker.html","sheet-music.html","chord-progression.html","rhythm-generator.html","tempo-map.html",
        "music-theory.html","song-writer.html","bpm-counter.html","interval-trainer.html","transposer.html",
        "capo-calculator.html","instrument-care.html","recording-basics.html","mixing-basics.html","music-quiz.html"
      ]
      // ... other sections omitted for brevity, keep your full list here
    };

    const playground = document.getElementById("playground");

    function createCard(file, index) {
      const wrapper = document.createElement("article");
      wrapper.className = "card";
      wrapper.dataset.name = file.replace(".html", "");
      wrapper.innerHTML = `<p class="small">Loading ${file.replace(".html","")}...</p>`;

      const io = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            setTimeout(() => wrapper.classList.add("visible"), index * 60);
            fetch("cards/" + file)
              .then(res => res.ok ? res.text() : Promise.reject())
              .then(html => {
                wrapper.innerHTML = html || `<p class="small">Error loading ${file}</p>`;
                evaluateSearch(searchInput.value); // re-run search after content loads
              })
              .catch(() => {
                wrapper.innerHTML = `<p class="small">Error loading ${file}</p>`;
                evaluateSearch(searchInput.value);
              });
            io.unobserve(wrapper);
          }
        });
      }, { threshold: 0.1 });

      io.observe(wrapper);
      return wrapper;
    }

    Object.entries(sections).forEach(([sectionName, files]) => {
      const section = document.createElement("section");
      const headerDiv = document.createElement("div");
      headerDiv.className = "section-header";
      const heading = document.createElement("h2");
      heading.textContent = sectionName;
      headerDiv.appendChild(heading);
      section.appendChild(headerDiv);

      const grid = document.createElement("div");
      grid.className = "grid";
      files.forEach((file,i)=>grid.appendChild(createCard(file,i)));
      section.appendChild(grid);
      playground.appendChild(section);
    });

    function debounce(fn, wait) {
      let t=null;
      return function(...args){
        clearTimeout(t);
        t=setTimeout(()=>fn.apply(this,args),wait);
      };
    }

    function evaluateSearch(term) {
      const raw=(term||"").trim().toLowerCase();
      const words=raw.length?raw.split(/\s+/):[];
      document.querySelectorAll("#playground .card").forEach(card=>{
        const name=(card.dataset.name||"").toLowerCase();
        const text=(card.textContent||"").toLowerCase();
        if(!words.length){card.style.display="";return;}
        const matches=words.every(w=>name.includes(w)||text.includes(w));
        card.style.display=matches?"":"none";
      });
    }

    const searchInput=document.getElementById("searchInput");
    const debouncedEvaluate=debounce(evaluateSearch,180);
    searchInput.addEventListener("input",e=>debouncedEvaluate(e.target.value));

    searchInput.addEventListener("keydown",ev=>{
      if(ev.key==="Escape"){searchInput.value="";evaluateSearch("");}
    });

    window.addEventListener("load",()=>{
      searchInput.setAttribute("autocomplete","off");
      setTimeout(()=>{if(document.activeElement===document.body)searchInput.focus();},300);
      evaluateSearch("");
    });
  </script>
</body>
</html>
