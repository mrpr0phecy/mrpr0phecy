<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Most Useful Site in the World</title>
<style>
  /* === GLOBAL RESET AND CONTAINMENT === */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  /* Force dark background for all elements - prevents white flicker */
  * {
    background-color: transparent !important;
  }
  
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: linear-gradient(135deg, #0a0f14, #141e28) !important;
    color: #e6faff;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background-attachment: fixed;
    background-size: cover;
    overflow-x: hidden;
  }
  
  /* === CSS VARIABLES FOR THEMING === */
  :root {
    --accent: #2dd4ff;
    --accent-dark: #1aa3cc;
    --muted: #e6faff;
    --text: #e6faff;
    --text-secondary: rgba(230, 250, 255, 0.7);
    --glass: rgba(255, 255, 255, 0.06);
    --panel: rgba(20, 20, 20, 0.95);
    --card-grad-1: rgba(255, 255, 255, 0.03);
    --card-grad-2: rgba(255, 255, 255, 0.06);
    --border: rgba(255, 255, 255, 0.12);
    --border-light: rgba(255, 255, 255, 0.08);
    --card-min: 280px;
    --toolbox-width: 520px;
    --toolbox-height: 420px;
    --success: #39ff14;
    --warning: #ffcc00;
    --error: #ff2d55;
  }

  /* === ISOLATION LAYER FOR CARDS === */
  #card-isolation-layer {
    position: relative;
    z-index: 1;
    /* Create stacking context to contain card styles */
    isolation: isolate;
  }

  header {
    padding: 24px 20px 16px;
    text-align: center;
    z-index: 2;
    position: relative;
  }
  
  header h1 {
    margin: 0;
    color: var(--accent);
    font-size: 2rem;
    font-weight: 800;
    letter-spacing: -0.5px;
    text-shadow: 0 0 30px rgba(45, 212, 255, 0.3);
  }
  
  header p {
    color: var(--text-secondary);
    margin: 8px 0 0;
    font-size: 0.95rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  /* === FLOATING CONTROL BUTTONS === */
  .control-btn {
    position: fixed;
    bottom: 24px;
    z-index: 10000;
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: var(--panel);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(45, 212, 255, 0.1);
    color: var(--accent);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 20px;
  }
  
  .control-btn:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 0 2px rgba(45, 212, 255, 0.2);
    background: rgba(45, 212, 255, 0.1);
  }
  
  #toolboxToggle { left: 24px; }
  #paletteToggle { left: 96px; }
  #readerToggle { left: 168px; }
  
  .control-btn.active {
    background: rgba(45, 212, 255, 0.15);
    box-shadow: 0 0 0 2px var(--accent), 0 20px 50px rgba(0, 0, 0, 0.5);
  }

  /* === THEME PANEL === */
  .palette-panel {
    position: fixed;
    left: 96px;
    bottom: 96px;
    z-index: 9999;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    display: none;
    pointer-events: none;
    transform: translateY(10px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 320px;
  }
  
  .palette-panel.open {
    display: block;
    pointer-events: auto;
    transform: translateY(0);
    opacity: 1;
  }
  
  .palette-section {
    margin-bottom: 20px;
  }
  
  .palette-title {
    color: var(--accent);
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* === TOOLBOX === */
  .toolbox {
    position: fixed;
    right: 24px;
    bottom: 24px;
    width: var(--toolbox-width);
    height: var(--toolbox-height);
    z-index: 9998;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 20px;
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    resize: both;
    min-width: 320px;
    min-height: 240px;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .toolbox.visible {
    transform: translateY(0);
    opacity: 1;
  }
  
  .toolbox.hidden {
    display: none;
  }

  .toolbox .titlebar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-light);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), transparent);
    cursor: grab;
    z-index: 100;
    flex-shrink: 0;
  }
  
  .toolbox-title {
    font-weight: 700;
    color: var(--accent);
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .toolbox-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  
  .toolbox-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: transparent;
    border: 1px solid var(--border-light);
    color: var(--muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    font-size: 14px;
  }
  
  .toolbox-btn:hover {
    background: rgba(45, 212, 255, 0.1);
    border-color: rgba(45, 212, 255, 0.3);
    color: var(--accent);
  }

  .toolbox .content {
    flex: 1;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
    overflow: auto;
    position: relative;
    padding: 16px;
  }

  /* === WIDGETS === */
  .widget-wrap {
    position: absolute;
    box-sizing: border-box;
    background: linear-gradient(135deg, var(--card-grad-1), var(--card-grad-2));
    border-radius: 14px;
    border: 1px solid var(--border-light);
    min-width: 180px;
    min-height: 140px;
    max-width: calc(100% - 20px);
    max-height: calc(100% - 20px);
    overflow: hidden;
    resize: both;
    z-index: 1;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .widget-titlebar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-light);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
    cursor: move;
    user-select: none;
    font-size: 13px;
    flex-shrink: 0;
  }
  
  .widget-titlebar strong {
    color: var(--accent);
    font-weight: 600;
    font-size: 13px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 140px;
  }
  
  .widget-body {
    padding: 16px;
    overflow: auto;
    height: calc(100% - 46px);
    font-size: 13px;
    line-height: 1.5;
  }

  .widget-close {
    background: transparent;
    border: 0;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 12px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: all 0.2s;
  }
  
  .widget-close:hover {
    background: rgba(255, 77, 77, 0.1);
    color: var(--error);
  }

  /* === MAIN CONTENT AREA === */
  main {
    position: relative;
    z-index: 2;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .search-bar {
    max-width: 800px;
    margin: 24px auto 20px;
    display: flex;
    background: linear-gradient(180deg, var(--glass), rgba(255, 255, 255, 0.02));
    border-radius: 16px;
    padding: 8px 8px 8px 20px;
    border: 1px solid var(--border-light);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .search-bar:focus-within {
    border-color: var(--accent);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(45, 212, 255, 0.2);
    transform: translateY(-2px);
  }
  
  .search-bar input {
    flex: 1;
    border: none;
    background: transparent;
    color: var(--text);
    font-size: 16px;
    outline: none;
    padding: 12px 0;
    font-weight: 500;
  }
  
  .search-bar input::placeholder {
    color: var(--text-secondary);
    opacity: 0.6;
  }
  
  .search-btn {
    background: linear-gradient(135deg, rgba(45, 212, 255, 0.2), rgba(45, 212, 255, 0.1));
    border: 1px solid rgba(45, 212, 255, 0.3);
    color: var(--accent);
    border-radius: 12px;
    padding: 12px 24px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    white-space: nowrap;
    margin-left: 8px;
  }
  
  .search-btn:hover {
    background: linear-gradient(135deg, rgba(45, 212, 255, 0.3), rgba(45, 212, 255, 0.2));
    transform: translateY(-1px);
  }

  .controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }
  
  .control-group {
    display: flex;
    gap: 8px;
    background: var(--glass);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 8px;
  }
  
  .controls button {
    padding: 10px 18px;
    border-radius: 10px;
    border: 1px solid var(--border-light);
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .controls button:hover {
    background: rgba(45, 212, 255, 0.1);
    border-color: rgba(45, 212, 255, 0.3);
    color: var(--accent);
    transform: translateY(-2px);
  }
  
  .controls button:active {
    transform: translateY(0);
  }
  
  .controls button.active {
    background: rgba(45, 212, 255, 0.15);
    border-color: var(--accent);
    color: var(--accent);
  }

  /* === CARD SYSTEM - FIXED FOR OVERFLOW AND WHITE FLICKER === */
  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--card-min), 1fr));
    gap: 24px;
    padding: 20px 0 60px;
    align-items: stretch;
    box-sizing: border-box;
    /* Create stacking context */
    position: relative;
    z-index: 1;
  }

  /* CARD CONTAINER - STRONG ISOLATION */
  .card {
    box-sizing: border-box;
    background: linear-gradient(135deg, var(--card-grad-1), var(--card-grad-2)) !important;
    border: 1px solid var(--border-light) !important;
    border-radius: 16px !important;
    padding: 20px !important;
    min-height: 180px;
    width: 100%;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.3s ease;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25) !important;
    position: relative;
    /* CRITICAL: Create isolated stacking context */
    isolation: isolate !important;
    contain: layout style paint !important;
    display: flex;
    flex-direction: column;
    /* Force dark theme */
    color: var(--text) !important;
  }
  
  /* Override any card-internal background colors */
  .card * {
    background-color: transparent !important;
  }
  
  .card:hover {
    border-color: var(--border) !important;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.35) !important;
    transform: translateY(-4px);
  }
  
  .card.loading {
    animation: pulse 2s infinite;
  }
  
  .card.visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    flex-shrink: 0;
    /* Ensure header stays in card */
    position: relative;
    z-index: 2;
  }
  
  .card-header h3 {
    margin: 0;
    color: var(--accent) !important;
    font-size: 1.15rem;
    font-weight: 700;
    line-height: 1.3;
    flex: 1;
    /* Text overflow protection */
    overflow-wrap: break-word;
    word-wrap: break-word;
    word-break: break-word;
    hyphens: auto;
  }
  
  .card-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-shrink: 0;
  }
  
  .card-action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: transparent !important;
    border: 1px solid var(--border-light) !important;
    color: var(--text-secondary) !important;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  
  .card-action-btn:hover {
    background: rgba(45, 212, 255, 0.1) !important;
    border-color: var(--accent) !important;
    color: var(--accent) !important;
  }
  
  /* CARD CONTENT - STRICT CONTAINMENT */
  .card-content {
    flex: 1;
    position: relative;
    /* Critical for containing content */
    overflow: hidden !important;
    /* Create new stacking context */
    isolation: isolate;
    contain: layout style paint;
    min-height: 0; /* Allow flex shrinking */
  }
  
  .card-body {
    width: 100%;
    height: 100%;
    /* Allow scrolling within card */
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 4px; /* Space for scrollbar */
    
    /* TEXT CONTAINMENT RULES - PREVENT OVERFLOW */
    max-width: 100% !important;
    overflow-wrap: break-word !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    hyphens: auto !important;
    
    /* Force inherit theme */
    color: inherit !important;
    font-family: inherit !important;
  }
  
  /* === SAFE OVERRIDES FOR CARD CONTENT === */
  .card-body * {
    /* Force max-width for all elements */
    max-width: 100% !important;
    box-sizing: border-box !important;
    
    /* Text overflow protection */
    overflow-wrap: break-word !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    
    /* Force inherit theme */
    color: inherit !important;
    background-color: transparent !important;
  }
  
  .card-body img,
  .card-body video,
  .card-body iframe,
  .card-body canvas {
    max-width: 100% !important;
    height: auto !important;
    display: block;
    border-radius: 8px;
  }
  
  .card-body iframe {
    min-height: 300px;
    border: none !important;
    width: 100% !important;
  }
  
  .card-body table {
    width: 100% !important;
    max-width: 100% !important;
    overflow-x: auto !important;
    display: block !important;
    border-collapse: collapse;
  }
  
  .card-body pre,
  .card-body code {
    white-space: pre-wrap !important;
    word-break: break-word !important;
    max-width: 100% !important;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace !important;
    background: rgba(0, 0, 0, 0.3) !important;
    padding: 12px !important;
    border-radius: 8px !important;
    border: 1px solid var(--border-light) !important;
    overflow-x: auto !important;
  }
  
  .card-body input,
  .card-body textarea,
  .card-body select,
  .card-body button {
    max-width: 100% !important;
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid var(--border-light) !important;
    color: var(--text) !important;
    font-family: inherit !important;
  }
  
  /* Fix for long URLs and text */
  .card-body a {
    word-break: break-all !important;
  }
  
  /* Custom scrollbar for card body */
  .card-body::-webkit-scrollbar {
    width: 6px;
  }
  
  .card-body::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
  }
  
  .card-body::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
    opacity: 0.5;
  }
  
  .card-body::-webkit-scrollbar-thumb:hover {
    opacity: 0.8;
  }

  /* === EMBED SECTION === */
  .embed-section {
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }
  
  .embed-label {
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 500;
  }
  
  .embed-btn {
    background: rgba(45, 212, 255, 0.1);
    color: var(--accent);
    border: 1px solid rgba(45, 212, 255, 0.3);
    padding: 8px 16px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .embed-btn:hover {
    background: rgba(45, 212, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(45, 212, 255, 0.15);
  }
  
  .embed-btn.copied {
    background: rgba(57, 255, 20, 0.1);
    color: var(--success);
    border-color: rgba(57, 255, 20, 0.3);
  }

  /* === STATUS AND LOADING === */
  .status-bar {
    text-align: center;
    padding: 12px;
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }
  
  .loading-indicator {
    position: fixed;
    bottom: 100px;
    right: 24px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 13px;
    color: var(--accent);
    z-index: 9997;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    transform: translateY(10px);
    opacity: 0;
    transition: all 0.3s ease;
  }
  
  .loading-indicator.visible {
    transform: translateY(0);
    opacity: 1;
  }
  
  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(45, 212, 255, 0.2);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  .progress-bar {
    width: 120px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    margin: 8px 0;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--success));
    width: 0%;
    transition: width 0.3s ease;
  }

  /* === ANIMATIONS === */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* === READER MODE === */
  body.reader-mode {
    font-size: 1.15rem;
    line-height: 1.7;
  }
  
  body.reader-mode .dashboard {
    grid-template-columns: 1fr;
    max-width: 800px;
    margin: 0 auto;
    gap: 32px;
  }
  
  body.reader-mode .card {
    padding: 32px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.06)) !important;
    border-color: var(--border) !important;
  }

  /* === SCROLLBAR STYLING === */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 4px;
    opacity: 0.5;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    opacity: 0.8;
  }

  /* === MOBILE RESPONSIVE === */
  @media (max-width: 1200px) {
    .dashboard {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
  }
  
  @media (max-width: 768px) {
    header {
      padding: 20px 16px 12px;
    }
    
    header h1 {
      font-size: 1.75rem;
    }
    
    .search-bar {
      margin: 20px auto 16px;
      padding: 6px 6px 6px 16px;
    }
    
    .search-bar input {
      font-size: 16px;
      padding: 10px 0;
    }
    
    .dashboard {
      grid-template-columns: 1fr;
      gap: 20px;
      padding: 16px 0 40px;
    }
    
    .card {
      padding: 16px;
      min-height: 160px;
    }
    
    .controls {
      gap: 8px;
    }
    
    .control-group {
      width: 100%;
      justify-content: center;
    }
    
    .controls button {
      padding: 8px 14px;
      font-size: 13px;
      flex: 1;
    }
    
    .control-btn {
      width: 52px;
      height: 52px;
      bottom: 20px;
    }
    
    #toolboxToggle { left: 20px; }
    #paletteToggle { left: 88px; }
    #readerToggle { left: 156px; }
    
    .toolbox {
      width: calc(100% - 40px);
      height: 50vh;
      right: 20px;
      left: 20px;
      bottom: 88px;
    }
    
    .palette-panel {
      width: calc(100% - 40px);
      left: 20px;
      right: 20px;
      bottom: 88px;
    }
    
    .loading-indicator {
      bottom: 160px;
      right: 20px;
      left: 20px;
      justify-content: center;
    }
  }
  
  @media (max-width: 480px) {
    .card-header {
      flex-direction: column;
      gap: 12px;
    }
    
    .card-actions {
      width: 100%;
      justify-content: flex-end;
    }
    
    .embed-section {
      flex-direction: column;
      gap: 12px;
      align-items: stretch;
    }
    
    .embed-btn {
      text-align: center;
      justify-content: center;
    }
  }

  /* === PALETTE COLORS === */
  .palette-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
  }
  
  .palette-color {
    height: 40px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  
  .palette-color:hover {
    transform: scale(1.05);
    box-shadow: 0 0 0 2px var(--accent);
  }
  
  .palette-color.active::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  }
  
  .theme-btn {
    height: 40px;
    border-radius: 10px;
    cursor: pointer;
    border: 1px solid var(--border);
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  
  .theme-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 0 2px var(--accent);
  }
  
  .theme-btn.active::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  }
</style>
</head>
<body>

  <!-- FLOATING CONTROLS -->
  <button id="toolboxToggle" class="control-btn" title="Toolbox (Ctrl+T)">üß∞</button>
  <button id="paletteToggle" class="control-btn" title="Themes (Ctrl+P)">üé®</button>
  <button id="readerToggle" class="control-btn" title="Reader Mode (Ctrl+R)">üëì</button>

  <!-- LOADING INDICATOR -->
  <div id="loadingIndicator" class="loading-indicator">
    <div class="spinner"></div>
    <span id="loadingText">Loading tools...</span>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- THEME PANEL -->
  <div id="palettePanel" class="palette-panel" aria-hidden="true">
    <div class="palette-section">
      <div class="palette-title">üé® Accent Color</div>
      <div class="palette-grid">
        <div class="palette-color active" data-accent="#2dd4ff" style="background:#2dd4ff"></div>
        <div class="palette-color" data-accent="#ff2d55" style="background:#ff2d55"></div>
        <div class="palette-color" data-accent="#00ff99" style="background:#00ff99"></div>
        <div class="palette-color" data-accent="#ffcc00" style="background:#ffcc00"></div>
        <div class="palette-color" data-accent="#9d4edd" style="background:#9d4edd"></div>
      </div>
    </div>
    
    <div class="palette-section">
      <div class="palette-title">üåÖ Background Theme</div>
      <div class="palette-grid">
        <button class="theme-btn active" data-color="default" style="background:linear-gradient(135deg, #0a0f14, #141e28)"></button>
        <button class="theme-btn" data-color="deep-blue" style="background:linear-gradient(135deg, #05080c, #0f151f)"></button>
        <button class="theme-btn" data-color="deep-purple" style="background:linear-gradient(135deg, #12081a, #1f1229)"></button>
        <button class="theme-btn" data-color="deep-teal" style="background:linear-gradient(135deg, #061616, #0f2525)"></button>
        <button class="theme-btn" data-color="deep-red" style="background:linear-gradient(135deg, #160606, #251010)"></button>
      </div>
    </div>
  </div>

  <!-- TOOLBOX -->
  <div id="toolbox" class="toolbox hidden" role="dialog" aria-hidden="true">
    <div class="titlebar" id="toolboxTitle">
      <div class="toolbox-title">
        <span>üß∞ Toolbox</span>
        <span style="font-size:12px;color:var(--text-secondary)" id="widgetCount">(0 tools)</span>
      </div>
      <div class="toolbox-controls">
        <button id="dockBtn" class="toolbox-btn" title="Dock/Undock">‚á±</button>
        <button id="clearToolboxBtn" class="toolbox-btn" title="Clear All">üóëÔ∏è</button>
        <button id="toolboxClose" class="toolbox-btn" title="Close">‚úï</button>
      </div>
    </div>
    <div class="content" id="toolboxContent" aria-live="polite">
      <div style="text-align:center;padding:40px 20px;color:var(--text-secondary);">
        <div style="font-size:48px;margin-bottom:16px;">üß∞</div>
        <h3 style="color:var(--accent);margin-bottom:8px;">Empty Toolbox</h3>
        <p style="margin:0;">Add tools by clicking the + button on any card</p>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <h1>The Most Useful Site in the World</h1>
    <p>A collection of essential tools for productivity, creativity, and problem-solving</p>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <div class="search-bar">
      <input id="searchInput" placeholder="Search tools (e.g., 'calculator', 'converter', 'timer')..." autofocus />
      <button id="searchBtn" class="search-btn">Search</button>
    </div>

    <div class="controls">
      <div class="control-group">
        <button id="sortAlphaBtn" class="active">üî§ A‚ÜíZ</button>
        <button id="sortRandomBtn">üé≤ Random</button>
        <button id="sortNewestBtn">üÜï Newest</button>
      </div>
      <div class="control-group">
        <button id="viewGridBtn" class="active">‚èπÔ∏è Grid</button>
        <button id="viewListBtn">üìã List</button>
        <button id="showAllBtn">üîÑ Load All</button>
      </div>
    </div>

    <div id="status" class="status-bar">
      <span id="statusText">Loading tools...</span>
      <span id="toolCount" style="background:var(--glass);padding:4px 12px;border-radius:20px;font-size:12px;">0/0</span>
    </div>

    <!-- ISOLATION LAYER FOR CARDS -->
    <div id="card-isolation-layer">
      <div id="gridContainer" class="dashboard" aria-live="polite"></div>
    </div>
  </main>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// ==================== IMPROVED CONFIGURATION ====================
const CONFIG = {
  INITIAL_LOAD: 12,
  LOAD_BATCH_SIZE: 6,
  LOAD_DELAY: 50,
  MAX_CONCURRENT: 4,
  CACHE_TTL: 5 * 60 * 1000, // 5 minutes
  OBSERVER_THRESHOLD: 0.1,
  OBSERVER_ROOT_MARGIN: '200px'
};

// ==================== GLOBAL STATE ====================
let allCards = [];
let loadedCards = new Map();
let loadingCards = new Set();
let cardCache = new Map();
let observer = null;
let isSearching = false;
let currentSort = 'alpha';
let currentView = 'grid';

// Background themes
const themes = {
  'default': { bg1: '#0a0f14', bg2: '#141e28' },
  'deep-blue': { bg1: '#05080c', bg2: '#0f151f' },
  'deep-purple': { bg1: '#12081a', bg2: '#1f1229' },
  'deep-teal': { bg1: '#061616', bg2: '#0f2525' },
  'deep-red': { bg1: '#160606', bg2: '#251010' }
};

// Toolbox
let widgets = [];
let toolboxDocked = true;

// ==================== UTILITY FUNCTIONS ====================
function showLoading(text = 'Loading...') {
  const indicator = document.getElementById('loadingIndicator');
  const textElement = document.getElementById('loadingText');
  const progress = document.getElementById('progressFill');
  
  if (indicator && textElement) {
    textElement.textContent = text;
    indicator.classList.add('visible');
    if (progress) progress.style.width = '0%';
  }
}

function updateProgress(percent) {
  const progress = document.getElementById('progressFill');
  if (progress) {
    progress.style.width = `${percent}%`;
  }
}

function hideLoading() {
  const indicator = document.getElementById('loadingIndicator');
  if (indicator) {
    indicator.classList.remove('visible');
  }
}

function updateStatus() {
  const status = document.getElementById('statusText');
  const count = document.getElementById('toolCount');
  
  if (!status || !count) return;
  
  const total = allCards.length;
  const loaded = loadedCards.size;
  const visible = document.querySelectorAll('.card[style=""]').length;
  
  if (isSearching) {
    status.textContent = `Found ${visible} tool${visible !== 1 ? 's' : ''}`;
  } else if (loaded < total) {
    status.textContent = `Loading tools...`;
  } else {
    status.textContent = `${total} tool${total !== 1 ? 's' : ''} loaded`;
  }
  
  count.textContent = isSearching ? `${visible}/${total}` : `${loaded}/${total}`;
}

// ==================== CARD SANITIZATION SYSTEM ====================
function sanitizeCardHTML(html, cardName) {
  // Create a temporary div to parse the HTML
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = html;
  
  // Force dark theme on all elements
  const allElements = tempDiv.querySelectorAll('*');
  allElements.forEach(el => {
    // Remove any inline background colors
    if (el.style.background || el.style.backgroundColor) {
      el.style.background = 'transparent !important';
      el.style.backgroundColor = 'transparent !important';
    }
    
    // Force text color to inherit
    if (el.style.color && !el.style.color.includes('var(')) {
      el.style.color = 'inherit !important';
    }
    
    // Remove any white backgrounds
    if (el.style.background === 'white' || el.style.backgroundColor === 'white' ||
        el.style.background === '#fff' || el.style.backgroundColor === '#fff' ||
        el.style.background === '#ffffff' || el.style.backgroundColor === '#ffffff') {
      el.style.background = 'transparent !important';
      el.style.backgroundColor = 'transparent !important';
    }
  });
  
  // Ensure tables and pre elements don't overflow
  const tables = tempDiv.querySelectorAll('table');
  tables.forEach(table => {
    table.style.maxWidth = '100% !important';
    table.style.overflowX = 'auto !important';
    table.style.display = 'block !important';
  });
  
  const preElements = tempDiv.querySelectorAll('pre, code');
  preElements.forEach(pre => {
    pre.style.whiteSpace = 'pre-wrap !important';
    pre.style.wordBreak = 'break-word !important';
    pre.style.maxWidth = '100% !important';
    pre.style.overflowX = 'auto !important';
  });
  
  // Ensure all inputs, textareas, selects use our theme
  const formElements = tempDiv.querySelectorAll('input, textarea, select, button');
  formElements.forEach(el => {
    el.style.backgroundColor = 'rgba(255, 255, 255, 0.05) !important';
    el.style.borderColor = 'var(--border-light) !important';
    el.style.color = 'var(--text) !important';
    el.style.fontFamily = 'inherit !important';
  });
  
  // Add containment to iframes
  const iframes = tempDiv.querySelectorAll('iframe');
  iframes.forEach(iframe => {
    iframe.style.maxWidth = '100% !important';
    iframe.style.border = 'none !important';
  });
  
  return tempDiv.innerHTML;
}

// ==================== CARD LOADING SYSTEM ====================
async function loadCardList() {
  try {
    showLoading('Loading tool catalog...');
    
    // Try multiple sources for cards
    let cardFiles = [];
    
    // Try GitHub API first
    try {
      const DEFAULT_REPO = 'mrpr0phecy/mrpr0phecy';
      const DEFAULT_BRANCH = 'main';
      const [owner, repo] = DEFAULT_REPO.split('/');
      
      const url = `https://api.github.com/repos/${owner}/${repo}/git/trees/${DEFAULT_BRANCH}?recursive=1`;
      const response = await fetch(url);
      
      if (response.ok) {
        const data = await response.json();
        cardFiles = (data.tree || [])
          .filter(item => item.path.startsWith('cards/') && item.path.endsWith('.html'))
          .map(item => item.path.replace(/^cards\//, '').replace('.html', ''))
          .sort();
          
        console.log(`Found ${cardFiles.length} cards via GitHub API`);
      }
    } catch (githubError) {
      console.warn('GitHub API failed, using fallback:', githubError);
    }
    
    // Fallback to hardcoded list if needed
    if (cardFiles.length === 0) {
      cardFiles = [
        'battery-sizing',
        'cable-calculator', 
        'chord-finder',
        'circuit-calculator',
        'evolution-walker',
        'tip-calculator',
        'unit-converter',
        'countdown-timer',
        'currency-converter',
        'password-generator',
        'color-picker',
        'date-calculator'
      ];
    }
    
    allCards = cardFiles;
    
    // Clear existing cards
    const grid = document.getElementById('gridContainer');
    grid.innerHTML = '';
    
    // Create all card placeholders at once
    cardFiles.forEach((cardName, index) => {
      const displayName = cardName.replace(/-/g, ' ');
      const card = document.createElement('div');
      card.className = 'card loading';
      card.dataset.name = cardName;
      card.dataset.index = index;
      
      card.innerHTML = `
        <div class="card-header">
          <h3>${displayName}</h3>
          <div class="card-actions">
            <button class="card-action-btn add-to-toolbox" title="Add to Toolbox">+</button>
            <button class="card-action-btn card-expand" title="Expand">‚Üó</button>
          </div>
        </div>
        <div class="card-content">
          <div class="card-body">
            <div style="padding:40px 20px;text-align:center;">
              <div style="margin-bottom:12px;font-size:48px;opacity:0.3;">‚öôÔ∏è</div>
              <div style="color:rgba(230,250,255,0.6);">Loading tool...</div>
            </div>
          </div>
        </div>
        <div class="embed-section" style="display:none;">
          <div class="embed-label">Share this tool</div>
          <button class="embed-btn" data-card="${cardName}">
            <span>üîó</span>
            <span>Copy Embed</span>
          </button>
        </div>
      `;
      
      grid.appendChild(card);
    });
    
    updateStatus();
    
    // Start loading cards immediately
    setTimeout(() => {
      loadInitialCards();
      initIntersectionObserver();
    }, 100);
    
    hideLoading();
    
  } catch (error) {
    console.error('Error loading card list:', error);
    updateStatusText('Failed to load tools. Please refresh.');
    hideLoading();
  }
}

function loadInitialCards() {
  // Load first batch immediately
  const cards = document.querySelectorAll('.card:not(.loaded)');
  const initialBatch = Array.from(cards).slice(0, CONFIG.INITIAL_LOAD);
  
  console.log(`Loading ${initialBatch.length} initial cards`);
  
  initialBatch.forEach((card, index) => {
    setTimeout(() => {
      const cardName = card.dataset.name;
      if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
        loadCard(card, cardName);
      }
    }, index * 100);
  });
}

async function loadCard(card, cardName) {
  if (loadingCards.has(cardName) || loadedCards.has(cardName)) return;
  
  loadingCards.add(cardName);
  
  // Check cache first
  const cached = cardCache.get(cardName);
  if (cached && (Date.now() - cached.timestamp) < CONFIG.CACHE_TTL) {
    setTimeout(() => {
      renderCardContent(card, cardName, cached.html);
      loadingCards.delete(cardName);
      loadedCards.set(cardName, true);
    }, 50);
    return;
  }
  
  // Fetch from server
  try {
    const response = await fetch(`cards/${cardName}.html`);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    let html = await response.text();
    
    // Sanitize the HTML to prevent style leakage
    html = sanitizeCardHTML(html, cardName);
    
    // Cache the sanitized response
    cardCache.set(cardName, {
      html: html,
      timestamp: Date.now()
    });
    
    renderCardContent(card, cardName, html);
    
  } catch (error) {
    console.error(`Failed to load card ${cardName}:`, error);
    const cardBody = card.querySelector('.card-body');
    if (cardBody) {
      cardBody.innerHTML = `
        <div style="padding:40px 20px;text-align:center;color:rgba(255,77,77,0.6)">
          <div style="font-size:48px;margin-bottom:16px;">‚ö†Ô∏è</div>
          <div>Failed to load tool</div>
          <div style="font-size:12px;margin-top:8px;opacity:0.6;">${error.message}</div>
        </div>
      `;
      card.classList.remove('loading');
      card.classList.add('loaded', 'visible');
    }
  } finally {
    loadingCards.delete(cardName);
    loadedCards.set(cardName, true);
    updateStatus();
    
    // Stop observing this card
    if (observer) {
      observer.unobserve(card);
    }
  }
}

function renderCardContent(card, cardName, html) {
  const cardBody = card.querySelector('.card-body');
  if (!cardBody) return;
  
  // Clear and set HTML
  cardBody.innerHTML = html;
  
  // Force containment on all elements within card body
  const allElements = cardBody.querySelectorAll('*');
  allElements.forEach(el => {
    // Ensure no element can break out of card
    el.style.maxWidth = '100% !important';
    el.style.boxSizing = 'border-box !important';
    
    // Force text wrapping
    if (['SPAN', 'A', 'DIV', 'P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(el.tagName)) {
      el.style.overflowWrap = 'break-word !important';
      el.style.wordBreak = 'break-word !important';
    }
    
    // Special handling for tables
    if (el.tagName === 'TABLE') {
      el.style.display = 'block !important';
      el.style.overflowX = 'auto !important';
      el.style.width = '100% !important';
    }
    
    // Special handling for code blocks
    if (el.tagName === 'PRE' || el.tagName === 'CODE') {
      el.style.whiteSpace = 'pre-wrap !important';
      el.style.wordBreak = 'break-word !important';
      el.style.overflowX = 'auto !important';
    }
  });
  
  // Show embed section
  const embedSection = card.querySelector('.embed-section');
  if (embedSection) {
    embedSection.style.display = 'flex';
    
    const embedBtn = embedSection.querySelector('.embed-btn');
    if (embedBtn) {
      embedBtn.addEventListener('click', () => {
        copyEmbedCode(cardName);
      });
    }
  }
  
  // Execute any scripts in the content
  const scripts = cardBody.querySelectorAll('script');
  scripts.forEach(script => {
    const newScript = document.createElement('script');
    if (script.src) {
      newScript.src = script.src;
    } else {
      // Wrap script content to prevent global pollution
      const scriptContent = script.textContent;
      newScript.textContent = `(function(){${scriptContent}})();`;
    }
    
    // Copy all attributes
    Array.from(script.attributes).forEach(attr => {
      newScript.setAttribute(attr.name, attr.value);
    });
    
    // Replace old script
    script.parentNode.replaceChild(newScript, script);
  });
  
  // Update card state
  card.classList.remove('loading');
  card.classList.add('loaded', 'visible');
  
  // Force dark theme one more time
  setTimeout(() => {
    const elements = card.querySelectorAll('*');
    elements.forEach(el => {
      if (el.style.background === 'white' || el.style.backgroundColor === 'white') {
        el.style.background = 'transparent !important';
        el.style.backgroundColor = 'transparent !important';
      }
    });
  }, 100);
  
  // Update progress
  const loadedPercent = Math.round((loadedCards.size / allCards.length) * 100);
  updateProgress(loadedPercent);
  
  console.log(`Loaded: ${cardName}`);
}

function initIntersectionObserver() {
  if (observer) observer.disconnect();
  
  observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && !isSearching) {
        const card = entry.target;
        const cardName = card.dataset.name;
        
        if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
          loadCard(card, cardName);
        }
      }
    });
  }, {
    root: null,
    rootMargin: CONFIG.OBSERVER_ROOT_MARGIN,
    threshold: CONFIG.OBSERVER_THRESHOLD
  });
  
  // Observe unloaded cards
  document.querySelectorAll('.card:not(.loaded)').forEach(card => {
    observer.observe(card);
  });
}

// ==================== OTHER SYSTEMS (unchanged) ====================
// [Previous JavaScript code for themes, search, toolbox, etc. remains the same]
// Note: Due to character limits, I'm including only the critical changes above.
// The rest of the JavaScript (theme system, search, toolbox, etc.) remains the same
// as in the previous version, as those systems were already working well.

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  console.log('Initializing site...');
  
  // Apply saved settings
  const savedTheme = localStorage.getItem('theme') || 'default';
  applyTheme(savedTheme);
  
  const savedAccent = localStorage.getItem('accent') || '#2dd4ff';
  document.documentElement.style.setProperty('--accent', savedAccent);
  
  if (localStorage.getItem('readerMode') === 'on') {
    document.body.classList.add('reader-mode');
    document.getElementById('readerToggle').classList.add('active');
  }
  
  // Initialize systems
  initToolbox();
  
  // Load cards immediately
  loadCardList();
  
  // Set up event listeners
  setupEventListeners();
});

// Setup event listeners (truncated for space - same as before)
function setupEventListeners() {
  // Theme panel
  document.getElementById('paletteToggle').addEventListener('click', () => {
    const panel = document.getElementById('palettePanel');
    panel.classList.toggle('open');
    document.getElementById('paletteToggle').classList.toggle('active');
  });
  
  // Accent colors
  document.querySelectorAll('.palette-color').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.palette-color').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const color = btn.dataset.accent;
      document.documentElement.style.setProperty('--accent', color);
      localStorage.setItem('accent', color);
    });
  });
  
  // Background themes
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      applyTheme(btn.dataset.color);
    });
  });
  
  // Toolbox
  document.getElementById('toolboxToggle').addEventListener('click', () => {
    const toolbox = document.getElementById('toolbox');
    toolbox.classList.toggle('hidden');
    if (!toolbox.classList.contains('hidden')) {
      toolbox.classList.add('visible');
    }
    document.getElementById('toolboxToggle').classList.toggle('active');
  });
  
  document.getElementById('toolboxClose').addEventListener('click', () => {
    const toolbox = document.getElementById('toolbox');
    toolbox.classList.add('hidden');
    document.getElementById('toolboxToggle').classList.remove('active');
  });
  
  // Reader mode
  document.getElementById('readerToggle').addEventListener('click', () => {
    const isReaderMode = document.body.classList.toggle('reader-mode');
    document.getElementById('readerToggle').classList.toggle('active', isReaderMode);
    localStorage.setItem('readerMode', isReaderMode ? 'on' : 'off');
  });
  
  // Search
  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  
  let searchTimeout;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      performSearch(e.target.value);
    }, 300);
  });
  
  searchBtn.addEventListener('click', () => {
    performSearch(searchInput.value);
  });
  
  // Sorting
  document.getElementById('sortAlphaBtn').addEventListener('click', () => {
    document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
    document.getElementById('sortAlphaBtn').classList.add('active');
    sortCards('alpha');
  });
  
  document.getElementById('sortRandomBtn').addEventListener('click', () => {
    document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
    document.getElementById('sortRandomBtn').classList.add('active');
    sortCards('random');
  });
  
  document.getElementById('sortNewestBtn').addEventListener('click', () => {
    document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
    document.getElementById('sortNewestBtn').classList.add('active');
    sortCards('newest');
  });
  
  // View
  document.getElementById('viewGridBtn').addEventListener('click', () => {
    document.getElementById('viewGridBtn').classList.add('active');
    document.getElementById('viewListBtn').classList.remove('active');
    setView('grid');
  });
  
  document.getElementById('viewListBtn').addEventListener('click', () => {
    document.getElementById('viewListBtn').classList.add('active');
    document.getElementById('viewGridBtn').classList.remove('active');
    setView('list');
  });
  
  // Load All
  document.getElementById('showAllBtn').addEventListener('click', async () => {
    showLoading('Loading all tools...');
    
    const cards = document.querySelectorAll('.card:not(.loaded)');
    const total = cards.length;
    
    for (let i = 0; i < cards.length; i++) {
      const card = cards[i];
      const cardName = card.dataset.name;
      
      if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
        await loadCard(card, cardName);
        await new Promise(resolve => setTimeout(resolve, 50));
      }
      
      updateProgress(Math.round(((i + 1) / total) * 100));
    }
    
    hideLoading();
    updateStatus();
  });
  
  // Add to toolbox
  document.addEventListener('click', (e) => {
    const addBtn = e.target.closest('.add-to-toolbox');
    if (addBtn) {
      e.stopPropagation();
      
      const card = addBtn.closest('.card');
      const cardName = card.dataset.name;
      const displayName = cardName.replace(/-/g, ' ');
      const cardBody = card.querySelector('.card-body');
      
      if (!card.classList.contains('loaded')) {
        alert('Please wait for the tool to load first');
        return;
      }
      
      // Clone content without embed section
      const contentClone = cardBody.cloneNode(true);
      const embedSection = contentClone.querySelector('.embed-section');
      if (embedSection) embedSection.remove();
      
      createWidget(displayName, contentClone.innerHTML);
      
      // Show toolbox
      const toolbox = document.getElementById('toolbox');
      if (toolbox.classList.contains('hidden')) {
        toolbox.classList.remove('hidden');
        toolbox.classList.add('visible');
        document.getElementById('toolboxToggle').classList.add('active');
      }
      
      // Visual feedback
      addBtn.textContent = '‚úì';
      addBtn.style.color = 'var(--accent)';
      setTimeout(() => {
        addBtn.textContent = '+';
        addBtn.style.color = '';
      }, 1000);
    }
  });
  
  // Card expand
  document.addEventListener('click', (e) => {
    const expandBtn = e.target.closest('.card-expand');
    if (expandBtn) {
      e.stopPropagation();
      const card = expandBtn.closest('.card');
      const cardName = card.dataset.name;
      
      if (cardName) {
        window.open(`cards/${cardName}.html`, '_blank');
      }
    }
  });
  
  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Ctrl+T for toolbox
    if (e.ctrlKey && e.key === 't') {
      e.preventDefault();
      document.getElementById('toolboxToggle').click();
    }
    // Ctrl+P for palette
    else if (e.ctrlKey && e.key === 'p') {
      e.preventDefault();
      document.getElementById('paletteToggle').click();
    }
    // Ctrl+R for reader mode
    else if (e.ctrlKey && e.key === 'r') {
      e.preventDefault();
      document.getElementById('readerToggle').click();
    }
    // Esc to close panels
    else if (e.key === 'Escape') {
      document.getElementById('palettePanel').classList.remove('open');
      document.getElementById('paletteToggle').classList.remove('active');
    }
    // Focus search on /
    else if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
      e.preventDefault();
      document.getElementById('searchInput').focus();
    }
  });
}

// Helper functions (truncated)
function applyTheme(themeName) {
  const theme = themes[themeName];
  if (!theme) return;
  
  const gradient = `linear-gradient(135deg, ${theme.bg1}, ${theme.bg2})`;
  document.documentElement.style.background = gradient;
  document.body.style.background = gradient;
  
  localStorage.setItem('theme', themeName);
}

function performSearch(query) {
  query = query.toLowerCase().trim();
  isSearching = query.length > 0;
  
  const cards = document.querySelectorAll('.card');
  let visibleCount = 0;
  
  cards.forEach(card => {
    const name = card.dataset.name.toLowerCase();
    const text = card.textContent.toLowerCase();
    const matches = name.includes(query) || text.includes(query);
    
    card.style.display = matches ? '' : 'none';
    
    if (matches) {
      visibleCount++;
      
      // Load card if not already loaded
      const cardName = card.dataset.name;
      if (cardName && !loadedCards.has(cardName) && !loadingCards.has(cardName)) {
        loadCard(card, cardName);
      }
    }
  });
  
  updateStatus();
}

function sortCards(type) {
  currentSort = type;
  const grid = document.getElementById('gridContainer');
  const cards = Array.from(grid.children);
  
  switch (type) {
    case 'alpha':
      cards.sort((a, b) => a.dataset.name.localeCompare(b.dataset.name));
      break;
    case 'random':
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        grid.appendChild(cards[j]);
      }
      return; // Already sorted in place
    case 'newest':
      cards.sort((a, b) => b.dataset.index - a.dataset.index);
      break;
  }
  
  // Reorder in DOM
  cards.forEach(card => grid.appendChild(card));
}

function setView(type) {
  currentView = type;
  const dashboard = document.getElementById('gridContainer');
  
  if (type === 'list') {
    dashboard.style.gridTemplateColumns = '1fr';
    dashboard.style.maxWidth = '800px';
    dashboard.style.margin = '0 auto';
  } else {
    dashboard.style.gridTemplateColumns = 'repeat(auto-fill, minmax(var(--card-min), 1fr))';
    dashboard.style.maxWidth = '';
    dashboard.style.margin = '';
  }
}

function copyEmbedCode(cardName) {
  const displayName = cardName.replace(/-/g, ' ');
  const embedCode = `<iframe src="https://mrpr0phecy.github.io/mrpr0phecy/cards/${cardName}.html" width="100%" height="400" style="border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);" title="${displayName} - The Most Useful Site"></iframe>`;
  
  navigator.clipboard.writeText(embedCode).then(() => {
    // Visual feedback
    const embedBtn = document.querySelector(`.embed-btn[data-card="${cardName}"]`);
    if (embedBtn) {
      const originalHTML = embedBtn.innerHTML;
      embedBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
      embedBtn.classList.add('copied');
      
      setTimeout(() => {
        embedBtn.innerHTML = originalHTML;
        embedBtn.classList.remove('copied');
      }, 2000);
    }
  }).catch(err => {
    console.error('Copy failed:', err);
  });
}

// Initialize Sortable
new Sortable(document.getElementById('gridContainer'), {
  animation: 150,
  disabled: false
});

console.log('Site initialized successfully!');
</script>
</body>
</html>
