<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Most Useful Site in the World</title>
<meta name="description" content="The Most Useful Site in the World â€” a mythic dashboard of calculators, tools, and widgets for productivity, creativity, and Second Life." />
<meta name="keywords" content="Second Life tools, calculators, productivity, creative widgets, prim calculator, L$ exchange, marketplace search, events calendar" />
<style>
  :root{
    --accent:#2dd4ff;
    --muted:#e6faff;
    --glass: rgba(255,255,255,0.06);
    --glass-strong: rgba(255,255,255,0.08);
    --border: rgba(255,255,255,0.10);
    --panel: rgba(20,20,20,0.9);
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(-45deg,#1a1a1a,#2a2a2a,#3a3a3a,#2a2a2a);background-size:400% 400%;animation:gradientShift 20s ease infinite;color:var(--muted);}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background:url("/logo.png") no-repeat center;background-size:min(50vw,520px);opacity:0.06;filter:blur(0.6px);mix-blend-mode:screen;animation:logoDrift 24s ease-in-out infinite;}
  @keyframes logoDrift{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
  header{text-align:center;padding:28px 20px 10px;position:relative;z-index:2}
  header h1{margin:0;font-size:1.8rem;color:var(--accent);}
  .banner-text{margin-top:8px;font-size:0.95rem;color:var(--accent);opacity:1;transition:opacity 2s ease}
  .banner-text.fade{opacity:0;pointer-events:none}

  .toolbox-toggle,
  .reader-toggle {
    position:fixed;
    bottom:18px;
    z-index:10000;
    width:44px;
    height:44px;
    border-radius:10px;
    background:var(--glass-strong);
    border:1px solid var(--border);
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    backdrop-filter:blur(6px);
    box-shadow:0 6px 18px rgba(0,0,0,0.45);
    transition:all .3s ease;
  }
  .toolbox-toggle:hover,
  .reader-toggle:hover{transform:scale(1.05);}

  .toolbox-toggle{left:18px;}
  .reader-toggle{left:72px;font-size:22px;}

  .toolbox-toggle .plus{width:18px;height:18px;position:relative}
  .toolbox-toggle .plus::before,.toolbox-toggle .plus::after{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--accent);border-radius:2px;}
  .toolbox-toggle .plus::before{width:2px;height:14px}
  .toolbox-toggle .plus::after{width:14px;height:2px}

  .toolbox-panel{position:fixed;bottom:74px;left:18px;z-index:9998;min-width:280px;max-width:60vw;max-height:60vh;background:var(--panel);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6);transform:translateY(8px) scale(.98);opacity:0;pointer-events:none;transition:opacity .26s,transform .26s;backdrop-filter:blur(12px);display:flex;flex-direction:column;overflow-y:auto;}
  .toolbox-panel.open{transform:translateY(0) scale(1);opacity:1;pointer-events:auto}

  .search-bar{max-width:820px;margin:14px auto 16px;display:flex;background:var(--glass);border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,0.08)}
  .search-bar input{flex:1;border:none;background:transparent;color:var(--muted);font-size:1rem;outline:none}
  .controls{text-align:center;margin-bottom:20px}
  .controls button{margin:0 6px;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;transition:all .3s ease}
  .controls button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}

  .dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;padding:20px}
  .card{position:relative;background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.07));border:1px solid rgba(255,255,255,0.10);border-radius:12px;padding:16px;backdrop-filter:blur(8px);opacity:0;transform:translateY(40px) scale(0.98);transition:opacity .6s cubic-bezier(.2,.9,.2,1),transform .6s cubic-bezier(.2,.9,.2,1);}
  .card.visible{opacity:1;transform:translateY(0) scale(1)}

  .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
  .card-header h3{margin:0;color:var(--accent);font-size:1.1rem;}
  .card-header .buttons{display:flex;gap:6px;}

  .add-to-toolbox,.remove-from-toolbox{position:static;width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:var(--glass-strong);border:1px solid var(--border);cursor:pointer;transition:all .3s ease;}
  .add-to-toolbox:hover,.remove-from-toolbox:hover{transform:scale(1.1);}
  .add-to-toolbox{color:var(--accent);}
  .remove-from-toolbox{color:#ff4d4d;}
  .remove-from-toolbox .minus{width:14px;height:2px;background:#ff4d4d;border-radius:1px}

  .add-to-toolbox .plus{width:14px;height:14px;position:relative;}
  .add-to-toolbox .plus::before,.add-to-toolbox .plus::after{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--accent);border-radius:2px;}
  .add-to-toolbox .plus::before{width:2px;height:12px;}
  .add-to-toolbox .plus::after{width:12px;height:2px;}

  .status{text-align:center;color:rgba(230,250,255,0.7);margin:6px 0 8px;font-size:.95rem}
  #toolboxList{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;}

  .card input,.card select,.card textarea{max-width:100%;box-sizing:border-box;}

  /* Reader Mode Styles */
  body.reader-mode {
    font-size: 1.25rem;
    line-height: 1.6;
  }
  body.reader-mode .dashboard {
    grid-template-columns: 1fr !important;
  }
  body.reader-mode .card {
    font-size: 1.1rem;
    padding: 20px;
  }
  body.reader-mode input,
  body.reader-mode select,
  body.reader-mode textarea,
  body.reader-mode button {
    font-size: 1.1rem;
    padding: 10px;
  }
</style>
</head>
<body>
  <div class="toolbox-toggle" id="toolboxToggle" aria-label="Toggle Toolbox"><span class="plus"></span></div>
  <div class="reader-toggle" id="readerToggle" aria-label="Toggle Reader Mode"><span class="glasses">ðŸ‘“</span></
      <div class="toolbox-panel" id="toolboxPanel" role="navigation">
    <h3 style="color:var(--accent);margin:0 0 10px;">Toolbox</h3>
    <div id="toolboxList" class="dashboard"></div>
  </div>

  <header>
    <h1>The Most Useful Site in the World</h1>
  </header>

  <main role="main">
    <div class="search-bar"><input id="searchInput" type="text" placeholder="Search cards..." aria-label="Search cards" /></div>
    <div class="controls">
      <button id="sortAlphaBtn" aria-label="Sort cards alphabetically">Sort Aâ†’Z</button>
      <button id="sortRandomBtn" aria-label="Shuffle cards randomly">Random</button>
    </div>
    <div class="status" id="status">Loading cards...</div>

    <div id="gridContainer" class="dashboard"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    setTimeout(()=>document.getElementById('bannerText')?.classList.add('fade'),6000);

    const DEFAULT_REPO='mrpr0phecy/mrpr0phecy'; // update to your repo
    const DEFAULT_BRANCH='main';                // update if branch is "master"

    function parseOwnerRepo(str){
      const p=str.split('/');
      return {owner:p[0],repo:p[1]};
    }

    async function fetchRepoTree(owner,repo,branch){
      const url=`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
      const r=await fetch(url);
      if(!r.ok) throw new Error('GitHub API error: '+r.status);
      return r.json();
    }

    async function getCardFiles(owner,repo,branch){
      const data=await fetchRepoTree(owner,repo,branch);
      return (data.tree||[])
        .filter(item=>item.path.startsWith('cards/') && item.path.endsWith('.html'))
        .map(item=>item.path.replace(/^cards\//,''));
    }

    function createCardElement(file,{pinned=false}={}){
      const name=file.replace('.html','');
      const card=document.createElement('div');
      card.className='card';
      card.dataset.name=name;
      card.dataset.file=file;

      const header=document.createElement('div');
      header.className='card-header';

      const title=document.createElement('h3');
      title.textContent=name;

      const btnWrap=document.createElement('div');
      btnWrap.className='buttons';

      const addBtn=document.createElement('div');
      addBtn.className='add-to-toolbox';
      addBtn.innerHTML='<span class="plus"></span>';
      addBtn.addEventListener('click',e=>{
        e.stopPropagation(); addToToolbox(file);
      });
      btnWrap.appendChild(addBtn);

      if(pinned){
        const removeBtn=document.createElement('div');
        removeBtn.className='remove-from-toolbox';
        removeBtn.innerHTML='<div class="minus"></div>';
        removeBtn.addEventListener('click',e=>{
          e.stopPropagation(); removeFromToolbox(file);
        });
        btnWrap.appendChild(removeBtn);
      }

      header.appendChild(title);
      header.appendChild(btnWrap);
      card.appendChild(header);

      const content=document.createElement('div');
      content.className='content';
      content.textContent='Loading previewâ€¦';
      card.appendChild(content);

      if(pinned){
        loadCardContentInto(card,file).catch(()=>{content.textContent='Preview unavailable.';});
        requestAnimationFrame(()=>card.classList.add('visible'));
      }else{
        const io=new IntersectionObserver(entries=>{
          entries.forEach(entry=>{
            if(entry.isIntersecting){
              card.classList.add('visible');
              loadCardContentInto(card,file).catch(()=>{content.textContent='Preview unavailable.';});
              io.unobserve(card);
            }
          });
        },{threshold:0.12});
        io.observe(card);
      }
      return card;
    }

    async function loadCardContentInto(card,file){
      if(card.dataset.loaded==='true') return;
      const url=`cards/${file}`;
      const r=await fetch(url);
      if(!r.ok) throw new Error('Failed to fetch card');
      const html=await r.text();
      const sanitized=html.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,'');
      card.querySelector('.content').innerHTML=sanitized;
      card.dataset.loaded='true';
    }

    let currentFiles=[];
    async function loadDashboard(){
      const {owner,repo}=parseOwnerRepo(DEFAULT_REPO);
      try{
        const files=await getCardFiles(owner,repo,DEFAULT_BRANCH);
        if(!files.length){
          document.getElementById('status').textContent='No cards found.';
          return;
        }
        files.sort((a,b)=>a.localeCompare(b,undefined,{sensitivity:'base',numeric:true}));
        currentFiles=files.slice();
        const grid=document.getElementById('gridContainer');
        grid.innerHTML='';
        files.forEach(f=>grid.appendChild(createCardElement(f)));
        document.getElementById('status').textContent=`Loaded ${files.length} cards.`;
        applySearchFilter(document.getElementById('searchInput').value);
      }catch(err){
        document.getElementById('status').textContent='Error loading cards.';
      }
    }
    let currentQuery='';
    function applySearchFilter(q){
      currentQuery=(q||'').trim().toLowerCase();
      document.querySelectorAll('.card').forEach(card=>{
        const name=(card.dataset.name||'').toLowerCase();
        const text=(card.textContent||'').toLowerCase();
        const show=!currentQuery||name.includes(currentQuery)||text.includes(currentQuery);
        card.style.display=show?'':'none';
      });
      const visibleCount=[...document.querySelectorAll('#gridContainer .card')]
        .filter(c=>c.style.display!=='none').length;
      document.getElementById('status').textContent=
        `Showing ${visibleCount} of ${currentFiles.length} cards${currentQuery?' (filtered)':''}.`;
    }
    document.getElementById('searchInput').addEventListener('input',e=>applySearchFilter(e.target.value));

    document.getElementById('sortAlphaBtn').addEventListener('click',()=>{
      const grid=document.getElementById('gridContainer');
      const nodes=[...grid.children];
      nodes.sort((a,b)=>a.dataset.name.localeCompare(b.dataset.name,undefined,{sensitivity:'base',numeric:true}));
      nodes.forEach(n=>grid.appendChild(n));
      document.getElementById('status').textContent='Sorted alphabetically.';
    });
    document.getElementById('sortRandomBtn').addEventListener('click',()=>{
      const grid=document.getElementById('gridContainer');
      const nodes=[...grid.children];
      for(let i=nodes.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [nodes[i],nodes[j]]=[nodes[j],nodes[i]];
      }
      nodes.forEach(n=>grid.appendChild(n));
      document.getElementById('status').textContent='Shuffled cards.';
    });

    const TOOLBOX_KEY='toolbox_items_v1';
    function loadToolboxStore(){try{return JSON.parse(localStorage.getItem(TOOLBOX_KEY)||'[]');}catch(e){return[];}}
    function saveToolboxStore(items){localStorage.setItem(TOOLBOX_KEY,JSON.stringify(items));}
    let toolboxItems=loadToolboxStore();

    function renderToolboxPanel(){
      const list=document.getElementById('toolboxList');
      list.innerHTML='';
      if(!toolboxItems.length){
        list.innerHTML='<div class="toolbox-empty">No items yet. Add tools by pressing the + on any card.</div>';
        return;
      }
      toolboxItems.forEach(file=>{
        const card=createCardElement(file,{pinned:true});
        list.appendChild(card);
      });
    }

    function addToToolbox(file){
      if(toolboxItems.includes(file)){openToolbox();return;}
      toolboxItems.unshift(file);
      if(toolboxItems.length>80) toolboxItems.length=80;
      saveToolboxStore(toolboxItems);
      renderToolboxPanel();
      openToolbox();
    }

    function removeFromToolbox(file){
      const idx=toolboxItems.indexOf(file);
      if(idx>=0){
        toolboxItems.splice(idx,1);
        saveToolboxStore(toolboxItems);
        renderToolboxPanel();
      }
    }

    function clearToolbox(){
      if(!confirm('Clear toolbox?')) return;
      toolboxItems=[];
      saveToolboxStore(toolboxItems);
      renderToolboxPanel();
    }

    function openToolbox(){document.getElementById('toolboxPanel').classList.add('open');}
    function closeToolbox(){document.getElementById('toolboxPanel').classList.remove('open');}
    function toggleToolbox(){document.getElementById('toolboxPanel').classList.toggle('open');}

    document.getElementById('toolboxToggle').addEventListener('click',toggleToolbox);

    // Reader Mode toggle
    document.getElementById('readerToggle').addEventListener('click', ()=>{
      document.body.classList.toggle('reader-mode');
      // Optional: persist preference
      if(document.body.classList.contains('reader-mode')){
        localStorage.setItem('readerMode','on');
      } else {
        localStorage.removeItem('readerMode');
      }
    });

    // Restore reader mode if previously set
    if(localStorage.getItem('readerMode')==='on'){
      document.body.classList.add('reader-mode');
    }

    new Sortable(document.getElementById('gridContainer'),{animation:150});
    new Sortable(document.getElementById('toolboxList'),{animation:150});

    renderToolboxPanel();
    loadDashboard();
  </script>
</body>
</html>
