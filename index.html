<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Most Useful Site in the World</title>
  <style>
    body {
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:linear-gradient(-45deg,#0b0f1a,#1a1f2b,#2a2f3b,#1a1f2b);
      background-size:400% 400%;
      animation:gradientShift 20s ease infinite;
      color:#e6faff;
    }
    @keyframes gradientShift {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }
    h1 { text-align:center; padding:20px; }
    .dashboard {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
      gap:20px;
      padding:20px;
    }
    .card {
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:12px;
      padding:16px;
      cursor:grab;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .card:active { cursor:grabbing; transform:scale(0.97); box-shadow:0 6px 20px rgba(0,0,0,0.4); }
    .card h3 { margin:0 0 10px; color:#2dd4ff; }
    .banner {
      position:fixed; top:0; left:0; right:0;
      background:#2dd4ff; color:#0b0f1a;
      text-align:center; padding:12px;
      font-weight:600; z-index:9999;
      opacity:1; transition:opacity 2s ease;
    }
    .banner.fade { opacity:0; pointer-events:none; }
  </style>
</head>
<body>
  <div id="banner" class="banner">
    Welcome to your dashboard — drag widgets to arrange them. Toolbox items stay pinned below.
  </div>

  <h1>Dashboard</h1>
  <div id="gridContainer" class="dashboard"></div>

  <h2 style="text-align:center;color:#2dd4ff;margin-top:40px;">Pinned Toolbox Widgets</h2>
  <div id="toolboxDashboard" class="dashboard"></div>

  <!-- SortableJS -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    // fade out banner after 6 seconds
    setTimeout(()=>document.getElementById('banner').classList.add('fade'),6000);

    // Repo config (internal only, not shown)
    const DEFAULT_REPO = 'mrpr0phecy/mrpr0phecy';
    const DEFAULT_BRANCH = 'main';

    // GitHub API fetch
    async function fetchRepoTree(owner, repo, branch){
      const url = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
      const r = await fetch(url);
      if(!r.ok) throw new Error('GitHub API error');
      return r.json();
    }
    async function getCardFiles(owner, repo, branch){
      const data = await fetchRepoTree(owner, repo, branch);
      return (data.tree||[])
        .filter(item=>item.path.startsWith('cards/') && item.path.endsWith('.html'))
        .map(item=>item.path.replace(/^cards\//,''));
    }

    // Create card element with lazy preview
    function createCardElement(file){
      const card=document.createElement('div');
      card.className='card';
      card.dataset.name=file.replace('.html','');
      card.innerHTML=`<h3>${file.replace('.html','')}</h3><div class="content">Loading preview…</div>`;
      const io=new IntersectionObserver(entries=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            loadCardContent(card,file);
            io.unobserve(card);
          }
        });
      });
      io.observe(card);
      return card;
    }
    async function loadCardContent(card,file){
      try{
        const url=`cards/${file}`;
        const r=await fetch(url);
        if(!r.ok) return;
        const html=await r.text();
        card.querySelector('.content').innerHTML=html.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,'');
      }catch(e){}
    }

    // Populate dashboard
    async function loadDashboard(){
      const {owner,repo}=parseOwnerRepo(DEFAULT_REPO);
      const files=await getCardFiles(owner,repo,DEFAULT_BRANCH);
      const grid=document.getElementById('gridContainer');
      grid.innerHTML='';
      files.sort((a,b)=>a.localeCompare(b));
      files.forEach(f=>grid.appendChild(createCardElement(f)));
    }
    function parseOwnerRepo(str){
      const parts=str.split('/');
      return {owner:parts[0],repo:parts[1]};
    }

    // Toolbox pinned
    function addToToolbox(file){
      const card=createCardElement(file);
      document.getElementById('toolboxDashboard').appendChild(card);
    }

    // Enable drag-and-drop
    new Sortable(document.getElementById('gridContainer'),{animation:150,ghostClass:'dragging'});
    new Sortable(document.getElementById('toolboxDashboard'),{animation:150,ghostClass:'dragging'});

    // Load everything
    loadDashboard();
    // Demo pinned items
    addToToolbox("example.html");
  </script>
</body>
</html>
