<h2 id="complex-numbers-title" style="margin-top:0;">Complex Numbers Calculator</h2>

<form aria-describedby="complex-numbers-desc">
  <p id="complex-numbers-desc" class="small">Perform operations with complex numbers. Enter values in a+bi form, choose an operation, and get results with steps.</p>

  <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
    <div class="field">
      <label for="cn-a">Complex A</label>
      <input id="cn-a" type="text" placeholder="e.g. 3+4i" style="width:100%;" />
    </div>

    <div class="field">
      <label for="cn-b">Complex B (optional)</label>
      <input id="cn-b" type="text" placeholder="e.g. 1-2i" style="width:100%;" />
    </div>

    <div class="field">
      <label for="cn-operation">Operation</label>
      <select id="cn-operation" style="width:100%;">
        <option value="add" selected>Addition (A + B)</option>
        <option value="subtract">Subtraction (A − B)</option>
        <option value="multiply">Multiplication (A × B)</option>
        <option value="divide">Division (A ÷ B)</option>
        <option value="conjugate">Conjugate of A</option>
        <option value="modulus">Modulus of A</option>
      </select>
    </div>

    <div class="field">
      <label for="cn-show-steps">Show steps</label>
      <select id="cn-show-steps" style="width:100%;">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </div>
  </div>

  <div class="actions" style="margin-top:12px;">
    <button type="button" onclick="cnCalculate(this)">Calculate</button>
    <button type="button" class="secondary" onclick="cnReset(this)">Reset</button>
    <button type="button" onclick="cnCopy(this)">Copy Result</button>
  </div>
</form>

<div class="results" aria-live="polite" style="margin-top:12px;">
  <h3 class="small">Results</h3>
  <textarea id="cn-output" rows="10" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;"></textarea>

  <div style="margin-top:8px;display:flex;gap:12px;align-items:center;">
    <div id="cn-hint" class="small" style="opacity:0.9;"></div>
  </div>
</div>

<script>
/* complex-numbers.html
   - Operations with complex numbers
   - Scoped with cn- prefix
*/

function cnReset(btn){
  const card=btn.closest('.card');
  card.querySelector('form').reset();
  card.querySelector('#cn-output').value="";
  card.querySelector('#cn-hint').textContent="";
}

function cnCopy(btn){
  const card=btn.closest('.card');
  const out=card.querySelector('#cn-output').value;
  if(!out.trim())return;
  navigator.clipboard?.writeText(out).then(()=>{
    const hint=card.querySelector('#cn-hint');
    hint.textContent="Copied to clipboard.";
    setTimeout(()=>{if(hint.textContent==="Copied to clipboard.")hint.textContent="";},1600);
  }).catch(()=>alert("Copy failed."));
}

function parseComplex(str){
  const match=str.match(/([+\-]?\d+)([+\-]\d+)i/);
  if(!match)return null;
  return {re:parseFloat(match[1]), im:parseFloat(match[2])};
}

function cnCalculate(btn){
  const card=btn.closest('.card');
  const A=(card.querySelector('#cn-a').value||"").trim();
  const B=(card.querySelector('#cn-b').value||"").trim();
  const op=card.querySelector('#cn-operation').value;
  const showSteps=card.querySelector('#cn-show-steps').value==="yes";
  if(!A){card.querySelector('#cn-hint').textContent="Please enter Complex A.";return;}
  let output="";
  try{
    const a=parseComplex(A);
    const b=B?parseComplex(B):null;
    if(!a){output="Invalid format for Complex A.";}
    else{
      if(op==="add"&&b){
        const res={re:a.re+b.re,im:a.im+b.im};
        output=`A+B = ${res.re}${res.im>=0?"+":""}${res.im}i`;
        if(showSteps)output+=`\nSteps: Add real parts and imaginary parts separately.`;
      } else if(op==="subtract"&&b){
        const res={re:a.re-b.re,im:a.im-b.im};
        output=`A−B = ${res.re}${res.im>=0?"+":""}${res.im}i`;
        if(showSteps)output+=`\nSteps: Subtract real parts and imaginary parts separately.`;
      } else if(op==="multiply"&&b){
        const res={re:a.re*b.re-a.im*b.im,im:a.re*b.im+a.im*b.re};
        output=`A×B = ${res.re}${res.im>=0?"+":""}${res.im}i`;
        if(showSteps)output+=`\nSteps: (a+bi)(c+di)=ac−bd+(ad+bc)i.`;
      } else if(op==="divide"&&b){
        const denom=b.re*b.re+b.im*b.im;
        const res={re:(a.re*b.re+a.im*b.im)/denom,im:(a.im
